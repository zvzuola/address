// threejs.org/license
(function(k,xa){"object"===typeof exports&&"undefined"!==typeof module?xa(exports):"function"===typeof define&&define.amd?define(["exports"],xa):xa(k.THREE={})})(this,function(k){function xa(){}function C(a,b){this.x=a||0;this.y=b||0}function M(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function ja(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==d?d:1}function p(a,
b,c){this.x=a||0;this.y=b||0;this.z=c||0}function sa(){this.elements=[1,0,0,0,1,0,0,0,1];0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function Y(a,b,c,d,e,f,g,h,l,m){Object.defineProperty(this,"id",{value:xf++});this.uuid=S.generateUUID();this.name="";this.image=void 0!==a?a:Y.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==b?b:Y.DEFAULT_MAPPING;this.wrapS=void 0!==c?c:1001;this.wrapT=void 0!==d?d:1001;this.magFilter=void 0!==
e?e:1006;this.minFilter=void 0!==f?f:1008;this.anisotropy=void 0!==l?l:1;this.format=void 0!==g?g:1023;this.type=void 0!==h?h:1009;this.offset=new C(0,0);this.repeat=new C(1,1);this.center=new C(0,0);this.rotation=0;this.matrixAutoUpdate=!0;this.matrix=new sa;this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==m?m:3E3;this.version=0;this.onUpdate=null}function ea(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1}function hb(a,
b,c){this.width=a;this.height=b;this.scissor=new ea(0,0,a,b);this.scissorTest=!1;this.viewport=new ea(0,0,a,b);c=c||{};void 0===c.minFilter&&(c.minFilter=1006);this.texture=new Y(void 0,void 0,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.encoding);this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0;this.depthTexture=void 0!==c.depthTexture?c.depthTexture:null}function Ib(a,b,c){hb.call(this,a,b,c);this.activeMipMapLevel=
this.activeCubeFace=0}function ib(a,b,c,d,e,f,g,h,l,m,u,n){Y.call(this,null,f,g,h,l,m,d,e,u,n);this.image={data:a,width:b,height:c};this.magFilter=void 0!==l?l:1003;this.minFilter=void 0!==m?m:1003;this.flipY=this.generateMipmaps=!1;this.unpackAlignment=1}function Va(a,b){this.min=void 0!==a?a:new p(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new p(-Infinity,-Infinity,-Infinity)}function Ea(a,b){this.center=void 0!==a?a:new p;this.radius=void 0!==b?b:0}function Fa(a,b){this.normal=void 0!==
a?a:new p(1,0,0);this.constant=void 0!==b?b:0}function ld(a,b,c,d,e,f){this.planes=[void 0!==a?a:new Fa,void 0!==b?b:new Fa,void 0!==c?c:new Fa,void 0!==d?d:new Fa,void 0!==e?e:new Fa,void 0!==f?f:new Fa]}function I(a,b,c){return void 0===b&&void 0===c?this.set(a):this.setRGB(a,b,c)}function yf(a){function b(b,c){var d=b.array,e=b.dynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW,h=a.createBuffer();a.bindBuffer(c,h);a.bufferData(c,d,e);b.onUploadCallback();c=a.FLOAT;d instanceof Float32Array?c=a.FLOAT:d instanceof
Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):d instanceof Uint16Array?c=a.UNSIGNED_SHORT:d instanceof Int16Array?c=a.SHORT:d instanceof Uint32Array?c=a.UNSIGNED_INT:d instanceof Int32Array?c=a.INT:d instanceof Int8Array?c=a.BYTE:d instanceof Uint8Array&&(c=a.UNSIGNED_BYTE);return{buffer:h,type:c,bytesPerElement:d.BYTES_PER_ELEMENT,version:b.version}}var c=new WeakMap;return{get:function(a){a.isInterleavedBufferAttribute&&(a=a.data);return c.get(a)},
remove:function(b){b.isInterleavedBufferAttribute&&(b=b.data);var d=c.get(b);d&&(a.deleteBuffer(d.buffer),c.delete(b))},update:function(d,e){d.isInterleavedBufferAttribute&&(d=d.data);var f=c.get(d);if(void 0===f)c.set(d,b(d,e));else if(f.version<d.version){var g=d,h=g.array,l=g.updateRange;a.bindBuffer(e,f.buffer);!1===g.dynamic?a.bufferData(e,h,a.STATIC_DRAW):-1===l.count?a.bufferSubData(e,0,h):0===l.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):
(a.bufferSubData(e,l.offset*h.BYTES_PER_ELEMENT,h.subarray(l.offset,l.offset+l.count)),l.count=-1);f.version=d.version}}}}function jb(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||jb.DefaultOrder}function Sd(){this.mask=1}function A(){Object.defineProperty(this,"id",{value:zf++});this.uuid=S.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=A.DefaultUp.clone();var a=new p,b=new jb,c=new ja,d=new p(1,1,1);b.onChange(function(){c.setFromEuler(b,
!1)});c.onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:b},quaternion:{enumerable:!0,value:c},scale:{enumerable:!0,value:d},modelViewMatrix:{value:new M},normalMatrix:{value:new sa}});this.matrix=new M;this.matrixWorld=new M;this.matrixAutoUpdate=A.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new Sd;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=
0;this.userData={}}function Qa(){A.call(this);this.type="Camera";this.matrixWorldInverse=new M;this.projectionMatrix=new M}function Jb(a,b,c,d,e,f){Qa.call(this);this.type="OrthographicCamera";this.zoom=1;this.view=null;this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=void 0!==e?e:.1;this.far=void 0!==f?f:2E3;this.updateProjectionMatrix()}function Wa(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.normal=d&&d.isVector3?d:new p;this.vertexNormals=Array.isArray(d)?d:[];this.color=e&&e.isColor?
e:new I;this.vertexColors=Array.isArray(e)?e:[];this.materialIndex=void 0!==f?f:0}function N(){Object.defineProperty(this,"id",{value:Af+=2});this.uuid=S.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=
this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function T(a,b,c){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="";this.array=a;this.itemSize=b;this.count=void 0!==a?a.length/b:0;this.normalized=!0===c;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0}function rc(a,b,c){T.call(this,new Int8Array(a),b,c)}function sc(a,b,c){T.call(this,new Uint8Array(a),b,c)}function tc(a,b,c){T.call(this,new Uint8ClampedArray(a),
b,c)}function uc(a,b,c){T.call(this,new Int16Array(a),b,c)}function kb(a,b,c){T.call(this,new Uint16Array(a),b,c)}function vc(a,b,c){T.call(this,new Int32Array(a),b,c)}function lb(a,b,c){T.call(this,new Uint32Array(a),b,c)}function z(a,b,c){T.call(this,new Float32Array(a),b,c)}function wc(a,b,c){T.call(this,new Float64Array(a),b,c)}function Ce(){this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=
this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function De(a){if(0===a.length)return-Infinity;for(var b=a[0],c=1,d=a.length;c<d;++c)a[c]>b&&(b=a[c]);return b}function F(){Object.defineProperty(this,"id",{value:Bf+=2});this.uuid=S.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange=
{start:0,count:Infinity}}function Kb(a,b,c,d,e,f){N.call(this);this.type="BoxGeometry";this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};this.fromBufferGeometry(new mb(a,b,c,d,e,f));this.mergeVertices()}function mb(a,b,c,d,e,f){function g(a,b,c,d,e,f,g,k,P,H,ta){var q=f/P,v=g/H,x=f/2,K=g/2,w=k/2;g=P+1;var y=H+1,B=f=0,G,C,z=new p;for(C=0;C<y;C++){var A=C*v-K;for(G=0;G<g;G++)z[a]=(G*q-x)*d,z[b]=A*e,z[c]=w,m.push(z.x,z.y,z.z),z[a]=0,z[b]=0,z[c]=0<k?1:-1,u.push(z.x,
z.y,z.z),n.push(G/P),n.push(1-C/H),f+=1}for(C=0;C<H;C++)for(G=0;G<P;G++)a=t+G+g*(C+1),b=t+(G+1)+g*(C+1),c=t+(G+1)+g*C,l.push(t+G+g*C,a,c),l.push(a,b,c),B+=6;h.addGroup(r,B,ta);r+=B;t+=f}F.call(this);this.type="BoxBufferGeometry";this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};var h=this;a=a||1;b=b||1;c=c||1;d=Math.floor(d)||1;e=Math.floor(e)||1;f=Math.floor(f)||1;var l=[],m=[],u=[],n=[],t=0,r=0;g("z","y","x",-1,-1,c,b,a,f,e,0);g("z","y","x",1,-1,c,b,-a,
f,e,1);g("x","z","y",1,1,a,c,b,d,f,2);g("x","z","y",1,-1,a,c,-b,d,f,3);g("x","y","z",1,-1,a,b,c,d,e,4);g("x","y","z",-1,-1,a,b,-c,d,e,5);this.setIndex(l);this.addAttribute("position",new z(m,3));this.addAttribute("normal",new z(u,3));this.addAttribute("uv",new z(n,2))}function xc(a,b,c,d){N.call(this);this.type="PlaneGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};this.fromBufferGeometry(new pb(a,b,c,d));this.mergeVertices()}function pb(a,b,c,d){F.call(this);this.type=
"PlaneBufferGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};a=a||1;b=b||1;var e=a/2,f=b/2;c=Math.floor(c)||1;d=Math.floor(d)||1;var g=c+1,h=d+1,l=a/c,m=b/d,u=[],n=[],t=[],r=[];for(a=0;a<h;a++){var q=a*m-f;for(b=0;b<g;b++)n.push(b*l-e,-q,0),t.push(0,0,1),r.push(b/c),r.push(1-a/d)}for(a=0;a<d;a++)for(b=0;b<c;b++)e=b+g*(a+1),f=b+1+g*(a+1),h=b+1+g*a,u.push(b+g*a,e,h),u.push(e,f,h);this.setIndex(u);this.addAttribute("position",new z(n,3));this.addAttribute("normal",new z(t,
3));this.addAttribute("uv",new z(r,2))}function O(){Object.defineProperty(this,"id",{value:Cf++});this.uuid=S.generateUUID();this.name="";this.type="Material";this.lights=this.fog=!0;this.blending=1;this.side=0;this.flatShading=!1;this.vertexColors=0;this.opacity=1;this.transparent=!1;this.blendSrc=204;this.blendDst=205;this.blendEquation=100;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.depthFunc=3;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=
this.clipIntersection=!1;this.shadowSide=null;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.dithering=!1;this.alphaTest=0;this.premultipliedAlpha=!1;this.overdraw=0;this.visible=!0;this.userData={};this.needsUpdate=!0}function za(a){O.call(this);this.type="MeshBasicMaterial";this.color=new I(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=
null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.lights=this.morphTargets=this.skinning=!1;this.setValues(a)}function va(a){O.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";
this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;this.uniformsNeedUpdate=!1;void 0!==a&&(void 0!==a.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(a))}
function qb(a,b){this.origin=void 0!==a?a:new p;this.direction=void 0!==b?b:new p}function Lb(a,b){this.start=void 0!==a?a:new p;this.end=void 0!==b?b:new p}function Aa(a,b,c){this.a=void 0!==a?a:new p;this.b=void 0!==b?b:new p;this.c=void 0!==c?c:new p}function oa(a,b){A.call(this);this.type="Mesh";this.geometry=void 0!==a?a:new F;this.material=void 0!==b?b:new za({color:16777215*Math.random()});this.drawMode=0;this.updateMorphTargets()}function Df(a,b,c,d){function e(a,c){b.buffers.color.setClear(a.r,
a.g,a.b,c,d)}var f=new I(0),g=0,h,l,m;return{getClearColor:function(){return f},setClearColor:function(a,b){f.set(a);g=void 0!==b?b:1;e(f,g)},getClearAlpha:function(){return g},setClearAlpha:function(a){g=a;e(f,g)},render:function(b,d,t,r){d=d.background;null===d?e(f,g):d&&d.isColor&&(e(d,1),r=!0);(a.autoClear||r)&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil);d&&d.isCubeTexture?(void 0===m&&(m=new oa(new mb(1,1,1),new va({uniforms:rb.cube.uniforms,vertexShader:rb.cube.vertexShader,
fragmentShader:rb.cube.fragmentShader,side:1,depthTest:!0,depthWrite:!1,fog:!1})),m.geometry.removeAttribute("normal"),m.geometry.removeAttribute("uv"),m.onBeforeRender=function(a,b,c){this.matrixWorld.copyPosition(c.matrixWorld)},c.update(m.geometry)),m.material.uniforms.tCube.value=d,b.push(m,m.geometry,m.material,0,null)):d&&d.isTexture&&(void 0===h&&(h=new Jb(-1,1,1,-1,0,1),l=new oa(new pb(2,2),new za({depthTest:!1,depthWrite:!1,fog:!1})),c.update(l.geometry)),l.material.map=d,a.renderBufferDirect(h,
null,l.geometry,l.material,l,null))}}}function Ef(a,b,c){var d;this.setMode=function(a){d=a};this.render=function(b,f){a.drawArrays(d,b,f);c.update(f,d)};this.renderInstances=function(a,f,g){var e=b.get("ANGLE_instanced_arrays");if(null===e)console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{var l=a.attributes.position;l.isInterleavedBufferAttribute?(g=l.data.count,e.drawArraysInstancedANGLE(d,0,g,a.maxInstancedCount)):
e.drawArraysInstancedANGLE(d,f,g,a.maxInstancedCount);c.update(g,d,a.maxInstancedCount)}}}function Ff(a,b,c){function d(b){if("highp"===b){if(0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision)return"highp";b="mediump"}return"mediump"===b&&0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision?"mediump":"lowp"}var e,f=void 0!==
c.precision?c.precision:"highp",g=d(f);g!==f&&(console.warn("THREE.WebGLRenderer:",f,"not supported, using",g,"instead."),f=g);c=!0===c.logarithmicDepthBuffer;g=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);var h=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS),l=a.getParameter(a.MAX_TEXTURE_SIZE),m=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE),u=a.getParameter(a.MAX_VERTEX_ATTRIBS),n=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),t=a.getParameter(a.MAX_VARYING_VECTORS),r=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS),
q=0<h,k=!!b.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==e)return e;var c=b.get("EXT_texture_filter_anisotropic");return e=null!==c?a.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:d,precision:f,logarithmicDepthBuffer:c,maxTextures:g,maxVertexTextures:h,maxTextureSize:l,maxCubemapSize:m,maxAttributes:u,maxVertexUniforms:n,maxVaryings:t,maxFragmentUniforms:r,vertexTextures:q,floatFragmentTextures:k,floatVertexTextures:q&&k}}function Gf(){function a(){m.value!==
d&&(m.value=d,m.needsUpdate=0<e);c.numPlanes=e;c.numIntersection=0}function b(a,b,d,e){var f=null!==a?a.length:0,g=null;if(0!==f){g=m.value;if(!0!==e||null===g){e=d+4*f;b=b.matrixWorldInverse;l.getNormalMatrix(b);if(null===g||g.length<e)g=new Float32Array(e);for(e=0;e!==f;++e,d+=4)h.copy(a[e]).applyMatrix4(b,l),h.normal.toArray(g,d),g[d+3]=h.constant}m.value=g;m.needsUpdate=!0}c.numPlanes=f;return g}var c=this,d=null,e=0,f=!1,g=!1,h=new Fa,l=new sa,m={value:null,needsUpdate:!1};this.uniform=m;this.numIntersection=
this.numPlanes=0;this.init=function(a,c,g){var h=0!==a.length||c||0!==e||f;f=c;d=b(a,g,0);e=a.length;return h};this.beginShadows=function(){g=!0;b(null)};this.endShadows=function(){g=!1;a()};this.setState=function(c,h,l,r,q,k){if(!f||null===c||0===c.length||g&&!l)g?b(null):a();else{l=g?0:e;var n=4*l,u=q.clippingState||null;m.value=u;u=b(c,r,n,k);for(c=0;c!==n;++c)u[c]=d[c];q.clippingState=u;this.numIntersection=h?this.numPlanes:0;this.numPlanes+=l}}}function Hf(a){var b={};return{get:function(c){if(void 0!==
b[c])return b[c];switch(c){case "WEBGL_depth_texture":var d=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case "EXT_texture_filter_anisotropic":d=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":d=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||
a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":d=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "WEBGL_compressed_texture_etc1":d=a.getExtension("WEBGL_compressed_texture_etc1");break;default:d=a.getExtension(c)}null===d&&console.warn("THREE.WebGLRenderer: "+c+" extension not supported.");return b[c]=d}}}function If(a,b,c){function d(a){a=a.target;var g=e[a.id];null!==g.index&&
b.remove(g.index);for(var l in g.attributes)b.remove(g.attributes[l]);a.removeEventListener("dispose",d);delete e[a.id];if(l=f[a.id])b.remove(l),delete f[a.id];if(l=f[g.id])b.remove(l),delete f[g.id];c.memory.geometries--}var e={},f={};return{get:function(a,b){var f=e[b.id];if(f)return f;b.addEventListener("dispose",d);b.isBufferGeometry?f=b:b.isGeometry&&(void 0===b._bufferGeometry&&(b._bufferGeometry=(new F).setFromObject(a)),f=b._bufferGeometry);e[b.id]=f;c.memory.geometries++;return f},update:function(c){var d=
c.index,e=c.attributes;null!==d&&b.update(d,a.ELEMENT_ARRAY_BUFFER);for(var f in e)b.update(e[f],a.ARRAY_BUFFER);c=c.morphAttributes;for(f in c){d=c[f];e=0;for(var g=d.length;e<g;e++)b.update(d[e],a.ARRAY_BUFFER)}},getWireframeAttribute:function(c){var d=f[c.id];if(d)return d;d=[];var e=c.index,g=c.attributes;if(null!==e){e=e.array;g=0;for(var u=e.length;g<u;g+=3){var n=e[g+0],t=e[g+1],r=e[g+2];d.push(n,t,t,r,r,n)}}else for(e=g.position.array,g=0,u=e.length/3-1;g<u;g+=3)n=g+0,t=g+1,r=g+2,d.push(n,
t,t,r,r,n);d=new (65535<De(d)?lb:kb)(d,1);b.update(d,a.ELEMENT_ARRAY_BUFFER);return f[c.id]=d}}}function Jf(a,b,c){var d,e,f;this.setMode=function(a){d=a};this.setIndex=function(a){e=a.type;f=a.bytesPerElement};this.render=function(b,h){a.drawElements(d,h,e,b*f);c.update(h,d)};this.renderInstances=function(a,h,l){var g=b.get("ANGLE_instanced_arrays");null===g?console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):
(g.drawElementsInstancedANGLE(d,l,e,h*f,a.maxInstancedCount),c.update(l,d,a.maxInstancedCount))}}function Kf(a){var b={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:b,programs:null,autoReset:!0,reset:function(){b.frame++;b.calls=0;b.triangles=0;b.points=0;b.lines=0},update:function(c,d,e){e=e||1;b.calls++;switch(d){case a.TRIANGLES:b.triangles+=c/3*e;break;case a.TRIANGLE_STRIP:case a.TRIANGLE_FAN:b.triangles+=e*(c-2);break;case a.LINES:b.lines+=c/2*
e;break;case a.LINE_STRIP:b.lines+=e*(c-1);break;case a.LINE_LOOP:b.lines+=e*c;break;case a.POINTS:b.points+=e*c;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",d)}}}}function Lf(a,b){return Math.abs(b[1])-Math.abs(a[1])}function Mf(a){var b={},c=new Float32Array(8);return{update:function(d,e,f,g){var h=d.morphTargetInfluences,l=h.length;d=b[e.id];if(void 0===d){d=[];for(var m=0;m<l;m++)d[m]=[m,0];b[e.id]=d}var u=f.morphTargets&&e.morphAttributes.position;f=f.morphNormals&&e.morphAttributes.normal;
for(m=0;m<l;m++){var n=d[m];0!==n[1]&&(u&&e.removeAttribute("morphTarget"+m),f&&e.removeAttribute("morphNormal"+m))}for(m=0;m<l;m++)n=d[m],n[0]=m,n[1]=h[m];d.sort(Lf);for(m=0;8>m;m++){if(n=d[m])if(h=n[0],l=n[1]){u&&e.addAttribute("morphTarget"+m,u[h]);f&&e.addAttribute("morphNormal"+m,f[h]);c[m]=l;continue}c[m]=0}g.getUniforms().setValue(a,"morphTargetInfluences",c)}}}function Nf(a,b){var c={};return{update:function(d){var e=b.render.frame,f=d.geometry,g=a.get(d,f);c[g.id]!==e&&(f.isGeometry&&g.updateFromObject(d),
a.update(g),c[g.id]=e);return g},dispose:function(){c={}}}}function ab(a,b,c,d,e,f,g,h,l,m){a=void 0!==a?a:[];Y.call(this,a,void 0!==b?b:301,c,d,e,f,g,h,l,m);this.flipY=!1}function Mb(a,b,c){var d=a[0];if(0>=d||0<d)return a;var e=b*c,f=Ee[e];void 0===f&&(f=new Float32Array(e),Ee[e]=f);if(0!==b)for(d.toArray(f,0),d=1,e=0;d!==b;++d)e+=c,a[d].toArray(f,e);return f}function Fe(a,b){var c=Ge[b];void 0===c&&(c=new Int32Array(b),Ge[b]=c);for(var d=0;d!==b;++d)c[d]=a.allocTextureUnit();return c}function Of(a,
b){a.uniform1f(this.addr,b)}function Pf(a,b){a.uniform1i(this.addr,b)}function Qf(a,b){void 0===b.x?a.uniform2fv(this.addr,b):a.uniform2f(this.addr,b.x,b.y)}function Rf(a,b){void 0!==b.x?a.uniform3f(this.addr,b.x,b.y,b.z):void 0!==b.r?a.uniform3f(this.addr,b.r,b.g,b.b):a.uniform3fv(this.addr,b)}function Sf(a,b){void 0===b.x?a.uniform4fv(this.addr,b):a.uniform4f(this.addr,b.x,b.y,b.z,b.w)}function Tf(a,b){a.uniformMatrix2fv(this.addr,!1,b.elements||b)}function Uf(a,b){void 0===b.elements?a.uniformMatrix3fv(this.addr,
!1,b):(He.set(b.elements),a.uniformMatrix3fv(this.addr,!1,He))}function Vf(a,b){void 0===b.elements?a.uniformMatrix4fv(this.addr,!1,b):(Ie.set(b.elements),a.uniformMatrix4fv(this.addr,!1,Ie))}function Wf(a,b,c){var d=c.allocTextureUnit();a.uniform1i(this.addr,d);c.setTexture2D(b||Je,d)}function Xf(a,b,c){var d=c.allocTextureUnit();a.uniform1i(this.addr,d);c.setTextureCube(b||Ke,d)}function Le(a,b){a.uniform2iv(this.addr,b)}function Me(a,b){a.uniform3iv(this.addr,b)}function Ne(a,b){a.uniform4iv(this.addr,
b)}function Yf(a){switch(a){case 5126:return Of;case 35664:return Qf;case 35665:return Rf;case 35666:return Sf;case 35674:return Tf;case 35675:return Uf;case 35676:return Vf;case 35678:case 36198:return Wf;case 35680:return Xf;case 5124:case 35670:return Pf;case 35667:case 35671:return Le;case 35668:case 35672:return Me;case 35669:case 35673:return Ne}}function Zf(a,b){a.uniform1fv(this.addr,b)}function $f(a,b){a.uniform1iv(this.addr,b)}function ag(a,b){a.uniform2fv(this.addr,Mb(b,this.size,2))}function bg(a,
b){a.uniform3fv(this.addr,Mb(b,this.size,3))}function cg(a,b){a.uniform4fv(this.addr,Mb(b,this.size,4))}function dg(a,b){a.uniformMatrix2fv(this.addr,!1,Mb(b,this.size,4))}function eg(a,b){a.uniformMatrix3fv(this.addr,!1,Mb(b,this.size,9))}function fg(a,b){a.uniformMatrix4fv(this.addr,!1,Mb(b,this.size,16))}function gg(a,b,c){var d=b.length,e=Fe(c,d);a.uniform1iv(this.addr,e);for(a=0;a!==d;++a)c.setTexture2D(b[a]||Je,e[a])}function hg(a,b,c){var d=b.length,e=Fe(c,d);a.uniform1iv(this.addr,e);for(a=
0;a!==d;++a)c.setTextureCube(b[a]||Ke,e[a])}function ig(a){switch(a){case 5126:return Zf;case 35664:return ag;case 35665:return bg;case 35666:return cg;case 35674:return dg;case 35675:return eg;case 35676:return fg;case 35678:return gg;case 35680:return hg;case 5124:case 35670:return $f;case 35667:case 35671:return Le;case 35668:case 35672:return Me;case 35669:case 35673:return Ne}}function jg(a,b,c){this.id=a;this.addr=c;this.setValue=Yf(b.type)}function kg(a,b,c){this.id=a;this.addr=c;this.size=
b.size;this.setValue=ig(b.type)}function Oe(a){this.id=a;this.seq=[];this.map={}}function bb(a,b,c){this.seq=[];this.map={};this.renderer=c;c=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(var d=0;d<c;++d){var e=a.getActiveUniform(b,d),f=a.getUniformLocation(b,e.name),g=this,h=e.name,l=h.length;for(Ud.lastIndex=0;;){var m=Ud.exec(h),u=Ud.lastIndex,n=m[1],t=m[3];"]"===m[2]&&(n|=0);if(void 0===t||"["===t&&u+2===l){h=g;e=void 0===t?new jg(n,e,f):new kg(n,e,f);h.seq.push(e);h.map[e.id]=e;break}else t=
g.map[n],void 0===t&&(t=new Oe(n),n=g,g=t,n.seq.push(g),n.map[g.id]=g),g=t}}}function lg(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+": "+a[b];return a.join("\n")}function Pe(a,b,c){var d=a.createShader(b);a.shaderSource(d,c);a.compileShader(d);!1===a.getShaderParameter(d,a.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");""!==a.getShaderInfoLog(d)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",b===a.VERTEX_SHADER?"vertex":"fragment",a.getShaderInfoLog(d),
lg(c));return d}function Qe(a){switch(a){case 3E3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+a);}}function Vd(a,b){b=Qe(b);return"vec4 "+a+"( vec4 value ) { return "+b[0]+"ToLinear"+b[1]+"; }"}function mg(a,
b){b=Qe(b);return"vec4 "+a+"( vec4 value ) { return LinearTo"+b[0]+b[1]+"; }"}function ng(a,b){switch(b){case 1:b="Linear";break;case 2:b="Reinhard";break;case 3:b="Uncharted2";break;case 4:b="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+b);}return"vec3 "+a+"( vec3 color ) { return "+b+"ToneMapping( color ); }"}function og(a,b,c){a=a||{};return[a.derivatives||b.envMapCubeUV||b.bumpMap||b.normalMap||b.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(a.fragDepth||
b.logarithmicDepthBuffer)&&c.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",a.drawBuffers&&c.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(a.shaderTextureLOD||b.envMap)&&c.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(yc).join("\n")}function pg(a){var b=[],c;for(c in a){var d=a[c];!1!==d&&b.push("#define "+c+" "+d)}return b.join("\n")}function yc(a){return""!==a}function Re(a,b){return a.replace(/NUM_DIR_LIGHTS/g,
b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,b.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,b.numHemiLights)}function Se(a,b){return a.replace(/NUM_CLIPPING_PLANES/g,b.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,b.numClippingPlanes-b.numClipIntersection)}function Wd(a){return a.replace(/^[ \t]*#include +<([\w\d.]+)>/gm,function(a,c){a=V[c];if(void 0===a)throw Error("Can not resolve #include <"+c+
">");return Wd(a)})}function Te(a){return a.replace(/#pragma unroll_loop[\s]+?for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(a,c,d,e){a="";for(c=parseInt(c);c<parseInt(d);c++)a+=e.replace(/\[ i \]/g,"[ "+c+" ]");return a})}function qg(a,b,c,d,e,f){var g=a.context,h=d.defines,l=e.vertexShader,m=e.fragmentShader,u="SHADOWMAP_TYPE_BASIC";1===f.shadowMapType?u="SHADOWMAP_TYPE_PCF":2===f.shadowMapType&&(u="SHADOWMAP_TYPE_PCF_SOFT");var n="ENVMAP_TYPE_CUBE",t="ENVMAP_MODE_REFLECTION",
r="ENVMAP_BLENDING_MULTIPLY";if(f.envMap){switch(d.envMap.mapping){case 301:case 302:n="ENVMAP_TYPE_CUBE";break;case 306:case 307:n="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:n="ENVMAP_TYPE_EQUIREC";break;case 305:n="ENVMAP_TYPE_SPHERE"}switch(d.envMap.mapping){case 302:case 304:t="ENVMAP_MODE_REFRACTION"}switch(d.combine){case 0:r="ENVMAP_BLENDING_MULTIPLY";break;case 1:r="ENVMAP_BLENDING_MIX";break;case 2:r="ENVMAP_BLENDING_ADD"}}var k=0<a.gammaFactor?a.gammaFactor:1,v=og(d.extensions,f,b),x=
pg(h),p=g.createProgram();d.isRawShaderMaterial?(h=[x].filter(yc).join("\n"),0<h.length&&(h+="\n"),b=[v,x].filter(yc).join("\n"),0<b.length&&(b+="\n")):(h=["precision "+f.precision+" float;","precision "+f.precision+" int;","#define SHADER_NAME "+e.name,x,f.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+k,"#define MAX_BONES "+f.maxBones,f.useFog&&f.fog?"#define USE_FOG":"",f.useFog&&f.fogExp?"#define FOG_EXP2":"",f.map?"#define USE_MAP":"",f.envMap?"#define USE_ENVMAP":
"",f.envMap?"#define "+t:"",f.lightMap?"#define USE_LIGHTMAP":"",f.aoMap?"#define USE_AOMAP":"",f.emissiveMap?"#define USE_EMISSIVEMAP":"",f.bumpMap?"#define USE_BUMPMAP":"",f.normalMap?"#define USE_NORMALMAP":"",f.displacementMap&&f.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",f.specularMap?"#define USE_SPECULARMAP":"",f.roughnessMap?"#define USE_ROUGHNESSMAP":"",f.metalnessMap?"#define USE_METALNESSMAP":"",f.alphaMap?"#define USE_ALPHAMAP":"",f.vertexColors?"#define USE_COLOR":"",f.flatShading?
"#define FLAT_SHADED":"",f.skinning?"#define USE_SKINNING":"",f.useVertexTexture?"#define BONE_TEXTURE":"",f.morphTargets?"#define USE_MORPHTARGETS":"",f.morphNormals&&!1===f.flatShading?"#define USE_MORPHNORMALS":"",f.doubleSided?"#define DOUBLE_SIDED":"",f.flipSided?"#define FLIP_SIDED":"",f.shadowMapEnabled?"#define USE_SHADOWMAP":"",f.shadowMapEnabled?"#define "+u:"",f.sizeAttenuation?"#define USE_SIZEATTENUATION":"",f.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",f.logarithmicDepthBuffer&&
b.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;",
"\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(yc).join("\n"),b=[v,"precision "+f.precision+" float;","precision "+
f.precision+" int;","#define SHADER_NAME "+e.name,x,f.alphaTest?"#define ALPHATEST "+f.alphaTest:"","#define GAMMA_FACTOR "+k,f.useFog&&f.fog?"#define USE_FOG":"",f.useFog&&f.fogExp?"#define FOG_EXP2":"",f.map?"#define USE_MAP":"",f.envMap?"#define USE_ENVMAP":"",f.envMap?"#define "+n:"",f.envMap?"#define "+t:"",f.envMap?"#define "+r:"",f.lightMap?"#define USE_LIGHTMAP":"",f.aoMap?"#define USE_AOMAP":"",f.emissiveMap?"#define USE_EMISSIVEMAP":"",f.bumpMap?"#define USE_BUMPMAP":"",f.normalMap?"#define USE_NORMALMAP":
"",f.specularMap?"#define USE_SPECULARMAP":"",f.roughnessMap?"#define USE_ROUGHNESSMAP":"",f.metalnessMap?"#define USE_METALNESSMAP":"",f.alphaMap?"#define USE_ALPHAMAP":"",f.vertexColors?"#define USE_COLOR":"",f.gradientMap?"#define USE_GRADIENTMAP":"",f.flatShading?"#define FLAT_SHADED":"",f.doubleSided?"#define DOUBLE_SIDED":"",f.flipSided?"#define FLIP_SIDED":"",f.shadowMapEnabled?"#define USE_SHADOWMAP":"",f.shadowMapEnabled?"#define "+u:"",f.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":
"",f.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",f.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",f.logarithmicDepthBuffer&&b.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",f.envMap&&b.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0!==f.toneMapping?"#define TONE_MAPPING":"",0!==f.toneMapping?V.tonemapping_pars_fragment:"",0!==f.toneMapping?ng("toneMapping",f.toneMapping):"",f.dithering?"#define DITHERING":
"",f.outputEncoding||f.mapEncoding||f.envMapEncoding||f.emissiveMapEncoding?V.encodings_pars_fragment:"",f.mapEncoding?Vd("mapTexelToLinear",f.mapEncoding):"",f.envMapEncoding?Vd("envMapTexelToLinear",f.envMapEncoding):"",f.emissiveMapEncoding?Vd("emissiveMapTexelToLinear",f.emissiveMapEncoding):"",f.outputEncoding?mg("linearToOutputTexel",f.outputEncoding):"",f.depthPacking?"#define DEPTH_PACKING "+d.depthPacking:"","\n"].filter(yc).join("\n"));l=Wd(l);l=Re(l,f);l=Se(l,f);m=Wd(m);m=Re(m,f);m=Se(m,
f);l=Te(l);m=Te(m);m=b+m;l=Pe(g,g.VERTEX_SHADER,h+l);m=Pe(g,g.FRAGMENT_SHADER,m);g.attachShader(p,l);g.attachShader(p,m);void 0!==d.index0AttributeName?g.bindAttribLocation(p,0,d.index0AttributeName):!0===f.morphTargets&&g.bindAttribLocation(p,0,"position");g.linkProgram(p);f=g.getProgramInfoLog(p).trim();e=g.getShaderInfoLog(l).trim();u=g.getShaderInfoLog(m).trim();t=n=!0;if(!1===g.getProgramParameter(p,g.LINK_STATUS))n=!1,console.error("THREE.WebGLProgram: shader error: ",g.getError(),"gl.VALIDATE_STATUS",
g.getProgramParameter(p,g.VALIDATE_STATUS),"gl.getProgramInfoLog",f,e,u);else if(""!==f)console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",f);else if(""===e||""===u)t=!1;t&&(this.diagnostics={runnable:n,material:d,programLog:f,vertexShader:{log:e,prefix:h},fragmentShader:{log:u,prefix:b}});g.deleteShader(l);g.deleteShader(m);var w;this.getUniforms=function(){void 0===w&&(w=new bb(g,p,a));return w};var B;this.getAttributes=function(){if(void 0===B){for(var a={},b=g.getProgramParameter(p,g.ACTIVE_ATTRIBUTES),
c=0;c<b;c++){var d=g.getActiveAttrib(p,c).name;a[d]=g.getAttribLocation(p,d)}B=a}return B};this.destroy=function(){g.deleteProgram(p);this.program=void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=rg++;this.code=c;this.usedTimes=1;this.program=p;this.vertexShader=
l;this.fragmentShader=m;return this}function sg(a,b,c){function d(a,b){if(a)a.isTexture?c=a.encoding:a.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),c=a.texture.encoding);else var c=3E3;3E3===c&&b&&(c=3007);return c}var e=[],f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",
MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow"},g="precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap gradientMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights numRectAreaLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes numClipIntersection depthPacking dithering".split(" ");
this.getParameters=function(b,e,g,u,n,t,r){var h=f[b.type];if(r.isSkinnedMesh){var l=r.skeleton.bones;if(c.floatVertexTextures)l=1024;else{var m=Math.min(Math.floor((c.maxVertexUniforms-20)/4),l.length);m<l.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+l.length+" bones. This GPU supports "+m+"."),l=0):l=m}}else l=0;m=c.precision;null!==b.precision&&(m=c.getMaxPrecision(b.precision),m!==b.precision&&console.warn("THREE.WebGLProgram.getParameters:",b.precision,"not supported, using",m,"instead."));
var k=a.getRenderTarget();return{shaderID:h,precision:m,supportsVertexTextures:c.vertexTextures,outputEncoding:d(k?k.texture:null,a.gammaOutput),map:!!b.map,mapEncoding:d(b.map,a.gammaInput),envMap:!!b.envMap,envMapMode:b.envMap&&b.envMap.mapping,envMapEncoding:d(b.envMap,a.gammaInput),envMapCubeUV:!!b.envMap&&(306===b.envMap.mapping||307===b.envMap.mapping),lightMap:!!b.lightMap,aoMap:!!b.aoMap,emissiveMap:!!b.emissiveMap,emissiveMapEncoding:d(b.emissiveMap,a.gammaInput),bumpMap:!!b.bumpMap,normalMap:!!b.normalMap,
displacementMap:!!b.displacementMap,roughnessMap:!!b.roughnessMap,metalnessMap:!!b.metalnessMap,specularMap:!!b.specularMap,alphaMap:!!b.alphaMap,gradientMap:!!b.gradientMap,combine:b.combine,vertexColors:b.vertexColors,fog:!!u,useFog:b.fog,fogExp:u&&u.isFogExp2,flatShading:b.flatShading,sizeAttenuation:b.sizeAttenuation,logarithmicDepthBuffer:c.logarithmicDepthBuffer,skinning:b.skinning&&0<l,maxBones:l,useVertexTexture:c.floatVertexTextures,morphTargets:b.morphTargets,morphNormals:b.morphNormals,
maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:e.directional.length,numPointLights:e.point.length,numSpotLights:e.spot.length,numRectAreaLights:e.rectArea.length,numHemiLights:e.hemi.length,numClippingPlanes:n,numClipIntersection:t,dithering:b.dithering,shadowMapEnabled:a.shadowMap.enabled&&r.receiveShadow&&0<g.length,shadowMapType:a.shadowMap.type,toneMapping:a.toneMapping,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:b.premultipliedAlpha,
alphaTest:b.alphaTest,doubleSided:2===b.side,flipSided:1===b.side,depthPacking:void 0!==b.depthPacking?b.depthPacking:!1}};this.getProgramCode=function(b,c){var d=[];c.shaderID?d.push(c.shaderID):(d.push(b.fragmentShader),d.push(b.vertexShader));if(void 0!==b.defines)for(var e in b.defines)d.push(e),d.push(b.defines[e]);for(e=0;e<g.length;e++)d.push(c[g[e]]);d.push(b.onBeforeCompile.toString());d.push(a.gammaOutput);return d.join()};this.acquireProgram=function(c,d,f,g){for(var h,l=0,m=e.length;l<
m;l++){var u=e[l];if(u.code===g){h=u;++h.usedTimes;break}}void 0===h&&(h=new qg(a,b,g,c,d,f),e.push(h));return h};this.releaseProgram=function(a){if(0===--a.usedTimes){var b=e.indexOf(a);e[b]=e[e.length-1];e.pop();a.destroy()}};this.programs=e}function tg(){var a=new WeakMap;return{get:function(b){var c=a.get(b);void 0===c&&(c={},a.set(b,c));return c},remove:function(b){a.delete(b)},update:function(b,c,d){a.get(b)[c]=d},dispose:function(){a=new WeakMap}}}function ug(a,b){return a.renderOrder!==b.renderOrder?
a.renderOrder-b.renderOrder:a.program&&b.program&&a.program!==b.program?a.program.id-b.program.id:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function vg(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function wg(){var a=[],b=0,c=[],d=[];return{opaque:c,transparent:d,init:function(){b=0;c.length=0;d.length=0},push:function(e,f,g,h,l){var m=a[b];void 0===m?(m={id:e.id,object:e,geometry:f,material:g,program:g.program,
renderOrder:e.renderOrder,z:h,group:l},a[b]=m):(m.id=e.id,m.object=e,m.geometry=f,m.material=g,m.program=g.program,m.renderOrder=e.renderOrder,m.z=h,m.group=l);(!0===g.transparent?d:c).push(m);b++},sort:function(){1<c.length&&c.sort(ug);1<d.length&&d.sort(vg)}}}function xg(){var a={};return{get:function(b,c){b=b.id+","+c.id;c=a[b];void 0===c&&(c=new wg,a[b]=c);return c},dispose:function(){a={}}}}function yg(){var a={};return{get:function(b){if(void 0!==a[b.id])return a[b.id];switch(b.type){case "DirectionalLight":var c=
{direction:new p,color:new I,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new C};break;case "SpotLight":c={position:new p,direction:new p,color:new I,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new C};break;case "PointLight":c={position:new p,color:new I,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new C,shadowCameraNear:1,shadowCameraFar:1E3};break;case "HemisphereLight":c={direction:new p,skyColor:new I,groundColor:new I};
break;case "RectAreaLight":c={color:new I,position:new p,halfWidth:new p,halfHeight:new p}}return a[b.id]=c}}}function zg(){var a=new yg,b={id:Ag++,hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},c=new p,d=new M,e=new M;return{setup:function(f,g,h){var l=0,m=0,u=0,n=0,t=0,r=0,k=0,v=0;h=h.matrixWorldInverse;for(var x=0,p=f.length;x<p;x++){var w=
f[x],B=w.color,G=w.intensity,K=w.distance,P=w.shadow&&w.shadow.map?w.shadow.map.texture:null;if(w.isAmbientLight)l+=B.r*G,m+=B.g*G,u+=B.b*G;else if(w.isDirectionalLight){var H=a.get(w);H.color.copy(w.color).multiplyScalar(w.intensity);H.direction.setFromMatrixPosition(w.matrixWorld);c.setFromMatrixPosition(w.target.matrixWorld);H.direction.sub(c);H.direction.transformDirection(h);if(H.shadow=w.castShadow)B=w.shadow,H.shadowBias=B.bias,H.shadowRadius=B.radius,H.shadowMapSize=B.mapSize;b.directionalShadowMap[n]=
P;b.directionalShadowMatrix[n]=w.shadow.matrix;b.directional[n]=H;n++}else if(w.isSpotLight){H=a.get(w);H.position.setFromMatrixPosition(w.matrixWorld);H.position.applyMatrix4(h);H.color.copy(B).multiplyScalar(G);H.distance=K;H.direction.setFromMatrixPosition(w.matrixWorld);c.setFromMatrixPosition(w.target.matrixWorld);H.direction.sub(c);H.direction.transformDirection(h);H.coneCos=Math.cos(w.angle);H.penumbraCos=Math.cos(w.angle*(1-w.penumbra));H.decay=0===w.distance?0:w.decay;if(H.shadow=w.castShadow)B=
w.shadow,H.shadowBias=B.bias,H.shadowRadius=B.radius,H.shadowMapSize=B.mapSize;b.spotShadowMap[r]=P;b.spotShadowMatrix[r]=w.shadow.matrix;b.spot[r]=H;r++}else if(w.isRectAreaLight)H=a.get(w),H.color.copy(B).multiplyScalar(G),H.position.setFromMatrixPosition(w.matrixWorld),H.position.applyMatrix4(h),e.identity(),d.copy(w.matrixWorld),d.premultiply(h),e.extractRotation(d),H.halfWidth.set(.5*w.width,0,0),H.halfHeight.set(0,.5*w.height,0),H.halfWidth.applyMatrix4(e),H.halfHeight.applyMatrix4(e),b.rectArea[k]=
H,k++;else if(w.isPointLight){H=a.get(w);H.position.setFromMatrixPosition(w.matrixWorld);H.position.applyMatrix4(h);H.color.copy(w.color).multiplyScalar(w.intensity);H.distance=w.distance;H.decay=0===w.distance?0:w.decay;if(H.shadow=w.castShadow)B=w.shadow,H.shadowBias=B.bias,H.shadowRadius=B.radius,H.shadowMapSize=B.mapSize,H.shadowCameraNear=B.camera.near,H.shadowCameraFar=B.camera.far;b.pointShadowMap[t]=P;b.pointShadowMatrix[t]=w.shadow.matrix;b.point[t]=H;t++}else w.isHemisphereLight&&(H=a.get(w),
H.direction.setFromMatrixPosition(w.matrixWorld),H.direction.transformDirection(h),H.direction.normalize(),H.skyColor.copy(w.color).multiplyScalar(G),H.groundColor.copy(w.groundColor).multiplyScalar(G),b.hemi[v]=H,v++)}b.ambient[0]=l;b.ambient[1]=m;b.ambient[2]=u;b.directional.length=n;b.spot.length=r;b.rectArea.length=k;b.point.length=t;b.hemi.length=v;b.hash=b.id+","+n+","+t+","+r+","+k+","+v+","+g.length},state:b}}function Bg(){var a=new zg,b=[],c=[],d=[];return{init:function(){b.length=0;c.length=
0;d.length=0},state:{lightsArray:b,shadowsArray:c,spritesArray:d,lights:a},setupLights:function(d){a.setup(b,c,d)},pushLight:function(a){b.push(a)},pushShadow:function(a){c.push(a)},pushSprite:function(a){d.push(a)}}}function Cg(){var a={};return{get:function(b,c){b=b.id+","+c.id;c=a[b];void 0===c&&(c=new Bg,a[b]=c);return c},dispose:function(){a={}}}}function cb(a){O.call(this);this.type="MeshDepthMaterial";this.depthPacking=3200;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=
this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(a)}function db(a){O.call(this);this.type="MeshDistanceMaterial";this.referencePosition=new p;this.nearDistance=1;this.farDistance=1E3;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.lights=this.fog=!1;this.setValues(a)}function Ue(a,b,c){function d(b,c,d,e,f,g){var h=
b.geometry;var l=n;var m=b.customDepthMaterial;d&&(l=t,m=b.customDistanceMaterial);m?l=m:(m=!1,c.morphTargets&&(h&&h.isBufferGeometry?m=h.morphAttributes&&h.morphAttributes.position&&0<h.morphAttributes.position.length:h&&h.isGeometry&&(m=h.morphTargets&&0<h.morphTargets.length)),b.isSkinnedMesh&&!1===c.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",b),b=b.isSkinnedMesh&&c.skinning,h=0,m&&(h|=1),b&&(h|=2),l=l[h]);a.localClippingEnabled&&!0===
c.clipShadows&&0!==c.clippingPlanes.length&&(h=l.uuid,m=c.uuid,b=r[h],void 0===b&&(b={},r[h]=b),h=b[m],void 0===h&&(h=l.clone(),b[m]=h),l=h);l.visible=c.visible;l.wireframe=c.wireframe;l.side=null!=c.shadowSide?c.shadowSide:k[c.side];l.clipShadows=c.clipShadows;l.clippingPlanes=c.clippingPlanes;l.clipIntersection=c.clipIntersection;l.wireframeLinewidth=c.wireframeLinewidth;l.linewidth=c.linewidth;d&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(e),l.nearDistance=f,l.farDistance=g);return l}
function e(c,g,h,l){if(!1!==c.visible){if(c.layers.test(g.layers)&&(c.isMesh||c.isLine||c.isPoints)&&c.castShadow&&(!c.frustumCulled||f.intersectsObject(c))){c.modelViewMatrix.multiplyMatrices(h.matrixWorldInverse,c.matrixWorld);var m=b.update(c),n=c.material;if(Array.isArray(n))for(var t=m.groups,r=0,k=t.length;r<k;r++){var q=t[r],v=n[q.materialIndex];v&&v.visible&&(v=d(c,v,l,u,h.near,h.far),a.renderBufferDirect(h,null,m,v,c,q))}else n.visible&&(v=d(c,n,l,u,h.near,h.far),a.renderBufferDirect(h,null,
m,v,c,null))}c=c.children;m=0;for(n=c.length;m<n;m++)e(c[m],g,h,l)}}var f=new ld,g=new M,h=new C,l=new C(c,c),m=new p,u=new p,n=Array(4),t=Array(4),r={},k={0:1,1:0,2:2},v=[new p(1,0,0),new p(-1,0,0),new p(0,0,1),new p(0,0,-1),new p(0,1,0),new p(0,-1,0)],x=[new p(0,1,0),new p(0,1,0),new p(0,1,0),new p(0,1,0),new p(0,0,1),new p(0,0,-1)],y=[new ea,new ea,new ea,new ea,new ea,new ea];for(c=0;4!==c;++c){var w=0!==(c&1),B=0!==(c&2),G=new cb({depthPacking:3201,morphTargets:w,skinning:B});n[c]=G;w=new db({morphTargets:w,
skinning:B});t[c]=w}var K=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=1;this.render=function(b,c,d){if(!1!==K.enabled&&(!1!==K.autoUpdate||!1!==K.needsUpdate)&&0!==b.length){var n=a.state;n.disable(a.context.BLEND);n.buffers.color.setClear(1,1,1,1);n.buffers.depth.setTest(!0);n.setScissorTest(!1);for(var t,r=0,k=b.length;r<k;r++){var q=b[r];t=q.shadow;var p=q&&q.isPointLight;if(void 0===t)console.warn("THREE.WebGLShadowMap:",q,"has no shadow.");else{var w=t.camera;h.copy(t.mapSize);
h.min(l);if(p){var P=h.x,H=h.y;y[0].set(2*P,H,P,H);y[1].set(0,H,P,H);y[2].set(3*P,H,P,H);y[3].set(P,H,P,H);y[4].set(3*P,0,P,H);y[5].set(P,0,P,H);h.x*=4;h.y*=2}null===t.map&&(t.map=new hb(h.x,h.y,{minFilter:1003,magFilter:1003,format:1023}),t.map.texture.name=q.name+".shadowMap",w.updateProjectionMatrix());t.isSpotLightShadow&&t.update(q);P=t.map;H=t.matrix;u.setFromMatrixPosition(q.matrixWorld);w.position.copy(u);p?(t=6,H.makeTranslation(-u.x,-u.y,-u.z)):(t=1,m.setFromMatrixPosition(q.target.matrixWorld),
w.lookAt(m),w.updateMatrixWorld(),H.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),H.multiply(w.projectionMatrix),H.multiply(w.matrixWorldInverse));a.setRenderTarget(P);a.clear();for(q=0;q<t;q++)p&&(m.copy(w.position),m.add(v[q]),w.up.copy(x[q]),w.lookAt(m),w.updateMatrixWorld(),n.viewport(y[q])),g.multiplyMatrices(w.projectionMatrix,w.matrixWorldInverse),f.setFromMatrix(g),e(c,d,w,p)}}K.needsUpdate=!1}}}function zc(a,b,c,d,e,f,g,h,l){Y.call(this,a,b,c,d,e,f,g,h,l);this.needsUpdate=!0}function Dg(a,b,
c,d,e){var f,g,h,l,m,u,n,t,r,k,v,x,y,w,B,G,K,P;function H(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:b.id-a.id}var C,nb,Z,z,A=new p,F=new ja,I=new p;this.render=function(q,p,md){if(0!==q.length){if(void 0===Z){var ta=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),ya=new Uint16Array([0,1,2,0,2,3]);C=b.createBuffer();nb=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,C);b.bufferData(b.ARRAY_BUFFER,ta,b.STATIC_DRAW);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,
nb);b.bufferData(b.ELEMENT_ARRAY_BUFFER,ya,b.STATIC_DRAW);ta=b.createProgram();ya=b.createShader(b.VERTEX_SHADER);var Q=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(ya,["precision "+e.precision+" float;","#define SHADER_NAME SpriteMaterial\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 center;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float fogDepth;\nvoid main() {\n\tvUV = uvOffset + uv * uvScale;\n\tvec2 alignedPosition = ( position - center ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tvec4 mvPosition;\n\tmvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\tfogDepth = - mvPosition.z;\n}"].join("\n"));
b.shaderSource(Q,["precision "+e.precision+" float;","#define SHADER_NAME SpriteMaterial\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvarying float fogDepth;\nvoid main() {\n\tvec4 texture = texture2D( map, vUV );\n\tgl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n\tif ( gl_FragColor.a < alphaTest ) discard;\n\tif ( fogType > 0 ) {\n\t\tfloat fogFactor = 0.0;\n\t\tif ( fogType == 1 ) {\n\t\t\tfogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t\t} else {\n\t\t\tconst float LOG2 = 1.442695;\n\t\t\tfogFactor = exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 );\n\t\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n\t\t}\n\t\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\t}\n}"].join("\n"));
b.compileShader(ya);b.compileShader(Q);b.attachShader(ta,ya);b.attachShader(ta,Q);b.linkProgram(ta);Z=ta;K=b.getAttribLocation(Z,"position");P=b.getAttribLocation(Z,"uv");f=b.getUniformLocation(Z,"uvOffset");g=b.getUniformLocation(Z,"uvScale");h=b.getUniformLocation(Z,"rotation");l=b.getUniformLocation(Z,"center");m=b.getUniformLocation(Z,"scale");u=b.getUniformLocation(Z,"color");n=b.getUniformLocation(Z,"map");t=b.getUniformLocation(Z,"opacity");r=b.getUniformLocation(Z,"modelViewMatrix");k=b.getUniformLocation(Z,
"projectionMatrix");v=b.getUniformLocation(Z,"fogType");x=b.getUniformLocation(Z,"fogDensity");y=b.getUniformLocation(Z,"fogNear");w=b.getUniformLocation(Z,"fogFar");B=b.getUniformLocation(Z,"fogColor");b.getUniformLocation(Z,"fogDepth");G=b.getUniformLocation(Z,"alphaTest");ta=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");ta.width=8;ta.height=8;ya=ta.getContext("2d");ya.fillStyle="white";ya.fillRect(0,0,8,8);z=new zc(ta)}c.useProgram(Z);c.initAttributes();c.enableAttribute(K);
c.enableAttribute(P);c.disableUnusedAttributes();c.disable(b.CULL_FACE);c.enable(b.BLEND);b.bindBuffer(b.ARRAY_BUFFER,C);b.vertexAttribPointer(K,2,b.FLOAT,!1,16,0);b.vertexAttribPointer(P,2,b.FLOAT,!1,16,8);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,nb);b.uniformMatrix4fv(k,!1,md.projectionMatrix.elements);c.activeTexture(b.TEXTURE0);b.uniform1i(n,0);ya=ta=0;(Q=p.fog)?(b.uniform3f(B,Q.color.r,Q.color.g,Q.color.b),Q.isFog?(b.uniform1f(y,Q.near),b.uniform1f(w,Q.far),b.uniform1i(v,1),ya=ta=1):Q.isFogExp2&&
(b.uniform1f(x,Q.density),b.uniform1i(v,2),ya=ta=2)):(b.uniform1i(v,0),ya=ta=0);Q=0;for(var L=q.length;Q<L;Q++){var E=q[Q];E.modelViewMatrix.multiplyMatrices(md.matrixWorldInverse,E.matrixWorld);E.z=-E.modelViewMatrix.elements[14]}q.sort(H);var J=[],Td=[];Q=0;for(L=q.length;Q<L;Q++){E=q[Q];var R=E.material;if(!1!==R.visible){E.onBeforeRender(a,p,md,void 0,R,void 0);b.uniform1f(G,R.alphaTest);b.uniformMatrix4fv(r,!1,E.modelViewMatrix.elements);E.matrixWorld.decompose(A,F,I);J[0]=I.x;J[1]=I.y;Td[0]=
E.center.x-.5;Td[1]=E.center.y-.5;var nd=0;p.fog&&R.fog&&(nd=ya);ta!==nd&&(b.uniform1i(v,nd),ta=nd);null!==R.map?(b.uniform2f(f,R.map.offset.x,R.map.offset.y),b.uniform2f(g,R.map.repeat.x,R.map.repeat.y)):(b.uniform2f(f,0,0),b.uniform2f(g,1,1));b.uniform1f(t,R.opacity);b.uniform3f(u,R.color.r,R.color.g,R.color.b);b.uniform1f(h,R.rotation);b.uniform2fv(l,Td);b.uniform2fv(m,J);c.setBlending(R.blending,R.blendEquation,R.blendSrc,R.blendDst,R.blendEquationAlpha,R.blendSrcAlpha,R.blendDstAlpha,R.premultipliedAlpha);
c.buffers.depth.setTest(R.depthTest);c.buffers.depth.setMask(R.depthWrite);c.buffers.color.setMask(R.colorWrite);d.setTexture2D(R.map||z,0);b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0);E.onAfterRender(a,p,md,void 0,R,void 0)}}c.enable(b.CULL_FACE);c.reset()}}}function Eg(a,b,c){function d(b,c,d){var e=new Uint8Array(4),f=a.createTexture();a.bindTexture(b,f);a.texParameteri(b,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(b,a.TEXTURE_MAG_FILTER,a.NEAREST);for(b=0;b<d;b++)a.texImage2D(c+b,0,a.RGBA,
1,1,0,a.RGBA,a.UNSIGNED_BYTE,e);return f}function e(b){!0!==w[b]&&(a.enable(b),w[b]=!0)}function f(b){!1!==w[b]&&(a.disable(b),w[b]=!1)}function g(b,d,g,h,l,m,n,u){0!==b?e(a.BLEND):f(a.BLEND);if(5!==b){if(b!==K||u!==ya)switch(b){case 2:u?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE));break;case 3:u?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,
a.ONE_MINUS_SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR));break;case 4:u?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.SRC_COLOR,a.ZERO,a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR));break;default:u?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,
a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA))}z=Z=nb=C=H=P=null}else{l=l||d;m=m||g;n=n||h;if(d!==P||l!==nb)a.blendEquationSeparate(c.convert(d),c.convert(l)),P=d,nb=l;if(g!==H||h!==C||m!==Z||n!==z)a.blendFuncSeparate(c.convert(g),c.convert(h),c.convert(m),c.convert(n)),H=g,C=h,Z=m,z=n}K=b;ya=u}function h(b){A!==b&&(b?a.frontFace(a.CW):a.frontFace(a.CCW),A=b)}function l(b){0!==b?(e(a.CULL_FACE),b!==E&&(1===b?a.cullFace(a.BACK):2===b?a.cullFace(a.FRONT):a.cullFace(a.FRONT_AND_BACK))):f(a.CULL_FACE);
E=b}function m(b,c,d){if(b){if(e(a.POLYGON_OFFSET_FILL),F!==c||I!==d)a.polygonOffset(c,d),F=c,I=d}else f(a.POLYGON_OFFSET_FILL)}function u(b){void 0===b&&(b=a.TEXTURE0+L-1);M!==b&&(a.activeTexture(b),M=b)}var n=new function(){var b=!1,c=new ea,d=null,e=new ea(0,0,0,0);return{setMask:function(c){d===c||b||(a.colorMask(c,c,c,c),d=c)},setLocked:function(a){b=a},setClear:function(b,d,f,g,h){!0===h&&(b*=g,d*=g,f*=g);c.set(b,d,f,g);!1===e.equals(c)&&(a.clearColor(b,d,f,g),e.copy(c))},reset:function(){b=
!1;d=null;e.set(-1,0,0,0)}}},t=new function(){var b=!1,c=null,d=null,g=null;return{setTest:function(b){b?e(a.DEPTH_TEST):f(a.DEPTH_TEST)},setMask:function(d){c===d||b||(a.depthMask(d),c=d)},setFunc:function(b){if(d!==b){if(b)switch(b){case 0:a.depthFunc(a.NEVER);break;case 1:a.depthFunc(a.ALWAYS);break;case 2:a.depthFunc(a.LESS);break;case 3:a.depthFunc(a.LEQUAL);break;case 4:a.depthFunc(a.EQUAL);break;case 5:a.depthFunc(a.GEQUAL);break;case 6:a.depthFunc(a.GREATER);break;case 7:a.depthFunc(a.NOTEQUAL);
break;default:a.depthFunc(a.LEQUAL)}else a.depthFunc(a.LEQUAL);d=b}},setLocked:function(a){b=a},setClear:function(b){g!==b&&(a.clearDepth(b),g=b)},reset:function(){b=!1;g=d=c=null}}},r=new function(){var b=!1,c=null,d=null,g=null,h=null,l=null,m=null,n=null,u=null;return{setTest:function(b){b?e(a.STENCIL_TEST):f(a.STENCIL_TEST)},setMask:function(d){c===d||b||(a.stencilMask(d),c=d)},setFunc:function(b,c,e){if(d!==b||g!==c||h!==e)a.stencilFunc(b,c,e),d=b,g=c,h=e},setOp:function(b,c,d){if(l!==b||m!==
c||n!==d)a.stencilOp(b,c,d),l=b,m=c,n=d},setLocked:function(a){b=a},setClear:function(b){u!==b&&(a.clearStencil(b),u=b)},reset:function(){b=!1;u=n=m=l=h=g=d=c=null}}},k=a.getParameter(a.MAX_VERTEX_ATTRIBS),v=new Uint8Array(k),p=new Uint8Array(k),y=new Uint8Array(k),w={},B=null,G=null,K=null,P=null,H=null,C=null,nb=null,Z=null,z=null,ya=!1,A=null,E=null,Q=null,F=null,I=null,L=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS),N=!1;k=0;k=a.getParameter(a.VERSION);-1!==k.indexOf("WebGL")?(k=parseFloat(/^WebGL ([0-9])/.exec(k)[1]),
N=1<=k):-1!==k.indexOf("OpenGL ES")&&(k=parseFloat(/^OpenGL ES ([0-9])/.exec(k)[1]),N=2<=k);var M=null,O={},T=new ea,J=new ea,W={};W[a.TEXTURE_2D]=d(a.TEXTURE_2D,a.TEXTURE_2D,1);W[a.TEXTURE_CUBE_MAP]=d(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6);n.setClear(0,0,0,1);t.setClear(1);r.setClear(0);e(a.DEPTH_TEST);t.setFunc(3);h(!1);l(1);e(a.CULL_FACE);e(a.BLEND);g(1);return{buffers:{color:n,depth:t,stencil:r},initAttributes:function(){for(var a=0,b=v.length;a<b;a++)v[a]=0},enableAttribute:function(c){v[c]=
1;0===p[c]&&(a.enableVertexAttribArray(c),p[c]=1);0!==y[c]&&(b.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(c,0),y[c]=0)},enableAttributeAndDivisor:function(c,d){v[c]=1;0===p[c]&&(a.enableVertexAttribArray(c),p[c]=1);y[c]!==d&&(b.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(c,d),y[c]=d)},disableUnusedAttributes:function(){for(var b=0,c=p.length;b!==c;++b)p[b]!==v[b]&&(a.disableVertexAttribArray(b),p[b]=0)},enable:e,disable:f,getCompressedTextureFormats:function(){if(null===B&&
(B=[],b.get("WEBGL_compressed_texture_pvrtc")||b.get("WEBGL_compressed_texture_s3tc")||b.get("WEBGL_compressed_texture_etc1")||b.get("WEBGL_compressed_texture_astc")))for(var c=a.getParameter(a.COMPRESSED_TEXTURE_FORMATS),d=0;d<c.length;d++)B.push(c[d]);return B},useProgram:function(b){return G!==b?(a.useProgram(b),G=b,!0):!1},setBlending:g,setMaterial:function(b,c){2===b.side?f(a.CULL_FACE):e(a.CULL_FACE);var d=1===b.side;c&&(d=!d);h(d);!0===b.transparent?g(b.blending,b.blendEquation,b.blendSrc,
b.blendDst,b.blendEquationAlpha,b.blendSrcAlpha,b.blendDstAlpha,b.premultipliedAlpha):g(0);t.setFunc(b.depthFunc);t.setTest(b.depthTest);t.setMask(b.depthWrite);n.setMask(b.colorWrite);m(b.polygonOffset,b.polygonOffsetFactor,b.polygonOffsetUnits)},setFlipSided:h,setCullFace:l,setLineWidth:function(b){b!==Q&&(N&&a.lineWidth(b),Q=b)},setPolygonOffset:m,setScissorTest:function(b){b?e(a.SCISSOR_TEST):f(a.SCISSOR_TEST)},activeTexture:u,bindTexture:function(b,c){null===M&&u();var d=O[M];void 0===d&&(d=
{type:void 0,texture:void 0},O[M]=d);if(d.type!==b||d.texture!==c)a.bindTexture(b,c||W[b]),d.type=b,d.texture=c},compressedTexImage2D:function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(R){console.error("THREE.WebGLState:",R)}},texImage2D:function(){try{a.texImage2D.apply(a,arguments)}catch(R){console.error("THREE.WebGLState:",R)}},scissor:function(b){!1===T.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),T.copy(b))},viewport:function(b){!1===J.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),J.copy(b))},
reset:function(){for(var b=0;b<p.length;b++)1===p[b]&&(a.disableVertexAttribArray(b),p[b]=0);w={};M=B=null;O={};E=A=K=G=null;n.reset();t.reset();r.reset()}}}function Fg(a,b,c,d,e,f,g){function h(a,b){if(a.width>b||a.height>b){if("data"in a){console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+a.width+"x"+a.height+").");return}b/=Math.max(a.width,a.height);var c=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");c.width=Math.floor(a.width*b);c.height=Math.floor(a.height*
b);c.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,c.width,c.height);console.warn("THREE.WebGLRenderer: image is too big ("+a.width+"x"+a.height+"). Resized to "+c.width+"x"+c.height,a);return c}return a}function l(a){return S.isPowerOfTwo(a.width)&&S.isPowerOfTwo(a.height)}function m(a,b){return a.generateMipmaps&&b&&1003!==a.minFilter&&1006!==a.minFilter}function u(b,c,e,f){a.generateMipmap(b);d.get(c).__maxMipLevel=Math.log2(Math.max(e,f))}function n(b){return 1003===b||1004===b||1005===
b?a.NEAREST:a.LINEAR}function t(b){b=b.target;b.removeEventListener("dispose",t);a:{var c=d.get(b);if(b.image&&c.__image__webglTextureCube)a.deleteTexture(c.__image__webglTextureCube);else{if(void 0===c.__webglInit)break a;a.deleteTexture(c.__webglTexture)}d.remove(b)}b.isVideoTexture&&delete B[b.id];g.memory.textures--}function k(b){b=b.target;b.removeEventListener("dispose",k);var c=d.get(b),e=d.get(b.texture);if(b){void 0!==e.__webglTexture&&a.deleteTexture(e.__webglTexture);b.depthTexture&&b.depthTexture.dispose();
if(b.isWebGLRenderTargetCube)for(e=0;6>e;e++)a.deleteFramebuffer(c.__webglFramebuffer[e]),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer[e]);else a.deleteFramebuffer(c.__webglFramebuffer),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer);d.remove(b.texture);d.remove(b)}g.memory.textures--}function q(b,n){var k=d.get(b);if(b.isVideoTexture){var r=b.id,q=g.render.frame;B[r]!==q&&(B[r]=q,b.update())}if(0<b.version&&k.__version!==b.version)if(r=b.image,void 0===r)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",
b);else if(!1===r.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",b);else{void 0===k.__webglInit&&(k.__webglInit=!0,b.addEventListener("dispose",t),k.__webglTexture=a.createTexture(),g.memory.textures++);c.activeTexture(a.TEXTURE0+n);c.bindTexture(a.TEXTURE_2D,k.__webglTexture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha);a.pixelStorei(a.UNPACK_ALIGNMENT,b.unpackAlignment);n=h(b.image,
e.maxTextureSize);(1001!==b.wrapS||1001!==b.wrapT||1003!==b.minFilter&&1006!==b.minFilter)&&!1===l(n)&&(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof ImageBitmap)&&(void 0===G&&(G=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),G.width=S.floorPowerOfTwo(n.width),G.height=S.floorPowerOfTwo(n.height),G.getContext("2d").drawImage(n,0,0,G.width,G.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+n.width+"x"+n.height+"). Resized to "+
G.width+"x"+G.height,n),n=G);r=l(n);q=f.convert(b.format);var p=f.convert(b.type);v(a.TEXTURE_2D,b,r);var x=b.mipmaps;if(b.isDepthTexture){var K=a.DEPTH_COMPONENT;if(1015===b.type){if(!w)throw Error("Float Depth Texture only supported in WebGL2.0");K=a.DEPTH_COMPONENT32F}else w&&(K=a.DEPTH_COMPONENT16);1026===b.format&&K===a.DEPTH_COMPONENT&&1012!==b.type&&1014!==b.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),b.type=1012,p=f.convert(b.type));
1027===b.format&&(K=a.DEPTH_STENCIL,1020!==b.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),b.type=1020,p=f.convert(b.type)));c.texImage2D(a.TEXTURE_2D,0,K,n.width,n.height,0,q,p,null)}else if(b.isDataTexture)if(0<x.length&&r){for(var P=0,y=x.length;P<y;P++)K=x[P],c.texImage2D(a.TEXTURE_2D,P,q,K.width,K.height,0,q,p,K.data);b.generateMipmaps=!1;k.__maxMipLevel=x.length-1}else c.texImage2D(a.TEXTURE_2D,0,q,n.width,n.height,0,q,p,n.data),k.__maxMipLevel=
0;else if(b.isCompressedTexture){P=0;for(y=x.length;P<y;P++)K=x[P],1023!==b.format&&1022!==b.format?-1<c.getCompressedTextureFormats().indexOf(q)?c.compressedTexImage2D(a.TEXTURE_2D,P,q,K.width,K.height,0,K.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):c.texImage2D(a.TEXTURE_2D,P,q,K.width,K.height,0,q,p,K.data);k.__maxMipLevel=x.length-1}else if(0<x.length&&r){P=0;for(y=x.length;P<y;P++)K=x[P],c.texImage2D(a.TEXTURE_2D,P,q,q,
p,K);b.generateMipmaps=!1;k.__maxMipLevel=x.length-1}else c.texImage2D(a.TEXTURE_2D,0,q,q,p,n),k.__maxMipLevel=0;m(b,r)&&u(a.TEXTURE_2D,b,n.width,n.height);k.__version=b.version;if(b.onUpdate)b.onUpdate(b);return}c.activeTexture(a.TEXTURE0+n);c.bindTexture(a.TEXTURE_2D,k.__webglTexture)}function v(c,g,h){h?(a.texParameteri(c,a.TEXTURE_WRAP_S,f.convert(g.wrapS)),a.texParameteri(c,a.TEXTURE_WRAP_T,f.convert(g.wrapT)),a.texParameteri(c,a.TEXTURE_MAG_FILTER,f.convert(g.magFilter)),a.texParameteri(c,a.TEXTURE_MIN_FILTER,
f.convert(g.minFilter))):(a.texParameteri(c,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(c,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),1001===g.wrapS&&1001===g.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",g),a.texParameteri(c,a.TEXTURE_MAG_FILTER,n(g.magFilter)),a.texParameteri(c,a.TEXTURE_MIN_FILTER,n(g.minFilter)),1003!==g.minFilter&&1006!==g.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",
g));!(h=b.get("EXT_texture_filter_anisotropic"))||1015===g.type&&null===b.get("OES_texture_float_linear")||1016===g.type&&null===b.get("OES_texture_half_float_linear")||!(1<g.anisotropy||d.get(g).__currentAnisotropy)||(a.texParameterf(c,h.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(g.anisotropy,e.getMaxAnisotropy())),d.get(g).__currentAnisotropy=g.anisotropy)}function p(b,e,g,h){var l=f.convert(e.texture.format),m=f.convert(e.texture.type);c.texImage2D(h,0,l,e.width,e.height,0,l,m,null);a.bindFramebuffer(a.FRAMEBUFFER,
b);a.framebufferTexture2D(a.FRAMEBUFFER,g,h,d.get(e.texture).__webglTexture,0);a.bindFramebuffer(a.FRAMEBUFFER,null)}function y(b,c){a.bindRenderbuffer(a.RENDERBUFFER,b);c.depthBuffer&&!c.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,b)):c.depthBuffer&&c.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,
a.RENDERBUFFER,b)):a.renderbufferStorage(a.RENDERBUFFER,a.RGBA4,c.width,c.height);a.bindRenderbuffer(a.RENDERBUFFER,null)}var w="undefined"!==typeof WebGL2RenderingContext&&a instanceof WebGL2RenderingContext,B={},G;this.setTexture2D=q;this.setTextureCube=function(b,n){var k=d.get(b);if(6===b.image.length)if(0<b.version&&k.__version!==b.version){k.__image__webglTextureCube||(b.addEventListener("dispose",t),k.__image__webglTextureCube=a.createTexture(),g.memory.textures++);c.activeTexture(a.TEXTURE0+
n);c.bindTexture(a.TEXTURE_CUBE_MAP,k.__image__webglTextureCube);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);n=b&&b.isCompressedTexture;for(var r=b.image[0]&&b.image[0].isDataTexture,q=[],p=0;6>p;p++)q[p]=n||r?r?b.image[p].image:b.image[p]:h(b.image[p],e.maxCubemapSize);var x=q[0],w=l(x),K=f.convert(b.format),y=f.convert(b.type);v(a.TEXTURE_CUBE_MAP,b,w);for(p=0;6>p;p++)if(n)for(var B,G=q[p].mipmaps,P=0,C=G.length;P<C;P++)B=G[P],1023!==b.format&&1022!==b.format?-1<c.getCompressedTextureFormats().indexOf(K)?
c.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+p,P,K,B.width,B.height,0,B.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+p,P,K,B.width,B.height,0,K,y,B.data);else r?c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,K,q[p].width,q[p].height,0,K,y,q[p].data):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,K,K,y,q[p]);k.__maxMipLevel=n?G.length-1:0;m(b,w)&&u(a.TEXTURE_CUBE_MAP,b,x.width,
x.height);k.__version=b.version;if(b.onUpdate)b.onUpdate(b)}else c.activeTexture(a.TEXTURE0+n),c.bindTexture(a.TEXTURE_CUBE_MAP,k.__image__webglTextureCube)};this.setTextureCubeDynamic=function(b,e){c.activeTexture(a.TEXTURE0+e);c.bindTexture(a.TEXTURE_CUBE_MAP,d.get(b).__webglTexture)};this.setupRenderTarget=function(b){var e=d.get(b),f=d.get(b.texture);b.addEventListener("dispose",k);f.__webglTexture=a.createTexture();g.memory.textures++;var h=!0===b.isWebGLRenderTargetCube,n=l(b);if(h){e.__webglFramebuffer=
[];for(var t=0;6>t;t++)e.__webglFramebuffer[t]=a.createFramebuffer()}else e.__webglFramebuffer=a.createFramebuffer();if(h){c.bindTexture(a.TEXTURE_CUBE_MAP,f.__webglTexture);v(a.TEXTURE_CUBE_MAP,b.texture,n);for(t=0;6>t;t++)p(e.__webglFramebuffer[t],b,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+t);m(b.texture,n)&&u(a.TEXTURE_CUBE_MAP,b.texture,b.width,b.height);c.bindTexture(a.TEXTURE_CUBE_MAP,null)}else c.bindTexture(a.TEXTURE_2D,f.__webglTexture),v(a.TEXTURE_2D,b.texture,n),p(e.__webglFramebuffer,
b,a.COLOR_ATTACHMENT0,a.TEXTURE_2D),m(b.texture,n)&&u(a.TEXTURE_2D,b.texture,b.width,b.height),c.bindTexture(a.TEXTURE_2D,null);if(b.depthBuffer){e=d.get(b);f=!0===b.isWebGLRenderTargetCube;if(b.depthTexture){if(f)throw Error("target.depthTexture not supported in Cube render targets");if(b&&b.isWebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported");a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer);if(!b.depthTexture||!b.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");
d.get(b.depthTexture).__webglTexture&&b.depthTexture.image.width===b.width&&b.depthTexture.image.height===b.height||(b.depthTexture.image.width=b.width,b.depthTexture.image.height=b.height,b.depthTexture.needsUpdate=!0);q(b.depthTexture,0);e=d.get(b.depthTexture).__webglTexture;if(1026===b.depthTexture.format)a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,e,0);else if(1027===b.depthTexture.format)a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,e,
0);else throw Error("Unknown depthTexture format");}else if(f)for(e.__webglDepthbuffer=[],f=0;6>f;f++)a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer[f]),e.__webglDepthbuffer[f]=a.createRenderbuffer(),y(e.__webglDepthbuffer[f],b);else a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer),e.__webglDepthbuffer=a.createRenderbuffer(),y(e.__webglDepthbuffer,b);a.bindFramebuffer(a.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=function(b){var e=b.texture,f=l(b);if(m(e,f)){f=b.isWebGLRenderTargetCube?
a.TEXTURE_CUBE_MAP:a.TEXTURE_2D;var g=d.get(e).__webglTexture;c.bindTexture(f,g);u(f,e,b.width,b.height);c.bindTexture(f,null)}}}function Ve(a,b){return{convert:function(c){if(1E3===c)return a.REPEAT;if(1001===c)return a.CLAMP_TO_EDGE;if(1002===c)return a.MIRRORED_REPEAT;if(1003===c)return a.NEAREST;if(1004===c)return a.NEAREST_MIPMAP_NEAREST;if(1005===c)return a.NEAREST_MIPMAP_LINEAR;if(1006===c)return a.LINEAR;if(1007===c)return a.LINEAR_MIPMAP_NEAREST;if(1008===c)return a.LINEAR_MIPMAP_LINEAR;
if(1009===c)return a.UNSIGNED_BYTE;if(1017===c)return a.UNSIGNED_SHORT_4_4_4_4;if(1018===c)return a.UNSIGNED_SHORT_5_5_5_1;if(1019===c)return a.UNSIGNED_SHORT_5_6_5;if(1010===c)return a.BYTE;if(1011===c)return a.SHORT;if(1012===c)return a.UNSIGNED_SHORT;if(1013===c)return a.INT;if(1014===c)return a.UNSIGNED_INT;if(1015===c)return a.FLOAT;if(1016===c){var d=b.get("OES_texture_half_float");if(null!==d)return d.HALF_FLOAT_OES}if(1021===c)return a.ALPHA;if(1022===c)return a.RGB;if(1023===c)return a.RGBA;
if(1024===c)return a.LUMINANCE;if(1025===c)return a.LUMINANCE_ALPHA;if(1026===c)return a.DEPTH_COMPONENT;if(1027===c)return a.DEPTH_STENCIL;if(100===c)return a.FUNC_ADD;if(101===c)return a.FUNC_SUBTRACT;if(102===c)return a.FUNC_REVERSE_SUBTRACT;if(200===c)return a.ZERO;if(201===c)return a.ONE;if(202===c)return a.SRC_COLOR;if(203===c)return a.ONE_MINUS_SRC_COLOR;if(204===c)return a.SRC_ALPHA;if(205===c)return a.ONE_MINUS_SRC_ALPHA;if(206===c)return a.DST_ALPHA;if(207===c)return a.ONE_MINUS_DST_ALPHA;
if(208===c)return a.DST_COLOR;if(209===c)return a.ONE_MINUS_DST_COLOR;if(210===c)return a.SRC_ALPHA_SATURATE;if(33776===c||33777===c||33778===c||33779===c)if(d=b.get("WEBGL_compressed_texture_s3tc"),null!==d){if(33776===c)return d.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===c)return d.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===c)return d.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===c)return d.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===c||35841===c||35842===c||35843===c)if(d=b.get("WEBGL_compressed_texture_pvrtc"),
null!==d){if(35840===c)return d.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===c)return d.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===c)return d.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===c)return d.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===c&&(d=b.get("WEBGL_compressed_texture_etc1"),null!==d))return d.COMPRESSED_RGB_ETC1_WEBGL;if(37808===c||37809===c||37810===c||37811===c||37812===c||37813===c||37814===c||37815===c||37816===c||37817===c||37818===c||37819===c||37820===c||37821===c)if(d=b.get("WEBGL_compressed_texture_astc"),
null!==d)return c;if(103===c||104===c)if(d=b.get("EXT_blend_minmax"),null!==d){if(103===c)return d.MIN_EXT;if(104===c)return d.MAX_EXT}return 1020===c&&(d=b.get("WEBGL_depth_texture"),null!==d)?d.UNSIGNED_INT_24_8_WEBGL:0}}}function la(a,b,c,d){Qa.call(this);this.type="PerspectiveCamera";this.fov=void 0!==a?a:50;this.zoom=1;this.near=void 0!==c?c:.1;this.far=void 0!==d?d:2E3;this.focus=10;this.aspect=void 0!==b?b:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()}function qd(a){la.call(this);
this.cameras=a||[]}function We(a){function b(){if(null!==d&&d.isPresenting){var b=d.getEyeParameters("left"),e=b.renderWidth;b=b.renderHeight;v=a.getPixelRatio();q=a.getSize();a.setDrawingBufferSize(2*e,b,1)}else c.enabled&&a.setDrawingBufferSize(q.width,q.height,v)}var c=this,d=null,e=null,f=null,g=new M,h=new M;"undefined"!==typeof window&&"VRFrameData"in window&&(e=new window.VRFrameData);var l=new M,m=new ja,u=new p,n=new la;n.bounds=new ea(0,0,.5,1);n.layers.enable(1);var t=new la;t.bounds=new ea(.5,
0,.5,1);t.layers.enable(2);var k=new qd([n,t]);k.layers.enable(1);k.layers.enable(2);var q,v;"undefined"!==typeof window&&window.addEventListener("vrdisplaypresentchange",b,!1);this.enabled=!1;this.userHeight=1.6;this.getDevice=function(){return d};this.setDevice=function(a){void 0!==a&&(d=a)};this.setPoseTarget=function(a){void 0!==a&&(f=a)};this.getCamera=function(a){if(null===d)return a;d.depthNear=a.near;d.depthFar=a.far;d.getFrameData(e);var b=d.stageParameters;b?g.fromArray(b.sittingToStandingTransform):
g.makeTranslation(0,c.userHeight,0);b=e.pose;var r=null!==f?f:a;r.matrix.copy(g);r.matrix.decompose(r.position,r.quaternion,r.scale);null!==b.orientation&&(m.fromArray(b.orientation),r.quaternion.multiply(m));null!==b.position&&(m.setFromRotationMatrix(g),u.fromArray(b.position),u.applyQuaternion(m),r.position.add(u));r.updateMatrixWorld();if(!1===d.isPresenting)return a;n.near=a.near;t.near=a.near;n.far=a.far;t.far=a.far;k.matrixWorld.copy(a.matrixWorld);k.matrixWorldInverse.copy(a.matrixWorldInverse);
n.matrixWorldInverse.fromArray(e.leftViewMatrix);t.matrixWorldInverse.fromArray(e.rightViewMatrix);h.getInverse(g);n.matrixWorldInverse.multiply(h);t.matrixWorldInverse.multiply(h);a=r.parent;null!==a&&(l.getInverse(a.matrixWorld),n.matrixWorldInverse.multiply(l),t.matrixWorldInverse.multiply(l));n.matrixWorld.getInverse(n.matrixWorldInverse);t.matrixWorld.getInverse(t.matrixWorldInverse);n.projectionMatrix.fromArray(e.leftProjectionMatrix);t.projectionMatrix.fromArray(e.rightProjectionMatrix);k.projectionMatrix.copy(n.projectionMatrix);
a=d.getLayers();a.length&&(a=a[0],null!==a.leftBounds&&4===a.leftBounds.length&&n.bounds.fromArray(a.leftBounds),null!==a.rightBounds&&4===a.rightBounds.length&&t.bounds.fromArray(a.rightBounds));return k};this.getStandingMatrix=function(){return g};this.submitFrame=function(){d&&d.isPresenting&&d.submitFrame()};this.dispose=function(){"undefined"!==typeof window&&window.removeEventListener("vrdisplaypresentchange",b)}}function Xd(a){function b(){ka=new Hf(D);ka.get("WEBGL_depth_texture");ka.get("OES_texture_float");
ka.get("OES_texture_float_linear");ka.get("OES_texture_half_float");ka.get("OES_texture_half_float_linear");ka.get("OES_standard_derivatives");ka.get("OES_element_index_uint");ka.get("ANGLE_instanced_arrays");ia=new Ve(D,ka);Ra=new Ff(D,ka,a);ba=new Eg(D,ka,ia);ba.scissor(V.copy(ca).multiplyScalar(R));ba.viewport(ob.copy(Y).multiplyScalar(R));da=new Kf(D);X=new tg;fa=new Fg(D,ka,ba,X,Ra,ia,da);qa=new yf(D);ra=new If(D,qa,da);sa=new Nf(ra,da);wa=new Mf(D);oa=new sg(A,ka,Ra);ua=new xg;pa=new Cg;ma=
new Df(A,ba,ra,P);xa=new Ef(D,ka,da);za=new Jf(D,ka,da);Aa=new Dg(A,D,ba,fa,Ra);da.programs=oa.programs;A.context=D;A.capabilities=Ra;A.extensions=ka;A.properties=X;A.renderLists=ua;A.state=ba;A.info=da}function c(a){a.preventDefault();console.log("THREE.WebGLRenderer: Context Lost.");E=!0}function d(){console.log("THREE.WebGLRenderer: Context Restored.");E=!1;b()}function e(a){a=a.target;a.removeEventListener("dispose",e);f(a);X.remove(a)}function f(a){var b=X.get(a).program;a.program=void 0;void 0!==
b&&oa.releaseProgram(b)}function g(a,b,c){a.render(function(a){A.renderBufferImmediate(a,b,c)})}function h(){var a=na.getDevice();a&&a.isPresenting?a.requestAnimationFrame(l):window.requestAnimationFrame(l)}function l(a){!1!==va&&(Ba(a),h())}function m(a,b,c){if(!1!==a.visible){if(a.layers.test(b.layers))if(a.isLight)Z.pushLight(a),a.castShadow&&Z.pushShadow(a);else if(a.isSprite)a.frustumCulled&&!ha.intersectsSprite(a)||Z.pushSprite(a);else if(a.isImmediateRenderObject)c&&Nb.setFromMatrixPosition(a.matrixWorld).applyMatrix4(pd),
z.push(a,null,a.material,Nb.z,null);else if(a.isMesh||a.isLine||a.isPoints)if(a.isSkinnedMesh&&a.skeleton.update(),!a.frustumCulled||ha.intersectsObject(a)){c&&Nb.setFromMatrixPosition(a.matrixWorld).applyMatrix4(pd);var d=sa.update(a),e=a.material;if(Array.isArray(e))for(var f=d.groups,g=0,h=f.length;g<h;g++){var l=f[g],n=e[l.materialIndex];n&&n.visible&&z.push(a,d,n,Nb.z,l)}else e.visible&&z.push(a,d,e,Nb.z,null)}a=a.children;g=0;for(h=a.length;g<h;g++)m(a[g],b,c)}}function u(a,b,c,d){for(var e=
0,f=a.length;e<f;e++){var g=a[e],h=g.object,l=g.geometry,m=void 0===d?g.material:d;g=g.group;if(c.isArrayCamera){T=c;for(var u=c.cameras,t=0,k=u.length;t<k;t++){var r=u[t];if(h.layers.test(r.layers)){var q=r.bounds;ba.viewport(ob.set(q.x*J,q.y*W,q.z*J,q.w*W).multiplyScalar(R));n(h,b,r,l,m,g)}}}else T=null,n(h,b,c,l,m,g)}}function n(a,b,c,d,e,f){a.onBeforeRender(A,b,c,d,e,f);Z=pa.get(b,T||c);a.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,a.matrixWorld);a.normalMatrix.getNormalMatrix(a.modelViewMatrix);
if(a.isImmediateRenderObject){var h=a.isMesh&&0>a.matrixWorld.determinant();ba.setMaterial(e,h);h=k(c,b.fog,e,a);N="";g(a,h,e)}else A.renderBufferDirect(c,b.fog,d,e,a,f);a.onAfterRender(A,b,c,d,e,f);Z=pa.get(b,T||c)}function t(a,b,c){var d=X.get(a),g=Z.state.lights;c=oa.getParameters(a,g.state,Z.state.shadowsArray,b,Ga.numPlanes,Ga.numIntersection,c);var h=oa.getProgramCode(a,c),l=d.program,m=!0;if(void 0===l)a.addEventListener("dispose",e);else if(l.code!==h)f(a);else{if(d.lightsHash!==g.state.hash)X.update(a,
"lightsHash",g.state.hash);else if(void 0!==c.shaderID)return;m=!1}m&&(c.shaderID?(l=rb[c.shaderID],d.shader={name:a.type,uniforms:Da.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}):d.shader={name:a.type,uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader},a.onBeforeCompile(d.shader,A),l=oa.acquireProgram(a,d.shader,c,h),d.program=l,a.program=l);c=l.getAttributes();if(a.morphTargets)for(h=a.numSupportedMorphTargets=0;h<A.maxMorphTargets;h++)0<=
c["morphTarget"+h]&&a.numSupportedMorphTargets++;if(a.morphNormals)for(h=a.numSupportedMorphNormals=0;h<A.maxMorphNormals;h++)0<=c["morphNormal"+h]&&a.numSupportedMorphNormals++;c=d.shader.uniforms;if(!a.isShaderMaterial&&!a.isRawShaderMaterial||!0===a.clipping)d.numClippingPlanes=Ga.numPlanes,d.numIntersection=Ga.numIntersection,c.clippingPlanes=Ga.uniform;d.fog=b;d.lightsHash=g.state.hash;a.lights&&(c.ambientLightColor.value=g.state.ambient,c.directionalLights.value=g.state.directional,c.spotLights.value=
g.state.spot,c.rectAreaLights.value=g.state.rectArea,c.pointLights.value=g.state.point,c.hemisphereLights.value=g.state.hemi,c.directionalShadowMap.value=g.state.directionalShadowMap,c.directionalShadowMatrix.value=g.state.directionalShadowMatrix,c.spotShadowMap.value=g.state.spotShadowMap,c.spotShadowMatrix.value=g.state.spotShadowMatrix,c.pointShadowMap.value=g.state.pointShadowMap,c.pointShadowMatrix.value=g.state.pointShadowMatrix);a=d.program.getUniforms();a=bb.seqWithValue(a.seq,c);d.uniformsList=
a}function k(a,b,c,d){aa=0;var e=X.get(c),f=Z.state.lights;od&&(la||a!==O)&&Ga.setState(c.clippingPlanes,c.clipIntersection,c.clipShadows,a,e,a===O&&c.id===Q);!1===c.needsUpdate&&(void 0===e.program?c.needsUpdate=!0:c.fog&&e.fog!==b?c.needsUpdate=!0:c.lights&&e.lightsHash!==f.state.hash?c.needsUpdate=!0:void 0===e.numClippingPlanes||e.numClippingPlanes===Ga.numPlanes&&e.numIntersection===Ga.numIntersection||(c.needsUpdate=!0));c.needsUpdate&&(t(c,b,d),c.needsUpdate=!1);var g=!1,h=!1,l=!1;f=e.program;
var m=f.getUniforms(),n=e.shader.uniforms;ba.useProgram(f.program)&&(l=h=g=!0);c.id!==Q&&(Q=c.id,h=!0);if(g||a!==O){m.setValue(D,"projectionMatrix",a.projectionMatrix);Ra.logarithmicDepthBuffer&&m.setValue(D,"logDepthBufFC",2/(Math.log(a.far+1)/Math.LN2));O!==(T||a)&&(O=T||a,l=h=!0);if(c.isShaderMaterial||c.isMeshPhongMaterial||c.isMeshStandardMaterial||c.envMap)g=m.map.cameraPosition,void 0!==g&&g.setValue(D,Nb.setFromMatrixPosition(a.matrixWorld));(c.isMeshPhongMaterial||c.isMeshLambertMaterial||
c.isMeshBasicMaterial||c.isMeshStandardMaterial||c.isShaderMaterial||c.skinning)&&m.setValue(D,"viewMatrix",a.matrixWorldInverse)}if(c.skinning&&(m.setOptional(D,d,"bindMatrix"),m.setOptional(D,d,"bindMatrixInverse"),a=d.skeleton))if(g=a.bones,Ra.floatVertexTextures){if(void 0===a.boneTexture){g=Math.sqrt(4*g.length);g=S.ceilPowerOfTwo(g);g=Math.max(g,4);var u=new Float32Array(g*g*4);u.set(a.boneMatrices);var k=new ib(u,g,g,1023,1015);k.needsUpdate=!0;a.boneMatrices=u;a.boneTexture=k;a.boneTextureSize=
g}m.setValue(D,"boneTexture",a.boneTexture);m.setValue(D,"boneTextureSize",a.boneTextureSize)}else m.setOptional(D,a,"boneMatrices");h&&(m.setValue(D,"toneMappingExposure",A.toneMappingExposure),m.setValue(D,"toneMappingWhitePoint",A.toneMappingWhitePoint),c.lights&&(h=l,n.ambientLightColor.needsUpdate=h,n.directionalLights.needsUpdate=h,n.pointLights.needsUpdate=h,n.spotLights.needsUpdate=h,n.rectAreaLights.needsUpdate=h,n.hemisphereLights.needsUpdate=h),b&&c.fog&&(n.fogColor.value=b.color,b.isFog?
(n.fogNear.value=b.near,n.fogFar.value=b.far):b.isFogExp2&&(n.fogDensity.value=b.density)),c.isMeshBasicMaterial?q(n,c):c.isMeshLambertMaterial?(q(n,c),c.emissiveMap&&(n.emissiveMap.value=c.emissiveMap)):c.isMeshPhongMaterial?(q(n,c),c.isMeshToonMaterial?(v(n,c),c.gradientMap&&(n.gradientMap.value=c.gradientMap)):v(n,c)):c.isMeshStandardMaterial?(q(n,c),c.isMeshPhysicalMaterial&&(n.clearCoat.value=c.clearCoat,n.clearCoatRoughness.value=c.clearCoatRoughness),n.roughness.value=c.roughness,n.metalness.value=
c.metalness,c.roughnessMap&&(n.roughnessMap.value=c.roughnessMap),c.metalnessMap&&(n.metalnessMap.value=c.metalnessMap),c.emissiveMap&&(n.emissiveMap.value=c.emissiveMap),c.bumpMap&&(n.bumpMap.value=c.bumpMap,n.bumpScale.value=c.bumpScale),c.normalMap&&(n.normalMap.value=c.normalMap,n.normalScale.value.copy(c.normalScale)),c.displacementMap&&(n.displacementMap.value=c.displacementMap,n.displacementScale.value=c.displacementScale,n.displacementBias.value=c.displacementBias),c.envMap&&(n.envMapIntensity.value=
c.envMapIntensity)):c.isMeshDepthMaterial?(q(n,c),c.displacementMap&&(n.displacementMap.value=c.displacementMap,n.displacementScale.value=c.displacementScale,n.displacementBias.value=c.displacementBias)):c.isMeshDistanceMaterial?(q(n,c),c.displacementMap&&(n.displacementMap.value=c.displacementMap,n.displacementScale.value=c.displacementScale,n.displacementBias.value=c.displacementBias),n.referencePosition.value.copy(c.referencePosition),n.nearDistance.value=c.nearDistance,n.farDistance.value=c.farDistance):
c.isMeshNormalMaterial?(q(n,c),c.bumpMap&&(n.bumpMap.value=c.bumpMap,n.bumpScale.value=c.bumpScale),c.normalMap&&(n.normalMap.value=c.normalMap,n.normalScale.value.copy(c.normalScale)),c.displacementMap&&(n.displacementMap.value=c.displacementMap,n.displacementScale.value=c.displacementScale,n.displacementBias.value=c.displacementBias)):c.isLineBasicMaterial?(n.diffuse.value=c.color,n.opacity.value=c.opacity,c.isLineDashedMaterial&&(n.dashSize.value=c.dashSize,n.totalSize.value=c.dashSize+c.gapSize,
n.scale.value=c.scale)):c.isPointsMaterial?(n.diffuse.value=c.color,n.opacity.value=c.opacity,n.size.value=c.size*R,n.scale.value=.5*W,n.map.value=c.map,null!==c.map&&(!0===c.map.matrixAutoUpdate&&(b=c.map.offset,h=c.map.repeat,l=c.map.center,c.map.matrix.setUvTransform(b.x,b.y,h.x,h.y,c.map.rotation,l.x,l.y)),n.uvTransform.value.copy(c.map.matrix))):c.isShadowMaterial&&(n.color.value=c.color,n.opacity.value=c.opacity),void 0!==n.ltc_1&&(n.ltc_1.value=L.LTC_1),void 0!==n.ltc_2&&(n.ltc_2.value=L.LTC_2),
bb.upload(D,e.uniformsList,n,A));c.isShaderMaterial&&!0===c.uniformsNeedUpdate&&(bb.upload(D,e.uniformsList,n,A),c.uniformsNeedUpdate=!1);m.setValue(D,"modelViewMatrix",d.modelViewMatrix);m.setValue(D,"normalMatrix",d.normalMatrix);m.setValue(D,"modelMatrix",d.matrixWorld);return f}function q(a,b){a.opacity.value=b.opacity;b.color&&(a.diffuse.value=b.color);b.emissive&&a.emissive.value.copy(b.emissive).multiplyScalar(b.emissiveIntensity);b.map&&(a.map.value=b.map);b.alphaMap&&(a.alphaMap.value=b.alphaMap);
b.specularMap&&(a.specularMap.value=b.specularMap);b.envMap&&(a.envMap.value=b.envMap,a.flipEnvMap.value=b.envMap&&b.envMap.isCubeTexture?-1:1,a.reflectivity.value=b.reflectivity,a.refractionRatio.value=b.refractionRatio,a.maxMipLevel.value=X.get(b.envMap).__maxMipLevel);b.lightMap&&(a.lightMap.value=b.lightMap,a.lightMapIntensity.value=b.lightMapIntensity);b.aoMap&&(a.aoMap.value=b.aoMap,a.aoMapIntensity.value=b.aoMapIntensity);if(b.map)var c=b.map;else b.specularMap?c=b.specularMap:b.displacementMap?
c=b.displacementMap:b.normalMap?c=b.normalMap:b.bumpMap?c=b.bumpMap:b.roughnessMap?c=b.roughnessMap:b.metalnessMap?c=b.metalnessMap:b.alphaMap?c=b.alphaMap:b.emissiveMap&&(c=b.emissiveMap);if(void 0!==c){c.isWebGLRenderTarget&&(c=c.texture);if(!0===c.matrixAutoUpdate){b=c.offset;var d=c.repeat,e=c.center;c.matrix.setUvTransform(b.x,b.y,d.x,d.y,c.rotation,e.x,e.y)}a.uvTransform.value.copy(c.matrix)}}function v(a,b){a.specular.value=b.specular;a.shininess.value=Math.max(b.shininess,1E-4);b.emissiveMap&&
(a.emissiveMap.value=b.emissiveMap);b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale);b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale));b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias)}console.log("THREE.WebGLRenderer","91");a=a||{};var x=void 0!==a.canvas?a.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),y=void 0!==
a.context?a.context:null,w=void 0!==a.alpha?a.alpha:!1,B=void 0!==a.depth?a.depth:!0,G=void 0!==a.stencil?a.stencil:!0,K=void 0!==a.antialias?a.antialias:!1,P=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,H=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,C=void 0!==a.powerPreference?a.powerPreference:"default",z=null,Z=null;this.domElement=x;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];
this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1;this.toneMappingWhitePoint=this.toneMappingExposure=this.toneMapping=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var A=this,E=!1,F=null,I=null,Q=-1,N="",O=null,T=null,ob=new ea,V=new ea,U=null,aa=0,J=x.width,W=x.height,R=1,Y=new ea(0,0,J,W),ca=new ea(0,0,J,W),ja=!1,ha=new ld,Ga=new Gf,od=!1,la=!1,pd=new M,Nb=new p;try{w={alpha:w,depth:B,stencil:G,antialias:K,premultipliedAlpha:P,preserveDrawingBuffer:H,
powerPreference:C};x.addEventListener("webglcontextlost",c,!1);x.addEventListener("webglcontextrestored",d,!1);var D=y||x.getContext("webgl",w)||x.getContext("experimental-webgl",w);if(null===D){if(null!==x.getContext("webgl"))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.");}void 0===D.getShaderPrecisionFormat&&(D.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Gg){console.error("THREE.WebGLRenderer: "+
Gg.message)}var ka,Ra,ba,da,X,fa,qa,ra,sa,oa,ua,pa,ma,wa,xa,za,Aa,ia;b();var na=new We(A);this.vr=na;var Ca=new Ue(A,sa,Ra.maxTextureSize);this.shadowMap=Ca;this.getContext=function(){return D};this.getContextAttributes=function(){return D.getContextAttributes()};this.forceContextLoss=function(){var a=ka.get("WEBGL_lose_context");a&&a.loseContext()};this.forceContextRestore=function(){var a=ka.get("WEBGL_lose_context");a&&a.restoreContext()};this.getPixelRatio=function(){return R};this.setPixelRatio=
function(a){void 0!==a&&(R=a,this.setSize(J,W,!1))};this.getSize=function(){return{width:J,height:W}};this.setSize=function(a,b,c){var d=na.getDevice();d&&d.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(J=a,W=b,x.width=a*R,x.height=b*R,!1!==c&&(x.style.width=a+"px",x.style.height=b+"px"),this.setViewport(0,0,a,b))};this.getDrawingBufferSize=function(){return{width:J*R,height:W*R}};this.setDrawingBufferSize=function(a,b,c){J=a;W=b;R=c;x.width=a*
c;x.height=b*c;this.setViewport(0,0,a,b)};this.getCurrentViewport=function(){return ob};this.setViewport=function(a,b,c,d){Y.set(a,W-b-d,c,d);ba.viewport(ob.copy(Y).multiplyScalar(R))};this.setScissor=function(a,b,c,d){ca.set(a,W-b-d,c,d);ba.scissor(V.copy(ca).multiplyScalar(R))};this.setScissorTest=function(a){ba.setScissorTest(ja=a)};this.getClearColor=function(){return ma.getClearColor()};this.setClearColor=function(){ma.setClearColor.apply(ma,arguments)};this.getClearAlpha=function(){return ma.getClearAlpha()};
this.setClearAlpha=function(){ma.setClearAlpha.apply(ma,arguments)};this.clear=function(a,b,c){var d=0;if(void 0===a||a)d|=D.COLOR_BUFFER_BIT;if(void 0===b||b)d|=D.DEPTH_BUFFER_BIT;if(void 0===c||c)d|=D.STENCIL_BUFFER_BIT;D.clear(d)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.clearTarget=function(a,b,c,d){this.setRenderTarget(a);this.clear(b,c,d)};this.dispose=function(){x.removeEventListener("webglcontextlost",
c,!1);x.removeEventListener("webglcontextrestored",d,!1);ua.dispose();pa.dispose();X.dispose();sa.dispose();na.dispose();va=!1};this.renderBufferImmediate=function(a,b,c){ba.initAttributes();var d=X.get(a);a.hasPositions&&!d.position&&(d.position=D.createBuffer());a.hasNormals&&!d.normal&&(d.normal=D.createBuffer());a.hasUvs&&!d.uv&&(d.uv=D.createBuffer());a.hasColors&&!d.color&&(d.color=D.createBuffer());b=b.getAttributes();a.hasPositions&&(D.bindBuffer(D.ARRAY_BUFFER,d.position),D.bufferData(D.ARRAY_BUFFER,
a.positionArray,D.DYNAMIC_DRAW),ba.enableAttribute(b.position),D.vertexAttribPointer(b.position,3,D.FLOAT,!1,0,0));if(a.hasNormals){D.bindBuffer(D.ARRAY_BUFFER,d.normal);if(!c.isMeshPhongMaterial&&!c.isMeshStandardMaterial&&!c.isMeshNormalMaterial&&!0===c.flatShading)for(var e=0,f=3*a.count;e<f;e+=9){var g=a.normalArray,h=(g[e+0]+g[e+3]+g[e+6])/3,l=(g[e+1]+g[e+4]+g[e+7])/3,m=(g[e+2]+g[e+5]+g[e+8])/3;g[e+0]=h;g[e+1]=l;g[e+2]=m;g[e+3]=h;g[e+4]=l;g[e+5]=m;g[e+6]=h;g[e+7]=l;g[e+8]=m}D.bufferData(D.ARRAY_BUFFER,
a.normalArray,D.DYNAMIC_DRAW);ba.enableAttribute(b.normal);D.vertexAttribPointer(b.normal,3,D.FLOAT,!1,0,0)}a.hasUvs&&c.map&&(D.bindBuffer(D.ARRAY_BUFFER,d.uv),D.bufferData(D.ARRAY_BUFFER,a.uvArray,D.DYNAMIC_DRAW),ba.enableAttribute(b.uv),D.vertexAttribPointer(b.uv,2,D.FLOAT,!1,0,0));a.hasColors&&0!==c.vertexColors&&(D.bindBuffer(D.ARRAY_BUFFER,d.color),D.bufferData(D.ARRAY_BUFFER,a.colorArray,D.DYNAMIC_DRAW),ba.enableAttribute(b.color),D.vertexAttribPointer(b.color,3,D.FLOAT,!1,0,0));ba.disableUnusedAttributes();
D.drawArrays(D.TRIANGLES,0,a.count);a.count=0};this.renderBufferDirect=function(a,b,c,d,e,f){var g=e.isMesh&&0>e.matrixWorld.determinant();ba.setMaterial(d,g);var h=k(a,b,d,e);a=c.id+"_"+h.id+"_"+(!0===d.wireframe);var l=!1;a!==N&&(N=a,l=!0);e.morphTargetInfluences&&(wa.update(e,c,d,h),l=!0);g=c.index;var m=c.attributes.position;b=1;!0===d.wireframe&&(g=ra.getWireframeAttribute(c),b=2);a=xa;if(null!==g){var n=qa.get(g);a=za;a.setIndex(n)}if(l){l=void 0;if(c&&c.isInstancedBufferGeometry&&null===ka.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");
else{void 0===l&&(l=0);ba.initAttributes();var u=c.attributes;h=h.getAttributes();var t=d.defaultAttributeValues;for(K in h){var r=h[K];if(0<=r){var q=u[K];if(void 0!==q){var p=q.normalized,v=q.itemSize,x=qa.get(q);if(void 0!==x){var w=x.buffer,B=x.type;x=x.bytesPerElement;if(q.isInterleavedBufferAttribute){var y=q.data,G=y.stride;q=q.offset;y&&y.isInstancedInterleavedBuffer?(ba.enableAttributeAndDivisor(r,y.meshPerAttribute),void 0===c.maxInstancedCount&&(c.maxInstancedCount=y.meshPerAttribute*y.count)):
ba.enableAttribute(r);D.bindBuffer(D.ARRAY_BUFFER,w);D.vertexAttribPointer(r,v,B,p,G*x,(l*G+q)*x)}else q.isInstancedBufferAttribute?(ba.enableAttributeAndDivisor(r,q.meshPerAttribute),void 0===c.maxInstancedCount&&(c.maxInstancedCount=q.meshPerAttribute*q.count)):ba.enableAttribute(r),D.bindBuffer(D.ARRAY_BUFFER,w),D.vertexAttribPointer(r,v,B,p,0,l*v*x)}}else if(void 0!==t&&(p=t[K],void 0!==p))switch(p.length){case 2:D.vertexAttrib2fv(r,p);break;case 3:D.vertexAttrib3fv(r,p);break;case 4:D.vertexAttrib4fv(r,
p);break;default:D.vertexAttrib1fv(r,p)}}}ba.disableUnusedAttributes()}null!==g&&D.bindBuffer(D.ELEMENT_ARRAY_BUFFER,n.buffer)}n=Infinity;null!==g?n=g.count:void 0!==m&&(n=m.count);g=c.drawRange.start*b;m=null!==f?f.start*b:0;var K=Math.max(g,m);f=Math.max(0,Math.min(n,g+c.drawRange.count*b,m+(null!==f?f.count*b:Infinity))-1-K+1);if(0!==f){if(e.isMesh)if(!0===d.wireframe)ba.setLineWidth(d.wireframeLinewidth*(null===F?R:1)),a.setMode(D.LINES);else switch(e.drawMode){case 0:a.setMode(D.TRIANGLES);break;
case 1:a.setMode(D.TRIANGLE_STRIP);break;case 2:a.setMode(D.TRIANGLE_FAN)}else e.isLine?(d=d.linewidth,void 0===d&&(d=1),ba.setLineWidth(d*(null===F?R:1)),e.isLineSegments?a.setMode(D.LINES):e.isLineLoop?a.setMode(D.LINE_LOOP):a.setMode(D.LINE_STRIP)):e.isPoints&&a.setMode(D.POINTS);c&&c.isInstancedBufferGeometry?0<c.maxInstancedCount&&a.renderInstances(c,K,f):a.render(K,f)}};this.compile=function(a,b){Z=pa.get(a,b);Z.init();a.traverse(function(a){a.isLight&&(Z.pushLight(a),a.castShadow&&Z.pushShadow(a))});
Z.setupLights(b);a.traverse(function(b){if(b.material)if(Array.isArray(b.material))for(var c=0;c<b.material.length;c++)t(b.material[c],a.fog,b);else t(b.material,a.fog,b)})};var va=!1,Ba=null;this.animate=function(a){Ba=a;null!==Ba?va||(h(),va=!0):va=!1};this.render=function(a,b,c,d){if(!b||!b.isCamera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else if(!E){N="";Q=-1;O=null;!0===a.autoUpdate&&a.updateMatrixWorld();null===b.parent&&b.updateMatrixWorld();
na.enabled&&(b=na.getCamera(b));Z=pa.get(a,b);Z.init();a.onBeforeRender(A,a,b,c);pd.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);ha.setFromMatrix(pd);la=this.localClippingEnabled;od=Ga.init(this.clippingPlanes,la,b);z=ua.get(a,b);z.init();m(a,b,A.sortObjects);!0===A.sortObjects&&z.sort();od&&Ga.beginShadows();Ca.render(Z.state.shadowsArray,a,b);Z.setupLights(b);od&&Ga.endShadows();this.info.autoReset&&this.info.reset();void 0===c&&(c=null);this.setRenderTarget(c);ma.render(z,a,b,d);d=
z.opaque;var e=z.transparent;if(a.overrideMaterial){var f=a.overrideMaterial;d.length&&u(d,a,b,f);e.length&&u(e,a,b,f)}else d.length&&u(d,a,b),e.length&&u(e,a,b);Aa.render(Z.state.spritesArray,a,b);c&&fa.updateRenderTargetMipmap(c);ba.buffers.depth.setTest(!0);ba.buffers.depth.setMask(!0);ba.buffers.color.setMask(!0);ba.setPolygonOffset(!1);a.onAfterRender(A,a,b);na.enabled&&na.submitFrame();Z=z=null}};this.allocTextureUnit=function(){var a=aa;a>=Ra.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+
a+" texture units while this GPU supports only "+Ra.maxTextures);aa+=1;return a};this.setTexture2D=function(){var a=!1;return function(b,c){b&&b.isWebGLRenderTarget&&(a||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),a=!0),b=b.texture);fa.setTexture2D(b,c)}}();this.setTexture=function(){var a=!1;return function(b,c){a||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),a=!0);fa.setTexture2D(b,
c)}}();this.setTextureCube=function(){var a=!1;return function(b,c){b&&b.isWebGLRenderTargetCube&&(a||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),a=!0),b=b.texture);b&&b.isCubeTexture||Array.isArray(b.image)&&6===b.image.length?fa.setTextureCube(b,c):fa.setTextureCubeDynamic(b,c)}}();this.getRenderTarget=function(){return F};this.setRenderTarget=function(a){(F=a)&&void 0===X.get(a).__webglFramebuffer&&fa.setupRenderTarget(a);
var b=null,c=!1;a?(b=X.get(a).__webglFramebuffer,a.isWebGLRenderTargetCube&&(b=b[a.activeCubeFace],c=!0),ob.copy(a.viewport),V.copy(a.scissor),U=a.scissorTest):(ob.copy(Y).multiplyScalar(R),V.copy(ca).multiplyScalar(R),U=ja);I!==b&&(D.bindFramebuffer(D.FRAMEBUFFER,b),I=b);ba.viewport(ob);ba.scissor(V);ba.setScissorTest(U);c&&(c=X.get(a.texture),D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_CUBE_MAP_POSITIVE_X+a.activeCubeFace,c.__webglTexture,a.activeMipMapLevel))};this.readRenderTargetPixels=
function(a,b,c,d,e,f){if(a&&a.isWebGLRenderTarget){var g=X.get(a).__webglFramebuffer;if(g){var h=!1;g!==I&&(D.bindFramebuffer(D.FRAMEBUFFER,g),h=!0);try{var l=a.texture,m=l.format,n=l.type;1023!==m&&ia.convert(m)!==D.getParameter(D.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===n||ia.convert(n)===D.getParameter(D.IMPLEMENTATION_COLOR_READ_TYPE)||1015===n&&(ka.get("OES_texture_float")||
ka.get("WEBGL_color_buffer_float"))||1016===n&&ka.get("EXT_color_buffer_half_float")?D.checkFramebufferStatus(D.FRAMEBUFFER)===D.FRAMEBUFFER_COMPLETE?0<=b&&b<=a.width-d&&0<=c&&c<=a.height-e&&D.readPixels(b,c,d,e,ia.convert(m),ia.convert(n),f):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{h&&
D.bindFramebuffer(D.FRAMEBUFFER,I)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")};this.copyFramebufferToTexture=function(a,b,c){var d=b.image.width,e=b.image.height,f=ia.convert(b.format);this.setTexture2D(b,0);D.copyTexImage2D(D.TEXTURE_2D,c||0,f,a.x,a.y,d,e,0)};this.copyTextureToTexture=function(a,b,c,d){var e=b.image.width,f=b.image.height,g=ia.convert(c.format),h=ia.convert(c.type);b=b.isDataTexture?b.image.data:b.image;this.setTexture2D(c,
0);D.texSubImage2D(D.TEXTURE_2D,d||0,a.x,a.y,e,f,g,h,b)}}function Ob(a,b){this.name="";this.color=new I(a);this.density=void 0!==b?b:2.5E-4}function Pb(a,b,c){this.name="";this.color=new I(a);this.near=void 0!==b?b:1;this.far=void 0!==c?c:1E3}function rd(){A.call(this);this.type="Scene";this.overrideMaterial=this.fog=this.background=null;this.autoUpdate=!0}function eb(a){O.call(this);this.type="SpriteMaterial";this.color=new I(16777215);this.map=null;this.rotation=0;this.lights=this.fog=!1;this.setValues(a)}
function Ac(a){A.call(this);this.type="Sprite";this.material=void 0!==a?a:new eb;this.center=new C(.5,.5)}function Bc(){A.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Cc(a,b){a=a||[];this.bones=a.slice(0);this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===b)this.calculateInverses();else if(this.bones.length===b.length)this.boneInverses=b.slice(0);else for(console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=
[],a=0,b=this.bones.length;a<b;a++)this.boneInverses.push(new M)}function sd(){A.call(this);this.type="Bone"}function td(a,b){oa.call(this,a,b);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new M;this.bindMatrixInverse=new M;a=this.initBones();a=new Cc(a);this.bind(a,this.matrixWorld);this.normalizeSkinWeights()}function U(a){O.call(this);this.type="LineBasicMaterial";this.color=new I(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.lights=!1;this.setValues(a)}
function ua(a,b,c){if(1===c)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new aa(a,b);A.call(this);this.type="Line";this.geometry=void 0!==a?a:new F;this.material=void 0!==b?b:new U({color:16777215*Math.random()})}function aa(a,b){ua.call(this,a,b);this.type="LineSegments"}function ud(a,b){ua.call(this,a,b);this.type="LineLoop"}function Ha(a){O.call(this);this.type="PointsMaterial";this.color=new I(16777215);this.map=null;this.size=
1;this.sizeAttenuation=!0;this.lights=!1;this.setValues(a)}function Qb(a,b){A.call(this);this.type="Points";this.geometry=void 0!==a?a:new F;this.material=void 0!==b?b:new Ha({color:16777215*Math.random()})}function vd(){A.call(this);this.type="Group"}function Yd(a,b,c,d,e,f,g,h,l){Y.call(this,a,b,c,d,e,f,g,h,l);this.generateMipmaps=!1}function Rb(a,b,c,d,e,f,g,h,l,m,u,n){Y.call(this,null,f,g,h,l,m,d,e,u,n);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1}function Dc(a,
b,c,d,e,f,g,h,l,m){m=void 0!==m?m:1026;if(1026!==m&&1027!==m)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===c&&1026===m&&(c=1012);void 0===c&&1027===m&&(c=1020);Y.call(this,null,d,e,f,g,h,m,c,l);this.image={width:a,height:b};this.magFilter=void 0!==g?g:1003;this.minFilter=void 0!==h?h:1003;this.generateMipmaps=this.flipY=!1}function Sb(a){F.call(this);this.type="WireframeGeometry";var b=[],c,d,e,f=[0,0],g={},h=["a","b","c"];if(a&&a.isGeometry){var l=
a.faces;var m=0;for(d=l.length;m<d;m++){var u=l[m];for(c=0;3>c;c++){var n=u[h[c]];var t=u[h[(c+1)%3]];f[0]=Math.min(n,t);f[1]=Math.max(n,t);n=f[0]+","+f[1];void 0===g[n]&&(g[n]={index1:f[0],index2:f[1]})}}for(n in g)m=g[n],h=a.vertices[m.index1],b.push(h.x,h.y,h.z),h=a.vertices[m.index2],b.push(h.x,h.y,h.z)}else if(a&&a.isBufferGeometry)if(h=new p,null!==a.index){l=a.attributes.position;u=a.index;var k=a.groups;0===k.length&&(k=[{start:0,count:u.count,materialIndex:0}]);a=0;for(e=k.length;a<e;++a)for(m=
k[a],c=m.start,d=m.count,m=c,d=c+d;m<d;m+=3)for(c=0;3>c;c++)n=u.getX(m+c),t=u.getX(m+(c+1)%3),f[0]=Math.min(n,t),f[1]=Math.max(n,t),n=f[0]+","+f[1],void 0===g[n]&&(g[n]={index1:f[0],index2:f[1]});for(n in g)m=g[n],h.fromBufferAttribute(l,m.index1),b.push(h.x,h.y,h.z),h.fromBufferAttribute(l,m.index2),b.push(h.x,h.y,h.z)}else for(l=a.attributes.position,m=0,d=l.count/3;m<d;m++)for(c=0;3>c;c++)g=3*m+c,h.fromBufferAttribute(l,g),b.push(h.x,h.y,h.z),g=3*m+(c+1)%3,h.fromBufferAttribute(l,g),b.push(h.x,
h.y,h.z);this.addAttribute("position",new z(b,3))}function Ec(a,b,c){N.call(this);this.type="ParametricGeometry";this.parameters={func:a,slices:b,stacks:c};this.fromBufferGeometry(new Tb(a,b,c));this.mergeVertices()}function Tb(a,b,c){F.call(this);this.type="ParametricBufferGeometry";this.parameters={func:a,slices:b,stacks:c};var d=[],e=[],f=[],g=[],h=new p,l=new p,m=new p,u=new p,n=new p,t,k,q=b+1;for(t=0;t<=c;t++){var v=t/c;for(k=0;k<=b;k++){var x=k/b;a(x,v,l);e.push(l.x,l.y,l.z);0<=x-1E-5?(a(x-
1E-5,v,m),u.subVectors(l,m)):(a(x+1E-5,v,m),u.subVectors(m,l));0<=v-1E-5?(a(x,v-1E-5,m),n.subVectors(l,m)):(a(x,v+1E-5,m),n.subVectors(m,l));h.crossVectors(u,n).normalize();f.push(h.x,h.y,h.z);g.push(x,v)}}for(t=0;t<c;t++)for(k=0;k<b;k++)a=t*q+k+1,h=(t+1)*q+k+1,l=(t+1)*q+k,d.push(t*q+k,a,l),d.push(a,h,l);this.setIndex(d);this.addAttribute("position",new z(e,3));this.addAttribute("normal",new z(f,3));this.addAttribute("uv",new z(g,2))}function Fc(a,b,c,d){N.call(this);this.type="PolyhedronGeometry";
this.parameters={vertices:a,indices:b,radius:c,detail:d};this.fromBufferGeometry(new pa(a,b,c,d));this.mergeVertices()}function pa(a,b,c,d){function e(a){h.push(a.x,a.y,a.z)}function f(b,c){b*=3;c.x=a[b+0];c.y=a[b+1];c.z=a[b+2]}function g(a,b,c,d){0>d&&1===a.x&&(l[b]=a.x-1);0===c.x&&0===c.z&&(l[b]=d/2/Math.PI+.5)}F.call(this);this.type="PolyhedronBufferGeometry";this.parameters={vertices:a,indices:b,radius:c,detail:d};c=c||1;d=d||0;var h=[],l=[];(function(a){for(var c=new p,d=new p,g=new p,h=0;h<
b.length;h+=3){f(b[h+0],c);f(b[h+1],d);f(b[h+2],g);var l,m,k=c,y=d,w=g,B=Math.pow(2,a),G=[];for(m=0;m<=B;m++){G[m]=[];var K=k.clone().lerp(w,m/B),P=y.clone().lerp(w,m/B),H=B-m;for(l=0;l<=H;l++)G[m][l]=0===l&&m===B?K:K.clone().lerp(P,l/H)}for(m=0;m<B;m++)for(l=0;l<2*(B-m)-1;l++)k=Math.floor(l/2),0===l%2?(e(G[m][k+1]),e(G[m+1][k]),e(G[m][k])):(e(G[m][k+1]),e(G[m+1][k+1]),e(G[m+1][k]))}})(d);(function(a){for(var b=new p,c=0;c<h.length;c+=3)b.x=h[c+0],b.y=h[c+1],b.z=h[c+2],b.normalize().multiplyScalar(a),
h[c+0]=b.x,h[c+1]=b.y,h[c+2]=b.z})(c);(function(){for(var a=new p,b=0;b<h.length;b+=3)a.x=h[b+0],a.y=h[b+1],a.z=h[b+2],l.push(Math.atan2(a.z,-a.x)/2/Math.PI+.5,1-(Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5));a=new p;b=new p;for(var c=new p,d=new p,e=new C,f=new C,k=new C,x=0,y=0;x<h.length;x+=9,y+=6){a.set(h[x+0],h[x+1],h[x+2]);b.set(h[x+3],h[x+4],h[x+5]);c.set(h[x+6],h[x+7],h[x+8]);e.set(l[y+0],l[y+1]);f.set(l[y+2],l[y+3]);k.set(l[y+4],l[y+5]);d.copy(a).add(b).add(c).divideScalar(3);
var w=Math.atan2(d.z,-d.x);g(e,y+0,a,w);g(f,y+2,b,w);g(k,y+4,c,w)}for(a=0;a<l.length;a+=6)b=l[a+0],c=l[a+2],d=l[a+4],e=Math.min(b,c,d),.9<Math.max(b,c,d)&&.1>e&&(.2>b&&(l[a+0]+=1),.2>c&&(l[a+2]+=1),.2>d&&(l[a+4]+=1))})();this.addAttribute("position",new z(h,3));this.addAttribute("normal",new z(h.slice(),3));this.addAttribute("uv",new z(l,2));0===d?this.computeVertexNormals():this.normalizeNormals()}function Gc(a,b){N.call(this);this.type="TetrahedronGeometry";this.parameters={radius:a,detail:b};this.fromBufferGeometry(new Ub(a,
b));this.mergeVertices()}function Ub(a,b){pa.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,b);this.type="TetrahedronBufferGeometry";this.parameters={radius:a,detail:b}}function Hc(a,b){N.call(this);this.type="OctahedronGeometry";this.parameters={radius:a,detail:b};this.fromBufferGeometry(new sb(a,b));this.mergeVertices()}function sb(a,b){pa.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b);this.type="OctahedronBufferGeometry";
this.parameters={radius:a,detail:b}}function Ic(a,b){N.call(this);this.type="IcosahedronGeometry";this.parameters={radius:a,detail:b};this.fromBufferGeometry(new Vb(a,b));this.mergeVertices()}function Vb(a,b){var c=(1+Math.sqrt(5))/2;pa.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type="IcosahedronBufferGeometry";
this.parameters={radius:a,detail:b}}function Jc(a,b){N.call(this);this.type="DodecahedronGeometry";this.parameters={radius:a,detail:b};this.fromBufferGeometry(new Wb(a,b));this.mergeVertices()}function Wb(a,b){var c=(1+Math.sqrt(5))/2,d=1/c;pa.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-d,-c,0,-d,c,0,d,-c,0,d,c,-d,-c,0,-d,c,0,d,-c,0,d,c,0,-c,0,-d,c,0,-d,-c,0,d,c,0,d],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,
0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],a,b);this.type="DodecahedronBufferGeometry";this.parameters={radius:a,detail:b}}function Kc(a,b,c,d,e,f){N.call(this);this.type="TubeGeometry";this.parameters={path:a,tubularSegments:b,radius:c,radialSegments:d,closed:e};void 0!==f&&console.warn("THREE.TubeGeometry: taper has been removed.");a=new Xb(a,b,c,d,e);this.tangents=a.tangents;
this.normals=a.normals;this.binormals=a.binormals;this.fromBufferGeometry(a);this.mergeVertices()}function Xb(a,b,c,d,e){function f(e){u=a.getPointAt(e/b,u);var f=g.normals[e];e=g.binormals[e];for(k=0;k<=d;k++){var m=k/d*Math.PI*2,n=Math.sin(m);m=-Math.cos(m);l.x=m*f.x+n*e.x;l.y=m*f.y+n*e.y;l.z=m*f.z+n*e.z;l.normalize();q.push(l.x,l.y,l.z);h.x=u.x+c*l.x;h.y=u.y+c*l.y;h.z=u.z+c*l.z;r.push(h.x,h.y,h.z)}}F.call(this);this.type="TubeBufferGeometry";this.parameters={path:a,tubularSegments:b,radius:c,radialSegments:d,
closed:e};b=b||64;c=c||1;d=d||8;e=e||!1;var g=a.computeFrenetFrames(b,e);this.tangents=g.tangents;this.normals=g.normals;this.binormals=g.binormals;var h=new p,l=new p,m=new C,u=new p,n,k,r=[],q=[],v=[],x=[];for(n=0;n<b;n++)f(n);f(!1===e?b:0);for(n=0;n<=b;n++)for(k=0;k<=d;k++)m.x=n/b,m.y=k/d,v.push(m.x,m.y);(function(){for(k=1;k<=b;k++)for(n=1;n<=d;n++){var a=(d+1)*k+(n-1),c=(d+1)*k+n,e=(d+1)*(k-1)+n;x.push((d+1)*(k-1)+(n-1),a,e);x.push(a,c,e)}})();this.setIndex(x);this.addAttribute("position",new z(r,
3));this.addAttribute("normal",new z(q,3));this.addAttribute("uv",new z(v,2))}function Lc(a,b,c,d,e,f,g){N.call(this);this.type="TorusKnotGeometry";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f};void 0!==g&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.");this.fromBufferGeometry(new Yb(a,b,c,d,e,f));this.mergeVertices()}function Yb(a,b,c,d,e,f){function g(a,b,c,d,e){var f=Math.sin(a);b=c/b*a;c=Math.cos(b);e.x=d*
(2+c)*.5*Math.cos(a);e.y=d*(2+c)*f*.5;e.z=d*Math.sin(b)*.5}F.call(this);this.type="TorusKnotBufferGeometry";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f};a=a||1;b=b||.4;c=Math.floor(c)||64;d=Math.floor(d)||8;e=e||2;f=f||3;var h=[],l=[],m=[],u=[],n,k=new p,r=new p,q=new p,v=new p,x=new p,y=new p,w=new p;for(n=0;n<=c;++n){var B=n/c*e*Math.PI*2;g(B,e,f,a,q);g(B+.01,e,f,a,v);y.subVectors(v,q);w.addVectors(v,q);x.crossVectors(y,w);w.crossVectors(x,y);x.normalize();w.normalize();
for(B=0;B<=d;++B){var G=B/d*Math.PI*2,K=-b*Math.cos(G);G=b*Math.sin(G);k.x=q.x+(K*w.x+G*x.x);k.y=q.y+(K*w.y+G*x.y);k.z=q.z+(K*w.z+G*x.z);l.push(k.x,k.y,k.z);r.subVectors(k,q).normalize();m.push(r.x,r.y,r.z);u.push(n/c);u.push(B/d)}}for(B=1;B<=c;B++)for(n=1;n<=d;n++)a=(d+1)*B+(n-1),b=(d+1)*B+n,e=(d+1)*(B-1)+n,h.push((d+1)*(B-1)+(n-1),a,e),h.push(a,b,e);this.setIndex(h);this.addAttribute("position",new z(l,3));this.addAttribute("normal",new z(m,3));this.addAttribute("uv",new z(u,2))}function Mc(a,b,
c,d,e){N.call(this);this.type="TorusGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};this.fromBufferGeometry(new Zb(a,b,c,d,e));this.mergeVertices()}function Zb(a,b,c,d,e){F.call(this);this.type="TorusBufferGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};a=a||1;b=b||.4;c=Math.floor(c)||8;d=Math.floor(d)||6;e=e||2*Math.PI;var f=[],g=[],h=[],l=[],m=new p,u=new p,n=new p,k,r;for(k=0;k<=c;k++)for(r=0;r<=d;r++){var q=r/d*e,v=k/c*
Math.PI*2;u.x=(a+b*Math.cos(v))*Math.cos(q);u.y=(a+b*Math.cos(v))*Math.sin(q);u.z=b*Math.sin(v);g.push(u.x,u.y,u.z);m.x=a*Math.cos(q);m.y=a*Math.sin(q);n.subVectors(u,m).normalize();h.push(n.x,n.y,n.z);l.push(r/d);l.push(k/c)}for(k=1;k<=c;k++)for(r=1;r<=d;r++)a=(d+1)*(k-1)+r-1,b=(d+1)*(k-1)+r,e=(d+1)*k+r,f.push((d+1)*k+r-1,a,e),f.push(a,b,e);this.setIndex(f);this.addAttribute("position",new z(g,3));this.addAttribute("normal",new z(h,3));this.addAttribute("uv",new z(l,2))}function Xe(a,b,c,d,e){for(var f,
g=0,h=b,l=c-d;h<c;h+=d)g+=(a[l]-a[h])*(a[h+1]+a[l+1]),l=h;if(e===0<g)for(e=b;e<c;e+=d)f=Ye(e,a[e],a[e+1],f);else for(e=c-d;e>=b;e-=d)f=Ye(e,a[e],a[e+1],f);f&&tb(f,f.next)&&(Nc(f),f=f.next);return f}function Oc(a,b){if(!a)return a;b||(b=a);do{var c=!1;if(a.steiner||!tb(a,a.next)&&0!==ra(a.prev,a,a.next))a=a.next;else{Nc(a);a=b=a.prev;if(a===a.next)break;c=!0}}while(c||a!==b);return b}function Pc(a,b,c,d,e,f,g){if(a){if(!g&&f){var h=a,l=h;do null===l.z&&(l.z=Zd(l.x,l.y,d,e,f)),l.prevZ=l.prev,l=l.nextZ=
l.next;while(l!==h);l.prevZ.nextZ=null;l.prevZ=null;h=l;var m,u,n,k,r=1;do{l=h;var q=h=null;for(u=0;l;){u++;var p=l;for(m=n=0;m<r&&(n++,p=p.nextZ,p);m++);for(k=r;0<n||0<k&&p;)0!==n&&(0===k||!p||l.z<=p.z)?(m=l,l=l.nextZ,n--):(m=p,p=p.nextZ,k--),q?q.nextZ=m:h=m,m.prevZ=q,q=m;l=p}q.nextZ=null;r*=2}while(1<u)}for(h=a;a.prev!==a.next;){l=a.prev;p=a.next;if(f)a:{q=a;k=d;var x=e,y=f;u=q.prev;n=q;r=q.next;if(0<=ra(u,n,r))q=!1;else{var w=u.x>n.x?u.x>r.x?u.x:r.x:n.x>r.x?n.x:r.x,B=u.y>n.y?u.y>r.y?u.y:r.y:n.y>
r.y?n.y:r.y;m=Zd(u.x<n.x?u.x<r.x?u.x:r.x:n.x<r.x?n.x:r.x,u.y<n.y?u.y<r.y?u.y:r.y:n.y<r.y?n.y:r.y,k,x,y);k=Zd(w,B,k,x,y);for(x=q.nextZ;x&&x.z<=k;){if(x!==q.prev&&x!==q.next&&wd(u.x,u.y,n.x,n.y,r.x,r.y,x.x,x.y)&&0<=ra(x.prev,x,x.next)){q=!1;break a}x=x.nextZ}for(x=q.prevZ;x&&x.z>=m;){if(x!==q.prev&&x!==q.next&&wd(u.x,u.y,n.x,n.y,r.x,r.y,x.x,x.y)&&0<=ra(x.prev,x,x.next)){q=!1;break a}x=x.prevZ}q=!0}}else a:if(q=a,u=q.prev,n=q,r=q.next,0<=ra(u,n,r))q=!1;else{for(m=q.next.next;m!==q.prev;){if(wd(u.x,u.y,
n.x,n.y,r.x,r.y,m.x,m.y)&&0<=ra(m.prev,m,m.next)){q=!1;break a}m=m.next}q=!0}if(q)b.push(l.i/c),b.push(a.i/c),b.push(p.i/c),Nc(a),h=a=p.next;else if(a=p,a===h){if(!g)Pc(Oc(a),b,c,d,e,f,1);else if(1===g){g=b;h=c;l=a;do p=l.prev,q=l.next.next,!tb(p,q)&&Ze(p,l,l.next,q)&&Qc(p,q)&&Qc(q,p)&&(g.push(p.i/h),g.push(l.i/h),g.push(q.i/h),Nc(l),Nc(l.next),l=a=q),l=l.next;while(l!==a);a=l;Pc(a,b,c,d,e,f,2)}else if(2===g)a:{g=a;do{for(h=g.next.next;h!==g.prev;){if(l=g.i!==h.i){l=g;p=h;if(q=l.next.i!==p.i&&l.prev.i!==
p.i){b:{q=l;do{if(q.i!==l.i&&q.next.i!==l.i&&q.i!==p.i&&q.next.i!==p.i&&Ze(q,q.next,l,p)){q=!0;break b}q=q.next}while(q!==l);q=!1}q=!q}if(q=q&&Qc(l,p)&&Qc(p,l)){q=l;u=!1;n=(l.x+p.x)/2;p=(l.y+p.y)/2;do q.y>p!==q.next.y>p&&q.next.y!==q.y&&n<(q.next.x-q.x)*(p-q.y)/(q.next.y-q.y)+q.x&&(u=!u),q=q.next;while(q!==l);q=u}l=q}if(l){a=$e(g,h);g=Oc(g,g.next);a=Oc(a,a.next);Pc(g,b,c,d,e,f);Pc(a,b,c,d,e,f);break a}h=h.next}g=g.next}while(g!==a)}break}}}}function Hg(a,b){return a.x-b.x}function Ig(a,b){var c=b,
d=a.x,e=a.y,f=-Infinity;do{if(e<=c.y&&e>=c.next.y&&c.next.y!==c.y){var g=c.x+(e-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(g<=d&&g>f){f=g;if(g===d){if(e===c.y)return c;if(e===c.next.y)return c.next}var h=c.x<c.next.x?c:c.next}}c=c.next}while(c!==b);if(!h)return null;if(d===f)return h.prev;b=h;g=h.x;var l=h.y,m=Infinity;for(c=h.next;c!==b;){if(d>=c.x&&c.x>=g&&d!==c.x&&wd(e<l?d:f,e,g,l,e<l?f:d,e,c.x,c.y)){var u=Math.abs(e-c.y)/(d-c.x);(u<m||u===m&&c.x>h.x)&&Qc(c,a)&&(h=c,m=u)}c=c.next}return h}function Zd(a,
b,c,d,e){a=32767*(a-c)*e;b=32767*(b-d)*e;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1}function Jg(a){var b=a,c=a;do b.x<c.x&&(c=b),b=b.next;while(b!==a);return c}function wd(a,b,c,d,e,f,g,h){return 0<=(e-g)*(b-h)-(a-g)*(f-h)&&0<=(a-g)*(d-h)-(c-g)*(b-h)&&0<=(c-g)*(f-h)-(e-g)*(d-h)}function ra(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function tb(a,b){return a.x===
b.x&&a.y===b.y}function Ze(a,b,c,d){return tb(a,b)&&tb(c,d)||tb(a,d)&&tb(c,b)?!0:0<ra(a,b,c)!==0<ra(a,b,d)&&0<ra(c,d,a)!==0<ra(c,d,b)}function Qc(a,b){return 0>ra(a.prev,a,a.next)?0<=ra(a,b,a.next)&&0<=ra(a,a.prev,b):0>ra(a,b,a.prev)||0>ra(a,a.next,b)}function $e(a,b){var c=new $d(a.i,a.x,a.y),d=new $d(b.i,b.x,b.y),e=a.next,f=b.prev;a.next=b;b.prev=a;c.next=e;e.prev=c;d.next=c;c.prev=d;f.next=d;d.prev=f;return d}function Ye(a,b,c,d){a=new $d(a,b,c);d?(a.next=d.next,a.prev=d,d.next.prev=a,d.next=a):
(a.prev=a,a.next=a);return a}function Nc(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function $d(a,b,c){this.i=a;this.x=b;this.y=c;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function af(a){var b=a.length;2<b&&a[b-1].equals(a[0])&&a.pop()}function bf(a,b){for(var c=0;c<b.length;c++)a.push(b[c].x),a.push(b[c].y)}function fb(a,b){N.call(this);this.type="ExtrudeGeometry";this.parameters={shapes:a,options:b};this.fromBufferGeometry(new Ia(a,
b));this.mergeVertices()}function Ia(a,b){"undefined"!==typeof a&&(F.call(this),this.type="ExtrudeBufferGeometry",a=Array.isArray(a)?a:[a],this.addShapeList(a,b),this.computeVertexNormals())}function Rc(a,b){N.call(this);this.type="TextGeometry";this.parameters={text:a,parameters:b};this.fromBufferGeometry(new $b(a,b));this.mergeVertices()}function $b(a,b){b=b||{};var c=b.font;if(!c||!c.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new N;a=c.generateShapes(a,
b.size,b.curveSegments);b.amount=void 0!==b.height?b.height:50;void 0===b.bevelThickness&&(b.bevelThickness=10);void 0===b.bevelSize&&(b.bevelSize=8);void 0===b.bevelEnabled&&(b.bevelEnabled=!1);Ia.call(this,a,b);this.type="TextBufferGeometry"}function Sc(a,b,c,d,e,f,g){N.call(this);this.type="SphereGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};this.fromBufferGeometry(new ub(a,b,c,d,e,f,g));this.mergeVertices()}function ub(a,
b,c,d,e,f,g){F.call(this);this.type="SphereBufferGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};a=a||1;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;f=void 0!==f?f:0;g=void 0!==g?g:Math.PI;var h=f+g,l,m,u=0,n=[],k=new p,r=new p,q=[],v=[],x=[],y=[];for(m=0;m<=c;m++){var w=[],B=m/c;for(l=0;l<=b;l++){var G=l/b;k.x=-a*Math.cos(d+G*e)*Math.sin(f+B*g);k.y=a*Math.cos(f+B*g);
k.z=a*Math.sin(d+G*e)*Math.sin(f+B*g);v.push(k.x,k.y,k.z);r.set(k.x,k.y,k.z).normalize();x.push(r.x,r.y,r.z);y.push(G,1-B);w.push(u++)}n.push(w)}for(m=0;m<c;m++)for(l=0;l<b;l++)a=n[m][l+1],d=n[m][l],e=n[m+1][l],g=n[m+1][l+1],(0!==m||0<f)&&q.push(a,d,g),(m!==c-1||h<Math.PI)&&q.push(d,e,g);this.setIndex(q);this.addAttribute("position",new z(v,3));this.addAttribute("normal",new z(x,3));this.addAttribute("uv",new z(y,2))}function Tc(a,b,c,d,e,f){N.call(this);this.type="RingGeometry";this.parameters={innerRadius:a,
outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};this.fromBufferGeometry(new ac(a,b,c,d,e,f));this.mergeVertices()}function ac(a,b,c,d,e,f){F.call(this);this.type="RingBufferGeometry";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};a=a||.5;b=b||1;e=void 0!==e?e:0;f=void 0!==f?f:2*Math.PI;c=void 0!==c?Math.max(3,c):8;d=void 0!==d?Math.max(1,d):1;var g=[],h=[],l=[],m=[],k=a,n=(b-a)/d,t=new p,r=new C,q,v;for(q=0;q<=d;q++){for(v=
0;v<=c;v++)a=e+v/c*f,t.x=k*Math.cos(a),t.y=k*Math.sin(a),h.push(t.x,t.y,t.z),l.push(0,0,1),r.x=(t.x/b+1)/2,r.y=(t.y/b+1)/2,m.push(r.x,r.y);k+=n}for(q=0;q<d;q++)for(b=q*(c+1),v=0;v<c;v++)a=v+b,e=a+c+1,f=a+c+2,k=a+1,g.push(a,e,k),g.push(e,f,k);this.setIndex(g);this.addAttribute("position",new z(h,3));this.addAttribute("normal",new z(l,3));this.addAttribute("uv",new z(m,2))}function Uc(a,b,c,d){N.call(this);this.type="LatheGeometry";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};this.fromBufferGeometry(new bc(a,
b,c,d));this.mergeVertices()}function bc(a,b,c,d){F.call(this);this.type="LatheBufferGeometry";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};b=Math.floor(b)||12;c=c||0;d=d||2*Math.PI;d=S.clamp(d,0,2*Math.PI);var e=[],f=[],g=[],h=1/b,l=new p,m=new C,k;for(k=0;k<=b;k++){var n=c+k*h*d;var t=Math.sin(n),r=Math.cos(n);for(n=0;n<=a.length-1;n++)l.x=a[n].x*t,l.y=a[n].y,l.z=a[n].x*r,f.push(l.x,l.y,l.z),m.x=k/b,m.y=n/(a.length-1),g.push(m.x,m.y)}for(k=0;k<b;k++)for(n=0;n<a.length-1;n++)c=n+
k*a.length,h=c+a.length,l=c+a.length+1,m=c+1,e.push(c,h,m),e.push(h,l,m);this.setIndex(e);this.addAttribute("position",new z(f,3));this.addAttribute("uv",new z(g,2));this.computeVertexNormals();if(d===2*Math.PI)for(d=this.attributes.normal.array,e=new p,f=new p,g=new p,c=b*a.length*3,n=k=0;k<a.length;k++,n+=3)e.x=d[n+0],e.y=d[n+1],e.z=d[n+2],f.x=d[c+n+0],f.y=d[c+n+1],f.z=d[c+n+2],g.addVectors(e,f).normalize(),d[n+0]=d[c+n+0]=g.x,d[n+1]=d[c+n+1]=g.y,d[n+2]=d[c+n+2]=g.z}function vb(a,b){N.call(this);
this.type="ShapeGeometry";"object"===typeof b&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),b=b.curveSegments);this.parameters={shapes:a,curveSegments:b};this.fromBufferGeometry(new wb(a,b));this.mergeVertices()}function wb(a,b){function c(a){var c,h=e.length/3;a=a.extractPoints(b);var m=a.shape,k=a.holes;if(!1===Xa.isClockWise(m))for(m=m.reverse(),a=0,c=k.length;a<c;a++){var u=k[a];!0===Xa.isClockWise(u)&&(k[a]=u.reverse())}var p=Xa.triangulateShape(m,k);a=0;for(c=k.length;a<
c;a++)u=k[a],m=m.concat(u);a=0;for(c=m.length;a<c;a++)u=m[a],e.push(u.x,u.y,0),f.push(0,0,1),g.push(u.x,u.y);a=0;for(c=p.length;a<c;a++)m=p[a],d.push(m[0]+h,m[1]+h,m[2]+h),l+=3}F.call(this);this.type="ShapeBufferGeometry";this.parameters={shapes:a,curveSegments:b};b=b||12;var d=[],e=[],f=[],g=[],h=0,l=0;if(!1===Array.isArray(a))c(a);else for(var m=0;m<a.length;m++)c(a[m]),this.addGroup(h,l,m),h+=l,l=0;this.setIndex(d);this.addAttribute("position",new z(e,3));this.addAttribute("normal",new z(f,3));
this.addAttribute("uv",new z(g,2))}function cf(a,b){b.shapes=[];if(Array.isArray(a))for(var c=0,d=a.length;c<d;c++)b.shapes.push(a[c].uuid);else b.shapes.push(a.uuid);return b}function cc(a,b){F.call(this);this.type="EdgesGeometry";this.parameters={thresholdAngle:b};var c=[];b=Math.cos(S.DEG2RAD*(void 0!==b?b:1));var d=[0,0],e={},f=["a","b","c"];if(a.isBufferGeometry){var g=new N;g.fromBufferGeometry(a)}else g=a.clone();g.mergeVertices();g.computeFaceNormals();a=g.vertices;g=g.faces;for(var h=0,l=
g.length;h<l;h++)for(var m=g[h],k=0;3>k;k++){var n=m[f[k]];var t=m[f[(k+1)%3]];d[0]=Math.min(n,t);d[1]=Math.max(n,t);n=d[0]+","+d[1];void 0===e[n]?e[n]={index1:d[0],index2:d[1],face1:h,face2:void 0}:e[n].face2=h}for(n in e)if(d=e[n],void 0===d.face2||g[d.face1].normal.dot(g[d.face2].normal)<=b)f=a[d.index1],c.push(f.x,f.y,f.z),f=a[d.index2],c.push(f.x,f.y,f.z);this.addAttribute("position",new z(c,3))}function xb(a,b,c,d,e,f,g,h){N.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:a,
radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};this.fromBufferGeometry(new Ya(a,b,c,d,e,f,g,h));this.mergeVertices()}function Ya(a,b,c,d,e,f,g,h){function l(c){var e,f=new C,l=new p,u=0,v=!0===c?a:b,w=!0===c?1:-1;var A=q;for(e=1;e<=d;e++)n.push(0,x*w,0),t.push(0,w,0),r.push(.5,.5),q++;var z=q;for(e=0;e<=d;e++){var E=e/d*h+g,F=Math.cos(E);E=Math.sin(E);l.x=v*E;l.y=x*w;l.z=v*F;n.push(l.x,l.y,l.z);t.push(0,w,0);f.x=.5*F+.5;f.y=.5*E*w+.5;r.push(f.x,f.y);
q++}for(e=0;e<d;e++)f=A+e,l=z+e,!0===c?k.push(l,l+1,f):k.push(l+1,l,f),u+=3;m.addGroup(y,u,!0===c?1:2);y+=u}F.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};var m=this;a=void 0!==a?a:1;b=void 0!==b?b:1;c=c||1;d=Math.floor(d)||8;e=Math.floor(e)||1;f=void 0!==f?f:!1;g=void 0!==g?g:0;h=void 0!==h?h:2*Math.PI;var k=[],n=[],t=[],r=[],q=0,v=[],x=c/2,y=0;(function(){var f,l,u=new p,
K=new p,P=0,H=(b-a)/c;for(l=0;l<=e;l++){var C=[],A=l/e,z=A*(b-a)+a;for(f=0;f<=d;f++){var E=f/d,F=E*h+g,I=Math.sin(F);F=Math.cos(F);K.x=z*I;K.y=-A*c+x;K.z=z*F;n.push(K.x,K.y,K.z);u.set(I,H,F).normalize();t.push(u.x,u.y,u.z);r.push(E,1-A);C.push(q++)}v.push(C)}for(f=0;f<d;f++)for(l=0;l<e;l++)u=v[l+1][f],K=v[l+1][f+1],H=v[l][f+1],k.push(v[l][f],u,H),k.push(u,K,H),P+=6;m.addGroup(y,P,0);y+=P})();!1===f&&(0<a&&l(!0),0<b&&l(!1));this.setIndex(k);this.addAttribute("position",new z(n,3));this.addAttribute("normal",
new z(t,3));this.addAttribute("uv",new z(r,2))}function Vc(a,b,c,d,e,f,g){xb.call(this,0,a,b,c,d,e,f,g);this.type="ConeGeometry";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,openEnded:e,thetaStart:f,thetaLength:g}}function Wc(a,b,c,d,e,f,g){Ya.call(this,0,a,b,c,d,e,f,g);this.type="ConeBufferGeometry";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,openEnded:e,thetaStart:f,thetaLength:g}}function Xc(a,b,c,d){N.call(this);this.type="CircleGeometry";this.parameters=
{radius:a,segments:b,thetaStart:c,thetaLength:d};this.fromBufferGeometry(new dc(a,b,c,d));this.mergeVertices()}function dc(a,b,c,d){F.call(this);this.type="CircleBufferGeometry";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d};a=a||1;b=void 0!==b?Math.max(3,b):8;c=void 0!==c?c:0;d=void 0!==d?d:2*Math.PI;var e=[],f=[],g=[],h=[],l,m=new p,k=new C;f.push(0,0,0);g.push(0,0,1);h.push(.5,.5);var n=0;for(l=3;n<=b;n++,l+=3){var t=c+n/b*d;m.x=a*Math.cos(t);m.y=a*Math.sin(t);f.push(m.x,m.y,
m.z);g.push(0,0,1);k.x=(f[l]/a+1)/2;k.y=(f[l+1]/a+1)/2;h.push(k.x,k.y)}for(l=1;l<=b;l++)e.push(l,l+1,0);this.setIndex(e);this.addAttribute("position",new z(f,3));this.addAttribute("normal",new z(g,3));this.addAttribute("uv",new z(h,2))}function yb(a){O.call(this);this.type="ShadowMaterial";this.color=new I(0);this.transparent=!0;this.setValues(a)}function ec(a){va.call(this,a);this.type="RawShaderMaterial"}function Sa(a){O.call(this);this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=
new I(16777215);this.metalness=this.roughness=.5;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new I(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new C(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=
1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function zb(a){Sa.call(this);this.defines={PHYSICAL:""};this.type="MeshPhysicalMaterial";this.reflectivity=.5;this.clearCoatRoughness=this.clearCoat=0;this.setValues(a)}function Ja(a){O.call(this);this.type="MeshPhongMaterial";this.color=new I(16777215);this.specular=new I(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=
1;this.emissive=new I(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new C(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}
function Ab(a){Ja.call(this);this.defines={TOON:""};this.type="MeshToonMaterial";this.gradientMap=null;this.setValues(a)}function Bb(a){O.call(this);this.type="MeshNormalMaterial";this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new C(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.lights=this.fog=!1;this.setValues(a)}function Cb(a){O.call(this);
this.type="MeshLambertMaterial";this.color=new I(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new I(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function Db(a){U.call(this);
this.type="LineDashedMaterial";this.scale=1;this.dashSize=3;this.gapSize=1;this.setValues(a)}function ae(a,b,c){var d=this,e=!1,f=0,g=0,h=void 0;this.onStart=void 0;this.onLoad=a;this.onProgress=b;this.onError=c;this.itemStart=function(a){g++;if(!1===e&&void 0!==d.onStart)d.onStart(a,f,g);e=!0};this.itemEnd=function(a){f++;if(void 0!==d.onProgress)d.onProgress(a,f,g);if(f===g&&(e=!1,void 0!==d.onLoad))d.onLoad()};this.itemError=function(a){if(void 0!==d.onError)d.onError(a)};this.resolveURL=function(a){return h?
h(a):a};this.setURLModifier=function(a){h=a;return this}}function Ka(a){this.manager=void 0!==a?a:ma}function df(a){this.manager=void 0!==a?a:ma;this._parser=null}function be(a){this.manager=void 0!==a?a:ma;this._parser=null}function Yc(a){this.manager=void 0!==a?a:ma}function ce(a){this.manager=void 0!==a?a:ma}function xd(a){this.manager=void 0!==a?a:ma}function E(){this.type="Curve";this.arcLengthDivisions=200}function ia(a,b,c,d,e,f,g,h){E.call(this);this.type="EllipseCurve";this.aX=a||0;this.aY=
b||0;this.xRadius=c||1;this.yRadius=d||1;this.aStartAngle=e||0;this.aEndAngle=f||2*Math.PI;this.aClockwise=g||!1;this.aRotation=h||0}function fc(a,b,c,d,e,f){ia.call(this,a,b,c,c,d,e,f);this.type="ArcCurve"}function de(){var a=0,b=0,c=0,d=0;return{initCatmullRom:function(e,f,g,h,l){e=l*(g-e);h=l*(h-f);a=f;b=e;c=-3*f+3*g-2*e-h;d=2*f-2*g+e+h},initNonuniformCatmullRom:function(e,f,g,h,l,m,k){e=((f-e)/l-(g-e)/(l+m)+(g-f)/m)*m;h=((g-f)/m-(h-f)/(m+k)+(h-g)/k)*m;a=f;b=e;c=-3*f+3*g-2*e-h;d=2*f-2*g+e+h},calc:function(e){var f=
e*e;return a+b*e+c*f+d*f*e}}}function X(a,b,c,d){E.call(this);this.type="CatmullRomCurve3";this.points=a||[];this.closed=b||!1;this.curveType=c||"centripetal";this.tension=d||.5}function ef(a,b,c,d,e){b=.5*(d-b);e=.5*(e-c);var f=a*a;return(2*c-2*d+b+e)*a*f+(-3*c+3*d-2*b-e)*f+b*a+c}function Zc(a,b,c,d){var e=1-a;return e*e*b+2*(1-a)*a*c+a*a*d}function $c(a,b,c,d,e){var f=1-a,g=1-a;return f*f*f*b+3*g*g*a*c+3*(1-a)*a*a*d+a*a*a*e}function La(a,b,c,d){E.call(this);this.type="CubicBezierCurve";this.v0=
a||new C;this.v1=b||new C;this.v2=c||new C;this.v3=d||new C}function Ta(a,b,c,d){E.call(this);this.type="CubicBezierCurve3";this.v0=a||new p;this.v1=b||new p;this.v2=c||new p;this.v3=d||new p}function wa(a,b){E.call(this);this.type="LineCurve";this.v1=a||new C;this.v2=b||new C}function Ma(a,b){E.call(this);this.type="LineCurve3";this.v1=a||new p;this.v2=b||new p}function Na(a,b,c){E.call(this);this.type="QuadraticBezierCurve";this.v0=a||new C;this.v1=b||new C;this.v2=c||new C}function Ua(a,b,c){E.call(this);
this.type="QuadraticBezierCurve3";this.v0=a||new p;this.v1=b||new p;this.v2=c||new p}function Oa(a){E.call(this);this.type="SplineCurve";this.points=a||[]}function Za(){E.call(this);this.type="CurvePath";this.curves=[];this.autoClose=!1}function Pa(a){Za.call(this);this.type="Path";this.currentPoint=new C;a&&this.setFromPoints(a)}function gb(a){Pa.call(this,a);this.uuid=S.generateUUID();this.type="Shape";this.holes=[]}function ca(a,b){A.call(this);this.type="Light";this.color=new I(a);this.intensity=
void 0!==b?b:1;this.receiveShadow=void 0}function yd(a,b,c){ca.call(this,a,c);this.type="HemisphereLight";this.castShadow=void 0;this.position.copy(A.DefaultUp);this.updateMatrix();this.groundColor=new I(b)}function Eb(a){this.camera=a;this.bias=0;this.radius=1;this.mapSize=new C(512,512);this.map=null;this.matrix=new M}function zd(){Eb.call(this,new la(50,1,.5,500))}function Ad(a,b,c,d,e,f){ca.call(this,a,b);this.type="SpotLight";this.position.copy(A.DefaultUp);this.updateMatrix();this.target=new A;
Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(a){this.intensity=a/Math.PI}});this.distance=void 0!==c?c:0;this.angle=void 0!==d?d:Math.PI/3;this.penumbra=void 0!==e?e:0;this.decay=void 0!==f?f:1;this.shadow=new zd}function Bd(a,b,c,d){ca.call(this,a,b);this.type="PointLight";Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(a){this.intensity=a/(4*Math.PI)}});this.distance=void 0!==c?c:0;this.decay=void 0!==
d?d:1;this.shadow=new Eb(new la(90,1,.5,500))}function Cd(){Eb.call(this,new Jb(-5,5,5,-5,.5,500))}function Dd(a,b){ca.call(this,a,b);this.type="DirectionalLight";this.position.copy(A.DefaultUp);this.updateMatrix();this.target=new A;this.shadow=new Cd}function Ed(a,b){ca.call(this,a,b);this.type="AmbientLight";this.castShadow=void 0}function Fd(a,b,c,d){ca.call(this,a,b);this.type="RectAreaLight";this.width=void 0!==c?c:10;this.height=void 0!==d?d:10}function Gd(a,b,c,d){da.call(this,a,b,c,d)}function Hd(a,
b,c){da.call(this,a,b,c)}function na(a,b,c,d){this.parameterPositions=a;this._cachedIndex=0;this.resultBuffer=void 0!==d?d:new b.constructor(c);this.sampleValues=b;this.valueSize=c}function Id(a,b,c,d){na.call(this,a,b,c,d)}function ad(a,b,c,d){da.call(this,a,b,c,d)}function Jd(a,b,c,d){da.call(this,a,b,c,d)}function gc(a,b,c,d){da.call(this,a,b,c,d)}function Kd(a,b,c,d){na.call(this,a,b,c,d);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function bd(a,b,c,d){na.call(this,
a,b,c,d)}function Ld(a,b,c,d){na.call(this,a,b,c,d)}function da(a,b,c,d){if(void 0===a)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===b||0===b.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+a);this.name=a;this.times=fa.convertArray(b,this.TimeBufferType);this.values=fa.convertArray(c,this.ValueBufferType);this.setInterpolation(d||this.DefaultInterpolation);this.validate();this.optimize()}function hc(a,b,c,d){da.call(this,a,b,c,d)}function Ba(a,b,c){this.name=
a;this.tracks=c;this.duration=void 0!==b?b:-1;this.uuid=S.generateUUID();0>this.duration&&this.resetDuration();this.optimize()}function Md(a){this.manager=void 0!==a?a:ma;this.textures={}}function ee(a){this.manager=void 0!==a?a:ma}function ic(){}function fe(a){"boolean"===typeof a&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),a=void 0);this.manager=void 0!==a?a:ma;this.withCredentials=!1}function ff(a){this.manager=void 0!==a?a:ma;this.texturePath=""}
function ge(a){"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported.");"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported.");this.manager=void 0!==a?a:ma;this.options=void 0}function he(){this.type="ShapePath";this.subPaths=[];this.currentPath=null}function ie(a){this.type="Font";this.data=a}function gf(a){this.manager=void 0!==a?a:ma}function je(a){this.manager=void 0!==a?a:ma}function hf(){this.type=
"StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=new la;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new la;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=!1}function cd(a,b,c){A.call(this);this.type="CubeCamera";var d=new la(90,1,a,b);d.up.set(0,-1,0);d.lookAt(new p(1,0,0));this.add(d);var e=new la(90,1,a,b);e.up.set(0,-1,0);e.lookAt(new p(-1,0,0));this.add(e);var f=new la(90,1,a,b);f.up.set(0,0,1);f.lookAt(new p(0,1,0));this.add(f);var g=new la(90,
1,a,b);g.up.set(0,0,-1);g.lookAt(new p(0,-1,0));this.add(g);var h=new la(90,1,a,b);h.up.set(0,-1,0);h.lookAt(new p(0,0,1));this.add(h);var l=new la(90,1,a,b);l.up.set(0,-1,0);l.lookAt(new p(0,0,-1));this.add(l);this.renderTarget=new Ib(c,c,{format:1022,magFilter:1006,minFilter:1006});this.renderTarget.texture.name="CubeCamera";this.update=function(a,b){null===this.parent&&this.updateMatrixWorld();var c=this.renderTarget,m=c.texture.generateMipmaps;c.texture.generateMipmaps=!1;c.activeCubeFace=0;a.render(b,
d,c);c.activeCubeFace=1;a.render(b,e,c);c.activeCubeFace=2;a.render(b,f,c);c.activeCubeFace=3;a.render(b,g,c);c.activeCubeFace=4;a.render(b,h,c);c.texture.generateMipmaps=m;c.activeCubeFace=5;a.render(b,l,c);a.setRenderTarget(null)};this.clear=function(a,b,c,d){for(var e=this.renderTarget,f=0;6>f;f++)e.activeCubeFace=f,a.setRenderTarget(e),a.clear(b,c,d);a.setRenderTarget(null)}}function ke(){A.call(this);this.type="AudioListener";this.context=le.getContext();this.gain=this.context.createGain();this.gain.connect(this.context.destination);
this.filter=null}function jc(a){A.call(this);this.type="Audio";this.context=a.context;this.gain=this.context.createGain();this.gain.connect(a.getInput());this.autoplay=!1;this.buffer=null;this.loop=!1;this.offset=this.startTime=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.sourceType="empty";this.filters=[]}function me(a){jc.call(this,a);this.panner=this.context.createPanner();this.panner.connect(this.gain)}function ne(a,b){this.analyser=a.context.createAnalyser();this.analyser.fftSize=
void 0!==b?b:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);a.getOutput().connect(this.analyser)}function oe(a,b,c){this.binding=a;this.valueSize=c;a=Float64Array;switch(b){case "quaternion":b=this._slerp;break;case "string":case "bool":a=Array;b=this._select;break;default:b=this._lerp}this.buffer=new a(4*c);this._mixBufferRegion=b;this.referenceCount=this.useCount=this.cumulativeWeight=0}function jf(a,b,c){c=c||qa.parseTrackName(b);this._targetGroup=a;this._bindings=a.subscribe_(b,
c)}function qa(a,b,c){this.path=b;this.parsedPath=c||qa.parseTrackName(b);this.node=qa.findNode(a,this.parsedPath.nodeName)||a;this.rootNode=a}function kf(){this.uuid=S.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var a={};this._indicesByUUID=a;for(var b=0,c=arguments.length;b!==c;++b)a[arguments[b].uuid]=b;this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var d=this;this.stats={objects:{get total(){return d._objects.length},
get inUse(){return this.total-d.nCachedObjects_}},get bindingsPerObject(){return d._bindings.length}}}function lf(a,b,c){this._mixer=a;this._clip=b;this._localRoot=c||null;a=b.tracks;b=a.length;c=Array(b);for(var d={endingStart:2400,endingEnd:2400},e=0;e!==b;++e){var f=a[e].createInterpolant(null);c[e]=f;f.settings=d}this._interpolantSettings=d;this._interpolants=c;this._propertyBindings=Array(b);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=
2201;this._loopCount=-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function pe(a){this._root=a;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1}function Nd(a,b){"string"===typeof a&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),a=b);this.value=a}function qe(){F.call(this);
this.type="InstancedBufferGeometry";this.maxInstancedCount=void 0}function re(a,b,c,d){this.data=a;this.itemSize=b;this.offset=c;this.normalized=!0===d}function kc(a,b){this.array=a;this.stride=b;this.count=void 0!==a?a.length/b:0;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0}function se(a,b,c){kc.call(this,a,b);this.meshPerAttribute=c||1}function te(a,b,c){T.call(this,a,b);this.meshPerAttribute=c||1}function mf(a,b,c,d){this.ray=new qb(a,b);this.near=c||0;this.far=d||Infinity;
this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})}function nf(a,b){return a.distance-b.distance}function ue(a,b,c,d){if(!1!==a.visible&&(a.raycast(b,c),!0===d)){a=a.children;d=0;for(var e=a.length;d<e;d++)ue(a[d],b,c,!0)}}function of(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=
0;this.running=!1}function pf(a,b,c){this.radius=void 0!==a?a:1;this.phi=void 0!==b?b:0;this.theta=void 0!==c?c:0;return this}function qf(a,b,c){this.radius=void 0!==a?a:1;this.theta=void 0!==b?b:0;this.y=void 0!==c?c:0;return this}function ve(a,b){this.min=void 0!==a?a:new C(Infinity,Infinity);this.max=void 0!==b?b:new C(-Infinity,-Infinity)}function dd(a){A.call(this);this.material=a;this.render=function(){}}function ed(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16711680;d=void 0!==
d?d:1;b=0;(c=this.object.geometry)&&c.isGeometry?b=3*c.faces.length:c&&c.isBufferGeometry&&(b=c.attributes.normal.count);c=new F;b=new z(6*b,3);c.addAttribute("position",b);aa.call(this,c,new U({color:a,linewidth:d}));this.matrixAutoUpdate=!1;this.update()}function lc(a,b){A.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.color=b;a=new F;b=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var c=0,d=1;32>c;c++,d++){var e=
c/32*Math.PI*2,f=d/32*Math.PI*2;b.push(Math.cos(e),Math.sin(e),1,Math.cos(f),Math.sin(f),1)}a.addAttribute("position",new z(b,3));b=new U({fog:!1});this.cone=new aa(a,b);this.add(this.cone);this.update()}function rf(a){var b=[];a&&a.isBone&&b.push(a);for(var c=0;c<a.children.length;c++)b.push.apply(b,rf(a.children[c]));return b}function mc(a){for(var b=rf(a),c=new F,d=[],e=[],f=new I(0,0,1),g=new I(0,1,0),h=0;h<b.length;h++){var l=b[h];l.parent&&l.parent.isBone&&(d.push(0,0,0),d.push(0,0,0),e.push(f.r,
f.g,f.b),e.push(g.r,g.g,g.b))}c.addAttribute("position",new z(d,3));c.addAttribute("color",new z(e,3));d=new U({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});aa.call(this,c,d);this.root=a;this.bones=b;this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1}function nc(a,b,c){this.light=a;this.light.updateMatrixWorld();this.color=c;a=new ub(b,4,2);b=new za({wireframe:!0,fog:!1});oa.call(this,a,b);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1;this.update()}function oc(a,b){A.call(this);
this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.color=b;a=new U({fog:!1});b=new F;b.addAttribute("position",new T(new Float32Array(15),3));this.line=new ua(b,a);this.add(this.line);this.update()}function pc(a,b,c){A.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.color=c;a=new sb(b);a.rotateY(.5*Math.PI);this.material=new za({wireframe:!0,fog:!1});void 0===this.color&&(this.material.vertexColors=
2);b=a.getAttribute("position");b=new Float32Array(3*b.count);a.addAttribute("color",new T(b,3));this.add(new oa(a,this.material));this.update()}function fd(a,b,c,d){a=a||10;b=b||10;c=new I(void 0!==c?c:4473924);d=new I(void 0!==d?d:8947848);var e=b/2,f=a/b,g=a/2;a=[];for(var h=[],l=0,m=0,k=-g;l<=b;l++,k+=f){a.push(-g,0,k,g,0,k);a.push(k,0,-g,k,0,g);var n=l===e?c:d;n.toArray(h,m);m+=3;n.toArray(h,m);m+=3;n.toArray(h,m);m+=3;n.toArray(h,m);m+=3}b=new F;b.addAttribute("position",new z(a,3));b.addAttribute("color",
new z(h,3));c=new U({vertexColors:2});aa.call(this,b,c)}function Od(a,b,c,d,e,f){a=a||10;b=b||16;c=c||8;d=d||64;e=new I(void 0!==e?e:4473924);f=new I(void 0!==f?f:8947848);var g=[],h=[],l;for(l=0;l<=b;l++){var m=l/b*2*Math.PI;var k=Math.sin(m)*a;m=Math.cos(m)*a;g.push(0,0,0);g.push(k,0,m);var n=l&1?e:f;h.push(n.r,n.g,n.b);h.push(n.r,n.g,n.b)}for(l=0;l<=c;l++){n=l&1?e:f;var t=a-a/c*l;for(b=0;b<d;b++)m=b/d*2*Math.PI,k=Math.sin(m)*t,m=Math.cos(m)*t,g.push(k,0,m),h.push(n.r,n.g,n.b),m=(b+1)/d*2*Math.PI,
k=Math.sin(m)*t,m=Math.cos(m)*t,g.push(k,0,m),h.push(n.r,n.g,n.b)}a=new F;a.addAttribute("position",new z(g,3));a.addAttribute("color",new z(h,3));g=new U({vertexColors:2});aa.call(this,a,g)}function gd(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16776960;d=void 0!==d?d:1;b=0;(c=this.object.geometry)&&c.isGeometry?b=c.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");c=new F;b=new z(6*b,3);c.addAttribute("position",
b);aa.call(this,c,new U({color:a,linewidth:d}));this.matrixAutoUpdate=!1;this.update()}function qc(a,b,c){A.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.color=c;void 0===b&&(b=1);a=new F;a.addAttribute("position",new z([-b,b,0,b,b,0,b,-b,0,-b,-b,0,-b,b,0],3));b=new U({fog:!1});this.lightPlane=new ua(a,b);this.add(this.lightPlane);a=new F;a.addAttribute("position",new z([0,0,0,0,0,1],3));this.targetLine=new ua(a,b);this.add(this.targetLine);
this.update()}function hd(a){function b(a,b,d){c(a,d);c(b,d)}function c(a,b){f.push(0,0,0);g.push(b.r,b.g,b.b);void 0===h[a]&&(h[a]=[]);h[a].push(f.length/3-1)}var d=new F,e=new U({color:16777215,vertexColors:1}),f=[],g=[],h={},l=new I(16755200),m=new I(16711680),k=new I(43775),n=new I(16777215),t=new I(3355443);b("n1","n2",l);b("n2","n4",l);b("n4","n3",l);b("n3","n1",l);b("f1","f2",l);b("f2","f4",l);b("f4","f3",l);b("f3","f1",l);b("n1","f1",l);b("n2","f2",l);b("n3","f3",l);b("n4","f4",l);b("p","n1",
m);b("p","n2",m);b("p","n3",m);b("p","n4",m);b("u1","u2",k);b("u2","u3",k);b("u3","u1",k);b("c","t",n);b("p","c",t);b("cn1","cn2",t);b("cn3","cn4",t);b("cf1","cf2",t);b("cf3","cf4",t);d.addAttribute("position",new z(f,3));d.addAttribute("color",new z(g,3));aa.call(this,d,e);this.camera=a;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=h;this.update()}function Fb(a,b){this.object=a;void 0===b&&(b=16776960);a=
new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var c=new Float32Array(24),d=new F;d.setIndex(new T(a,1));d.addAttribute("position",new T(c,3));aa.call(this,d,new U({color:b}));this.matrixAutoUpdate=!1;this.update()}function id(a,b){this.type="Box3Helper";this.box=a;a=void 0!==b?b:16776960;b=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var c=new F;c.setIndex(new T(b,1));c.addAttribute("position",new z([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,
-1,-1],3));aa.call(this,c,new U({color:a}));this.geometry.computeBoundingSphere()}function jd(a,b,c){this.type="PlaneHelper";this.plane=a;this.size=void 0===b?1:b;a=void 0!==c?c:16776960;b=new F;b.addAttribute("position",new z([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3));b.computeBoundingSphere();ua.call(this,b,new U({color:a}));b=new F;b.addAttribute("position",new z([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3));b.computeBoundingSphere();this.add(new oa(b,new za({color:a,
opacity:.2,transparent:!0,depthWrite:!1})))}function Gb(a,b,c,d,e,f){A.call(this);void 0===d&&(d=16776960);void 0===c&&(c=1);void 0===e&&(e=.2*c);void 0===f&&(f=.2*e);void 0===Pd&&(Pd=new F,Pd.addAttribute("position",new z([0,0,0,0,1,0],3)),we=new Ya(0,.5,1,5,1),we.translate(0,-.5,0));this.position.copy(b);this.line=new ua(Pd,new U({color:d}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new oa(we,new za({color:d}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(a);
this.setLength(c,e,f)}function kd(a){a=a||1;var b=[0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a];a=new F;a.addAttribute("position",new z(b,3));a.addAttribute("color",new z([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));b=new U({vertexColors:2});aa.call(this,a,b)}function sf(a){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");X.call(this,a);this.type="catmullrom";this.closed=!0}function tf(a){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");
X.call(this,a);this.type="catmullrom"}function xe(a){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead.");X.call(this,a);this.type="catmullrom"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Number.isInteger&&(Number.isInteger=function(a){return"number"===typeof a&&isFinite(a)&&Math.floor(a)===a});void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});!1==="name"in Function.prototype&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}});
void 0===Object.assign&&function(){Object.assign=function(a){if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(void 0!==d&&null!==d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(b[e]=d[e])}return b}}();Object.assign(xa.prototype,{addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&c[a].push(b)},
hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)},removeEventListener:function(a,b){void 0!==this._listeners&&(a=this._listeners[a],void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1)))},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;b=b.slice(0);for(var c=0,d=b.length;c<d;c++)b[c].call(this,a)}}}});var S={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var a=
[],b=0;256>b;b++)a[b]=(16>b?"0":"")+b.toString(16).toUpperCase();return function(){var b=4294967295*Math.random()|0,d=4294967295*Math.random()|0,e=4294967295*Math.random()|0,f=4294967295*Math.random()|0;return a[b&255]+a[b>>8&255]+a[b>>16&255]+a[b>>24&255]+"-"+a[d&255]+a[d>>8&255]+"-"+a[d>>16&15|64]+a[d>>24&255]+"-"+a[e&63|128]+a[e>>8&255]+"-"+a[e>>16&255]+a[e>>24&255]+a[f&255]+a[f>>8&255]+a[f>>16&255]+a[f>>24&255]}}(),clamp:function(a,b,c){return Math.max(b,Math.min(c,a))},euclideanModulo:function(a,
b){return(a%b+b)%b},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},lerp:function(a,b,c){return(1-c)*a+c*b},smoothstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(a){return a*
S.DEG2RAD},radToDeg:function(a){return a*S.RAD2DEG},isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},ceilPowerOfTwo:function(a){return Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},floorPowerOfTwo:function(a){return Math.pow(2,Math.floor(Math.log(a)/Math.LN2))}};Object.defineProperties(C.prototype,{width:{get:function(){return this.x},set:function(a){this.x=a}},height:{get:function(){return this.y},set:function(a){this.y=a}}});Object.assign(C.prototype,{isVector2:!0,set:function(a,b){this.x=a;this.y=
b;return this},setScalar:function(a){this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(a){this.x=
a.x;this.y=a.y;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},applyMatrix3:function(a){var b=this.x,c=this.y;a=a.elements;this.x=a[0]*b+a[3]*c+a[6];this.y=
a[1]*b+a[4]*c+a[7];return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));return this},clampScalar:function(){var a=new C,b=new C;return function(c,d){a.set(c,c);b.set(d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.divideScalar(c||
1).multiplyScalar(Math.max(a,Math.min(b,c)))},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*
a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var a=Math.atan2(this.y,this.x);0>a&&(a+=2*Math.PI);return a},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},manhattanDistanceTo:function(a){return Math.abs(this.x-
a.x)+Math.abs(this.y-a.y)},setLength:function(a){return this.normalize().multiplyScalar(a)},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromBufferAttribute:function(a,
b,c){void 0!==c&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute().");this.x=a.getX(b);this.y=a.getY(b);return this},rotateAround:function(a,b){var c=Math.cos(b);b=Math.sin(b);var d=this.x-a.x,e=this.y-a.y;this.x=d*c-e*b+a.x;this.y=d*b+e*c+a.y;return this}});Object.assign(M.prototype,{isMatrix4:!0,set:function(a,b,c,d,e,f,g,h,l,m,k,n,t,r,q,p){var u=this.elements;u[0]=a;u[4]=b;u[8]=c;u[12]=d;u[1]=e;u[5]=f;u[9]=g;u[13]=h;u[2]=l;u[6]=m;u[10]=k;u[14]=n;u[3]=t;u[7]=r;u[11]=
q;u[15]=p;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new M).fromArray(this.elements)},copy:function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return this},copyPosition:function(a){var b=this.elements;a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,
b,c){a.setFromMatrixColumn(this,0);b.setFromMatrixColumn(this,1);c.setFromMatrixColumn(this,2);return this},makeBasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var a=new p;return function(b){var c=this.elements,d=b.elements,e=1/a.setFromMatrixColumn(b,0).length(),f=1/a.setFromMatrixColumn(b,1).length();b=1/a.setFromMatrixColumn(b,2).length();c[0]=d[0]*e;c[1]=d[1]*e;c[2]=d[2]*e;c[4]=d[4]*f;c[5]=d[5]*f;c[6]=d[6]*f;c[8]=d[8]*b;
c[9]=d[9]*b;c[10]=d[10]*b;return this}}(),makeRotationFromEuler:function(a){a&&a.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c);c=Math.sin(c);var g=Math.cos(d);d=Math.sin(d);var h=Math.cos(e);e=Math.sin(e);if("XYZ"===a.order){a=f*h;var l=f*e,m=c*h,k=c*e;b[0]=g*h;b[4]=-g*e;b[8]=d;b[1]=l+m*d;b[5]=a-k*d;b[9]=-c*g;b[2]=k-a*d;b[6]=m+l*d;b[10]=f*g}else"YXZ"===a.order?(a=g*
h,l=g*e,m=d*h,k=d*e,b[0]=a+k*c,b[4]=m*c-l,b[8]=f*d,b[1]=f*e,b[5]=f*h,b[9]=-c,b[2]=l*c-m,b[6]=k+a*c,b[10]=f*g):"ZXY"===a.order?(a=g*h,l=g*e,m=d*h,k=d*e,b[0]=a-k*c,b[4]=-f*e,b[8]=m+l*c,b[1]=l+m*c,b[5]=f*h,b[9]=k-a*c,b[2]=-f*d,b[6]=c,b[10]=f*g):"ZYX"===a.order?(a=f*h,l=f*e,m=c*h,k=c*e,b[0]=g*h,b[4]=m*d-l,b[8]=a*d+k,b[1]=g*e,b[5]=k*d+a,b[9]=l*d-m,b[2]=-d,b[6]=c*g,b[10]=f*g):"YZX"===a.order?(a=f*g,l=f*d,m=c*g,k=c*d,b[0]=g*h,b[4]=k-a*e,b[8]=m*e+l,b[1]=e,b[5]=f*h,b[9]=-c*h,b[2]=-d*h,b[6]=l*e+m,b[10]=a-k*
e):"XZY"===a.order&&(a=f*g,l=f*d,m=c*g,k=c*d,b[0]=g*h,b[4]=-e,b[8]=d*h,b[1]=a*e+k,b[5]=f*h,b[9]=l*e-m,b[2]=m*e-l,b[6]=c*h,b[10]=k*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},makeRotationFromQuaternion:function(a){var b=this.elements,c=a._x,d=a._y,e=a._z,f=a._w,g=c+c,h=d+d,l=e+e;a=c*g;var m=c*h;c*=l;var k=d*h;d*=l;e*=l;g*=f;h*=f;f*=l;b[0]=1-(k+e);b[4]=m-f;b[8]=c+h;b[1]=m+f;b[5]=1-(a+e);b[9]=d-g;b[2]=c-h;b[6]=d+g;b[10]=1-(a+k);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=
0;b[15]=1;return this},lookAt:function(){var a=new p,b=new p,c=new p;return function(d,e,f){var g=this.elements;c.subVectors(d,e);0===c.lengthSq()&&(c.z=1);c.normalize();a.crossVectors(f,c);0===a.lengthSq()&&(1===Math.abs(f.z)?c.x+=1E-4:c.z+=1E-4,c.normalize(),a.crossVectors(f,c));a.normalize();b.crossVectors(c,a);g[0]=a.x;g[4]=b.x;g[8]=c.x;g[1]=a.y;g[5]=b.y;g[9]=c.y;g[2]=a.z;g[6]=b.z;g[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==b?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),
this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements;b=this.elements;a=c[0];var e=c[4],f=c[8],g=c[12],h=c[1],l=c[5],m=c[9],k=c[13],n=c[2],t=c[6],r=c[10],q=c[14],p=c[3],x=c[7],y=c[11];c=c[15];var w=d[0],B=d[4],G=d[8],K=d[12],P=d[1],H=d[5],C=d[9],A=d[13],z=d[2],E=d[6],F=d[10],I=d[14],L=d[3],Q=d[7],N=d[11];d=d[15];b[0]=a*w+e*P+f*z+g*L;b[4]=a*B+e*H+f*E+g*Q;b[8]=a*G+e*C+f*F+
g*N;b[12]=a*K+e*A+f*I+g*d;b[1]=h*w+l*P+m*z+k*L;b[5]=h*B+l*H+m*E+k*Q;b[9]=h*G+l*C+m*F+k*N;b[13]=h*K+l*A+m*I+k*d;b[2]=n*w+t*P+r*z+q*L;b[6]=n*B+t*H+r*E+q*Q;b[10]=n*G+t*C+r*F+q*N;b[14]=n*K+t*A+r*I+q*d;b[3]=p*w+x*P+y*z+c*L;b[7]=p*B+x*H+y*E+c*Q;b[11]=p*G+x*C+y*F+c*N;b[15]=p*K+x*A+y*I+c*d;return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},applyToBufferAttribute:function(){var a=
new p;return function(b){for(var c=0,d=b.count;c<d;c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix4(this),b.setXYZ(c,a.x,a.y,a.z);return b}}(),determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],l=a[13],m=a[2],k=a[6],n=a[10],t=a[14];return a[3]*(+e*h*k-d*l*k-e*g*n+c*l*n+d*g*t-c*h*t)+a[7]*(+b*h*t-b*l*n+e*f*n-d*f*t+d*l*m-e*h*m)+a[11]*(+b*l*k-b*g*t-e*f*k+c*f*t+e*g*m-c*l*m)+a[15]*(-d*g*m-b*h*k+b*g*n+d*f*k-c*f*n+c*h*m)},transpose:function(){var a=this.elements;
var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements,d=a.elements;a=d[0];var e=d[1],f=d[2],g=d[3],h=d[4],l=d[5],m=d[6],k=d[7],n=d[8],t=d[9],r=d[10],q=d[11],p=d[12],x=d[13],y=d[14];d=d[15];var w=t*y*k-x*r*k+x*m*q-l*y*q-t*m*d+l*r*d,B=p*r*k-n*y*k-p*m*q+h*y*
q+n*m*d-h*r*d,G=n*x*k-p*t*k+p*l*q-h*x*q-n*l*d+h*t*d,K=p*t*m-n*x*m-p*l*r+h*x*r+n*l*y-h*t*y,P=a*w+e*B+f*G+g*K;if(0===P){if(!0===b)throw Error("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0");console.warn("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0");return this.identity()}b=1/P;c[0]=w*b;c[1]=(x*r*g-t*y*g-x*f*q+e*y*q+t*f*d-e*r*d)*b;c[2]=(l*y*g-x*m*g+x*f*k-e*y*k-l*f*d+e*m*d)*b;c[3]=(t*m*g-l*r*g-t*f*k+e*r*k+l*f*q-e*m*q)*b;c[4]=B*b;c[5]=(n*y*g-p*r*g+p*f*q-a*
y*q-n*f*d+a*r*d)*b;c[6]=(p*m*g-h*y*g-p*f*k+a*y*k+h*f*d-a*m*d)*b;c[7]=(h*r*g-n*m*g+n*f*k-a*r*k-h*f*q+a*m*q)*b;c[8]=G*b;c[9]=(p*t*g-n*x*g-p*e*q+a*x*q+n*e*d-a*t*d)*b;c[10]=(h*x*g-p*l*g+p*e*k-a*x*k-h*e*d+a*l*d)*b;c[11]=(n*l*g-h*t*g-n*e*k+a*t*k+h*e*q-a*l*q)*b;c[12]=K*b;c[13]=(n*x*f-p*t*f+p*e*r-a*x*r-n*e*y+a*t*y)*b;c[14]=(p*l*f-h*x*f-p*e*m+a*x*m+h*e*y-a*l*y)*b;c[15]=(h*t*f-n*l*f+n*e*m-a*t*m-h*e*r+a*l*r)*b;return this},scale:function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=
c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);
this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b);b=Math.sin(b);var d=1-c,e=a.x,f=a.y;a=a.z;var g=d*e,h=d*f;this.set(g*e+c,g*f-b*a,g*a+b*f,0,g*f+b*a,h*f+c,h*a-b*e,0,g*a-b*f,h*a+b*e,d*a*a+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},makeShear:function(a,b,c){this.set(1,b,
c,0,a,1,c,0,a,b,1,0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a=new p,b=new M;return function(c,d,e){var f=this.elements,g=a.set(f[0],f[1],f[2]).length(),h=a.set(f[4],f[5],f[6]).length(),l=a.set(f[8],f[9],f[10]).length();0>this.determinant()&&(g=-g);c.x=f[12];c.y=f[13];c.z=f[14];b.copy(this);c=1/g;f=1/h;var m=1/l;b.elements[0]*=c;b.elements[1]*=c;b.elements[2]*=c;b.elements[4]*=f;b.elements[5]*=
f;b.elements[6]*=f;b.elements[8]*=m;b.elements[9]*=m;b.elements[10]*=m;d.setFromRotationMatrix(b);e.x=g;e.y=h;e.z=l;return this}}(),makePerspective:function(a,b,c,d,e,f){void 0===f&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var g=this.elements;g[0]=2*e/(b-a);g[4]=0;g[8]=(b+a)/(b-a);g[12]=0;g[1]=0;g[5]=2*e/(c-d);g[9]=(c+d)/(c-d);g[13]=0;g[2]=0;g[6]=0;g[10]=-(f+e)/(f-e);g[14]=-2*f*e/(f-e);g[3]=0;g[7]=0;g[11]=-1;g[15]=0;return this},
makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=1/(b-a),l=1/(c-d),m=1/(f-e);g[0]=2*h;g[4]=0;g[8]=0;g[12]=-((b+a)*h);g[1]=0;g[5]=2*l;g[9]=0;g[13]=-((c+d)*l);g[2]=0;g[6]=0;g[10]=-2*m;g[14]=-((f+e)*m);g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this},equals:function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0},fromArray:function(a,b){void 0===b&&(b=0);for(var c=0;16>c;c++)this.elements[c]=a[c+b];return this},toArray:function(a,b){void 0===a&&(a=[]);
void 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a}});Object.assign(ja,{slerp:function(a,b,c,d){return c.copy(a).slerp(b,d)},slerpFlat:function(a,b,c,d,e,f,g){var h=c[d+0],l=c[d+1],m=c[d+2];c=c[d+3];d=e[f+0];var k=e[f+1],n=e[f+2];e=e[f+3];if(c!==e||h!==d||l!==k||m!==n){f=1-g;var p=h*d+l*k+m*n+c*e,r=0<=
p?1:-1,q=1-p*p;q>Number.EPSILON&&(q=Math.sqrt(q),p=Math.atan2(q,p*r),f=Math.sin(f*p)/q,g=Math.sin(g*p)/q);r*=g;h=h*f+d*r;l=l*f+k*r;m=m*f+n*r;c=c*f+e*r;f===1-g&&(g=1/Math.sqrt(h*h+l*l+m*m+c*c),h*=g,l*=g,m*=g,c*=g)}a[b]=h;a[b+1]=l;a[b+2]=m;a[b+3]=c}});Object.defineProperties(ja.prototype,{x:{get:function(){return this._x},set:function(a){this._x=a;this.onChangeCallback()}},y:{get:function(){return this._y},set:function(a){this._y=a;this.onChangeCallback()}},z:{get:function(){return this._z},set:function(a){this._z=
a;this.onChangeCallback()}},w:{get:function(){return this._w},set:function(a){this._w=a;this.onChangeCallback()}}});Object.assign(ja.prototype,{set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!a||!a.isEuler)throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");
var c=a._x,d=a._y,e=a._z;a=a.order;var f=Math.cos,g=Math.sin,h=f(c/2),l=f(d/2);f=f(e/2);c=g(c/2);d=g(d/2);e=g(e/2);"XYZ"===a?(this._x=c*l*f+h*d*e,this._y=h*d*f-c*l*e,this._z=h*l*e+c*d*f,this._w=h*l*f-c*d*e):"YXZ"===a?(this._x=c*l*f+h*d*e,this._y=h*d*f-c*l*e,this._z=h*l*e-c*d*f,this._w=h*l*f+c*d*e):"ZXY"===a?(this._x=c*l*f-h*d*e,this._y=h*d*f+c*l*e,this._z=h*l*e+c*d*f,this._w=h*l*f-c*d*e):"ZYX"===a?(this._x=c*l*f-h*d*e,this._y=h*d*f+c*l*e,this._z=h*l*e-c*d*f,this._w=h*l*f+c*d*e):"YZX"===a?(this._x=
c*l*f+h*d*e,this._y=h*d*f+c*l*e,this._z=h*l*e-c*d*f,this._w=h*l*f-c*d*e):"XZY"===a&&(this._x=c*l*f-h*d*e,this._y=h*d*f-c*l*e,this._z=h*l*e+c*d*f,this._w=h*l*f+c*d*e);if(!1!==b)this.onChangeCallback();return this},setFromAxisAngle:function(a,b){b/=2;var c=Math.sin(b);this._x=a.x*c;this._y=a.y*c;this._z=a.z*c;this._w=Math.cos(b);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var d=b[8],e=b[1],f=b[5],g=b[9],h=b[2],l=b[6];b=b[10];var m=c+f+b;0<m?
(c=.5/Math.sqrt(m+1),this._w=.25/c,this._x=(l-g)*c,this._y=(d-h)*c,this._z=(e-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this._w=(l-g)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+h)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this._w=(d-h)/c,this._x=(a+e)/c,this._y=.25*c,this._z=(g+l)/c):(c=2*Math.sqrt(1+b-c-f),this._w=(e-a)/c,this._x=(d+h)/c,this._y=(g+l)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a=new p,b;return function(c,d){void 0===a&&(a=new p);b=c.dot(d)+1;1E-6>b?
(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;return this.normalize()}}(),inverse:function(){return this.conjugate()},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*
this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},premultiply:function(a){return this.multiplyQuaternions(a,
this)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z;a=a._w;var f=b._x,g=b._y,h=b._z;b=b._w;this._x=c*b+a*f+d*h-e*g;this._y=d*b+a*g+e*f-c*h;this._z=e*b+a*h+c*g-d*f;this._w=a*b-c*f-d*g-e*h;this.onChangeCallback();return this},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a);if(1<=g)return this._w=f,this._x=c,this._y=
d,this._z=e,this;a=Math.sqrt(1-g*g);if(.001>Math.abs(a))return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;var h=Math.atan2(a,g);g=Math.sin((1-b)*h)/a;b=Math.sin(b*h)/a;this._w=f*g+this._w*b;this._x=c*g+this._x*b;this._y=d*g+this._y*b;this._z=e*g+this._z*b;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+
1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}});Object.assign(p.prototype,{isVector3:!0,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setScalar:function(a){this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=
a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},
add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=
a;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a=new ja;return function(b){b&&b.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");return this.applyQuaternion(a.setFromEuler(b))}}(),applyAxisAngle:function(){var a=new ja;return function(b,c){return this.applyQuaternion(a.setFromAxisAngle(b,c))}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;
a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*e;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=a.w;var h=a*b+f*d-g*c,l=a*c+g*b-e*d,m=a*d+e*c-f*b;b=-e*b-f*c-g*d;this.x=h*a+b*
-e+l*-g-m*-f;this.y=l*a+b*-f+m*-e-h*-g;this.z=m*a+b*-g+h*-f-l*-e;return this},project:function(){var a=new M;return function(b){a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyMatrix4(a)}}(),unproject:function(){var a=new M;return function(b){a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyMatrix4(a)}}(),transformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+
a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;return this.normalize()},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,
this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this},clampScalar:function(){var a=new p,b=new p;return function(c,d){a.set(c,c,c);b.set(d,d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(a,Math.min(b,c)))},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},
round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},
length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(a){return this.normalize().multiplyScalar(a)},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},cross:function(a,b){return void 0!==
b?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b)):this.crossVectors(this,a)},crossVectors:function(a,b){var c=a.x,d=a.y;a=a.z;var e=b.x,f=b.y;b=b.z;this.x=d*b-a*f;this.y=a*e-c*b;this.z=c*f-d*e;return this},projectOnVector:function(a){var b=a.dot(this)/a.lengthSq();return this.copy(a).multiplyScalar(b)},projectOnPlane:function(){var a=new p;return function(b){a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a=
new p;return function(b){return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/Math.sqrt(this.lengthSq()*a.lengthSq());return Math.acos(S.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},manhattanDistanceTo:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)},setFromSpherical:function(a){var b=Math.sin(a.phi)*
a.radius;this.x=b*Math.sin(a.theta);this.y=Math.cos(a.phi)*a.radius;this.z=b*Math.cos(a.theta);return this},setFromCylindrical:function(a){this.x=a.radius*Math.sin(a.theta);this.y=a.y;this.z=a.radius*Math.cos(a.theta);return this},setFromMatrixPosition:function(a){a=a.elements;this.x=a[12];this.y=a[13];this.z=a[14];return this},setFromMatrixScale:function(a){var b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,1).length();a=this.setFromMatrixColumn(a,2).length();this.x=b;this.y=
c;this.z=a;return this},setFromMatrixColumn:function(a,b){return this.fromArray(a.elements,4*b)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromBufferAttribute:function(a,b,c){void 0!==c&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute().");
this.x=a.getX(b);this.y=a.getY(b);this.z=a.getZ(b);return this}});Object.assign(sa.prototype,{isMatrix3:!0,set:function(a,b,c,d,e,f,g,h,l){var m=this.elements;m[0]=a;m[1]=d;m[2]=g;m[3]=b;m[4]=e;m[5]=h;m[6]=c;m[7]=f;m[8]=l;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=
a[8];return this},setFromMatrix4:function(a){a=a.elements;this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]);return this},applyToBufferAttribute:function(){var a=new p;return function(b){for(var c=0,d=b.count;c<d;c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix3(this),b.setXYZ(c,a.x,a.y,a.z);return b}}(),multiply:function(a){return this.multiplyMatrices(this,a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements;
b=this.elements;a=c[0];var e=c[3],f=c[6],g=c[1],h=c[4],l=c[7],m=c[2],k=c[5];c=c[8];var n=d[0],p=d[3],r=d[6],q=d[1],v=d[4],x=d[7],y=d[2],w=d[5];d=d[8];b[0]=a*n+e*q+f*y;b[3]=a*p+e*v+f*w;b[6]=a*r+e*x+f*d;b[1]=g*n+h*q+l*y;b[4]=g*p+h*v+l*w;b[7]=g*r+h*x+l*d;b[2]=m*n+k*q+c*y;b[5]=m*p+k*v+c*w;b[8]=m*r+k*x+c*d;return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],
d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],l=a[7];a=a[8];return b*f*a-b*g*l-c*e*a+c*g*h+d*e*l-d*f*h},getInverse:function(a,b){a&&a.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var c=a.elements;a=this.elements;var d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],l=c[5],m=c[6],k=c[7];c=c[8];var n=c*h-l*k,p=l*m-c*g,r=k*g-h*m,q=d*n+e*p+f*r;if(0===q){if(!0===b)throw Error("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0");console.warn("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0");
return this.identity()}b=1/q;a[0]=n*b;a[1]=(f*k-c*e)*b;a[2]=(l*e-f*h)*b;a[3]=p*b;a[4]=(c*d-f*m)*b;a[5]=(f*g-l*d)*b;a[6]=r*b;a[7]=(e*m-k*d)*b;a[8]=(h*d-e*g)*b;return this},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},getNormalMatrix:function(a){return this.setFromMatrix4(a).getInverse(this).transpose()},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=
b[2];a[7]=b[5];a[8]=b[8];return this},setUvTransform:function(a,b,c,d,e,f,g){var h=Math.cos(e);e=Math.sin(e);this.set(c*h,c*e,-c*(h*f+e*g)+f+a,-d*e,d*h,-d*(-e*f+h*g)+g+b,0,0,1)},scale:function(a,b){var c=this.elements;c[0]*=a;c[3]*=a;c[6]*=a;c[1]*=b;c[4]*=b;c[7]*=b;return this},rotate:function(a){var b=Math.cos(a);a=Math.sin(a);var c=this.elements,d=c[0],e=c[3],f=c[6],g=c[1],h=c[4],l=c[7];c[0]=b*d+a*g;c[3]=b*e+a*h;c[6]=b*f+a*l;c[1]=-a*d+b*g;c[4]=-a*e+b*h;c[7]=-a*f+b*l;return this},translate:function(a,
b){var c=this.elements;c[0]+=a*c[2];c[3]+=a*c[5];c[6]+=a*c[8];c[1]+=b*c[2];c[4]+=b*c[5];c[7]+=b*c[8];return this},equals:function(a){var b=this.elements;a=a.elements;for(var c=0;9>c;c++)if(b[c]!==a[c])return!1;return!0},fromArray:function(a,b){void 0===b&&(b=0);for(var c=0;9>c;c++)this.elements[c]=a[c+b];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];
return a}});var xf=0;Y.DEFAULT_IMAGE=void 0;Y.DEFAULT_MAPPING=300;Y.prototype=Object.assign(Object.create(xa.prototype),{constructor:Y,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.name=a.name;this.image=a.image;this.mipmaps=a.mipmaps.slice(0);this.mapping=a.mapping;this.wrapS=a.wrapS;this.wrapT=a.wrapT;this.magFilter=a.magFilter;this.minFilter=a.minFilter;this.anisotropy=a.anisotropy;this.format=a.format;this.type=a.type;this.offset.copy(a.offset);this.repeat.copy(a.repeat);
this.center.copy(a.center);this.rotation=a.rotation;this.matrixAutoUpdate=a.matrixAutoUpdate;this.matrix.copy(a.matrix);this.generateMipmaps=a.generateMipmaps;this.premultiplyAlpha=a.premultiplyAlpha;this.flipY=a.flipY;this.unpackAlignment=a.unpackAlignment;this.encoding=a.encoding;return this},toJSON:function(a){var b=void 0===a||"string"===typeof a;if(!b&&void 0!==a.textures[this.uuid])return a.textures[this.uuid];var c={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,
name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var d=this.image;void 0===d.uuid&&(d.uuid=S.generateUUID());if(!b&&void 0===a.images[d.uuid]){var e=a.images,f=d.uuid,g=d.uuid;if(d instanceof HTMLCanvasElement)var h=
d;else{h=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");h.width=d.width;h.height=d.height;var l=h.getContext("2d");d instanceof ImageData?l.putImageData(d,0,0):l.drawImage(d,0,0,d.width,d.height)}h=2048<h.width||2048<h.height?h.toDataURL("image/jpeg",.6):h.toDataURL("image/png");e[f]={uuid:g,url:h}}c.image=d.uuid}b||(a.textures[this.uuid]=c);return c},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(a){if(300===this.mapping){a.applyMatrix3(this.matrix);
if(0>a.x||1<a.x)switch(this.wrapS){case 1E3:a.x-=Math.floor(a.x);break;case 1001:a.x=0>a.x?0:1;break;case 1002:a.x=1===Math.abs(Math.floor(a.x)%2)?Math.ceil(a.x)-a.x:a.x-Math.floor(a.x)}if(0>a.y||1<a.y)switch(this.wrapT){case 1E3:a.y-=Math.floor(a.y);break;case 1001:a.y=0>a.y?0:1;break;case 1002:a.y=1===Math.abs(Math.floor(a.y)%2)?Math.ceil(a.y)-a.y:a.y-Math.floor(a.y)}this.flipY&&(a.y=1-a.y)}}});Object.defineProperty(Y.prototype,"needsUpdate",{set:function(a){!0===a&&this.version++}});Object.assign(ea.prototype,
{isVector4:!0,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setScalar:function(a){this.w=this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a);}return this},getComponent:function(a){switch(a){case 0:return this.x;
case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},
addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;this.w+=a.w*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=
a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*e;this.z=a[2]*b+a[6]*c+a[10]*d+a[14]*e;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e;return this},divideScalar:function(a){return this.multiplyScalar(1/
a)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){a=a.elements;var b=a[0];var c=a[4];var d=a[8],e=a[1],f=a[5],g=a[9];var h=a[2];var l=a[6];var m=a[10];if(.01>Math.abs(c-e)&&.01>Math.abs(d-h)&&.01>Math.abs(g-l)){if(.1>Math.abs(c+e)&&.1>Math.abs(d+h)&&.1>Math.abs(g+l)&&.1>Math.abs(b+f+m-3))return this.set(1,0,0,0),this;a=Math.PI;
b=(b+1)/2;f=(f+1)/2;m=(m+1)/2;c=(c+e)/4;d=(d+h)/4;g=(g+l)/4;b>f&&b>m?.01>b?(l=0,c=h=.707106781):(l=Math.sqrt(b),h=c/l,c=d/l):f>m?.01>f?(l=.707106781,h=0,c=.707106781):(h=Math.sqrt(f),l=c/h,c=g/h):.01>m?(h=l=.707106781,c=0):(c=Math.sqrt(m),l=d/c,h=g/c);this.set(l,h,c,a);return this}a=Math.sqrt((l-g)*(l-g)+(d-h)*(d-h)+(e-c)*(e-c));.001>Math.abs(a)&&(a=1);this.x=(l-g)/a;this.y=(d-h)/a;this.z=(e-c)/a;this.w=Math.acos((b+f+m-1)/2);return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,
a.y);this.z=Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));this.w=Math.max(a.w,Math.min(b.w,this.w));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new ea,b=new ea);a.set(c,
c,c,c);b.set(d,d,d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(a,Math.min(b,c)))},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);
this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*
this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(a){return this.normalize().multiplyScalar(a)},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,
b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromBufferAttribute:function(a,b,c){void 0!==c&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute().");
this.x=a.getX(b);this.y=a.getY(b);this.z=a.getZ(b);this.w=a.getW(b);return this}});hb.prototype=Object.assign(Object.create(xa.prototype),{constructor:hb,isWebGLRenderTarget:!0,setSize:function(a,b){if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.dispose();this.viewport.set(0,0,a,b);this.scissor.set(0,0,a,b)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.width=a.width;this.height=a.height;this.viewport.copy(a.viewport);this.texture=a.texture.clone();
this.depthBuffer=a.depthBuffer;this.stencilBuffer=a.stencilBuffer;this.depthTexture=a.depthTexture;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Ib.prototype=Object.create(hb.prototype);Ib.prototype.constructor=Ib;Ib.prototype.isWebGLRenderTargetCube=!0;ib.prototype=Object.create(Y.prototype);ib.prototype.constructor=ib;ib.prototype.isDataTexture=!0;Object.assign(Va.prototype,{isBox3:!0,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromArray:function(a){for(var b=
Infinity,c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=-Infinity,h=0,l=a.length;h<l;h+=3){var m=a[h],k=a[h+1],n=a[h+2];m<b&&(b=m);k<c&&(c=k);n<d&&(d=n);m>e&&(e=m);k>f&&(f=k);n>g&&(g=n)}this.min.set(b,c,d);this.max.set(e,f,g);return this},setFromBufferAttribute:function(a){for(var b=Infinity,c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=-Infinity,h=0,l=a.count;h<l;h++){var m=a.getX(h),k=a.getY(h),n=a.getZ(h);m<b&&(b=m);k<c&&(c=k);n<d&&(d=n);m>e&&(e=m);k>f&&(f=k);n>g&&(g=n)}this.min.set(b,c,d);
this.max.set(e,f,g);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new p;return function(b,c){c=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(c);this.max.copy(b).add(c);return this}}(),setFromObject:function(a){this.makeEmpty();return this.expandByObject(a)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},
makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(a){void 0===a&&(console.warn("THREE.Box3: .getCenter() target is now required"),a=new p);return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){void 0===a&&(console.warn("THREE.Box3: .getSize() target is now required"),
a=new p);return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},expandByObject:function(){function a(a){var f=a.geometry;if(void 0!==f)if(f.isGeometry)for(f=f.vertices,c=0,d=f.length;c<d;c++)e.copy(f[c]),e.applyMatrix4(a.matrixWorld),b.expandByPoint(e);else if(f.isBufferGeometry&&
(f=f.attributes.position,void 0!==f))for(c=0,d=f.count;c<d;c++)e.fromBufferAttribute(f,c).applyMatrix4(a.matrixWorld),b.expandByPoint(e)}var b,c,d,e=new p;return function(c){b=this;c.updateMatrixWorld(!0);c.traverse(a);return this}}(),containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&
a.max.z<=this.max.z},getParameter:function(a,b){void 0===b&&(console.warn("THREE.Box3: .getParameter() target is now required"),b=new p);return b.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0},intersectsSphere:function(){var a=new p;return function(b){this.clampPoint(b.center,
a);return a.distanceToSquared(b.center)<=b.radius*b.radius}}(),intersectsPlane:function(a){if(0<a.normal.x){var b=a.normal.x*this.min.x;var c=a.normal.x*this.max.x}else b=a.normal.x*this.max.x,c=a.normal.x*this.min.x;0<a.normal.y?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y);0<a.normal.z?(b+=a.normal.z*this.min.z,c+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z);return b<=a.constant&&c>=a.constant},intersectsTriangle:function(){function a(a){var e;
var f=0;for(e=a.length-3;f<=e;f+=3){h.fromArray(a,f);var g=m.x*Math.abs(h.x)+m.y*Math.abs(h.y)+m.z*Math.abs(h.z),l=b.dot(h),k=c.dot(h),n=d.dot(h);if(Math.max(-Math.max(l,k,n),Math.min(l,k,n))>g)return!1}return!0}var b=new p,c=new p,d=new p,e=new p,f=new p,g=new p,h=new p,l=new p,m=new p,k=new p;return function(h){if(this.isEmpty())return!1;this.getCenter(l);m.subVectors(this.max,l);b.subVectors(h.a,l);c.subVectors(h.b,l);d.subVectors(h.c,l);e.subVectors(c,b);f.subVectors(d,c);g.subVectors(b,d);h=
[0,-e.z,e.y,0,-f.z,f.y,0,-g.z,g.y,e.z,0,-e.x,f.z,0,-f.x,g.z,0,-g.x,-e.y,e.x,0,-f.y,f.x,0,-g.y,g.x,0];if(!a(h))return!1;h=[1,0,0,0,1,0,0,0,1];if(!a(h))return!1;k.crossVectors(e,f);h=[k.x,k.y,k.z];return a(h)}}(),clampPoint:function(a,b){void 0===b&&(console.warn("THREE.Box3: .clampPoint() target is now required"),b=new p);return b.copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new p;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=
new p;return function(b){void 0===b&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),b=new Ea);this.getCenter(b.center);b.radius=.5*this.getSize(a).length();return b}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);this.isEmpty()&&this.makeEmpty();return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new p,new p,new p,new p,new p,new p,new p,new p];return function(b){if(this.isEmpty())return this;
a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.setFromPoints(a);return this}}(),
translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}});Object.assign(Ea.prototype,{set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new Va;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).getCenter(d);for(var e=c=0,f=b.length;e<f;e++)c=Math.max(c,d.distanceToSquared(b[e]));this.radius=Math.sqrt(c);return this}}(),clone:function(){return(new this.constructor).copy(this)},
copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},intersectsBox:function(a){return a.intersectsSphere(this)},intersectsPlane:function(a){return Math.abs(a.distanceToPoint(this.center))<=
this.radius},clampPoint:function(a,b){var c=this.center.distanceToSquared(a);void 0===b&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),b=new p);b.copy(a);c>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center));return b},getBoundingBox:function(a){void 0===a&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),a=new Va);a.set(this.center,this.center);a.expandByScalar(this.radius);return a},applyMatrix4:function(a){this.center.applyMatrix4(a);
this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius}});Object.assign(Fa.prototype,{set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=
new p,b=new p;return function(c,d,e){d=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,c);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+
this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){void 0===b&&(console.warn("THREE.Plane: .projectPoint() target is now required"),b=new p);return b.copy(this.normal).multiplyScalar(-this.distanceToPoint(a)).add(a)},intersectLine:function(){var a=new p;return function(b,c){void 0===c&&(console.warn("THREE.Plane: .intersectLine() target is now required"),c=new p);var d=b.delta(a),e=this.normal.dot(d);if(0===e){if(0===this.distanceToPoint(b.start))return c.copy(b.start)}else if(e=
-(b.start.dot(this.normal)+this.constant)/e,!(0>e||1<e))return c.copy(d).multiplyScalar(e).add(b.start)}}(),intersectsLine:function(a){var b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectsBox:function(a){return a.intersectsPlane(this)},intersectsSphere:function(a){return a.intersectsPlane(this)},coplanarPoint:function(a){void 0===a&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),a=new p);return a.copy(this.normal).multiplyScalar(-this.constant)},
applyMatrix4:function(){var a=new p,b=new sa;return function(c,d){d=d||b.getNormalMatrix(c);c=this.coplanarPoint(a).applyMatrix4(c);d=this.normal.applyMatrix3(d).normalize();this.constant=-c.dot(d);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&a.constant===this.constant}});Object.assign(ld.prototype,{set:function(a,b,c,d,e,f){var g=this.planes;g[0].copy(a);g[1].copy(b);g[2].copy(c);g[3].copy(d);g[4].copy(e);
g[5].copy(f);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var b=this.planes,c=0;6>c;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements;a=c[0];var d=c[1],e=c[2],f=c[3],g=c[4],h=c[5],l=c[6],m=c[7],k=c[8],n=c[9],p=c[10],r=c[11],q=c[12],v=c[13],x=c[14];c=c[15];b[0].setComponents(f-a,m-g,r-k,c-q).normalize();b[1].setComponents(f+a,m+g,r+k,c+q).normalize();b[2].setComponents(f+d,m+h,r+n,c+v).normalize();b[3].setComponents(f-
d,m-h,r-n,c-v).normalize();b[4].setComponents(f-e,m-l,r-p,c-x).normalize();b[5].setComponents(f+e,m+l,r+p,c+x).normalize();return this},intersectsObject:function(){var a=new Ea;return function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();a.copy(c.boundingSphere).applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSprite:function(){var a=new Ea;return function(b){a.center.set(0,0,0);a.radius=.7071067811865476;a.applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),
intersectsSphere:function(a){var b=this.planes,c=a.center;a=-a.radius;for(var d=0;6>d;d++)if(b[d].distanceToPoint(c)<a)return!1;return!0},intersectsBox:function(){var a=new p,b=new p;return function(c){for(var d=this.planes,e=0;6>e;e++){var f=d[e];a.x=0<f.normal.x?c.min.x:c.max.x;b.x=0<f.normal.x?c.max.x:c.min.x;a.y=0<f.normal.y?c.min.y:c.max.y;b.y=0<f.normal.y?c.max.y:c.min.y;a.z=0<f.normal.z?c.min.z:c.max.z;b.z=0<f.normal.z?c.max.z:c.min.z;var g=f.distanceToPoint(a);f=f.distanceToPoint(b);if(0>
g&&0>f)return!1}return!0}}(),containsPoint:function(a){for(var b=this.planes,c=0;6>c;c++)if(0>b[c].distanceToPoint(a))return!1;return!0}});var V={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",
aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",
bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",
clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif\n",
clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",
color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",
cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",
defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",
emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",
envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",
envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",
envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",
fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",
gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",
lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",
lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n",
lights_pars_maps:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",
lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",
lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",
lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",
lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n",
lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif\n",
lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",
logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",
map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",
metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",
morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",
normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",
normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",
packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",
premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",
roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",
shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",
shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",
shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",
skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",
skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",
specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",
uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",
uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",
uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",
cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",
depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",
distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",
distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",
equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",
linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",
meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",
meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",
meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",
meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",
meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",
meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",
meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",
normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",
normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",
points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",
shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n"},
Da={merge:function(a){for(var b={},c=0;c<a.length;c++){var d=this.clone(a[c]),e;for(e in d)b[e]=d[e]}return b},clone:function(a){var b={},c;for(c in a){b[c]={};for(var d in a[c]){var e=a[c][d];e&&(e.isColor||e.isMatrix3||e.isMatrix4||e.isVector2||e.isVector3||e.isVector4||e.isTexture)?b[c][d]=e.clone():Array.isArray(e)?b[c][d]=e.slice():b[c][d]=e}}return b}},Kg={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,
blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,
darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,
lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,
mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,
rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Object.assign(I.prototype,
{isColor:!0,r:1,g:1,b:1,set:function(a){a&&a.isColor?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setScalar:function(a){this.b=this.g=this.r=a;return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(){function a(a,c,d){0>d&&(d+=1);1<d&&--d;return d<1/6?a+6*(c-a)*d:.5>d?c:d<2/3?a+6*(c-a)*(2/3-d):a}return function(b,
c,d){b=S.euclideanModulo(b,1);c=S.clamp(c,0,1);d=S.clamp(d,0,1);0===c?this.r=this.g=this.b=d:(c=.5>=d?d*(1+c):d+c-d*c,d=2*d-c,this.r=a(d,c,b+1/3),this.g=a(d,c,b),this.b=a(d,c,b-1/3));return this}}(),setStyle:function(a){function b(b){void 0!==b&&1>parseFloat(b)&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}var c;if(c=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(a)){var d=c[2];switch(c[1]){case "rgb":case "rgba":if(c=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d))return this.r=
Math.min(255,parseInt(c[1],10))/255,this.g=Math.min(255,parseInt(c[2],10))/255,this.b=Math.min(255,parseInt(c[3],10))/255,b(c[5]),this;if(c=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d))return this.r=Math.min(100,parseInt(c[1],10))/100,this.g=Math.min(100,parseInt(c[2],10))/100,this.b=Math.min(100,parseInt(c[3],10))/100,b(c[5]),this;break;case "hsl":case "hsla":if(c=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d)){d=parseFloat(c[1])/
360;var e=parseInt(c[2],10)/100,f=parseInt(c[3],10)/100;b(c[5]);return this.setHSL(d,e,f)}}}else if(c=/^#([A-Fa-f0-9]+)$/.exec(a)){c=c[1];d=c.length;if(3===d)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===d)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}a&&0<a.length&&(c=Kg[a],
void 0!==c?this.setHex(c):console.warn("THREE.Color: Unknown color "+a));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a,b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);b=0<b?1/b:1;this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},convertGammaToLinear:function(){var a=
this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){void 0===a&&(console.warn("THREE.Color: .getHSL() target is now required"),a={h:0,s:0,l:0});var b=this.r,c=this.g,d=this.b,e=Math.max(b,c,d),f=
Math.min(b,c,d),g,h=(f+e)/2;if(f===e)f=g=0;else{var l=e-f;f=.5>=h?l/(e+f):l/(2-e-f);switch(e){case b:g=(c-d)/l+(c<d?6:0);break;case c:g=(d-b)/l+2;break;case d:g=(b-c)/l+4}g/=6}a.h=g;a.s=f;a.l=h;return a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(){var a={};return function(b,c,d){this.getHSL(a);a.h+=b;a.s+=c;a.l+=d;this.setHSL(a.h,a.s,a.l);return this}}(),add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,
b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},sub:function(a){this.r=Math.max(0,this.r-a.r);this.g=Math.max(0,this.g-a.g);this.b=Math.max(0,this.b-a.b);return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===
this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a,b){void 0===b&&(b=0);this.r=a[b];this.g=a[b+1];this.b=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a},toJSON:function(){return this.getHex()}});var L={common:{diffuse:{value:new I(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new sa},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},
reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new C(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},
gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:2.5E-4},fogNear:{value:1},fogFar:{value:2E3},fogColor:{value:new I(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},
shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new I(15658734)},
opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new sa}}},rb={basic:{uniforms:Da.merge([L.common,L.specularmap,L.envmap,L.aomap,L.lightmap,L.fog]),vertexShader:V.meshbasic_vert,fragmentShader:V.meshbasic_frag},lambert:{uniforms:Da.merge([L.common,L.specularmap,L.envmap,L.aomap,L.lightmap,L.emissivemap,L.fog,L.lights,{emissive:{value:new I(0)}}]),vertexShader:V.meshlambert_vert,fragmentShader:V.meshlambert_frag},phong:{uniforms:Da.merge([L.common,L.specularmap,
L.envmap,L.aomap,L.lightmap,L.emissivemap,L.bumpmap,L.normalmap,L.displacementmap,L.gradientmap,L.fog,L.lights,{emissive:{value:new I(0)},specular:{value:new I(1118481)},shininess:{value:30}}]),vertexShader:V.meshphong_vert,fragmentShader:V.meshphong_frag},standard:{uniforms:Da.merge([L.common,L.envmap,L.aomap,L.lightmap,L.emissivemap,L.bumpmap,L.normalmap,L.displacementmap,L.roughnessmap,L.metalnessmap,L.fog,L.lights,{emissive:{value:new I(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),
vertexShader:V.meshphysical_vert,fragmentShader:V.meshphysical_frag},points:{uniforms:Da.merge([L.points,L.fog]),vertexShader:V.points_vert,fragmentShader:V.points_frag},dashed:{uniforms:Da.merge([L.common,L.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:V.linedashed_vert,fragmentShader:V.linedashed_frag},depth:{uniforms:Da.merge([L.common,L.displacementmap]),vertexShader:V.depth_vert,fragmentShader:V.depth_frag},normal:{uniforms:Da.merge([L.common,L.bumpmap,L.normalmap,
L.displacementmap,{opacity:{value:1}}]),vertexShader:V.normal_vert,fragmentShader:V.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:V.cube_vert,fragmentShader:V.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:V.equirect_vert,fragmentShader:V.equirect_frag},distanceRGBA:{uniforms:Da.merge([L.common,L.displacementmap,{referencePosition:{value:new p},nearDistance:{value:1},farDistance:{value:1E3}}]),vertexShader:V.distanceRGBA_vert,
fragmentShader:V.distanceRGBA_frag},shadow:{uniforms:Da.merge([L.lights,L.fog,{color:{value:new I(0)},opacity:{value:1}}]),vertexShader:V.shadow_vert,fragmentShader:V.shadow_frag}};rb.physical={uniforms:Da.merge([rb.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:V.meshphysical_vert,fragmentShader:V.meshphysical_frag};jb.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");jb.DefaultOrder="XYZ";Object.defineProperties(jb.prototype,{x:{get:function(){return this._x},
set:function(a){this._x=a;this.onChangeCallback()}},y:{get:function(){return this._y},set:function(a){this._y=a;this.onChangeCallback()}},z:{get:function(){return this._z},set:function(a){this._z=a;this.onChangeCallback()}},order:{get:function(){return this._order},set:function(a){this._order=a;this.onChangeCallback()}}});Object.assign(jb.prototype,{isEuler:!0,set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,
this._y,this._z,this._order)},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b,c){var d=S.clamp,e=a.elements;a=e[0];var f=e[4],g=e[8],h=e[1],l=e[5],m=e[9],k=e[2],n=e[6];e=e[10];b=b||this._order;"XYZ"===b?(this._y=Math.asin(d(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(-m,e),this._z=Math.atan2(-f,a)):(this._x=Math.atan2(n,l),this._z=0)):"YXZ"===b?(this._x=Math.asin(-d(m,-1,1)),.99999>Math.abs(m)?
(this._y=Math.atan2(g,e),this._z=Math.atan2(h,l)):(this._y=Math.atan2(-k,a),this._z=0)):"ZXY"===b?(this._x=Math.asin(d(n,-1,1)),.99999>Math.abs(n)?(this._y=Math.atan2(-k,e),this._z=Math.atan2(-f,l)):(this._y=0,this._z=Math.atan2(h,a))):"ZYX"===b?(this._y=Math.asin(-d(k,-1,1)),.99999>Math.abs(k)?(this._x=Math.atan2(n,e),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-f,l))):"YZX"===b?(this._z=Math.asin(d(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(-m,l),this._y=Math.atan2(-k,a)):(this._x=
0,this._y=Math.atan2(g,e))):"XZY"===b?(this._z=Math.asin(-d(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(n,l),this._y=Math.atan2(g,a)):(this._x=Math.atan2(-m,e),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var a=new M;return function(b,c,d){a.makeRotationFromQuaternion(b);return this.setFromRotationMatrix(a,c,d)}}(),setFromVector3:function(a,b){return this.set(a.x,
a.y,a.z,b||this._order)},reorder:function(){var a=new ja;return function(b){a.setFromEuler(this);return this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._order;return a},toVector3:function(a){return a?
a.set(this._x,this._y,this._z):new p(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}});Object.assign(Sd.prototype,{set:function(a){this.mask=1<<a|0},enable:function(a){this.mask=this.mask|1<<a|0},toggle:function(a){this.mask^=1<<a|0},disable:function(a){this.mask&=~(1<<a|0)},test:function(a){return 0!==(this.mask&a.mask)}});var zf=0;A.DefaultUp=new p(0,1,0);A.DefaultMatrixAutoUpdate=!0;A.prototype=Object.assign(Object.create(xa.prototype),
{constructor:A,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(a){this.quaternion.premultiply(a);return this},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},
setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=new ja;return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.multiply(a);return this}}(),rotateOnWorldAxis:function(){var a=new ja;return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.premultiply(a);return this}}(),rotateX:function(){var a=new p(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new p(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),
rotateZ:function(){var a=new p(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new p;return function(b,c){a.copy(b).applyQuaternion(this.quaternion);this.position.add(a.multiplyScalar(c));return this}}(),translateX:function(){var a=new p(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new p(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new p(0,0,1);return function(b){return this.translateOnAxis(a,
b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new M;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new M,b=new p;return function(c,d,e){c.isVector3?b.copy(c):b.set(c,d,e);this.isCamera?a.lookAt(this.position,b,this.up):a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);
return this}if(a===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this;a&&a.isObject3D?(null!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a);return this},remove:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);return this}b=this.children.indexOf(a);-1!==b&&(a.parent=null,a.dispatchEvent({type:"removed"}),
this.children.splice(b,1));return this},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c].getObjectByProperty(a,b);if(void 0!==e)return e}},getWorldPosition:function(a){void 0===a&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),a=new p);this.updateMatrixWorld(!0);
return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=new p,b=new p;return function(c){void 0===c&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),c=new ja);this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,b);return c}}(),getWorldScale:function(){var a=new p,b=new ja;return function(c){void 0===c&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),c=new p);this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,
b,c);return c}}(),getWorldDirection:function(){var a=new ja;return function(b){void 0===b&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),b=new p);this.getWorldQuaternion(a);return b.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverseVisible(a)}},traverseAncestors:function(a){var b=
this.parent;null!==b&&(a(b),b.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||a)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].updateMatrixWorld(a)},
toJSON:function(a){function b(b,c){void 0===b[c.uuid]&&(b[c.uuid]=c.toJSON(a));return c.uuid}function c(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var d=void 0===a||"string"===typeof a,e={};d&&(a={geometries:{},materials:{},textures:{},images:{},shapes:{}},e.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var f={};f.uuid=this.uuid;f.type=this.type;""!==this.name&&(f.name=this.name);!0===this.castShadow&&(f.castShadow=!0);!0===this.receiveShadow&&(f.receiveShadow=
!0);!1===this.visible&&(f.visible=!1);!1===this.frustumCulled&&(f.frustumCulled=!1);0!==this.renderOrder&&(f.renderOrder=this.renderOrder);"{}"!==JSON.stringify(this.userData)&&(f.userData=this.userData);f.matrix=this.matrix.toArray();if(void 0!==this.geometry){f.geometry=b(a.geometries,this.geometry);var g=this.geometry.parameters;if(void 0!==g&&void 0!==g.shapes)if(g=g.shapes,Array.isArray(g))for(var h=0,l=g.length;h<l;h++)b(a.shapes,g[h]);else b(a.shapes,g)}if(void 0!==this.material)if(Array.isArray(this.material)){g=
[];h=0;for(l=this.material.length;h<l;h++)g.push(b(a.materials,this.material[h]));f.material=g}else f.material=b(a.materials,this.material);if(0<this.children.length)for(f.children=[],h=0;h<this.children.length;h++)f.children.push(this.children[h].toJSON(a).object);if(d){d=c(a.geometries);h=c(a.materials);l=c(a.textures);var m=c(a.images);g=c(a.shapes);0<d.length&&(e.geometries=d);0<h.length&&(e.materials=h);0<l.length&&(e.textures=l);0<m.length&&(e.images=m);0<g.length&&(e.shapes=g)}e.object=f;return e},
clone:function(a){return(new this.constructor).copy(this,a)},copy:function(a,b){void 0===b&&(b=!0);this.name=a.name;this.up.copy(a.up);this.position.copy(a.position);this.quaternion.copy(a.quaternion);this.scale.copy(a.scale);this.matrix.copy(a.matrix);this.matrixWorld.copy(a.matrixWorld);this.matrixAutoUpdate=a.matrixAutoUpdate;this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;this.layers.mask=a.layers.mask;this.visible=a.visible;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;
this.frustumCulled=a.frustumCulled;this.renderOrder=a.renderOrder;this.userData=JSON.parse(JSON.stringify(a.userData));if(!0===b)for(b=0;b<a.children.length;b++)this.add(a.children[b].clone());return this}});Qa.prototype=Object.assign(Object.create(A.prototype),{constructor:Qa,isCamera:!0,copy:function(a,b){A.prototype.copy.call(this,a,b);this.matrixWorldInverse.copy(a.matrixWorldInverse);this.projectionMatrix.copy(a.projectionMatrix);return this},getWorldDirection:function(){var a=new ja;return function(b){void 0===
b&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),b=new p);this.getWorldQuaternion(a);return b.set(0,0,-1).applyQuaternion(a)}}(),updateMatrixWorld:function(a){A.prototype.updateMatrixWorld.call(this,a);this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}});Jb.prototype=Object.assign(Object.create(Qa.prototype),{constructor:Jb,isOrthographicCamera:!0,copy:function(a,b){Qa.prototype.copy.call(this,a,b);this.left=
a.left;this.right=a.right;this.top=a.top;this.bottom=a.bottom;this.near=a.near;this.far=a.far;this.zoom=a.zoom;this.view=null===a.view?null:Object.assign({},a.view);return this},setViewOffset:function(a,b,c,d,e,f){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1});this.view.enabled=!0;this.view.fullWidth=a;this.view.fullHeight=b;this.view.offsetX=c;this.view.offsetY=d;this.view.width=e;this.view.height=f;this.updateProjectionMatrix()},clearViewOffset:function(){null!==
this.view&&(this.view.enabled=!1);this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2,e=c-a;c+=a;a=d+b;b=d-b;if(null!==this.view&&this.view.enabled){c=this.zoom/(this.view.width/this.view.fullWidth);b=this.zoom/(this.view.height/this.view.fullHeight);var f=(this.right-this.left)/this.view.width;d=(this.top-this.bottom)/this.view.height;e+=this.view.offsetX/
c*f;c=e+this.view.width/c*f;a-=this.view.offsetY/b*d;b=a-this.view.height/b*d}this.projectionMatrix.makeOrthographic(e,c,a,b,this.near,this.far)},toJSON:function(a){a=A.prototype.toJSON.call(this,a);a.object.zoom=this.zoom;a.object.left=this.left;a.object.right=this.right;a.object.top=this.top;a.object.bottom=this.bottom;a.object.near=this.near;a.object.far=this.far;null!==this.view&&(a.object.view=Object.assign({},this.view));return a}});Object.assign(Wa.prototype,{clone:function(){return(new this.constructor).copy(this)},
copy:function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.normal.copy(a.normal);this.color.copy(a.color);this.materialIndex=a.materialIndex;for(var b=0,c=a.vertexNormals.length;b<c;b++)this.vertexNormals[b]=a.vertexNormals[b].clone();b=0;for(c=a.vertexColors.length;b<c;b++)this.vertexColors[b]=a.vertexColors[b].clone();return this}});var Af=0;N.prototype=Object.assign(Object.create(xa.prototype),{constructor:N,isGeometry:!0,applyMatrix:function(a){for(var b=(new sa).getNormalMatrix(a),c=0,d=this.vertices.length;c<
d;c++)this.vertices[c].applyMatrix4(a);c=0;for(d=this.faces.length;c<d;c++){a=this.faces[c];a.normal.applyMatrix3(b).normalize();for(var e=0,f=a.vertexNormals.length;e<f;e++)a.vertexNormals[e].applyMatrix3(b).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();this.normalsNeedUpdate=this.verticesNeedUpdate=!0;return this},rotateX:function(){var a=new M;return function(b){a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a=
new M;return function(b){a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a=new M;return function(b){a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a=new M;return function(b,c,d){a.makeTranslation(b,c,d);this.applyMatrix(a);return this}}(),scale:function(){var a=new M;return function(b,c,d){a.makeScale(b,c,d);this.applyMatrix(a);return this}}(),lookAt:function(){var a=new A;return function(b){a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),
fromBufferGeometry:function(a){function b(a,b,d,e){var f=void 0!==g?[k[a].clone(),k[b].clone(),k[d].clone()]:[],p=void 0!==h?[c.colors[a].clone(),c.colors[b].clone(),c.colors[d].clone()]:[];e=new Wa(a,b,d,f,p,e);c.faces.push(e);void 0!==l&&c.faceVertexUvs[0].push([n[a].clone(),n[b].clone(),n[d].clone()]);void 0!==m&&c.faceVertexUvs[1].push([t[a].clone(),t[b].clone(),t[d].clone()])}var c=this,d=null!==a.index?a.index.array:void 0,e=a.attributes,f=e.position.array,g=void 0!==e.normal?e.normal.array:
void 0,h=void 0!==e.color?e.color.array:void 0,l=void 0!==e.uv?e.uv.array:void 0,m=void 0!==e.uv2?e.uv2.array:void 0;void 0!==m&&(this.faceVertexUvs[1]=[]);for(var k=[],n=[],t=[],r=e=0;e<f.length;e+=3,r+=2)c.vertices.push(new p(f[e],f[e+1],f[e+2])),void 0!==g&&k.push(new p(g[e],g[e+1],g[e+2])),void 0!==h&&c.colors.push(new I(h[e],h[e+1],h[e+2])),void 0!==l&&n.push(new C(l[r],l[r+1])),void 0!==m&&t.push(new C(m[r],m[r+1]));var q=a.groups;if(0<q.length)for(e=0;e<q.length;e++){f=q[e];var v=f.start,x=
f.count;r=v;for(v+=x;r<v;r+=3)void 0!==d?b(d[r],d[r+1],d[r+2],f.materialIndex):b(r,r+1,r+2,f.materialIndex)}else if(void 0!==d)for(e=0;e<d.length;e+=3)b(d[e],d[e+1],d[e+2]);else for(e=0;e<f.length/3;e+=3)b(e,e+1,e+2);this.computeFaceNormals();null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());return this},center:function(){var a=new p;return function(){this.computeBoundingBox();this.boundingBox.getCenter(a).negate();
this.translate(a.x,a.y,a.z);return this}}(),normalize:function(){this.computeBoundingSphere();var a=this.boundingSphere.center,b=this.boundingSphere.radius;b=0===b?1:1/b;var c=new M;c.set(b,0,0,-b*a.x,0,b,0,-b*a.y,0,0,b,-b*a.z,0,0,0,1);this.applyMatrix(c);return this},computeFaceNormals:function(){for(var a=new p,b=new p,c=0,d=this.faces.length;c<d;c++){var e=this.faces[c],f=this.vertices[e.a],g=this.vertices[e.b];a.subVectors(this.vertices[e.c],g);b.subVectors(f,g);a.cross(b);a.normalize();e.normal.copy(a)}},
computeVertexNormals:function(a){void 0===a&&(a=!0);var b;var c=Array(this.vertices.length);var d=0;for(b=this.vertices.length;d<b;d++)c[d]=new p;if(a){var e=new p,f=new p;a=0;for(d=this.faces.length;a<d;a++){b=this.faces[a];var g=this.vertices[b.a];var h=this.vertices[b.b];var l=this.vertices[b.c];e.subVectors(l,h);f.subVectors(g,h);e.cross(f);c[b.a].add(e);c[b.b].add(e);c[b.c].add(e)}}else for(this.computeFaceNormals(),a=0,d=this.faces.length;a<d;a++)b=this.faces[a],c[b.a].add(b.normal),c[b.b].add(b.normal),
c[b.c].add(b.normal);d=0;for(b=this.vertices.length;d<b;d++)c[d].normalize();a=0;for(d=this.faces.length;a<d;a++)b=this.faces[a],g=b.vertexNormals,3===g.length?(g[0].copy(c[b.a]),g[1].copy(c[b.b]),g[2].copy(c[b.c])):(g[0]=c[b.a].clone(),g[1]=c[b.b].clone(),g[2]=c[b.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var a;this.computeFaceNormals();var b=0;for(a=this.faces.length;b<a;b++){var c=this.faces[b];var d=c.vertexNormals;3===d.length?(d[0].copy(c.normal),
d[1].copy(c.normal),d[2].copy(c.normal)):(d[0]=c.normal.clone(),d[1]=c.normal.clone(),d[2]=c.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var a,b;var c=0;for(b=this.faces.length;c<b;c++){var d=this.faces[c];d.__originalFaceNormal?d.__originalFaceNormal.copy(d.normal):d.__originalFaceNormal=d.normal.clone();d.__originalVertexNormals||(d.__originalVertexNormals=[]);var e=0;for(a=d.vertexNormals.length;e<a;e++)d.__originalVertexNormals[e]?d.__originalVertexNormals[e].copy(d.vertexNormals[e]):
d.__originalVertexNormals[e]=d.vertexNormals[e].clone()}var f=new N;f.faces=this.faces;e=0;for(a=this.morphTargets.length;e<a;e++){if(!this.morphNormals[e]){this.morphNormals[e]={};this.morphNormals[e].faceNormals=[];this.morphNormals[e].vertexNormals=[];d=this.morphNormals[e].faceNormals;var g=this.morphNormals[e].vertexNormals;c=0;for(b=this.faces.length;c<b;c++){var h=new p;var l={a:new p,b:new p,c:new p};d.push(h);g.push(l)}}g=this.morphNormals[e];f.vertices=this.morphTargets[e].vertices;f.computeFaceNormals();
f.computeVertexNormals();c=0;for(b=this.faces.length;c<b;c++)d=this.faces[c],h=g.faceNormals[c],l=g.vertexNormals[c],h.copy(d.normal),l.a.copy(d.vertexNormals[0]),l.b.copy(d.vertexNormals[1]),l.c.copy(d.vertexNormals[2])}c=0;for(b=this.faces.length;c<b;c++)d=this.faces[c],d.normal=d.__originalFaceNormal,d.vertexNormals=d.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Va);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===
this.boundingSphere&&(this.boundingSphere=new Ea);this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,b,c){if(a&&a.isGeometry){var d,e=this.vertices.length,f=this.vertices,g=a.vertices,h=this.faces,l=a.faces,m=this.faceVertexUvs[0],k=a.faceVertexUvs[0],n=this.colors,p=a.colors;void 0===c&&(c=0);void 0!==b&&(d=(new sa).getNormalMatrix(b));a=0;for(var r=g.length;a<r;a++){var q=g[a].clone();void 0!==b&&q.applyMatrix4(b);f.push(q)}a=0;for(r=p.length;a<r;a++)n.push(p[a].clone());a=0;for(r=
l.length;a<r;a++){g=l[a];var v=g.vertexNormals;p=g.vertexColors;n=new Wa(g.a+e,g.b+e,g.c+e);n.normal.copy(g.normal);void 0!==d&&n.normal.applyMatrix3(d).normalize();b=0;for(f=v.length;b<f;b++)q=v[b].clone(),void 0!==d&&q.applyMatrix3(d).normalize(),n.vertexNormals.push(q);n.color.copy(g.color);b=0;for(f=p.length;b<f;b++)q=p[b],n.vertexColors.push(q.clone());n.materialIndex=g.materialIndex+c;h.push(n)}a=0;for(r=k.length;a<r;a++)if(c=k[a],d=[],void 0!==c){b=0;for(f=c.length;b<f;b++)d.push(c[b].clone());
m.push(d)}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",a)},mergeMesh:function(a){a&&a.isMesh?(a.matrixAutoUpdate&&a.updateMatrix(),this.merge(a.geometry,a.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",a)},mergeVertices:function(){var a={},b=[],c=[],d=Math.pow(10,4),e;var f=0;for(e=this.vertices.length;f<e;f++){var g=this.vertices[f];g=Math.round(g.x*d)+"_"+Math.round(g.y*d)+"_"+Math.round(g.z*d);void 0===a[g]?
(a[g]=f,b.push(this.vertices[f]),c[f]=b.length-1):c[f]=c[a[g]]}a=[];f=0;for(e=this.faces.length;f<e;f++)for(d=this.faces[f],d.a=c[d.a],d.b=c[d.b],d.c=c[d.c],d=[d.a,d.b,d.c],g=0;3>g;g++)if(d[g]===d[(g+1)%3]){a.push(f);break}for(f=a.length-1;0<=f;f--)for(d=a[f],this.faces.splice(d,1),c=0,e=this.faceVertexUvs.length;c<e;c++)this.faceVertexUvs[c].splice(d,1);f=this.vertices.length-b.length;this.vertices=b;return f},setFromPoints:function(a){this.vertices=[];for(var b=0,c=a.length;b<c;b++){var d=a[b];
this.vertices.push(new p(d.x,d.y,d.z||0))}return this},sortFacesByMaterialIndex:function(){for(var a=this.faces,b=a.length,c=0;c<b;c++)a[c]._id=c;a.sort(function(a,b){return a.materialIndex-b.materialIndex});var d=this.faceVertexUvs[0],e=this.faceVertexUvs[1],f,g;d&&d.length===b&&(f=[]);e&&e.length===b&&(g=[]);for(c=0;c<b;c++){var h=a[c]._id;f&&f.push(d[h]);g&&g.push(e[h])}f&&(this.faceVertexUvs[0]=f);g&&(this.faceVertexUvs[1]=g)},toJSON:function(){function a(a,b,c){return c?a|1<<b:a&~(1<<b)}function b(a){var b=
a.x.toString()+a.y.toString()+a.z.toString();if(void 0!==m[b])return m[b];m[b]=l.length/3;l.push(a.x,a.y,a.z);return m[b]}function c(a){var b=a.r.toString()+a.g.toString()+a.b.toString();if(void 0!==n[b])return n[b];n[b]=k.length;k.push(a.getHex());return n[b]}function d(a){var b=a.x.toString()+a.y.toString();if(void 0!==r[b])return r[b];r[b]=p.length/2;p.push(a.x,a.y);return r[b]}var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};e.uuid=this.uuid;e.type=this.type;""!==this.name&&
(e.name=this.name);if(void 0!==this.parameters){var f=this.parameters,g;for(g in f)void 0!==f[g]&&(e[g]=f[g]);return e}f=[];for(g=0;g<this.vertices.length;g++){var h=this.vertices[g];f.push(h.x,h.y,h.z)}h=[];var l=[],m={},k=[],n={},p=[],r={};for(g=0;g<this.faces.length;g++){var q=this.faces[g],v=void 0!==this.faceVertexUvs[0][g],x=0<q.normal.length(),y=0<q.vertexNormals.length,w=1!==q.color.r||1!==q.color.g||1!==q.color.b,B=0<q.vertexColors.length,G=0;G=a(G,0,0);G=a(G,1,!0);G=a(G,2,!1);G=a(G,3,v);
G=a(G,4,x);G=a(G,5,y);G=a(G,6,w);G=a(G,7,B);h.push(G);h.push(q.a,q.b,q.c);h.push(q.materialIndex);v&&(v=this.faceVertexUvs[0][g],h.push(d(v[0]),d(v[1]),d(v[2])));x&&h.push(b(q.normal));y&&(x=q.vertexNormals,h.push(b(x[0]),b(x[1]),b(x[2])));w&&h.push(c(q.color));B&&(q=q.vertexColors,h.push(c(q[0]),c(q[1]),c(q[2])))}e.data={};e.data.vertices=f;e.data.normals=l;0<k.length&&(e.data.colors=k);0<p.length&&(e.data.uvs=[p]);e.data.faces=h;return e},clone:function(){return(new N).copy(this)},copy:function(a){var b,
c,d;this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.name=a.name;var e=a.vertices;var f=0;for(b=e.length;f<b;f++)this.vertices.push(e[f].clone());e=a.colors;f=0;for(b=e.length;f<b;f++)this.colors.push(e[f].clone());e=a.faces;f=0;for(b=e.length;f<b;f++)this.faces.push(e[f].clone());f=0;for(b=a.faceVertexUvs.length;f<b;f++){var g=
a.faceVertexUvs[f];void 0===this.faceVertexUvs[f]&&(this.faceVertexUvs[f]=[]);e=0;for(c=g.length;e<c;e++){var h=g[e],l=[];var m=0;for(d=h.length;m<d;m++)l.push(h[m].clone());this.faceVertexUvs[f].push(l)}}m=a.morphTargets;f=0;for(b=m.length;f<b;f++){d={};d.name=m[f].name;if(void 0!==m[f].vertices)for(d.vertices=[],e=0,c=m[f].vertices.length;e<c;e++)d.vertices.push(m[f].vertices[e].clone());if(void 0!==m[f].normals)for(d.normals=[],e=0,c=m[f].normals.length;e<c;e++)d.normals.push(m[f].normals[e].clone());
this.morphTargets.push(d)}m=a.morphNormals;f=0;for(b=m.length;f<b;f++){d={};if(void 0!==m[f].vertexNormals)for(d.vertexNormals=[],e=0,c=m[f].vertexNormals.length;e<c;e++)g=m[f].vertexNormals[e],h={},h.a=g.a.clone(),h.b=g.b.clone(),h.c=g.c.clone(),d.vertexNormals.push(h);if(void 0!==m[f].faceNormals)for(d.faceNormals=[],e=0,c=m[f].faceNormals.length;e<c;e++)d.faceNormals.push(m[f].faceNormals[e].clone());this.morphNormals.push(d)}e=a.skinWeights;f=0;for(b=e.length;f<b;f++)this.skinWeights.push(e[f].clone());
e=a.skinIndices;f=0;for(b=e.length;f<b;f++)this.skinIndices.push(e[f].clone());e=a.lineDistances;f=0;for(b=e.length;f<b;f++)this.lineDistances.push(e[f]);f=a.boundingBox;null!==f&&(this.boundingBox=f.clone());f=a.boundingSphere;null!==f&&(this.boundingSphere=f.clone());this.elementsNeedUpdate=a.elementsNeedUpdate;this.verticesNeedUpdate=a.verticesNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.lineDistancesNeedUpdate=
a.lineDistancesNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Object.defineProperty(T.prototype,"needsUpdate",{set:function(a){!0===a&&this.version++}});Object.assign(T.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(a){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==a?a.length/this.itemSize:0;this.array=a},setDynamic:function(a){this.dynamic=
a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.itemSize=a.itemSize;this.count=a.count;this.normalized=a.normalized;this.dynamic=a.dynamic;return this},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this},copyArray:function(a){this.array.set(a);return this},copyColorsArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",
d),f=new I);b[c++]=f.r;b[c++]=f.g;b[c++]=f.b}return this},copyVector2sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",d),f=new C);b[c++]=f.x;b[c++]=f.y}return this},copyVector3sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",d),f=new p);b[c++]=f.x;b[c++]=f.y;
b[c++]=f.z}return this},copyVector4sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",d),f=new ea);b[c++]=f.x;b[c++]=f.y;b[c++]=f.z;b[c++]=f.w}return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},getX:function(a){return this.array[a*this.itemSize]},setX:function(a,b){this.array[a*this.itemSize]=b;return this},getY:function(a){return this.array[a*this.itemSize+
1]},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},getZ:function(a){return this.array[a*this.itemSize+2]},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},getW:function(a){return this.array[a*this.itemSize+3]},setW:function(a,b){this.array[a*this.itemSize+3]=b;return this},setXY:function(a,b,c){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;return this},
setXYZW:function(a,b,c,d,e){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=e;return this},onUpload:function(a){this.onUploadCallback=a;return this},clone:function(){return(new this.constructor(this.array,this.itemSize)).copy(this)}});rc.prototype=Object.create(T.prototype);rc.prototype.constructor=rc;sc.prototype=Object.create(T.prototype);sc.prototype.constructor=sc;tc.prototype=Object.create(T.prototype);tc.prototype.constructor=tc;uc.prototype=Object.create(T.prototype);
uc.prototype.constructor=uc;kb.prototype=Object.create(T.prototype);kb.prototype.constructor=kb;vc.prototype=Object.create(T.prototype);vc.prototype.constructor=vc;lb.prototype=Object.create(T.prototype);lb.prototype.constructor=lb;z.prototype=Object.create(T.prototype);z.prototype.constructor=z;wc.prototype=Object.create(T.prototype);wc.prototype.constructor=wc;Object.assign(Ce.prototype,{computeGroups:function(a){var b=[],c=void 0;a=a.faces;for(var d=0;d<a.length;d++){var e=a[d];if(e.materialIndex!==
c){c=e.materialIndex;void 0!==f&&(f.count=3*d-f.start,b.push(f));var f={start:3*d,materialIndex:c}}}void 0!==f&&(f.count=3*d-f.start,b.push(f));this.groups=b},fromGeometry:function(a){var b=a.faces,c=a.vertices,d=a.faceVertexUvs,e=d[0]&&0<d[0].length,f=d[1]&&0<d[1].length,g=a.morphTargets,h=g.length;if(0<h){var l=[];for(var m=0;m<h;m++)l[m]=[];this.morphTargets.position=l}var k=a.morphNormals,n=k.length;if(0<n){var p=[];for(m=0;m<n;m++)p[m]=[];this.morphTargets.normal=p}var r=a.skinIndices,q=a.skinWeights,
v=r.length===c.length,x=q.length===c.length;for(m=0;m<b.length;m++){var y=b[m];this.vertices.push(c[y.a],c[y.b],c[y.c]);var w=y.vertexNormals;3===w.length?this.normals.push(w[0],w[1],w[2]):(w=y.normal,this.normals.push(w,w,w));w=y.vertexColors;3===w.length?this.colors.push(w[0],w[1],w[2]):(w=y.color,this.colors.push(w,w,w));!0===e&&(w=d[0][m],void 0!==w?this.uvs.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",m),this.uvs.push(new C,new C,new C)));!0===
f&&(w=d[1][m],void 0!==w?this.uvs2.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",m),this.uvs2.push(new C,new C,new C)));for(w=0;w<h;w++){var B=g[w].vertices;l[w].push(B[y.a],B[y.b],B[y.c])}for(w=0;w<n;w++)B=k[w].vertexNormals[m],p[w].push(B.a,B.b,B.c);v&&this.skinIndices.push(r[y.a],r[y.b],r[y.c]);x&&this.skinWeights.push(q[y.a],q[y.b],q[y.c])}this.computeGroups(a);this.verticesNeedUpdate=a.verticesNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;
this.colorsNeedUpdate=a.colorsNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return this}});var Bf=1;F.prototype=Object.assign(Object.create(xa.prototype),{constructor:F,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(a){Array.isArray(a)?this.index=new (65535<De(a)?lb:kb)(a,1):this.index=a},addAttribute:function(a,b,c){if(b&&b.isBufferAttribute||b&&b.isInterleavedBufferAttribute)if("index"===a)console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),
this.setIndex(b);else return this.attributes[a]=b,this;else console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(a,new T(b,c))},getAttribute:function(a){return this.attributes[a]},removeAttribute:function(a){delete this.attributes[a];return this},addGroup:function(a,b,c){this.groups.push({start:a,count:b,materialIndex:void 0!==c?c:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(a,b){this.drawRange.start=a;this.drawRange.count=b},
applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToBufferAttribute(b),b.needsUpdate=!0);b=this.attributes.normal;void 0!==b&&((new sa).getNormalMatrix(a).applyToBufferAttribute(b),b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return this},rotateX:function(){var a=new M;return function(b){a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a=new M;return function(b){a.makeRotationY(b);
this.applyMatrix(a);return this}}(),rotateZ:function(){var a=new M;return function(b){a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a=new M;return function(b,c,d){a.makeTranslation(b,c,d);this.applyMatrix(a);return this}}(),scale:function(){var a=new M;return function(b,c,d){a.makeScale(b,c,d);this.applyMatrix(a);return this}}(),lookAt:function(){var a=new A;return function(b){a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),center:function(){var a=new p;
return function(){this.computeBoundingBox();this.boundingBox.getCenter(a).negate();this.translate(a.x,a.y,a.z);return this}}(),setFromObject:function(a){var b=a.geometry;if(a.isPoints||a.isLine){a=new z(3*b.vertices.length,3);var c=new z(3*b.colors.length,3);this.addAttribute("position",a.copyVector3sArray(b.vertices));this.addAttribute("color",c.copyColorsArray(b.colors));b.lineDistances&&b.lineDistances.length===b.vertices.length&&(a=new z(b.lineDistances.length,1),this.addAttribute("lineDistance",
a.copyArray(b.lineDistances)));null!==b.boundingSphere&&(this.boundingSphere=b.boundingSphere.clone());null!==b.boundingBox&&(this.boundingBox=b.boundingBox.clone())}else a.isMesh&&b&&b.isGeometry&&this.fromGeometry(b);return this},setFromPoints:function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c];b.push(e.x,e.y,e.z||0)}this.addAttribute("position",new z(b,3));return this},updateFromObject:function(a){var b=a.geometry;if(a.isMesh){var c=b.__directGeometry;!0===b.elementsNeedUpdate&&(c=void 0,
b.elementsNeedUpdate=!1);if(void 0===c)return this.fromGeometry(b);c.verticesNeedUpdate=b.verticesNeedUpdate;c.normalsNeedUpdate=b.normalsNeedUpdate;c.colorsNeedUpdate=b.colorsNeedUpdate;c.uvsNeedUpdate=b.uvsNeedUpdate;c.groupsNeedUpdate=b.groupsNeedUpdate;b.verticesNeedUpdate=!1;b.normalsNeedUpdate=!1;b.colorsNeedUpdate=!1;b.uvsNeedUpdate=!1;b.groupsNeedUpdate=!1;b=c}!0===b.verticesNeedUpdate&&(c=this.attributes.position,void 0!==c&&(c.copyVector3sArray(b.vertices),c.needsUpdate=!0),b.verticesNeedUpdate=
!1);!0===b.normalsNeedUpdate&&(c=this.attributes.normal,void 0!==c&&(c.copyVector3sArray(b.normals),c.needsUpdate=!0),b.normalsNeedUpdate=!1);!0===b.colorsNeedUpdate&&(c=this.attributes.color,void 0!==c&&(c.copyColorsArray(b.colors),c.needsUpdate=!0),b.colorsNeedUpdate=!1);b.uvsNeedUpdate&&(c=this.attributes.uv,void 0!==c&&(c.copyVector2sArray(b.uvs),c.needsUpdate=!0),b.uvsNeedUpdate=!1);b.lineDistancesNeedUpdate&&(c=this.attributes.lineDistance,void 0!==c&&(c.copyArray(b.lineDistances),c.needsUpdate=
!0),b.lineDistancesNeedUpdate=!1);b.groupsNeedUpdate&&(b.computeGroups(a.geometry),this.groups=b.groups,b.groupsNeedUpdate=!1);return this},fromGeometry:function(a){a.__directGeometry=(new Ce).fromGeometry(a);return this.fromDirectGeometry(a.__directGeometry)},fromDirectGeometry:function(a){var b=new Float32Array(3*a.vertices.length);this.addAttribute("position",(new T(b,3)).copyVector3sArray(a.vertices));0<a.normals.length&&(b=new Float32Array(3*a.normals.length),this.addAttribute("normal",(new T(b,
3)).copyVector3sArray(a.normals)));0<a.colors.length&&(b=new Float32Array(3*a.colors.length),this.addAttribute("color",(new T(b,3)).copyColorsArray(a.colors)));0<a.uvs.length&&(b=new Float32Array(2*a.uvs.length),this.addAttribute("uv",(new T(b,2)).copyVector2sArray(a.uvs)));0<a.uvs2.length&&(b=new Float32Array(2*a.uvs2.length),this.addAttribute("uv2",(new T(b,2)).copyVector2sArray(a.uvs2)));this.groups=a.groups;for(var c in a.morphTargets){b=[];for(var d=a.morphTargets[c],e=0,f=d.length;e<f;e++){var g=
d[e],h=new z(3*g.length,3);b.push(h.copyVector3sArray(g))}this.morphAttributes[c]=b}0<a.skinIndices.length&&(c=new z(4*a.skinIndices.length,4),this.addAttribute("skinIndex",c.copyVector4sArray(a.skinIndices)));0<a.skinWeights.length&&(c=new z(4*a.skinWeights.length,4),this.addAttribute("skinWeight",c.copyVector4sArray(a.skinWeights)));null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());return this},computeBoundingBox:function(){null===
this.boundingBox&&(this.boundingBox=new Va);var a=this.attributes.position;void 0!==a?this.boundingBox.setFromBufferAttribute(a):this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var a=new Va,b=new p;return function(){null===this.boundingSphere&&
(this.boundingSphere=new Ea);var c=this.attributes.position;if(c){var d=this.boundingSphere.center;a.setFromBufferAttribute(c);a.getCenter(d);for(var e=0,f=0,g=c.count;f<g;f++)b.x=c.getX(f),b.y=c.getY(f),b.z=c.getZ(f),e=Math.max(e,d.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(e);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},
computeVertexNormals:function(){var a=this.index,b=this.attributes,c=this.groups;if(b.position){var d=b.position.array;if(void 0===b.normal)this.addAttribute("normal",new T(new Float32Array(d.length),3));else for(var e=b.normal.array,f=0,g=e.length;f<g;f++)e[f]=0;e=b.normal.array;var h=new p,l=new p,m=new p,k=new p,n=new p;if(a){a=a.array;0===c.length&&this.addGroup(0,a.length);for(var t=0,r=c.length;t<r;++t){f=c[t];g=f.start;var q=f.count;f=g;for(g+=q;f<g;f+=3){q=3*a[f+0];var v=3*a[f+1];var x=3*
a[f+2];h.fromArray(d,q);l.fromArray(d,v);m.fromArray(d,x);k.subVectors(m,l);n.subVectors(h,l);k.cross(n);e[q]+=k.x;e[q+1]+=k.y;e[q+2]+=k.z;e[v]+=k.x;e[v+1]+=k.y;e[v+2]+=k.z;e[x]+=k.x;e[x+1]+=k.y;e[x+2]+=k.z}}}else for(f=0,g=d.length;f<g;f+=9)h.fromArray(d,f),l.fromArray(d,f+3),m.fromArray(d,f+6),k.subVectors(m,l),n.subVectors(h,l),k.cross(n),e[f]=k.x,e[f+1]=k.y,e[f+2]=k.z,e[f+3]=k.x,e[f+4]=k.y,e[f+5]=k.z,e[f+6]=k.x,e[f+7]=k.y,e[f+8]=k.z;this.normalizeNormals();b.normal.needsUpdate=!0}},merge:function(a,
b){if(a&&a.isBufferGeometry){void 0===b&&(b=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var c=this.attributes,d;for(d in c)if(void 0!==a.attributes[d]){var e=c[d].array,f=a.attributes[d],g=f.array,h=0;for(f=f.itemSize*b;h<g.length;h++,f++)e[f]=g[h]}return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",a)},normalizeNormals:function(){var a=
new p;return function(){for(var b=this.attributes.normal,c=0,d=b.count;c<d;c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.normalize(),b.setXYZ(c,a.x,a.y,a.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var a=new F,b=this.index.array,c=this.attributes,d;for(d in c){var e=c[d],f=e.array,g=e.itemSize,h=new f.constructor(b.length*g),l=0;e=0;for(var m=b.length;e<m;e++){var k=b[e]*g;for(var n=0;n<g;n++)h[l++]=
f[k++]}a.addAttribute(d,new T(h,g))}b=this.groups;e=0;for(m=b.length;e<m;e++)c=b[e],a.addGroup(c.start,c.count,c.materialIndex);return a},toJSON:function(){var a={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};a.uuid=this.uuid;a.type=this.type;""!==this.name&&(a.name=this.name);if(void 0!==this.parameters){var b=this.parameters;for(e in b)void 0!==b[e]&&(a[e]=b[e]);return a}a.data={attributes:{}};var c=this.index;null!==c&&(b=Array.prototype.slice.call(c.array),a.data.index=
{type:c.array.constructor.name,array:b});c=this.attributes;for(e in c){var d=c[e];b=Array.prototype.slice.call(d.array);a.data.attributes[e]={itemSize:d.itemSize,type:d.array.constructor.name,array:b,normalized:d.normalized}}var e=this.groups;0<e.length&&(a.data.groups=JSON.parse(JSON.stringify(e)));e=this.boundingSphere;null!==e&&(a.data.boundingSphere={center:e.center.toArray(),radius:e.radius});return a},clone:function(){return(new F).copy(this)},copy:function(a){var b;this.index=null;this.attributes=
{};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.name=a.name;var c=a.index;null!==c&&this.setIndex(c.clone());c=a.attributes;for(g in c)this.addAttribute(g,c[g].clone());var d=a.morphAttributes;for(g in d){var e=[],f=d[g];c=0;for(b=f.length;c<b;c++)e.push(f[c].clone());this.morphAttributes[g]=e}var g=a.groups;c=0;for(b=g.length;c<b;c++)d=g[c],this.addGroup(d.start,d.count,d.materialIndex);g=a.boundingBox;null!==g&&(this.boundingBox=g.clone());g=a.boundingSphere;
null!==g&&(this.boundingSphere=g.clone());this.drawRange.start=a.drawRange.start;this.drawRange.count=a.drawRange.count;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Kb.prototype=Object.create(N.prototype);Kb.prototype.constructor=Kb;mb.prototype=Object.create(F.prototype);mb.prototype.constructor=mb;xc.prototype=Object.create(N.prototype);xc.prototype.constructor=xc;pb.prototype=Object.create(F.prototype);pb.prototype.constructor=pb;var Cf=0;O.prototype=Object.assign(Object.create(xa.prototype),
{constructor:O,isMaterial:!0,onBeforeCompile:function(){},setValues:function(a){if(void 0!==a)for(var b in a){var c=a[b];if(void 0===c)console.warn("THREE.Material: '"+b+"' parameter is undefined.");else if("shading"===b)console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===c?!0:!1;else{var d=this[b];void 0===d?console.warn("THREE."+this.type+": '"+b+"' is not a property of this material."):d&&d.isColor?d.set(c):d&&d.isVector3&&
c&&c.isVector3?d.copy(c):this[b]="overdraw"===b?Number(c):c}}},toJSON:function(a){function b(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var c=void 0===a||"string"===typeof a;c&&(a={textures:{},images:{}});var d={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};d.uuid=this.uuid;d.type=this.type;""!==this.name&&(d.name=this.name);this.color&&this.color.isColor&&(d.color=this.color.getHex());void 0!==this.roughness&&(d.roughness=this.roughness);void 0!==
this.metalness&&(d.metalness=this.metalness);this.emissive&&this.emissive.isColor&&(d.emissive=this.emissive.getHex());1!==this.emissiveIntensity&&(d.emissiveIntensity=this.emissiveIntensity);this.specular&&this.specular.isColor&&(d.specular=this.specular.getHex());void 0!==this.shininess&&(d.shininess=this.shininess);void 0!==this.clearCoat&&(d.clearCoat=this.clearCoat);void 0!==this.clearCoatRoughness&&(d.clearCoatRoughness=this.clearCoatRoughness);this.map&&this.map.isTexture&&(d.map=this.map.toJSON(a).uuid);
this.alphaMap&&this.alphaMap.isTexture&&(d.alphaMap=this.alphaMap.toJSON(a).uuid);this.lightMap&&this.lightMap.isTexture&&(d.lightMap=this.lightMap.toJSON(a).uuid);this.bumpMap&&this.bumpMap.isTexture&&(d.bumpMap=this.bumpMap.toJSON(a).uuid,d.bumpScale=this.bumpScale);this.normalMap&&this.normalMap.isTexture&&(d.normalMap=this.normalMap.toJSON(a).uuid,d.normalScale=this.normalScale.toArray());this.displacementMap&&this.displacementMap.isTexture&&(d.displacementMap=this.displacementMap.toJSON(a).uuid,
d.displacementScale=this.displacementScale,d.displacementBias=this.displacementBias);this.roughnessMap&&this.roughnessMap.isTexture&&(d.roughnessMap=this.roughnessMap.toJSON(a).uuid);this.metalnessMap&&this.metalnessMap.isTexture&&(d.metalnessMap=this.metalnessMap.toJSON(a).uuid);this.emissiveMap&&this.emissiveMap.isTexture&&(d.emissiveMap=this.emissiveMap.toJSON(a).uuid);this.specularMap&&this.specularMap.isTexture&&(d.specularMap=this.specularMap.toJSON(a).uuid);this.envMap&&this.envMap.isTexture&&
(d.envMap=this.envMap.toJSON(a).uuid,d.reflectivity=this.reflectivity);this.gradientMap&&this.gradientMap.isTexture&&(d.gradientMap=this.gradientMap.toJSON(a).uuid);void 0!==this.size&&(d.size=this.size);void 0!==this.sizeAttenuation&&(d.sizeAttenuation=this.sizeAttenuation);1!==this.blending&&(d.blending=this.blending);!0===this.flatShading&&(d.flatShading=this.flatShading);0!==this.side&&(d.side=this.side);0!==this.vertexColors&&(d.vertexColors=this.vertexColors);1>this.opacity&&(d.opacity=this.opacity);
!0===this.transparent&&(d.transparent=this.transparent);d.depthFunc=this.depthFunc;d.depthTest=this.depthTest;d.depthWrite=this.depthWrite;0!==this.rotation&&(d.rotation=this.rotation);1!==this.linewidth&&(d.linewidth=this.linewidth);void 0!==this.dashSize&&(d.dashSize=this.dashSize);void 0!==this.gapSize&&(d.gapSize=this.gapSize);void 0!==this.scale&&(d.scale=this.scale);!0===this.dithering&&(d.dithering=!0);0<this.alphaTest&&(d.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(d.premultipliedAlpha=
this.premultipliedAlpha);!0===this.wireframe&&(d.wireframe=this.wireframe);1<this.wireframeLinewidth&&(d.wireframeLinewidth=this.wireframeLinewidth);"round"!==this.wireframeLinecap&&(d.wireframeLinecap=this.wireframeLinecap);"round"!==this.wireframeLinejoin&&(d.wireframeLinejoin=this.wireframeLinejoin);!0===this.morphTargets&&(d.morphTargets=!0);!0===this.skinning&&(d.skinning=!0);!1===this.visible&&(d.visible=!1);"{}"!==JSON.stringify(this.userData)&&(d.userData=this.userData);c&&(c=b(a.textures),
a=b(a.images),0<c.length&&(d.textures=c),0<a.length&&(d.images=a));return d},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.name=a.name;this.fog=a.fog;this.lights=a.lights;this.blending=a.blending;this.side=a.side;this.flatShading=a.flatShading;this.vertexColors=a.vertexColors;this.opacity=a.opacity;this.transparent=a.transparent;this.blendSrc=a.blendSrc;this.blendDst=a.blendDst;this.blendEquation=a.blendEquation;this.blendSrcAlpha=a.blendSrcAlpha;this.blendDstAlpha=
a.blendDstAlpha;this.blendEquationAlpha=a.blendEquationAlpha;this.depthFunc=a.depthFunc;this.depthTest=a.depthTest;this.depthWrite=a.depthWrite;this.colorWrite=a.colorWrite;this.precision=a.precision;this.polygonOffset=a.polygonOffset;this.polygonOffsetFactor=a.polygonOffsetFactor;this.polygonOffsetUnits=a.polygonOffsetUnits;this.dithering=a.dithering;this.alphaTest=a.alphaTest;this.premultipliedAlpha=a.premultipliedAlpha;this.overdraw=a.overdraw;this.visible=a.visible;this.userData=JSON.parse(JSON.stringify(a.userData));
this.clipShadows=a.clipShadows;this.clipIntersection=a.clipIntersection;var b=a.clippingPlanes,c=null;if(null!==b){var d=b.length;c=Array(d);for(var e=0;e!==d;++e)c[e]=b[e].clone()}this.clippingPlanes=c;this.shadowSide=a.shadowSide;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});za.prototype=Object.create(O.prototype);za.prototype.constructor=za;za.prototype.isMeshBasicMaterial=!0;za.prototype.copy=function(a){O.prototype.copy.call(this,a);this.color.copy(a.color);this.map=
a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=
a.morphTargets;return this};va.prototype=Object.create(O.prototype);va.prototype.constructor=va;va.prototype.isShaderMaterial=!0;va.prototype.copy=function(a){O.prototype.copy.call(this,a);this.fragmentShader=a.fragmentShader;this.vertexShader=a.vertexShader;this.uniforms=Da.clone(a.uniforms);this.defines=a.defines;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.lights=a.lights;this.clipping=a.clipping;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=
a.morphNormals;this.extensions=a.extensions;return this};va.prototype.toJSON=function(a){a=O.prototype.toJSON.call(this,a);a.uniforms=this.uniforms;a.vertexShader=this.vertexShader;a.fragmentShader=this.fragmentShader;return a};Object.assign(qb.prototype,{set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){void 0===
b&&(console.warn("THREE.Ray: .at() target is now required"),b=new p);return b.copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){this.direction.copy(a).sub(this.origin).normalize();return this},recast:function(){var a=new p;return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(a,b){void 0===b&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),b=new p);b.subVectors(a,this.origin);a=b.dot(this.direction);return 0>
a?b.copy(this.origin):b.copy(this.direction).multiplyScalar(a).add(this.origin)},distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},distanceSqToPoint:function(){var a=new p;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceToSquared(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);return a.distanceToSquared(b)}}(),distanceSqToSegment:function(){var a=new p,b=new p,c=new p;return function(d,e,f,g){a.copy(d).add(e).multiplyScalar(.5);
b.copy(e).sub(d).normalize();c.copy(this.origin).sub(a);var h=.5*d.distanceTo(e),l=-this.direction.dot(b),m=c.dot(this.direction),k=-c.dot(b),n=c.lengthSq(),p=Math.abs(1-l*l);if(0<p){d=l*k-m;e=l*m-k;var r=h*p;0<=d?e>=-r?e<=r?(h=1/p,d*=h,e*=h,l=d*(d+l*e+2*m)+e*(l*d+e+2*k)+n):(e=h,d=Math.max(0,-(l*e+m)),l=-d*d+e*(e+2*k)+n):(e=-h,d=Math.max(0,-(l*e+m)),l=-d*d+e*(e+2*k)+n):e<=-r?(d=Math.max(0,-(-l*h+m)),e=0<d?-h:Math.min(Math.max(-h,-k),h),l=-d*d+e*(e+2*k)+n):e<=r?(d=0,e=Math.min(Math.max(-h,-k),h),l=
e*(e+2*k)+n):(d=Math.max(0,-(l*h+m)),e=0<d?h:Math.min(Math.max(-h,-k),h),l=-d*d+e*(e+2*k)+n)}else e=0<l?-h:h,d=Math.max(0,-(l*e+m)),l=-d*d+e*(e+2*k)+n;f&&f.copy(this.direction).multiplyScalar(d).add(this.origin);g&&g.copy(b).multiplyScalar(e).add(a);return l}}(),intersectSphere:function(){var a=new p;return function(b,c){a.subVectors(b.center,this.origin);var d=a.dot(this.direction),e=a.dot(a)-d*d;b=b.radius*b.radius;if(e>b)return null;b=Math.sqrt(b-e);e=d-b;d+=b;return 0>e&&0>d?null:0>e?this.at(d,
c):this.at(e,c)}}(),intersectsSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){a=this.distanceToPlane(a);return null===a?null:this.at(a,b)},intersectsPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},intersectBox:function(a,
b){var c=1/this.direction.x;var d=1/this.direction.y;var e=1/this.direction.z,f=this.origin;if(0<=c){var g=(a.min.x-f.x)*c;c*=a.max.x-f.x}else g=(a.max.x-f.x)*c,c*=a.min.x-f.x;if(0<=d){var h=(a.min.y-f.y)*d;d*=a.max.y-f.y}else h=(a.max.y-f.y)*d,d*=a.min.y-f.y;if(g>d||h>c)return null;if(h>g||g!==g)g=h;if(d<c||c!==c)c=d;0<=e?(h=(a.min.z-f.z)*e,a=(a.max.z-f.z)*e):(h=(a.max.z-f.z)*e,a=(a.min.z-f.z)*e);if(g>a||h>c)return null;if(h>g||g!==g)g=h;if(a<c||c!==c)c=a;return 0>c?null:this.at(0<=g?g:c,b)},intersectsBox:function(){var a=
new p;return function(b){return null!==this.intersectBox(b,a)}}(),intersectTriangle:function(){var a=new p,b=new p,c=new p,d=new p;return function(e,f,g,h,l){b.subVectors(f,e);c.subVectors(g,e);d.crossVectors(b,c);f=this.direction.dot(d);if(0<f){if(h)return null;h=1}else if(0>f)h=-1,f=-f;else return null;a.subVectors(this.origin,e);e=h*this.direction.dot(c.crossVectors(a,c));if(0>e)return null;g=h*this.direction.dot(b.cross(a));if(0>g||e+g>f)return null;e=-h*a.dot(d);return 0>e?null:this.at(e/f,l)}}(),
applyMatrix4:function(a){this.origin.applyMatrix4(a);this.direction.transformDirection(a);return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}});Object.assign(Lb.prototype,{set:function(a,b){this.start.copy(a);this.end.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},getCenter:function(a){void 0===a&&(console.warn("THREE.Line3: .getCenter() target is now required"),
a=new p);return a.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){void 0===a&&(console.warn("THREE.Line3: .delta() target is now required"),a=new p);return a.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,b){void 0===b&&(console.warn("THREE.Line3: .at() target is now required"),b=new p);return this.delta(b).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=
new p,b=new p;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);c=b.dot(b);c=b.dot(a)/c;d&&(c=S.clamp(c,0,1));return c}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);void 0===c&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),c=new p);return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);this.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&
a.end.equals(this.end)}});Object.assign(Aa,{getNormal:function(){var a=new p;return function(b,c,d,e){void 0===e&&(console.warn("THREE.Triangle: .getNormal() target is now required"),e=new p);e.subVectors(d,c);a.subVectors(b,c);e.cross(a);b=e.lengthSq();return 0<b?e.multiplyScalar(1/Math.sqrt(b)):e.set(0,0,0)}}(),getBarycoord:function(){var a=new p,b=new p,c=new p;return function(d,e,f,g,h){a.subVectors(g,e);b.subVectors(f,e);c.subVectors(d,e);d=a.dot(a);e=a.dot(b);f=a.dot(c);var l=b.dot(b);g=b.dot(c);
var m=d*l-e*e;void 0===h&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),h=new p);if(0===m)return h.set(-2,-1,-1);m=1/m;l=(l*f-e*g)*m;d=(d*g-e*f)*m;return h.set(1-l-d,d,l)}}(),containsPoint:function(){var a=new p;return function(b,c,d,e){Aa.getBarycoord(b,c,d,e,a);return 0<=a.x&&0<=a.y&&1>=a.x+a.y}}()});Object.assign(Aa.prototype,{set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);
this.c.copy(a[d]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},getArea:function(){var a=new p,b=new p;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,this.b);return.5*a.cross(b).length()}}(),getMidpoint:function(a){void 0===a&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),a=new p);return a.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(a){return Aa.getNormal(this.a,
this.b,this.c,a)},getPlane:function(a){void 0===a&&(console.warn("THREE.Triangle: .getPlane() target is now required"),a=new p);return a.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(a,b){return Aa.getBarycoord(a,this.a,this.b,this.c,b)},containsPoint:function(a){return Aa.containsPoint(a,this.a,this.b,this.c)},intersectsBox:function(a){return a.intersectsTriangle(this)},closestPointToPoint:function(){var a=new Fa,b=[new Lb,new Lb,new Lb],c=new p,d=new p;return function(e,f){void 0===
f&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),f=new p);var g=Infinity;a.setFromCoplanarPoints(this.a,this.b,this.c);a.projectPoint(e,c);if(!0===this.containsPoint(c))f.copy(c);else for(b[0].set(this.a,this.b),b[1].set(this.b,this.c),b[2].set(this.c,this.a),e=0;e<b.length;e++){b[e].closestPointToPoint(c,!0,d);var h=c.distanceToSquared(d);h<g&&(g=h,f.copy(d))}return f}}(),equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}});oa.prototype=
Object.assign(Object.create(A.prototype),{constructor:oa,isMesh:!0,setDrawMode:function(a){this.drawMode=a},copy:function(a){A.prototype.copy.call(this,a);this.drawMode=a.drawMode;void 0!==a.morphTargetInfluences&&(this.morphTargetInfluences=a.morphTargetInfluences.slice());void 0!==a.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},a.morphTargetDictionary));return this},updateMorphTargets:function(){var a=this.geometry;if(a.isBufferGeometry){a=a.morphAttributes;var b=Object.keys(a);
if(0<b.length){var c=a[b[0]];if(void 0!==c)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},a=0,b=c.length;a<b;a++){var d=c[a].name||String(a);this.morphTargetInfluences.push(0);this.morphTargetDictionary[d]=a}}}else if(c=a.morphTargets,void 0!==c&&0<c.length)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},a=0,b=c.length;a<b;a++)d=c[a].name||String(a),this.morphTargetInfluences.push(0),this.morphTargetDictionary[d]=a},raycast:function(){function a(a,b,c,d,e,f,g){Aa.getBarycoord(a,
b,c,d,v);e.multiplyScalar(v.x);f.multiplyScalar(v.y);g.multiplyScalar(v.z);e.add(f).add(g);return e.clone()}function b(a,b,c,d,e,f,g,h){if(null===(1===b.side?d.intersectTriangle(g,f,e,!0,h):d.intersectTriangle(e,f,g,2!==b.side,h)))return null;y.copy(h);y.applyMatrix4(a.matrixWorld);b=c.ray.origin.distanceTo(y);return b<c.near||b>c.far?null:{distance:b,point:y.clone(),object:a}}function c(c,d,e,f,m,k,n,p){g.fromBufferAttribute(f,k);h.fromBufferAttribute(f,n);l.fromBufferAttribute(f,p);if(c=b(c,c.material,
d,e,g,h,l,x))m&&(t.fromBufferAttribute(m,k),r.fromBufferAttribute(m,n),q.fromBufferAttribute(m,p),c.uv=a(x,g,h,l,t,r,q)),m=new Wa(k,n,p),Aa.getNormal(g,h,l,m.normal),c.face=m,c.faceIndex=k;return c}var d=new M,e=new qb,f=new Ea,g=new p,h=new p,l=new p,m=new p,k=new p,n=new p,t=new C,r=new C,q=new C,v=new p,x=new p,y=new p;return function(p,u){var v=this.geometry,w=this.material,y=this.matrixWorld;if(void 0!==w&&(null===v.boundingSphere&&v.computeBoundingSphere(),f.copy(v.boundingSphere),f.applyMatrix4(y),
!1!==p.ray.intersectsSphere(f)&&(d.getInverse(y),e.copy(p.ray).applyMatrix4(d),null===v.boundingBox||!1!==e.intersectsBox(v.boundingBox)))){var B;if(v.isBufferGeometry){w=v.index;var C=v.attributes.position;y=v.attributes.uv;var A;if(null!==w){var z=0;for(A=w.count;z<A;z+=3){v=w.getX(z);var E=w.getX(z+1);var F=w.getX(z+2);if(B=c(this,p,e,C,y,v,E,F))B.faceIndex=Math.floor(z/3),u.push(B)}}else if(void 0!==C)for(z=0,A=C.count;z<A;z+=3)if(v=z,E=z+1,F=z+2,B=c(this,p,e,C,y,v,E,F))B.index=v,u.push(B)}else if(v.isGeometry){y=
Array.isArray(w);z=v.vertices;A=v.faces;E=v.faceVertexUvs[0];0<E.length&&(C=E);for(var I=0,L=A.length;I<L;I++){var Q=A[I];B=y?w[Q.materialIndex]:w;if(void 0!==B){E=z[Q.a];F=z[Q.b];var N=z[Q.c];if(!0===B.morphTargets){var M=v.morphTargets,O=this.morphTargetInfluences;g.set(0,0,0);h.set(0,0,0);l.set(0,0,0);for(var T=0,S=M.length;T<S;T++){var V=O[T];if(0!==V){var X=M[T].vertices;g.addScaledVector(m.subVectors(X[Q.a],E),V);h.addScaledVector(k.subVectors(X[Q.b],F),V);l.addScaledVector(n.subVectors(X[Q.c],
N),V)}}g.add(E);h.add(F);l.add(N);E=g;F=h;N=l}if(B=b(this,B,p,e,E,F,N,x))C&&C[I]&&(M=C[I],t.copy(M[0]),r.copy(M[1]),q.copy(M[2]),B.uv=a(x,E,F,N,t,r,q)),B.face=Q,B.faceIndex=I,u.push(B)}}}}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});ab.prototype=Object.create(Y.prototype);ab.prototype.constructor=ab;ab.prototype.isCubeTexture=!0;Object.defineProperty(ab.prototype,"images",{get:function(){return this.image},set:function(a){this.image=a}});var Je=new Y,
Ke=new ab,Ee=[],Ge=[],Ie=new Float32Array(16),He=new Float32Array(9);Oe.prototype.setValue=function(a,b){for(var c=this.seq,d=0,e=c.length;d!==e;++d){var f=c[d];f.setValue(a,b[f.id])}};var Ud=/([\w\d_]+)(\])?(\[|\.)?/g;bb.prototype.setValue=function(a,b,c){b=this.map[b];void 0!==b&&b.setValue(a,c,this.renderer)};bb.prototype.setOptional=function(a,b,c){b=b[c];void 0!==b&&this.setValue(a,c,b)};bb.upload=function(a,b,c,d){for(var e=0,f=b.length;e!==f;++e){var g=b[e],h=c[g.id];!1!==h.needsUpdate&&g.setValue(a,
h.value,d)}};bb.seqWithValue=function(a,b){for(var c=[],d=0,e=a.length;d!==e;++d){var f=a[d];f.id in b&&c.push(f)}return c};var rg=0,Ag=0;cb.prototype=Object.create(O.prototype);cb.prototype.constructor=cb;cb.prototype.isMeshDepthMaterial=!0;cb.prototype.copy=function(a){O.prototype.copy.call(this,a);this.depthPacking=a.depthPacking;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;
this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};db.prototype=Object.create(O.prototype);db.prototype.constructor=db;db.prototype.isMeshDistanceMaterial=!0;db.prototype.copy=function(a){O.prototype.copy.call(this,a);this.referencePosition.copy(a.referencePosition);this.nearDistance=a.nearDistance;this.farDistance=a.farDistance;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.map=a.map;this.alphaMap=a.alphaMap;
this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;return this};zc.prototype=Object.create(Y.prototype);zc.prototype.constructor=zc;la.prototype=Object.assign(Object.create(Qa.prototype),{constructor:la,isPerspectiveCamera:!0,copy:function(a,b){Qa.prototype.copy.call(this,a,b);this.fov=a.fov;this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.focus=a.focus;this.aspect=a.aspect;this.view=null===a.view?null:Object.assign({},a.view);
this.filmGauge=a.filmGauge;this.filmOffset=a.filmOffset;return this},setFocalLength:function(a){a=.5*this.getFilmHeight()/a;this.fov=2*S.RAD2DEG*Math.atan(a);this.updateProjectionMatrix()},getFocalLength:function(){var a=Math.tan(.5*S.DEG2RAD*this.fov);return.5*this.getFilmHeight()/a},getEffectiveFOV:function(){return 2*S.RAD2DEG*Math.atan(Math.tan(.5*S.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/
Math.max(this.aspect,1)},setViewOffset:function(a,b,c,d,e,f){this.aspect=a/b;null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1});this.view.enabled=!0;this.view.fullWidth=a;this.view.fullHeight=b;this.view.offsetX=c;this.view.offsetY=d;this.view.width=e;this.view.height=f;this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1);this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=this.near,
b=a*Math.tan(.5*S.DEG2RAD*this.fov)/this.zoom,c=2*b,d=this.aspect*c,e=-.5*d,f=this.view;if(null!==this.view&&this.view.enabled){var g=f.fullWidth,h=f.fullHeight;e+=f.offsetX*d/g;b-=f.offsetY*c/h;d*=f.width/g;c*=f.height/h}f=this.filmOffset;0!==f&&(e+=a*f/this.getFilmWidth());this.projectionMatrix.makePerspective(e,e+d,b,b-c,a,this.far)},toJSON:function(a){a=A.prototype.toJSON.call(this,a);a.object.fov=this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;
a.object.aspect=this.aspect;null!==this.view&&(a.object.view=Object.assign({},this.view));a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return a}});qd.prototype=Object.assign(Object.create(la.prototype),{constructor:qd,isArrayCamera:!0});Ob.prototype.isFogExp2=!0;Ob.prototype.clone=function(){return new Ob(this.color.getHex(),this.density)};Ob.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};Pb.prototype.isFog=!0;Pb.prototype.clone=
function(){return new Pb(this.color.getHex(),this.near,this.far)};Pb.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}};rd.prototype=Object.assign(Object.create(A.prototype),{constructor:rd,copy:function(a,b){A.prototype.copy.call(this,a,b);null!==a.background&&(this.background=a.background.clone());null!==a.fog&&(this.fog=a.fog.clone());null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone());this.autoUpdate=a.autoUpdate;this.matrixAutoUpdate=
a.matrixAutoUpdate;return this},toJSON:function(a){var b=A.prototype.toJSON.call(this,a);null!==this.background&&(b.object.background=this.background.toJSON(a));null!==this.fog&&(b.object.fog=this.fog.toJSON());return b}});eb.prototype=Object.create(O.prototype);eb.prototype.constructor=eb;eb.prototype.isSpriteMaterial=!0;eb.prototype.copy=function(a){O.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.rotation=a.rotation;return this};Ac.prototype=Object.assign(Object.create(A.prototype),
{constructor:Ac,isSprite:!0,raycast:function(){var a=new p,b=new p,c=new p;return function(d,e){b.setFromMatrixPosition(this.matrixWorld);d.ray.closestPointToPoint(b,a);c.setFromMatrixScale(this.matrixWorld);var f=c.x*c.y/4;b.distanceToSquared(a)>f||(f=d.ray.origin.distanceTo(a),f<d.near||f>d.far||e.push({distance:f,point:a.clone(),face:null,object:this}))}}(),clone:function(){return(new this.constructor(this.material)).copy(this)},copy:function(a){A.prototype.copy.call(this,a);void 0!==a.center&&
this.center.copy(a.center);return this}});Bc.prototype=Object.assign(Object.create(A.prototype),{constructor:Bc,copy:function(a){A.prototype.copy.call(this,a,!1);a=a.levels;for(var b=0,c=a.length;b<c;b++){var d=a[b];this.addLevel(d.object.clone(),d.distance)}return this},addLevel:function(a,b){void 0===b&&(b=0);b=Math.abs(b);for(var c=this.levels,d=0;d<c.length&&!(b<c[d].distance);d++);c.splice(d,0,{distance:b,object:a});this.add(a)},getObjectForDistance:function(a){for(var b=this.levels,c=1,d=b.length;c<
d&&!(a<b[c].distance);c++);return b[c-1].object},raycast:function(){var a=new p;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var d=b.ray.origin.distanceTo(a);this.getObjectForDistance(d).raycast(b,c)}}(),update:function(){var a=new p,b=new p;return function(c){var d=this.levels;if(1<d.length){a.setFromMatrixPosition(c.matrixWorld);b.setFromMatrixPosition(this.matrixWorld);c=a.distanceTo(b);d[0].object.visible=!0;for(var e=1,f=d.length;e<f;e++)if(c>=d[e].distance)d[e-1].object.visible=
!1,d[e].object.visible=!0;else break;for(;e<f;e++)d[e].object.visible=!1}}}(),toJSON:function(a){a=A.prototype.toJSON.call(this,a);a.object.levels=[];for(var b=this.levels,c=0,d=b.length;c<d;c++){var e=b[c];a.object.levels.push({object:e.object.uuid,distance:e.distance})}return a}});Object.assign(Cc.prototype,{calculateInverses:function(){this.boneInverses=[];for(var a=0,b=this.bones.length;a<b;a++){var c=new M;this.bones[a]&&c.getInverse(this.bones[a].matrixWorld);this.boneInverses.push(c)}},pose:function(){var a,
b;var c=0;for(b=this.bones.length;c<b;c++)(a=this.bones[c])&&a.matrixWorld.getInverse(this.boneInverses[c]);c=0;for(b=this.bones.length;c<b;c++)if(a=this.bones[c])a.parent&&a.parent.isBone?(a.matrix.getInverse(a.parent.matrixWorld),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale)},update:function(){var a=new M,b=new M;return function(){for(var c=this.bones,d=this.boneInverses,e=this.boneMatrices,f=this.boneTexture,g=0,h=c.length;g<
h;g++)a.multiplyMatrices(c[g]?c[g].matrixWorld:b,d[g]),a.toArray(e,16*g);void 0!==f&&(f.needsUpdate=!0)}}(),clone:function(){return new Cc(this.bones,this.boneInverses)},getBoneByName:function(a){for(var b=0,c=this.bones.length;b<c;b++){var d=this.bones[b];if(d.name===a)return d}}});sd.prototype=Object.assign(Object.create(A.prototype),{constructor:sd,isBone:!0});td.prototype=Object.assign(Object.create(oa.prototype),{constructor:td,isSkinnedMesh:!0,initBones:function(){var a=[],b;if(this.geometry&&
void 0!==this.geometry.bones){var c=0;for(b=this.geometry.bones.length;c<b;c++){var d=this.geometry.bones[c];var e=new sd;a.push(e);e.name=d.name;e.position.fromArray(d.pos);e.quaternion.fromArray(d.rotq);void 0!==d.scl&&e.scale.fromArray(d.scl)}c=0;for(b=this.geometry.bones.length;c<b;c++)d=this.geometry.bones[c],-1!==d.parent&&null!==d.parent&&void 0!==a[d.parent]?a[d.parent].add(a[c]):this.add(a[c])}this.updateMatrixWorld(!0);return a},bind:function(a,b){this.skeleton=a;void 0===b&&(this.updateMatrixWorld(!0),
this.skeleton.calculateInverses(),b=this.matrixWorld);this.bindMatrix.copy(b);this.bindMatrixInverse.getInverse(b)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var a;if(this.geometry&&this.geometry.isGeometry)for(a=0;a<this.geometry.skinWeights.length;a++){var b=this.geometry.skinWeights[a];var c=1/b.manhattanLength();Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){b=new ea;var d=this.geometry.attributes.skinWeight;for(a=
0;a<d.count;a++)b.x=d.getX(a),b.y=d.getY(a),b.z=d.getZ(a),b.w=d.getW(a),c=1/b.manhattanLength(),Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0),d.setXYZW(a,b.x,b.y,b.z,b.w)}},updateMatrixWorld:function(a){oa.prototype.updateMatrixWorld.call(this,a);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return(new this.constructor(this.geometry,
this.material)).copy(this)}});U.prototype=Object.create(O.prototype);U.prototype.constructor=U;U.prototype.isLineBasicMaterial=!0;U.prototype.copy=function(a){O.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.linecap=a.linecap;this.linejoin=a.linejoin;return this};ua.prototype=Object.assign(Object.create(A.prototype),{constructor:ua,isLine:!0,computeLineDistances:function(){var a=new p,b=new p;return function(){var c=this.geometry;if(c.isBufferGeometry)if(null===
c.index){for(var d=c.attributes.position,e=[0],f=1,g=d.count;f<g;f++)a.fromBufferAttribute(d,f-1),b.fromBufferAttribute(d,f),e[f]=e[f-1],e[f]+=a.distanceTo(b);c.addAttribute("lineDistance",new THREE.Float32BufferAttribute(e,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(c.isGeometry)for(d=c.vertices,e=c.lineDistances,e[0]=0,f=1,g=d.length;f<g;f++)e[f]=e[f-1],e[f]+=d[f-1].distanceTo(d[f]);return this}}(),raycast:function(){var a=
new M,b=new qb,c=new Ea;return function(d,e){var f=d.linePrecision;f*=f;var g=this.geometry,h=this.matrixWorld;null===g.boundingSphere&&g.computeBoundingSphere();c.copy(g.boundingSphere);c.applyMatrix4(h);if(!1!==d.ray.intersectsSphere(c)){a.getInverse(h);b.copy(d.ray).applyMatrix4(a);var l=new p,m=new p;h=new p;var k=new p,n=this&&this.isLineSegments?2:1;if(g.isBufferGeometry){var t=g.index,r=g.attributes.position.array;if(null!==t){t=t.array;g=0;for(var q=t.length-1;g<q;g+=n){var v=t[g+1];l.fromArray(r,
3*t[g]);m.fromArray(r,3*v);v=b.distanceSqToSegment(l,m,k,h);v>f||(k.applyMatrix4(this.matrixWorld),v=d.ray.origin.distanceTo(k),v<d.near||v>d.far||e.push({distance:v,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}}else for(g=0,q=r.length/3-1;g<q;g+=n)l.fromArray(r,3*g),m.fromArray(r,3*g+3),v=b.distanceSqToSegment(l,m,k,h),v>f||(k.applyMatrix4(this.matrixWorld),v=d.ray.origin.distanceTo(k),v<d.near||v>d.far||e.push({distance:v,point:h.clone().applyMatrix4(this.matrixWorld),
index:g,face:null,faceIndex:null,object:this}))}else if(g.isGeometry)for(l=g.vertices,m=l.length,g=0;g<m-1;g+=n)v=b.distanceSqToSegment(l[g],l[g+1],k,h),v>f||(k.applyMatrix4(this.matrixWorld),v=d.ray.origin.distanceTo(k),v<d.near||v>d.far||e.push({distance:v,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});aa.prototype=Object.assign(Object.create(ua.prototype),
{constructor:aa,isLineSegments:!0,computeLineDistances:function(){var a=new p,b=new p;return function(){var c=this.geometry;if(c.isBufferGeometry)if(null===c.index){for(var d=c.attributes.position,e=[],f=0,g=d.count;f<g;f+=2)a.fromBufferAttribute(d,f),b.fromBufferAttribute(d,f+1),e[f]=0===f?0:e[f-1],e[f+1]=e[f]+a.distanceTo(b);c.addAttribute("lineDistance",new THREE.Float32BufferAttribute(e,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");
else if(c.isGeometry)for(d=c.vertices,e=c.lineDistances,f=0,g=d.length;f<g;f+=2)a.copy(d[f]),b.copy(d[f+1]),e[f]=0===f?0:e[f-1],e[f+1]=e[f]+a.distanceTo(b);return this}}()});ud.prototype=Object.assign(Object.create(ua.prototype),{constructor:ud,isLineLoop:!0});Ha.prototype=Object.create(O.prototype);Ha.prototype.constructor=Ha;Ha.prototype.isPointsMaterial=!0;Ha.prototype.copy=function(a){O.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.size=a.size;this.sizeAttenuation=a.sizeAttenuation;
return this};Qb.prototype=Object.assign(Object.create(A.prototype),{constructor:Qb,isPoints:!0,raycast:function(){var a=new M,b=new qb,c=new Ea;return function(d,e){function f(a,c){var f=b.distanceSqToPoint(a);f<k&&(b.closestPointToPoint(a,n),n.applyMatrix4(l),a=d.ray.origin.distanceTo(n),a<d.near||a>d.far||e.push({distance:a,distanceToRay:Math.sqrt(f),point:n.clone(),index:c,face:null,object:g}))}var g=this,h=this.geometry,l=this.matrixWorld,m=d.params.Points.threshold;null===h.boundingSphere&&h.computeBoundingSphere();
c.copy(h.boundingSphere);c.applyMatrix4(l);c.radius+=m;if(!1!==d.ray.intersectsSphere(c)){a.getInverse(l);b.copy(d.ray).applyMatrix4(a);m/=(this.scale.x+this.scale.y+this.scale.z)/3;var k=m*m;m=new p;var n=new p;if(h.isBufferGeometry){var t=h.index;h=h.attributes.position.array;if(null!==t){var r=t.array;t=0;for(var q=r.length;t<q;t++){var v=r[t];m.fromArray(h,3*v);f(m,v)}}else for(t=0,r=h.length/3;t<r;t++)m.fromArray(h,3*t),f(m,t)}else for(m=h.vertices,t=0,r=m.length;t<r;t++)f(m[t],t)}}}(),clone:function(){return(new this.constructor(this.geometry,
this.material)).copy(this)}});vd.prototype=Object.assign(Object.create(A.prototype),{constructor:vd,isGroup:!0});Yd.prototype=Object.assign(Object.create(Y.prototype),{constructor:Yd,isVideoTexture:!0,update:function(){var a=this.image;a.readyState>=a.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});Rb.prototype=Object.create(Y.prototype);Rb.prototype.constructor=Rb;Rb.prototype.isCompressedTexture=!0;Dc.prototype=Object.create(Y.prototype);Dc.prototype.constructor=Dc;Dc.prototype.isDepthTexture=!0;Sb.prototype=
Object.create(F.prototype);Sb.prototype.constructor=Sb;Ec.prototype=Object.create(N.prototype);Ec.prototype.constructor=Ec;Tb.prototype=Object.create(F.prototype);Tb.prototype.constructor=Tb;Fc.prototype=Object.create(N.prototype);Fc.prototype.constructor=Fc;pa.prototype=Object.create(F.prototype);pa.prototype.constructor=pa;Gc.prototype=Object.create(N.prototype);Gc.prototype.constructor=Gc;Ub.prototype=Object.create(pa.prototype);Ub.prototype.constructor=Ub;Hc.prototype=Object.create(N.prototype);
Hc.prototype.constructor=Hc;sb.prototype=Object.create(pa.prototype);sb.prototype.constructor=sb;Ic.prototype=Object.create(N.prototype);Ic.prototype.constructor=Ic;Vb.prototype=Object.create(pa.prototype);Vb.prototype.constructor=Vb;Jc.prototype=Object.create(N.prototype);Jc.prototype.constructor=Jc;Wb.prototype=Object.create(pa.prototype);Wb.prototype.constructor=Wb;Kc.prototype=Object.create(N.prototype);Kc.prototype.constructor=Kc;Xb.prototype=Object.create(F.prototype);Xb.prototype.constructor=
Xb;Lc.prototype=Object.create(N.prototype);Lc.prototype.constructor=Lc;Yb.prototype=Object.create(F.prototype);Yb.prototype.constructor=Yb;Mc.prototype=Object.create(N.prototype);Mc.prototype.constructor=Mc;Zb.prototype=Object.create(F.prototype);Zb.prototype.constructor=Zb;var Lg={triangulate:function(a,b,c){c=c||2;var d=b&&b.length,e=d?b[0]*c:a.length,f=Xe(a,0,e,c,!0),g=[];if(!f)return g;var h;if(d){var l=c;d=[];var m;var k=0;for(m=b.length;k<m;k++){var n=b[k]*l;var p=k<m-1?b[k+1]*l:a.length;n=
Xe(a,n,p,l,!1);n===n.next&&(n.steiner=!0);d.push(Jg(n))}d.sort(Hg);for(k=0;k<d.length;k++){b=d[k];l=f;if(l=Ig(b,l))b=$e(l,b),Oc(b,b.next);f=Oc(f,f.next)}}if(a.length>80*c){var r=h=a[0];var q=d=a[1];for(l=c;l<e;l+=c)k=a[l],b=a[l+1],k<r&&(r=k),b<q&&(q=b),k>h&&(h=k),b>d&&(d=b);h=Math.max(h-r,d-q);h=0!==h?1/h:0}Pc(f,g,c,r,q,h);return g}},Xa={area:function(a){for(var b=a.length,c=0,d=b-1,e=0;e<b;d=e++)c+=a[d].x*a[e].y-a[e].x*a[d].y;return.5*c},isClockWise:function(a){return 0>Xa.area(a)},triangulateShape:function(a,
b){var c=[],d=[],e=[];af(a);bf(c,a);var f=a.length;b.forEach(af);for(a=0;a<b.length;a++)d.push(f),f+=b[a].length,bf(c,b[a]);b=Lg.triangulate(c,d);for(a=0;a<b.length;a+=3)e.push(b.slice(a,a+3));return e}};fb.prototype=Object.create(N.prototype);fb.prototype.constructor=fb;Ia.prototype=Object.create(F.prototype);Ia.prototype.constructor=Ia;Ia.prototype.getArrays=function(){var a=this.getAttribute("position");a=a?Array.prototype.slice.call(a.array):[];var b=this.getAttribute("uv");b=b?Array.prototype.slice.call(b.array):
[];var c=this.index;c=c?Array.prototype.slice.call(c.array):[];return{position:a,uv:b,index:c}};Ia.prototype.addShapeList=function(a,b){var c=a.length;b.arrays=this.getArrays();for(var d=0;d<c;d++)this.addShape(a[d],b);this.setIndex(b.arrays.index);this.addAttribute("position",new z(b.arrays.position,3));this.addAttribute("uv",new z(b.arrays.uv,2))};Ia.prototype.addShape=function(a,b){function c(a,b,c){b||console.error("THREE.ExtrudeGeometry: vec does not exist");return b.clone().multiplyScalar(c).add(a)}
function d(a,b,c){var d=a.x-b.x;var e=a.y-b.y;var f=c.x-a.x;var g=c.y-a.y,h=d*d+e*e;if(Math.abs(d*g-e*f)>Number.EPSILON){var l=Math.sqrt(h),m=Math.sqrt(f*f+g*g);h=b.x-e/l;b=b.y+d/l;g=((c.x-g/m-h)*g-(c.y+f/m-b)*f)/(d*g-e*f);f=h+d*g-a.x;d=b+e*g-a.y;e=f*f+d*d;if(2>=e)return new C(f,d);e=Math.sqrt(e/2)}else a=!1,d>Number.EPSILON?f>Number.EPSILON&&(a=!0):d<-Number.EPSILON?f<-Number.EPSILON&&(a=!0):Math.sign(e)===Math.sign(g)&&(a=!0),a?(f=-e,e=Math.sqrt(h)):(f=d,d=e,e=Math.sqrt(h/2));return new C(f/e,d/
e)}function e(a,b){for(J=a.length;0<=--J;){var c=J;var d=J-1;0>d&&(d=a.length-1);var e,f=B+2*x;for(e=0;e<f;e++){var g=aa*e,m=aa*(e+1),n=b+d+g,p=b+d+m;m=b+c+m;h(b+c+g);h(n);h(m);h(n);h(p);h(m);g=k.length/3;g=E.generateSideWallUV(T,k,g-6,g-3,g-2,g-1);l(g[0]);l(g[1]);l(g[3]);l(g[1]);l(g[2]);l(g[3])}}}function f(a,b,c){r.push(a);r.push(b);r.push(c)}function g(a,b,c){h(a);h(b);h(c);a=k.length/3;a=E.generateTopUV(T,k,a-3,a-2,a-1);l(a[0]);l(a[1]);l(a[2])}function h(a){n.push(k.length/3);k.push(r[3*a]);k.push(r[3*
a+1]);k.push(r[3*a+2])}function l(a){t.push(a.x);t.push(a.y)}var m=b.arrays?b.arrays:this.getArrays(),k=m.position,n=m.index,t=m.uv,r=[];m=void 0!==b.amount?b.amount:100;var q=void 0!==b.bevelThickness?b.bevelThickness:6,v=void 0!==b.bevelSize?b.bevelSize:q-2,x=void 0!==b.bevelSegments?b.bevelSegments:3,y=void 0!==b.bevelEnabled?b.bevelEnabled:!0,w=void 0!==b.curveSegments?b.curveSegments:12,B=void 0!==b.steps?b.steps:1,G=b.extrudePath,A=!1,E=void 0!==b.UVGenerator?b.UVGenerator:fb.WorldUVGenerator;
if(G){var H=G.getSpacedPoints(B);A=!0;y=!1;var F=void 0!==b.frames?b.frames:G.computeFrenetFrames(B,!1);var I=new p;var N=new p;var L=new p}y||(v=q=x=0);var M,T=this;w=a.extractPoints(w);a=w.shape;var O=w.holes;if(!Xa.isClockWise(a)){a=a.reverse();var Q=0;for(M=O.length;Q<M;Q++){var S=O[Q];Xa.isClockWise(S)&&(O[Q]=S.reverse())}}var V=Xa.triangulateShape(a,O),X=a;Q=0;for(M=O.length;Q<M;Q++)S=O[Q],a=a.concat(S);var U,aa=a.length,Y,da=V.length;w=[];var J=0;var W=X.length;var R=W-1;for(U=J+1;J<W;J++,
R++,U++)R===W&&(R=0),U===W&&(U=0),w[J]=d(X[J],X[R],X[U]);G=[];var ea=w.concat();Q=0;for(M=O.length;Q<M;Q++){S=O[Q];var ca=[];J=0;W=S.length;R=W-1;for(U=J+1;J<W;J++,R++,U++)R===W&&(R=0),U===W&&(U=0),ca[J]=d(S[J],S[R],S[U]);G.push(ca);ea=ea.concat(ca)}for(R=0;R<x;R++){W=R/x;var fa=q*Math.cos(W*Math.PI/2);U=v*Math.sin(W*Math.PI/2);J=0;for(W=X.length;J<W;J++){var ha=c(X[J],w[J],U);f(ha.x,ha.y,-fa)}Q=0;for(M=O.length;Q<M;Q++)for(S=O[Q],ca=G[Q],J=0,W=S.length;J<W;J++)ha=c(S[J],ca[J],U),f(ha.x,ha.y,-fa)}U=
v;for(J=0;J<aa;J++)ha=y?c(a[J],ea[J],U):a[J],A?(N.copy(F.normals[0]).multiplyScalar(ha.x),I.copy(F.binormals[0]).multiplyScalar(ha.y),L.copy(H[0]).add(N).add(I),f(L.x,L.y,L.z)):f(ha.x,ha.y,0);for(W=1;W<=B;W++)for(J=0;J<aa;J++)ha=y?c(a[J],ea[J],U):a[J],A?(N.copy(F.normals[W]).multiplyScalar(ha.x),I.copy(F.binormals[W]).multiplyScalar(ha.y),L.copy(H[W]).add(N).add(I),f(L.x,L.y,L.z)):f(ha.x,ha.y,m/B*W);for(R=x-1;0<=R;R--){W=R/x;fa=q*Math.cos(W*Math.PI/2);U=v*Math.sin(W*Math.PI/2);J=0;for(W=X.length;J<
W;J++)ha=c(X[J],w[J],U),f(ha.x,ha.y,m+fa);Q=0;for(M=O.length;Q<M;Q++)for(S=O[Q],ca=G[Q],J=0,W=S.length;J<W;J++)ha=c(S[J],ca[J],U),A?f(ha.x,ha.y+H[B-1].y,H[B-1].x+fa):f(ha.x,ha.y,m+fa)}(function(){var a=k.length/3;if(y){var b=0*aa;for(J=0;J<da;J++)Y=V[J],g(Y[2]+b,Y[1]+b,Y[0]+b);b=aa*(B+2*x);for(J=0;J<da;J++)Y=V[J],g(Y[0]+b,Y[1]+b,Y[2]+b)}else{for(J=0;J<da;J++)Y=V[J],g(Y[2],Y[1],Y[0]);for(J=0;J<da;J++)Y=V[J],g(Y[0]+aa*B,Y[1]+aa*B,Y[2]+aa*B)}T.addGroup(a,k.length/3-a,0)})();(function(){var a=k.length/
3,b=0;e(X,b);b+=X.length;Q=0;for(M=O.length;Q<M;Q++)S=O[Q],e(S,b),b+=S.length;T.addGroup(a,k.length/3-a,1)})();b.arrays||(this.setIndex(n),this.addAttribute("position",new z(k,3)),this.addAttribute("uv",new z(t,2)))};fb.WorldUVGenerator={generateTopUV:function(a,b,c,d,e){a=b[3*d];d=b[3*d+1];var f=b[3*e];e=b[3*e+1];return[new C(b[3*c],b[3*c+1]),new C(a,d),new C(f,e)]},generateSideWallUV:function(a,b,c,d,e,f){a=b[3*c];var g=b[3*c+1];c=b[3*c+2];var h=b[3*d],l=b[3*d+1];d=b[3*d+2];var m=b[3*e],k=b[3*e+
1];e=b[3*e+2];var n=b[3*f],p=b[3*f+1];b=b[3*f+2];return.01>Math.abs(g-l)?[new C(a,1-c),new C(h,1-d),new C(m,1-e),new C(n,1-b)]:[new C(g,1-c),new C(l,1-d),new C(k,1-e),new C(p,1-b)]}};Rc.prototype=Object.create(N.prototype);Rc.prototype.constructor=Rc;$b.prototype=Object.create(Ia.prototype);$b.prototype.constructor=$b;Sc.prototype=Object.create(N.prototype);Sc.prototype.constructor=Sc;ub.prototype=Object.create(F.prototype);ub.prototype.constructor=ub;Tc.prototype=Object.create(N.prototype);Tc.prototype.constructor=
Tc;ac.prototype=Object.create(F.prototype);ac.prototype.constructor=ac;Uc.prototype=Object.create(N.prototype);Uc.prototype.constructor=Uc;bc.prototype=Object.create(F.prototype);bc.prototype.constructor=bc;vb.prototype=Object.create(N.prototype);vb.prototype.constructor=vb;vb.prototype.toJSON=function(){var a=N.prototype.toJSON.call(this);return cf(this.parameters.shapes,a)};wb.prototype=Object.create(F.prototype);wb.prototype.constructor=wb;wb.prototype.toJSON=function(){var a=F.prototype.toJSON.call(this);
return cf(this.parameters.shapes,a)};cc.prototype=Object.create(F.prototype);cc.prototype.constructor=cc;xb.prototype=Object.create(N.prototype);xb.prototype.constructor=xb;Ya.prototype=Object.create(F.prototype);Ya.prototype.constructor=Ya;Vc.prototype=Object.create(xb.prototype);Vc.prototype.constructor=Vc;Wc.prototype=Object.create(Ya.prototype);Wc.prototype.constructor=Wc;Xc.prototype=Object.create(N.prototype);Xc.prototype.constructor=Xc;dc.prototype=Object.create(F.prototype);dc.prototype.constructor=
dc;var Ca=Object.freeze({WireframeGeometry:Sb,ParametricGeometry:Ec,ParametricBufferGeometry:Tb,TetrahedronGeometry:Gc,TetrahedronBufferGeometry:Ub,OctahedronGeometry:Hc,OctahedronBufferGeometry:sb,IcosahedronGeometry:Ic,IcosahedronBufferGeometry:Vb,DodecahedronGeometry:Jc,DodecahedronBufferGeometry:Wb,PolyhedronGeometry:Fc,PolyhedronBufferGeometry:pa,TubeGeometry:Kc,TubeBufferGeometry:Xb,TorusKnotGeometry:Lc,TorusKnotBufferGeometry:Yb,TorusGeometry:Mc,TorusBufferGeometry:Zb,TextGeometry:Rc,TextBufferGeometry:$b,
SphereGeometry:Sc,SphereBufferGeometry:ub,RingGeometry:Tc,RingBufferGeometry:ac,PlaneGeometry:xc,PlaneBufferGeometry:pb,LatheGeometry:Uc,LatheBufferGeometry:bc,ShapeGeometry:vb,ShapeBufferGeometry:wb,ExtrudeGeometry:fb,ExtrudeBufferGeometry:Ia,EdgesGeometry:cc,ConeGeometry:Vc,ConeBufferGeometry:Wc,CylinderGeometry:xb,CylinderBufferGeometry:Ya,CircleGeometry:Xc,CircleBufferGeometry:dc,BoxGeometry:Kb,BoxBufferGeometry:mb});yb.prototype=Object.create(O.prototype);yb.prototype.constructor=yb;yb.prototype.isShadowMaterial=
!0;yb.prototype.copy=function(a){O.prototype.copy.call(this,a);this.color.copy(a.color);return this};ec.prototype=Object.create(va.prototype);ec.prototype.constructor=ec;ec.prototype.isRawShaderMaterial=!0;Sa.prototype=Object.create(O.prototype);Sa.prototype.constructor=Sa;Sa.prototype.isMeshStandardMaterial=!0;Sa.prototype.copy=function(a){O.prototype.copy.call(this,a);this.defines={STANDARD:""};this.color.copy(a.color);this.roughness=a.roughness;this.metalness=a.metalness;this.map=a.map;this.lightMap=
a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.roughnessMap=a.roughnessMap;this.metalnessMap=
a.metalnessMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.envMapIntensity=a.envMapIntensity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};zb.prototype=Object.create(Sa.prototype);zb.prototype.constructor=zb;zb.prototype.isMeshPhysicalMaterial=
!0;zb.prototype.copy=function(a){Sa.prototype.copy.call(this,a);this.defines={PHYSICAL:""};this.reflectivity=a.reflectivity;this.clearCoat=a.clearCoat;this.clearCoatRoughness=a.clearCoatRoughness;return this};Ja.prototype=Object.create(O.prototype);Ja.prototype.constructor=Ja;Ja.prototype.isMeshPhongMaterial=!0;Ja.prototype.copy=function(a){O.prototype.copy.call(this,a);this.color.copy(a.color);this.specular.copy(a.specular);this.shininess=a.shininess;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=
a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=
a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};Ab.prototype=Object.create(Ja.prototype);Ab.prototype.constructor=Ab;Ab.prototype.isMeshToonMaterial=!0;Ab.prototype.copy=function(a){Ja.prototype.copy.call(this,
a);this.gradientMap=a.gradientMap;return this};Bb.prototype=Object.create(O.prototype);Bb.prototype.constructor=Bb;Bb.prototype.isMeshNormalMaterial=!0;Bb.prototype.copy=function(a){O.prototype.copy.call(this,a);this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;
this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};Cb.prototype=Object.create(O.prototype);Cb.prototype.constructor=Cb;Cb.prototype.isMeshLambertMaterial=!0;Cb.prototype.copy=function(a){O.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=
a.emissiveIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};Db.prototype=Object.create(U.prototype);Db.prototype.constructor=
Db;Db.prototype.isLineDashedMaterial=!0;Db.prototype.copy=function(a){U.prototype.copy.call(this,a);this.scale=a.scale;this.dashSize=a.dashSize;this.gapSize=a.gapSize;return this};var Mg=Object.freeze({ShadowMaterial:yb,SpriteMaterial:eb,RawShaderMaterial:ec,ShaderMaterial:va,PointsMaterial:Ha,MeshPhysicalMaterial:zb,MeshStandardMaterial:Sa,MeshPhongMaterial:Ja,MeshToonMaterial:Ab,MeshNormalMaterial:Bb,MeshLambertMaterial:Cb,MeshDepthMaterial:cb,MeshDistanceMaterial:db,MeshBasicMaterial:za,LineDashedMaterial:Db,
LineBasicMaterial:U,Material:O}),Hb={enabled:!1,files:{},add:function(a,b){!1!==this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}},ma=new ae,$a={};Object.assign(Ka.prototype,{load:function(a,b,c,d){void 0===a&&(a="");void 0!==this.path&&(a=this.path+a);a=this.manager.resolveURL(a);var e=this,f=Hb.get(a);if(void 0!==f)return e.manager.itemStart(a),setTimeout(function(){b&&b(f);e.manager.itemEnd(a)},
0),f;if(void 0!==$a[a])$a[a].push({onLoad:b,onProgress:c,onError:d});else{var g=a.match(/^data:(.*?)(;base64)?,(.*)$/);if(g){c=g[1];var h=!!g[2];g=g[3];g=window.decodeURIComponent(g);h&&(g=window.atob(g));try{var l=(this.responseType||"").toLowerCase();switch(l){case "arraybuffer":case "blob":var m=new Uint8Array(g.length);for(h=0;h<g.length;h++)m[h]=g.charCodeAt(h);var k="blob"===l?new Blob([m.buffer],{type:c}):m.buffer;break;case "document":k=(new DOMParser).parseFromString(g,c);break;case "json":k=
JSON.parse(g);break;default:k=g}window.setTimeout(function(){b&&b(k);e.manager.itemEnd(a)},0)}catch(t){window.setTimeout(function(){d&&d(t);e.manager.itemEnd(a);e.manager.itemError(a)},0)}}else{$a[a]=[];$a[a].push({onLoad:b,onProgress:c,onError:d});var n=new XMLHttpRequest;n.open("GET",a,!0);n.addEventListener("load",function(b){var c=this.response;Hb.add(a,c);var d=$a[a];delete $a[a];if(200===this.status){for(var f=0,g=d.length;f<g;f++){var h=d[f];if(h.onLoad)h.onLoad(c)}e.manager.itemEnd(a)}else if(0===
this.status){console.warn("THREE.FileLoader: HTTP Status 0 received.");f=0;for(g=d.length;f<g;f++)if(h=d[f],h.onLoad)h.onLoad(c);e.manager.itemEnd(a)}else{f=0;for(g=d.length;f<g;f++)if(h=d[f],h.onError)h.onError(b);e.manager.itemEnd(a);e.manager.itemError(a)}},!1);n.addEventListener("progress",function(b){for(var c=$a[a],d=0,e=c.length;d<e;d++){var f=c[d];if(f.onProgress)f.onProgress(b)}},!1);n.addEventListener("error",function(b){var c=$a[a];delete $a[a];for(var d=0,f=c.length;d<f;d++){var g=c[d];
if(g.onError)g.onError(b)}e.manager.itemEnd(a);e.manager.itemError(a)},!1);void 0!==this.responseType&&(n.responseType=this.responseType);void 0!==this.withCredentials&&(n.withCredentials=this.withCredentials);n.overrideMimeType&&n.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(h in this.requestHeader)n.setRequestHeader(h,this.requestHeader[h]);n.send(null)}e.manager.itemStart(a);return n}},setPath:function(a){this.path=a;return this},setResponseType:function(a){this.responseType=
a;return this},setWithCredentials:function(a){this.withCredentials=a;return this},setMimeType:function(a){this.mimeType=a;return this},setRequestHeader:function(a){this.requestHeader=a;return this}});Object.assign(df.prototype,{load:function(a,b,c,d){function e(e){l.load(a[e],function(a){a=f._parser(a,!0);g[e]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps};m+=1;6===m&&(1===a.mipmapCount&&(h.minFilter=1006),h.format=a.format,h.needsUpdate=!0,b&&b(h))},c,d)}var f=this,g=[],h=new Rb;
h.image=g;var l=new Ka(this.manager);l.setPath(this.path);l.setResponseType("arraybuffer");if(Array.isArray(a))for(var m=0,k=0,n=a.length;k<n;++k)e(k);else l.load(a,function(a){a=f._parser(a,!0);if(a.isCubemap)for(var c=a.mipmaps.length/a.mipmapCount,d=0;d<c;d++){g[d]={mipmaps:[]};for(var e=0;e<a.mipmapCount;e++)g[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+e]),g[d].format=a.format,g[d].width=a.width,g[d].height=a.height}else h.image.width=a.width,h.image.height=a.height,h.mipmaps=a.mipmaps;1===a.mipmapCount&&
(h.minFilter=1006);h.format=a.format;h.needsUpdate=!0;b&&b(h)},c,d);return h},setPath:function(a){this.path=a;return this}});Object.assign(be.prototype,{load:function(a,b,c,d){var e=this,f=new ib,g=new Ka(this.manager);g.setResponseType("arraybuffer");g.load(a,function(a){if(a=e._parser(a))void 0!==a.image?f.image=a.image:void 0!==a.data&&(f.image.width=a.width,f.image.height=a.height,f.image.data=a.data),f.wrapS=void 0!==a.wrapS?a.wrapS:1001,f.wrapT=void 0!==a.wrapT?a.wrapT:1001,f.magFilter=void 0!==
a.magFilter?a.magFilter:1006,f.minFilter=void 0!==a.minFilter?a.minFilter:1008,f.anisotropy=void 0!==a.anisotropy?a.anisotropy:1,void 0!==a.format&&(f.format=a.format),void 0!==a.type&&(f.type=a.type),void 0!==a.mipmaps&&(f.mipmaps=a.mipmaps),1===a.mipmapCount&&(f.minFilter=1006),f.needsUpdate=!0,b&&b(f,a)},c,d);return f}});Object.assign(Yc.prototype,{crossOrigin:"Anonymous",load:function(a,b,c,d){void 0===a&&(a="");void 0!==this.path&&(a=this.path+a);a=this.manager.resolveURL(a);var e=this,f=Hb.get(a);
if(void 0!==f)return e.manager.itemStart(a),setTimeout(function(){b&&b(f);e.manager.itemEnd(a)},0),f;c=document.createElementNS("http://www.w3.org/1999/xhtml","img");c.addEventListener("load",function(){Hb.add(a,this);b&&b(this);e.manager.itemEnd(a)},!1);c.addEventListener("error",function(b){d&&d(b);e.manager.itemEnd(a);e.manager.itemError(a)},!1);"data:"!==a.substr(0,5)&&void 0!==this.crossOrigin&&(c.crossOrigin=this.crossOrigin);e.manager.itemStart(a);c.src=a;return c},setCrossOrigin:function(a){this.crossOrigin=
a;return this},setPath:function(a){this.path=a;return this}});Object.assign(ce.prototype,{crossOrigin:"Anonymous",load:function(a,b,c,d){function e(c){g.load(a[c],function(a){f.images[c]=a;h++;6===h&&(f.needsUpdate=!0,b&&b(f))},void 0,d)}var f=new ab,g=new Yc(this.manager);g.setCrossOrigin(this.crossOrigin);g.setPath(this.path);var h=0;for(c=0;c<a.length;++c)e(c);return f},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});Object.assign(xd.prototype,
{crossOrigin:"Anonymous",load:function(a,b,c,d){var e=new Y,f=new Yc(this.manager);f.setCrossOrigin(this.crossOrigin);f.setPath(this.path);f.load(a,function(c){e.image=c;c=0<a.search(/\.(jpg|jpeg)$/)||0===a.search(/^data:image\/jpeg/);e.format=c?1022:1023;e.needsUpdate=!0;void 0!==b&&b(e)},c,d);return e},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});Object.assign(E.prototype,{getPoint:function(){console.warn("THREE.Curve: .getPoint() not implemented.");
return null},getPointAt:function(a,b){a=this.getUtoTmapping(a);return this.getPoint(a,b)},getPoints:function(a){void 0===a&&(a=5);for(var b=[],c=0;c<=a;c++)b.push(this.getPoint(c/a));return b},getSpacedPoints:function(a){void 0===a&&(a=5);for(var b=[],c=0;c<=a;c++)b.push(this.getPointAt(c/a));return b},getLength:function(){var a=this.getLengths();return a[a.length-1]},getLengths:function(a){void 0===a&&(a=this.arcLengthDivisions);if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;
this.needsUpdate=!1;var b=[],c=this.getPoint(0),d,e=0;b.push(0);for(d=1;d<=a;d++){var f=this.getPoint(d/a);e+=f.distanceTo(c);b.push(e);c=f}return this.cacheArcLengths=b},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(a,b){var c=this.getLengths(),d=c.length;b=b?b:a*c[d-1];for(var e=0,f=d-1,g;e<=f;)if(a=Math.floor(e+(f-e)/2),g=c[a]-b,0>g)e=a+1;else if(0<g)f=a-1;else{f=a;break}a=f;if(c[a]===b)return a/(d-1);e=c[a];return(a+(b-e)/(c[a+1]-e))/(d-1)},getTangent:function(a){var b=
a-1E-4;a+=1E-4;0>b&&(b=0);1<a&&(a=1);b=this.getPoint(b);return this.getPoint(a).clone().sub(b).normalize()},getTangentAt:function(a){a=this.getUtoTmapping(a);return this.getTangent(a)},computeFrenetFrames:function(a,b){var c=new p,d=[],e=[],f=[],g=new p,h=new M,l;for(l=0;l<=a;l++){var m=l/a;d[l]=this.getTangentAt(m);d[l].normalize()}e[0]=new p;f[0]=new p;l=Number.MAX_VALUE;m=Math.abs(d[0].x);var k=Math.abs(d[0].y),n=Math.abs(d[0].z);m<=l&&(l=m,c.set(1,0,0));k<=l&&(l=k,c.set(0,1,0));n<=l&&c.set(0,
0,1);g.crossVectors(d[0],c).normalize();e[0].crossVectors(d[0],g);f[0].crossVectors(d[0],e[0]);for(l=1;l<=a;l++)e[l]=e[l-1].clone(),f[l]=f[l-1].clone(),g.crossVectors(d[l-1],d[l]),g.length()>Number.EPSILON&&(g.normalize(),c=Math.acos(S.clamp(d[l-1].dot(d[l]),-1,1)),e[l].applyMatrix4(h.makeRotationAxis(g,c))),f[l].crossVectors(d[l],e[l]);if(!0===b)for(c=Math.acos(S.clamp(e[0].dot(e[a]),-1,1)),c/=a,0<d[0].dot(g.crossVectors(e[0],e[a]))&&(c=-c),l=1;l<=a;l++)e[l].applyMatrix4(h.makeRotationAxis(d[l],
c*l)),f[l].crossVectors(d[l],e[l]);return{tangents:d,normals:e,binormals:f}},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.arcLengthDivisions=a.arcLengthDivisions;return this},toJSON:function(){var a={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};a.arcLengthDivisions=this.arcLengthDivisions;a.type=this.type;return a},fromJSON:function(a){this.arcLengthDivisions=a.arcLengthDivisions;return this}});ia.prototype=Object.create(E.prototype);ia.prototype.constructor=
ia;ia.prototype.isEllipseCurve=!0;ia.prototype.getPoint=function(a,b){b=b||new C;for(var c=2*Math.PI,d=this.aEndAngle-this.aStartAngle,e=Math.abs(d)<Number.EPSILON;0>d;)d+=c;for(;d>c;)d-=c;d<Number.EPSILON&&(d=e?0:c);!0!==this.aClockwise||e||(d=d===c?-c:d-c);c=this.aStartAngle+a*d;a=this.aX+this.xRadius*Math.cos(c);var f=this.aY+this.yRadius*Math.sin(c);0!==this.aRotation&&(c=Math.cos(this.aRotation),d=Math.sin(this.aRotation),e=a-this.aX,f-=this.aY,a=e*c-f*d+this.aX,f=e*d+f*c+this.aY);return b.set(a,
f)};ia.prototype.copy=function(a){E.prototype.copy.call(this,a);this.aX=a.aX;this.aY=a.aY;this.xRadius=a.xRadius;this.yRadius=a.yRadius;this.aStartAngle=a.aStartAngle;this.aEndAngle=a.aEndAngle;this.aClockwise=a.aClockwise;this.aRotation=a.aRotation;return this};ia.prototype.toJSON=function(){var a=E.prototype.toJSON.call(this);a.aX=this.aX;a.aY=this.aY;a.xRadius=this.xRadius;a.yRadius=this.yRadius;a.aStartAngle=this.aStartAngle;a.aEndAngle=this.aEndAngle;a.aClockwise=this.aClockwise;a.aRotation=
this.aRotation;return a};ia.prototype.fromJSON=function(a){E.prototype.fromJSON.call(this,a);this.aX=a.aX;this.aY=a.aY;this.xRadius=a.xRadius;this.yRadius=a.yRadius;this.aStartAngle=a.aStartAngle;this.aEndAngle=a.aEndAngle;this.aClockwise=a.aClockwise;this.aRotation=a.aRotation;return this};fc.prototype=Object.create(ia.prototype);fc.prototype.constructor=fc;fc.prototype.isArcCurve=!0;var Qd=new p,ye=new de,ze=new de,Ae=new de;X.prototype=Object.create(E.prototype);X.prototype.constructor=X;X.prototype.isCatmullRomCurve3=
!0;X.prototype.getPoint=function(a,b){b=b||new p;var c=this.points,d=c.length;a*=d-(this.closed?0:1);var e=Math.floor(a);a-=e;this.closed?e+=0<e?0:(Math.floor(Math.abs(e)/c.length)+1)*c.length:0===a&&e===d-1&&(e=d-2,a=1);if(this.closed||0<e)var f=c[(e-1)%d];else Qd.subVectors(c[0],c[1]).add(c[0]),f=Qd;var g=c[e%d];var h=c[(e+1)%d];this.closed||e+2<d?c=c[(e+2)%d]:(Qd.subVectors(c[d-1],c[d-2]).add(c[d-1]),c=Qd);if("centripetal"===this.curveType||"chordal"===this.curveType){var l="chordal"===this.curveType?
.5:.25;d=Math.pow(f.distanceToSquared(g),l);e=Math.pow(g.distanceToSquared(h),l);l=Math.pow(h.distanceToSquared(c),l);1E-4>e&&(e=1);1E-4>d&&(d=e);1E-4>l&&(l=e);ye.initNonuniformCatmullRom(f.x,g.x,h.x,c.x,d,e,l);ze.initNonuniformCatmullRom(f.y,g.y,h.y,c.y,d,e,l);Ae.initNonuniformCatmullRom(f.z,g.z,h.z,c.z,d,e,l)}else"catmullrom"===this.curveType&&(ye.initCatmullRom(f.x,g.x,h.x,c.x,this.tension),ze.initCatmullRom(f.y,g.y,h.y,c.y,this.tension),Ae.initCatmullRom(f.z,g.z,h.z,c.z,this.tension));b.set(ye.calc(a),
ze.calc(a),Ae.calc(a));return b};X.prototype.copy=function(a){E.prototype.copy.call(this,a);this.points=[];for(var b=0,c=a.points.length;b<c;b++)this.points.push(a.points[b].clone());this.closed=a.closed;this.curveType=a.curveType;this.tension=a.tension;return this};X.prototype.toJSON=function(){var a=E.prototype.toJSON.call(this);a.points=[];for(var b=0,c=this.points.length;b<c;b++)a.points.push(this.points[b].toArray());a.closed=this.closed;a.curveType=this.curveType;a.tension=this.tension;return a};
X.prototype.fromJSON=function(a){E.prototype.fromJSON.call(this,a);this.points=[];for(var b=0,c=a.points.length;b<c;b++){var d=a.points[b];this.points.push((new p).fromArray(d))}this.closed=a.closed;this.curveType=a.curveType;this.tension=a.tension;return this};La.prototype=Object.create(E.prototype);La.prototype.constructor=La;La.prototype.isCubicBezierCurve=!0;La.prototype.getPoint=function(a,b){b=b||new C;var c=this.v0,d=this.v1,e=this.v2,f=this.v3;b.set($c(a,c.x,d.x,e.x,f.x),$c(a,c.y,d.y,e.y,
f.y));return b};La.prototype.copy=function(a){E.prototype.copy.call(this,a);this.v0.copy(a.v0);this.v1.copy(a.v1);this.v2.copy(a.v2);this.v3.copy(a.v3);return this};La.prototype.toJSON=function(){var a=E.prototype.toJSON.call(this);a.v0=this.v0.toArray();a.v1=this.v1.toArray();a.v2=this.v2.toArray();a.v3=this.v3.toArray();return a};La.prototype.fromJSON=function(a){E.prototype.fromJSON.call(this,a);this.v0.fromArray(a.v0);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);this.v3.fromArray(a.v3);return this};
Ta.prototype=Object.create(E.prototype);Ta.prototype.constructor=Ta;Ta.prototype.isCubicBezierCurve3=!0;Ta.prototype.getPoint=function(a,b){b=b||new p;var c=this.v0,d=this.v1,e=this.v2,f=this.v3;b.set($c(a,c.x,d.x,e.x,f.x),$c(a,c.y,d.y,e.y,f.y),$c(a,c.z,d.z,e.z,f.z));return b};Ta.prototype.copy=function(a){E.prototype.copy.call(this,a);this.v0.copy(a.v0);this.v1.copy(a.v1);this.v2.copy(a.v2);this.v3.copy(a.v3);return this};Ta.prototype.toJSON=function(){var a=E.prototype.toJSON.call(this);a.v0=this.v0.toArray();
a.v1=this.v1.toArray();a.v2=this.v2.toArray();a.v3=this.v3.toArray();return a};Ta.prototype.fromJSON=function(a){E.prototype.fromJSON.call(this,a);this.v0.fromArray(a.v0);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);this.v3.fromArray(a.v3);return this};wa.prototype=Object.create(E.prototype);wa.prototype.constructor=wa;wa.prototype.isLineCurve=!0;wa.prototype.getPoint=function(a,b){b=b||new C;1===a?b.copy(this.v2):(b.copy(this.v2).sub(this.v1),b.multiplyScalar(a).add(this.v1));return b};wa.prototype.getPointAt=
function(a,b){return this.getPoint(a,b)};wa.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()};wa.prototype.copy=function(a){E.prototype.copy.call(this,a);this.v1.copy(a.v1);this.v2.copy(a.v2);return this};wa.prototype.toJSON=function(){var a=E.prototype.toJSON.call(this);a.v1=this.v1.toArray();a.v2=this.v2.toArray();return a};wa.prototype.fromJSON=function(a){E.prototype.fromJSON.call(this,a);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);return this};Ma.prototype=
Object.create(E.prototype);Ma.prototype.constructor=Ma;Ma.prototype.isLineCurve3=!0;Ma.prototype.getPoint=function(a,b){b=b||new p;1===a?b.copy(this.v2):(b.copy(this.v2).sub(this.v1),b.multiplyScalar(a).add(this.v1));return b};Ma.prototype.getPointAt=function(a,b){return this.getPoint(a,b)};Ma.prototype.copy=function(a){E.prototype.copy.call(this,a);this.v1.copy(a.v1);this.v2.copy(a.v2);return this};Ma.prototype.toJSON=function(){var a=E.prototype.toJSON.call(this);a.v1=this.v1.toArray();a.v2=this.v2.toArray();
return a};Ma.prototype.fromJSON=function(a){E.prototype.fromJSON.call(this,a);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);return this};Na.prototype=Object.create(E.prototype);Na.prototype.constructor=Na;Na.prototype.isQuadraticBezierCurve=!0;Na.prototype.getPoint=function(a,b){b=b||new C;var c=this.v0,d=this.v1,e=this.v2;b.set(Zc(a,c.x,d.x,e.x),Zc(a,c.y,d.y,e.y));return b};Na.prototype.copy=function(a){E.prototype.copy.call(this,a);this.v0.copy(a.v0);this.v1.copy(a.v1);this.v2.copy(a.v2);return this};
Na.prototype.toJSON=function(){var a=E.prototype.toJSON.call(this);a.v0=this.v0.toArray();a.v1=this.v1.toArray();a.v2=this.v2.toArray();return a};Na.prototype.fromJSON=function(a){E.prototype.fromJSON.call(this,a);this.v0.fromArray(a.v0);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);return this};Ua.prototype=Object.create(E.prototype);Ua.prototype.constructor=Ua;Ua.prototype.isQuadraticBezierCurve3=!0;Ua.prototype.getPoint=function(a,b){b=b||new p;var c=this.v0,d=this.v1,e=this.v2;b.set(Zc(a,c.x,
d.x,e.x),Zc(a,c.y,d.y,e.y),Zc(a,c.z,d.z,e.z));return b};Ua.prototype.copy=function(a){E.prototype.copy.call(this,a);this.v0.copy(a.v0);this.v1.copy(a.v1);this.v2.copy(a.v2);return this};Ua.prototype.toJSON=function(){var a=E.prototype.toJSON.call(this);a.v0=this.v0.toArray();a.v1=this.v1.toArray();a.v2=this.v2.toArray();return a};Ua.prototype.fromJSON=function(a){E.prototype.fromJSON.call(this,a);this.v0.fromArray(a.v0);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);return this};Oa.prototype=Object.create(E.prototype);
Oa.prototype.constructor=Oa;Oa.prototype.isSplineCurve=!0;Oa.prototype.getPoint=function(a,b){b=b||new C;var c=this.points,d=(c.length-1)*a;a=Math.floor(d);d-=a;var e=c[0===a?a:a-1],f=c[a],g=c[a>c.length-2?c.length-1:a+1];c=c[a>c.length-3?c.length-1:a+2];b.set(ef(d,e.x,f.x,g.x,c.x),ef(d,e.y,f.y,g.y,c.y));return b};Oa.prototype.copy=function(a){E.prototype.copy.call(this,a);this.points=[];for(var b=0,c=a.points.length;b<c;b++)this.points.push(a.points[b].clone());return this};Oa.prototype.toJSON=function(){var a=
E.prototype.toJSON.call(this);a.points=[];for(var b=0,c=this.points.length;b<c;b++)a.points.push(this.points[b].toArray());return a};Oa.prototype.fromJSON=function(a){E.prototype.fromJSON.call(this,a);this.points=[];for(var b=0,c=a.points.length;b<c;b++){var d=a.points[b];this.points.push((new C).fromArray(d))}return this};var Ng=Object.freeze({ArcCurve:fc,CatmullRomCurve3:X,CubicBezierCurve:La,CubicBezierCurve3:Ta,EllipseCurve:ia,LineCurve:wa,LineCurve3:Ma,QuadraticBezierCurve:Na,QuadraticBezierCurve3:Ua,
SplineCurve:Oa});Za.prototype=Object.assign(Object.create(E.prototype),{constructor:Za,add:function(a){this.curves.push(a)},closePath:function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new wa(b,a))},getPoint:function(a){var b=a*this.getLength(),c=this.getCurveLengths();for(a=0;a<c.length;){if(c[a]>=b)return b=c[a]-b,a=this.curves[a],c=a.getLength(),a.getPointAt(0===c?0:1-b/c);a++}return null},getLength:function(){var a=this.getCurveLengths();
return a[a.length-1]},updateArcLengths:function(){this.needsUpdate=!0;this.cacheLengths=null;this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var a=[],b=0,c=0,d=this.curves.length;c<d;c++)b+=this.curves[c].getLength(),a.push(b);return this.cacheLengths=a},getSpacedPoints:function(a){void 0===a&&(a=40);for(var b=[],c=0;c<=a;c++)b.push(this.getPoint(c/a));this.autoClose&&b.push(b[0]);return b},getPoints:function(a){a=
a||12;for(var b=[],c,d=0,e=this.curves;d<e.length;d++){var f=e[d];f=f.getPoints(f&&f.isEllipseCurve?2*a:f&&f.isLineCurve?1:f&&f.isSplineCurve?a*f.points.length:a);for(var g=0;g<f.length;g++){var h=f[g];c&&c.equals(h)||(b.push(h),c=h)}}this.autoClose&&1<b.length&&!b[b.length-1].equals(b[0])&&b.push(b[0]);return b},copy:function(a){E.prototype.copy.call(this,a);this.curves=[];for(var b=0,c=a.curves.length;b<c;b++)this.curves.push(a.curves[b].clone());this.autoClose=a.autoClose;return this},toJSON:function(){var a=
E.prototype.toJSON.call(this);a.autoClose=this.autoClose;a.curves=[];for(var b=0,c=this.curves.length;b<c;b++)a.curves.push(this.curves[b].toJSON());return a},fromJSON:function(a){E.prototype.fromJSON.call(this,a);this.autoClose=a.autoClose;this.curves=[];for(var b=0,c=a.curves.length;b<c;b++){var d=a.curves[b];this.curves.push((new Ng[d.type]).fromJSON(d))}return this}});Pa.prototype=Object.assign(Object.create(Za.prototype),{constructor:Pa,setFromPoints:function(a){this.moveTo(a[0].x,a[0].y);for(var b=
1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y)},moveTo:function(a,b){this.currentPoint.set(a,b)},lineTo:function(a,b){var c=new wa(this.currentPoint.clone(),new C(a,b));this.curves.push(c);this.currentPoint.set(a,b)},quadraticCurveTo:function(a,b,c,d){a=new Na(this.currentPoint.clone(),new C(a,b),new C(c,d));this.curves.push(a);this.currentPoint.set(c,d)},bezierCurveTo:function(a,b,c,d,e,f){a=new La(this.currentPoint.clone(),new C(a,b),new C(c,d),new C(e,f));this.curves.push(a);this.currentPoint.set(e,
f)},splineThru:function(a){var b=[this.currentPoint.clone()].concat(a);b=new Oa(b);this.curves.push(b);this.currentPoint.copy(a[a.length-1])},arc:function(a,b,c,d,e,f){this.absarc(a+this.currentPoint.x,b+this.currentPoint.y,c,d,e,f)},absarc:function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f)},ellipse:function(a,b,c,d,e,f,g,h){this.absellipse(a+this.currentPoint.x,b+this.currentPoint.y,c,d,e,f,g,h)},absellipse:function(a,b,c,d,e,f,g,h){a=new ia(a,b,c,d,e,f,g,h);0<this.curves.length&&(b=a.getPoint(0),
b.equals(this.currentPoint)||this.lineTo(b.x,b.y));this.curves.push(a);a=a.getPoint(1);this.currentPoint.copy(a)},copy:function(a){Za.prototype.copy.call(this,a);this.currentPoint.copy(a.currentPoint);return this},toJSON:function(){var a=Za.prototype.toJSON.call(this);a.currentPoint=this.currentPoint.toArray();return a},fromJSON:function(a){Za.prototype.fromJSON.call(this,a);this.currentPoint.fromArray(a.currentPoint);return this}});gb.prototype=Object.assign(Object.create(Pa.prototype),{constructor:gb,
getPointsHoles:function(a){for(var b=[],c=0,d=this.holes.length;c<d;c++)b[c]=this.holes[c].getPoints(a);return b},extractPoints:function(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}},copy:function(a){Pa.prototype.copy.call(this,a);this.holes=[];for(var b=0,c=a.holes.length;b<c;b++)this.holes.push(a.holes[b].clone());return this},toJSON:function(){var a=Pa.prototype.toJSON.call(this);a.uuid=this.uuid;a.holes=[];for(var b=0,c=this.holes.length;b<c;b++)a.holes.push(this.holes[b].toJSON());
return a},fromJSON:function(a){Pa.prototype.fromJSON.call(this,a);this.uuid=a.uuid;this.holes=[];for(var b=0,c=a.holes.length;b<c;b++){var d=a.holes[b];this.holes.push((new Pa).fromJSON(d))}return this}});ca.prototype=Object.assign(Object.create(A.prototype),{constructor:ca,isLight:!0,copy:function(a){A.prototype.copy.call(this,a);this.color.copy(a.color);this.intensity=a.intensity;return this},toJSON:function(a){a=A.prototype.toJSON.call(this,a);a.object.color=this.color.getHex();a.object.intensity=
this.intensity;void 0!==this.groundColor&&(a.object.groundColor=this.groundColor.getHex());void 0!==this.distance&&(a.object.distance=this.distance);void 0!==this.angle&&(a.object.angle=this.angle);void 0!==this.decay&&(a.object.decay=this.decay);void 0!==this.penumbra&&(a.object.penumbra=this.penumbra);void 0!==this.shadow&&(a.object.shadow=this.shadow.toJSON());return a}});yd.prototype=Object.assign(Object.create(ca.prototype),{constructor:yd,isHemisphereLight:!0,copy:function(a){ca.prototype.copy.call(this,
a);this.groundColor.copy(a.groundColor);return this}});Object.assign(Eb.prototype,{copy:function(a){this.camera=a.camera.clone();this.bias=a.bias;this.radius=a.radius;this.mapSize.copy(a.mapSize);return this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var a={};0!==this.bias&&(a.bias=this.bias);1!==this.radius&&(a.radius=this.radius);if(512!==this.mapSize.x||512!==this.mapSize.y)a.mapSize=this.mapSize.toArray();a.camera=this.camera.toJSON(!1).object;delete a.camera.matrix;
return a}});zd.prototype=Object.assign(Object.create(Eb.prototype),{constructor:zd,isSpotLightShadow:!0,update:function(a){var b=this.camera,c=2*S.RAD2DEG*a.angle,d=this.mapSize.width/this.mapSize.height;a=a.distance||b.far;if(c!==b.fov||d!==b.aspect||a!==b.far)b.fov=c,b.aspect=d,b.far=a,b.updateProjectionMatrix()}});Ad.prototype=Object.assign(Object.create(ca.prototype),{constructor:Ad,isSpotLight:!0,copy:function(a){ca.prototype.copy.call(this,a);this.distance=a.distance;this.angle=a.angle;this.penumbra=
a.penumbra;this.decay=a.decay;this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});Bd.prototype=Object.assign(Object.create(ca.prototype),{constructor:Bd,isPointLight:!0,copy:function(a){ca.prototype.copy.call(this,a);this.distance=a.distance;this.decay=a.decay;this.shadow=a.shadow.clone();return this}});Cd.prototype=Object.assign(Object.create(Eb.prototype),{constructor:Cd});Dd.prototype=Object.assign(Object.create(ca.prototype),{constructor:Dd,isDirectionalLight:!0,copy:function(a){ca.prototype.copy.call(this,
a);this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});Ed.prototype=Object.assign(Object.create(ca.prototype),{constructor:Ed,isAmbientLight:!0});Fd.prototype=Object.assign(Object.create(ca.prototype),{constructor:Fd,isRectAreaLight:!0,copy:function(a){ca.prototype.copy.call(this,a);this.width=a.width;this.height=a.height;return this},toJSON:function(a){a=ca.prototype.toJSON.call(this,a);a.object.width=this.width;a.object.height=this.height;return a}});Gd.prototype=Object.assign(Object.create(da.prototype),
{constructor:Gd,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});Hd.prototype=Object.assign(Object.create(da.prototype),{constructor:Hd,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});Object.assign(na.prototype,{evaluate:function(a){var b=this.parameterPositions,c=this._cachedIndex,d=b[c],e=b[c-1];a:{b:{c:{d:if(!(a<
d)){for(var f=c+2;;){if(void 0===d){if(a<e)break d;this._cachedIndex=c=b.length;return this.afterEnd_(c-1,a,e)}if(c===f)break;e=d;d=b[++c];if(a<d)break b}d=b.length;break c}if(a>=e)break a;else{f=b[1];a<f&&(c=2,e=f);for(f=c-2;;){if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,a,d);if(c===f)break;d=e;e=b[--c-1];if(a>=e)break b}d=c;c=0}}for(;c<d;)e=c+d>>>1,a<b[e]?d=e:c=e+1;d=b[c];e=b[c-1];if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,a,d);if(void 0===d)return this._cachedIndex=
c=b.length,this.afterEnd_(c-1,e,a)}this._cachedIndex=c;this.intervalChanged_(c,e,d)}return this.interpolate_(c,e,a,d)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(a){var b=this.resultBuffer,c=this.sampleValues,d=this.valueSize;a*=d;for(var e=0;e!==d;++e)b[e]=c[a+e];return b},interpolate_:function(){throw Error("call to abstract method");},intervalChanged_:function(){}});Object.assign(na.prototype,{beforeStart_:na.prototype.copySampleValue_,
afterEnd_:na.prototype.copySampleValue_});Id.prototype=Object.assign(Object.create(na.prototype),{constructor:Id,interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;b=(c-b)/(d-b);for(c=a+g;a!==c;a+=4)ja.slerpFlat(e,0,f,a-g,f,a,b);return e}});ad.prototype=Object.assign(Object.create(da.prototype),{constructor:ad,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(a){return new Id(this.times,this.values,this.getValueSize(),
a)},InterpolantFactoryMethodSmooth:void 0});Jd.prototype=Object.assign(Object.create(da.prototype),{constructor:Jd,ValueTypeName:"color"});gc.prototype=Object.assign(Object.create(da.prototype),{constructor:gc,ValueTypeName:"number"});Kd.prototype=Object.assign(Object.create(na.prototype),{constructor:Kd,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(a,b,c){var d=this.parameterPositions,e=a-2,f=a+1,g=d[e],h=d[f];if(void 0===g)switch(this.getSettings_().endingStart){case 2401:e=
a;g=2*b-c;break;case 2402:e=d.length-2;g=b+d[e]-d[e+1];break;default:e=a,g=c}if(void 0===h)switch(this.getSettings_().endingEnd){case 2401:f=a;h=2*c-b;break;case 2402:f=1;h=c+d[1]-d[0];break;default:f=a-1,h=b}a=.5*(c-b);d=this.valueSize;this._weightPrev=a/(b-g);this._weightNext=a/(h-c);this._offsetPrev=e*d;this._offsetNext=f*d},interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;var h=a-g,l=this._offsetPrev,m=this._offsetNext,k=this._weightPrev,n=this._weightNext,
p=(c-b)/(d-b);c=p*p;d=c*p;b=-k*d+2*k*c-k*p;k=(1+k)*d+(-1.5-2*k)*c+(-.5+k)*p+1;p=(-1-n)*d+(1.5+n)*c+.5*p;n=n*d-n*c;for(c=0;c!==g;++c)e[c]=b*f[l+c]+k*f[h+c]+p*f[a+c]+n*f[m+c];return e}});bd.prototype=Object.assign(Object.create(na.prototype),{constructor:bd,interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;var h=a-g;b=(c-b)/(d-b);c=1-b;for(d=0;d!==g;++d)e[d]=f[h+d]*c+f[a+d]*b;return e}});Ld.prototype=Object.assign(Object.create(na.prototype),{constructor:Ld,
interpolate_:function(a){return this.copySampleValue_(a-1)}});var fa={arraySlice:function(a,b,c){return fa.isTypedArray(a)?new a.constructor(a.subarray(b,void 0!==c?c:a.length)):a.slice(b,c)},convertArray:function(a,b,c){return!a||!c&&a.constructor===b?a:"number"===typeof b.BYTES_PER_ELEMENT?new b(a):Array.prototype.slice.call(a)},isTypedArray:function(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)},getKeyframeOrder:function(a){for(var b=a.length,c=Array(b),d=0;d!==b;++d)c[d]=d;c.sort(function(b,
c){return a[b]-a[c]});return c},sortedArray:function(a,b,c){for(var d=a.length,e=new a.constructor(d),f=0,g=0;g!==d;++f)for(var h=c[f]*b,l=0;l!==b;++l)e[g++]=a[h+l];return e},flattenJSON:function(a,b,c,d){for(var e=1,f=a[0];void 0!==f&&void 0===f[d];)f=a[e++];if(void 0!==f){var g=f[d];if(void 0!==g)if(Array.isArray(g)){do g=f[d],void 0!==g&&(b.push(f.time),c.push.apply(c,g)),f=a[e++];while(void 0!==f)}else if(void 0!==g.toArray){do g=f[d],void 0!==g&&(b.push(f.time),g.toArray(c,c.length)),f=a[e++];
while(void 0!==f)}else{do g=f[d],void 0!==g&&(b.push(f.time),c.push(g)),f=a[e++];while(void 0!==f)}}}};Object.assign(da,{parse:function(a){if(void 0===a.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");var b=da._getTrackTypeForValueTypeName(a.type);if(void 0===a.times){var c=[],d=[];fa.flattenJSON(a.keys,c,d,"value");a.times=c;a.values=d}return void 0!==b.parse?b.parse(a):new b(a.name,a.times,a.values,a.interpolation)},toJSON:function(a){var b=a.constructor;if(void 0!==
b.toJSON)b=b.toJSON(a);else{b={name:a.name,times:fa.convertArray(a.times,Array),values:fa.convertArray(a.values,Array)};var c=a.getInterpolation();c!==a.DefaultInterpolation&&(b.interpolation=c)}b.type=a.ValueTypeName;return b},_getTrackTypeForValueTypeName:function(a){switch(a.toLowerCase()){case "scalar":case "double":case "float":case "number":case "integer":return gc;case "vector":case "vector2":case "vector3":case "vector4":return hc;case "color":return Jd;case "quaternion":return ad;case "bool":case "boolean":return Hd;
case "string":return Gd}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+a);}});Object.assign(da.prototype,{constructor:da,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(a){return new Ld(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodLinear:function(a){return new bd(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:function(a){return new Kd(this.times,this.values,
this.getValueSize(),a)},setInterpolation:function(a){switch(a){case 2300:var b=this.InterpolantFactoryMethodDiscrete;break;case 2301:b=this.InterpolantFactoryMethodLinear;break;case 2302:b=this.InterpolantFactoryMethodSmooth}if(void 0===b){b="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(b);console.warn("THREE.KeyframeTrack:",
b)}else this.createInterpolant=b},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(a){if(0!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]+=a;return this},scale:function(a){if(1!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]*=a;return this},
trim:function(a,b){for(var c=this.times,d=c.length,e=0,f=d-1;e!==d&&c[e]<a;)++e;for(;-1!==f&&c[f]>b;)--f;++f;if(0!==e||f!==d)e>=f&&(f=Math.max(f,1),e=f-1),a=this.getValueSize(),this.times=fa.arraySlice(c,e,f),this.values=fa.arraySlice(this.values,e*a,f*a);return this},validate:function(){var a=!0,b=this.getValueSize();0!==b-Math.floor(b)&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),a=!1);var c=this.times;b=this.values;var d=c.length;0===d&&(console.error("THREE.KeyframeTrack: Track is empty.",
this),a=!1);for(var e=null,f=0;f!==d;f++){var g=c[f];if("number"===typeof g&&isNaN(g)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,f,g);a=!1;break}if(null!==e&&e>g){console.error("THREE.KeyframeTrack: Out of order keys.",this,f,g,e);a=!1;break}e=g}if(void 0!==b&&fa.isTypedArray(b))for(f=0,c=b.length;f!==c;++f)if(d=b[f],isNaN(d)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,f,d);a=!1;break}return a},optimize:function(){for(var a=this.times,b=this.values,
c=this.getValueSize(),d=2302===this.getInterpolation(),e=1,f=a.length-1,g=1;g<f;++g){var h=!1,l=a[g];if(l!==a[g+1]&&(1!==g||l!==l[0]))if(d)h=!0;else{var k=g*c,p=k-c,n=k+c;for(l=0;l!==c;++l){var t=b[k+l];if(t!==b[p+l]||t!==b[n+l]){h=!0;break}}}if(h){if(g!==e)for(a[e]=a[g],h=g*c,k=e*c,l=0;l!==c;++l)b[k+l]=b[h+l];++e}}if(0<f){a[e]=a[f];h=f*c;k=e*c;for(l=0;l!==c;++l)b[k+l]=b[h+l];++e}e!==a.length&&(this.times=fa.arraySlice(a,0,e),this.values=fa.arraySlice(b,0,e*c));return this}});hc.prototype=Object.assign(Object.create(da.prototype),
{constructor:hc,ValueTypeName:"vector"});Object.assign(Ba,{parse:function(a){for(var b=[],c=a.tracks,d=1/(a.fps||1),e=0,f=c.length;e!==f;++e)b.push(da.parse(c[e]).scale(d));return new Ba(a.name,a.duration,b)},toJSON:function(a){var b=[],c=a.tracks;a={name:a.name,duration:a.duration,tracks:b};for(var d=0,e=c.length;d!==e;++d)b.push(da.toJSON(c[d]));return a},CreateFromMorphTargetSequence:function(a,b,c,d){for(var e=b.length,f=[],g=0;g<e;g++){var h=[],l=[];h.push((g+e-1)%e,g,(g+1)%e);l.push(0,1,0);
var k=fa.getKeyframeOrder(h);h=fa.sortedArray(h,1,k);l=fa.sortedArray(l,1,k);d||0!==h[0]||(h.push(e),l.push(l[0]));f.push((new gc(".morphTargetInfluences["+b[g].name+"]",h,l)).scale(1/c))}return new Ba(a,-1,f)},findByName:function(a,b){var c=a;Array.isArray(a)||(c=a.geometry&&a.geometry.animations||a.animations);for(a=0;a<c.length;a++)if(c[a].name===b)return c[a];return null},CreateClipsFromMorphTargetSequences:function(a,b,c){for(var d={},e=/^([\w-]*?)([\d]+)$/,f=0,g=a.length;f<g;f++){var h=a[f],
l=h.name.match(e);if(l&&1<l.length){var k=l[1];(l=d[k])||(d[k]=l=[]);l.push(h)}}a=[];for(k in d)a.push(Ba.CreateFromMorphTargetSequence(k,d[k],b,c));return a},parseAnimation:function(a,b){if(!a)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;var c=function(a,b,c,d,e){if(0!==c.length){var f=[],g=[];fa.flattenJSON(c,f,g,d);0!==f.length&&e.push(new a(b,f,g))}},d=[],e=a.name||"default",f=a.length||-1,g=a.fps||30;a=a.hierarchy||[];for(var h=0;h<a.length;h++){var l=a[h].keys;
if(l&&0!==l.length)if(l[0].morphTargets){f={};for(var k=0;k<l.length;k++)if(l[k].morphTargets)for(var p=0;p<l[k].morphTargets.length;p++)f[l[k].morphTargets[p]]=-1;for(var n in f){var t=[],r=[];for(p=0;p!==l[k].morphTargets.length;++p){var q=l[k];t.push(q.time);r.push(q.morphTarget===n?1:0)}d.push(new gc(".morphTargetInfluence["+n+"]",t,r))}f=f.length*(g||1)}else k=".bones["+b[h].name+"]",c(hc,k+".position",l,"pos",d),c(ad,k+".quaternion",l,"rot",d),c(hc,k+".scale",l,"scl",d)}return 0===d.length?
null:new Ba(e,f,d)}});Object.assign(Ba.prototype,{resetDuration:function(){for(var a=0,b=0,c=this.tracks.length;b!==c;++b){var d=this.tracks[b];a=Math.max(a,d.times[d.times.length-1])}this.duration=a},trim:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this},optimize:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}});Object.assign(Md.prototype,{load:function(a,b,c,d){var e=this;(new Ka(e.manager)).load(a,function(a){b(e.parse(JSON.parse(a)))},
c,d)},setTextures:function(a){this.textures=a},parse:function(a){function b(a){void 0===c[a]&&console.warn("THREE.MaterialLoader: Undefined texture",a);return c[a]}var c=this.textures,d=new Mg[a.type];void 0!==a.uuid&&(d.uuid=a.uuid);void 0!==a.name&&(d.name=a.name);void 0!==a.color&&d.color.setHex(a.color);void 0!==a.roughness&&(d.roughness=a.roughness);void 0!==a.metalness&&(d.metalness=a.metalness);void 0!==a.emissive&&d.emissive.setHex(a.emissive);void 0!==a.specular&&d.specular.setHex(a.specular);
void 0!==a.shininess&&(d.shininess=a.shininess);void 0!==a.clearCoat&&(d.clearCoat=a.clearCoat);void 0!==a.clearCoatRoughness&&(d.clearCoatRoughness=a.clearCoatRoughness);void 0!==a.uniforms&&(d.uniforms=a.uniforms);void 0!==a.vertexShader&&(d.vertexShader=a.vertexShader);void 0!==a.fragmentShader&&(d.fragmentShader=a.fragmentShader);void 0!==a.vertexColors&&(d.vertexColors=a.vertexColors);void 0!==a.fog&&(d.fog=a.fog);void 0!==a.flatShading&&(d.flatShading=a.flatShading);void 0!==a.blending&&(d.blending=
a.blending);void 0!==a.side&&(d.side=a.side);void 0!==a.opacity&&(d.opacity=a.opacity);void 0!==a.transparent&&(d.transparent=a.transparent);void 0!==a.alphaTest&&(d.alphaTest=a.alphaTest);void 0!==a.depthTest&&(d.depthTest=a.depthTest);void 0!==a.depthWrite&&(d.depthWrite=a.depthWrite);void 0!==a.colorWrite&&(d.colorWrite=a.colorWrite);void 0!==a.wireframe&&(d.wireframe=a.wireframe);void 0!==a.wireframeLinewidth&&(d.wireframeLinewidth=a.wireframeLinewidth);void 0!==a.wireframeLinecap&&(d.wireframeLinecap=
a.wireframeLinecap);void 0!==a.wireframeLinejoin&&(d.wireframeLinejoin=a.wireframeLinejoin);void 0!==a.rotation&&(d.rotation=a.rotation);1!==a.linewidth&&(d.linewidth=a.linewidth);void 0!==a.dashSize&&(d.dashSize=a.dashSize);void 0!==a.gapSize&&(d.gapSize=a.gapSize);void 0!==a.scale&&(d.scale=a.scale);void 0!==a.polygonOffset&&(d.polygonOffset=a.polygonOffset);void 0!==a.polygonOffsetFactor&&(d.polygonOffsetFactor=a.polygonOffsetFactor);void 0!==a.polygonOffsetUnits&&(d.polygonOffsetUnits=a.polygonOffsetUnits);
void 0!==a.skinning&&(d.skinning=a.skinning);void 0!==a.morphTargets&&(d.morphTargets=a.morphTargets);void 0!==a.dithering&&(d.dithering=a.dithering);void 0!==a.visible&&(d.visible=a.visible);void 0!==a.userData&&(d.userData=a.userData);void 0!==a.shading&&(d.flatShading=1===a.shading);void 0!==a.size&&(d.size=a.size);void 0!==a.sizeAttenuation&&(d.sizeAttenuation=a.sizeAttenuation);void 0!==a.map&&(d.map=b(a.map));void 0!==a.alphaMap&&(d.alphaMap=b(a.alphaMap),d.transparent=!0);void 0!==a.bumpMap&&
(d.bumpMap=b(a.bumpMap));void 0!==a.bumpScale&&(d.bumpScale=a.bumpScale);void 0!==a.normalMap&&(d.normalMap=b(a.normalMap));if(void 0!==a.normalScale){var e=a.normalScale;!1===Array.isArray(e)&&(e=[e,e]);d.normalScale=(new C).fromArray(e)}void 0!==a.displacementMap&&(d.displacementMap=b(a.displacementMap));void 0!==a.displacementScale&&(d.displacementScale=a.displacementScale);void 0!==a.displacementBias&&(d.displacementBias=a.displacementBias);void 0!==a.roughnessMap&&(d.roughnessMap=b(a.roughnessMap));
void 0!==a.metalnessMap&&(d.metalnessMap=b(a.metalnessMap));void 0!==a.emissiveMap&&(d.emissiveMap=b(a.emissiveMap));void 0!==a.emissiveIntensity&&(d.emissiveIntensity=a.emissiveIntensity);void 0!==a.specularMap&&(d.specularMap=b(a.specularMap));void 0!==a.envMap&&(d.envMap=b(a.envMap));void 0!==a.reflectivity&&(d.reflectivity=a.reflectivity);void 0!==a.lightMap&&(d.lightMap=b(a.lightMap));void 0!==a.lightMapIntensity&&(d.lightMapIntensity=a.lightMapIntensity);void 0!==a.aoMap&&(d.aoMap=b(a.aoMap));
void 0!==a.aoMapIntensity&&(d.aoMapIntensity=a.aoMapIntensity);void 0!==a.gradientMap&&(d.gradientMap=b(a.gradientMap));return d}});Object.assign(ee.prototype,{load:function(a,b,c,d){var e=this;(new Ka(e.manager)).load(a,function(a){b(e.parse(JSON.parse(a)))},c,d)},parse:function(a){var b=new F,c=a.data.index;void 0!==c&&(c=new uf[c.type](c.array),b.setIndex(new T(c,1)));var d=a.data.attributes;for(f in d){var e=d[f];c=new uf[e.type](e.array);b.addAttribute(f,new T(c,e.itemSize,e.normalized))}var f=
a.data.groups||a.data.drawcalls||a.data.offsets;if(void 0!==f)for(c=0,d=f.length;c!==d;++c)e=f[c],b.addGroup(e.start,e.count,e.materialIndex);a=a.data.boundingSphere;void 0!==a&&(f=new p,void 0!==a.center&&f.fromArray(a.center),b.boundingSphere=new Ea(f,a.radius));return b}});var uf={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!==typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,
Float32Array:Float32Array,Float64Array:Float64Array};ic.Handlers={handlers:[],add:function(a,b){this.handlers.push(a,b)},get:function(a){for(var b=this.handlers,c=0,d=b.length;c<d;c+=2){var e=b[c+1];if(b[c].test(a))return e}return null}};Object.assign(ic.prototype,{crossOrigin:void 0,onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(a,b,c){for(var d=[],e=0;e<a.length;++e)d[e]=this.createMaterial(a[e],b,c);return d},createMaterial:function(){var a=
{NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},b=new I,c=new xd,d=new Md;return function(e,f,g){function h(a,b,d,e,h){a=f+a;var k=ic.Handlers.get(a);null!==k?a=k.load(a):(c.setCrossOrigin(g),a=c.load(a));void 0!==b&&(a.repeat.fromArray(b),1!==b[0]&&(a.wrapS=1E3),1!==b[1]&&(a.wrapT=1E3));void 0!==d&&a.offset.fromArray(d);void 0!==e&&("repeat"===e[0]&&(a.wrapS=1E3),"mirror"===e[0]&&(a.wrapS=1002),"repeat"===e[1]&&(a.wrapT=1E3),"mirror"===
e[1]&&(a.wrapT=1002));void 0!==h&&(a.anisotropy=h);b=S.generateUUID();l[b]=a;return b}var l={},k={uuid:S.generateUUID(),type:"MeshLambertMaterial"},p;for(p in e){var n=e[p];switch(p){case "DbgColor":case "DbgIndex":case "opticalDensity":case "illumination":break;case "DbgName":k.name=n;break;case "blending":k.blending=a[n];break;case "colorAmbient":case "mapAmbient":console.warn("THREE.Loader.createMaterial:",p,"is no longer supported.");break;case "colorDiffuse":k.color=b.fromArray(n).getHex();break;
case "colorSpecular":k.specular=b.fromArray(n).getHex();break;case "colorEmissive":k.emissive=b.fromArray(n).getHex();break;case "specularCoef":k.shininess=n;break;case "shading":"basic"===n.toLowerCase()&&(k.type="MeshBasicMaterial");"phong"===n.toLowerCase()&&(k.type="MeshPhongMaterial");"standard"===n.toLowerCase()&&(k.type="MeshStandardMaterial");break;case "mapDiffuse":k.map=h(n,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy);break;case "mapDiffuseRepeat":case "mapDiffuseOffset":case "mapDiffuseWrap":case "mapDiffuseAnisotropy":break;
case "mapEmissive":k.emissiveMap=h(n,e.mapEmissiveRepeat,e.mapEmissiveOffset,e.mapEmissiveWrap,e.mapEmissiveAnisotropy);break;case "mapEmissiveRepeat":case "mapEmissiveOffset":case "mapEmissiveWrap":case "mapEmissiveAnisotropy":break;case "mapLight":k.lightMap=h(n,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy);break;case "mapLightRepeat":case "mapLightOffset":case "mapLightWrap":case "mapLightAnisotropy":break;case "mapAO":k.aoMap=h(n,e.mapAORepeat,e.mapAOOffset,e.mapAOWrap,
e.mapAOAnisotropy);break;case "mapAORepeat":case "mapAOOffset":case "mapAOWrap":case "mapAOAnisotropy":break;case "mapBump":k.bumpMap=h(n,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy);break;case "mapBumpScale":k.bumpScale=n;break;case "mapBumpRepeat":case "mapBumpOffset":case "mapBumpWrap":case "mapBumpAnisotropy":break;case "mapNormal":k.normalMap=h(n,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy);break;case "mapNormalFactor":k.normalScale=n;break;
case "mapNormalRepeat":case "mapNormalOffset":case "mapNormalWrap":case "mapNormalAnisotropy":break;case "mapSpecular":k.specularMap=h(n,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy);break;case "mapSpecularRepeat":case "mapSpecularOffset":case "mapSpecularWrap":case "mapSpecularAnisotropy":break;case "mapMetalness":k.metalnessMap=h(n,e.mapMetalnessRepeat,e.mapMetalnessOffset,e.mapMetalnessWrap,e.mapMetalnessAnisotropy);break;case "mapMetalnessRepeat":case "mapMetalnessOffset":case "mapMetalnessWrap":case "mapMetalnessAnisotropy":break;
case "mapRoughness":k.roughnessMap=h(n,e.mapRoughnessRepeat,e.mapRoughnessOffset,e.mapRoughnessWrap,e.mapRoughnessAnisotropy);break;case "mapRoughnessRepeat":case "mapRoughnessOffset":case "mapRoughnessWrap":case "mapRoughnessAnisotropy":break;case "mapAlpha":k.alphaMap=h(n,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy);break;case "mapAlphaRepeat":case "mapAlphaOffset":case "mapAlphaWrap":case "mapAlphaAnisotropy":break;case "flipSided":k.side=1;break;case "doubleSided":k.side=
2;break;case "transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity");k.opacity=n;break;case "depthTest":case "depthWrite":case "colorWrite":case "opacity":case "reflectivity":case "transparent":case "visible":case "wireframe":k[p]=n;break;case "vertexColors":!0===n&&(k.vertexColors=2);"face"===n&&(k.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",p,n)}}"MeshBasicMaterial"===k.type&&delete k.emissive;"MeshPhongMaterial"!==
k.type&&delete k.specular;1>k.opacity&&(k.transparent=!0);d.setTextures(l);return d.parse(k)}}()});var Be={decodeText:function(a){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(a);for(var b="",c=0,d=a.length;c<d;c++)b+=String.fromCharCode(a[c]);return decodeURIComponent(escape(b))},extractUrlBase:function(a){a=a.split("/");if(1===a.length)return"./";a.pop();return a.join("/")+"/"}};Object.assign(fe.prototype,{load:function(a,b,c,d){var e=this,f=this.texturePath&&"string"===typeof this.texturePath?
this.texturePath:Be.extractUrlBase(a),g=new Ka(this.manager);g.setWithCredentials(this.withCredentials);g.load(a,function(c){c=JSON.parse(c);var d=c.metadata;if(void 0!==d&&(d=d.type,void 0!==d&&"object"===d.toLowerCase())){console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.ObjectLoader instead.");return}c=e.parse(c,f);b(c.geometry,c.materials)},c,d)},setTexturePath:function(a){this.texturePath=a},parse:function(){return function(a,b){void 0!==a.data&&(a=a.data);a.scale=void 0!==a.scale?
1/a.scale:1;var c=new N,d=a,e,f,g,h=d.faces;var l=d.vertices;var k=d.normals,u=d.colors;var n=d.scale;var t=0;if(void 0!==d.uvs){for(e=0;e<d.uvs.length;e++)d.uvs[e].length&&t++;for(e=0;e<t;e++)c.faceVertexUvs[e]=[]}var r=0;for(g=l.length;r<g;)e=new p,e.x=l[r++]*n,e.y=l[r++]*n,e.z=l[r++]*n,c.vertices.push(e);r=0;for(g=h.length;r<g;){l=h[r++];var q=l&1;var v=l&2;e=l&8;var x=l&16;var y=l&32;n=l&64;l&=128;if(q){q=new Wa;q.a=h[r];q.b=h[r+1];q.c=h[r+3];var w=new Wa;w.a=h[r+1];w.b=h[r+2];w.c=h[r+3];r+=4;
v&&(v=h[r++],q.materialIndex=v,w.materialIndex=v);v=c.faces.length;if(e)for(e=0;e<t;e++){var B=d.uvs[e];c.faceVertexUvs[e][v]=[];c.faceVertexUvs[e][v+1]=[];for(f=0;4>f;f++){var z=h[r++];var A=B[2*z];z=B[2*z+1];A=new C(A,z);2!==f&&c.faceVertexUvs[e][v].push(A);0!==f&&c.faceVertexUvs[e][v+1].push(A)}}x&&(x=3*h[r++],q.normal.set(k[x++],k[x++],k[x]),w.normal.copy(q.normal));if(y)for(e=0;4>e;e++)x=3*h[r++],y=new p(k[x++],k[x++],k[x]),2!==e&&q.vertexNormals.push(y),0!==e&&w.vertexNormals.push(y);n&&(n=
h[r++],n=u[n],q.color.setHex(n),w.color.setHex(n));if(l)for(e=0;4>e;e++)n=h[r++],n=u[n],2!==e&&q.vertexColors.push(new I(n)),0!==e&&w.vertexColors.push(new I(n));c.faces.push(q);c.faces.push(w)}else{q=new Wa;q.a=h[r++];q.b=h[r++];q.c=h[r++];v&&(v=h[r++],q.materialIndex=v);v=c.faces.length;if(e)for(e=0;e<t;e++)for(B=d.uvs[e],c.faceVertexUvs[e][v]=[],f=0;3>f;f++)z=h[r++],A=B[2*z],z=B[2*z+1],A=new C(A,z),c.faceVertexUvs[e][v].push(A);x&&(x=3*h[r++],q.normal.set(k[x++],k[x++],k[x]));if(y)for(e=0;3>e;e++)x=
3*h[r++],y=new p(k[x++],k[x++],k[x]),q.vertexNormals.push(y);n&&(n=h[r++],q.color.setHex(u[n]));if(l)for(e=0;3>e;e++)n=h[r++],q.vertexColors.push(new I(u[n]));c.faces.push(q)}}d=a;r=void 0!==d.influencesPerVertex?d.influencesPerVertex:2;if(d.skinWeights)for(g=0,h=d.skinWeights.length;g<h;g+=r)c.skinWeights.push(new ea(d.skinWeights[g],1<r?d.skinWeights[g+1]:0,2<r?d.skinWeights[g+2]:0,3<r?d.skinWeights[g+3]:0));if(d.skinIndices)for(g=0,h=d.skinIndices.length;g<h;g+=r)c.skinIndices.push(new ea(d.skinIndices[g],
1<r?d.skinIndices[g+1]:0,2<r?d.skinIndices[g+2]:0,3<r?d.skinIndices[g+3]:0));c.bones=d.bones;c.bones&&0<c.bones.length&&(c.skinWeights.length!==c.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn("When skinning, number of vertices ("+c.vertices.length+"), skinIndices ("+c.skinIndices.length+"), and skinWeights ("+c.skinWeights.length+") should match.");g=a;h=g.scale;if(void 0!==g.morphTargets)for(d=0,r=g.morphTargets.length;d<r;d++)for(c.morphTargets[d]={},c.morphTargets[d].name=
g.morphTargets[d].name,c.morphTargets[d].vertices=[],k=c.morphTargets[d].vertices,u=g.morphTargets[d].vertices,t=0,l=u.length;t<l;t+=3)n=new p,n.x=u[t]*h,n.y=u[t+1]*h,n.z=u[t+2]*h,k.push(n);if(void 0!==g.morphColors&&0<g.morphColors.length)for(console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.'),h=c.faces,g=g.morphColors[0].colors,d=0,r=h.length;d<r;d++)h[d].color.fromArray(g,3*d);g=a;d=[];r=[];void 0!==g.animation&&r.push(g.animation);void 0!==g.animations&&
(g.animations.length?r=r.concat(g.animations):r.push(g.animations));for(g=0;g<r.length;g++)(h=Ba.parseAnimation(r[g],c.bones))&&d.push(h);c.morphTargets&&(r=Ba.CreateClipsFromMorphTargetSequences(c.morphTargets,10),d=d.concat(r));0<d.length&&(c.animations=d);c.computeFaceNormals();c.computeBoundingSphere();if(void 0===a.materials||0===a.materials.length)return{geometry:c};a=ic.prototype.initMaterials(a.materials,b,this.crossOrigin);return{geometry:c,materials:a}}}()});Object.assign(ff.prototype,{load:function(a,
b,c,d){""===this.texturePath&&(this.texturePath=a.substring(0,a.lastIndexOf("/")+1));var e=this;(new Ka(e.manager)).load(a,function(c){var f=null;try{f=JSON.parse(c)}catch(h){void 0!==d&&d(h);console.error("THREE:ObjectLoader: Can't parse "+a+".",h.message);return}c=f.metadata;void 0===c||void 0===c.type||"geometry"===c.type.toLowerCase()?console.error("THREE.ObjectLoader: Can't load "+a+". Use THREE.JSONLoader instead."):e.parse(f,b)},c,d)},setTexturePath:function(a){this.texturePath=a},setCrossOrigin:function(a){this.crossOrigin=
a},parse:function(a,b){var c=this.parseShape(a.shapes);c=this.parseGeometries(a.geometries,c);var d=this.parseImages(a.images,function(){void 0!==b&&b(e)});d=this.parseTextures(a.textures,d);d=this.parseMaterials(a.materials,d);var e=this.parseObject(a.object,c,d);a.animations&&(e.animations=this.parseAnimations(a.animations));void 0!==a.images&&0!==a.images.length||void 0===b||b(e);return e},parseShape:function(a){var b={};if(void 0!==a)for(var c=0,d=a.length;c<d;c++){var e=(new gb).fromJSON(a[c]);
b[e.uuid]=e}return b},parseGeometries:function(a,b){var c={};if(void 0!==a)for(var d=new fe,e=new ee,f=0,g=a.length;f<g;f++){var h=a[f];switch(h.type){case "PlaneGeometry":case "PlaneBufferGeometry":var l=new Ca[h.type](h.width,h.height,h.widthSegments,h.heightSegments);break;case "BoxGeometry":case "BoxBufferGeometry":case "CubeGeometry":l=new Ca[h.type](h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case "CircleGeometry":case "CircleBufferGeometry":l=new Ca[h.type](h.radius,
h.segments,h.thetaStart,h.thetaLength);break;case "CylinderGeometry":case "CylinderBufferGeometry":l=new Ca[h.type](h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case "ConeGeometry":case "ConeBufferGeometry":l=new Ca[h.type](h.radius,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case "SphereGeometry":case "SphereBufferGeometry":l=new Ca[h.type](h.radius,h.widthSegments,h.heightSegments,
h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case "DodecahedronGeometry":case "DodecahedronBufferGeometry":case "IcosahedronGeometry":case "IcosahedronBufferGeometry":case "OctahedronGeometry":case "OctahedronBufferGeometry":case "TetrahedronGeometry":case "TetrahedronBufferGeometry":l=new Ca[h.type](h.radius,h.detail);break;case "RingGeometry":case "RingBufferGeometry":l=new Ca[h.type](h.innerRadius,h.outerRadius,h.thetaSegments,h.phiSegments,h.thetaStart,h.thetaLength);break;case "TorusGeometry":case "TorusBufferGeometry":l=
new Ca[h.type](h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case "TorusKnotGeometry":case "TorusKnotBufferGeometry":l=new Ca[h.type](h.radius,h.tube,h.tubularSegments,h.radialSegments,h.p,h.q);break;case "LatheGeometry":case "LatheBufferGeometry":l=new Ca[h.type](h.points,h.segments,h.phiStart,h.phiLength);break;case "PolyhedronGeometry":case "PolyhedronBufferGeometry":l=new Ca[h.type](h.vertices,h.indices,h.radius,h.details);break;case "ShapeGeometry":case "ShapeBufferGeometry":l=
[];f=0;for(g=h.shapes.length;f<g;f++)l.push(b[h.shapes[f]]);l=new Ca[h.type](l,h.curveSegments);break;case "BufferGeometry":l=e.parse(h);break;case "Geometry":l=d.parse(h,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+h.type+'"');continue}l.uuid=h.uuid;void 0!==h.name&&(l.name=h.name);c[h.uuid]=l}return c},parseMaterials:function(a,b){var c={};if(void 0!==a){var d=new Md;d.setTextures(b);b=0;for(var e=a.length;b<e;b++){var f=a[b];if("MultiMaterial"===
f.type){for(var g=[],h=0;h<f.materials.length;h++)g.push(d.parse(f.materials[h]));c[f.uuid]=g}else c[f.uuid]=d.parse(f)}}return c},parseAnimations:function(a){for(var b=[],c=0;c<a.length;c++){var d=Ba.parse(a[c]);b.push(d)}return b},parseImages:function(a,b){function c(a){d.manager.itemStart(a);return f.load(a,function(){d.manager.itemEnd(a)},void 0,function(){d.manager.itemEnd(a);d.manager.itemError(a)})}var d=this,e={};if(void 0!==a&&0<a.length){b=new ae(b);var f=new Yc(b);f.setCrossOrigin(this.crossOrigin);
b=0;for(var g=a.length;b<g;b++){var h=a[b],l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h.url)?h.url:d.texturePath+h.url;e[h.uuid]=c(l)}}return e},parseTextures:function(a,b){function c(a,b){if("number"===typeof a)return a;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",a);return b[a]}var d={};if(void 0!==a)for(var e=0,f=a.length;e<f;e++){var g=a[e];void 0===g.image&&console.warn('THREE.ObjectLoader: No "image" specified for',g.uuid);void 0===b[g.image]&&console.warn("THREE.ObjectLoader: Undefined image",
g.image);var h=new Y(b[g.image]);h.needsUpdate=!0;h.uuid=g.uuid;void 0!==g.name&&(h.name=g.name);void 0!==g.mapping&&(h.mapping=c(g.mapping,Og));void 0!==g.offset&&h.offset.fromArray(g.offset);void 0!==g.repeat&&h.repeat.fromArray(g.repeat);void 0!==g.center&&h.center.fromArray(g.center);void 0!==g.rotation&&(h.rotation=g.rotation);void 0!==g.wrap&&(h.wrapS=c(g.wrap[0],vf),h.wrapT=c(g.wrap[1],vf));void 0!==g.format&&(h.format=g.format);void 0!==g.minFilter&&(h.minFilter=c(g.minFilter,wf));void 0!==
g.magFilter&&(h.magFilter=c(g.magFilter,wf));void 0!==g.anisotropy&&(h.anisotropy=g.anisotropy);void 0!==g.flipY&&(h.flipY=g.flipY);d[g.uuid]=h}return d},parseObject:function(a,b,c){function d(a){void 0===b[a]&&console.warn("THREE.ObjectLoader: Undefined geometry",a);return b[a]}function e(a){if(void 0!==a){if(Array.isArray(a)){for(var b=[],d=0,e=a.length;d<e;d++){var f=a[d];void 0===c[f]&&console.warn("THREE.ObjectLoader: Undefined material",f);b.push(c[f])}return b}void 0===c[a]&&console.warn("THREE.ObjectLoader: Undefined material",
a);return c[a]}}switch(a.type){case "Scene":var f=new rd;void 0!==a.background&&Number.isInteger(a.background)&&(f.background=new I(a.background));void 0!==a.fog&&("Fog"===a.fog.type?f.fog=new Pb(a.fog.color,a.fog.near,a.fog.far):"FogExp2"===a.fog.type&&(f.fog=new Ob(a.fog.color,a.fog.density)));break;case "PerspectiveCamera":f=new la(a.fov,a.aspect,a.near,a.far);void 0!==a.focus&&(f.focus=a.focus);void 0!==a.zoom&&(f.zoom=a.zoom);void 0!==a.filmGauge&&(f.filmGauge=a.filmGauge);void 0!==a.filmOffset&&
(f.filmOffset=a.filmOffset);void 0!==a.view&&(f.view=Object.assign({},a.view));break;case "OrthographicCamera":f=new Jb(a.left,a.right,a.top,a.bottom,a.near,a.far);void 0!==a.zoom&&(f.zoom=a.zoom);void 0!==a.view&&(f.view=Object.assign({},a.view));break;case "AmbientLight":f=new Ed(a.color,a.intensity);break;case "DirectionalLight":f=new Dd(a.color,a.intensity);break;case "PointLight":f=new Bd(a.color,a.intensity,a.distance,a.decay);break;case "RectAreaLight":f=new Fd(a.color,a.intensity,a.width,
a.height);break;case "SpotLight":f=new Ad(a.color,a.intensity,a.distance,a.angle,a.penumbra,a.decay);break;case "HemisphereLight":f=new yd(a.color,a.groundColor,a.intensity);break;case "SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case "Mesh":f=d(a.geometry);var g=e(a.material);f=f.bones&&0<f.bones.length?new td(f,g):new oa(f,g);break;case "LOD":f=new Bc;break;case "Line":f=new ua(d(a.geometry),e(a.material),a.mode);break;case "LineLoop":f=new ud(d(a.geometry),
e(a.material));break;case "LineSegments":f=new aa(d(a.geometry),e(a.material));break;case "PointCloud":case "Points":f=new Qb(d(a.geometry),e(a.material));break;case "Sprite":f=new Ac(e(a.material));break;case "Group":f=new vd;break;default:f=new A}f.uuid=a.uuid;void 0!==a.name&&(f.name=a.name);void 0!==a.matrix?(f.matrix.fromArray(a.matrix),f.matrix.decompose(f.position,f.quaternion,f.scale)):(void 0!==a.position&&f.position.fromArray(a.position),void 0!==a.rotation&&f.rotation.fromArray(a.rotation),
void 0!==a.quaternion&&f.quaternion.fromArray(a.quaternion),void 0!==a.scale&&f.scale.fromArray(a.scale));void 0!==a.castShadow&&(f.castShadow=a.castShadow);void 0!==a.receiveShadow&&(f.receiveShadow=a.receiveShadow);a.shadow&&(void 0!==a.shadow.bias&&(f.shadow.bias=a.shadow.bias),void 0!==a.shadow.radius&&(f.shadow.radius=a.shadow.radius),void 0!==a.shadow.mapSize&&f.shadow.mapSize.fromArray(a.shadow.mapSize),void 0!==a.shadow.camera&&(f.shadow.camera=this.parseObject(a.shadow.camera)));void 0!==
a.visible&&(f.visible=a.visible);void 0!==a.frustumCulled&&(f.frustumCulled=a.frustumCulled);void 0!==a.renderOrder&&(f.renderOrder=a.renderOrder);void 0!==a.userData&&(f.userData=a.userData);if(void 0!==a.children){g=a.children;for(var h=0;h<g.length;h++)f.add(this.parseObject(g[h],b,c))}if("LOD"===a.type)for(a=a.levels,g=0;g<a.length;g++){h=a[g];var l=f.getObjectByProperty("uuid",h.object);void 0!==l&&f.addLevel(l,h.distance)}return f}});var Og={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,
EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},vf={RepeatWrapping:1E3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},wf={NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008};ge.prototype={constructor:ge,setOptions:function(a){this.options=a;return this},load:function(a,
b,c,d){void 0===a&&(a="");void 0!==this.path&&(a=this.path+a);var e=this,f=Hb.get(a);if(void 0!==f)return e.manager.itemStart(a),setTimeout(function(){b&&b(f);e.manager.itemEnd(a)},0),f;fetch(a).then(function(a){return a.blob()}).then(function(a){return createImageBitmap(a,e.options)}).then(function(c){Hb.add(a,c);b&&b(c);e.manager.itemEnd(a)}).catch(function(b){d&&d(b);e.manager.itemEnd(a);e.manager.itemError(a)})},setCrossOrigin:function(){return this},setPath:function(a){this.path=a;return this}};
Object.assign(he.prototype,{moveTo:function(a,b){this.currentPath=new Pa;this.subPaths.push(this.currentPath);this.currentPath.moveTo(a,b)},lineTo:function(a,b){this.currentPath.lineTo(a,b)},quadraticCurveTo:function(a,b,c,d){this.currentPath.quadraticCurveTo(a,b,c,d)},bezierCurveTo:function(a,b,c,d,e,f){this.currentPath.bezierCurveTo(a,b,c,d,e,f)},splineThru:function(a){this.currentPath.splineThru(a)},toShapes:function(a,b){function c(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c],f=new gb;f.curves=
e.curves;b.push(f)}return b}function d(a,b){for(var c=b.length,d=!1,e=c-1,f=0;f<c;e=f++){var g=b[e],h=b[f],l=h.x-g.x,k=h.y-g.y;if(Math.abs(k)>Number.EPSILON){if(0>k&&(g=b[f],l=-l,h=b[e],k=-k),!(a.y<g.y||a.y>h.y))if(a.y===g.y){if(a.x===g.x)return!0}else{e=k*(a.x-g.x)-l*(a.y-g.y);if(0===e)return!0;0>e||(d=!d)}}else if(a.y===g.y&&(h.x<=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=h.x))return!0}return d}var e=Xa.isClockWise,f=this.subPaths;if(0===f.length)return[];if(!0===b)return c(f);b=[];if(1===f.length){var g=f[0];
var h=new gb;h.curves=g.curves;b.push(h);return b}var l=!e(f[0].getPoints());l=a?!l:l;h=[];var k=[],p=[],n=0;k[n]=void 0;p[n]=[];for(var t=0,r=f.length;t<r;t++){g=f[t];var q=g.getPoints();var v=e(q);(v=a?!v:v)?(!l&&k[n]&&n++,k[n]={s:new gb,p:q},k[n].s.curves=g.curves,l&&n++,p[n]=[]):p[n].push({h:g,p:q[0]})}if(!k[0])return c(f);if(1<k.length){t=!1;a=[];e=0;for(f=k.length;e<f;e++)h[e]=[];e=0;for(f=k.length;e<f;e++)for(g=p[e],v=0;v<g.length;v++){l=g[v];n=!0;for(q=0;q<k.length;q++)d(l.p,k[q].p)&&(e!==
q&&a.push({froms:e,tos:q,hole:v}),n?(n=!1,h[q].push(l)):t=!0);n&&h[e].push(l)}0<a.length&&(t||(p=h))}t=0;for(e=k.length;t<e;t++)for(h=k[t].s,b.push(h),a=p[t],f=0,g=a.length;f<g;f++)h.holes.push(a[f].h);return b}});Object.assign(ie.prototype,{isFont:!0,generateShapes:function(a,b,c){void 0===b&&(b=100);c=[];var d=b;b=this.data;var e=String(a).split("");d/=b.resolution;var f=(b.boundingBox.yMax-b.boundingBox.yMin+b.underlineThickness)*d;a=[];for(var g=0,h=0,l=0;l<e.length;l++){var k=e[l];if("\n"===
k)g=0,h-=f;else{var p=d;var n=g,t=h;if(k=b.glyphs[k]||b.glyphs["?"]){var r=new he;if(k.o)for(var q=k._cachedOutline||(k._cachedOutline=k.o.split(" ")),v=0,x=q.length;v<x;)switch(q[v++]){case "m":var y=q[v++]*p+n;var w=q[v++]*p+t;r.moveTo(y,w);break;case "l":y=q[v++]*p+n;w=q[v++]*p+t;r.lineTo(y,w);break;case "q":var z=q[v++]*p+n;var A=q[v++]*p+t;var C=q[v++]*p+n;var E=q[v++]*p+t;r.quadraticCurveTo(C,E,z,A);break;case "b":z=q[v++]*p+n,A=q[v++]*p+t,C=q[v++]*p+n,E=q[v++]*p+t,y=q[v++]*p+n,w=q[v++]*p+t,
r.bezierCurveTo(C,E,y,w,z,A)}p={offsetX:k.ha*p,path:r}}else p=void 0;g+=p.offsetX;a.push(p.path)}}b=0;for(e=a.length;b<e;b++)Array.prototype.push.apply(c,a[b].toShapes());return c}});Object.assign(gf.prototype,{load:function(a,b,c,d){var e=this,f=new Ka(this.manager);f.setPath(this.path);f.load(a,function(a){try{var c=JSON.parse(a)}catch(l){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),c=JSON.parse(a.substring(65,a.length-2))}a=e.parse(c);b&&
b(a)},c,d)},parse:function(a){return new ie(a)},setPath:function(a){this.path=a;return this}});var Rd,le={getContext:function(){void 0===Rd&&(Rd=new (window.AudioContext||window.webkitAudioContext));return Rd},setContext:function(a){Rd=a}};Object.assign(je.prototype,{load:function(a,b,c,d){var e=new Ka(this.manager);e.setResponseType("arraybuffer");e.load(a,function(a){le.getContext().decodeAudioData(a,function(a){b(a)})},c,d)}});Object.assign(hf.prototype,{update:function(){var a,b,c,d,e,f,g,h,l=
new M,k=new M;return function(m){if(a!==this||b!==m.focus||c!==m.fov||d!==m.aspect*this.aspect||e!==m.near||f!==m.far||g!==m.zoom||h!==this.eyeSep){a=this;b=m.focus;c=m.fov;d=m.aspect*this.aspect;e=m.near;f=m.far;g=m.zoom;var n=m.projectionMatrix.clone();h=this.eyeSep/2;var p=h*e/b,r=e*Math.tan(S.DEG2RAD*c*.5)/g;k.elements[12]=-h;l.elements[12]=h;var q=-r*d+p;var u=r*d+p;n.elements[0]=2*e/(u-q);n.elements[8]=(u+q)/(u-q);this.cameraL.projectionMatrix.copy(n);q=-r*d-p;u=r*d-p;n.elements[0]=2*e/(u-q);
n.elements[8]=(u+q)/(u-q);this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(m.matrixWorld).multiply(k);this.cameraR.matrixWorld.copy(m.matrixWorld).multiply(l)}}()});cd.prototype=Object.create(A.prototype);cd.prototype.constructor=cd;ke.prototype=Object.assign(Object.create(A.prototype),{constructor:ke,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),
this.filter=null)},getFilter:function(){return this.filter},setFilter:function(a){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination);this.filter=a;this.gain.connect(this.filter);this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(a){this.gain.gain.value=a},updateMatrixWorld:function(){var a=new p,b=new ja,c=new p,d=new p;return function(e){A.prototype.updateMatrixWorld.call(this,
e);e=this.context.listener;var f=this.up;this.matrixWorld.decompose(a,b,c);d.set(0,0,-1).applyQuaternion(b);e.positionX?(e.positionX.setValueAtTime(a.x,this.context.currentTime),e.positionY.setValueAtTime(a.y,this.context.currentTime),e.positionZ.setValueAtTime(a.z,this.context.currentTime),e.forwardX.setValueAtTime(d.x,this.context.currentTime),e.forwardY.setValueAtTime(d.y,this.context.currentTime),e.forwardZ.setValueAtTime(d.z,this.context.currentTime),e.upX.setValueAtTime(f.x,this.context.currentTime),
e.upY.setValueAtTime(f.y,this.context.currentTime),e.upZ.setValueAtTime(f.z,this.context.currentTime)):(e.setPosition(a.x,a.y,a.z),e.setOrientation(d.x,d.y,d.z,f.x,f.y,f.z))}}()});jc.prototype=Object.assign(Object.create(A.prototype),{constructor:jc,getOutput:function(){return this.gain},setNodeSource:function(a){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=a;this.connect();return this},setBuffer:function(a){this.buffer=a;this.sourceType="buffer";this.autoplay&&this.play();return this},
play:function(){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else{var a=this.context.createBufferSource();a.buffer=this.buffer;a.loop=this.loop;a.onended=this.onEnded.bind(this);a.playbackRate.setValueAtTime(this.playbackRate,this.startTime);this.startTime=this.context.currentTime;a.start(this.startTime,this.offset);this.isPlaying=!0;this.source=a;return this.connect()}},
pause:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return!0===this.isPlaying&&(this.source.stop(),this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this},stop:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.source.stop(),this.offset=0,this.isPlaying=!1,this},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);
for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},
getFilters:function(){return this.filters},setFilters:function(a){a||(a=[]);!0===this.isPlaying?(this.disconnect(),this.filters=a,this.connect()):this.filters=a;return this},getFilter:function(){return this.getFilters()[0]},setFilter:function(a){return this.setFilters(a?[a]:[])},setPlaybackRate:function(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.playbackRate=a,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,
this.context.currentTime),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.loop=a,!0===this.isPlaying&&(this.source.loop=this.loop),this},getVolume:function(){return this.gain.gain.value},
setVolume:function(a){this.gain.gain.value=a;return this}});me.prototype=Object.assign(Object.create(jc.prototype),{constructor:me,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(a){this.panner.refDistance=a},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(a){this.panner.rolloffFactor=a},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(a){this.panner.distanceModel=
a},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(a){this.panner.maxDistance=a},updateMatrixWorld:function(){var a=new p;return function(b){A.prototype.updateMatrixWorld.call(this,b);a.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(a.x,a.y,a.z)}}()});Object.assign(ne.prototype,{getFrequencyData:function(){this.analyser.getByteFrequencyData(this.data);return this.data},getAverageFrequency:function(){for(var a=0,b=this.getFrequencyData(),c=0;c<b.length;c++)a+=
b[c];return a/b.length}});Object.assign(oe.prototype,{accumulate:function(a,b){var c=this.buffer,d=this.valueSize;a=a*d+d;var e=this.cumulativeWeight;if(0===e){for(e=0;e!==d;++e)c[a+e]=c[e];e=b}else e+=b,this._mixBufferRegion(c,a,0,b/e,d);this.cumulativeWeight=e},apply:function(a){var b=this.valueSize,c=this.buffer;a=a*b+b;var d=this.cumulativeWeight,e=this.binding;this.cumulativeWeight=0;1>d&&this._mixBufferRegion(c,a,3*b,1-d,b);d=b;for(var f=b+b;d!==f;++d)if(c[d]!==c[d+b]){e.setValue(c,a);break}},
saveOriginalState:function(){var a=this.buffer,b=this.valueSize,c=3*b;this.binding.getValue(a,c);for(var d=b;d!==c;++d)a[d]=a[c+d%b];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(a,b,c,d,e){if(.5<=d)for(d=0;d!==e;++d)a[b+d]=a[c+d]},_slerp:function(a,b,c,d){ja.slerpFlat(a,b,a,b,a,c,d)},_lerp:function(a,b,c,d,e){for(var f=1-d,g=0;g!==e;++g){var h=b+g;a[h]=a[h]*f+a[c+g]*d}}});Object.assign(jf.prototype,{getValue:function(a,
b){this.bind();var c=this._bindings[this._targetGroup.nCachedObjects_];void 0!==c&&c.getValue(a,b)},setValue:function(a,b){for(var c=this._bindings,d=this._targetGroup.nCachedObjects_,e=c.length;d!==e;++d)c[d].setValue(a,b)},bind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].bind()},unbind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].unbind()}});Object.assign(qa,{Composite:jf,create:function(a,
b,c){return a&&a.isAnimationObjectGroup?new qa.Composite(a,b,c):new qa(a,b,c)},sanitizeNodeName:function(){var a=/[\[\]\.:\/]/g;return function(b){return b.replace(/\s/g,"_").replace(a,"")}}(),parseTrackName:function(){var a="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",b=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]");a=/(WCOD+)?/.source.replace("WCOD",a);var c=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),d=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),
e=new RegExp("^"+b+a+c+d+"$"),f=["material","materials","bones"];return function(a){var b=e.exec(a);if(!b)throw Error("PropertyBinding: Cannot parse trackName: "+a);b={nodeName:b[2],objectName:b[3],objectIndex:b[4],propertyName:b[5],propertyIndex:b[6]};var c=b.nodeName&&b.nodeName.lastIndexOf(".");if(void 0!==c&&-1!==c){var d=b.nodeName.substring(c+1);-1!==f.indexOf(d)&&(b.nodeName=b.nodeName.substring(0,c),b.objectName=d)}if(null===b.propertyName||0===b.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+
a);return b}}(),findNode:function(a,b){if(!b||""===b||"root"===b||"."===b||-1===b||b===a.name||b===a.uuid)return a;if(a.skeleton){var c=a.skeleton.getBoneByName(b);if(void 0!==c)return c}if(a.children){var d=function(a){for(var c=0;c<a.length;c++){var e=a[c];if(e.name===b||e.uuid===b||(e=d(e.children)))return e}return null};if(a=d(a.children))return a}return null}});Object.assign(qa.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,
ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,b){a[b]=this.node[this.propertyName]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)a[b++]=c[d]},function(a,b){a[b]=this.resolvedProperty[this.propertyIndex]},function(a,b){this.resolvedProperty.toArray(a,b)}],SetterByBindingTypeAndVersioning:[[function(a,b){this.targetObject[this.propertyName]=a[b]},function(a,b){this.targetObject[this.propertyName]=
a[b];this.targetObject.needsUpdate=!0},function(a,b){this.targetObject[this.propertyName]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.needsUpdate=!0},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty[this.propertyIndex]=
a[b]},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty.fromArray(a,b)},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(a,b){this.bind();this.getValue(a,b)},setValue:function(a,
b){this.bind();this.setValue(a,b)},bind:function(){var a=this.node,b=this.parsedPath,c=b.objectName,d=b.propertyName,e=b.propertyIndex;a||(this.node=a=qa.findNode(this.rootNode,b.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(a){if(c){var f=b.objectIndex;switch(c){case "materials":if(!a.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!a.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",
this);return}a=a.material.materials;break;case "bones":if(!a.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}a=a.skeleton.bones;for(c=0;c<a.length;c++)if(a[c].name===f){f=c;break}break;default:if(void 0===a[c]){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}a=a[c]}if(void 0!==f){if(void 0===a[f]){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",
this,a);return}a=a[f]}}f=a[d];if(void 0===f)console.error("THREE.PropertyBinding: Trying to update property for track: "+b.nodeName+"."+d+" but it wasn't found.",a);else{b=this.Versioning.None;void 0!==a.needsUpdate?(b=this.Versioning.NeedsUpdate,this.targetObject=a):void 0!==a.matrixWorldNeedsUpdate&&(b=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=a);c=this.BindingType.Direct;if(void 0!==e){if("morphTargetInfluences"===d){if(!a.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",
this);return}if(a.geometry.isBufferGeometry){if(!a.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}for(c=0;c<this.node.geometry.morphAttributes.position.length;c++)if(a.geometry.morphAttributes.position[c].name===e){e=c;break}}else{if(!a.geometry.morphTargets){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",
this);return}for(c=0;c<this.node.geometry.morphTargets.length;c++)if(a.geometry.morphTargets[c].name===e){e=c;break}}}c=this.BindingType.ArrayElement;this.resolvedProperty=f;this.propertyIndex=e}else void 0!==f.fromArray&&void 0!==f.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=f):Array.isArray(f)?(c=this.BindingType.EntireArray,this.resolvedProperty=f):this.propertyName=d;this.getValue=this.GetterByBindingType[c];this.setValue=this.SetterByBindingTypeAndVersioning[c][b]}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+
this.path+" but it wasn't found.")},unbind:function(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}});Object.assign(qa.prototype,{_getValue_unbound:qa.prototype.getValue,_setValue_unbound:qa.prototype.setValue});Object.assign(kf.prototype,{isAnimationObjectGroup:!0,add:function(){for(var a=this._objects,b=a.length,c=this.nCachedObjects_,d=this._indicesByUUID,e=this._paths,f=this._parsedPaths,g=this._bindings,h=g.length,k=void 0,m=0,p=arguments.length;m!==
p;++m){var n=arguments[m],t=n.uuid,r=d[t];if(void 0===r){r=b++;d[t]=r;a.push(n);t=0;for(var q=h;t!==q;++t)g[t].push(new qa(n,e[t],f[t]))}else if(r<c){k=a[r];var v=--c;q=a[v];d[q.uuid]=r;a[r]=q;d[t]=v;a[v]=n;t=0;for(q=h;t!==q;++t){var x=g[t],y=x[r];x[r]=x[v];void 0===y&&(y=new qa(n,e[t],f[t]));x[v]=y}}else a[r]!==k&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=
c},remove:function(){for(var a=this._objects,b=this.nCachedObjects_,c=this._indicesByUUID,d=this._bindings,e=d.length,f=0,g=arguments.length;f!==g;++f){var h=arguments[f],k=h.uuid,m=c[k];if(void 0!==m&&m>=b){var p=b++,n=a[p];c[n.uuid]=m;a[m]=n;c[k]=p;a[p]=h;h=0;for(k=e;h!==k;++h){n=d[h];var t=n[m];n[m]=n[p];n[p]=t}}}this.nCachedObjects_=b},uncache:function(){for(var a=this._objects,b=a.length,c=this.nCachedObjects_,d=this._indicesByUUID,e=this._bindings,f=e.length,g=0,h=arguments.length;g!==h;++g){var k=
arguments[g].uuid,m=d[k];if(void 0!==m)if(delete d[k],m<c){k=--c;var p=a[k],n=--b,t=a[n];d[p.uuid]=m;a[m]=p;d[t.uuid]=k;a[k]=t;a.pop();p=0;for(t=f;p!==t;++p){var r=e[p],q=r[n];r[m]=r[k];r[k]=q;r.pop()}}else for(n=--b,t=a[n],d[t.uuid]=m,a[m]=t,a.pop(),p=0,t=f;p!==t;++p)r=e[p],r[m]=r[n],r.pop()}this.nCachedObjects_=c},subscribe_:function(a,b){var c=this._bindingsIndicesByPath,d=c[a],e=this._bindings;if(void 0!==d)return e[d];var f=this._paths,g=this._parsedPaths,h=this._objects,k=this.nCachedObjects_,
m=Array(h.length);d=e.length;c[a]=d;f.push(a);g.push(b);e.push(m);c=k;for(d=h.length;c!==d;++c)m[c]=new qa(h[c],a,b);return m},unsubscribe_:function(a){var b=this._bindingsIndicesByPath,c=b[a];if(void 0!==c){var d=this._paths,e=this._parsedPaths,f=this._bindings,g=f.length-1,h=f[g];b[a[g]]=c;f[c]=h;f.pop();e[c]=e[g];e.pop();d[c]=d[g];d.pop()}}});Object.assign(lf.prototype,{play:function(){this._mixer._activateAction(this);return this},stop:function(){this._mixer._deactivateAction(this);return this.reset()},
reset:function(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(a){this._startTime=a;return this},setLoop:function(a,b){this.loop=a;this.repetitions=b;return this},setEffectiveWeight:function(a){this.weight=a;
this._effectiveWeight=this.enabled?a:0;return this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(a){return this._scheduleFading(a,0,1)},fadeOut:function(a){return this._scheduleFading(a,1,0)},crossFadeFrom:function(a,b,c){a.fadeOut(b);this.fadeIn(b);if(c){c=this._clip.duration;var d=a._clip.duration,e=c/d;a.warp(1,d/c,b);this.warp(e,1,b)}return this},crossFadeTo:function(a,b,c){return a.crossFadeFrom(this,b,c)},stopFading:function(){var a=this._weightInterpolant;
null!==a&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},setEffectiveTimeScale:function(a){this.timeScale=a;this._effectiveTimeScale=this.paused?0:a;return this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(a){this.timeScale=this._clip.duration/a;return this.stopWarping()},syncWith:function(a){this.time=a.time;this.timeScale=a.timeScale;return this.stopWarping()},halt:function(a){return this.warp(this._effectiveTimeScale,
0,a)},warp:function(a,b,c){var d=this._mixer,e=d.time,f=this._timeScaleInterpolant,g=this.timeScale;null===f&&(this._timeScaleInterpolant=f=d._lendControlInterpolant());d=f.parameterPositions;f=f.sampleValues;d[0]=e;d[1]=e+c;f[0]=a/g;f[1]=b/g;return this},stopWarping:function(){var a=this._timeScaleInterpolant;null!==a&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||
this._mixer._root},_update:function(a,b,c,d){if(this.enabled){var e=this._startTime;if(null!==e){b=(a-e)*c;if(0>b||0===c)return;this._startTime=null;b*=c}b*=this._updateTimeScale(a);c=this._updateTime(b);a=this._updateWeight(a);if(0<a){b=this._interpolants;e=this._propertyBindings;for(var f=0,g=b.length;f!==g;++f)b[f].evaluate(c),e[f].accumulate(d,a)}}else this._updateWeight(a)},_updateWeight:function(a){var b=0;if(this.enabled){b=this.weight;var c=this._weightInterpolant;if(null!==c){var d=c.evaluate(a)[0];
b*=d;a>c.parameterPositions[1]&&(this.stopFading(),0===d&&(this.enabled=!1))}}return this._effectiveWeight=b},_updateTimeScale:function(a){var b=0;if(!this.paused){b=this.timeScale;var c=this._timeScaleInterpolant;if(null!==c){var d=c.evaluate(a)[0];b*=d;a>c.parameterPositions[1]&&(this.stopWarping(),0===b?this.paused=!0:this.timeScale=b)}}return this._effectiveTimeScale=b},_updateTime:function(a){var b=this.time+a;if(0===a)return b;var c=this._clip.duration,d=this.loop,e=this._loopCount;if(2200===
d)a:{if(-1===e&&(this._loopCount=0,this._setEndings(!0,!0,!1)),b>=c)b=c;else if(0>b)b=0;else break a;this.clampWhenFinished?this.paused=!0:this.enabled=!1;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>a?-1:1})}else{d=2202===d;-1===e&&(0<=a?(e=0,this._setEndings(!0,0===this.repetitions,d)):this._setEndings(0===this.repetitions,!0,d));if(b>=c||0>b){var f=Math.floor(b/c);b-=c*f;e+=Math.abs(f);var g=this.repetitions-e;0>=g?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,b=
0<a?c:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<a?1:-1})):(1===g?(a=0>a,this._setEndings(a,!a,d)):this._setEndings(!1,!1,d),this._loopCount=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:f}))}if(d&&1===(e&1))return this.time=b,c-b}return this.time=b},_setEndings:function(a,b,c){var d=this._interpolantSettings;c?(d.endingStart=2401,d.endingEnd=2401):(d.endingStart=a?this.zeroSlopeAtStart?2401:2400:2402,d.endingEnd=b?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(a,
b,c){var d=this._mixer,e=d.time,f=this._weightInterpolant;null===f&&(this._weightInterpolant=f=d._lendControlInterpolant());d=f.parameterPositions;f=f.sampleValues;d[0]=e;f[0]=b;d[1]=e+a;f[1]=c;return this}});pe.prototype=Object.assign(Object.create(xa.prototype),{constructor:pe,_bindAction:function(a,b){var c=a._localRoot||this._root,d=a._clip.tracks,e=d.length,f=a._propertyBindings;a=a._interpolants;var g=c.uuid,h=this._bindingsByRootAndName,k=h[g];void 0===k&&(k={},h[g]=k);for(h=0;h!==e;++h){var m=
d[h],p=m.name,n=k[p];if(void 0===n){n=f[h];if(void 0!==n){null===n._cacheIndex&&(++n.referenceCount,this._addInactiveBinding(n,g,p));continue}n=new oe(qa.create(c,p,b&&b._propertyBindings[h].binding.parsedPath),m.ValueTypeName,m.getValueSize());++n.referenceCount;this._addInactiveBinding(n,g,p)}f[h]=n;a[h].resultBuffer=n.buffer}},_activateAction:function(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var b=(a._localRoot||this._root).uuid,c=a._clip.uuid,d=this._actionsByClip[c];this._bindAction(a,
d&&d.knownActions[0]);this._addInactiveAction(a,c,b)}b=a._propertyBindings;c=0;for(d=b.length;c!==d;++c){var e=b[c];0===e.useCount++&&(this._lendBinding(e),e.saveOriginalState())}this._lendAction(a)}},_deactivateAction:function(a){if(this._isActiveAction(a)){for(var b=a._propertyBindings,c=0,d=b.length;c!==d;++c){var e=b[c];0===--e.useCount&&(e.restoreOriginalState(),this._takeBackBinding(e))}this._takeBackAction(a)}},_initMemoryManager:function(){this._actions=[];this._nActiveActions=0;this._actionsByClip=
{};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var a=this;this.stats={actions:{get total(){return a._actions.length},get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}},_isActiveAction:function(a){a=a._cacheIndex;
return null!==a&&a<this._nActiveActions},_addInactiveAction:function(a,b,c){var d=this._actions,e=this._actionsByClip,f=e[b];void 0===f?(f={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,e[b]=f):(b=f.knownActions,a._byClipCacheIndex=b.length,b.push(a));a._cacheIndex=d.length;d.push(a);f.actionByRoot[c]=a},_removeInactiveAction:function(a){var b=this._actions,c=b[b.length-1],d=a._cacheIndex;c._cacheIndex=d;b[d]=c;b.pop();a._cacheIndex=null;b=a._clip.uuid;c=this._actionsByClip;d=c[b];var e=
d.knownActions,f=e[e.length-1],g=a._byClipCacheIndex;f._byClipCacheIndex=g;e[g]=f;e.pop();a._byClipCacheIndex=null;delete d.actionByRoot[(a._localRoot||this._root).uuid];0===e.length&&delete c[b];this._removeInactiveBindingsForAction(a)},_removeInactiveBindingsForAction:function(a){a=a._propertyBindings;for(var b=0,c=a.length;b!==c;++b){var d=a[b];0===--d.referenceCount&&this._removeInactiveBinding(d)}},_lendAction:function(a){var b=this._actions,c=a._cacheIndex,d=this._nActiveActions++,e=b[d];a._cacheIndex=
d;b[d]=a;e._cacheIndex=c;b[c]=e},_takeBackAction:function(a){var b=this._actions,c=a._cacheIndex,d=--this._nActiveActions,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_addInactiveBinding:function(a,b,c){var d=this._bindingsByRootAndName,e=d[b],f=this._bindings;void 0===e&&(e={},d[b]=e);e[c]=a;a._cacheIndex=f.length;f.push(a)},_removeInactiveBinding:function(a){var b=this._bindings,c=a.binding,d=c.rootNode.uuid;c=c.path;var e=this._bindingsByRootAndName,f=e[d],g=b[b.length-1];a=a._cacheIndex;
g._cacheIndex=a;b[a]=g;b.pop();delete f[c];a:{for(var h in f)break a;delete e[d]}},_lendBinding:function(a){var b=this._bindings,c=a._cacheIndex,d=this._nActiveBindings++,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_takeBackBinding:function(a){var b=this._bindings,c=a._cacheIndex,d=--this._nActiveBindings,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_lendControlInterpolant:function(){var a=this._controlInterpolants,b=this._nActiveControlInterpolants++,c=a[b];void 0===c&&(c=new bd(new Float32Array(2),
new Float32Array(2),1,this._controlInterpolantsResultBuffer),c.__cacheIndex=b,a[b]=c);return c},_takeBackControlInterpolant:function(a){var b=this._controlInterpolants,c=a.__cacheIndex,d=--this._nActiveControlInterpolants,e=b[d];a.__cacheIndex=d;b[d]=a;e.__cacheIndex=c;b[c]=e},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(a,b){var c=b||this._root,d=c.uuid;c="string"===typeof a?Ba.findByName(c,a):a;a=null!==c?c.uuid:a;var e=this._actionsByClip[a],f=null;if(void 0!==e){f=
e.actionByRoot[d];if(void 0!==f)return f;f=e.knownActions[0];null===c&&(c=f._clip)}if(null===c)return null;b=new lf(this,c,b);this._bindAction(b,f);this._addInactiveAction(b,a,d);return b},existingAction:function(a,b){var c=b||this._root;b=c.uuid;c="string"===typeof a?Ba.findByName(c,a):a;a=this._actionsByClip[c?c.uuid:a];return void 0!==a?a.actionByRoot[b]||null:null},stopAllAction:function(){for(var a=this._actions,b=this._nActiveActions,c=this._bindings,d=this._nActiveBindings,e=this._nActiveBindings=
this._nActiveActions=0;e!==b;++e)a[e].reset();for(e=0;e!==d;++e)c[e].useCount=0;return this},update:function(a){a*=this.timeScale;for(var b=this._actions,c=this._nActiveActions,d=this.time+=a,e=Math.sign(a),f=this._accuIndex^=1,g=0;g!==c;++g)b[g]._update(d,a,e,f);a=this._bindings;b=this._nActiveBindings;for(g=0;g!==b;++g)a[g].apply(f);return this},getRoot:function(){return this._root},uncacheClip:function(a){var b=this._actions;a=a.uuid;var c=this._actionsByClip,d=c[a];if(void 0!==d){d=d.knownActions;
for(var e=0,f=d.length;e!==f;++e){var g=d[e];this._deactivateAction(g);var h=g._cacheIndex,k=b[b.length-1];g._cacheIndex=null;g._byClipCacheIndex=null;k._cacheIndex=h;b[h]=k;b.pop();this._removeInactiveBindingsForAction(g)}delete c[a]}},uncacheRoot:function(a){a=a.uuid;var b=this._actionsByClip;for(d in b){var c=b[d].actionByRoot[a];void 0!==c&&(this._deactivateAction(c),this._removeInactiveAction(c))}var d=this._bindingsByRootAndName[a];if(void 0!==d)for(var e in d)a=d[e],a.restoreOriginalState(),
this._removeInactiveBinding(a)},uncacheAction:function(a,b){a=this.existingAction(a,b);null!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}});Nd.prototype.clone=function(){return new Nd(void 0===this.value.clone?this.value:this.value.clone())};qe.prototype=Object.assign(Object.create(F.prototype),{constructor:qe,isInstancedBufferGeometry:!0,copy:function(a){F.prototype.copy.call(this,a);this.maxInstancedCount=a.maxInstancedCount;return this},clone:function(){return(new this.constructor).copy(this)}});
Object.defineProperties(re.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}});Object.assign(re.prototype,{isInterleavedBufferAttribute:!0,setX:function(a,b){this.data.array[a*this.data.stride+this.offset]=b;return this},setY:function(a,b){this.data.array[a*this.data.stride+this.offset+1]=b;return this},setZ:function(a,b){this.data.array[a*this.data.stride+this.offset+2]=b;return this},setW:function(a,b){this.data.array[a*this.data.stride+this.offset+
3]=b;return this},getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+this.offset+1]},getZ:function(a){return this.data.array[a*this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*this.data.stride+this.offset+3]},setXY:function(a,b,c){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a=a*this.data.stride+this.offset;this.data.array[a+
0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;this.data.array[a+3]=e;return this}});Object.defineProperty(kc.prototype,"needsUpdate",{set:function(a){!0===a&&this.version++}});Object.assign(kc.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(a){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");
this.count=void 0!==a?a.length/this.stride:0;this.array=a},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.count=a.count;this.stride=a.stride;this.dynamic=a.dynamic;return this},copyAt:function(a,b,c){a*=this.stride;c*=b.stride;for(var d=0,e=this.stride;d<e;d++)this.array[a+d]=b.array[c+d];return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(a){this.onUploadCallback=
a;return this}});se.prototype=Object.assign(Object.create(kc.prototype),{constructor:se,isInstancedInterleavedBuffer:!0,copy:function(a){kc.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this}});te.prototype=Object.assign(Object.create(T.prototype),{constructor:te,isInstancedBufferAttribute:!0,copy:function(a){T.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this}});Object.assign(mf.prototype,{linePrecision:1,set:function(a,b){this.ray.set(a,
b)},setFromCamera:function(a,b){b&&b.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(b.matrixWorld),this.ray.direction.set(a.x,a.y,.5).unproject(b).sub(this.ray.origin).normalize()):b&&b.isOrthographicCamera?(this.ray.origin.set(a.x,a.y,(b.near+b.far)/(b.near-b.far)).unproject(b),this.ray.direction.set(0,0,-1).transformDirection(b.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(a,b,c){c=c||[];ue(a,this,c,b);c.sort(nf);return c},intersectObjects:function(a,
b,c){c=c||[];if(!1===Array.isArray(a))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),c;for(var d=0,e=a.length;d<e;d++)ue(a[d],this,c,b);c.sort(nf);return c}});Object.assign(of.prototype,{start:function(){this.oldTime=this.startTime=("undefined"===typeof performance?Date:performance).now();this.elapsedTime=0;this.running=!0},stop:function(){this.getElapsedTime();this.autoStart=this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=
0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var b=("undefined"===typeof performance?Date:performance).now();a=(b-this.oldTime)/1E3;this.oldTime=b;this.elapsedTime+=a}return a}});Object.assign(pf.prototype,{set:function(a,b,c){this.radius=a;this.phi=b;this.theta=c;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius=a.radius;this.phi=a.phi;this.theta=a.theta;return this},makeSafe:function(){this.phi=Math.max(1E-6,Math.min(Math.PI-
1E-6,this.phi));return this},setFromVector3:function(a){this.radius=a.length();0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(a.x,a.z),this.phi=Math.acos(S.clamp(a.y/this.radius,-1,1)));return this}});Object.assign(qf.prototype,{set:function(a,b,c){this.radius=a;this.theta=b;this.y=c;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius=a.radius;this.theta=a.theta;this.y=a.y;return this},setFromVector3:function(a){this.radius=Math.sqrt(a.x*
a.x+a.z*a.z);this.theta=Math.atan2(a.x,a.z);this.y=a.y;return this}});Object.assign(ve.prototype,{set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new C;return function(b,c){c=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(c);this.max.copy(b).add(c);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);
this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(a){void 0===a&&(console.warn("THREE.Box2: .getCenter() target is now required"),a=new C);return this.isEmpty()?a.set(0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){void 0===a&&(console.warn("THREE.Box2: .getSize() target is now required"),a=new C);return this.isEmpty()?
a.set(0,0):a.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y},getParameter:function(a,
b){void 0===b&&(console.warn("THREE.Box2: .getParameter() target is now required"),b=new C);return b.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?!1:!0},clampPoint:function(a,b){void 0===b&&(console.warn("THREE.Box2: .clampPoint() target is now required"),b=new C);return b.copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new C;
return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}});dd.prototype=Object.create(A.prototype);dd.prototype.constructor=dd;dd.prototype.isImmediateRenderObject=!0;ed.prototype=Object.create(aa.prototype);
ed.prototype.constructor=ed;ed.prototype.update=function(){var a=new p,b=new p,c=new sa;return function(){var d=["a","b","c"];this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,f=this.geometry.attributes.position,g=this.object.geometry;if(g&&g.isGeometry)for(var h=g.vertices,k=g.faces,m=g=0,p=k.length;m<p;m++)for(var n=k[m],t=0,r=n.vertexNormals.length;t<r;t++){var q=n.vertexNormals[t];a.copy(h[n[d[t]]]).applyMatrix4(e);b.copy(q).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);
f.setXYZ(g,a.x,a.y,a.z);g+=1;f.setXYZ(g,b.x,b.y,b.z);g+=1}else if(g&&g.isBufferGeometry)for(d=g.attributes.position,h=g.attributes.normal,t=g=0,r=d.count;t<r;t++)a.set(d.getX(t),d.getY(t),d.getZ(t)).applyMatrix4(e),b.set(h.getX(t),h.getY(t),h.getZ(t)),b.applyMatrix3(c).normalize().multiplyScalar(this.size).add(a),f.setXYZ(g,a.x,a.y,a.z),g+=1,f.setXYZ(g,b.x,b.y,b.z),g+=1;f.needsUpdate=!0}}();lc.prototype=Object.create(A.prototype);lc.prototype.constructor=lc;lc.prototype.dispose=function(){this.cone.geometry.dispose();
this.cone.material.dispose()};lc.prototype.update=function(){var a=new p,b=new p;return function(){this.light.updateMatrixWorld();var c=this.light.distance?this.light.distance:1E3,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c);a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(b.sub(a));void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}();mc.prototype=Object.create(aa.prototype);
mc.prototype.constructor=mc;mc.prototype.updateMatrixWorld=function(){var a=new p,b=new M,c=new M;return function(d){var e=this.bones,f=this.geometry,g=f.getAttribute("position");c.getInverse(this.root.matrixWorld);for(var h=0,k=0;h<e.length;h++){var m=e[h];m.parent&&m.parent.isBone&&(b.multiplyMatrices(c,m.matrixWorld),a.setFromMatrixPosition(b),g.setXYZ(k,a.x,a.y,a.z),b.multiplyMatrices(c,m.parent.matrixWorld),a.setFromMatrixPosition(b),g.setXYZ(k+1,a.x,a.y,a.z),k+=2)}f.getAttribute("position").needsUpdate=
!0;A.prototype.updateMatrixWorld.call(this,d)}}();nc.prototype=Object.create(oa.prototype);nc.prototype.constructor=nc;nc.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};nc.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};oc.prototype=Object.create(A.prototype);oc.prototype.constructor=oc;oc.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose()};
oc.prototype.update=function(){var a=.5*this.light.width,b=.5*this.light.height,c=this.line.geometry.attributes.position,d=c.array;d[0]=a;d[1]=-b;d[2]=0;d[3]=a;d[4]=b;d[5]=0;d[6]=-a;d[7]=b;d[8]=0;d[9]=-a;d[10]=-b;d[11]=0;d[12]=a;d[13]=-b;d[14]=0;c.needsUpdate=!0;void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)};pc.prototype=Object.create(A.prototype);pc.prototype.constructor=pc;pc.prototype.dispose=function(){this.children[0].geometry.dispose();
this.children[0].material.dispose()};pc.prototype.update=function(){var a=new p,b=new I,c=new I;return function(){var d=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var e=d.geometry.getAttribute("color");b.copy(this.light.color);c.copy(this.light.groundColor);for(var f=0,g=e.count;f<g;f++){var h=f<g/2?b:c;e.setXYZ(f,h.r,h.g,h.b)}e.needsUpdate=!0}d.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate())}}();fd.prototype=Object.create(aa.prototype);fd.prototype.constructor=
fd;Od.prototype=Object.create(aa.prototype);Od.prototype.constructor=Od;gd.prototype=Object.create(aa.prototype);gd.prototype.constructor=gd;gd.prototype.update=function(){var a=new p,b=new p,c=new sa;return function(){this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);var d=this.object.matrixWorld,e=this.geometry.attributes.position,f=this.object.geometry,g=f.vertices;f=f.faces;for(var h=0,k=0,m=f.length;k<m;k++){var p=f[k],n=p.normal;a.copy(g[p.a]).add(g[p.b]).add(g[p.c]).divideScalar(3).applyMatrix4(d);
b.copy(n).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);e.setXYZ(h,a.x,a.y,a.z);h+=1;e.setXYZ(h,b.x,b.y,b.z);h+=1}e.needsUpdate=!0}}();qc.prototype=Object.create(A.prototype);qc.prototype.constructor=qc;qc.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};qc.prototype.update=function(){var a=new p,b=new p,c=new p;return function(){a.setFromMatrixPosition(this.light.matrixWorld);
b.setFromMatrixPosition(this.light.target.matrixWorld);c.subVectors(b,a);this.lightPlane.lookAt(c);void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color));this.targetLine.lookAt(c);this.targetLine.scale.z=c.length()}}();hd.prototype=Object.create(aa.prototype);hd.prototype.constructor=hd;hd.prototype.update=function(){function a(a,
g,h,k){d.set(g,h,k).unproject(e);a=c[a];if(void 0!==a)for(g=b.getAttribute("position"),h=0,k=a.length;h<k;h++)g.setXYZ(a[h],d.x,d.y,d.z)}var b,c,d=new p,e=new Qa;return function(){b=this.geometry;c=this.pointMap;e.projectionMatrix.copy(this.camera.projectionMatrix);a("c",0,0,-1);a("t",0,0,1);a("n1",-1,-1,-1);a("n2",1,-1,-1);a("n3",-1,1,-1);a("n4",1,1,-1);a("f1",-1,-1,1);a("f2",1,-1,1);a("f3",-1,1,1);a("f4",1,1,1);a("u1",.7,1.1,-1);a("u2",-.7,1.1,-1);a("u3",0,2,-1);a("cf1",-1,0,1);a("cf2",1,0,1);a("cf3",
0,-1,1);a("cf4",0,1,1);a("cn1",-1,0,-1);a("cn2",1,0,-1);a("cn3",0,-1,-1);a("cn4",0,1,-1);b.getAttribute("position").needsUpdate=!0}}();Fb.prototype=Object.create(aa.prototype);Fb.prototype.constructor=Fb;Fb.prototype.update=function(){var a=new Va;return function(b){void 0!==b&&console.warn("THREE.BoxHelper: .update() has no longer arguments.");void 0!==this.object&&a.setFromObject(this.object);if(!a.isEmpty()){b=a.min;var c=a.max,d=this.geometry.attributes.position,e=d.array;e[0]=c.x;e[1]=c.y;e[2]=
c.z;e[3]=b.x;e[4]=c.y;e[5]=c.z;e[6]=b.x;e[7]=b.y;e[8]=c.z;e[9]=c.x;e[10]=b.y;e[11]=c.z;e[12]=c.x;e[13]=c.y;e[14]=b.z;e[15]=b.x;e[16]=c.y;e[17]=b.z;e[18]=b.x;e[19]=b.y;e[20]=b.z;e[21]=c.x;e[22]=b.y;e[23]=b.z;d.needsUpdate=!0;this.geometry.computeBoundingSphere()}}}();Fb.prototype.setFromObject=function(a){this.object=a;this.update();return this};id.prototype=Object.create(aa.prototype);id.prototype.constructor=id;id.prototype.updateMatrixWorld=function(a){var b=this.box;b.isEmpty()||(b.getCenter(this.position),
b.getSize(this.scale),this.scale.multiplyScalar(.5),A.prototype.updateMatrixWorld.call(this,a))};jd.prototype=Object.create(ua.prototype);jd.prototype.constructor=jd;jd.prototype.updateMatrixWorld=function(a){var b=-this.plane.constant;1E-8>Math.abs(b)&&(b=1E-8);this.scale.set(.5*this.size,.5*this.size,b);this.lookAt(this.plane.normal);A.prototype.updateMatrixWorld.call(this,a)};var Pd,we;Gb.prototype=Object.create(A.prototype);Gb.prototype.constructor=Gb;Gb.prototype.setDirection=function(){var a=
new p,b;return function(c){.99999<c.y?this.quaternion.set(0,0,0,1):-.99999>c.y?this.quaternion.set(1,0,0,0):(a.set(c.z,0,-c.x).normalize(),b=Math.acos(c.y),this.quaternion.setFromAxisAngle(a,b))}}();Gb.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a);void 0===c&&(c=.2*b);this.line.scale.set(1,Math.max(0,a-b),1);this.line.updateMatrix();this.cone.scale.set(c,b,c);this.cone.position.y=a;this.cone.updateMatrix()};Gb.prototype.setColor=function(a){this.line.material.color.copy(a);this.cone.material.color.copy(a)};
kd.prototype=Object.create(aa.prototype);kd.prototype.constructor=kd;E.create=function(a,b){console.log("THREE.Curve.create() has been deprecated");a.prototype=Object.create(E.prototype);a.prototype.constructor=a;a.prototype.getPoint=b;return a};Object.assign(Za.prototype,{createPointsGeometry:function(a){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");a=this.getPoints(a);return this.createGeometry(a)},createSpacedPointsGeometry:function(a){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");
a=this.getSpacedPoints(a);return this.createGeometry(a)},createGeometry:function(a){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var b=new N,c=0,d=a.length;c<d;c++){var e=a[c];b.vertices.push(new p(e.x,e.y,e.z||0))}return b}});Object.assign(Pa.prototype,{fromPoints:function(a){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints().");this.setFromPoints(a)}});sf.prototype=Object.create(X.prototype);
tf.prototype=Object.create(X.prototype);xe.prototype=Object.create(X.prototype);Object.assign(xe.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}});fd.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};
mc.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Object.assign(ic.prototype,{extractUrlBase:function(a){console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead.");return Be.extractUrlBase(a)}});Object.assign(ve.prototype,{center:function(a){console.warn("THREE.Box2: .center() has been renamed to .getCenter().");return this.getCenter(a)},empty:function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");
return this.isEmpty()},isIntersectionBox:function(a){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},size:function(a){console.warn("THREE.Box2: .size() has been renamed to .getSize().");return this.getSize(a)}});Object.assign(Va.prototype,{center:function(a){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");return this.getCenter(a)},empty:function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");
return this.isEmpty()},isIntersectionBox:function(a){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionSphere:function(a){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)},size:function(a){console.warn("THREE.Box3: .size() has been renamed to .getSize().");return this.getSize(a)}});Lb.prototype.center=function(a){console.warn("THREE.Line3: .center() has been renamed to .getCenter().");
return this.getCenter(a)};Object.assign(S,{random16:function(){console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead.");return Math.random()},nearestPowerOfTwo:function(a){console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo().");return S.floorPowerOfTwo(a)},nextPowerOfTwo:function(a){console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo().");return S.ceilPowerOfTwo(a)}});Object.assign(sa.prototype,{flattenToArrayOffset:function(a,
b){console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(a,b)},multiplyVector3:function(a){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(a){console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.");
return this.applyToBufferAttribute(a)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}});Object.assign(M.prototype,{extractPosition:function(a){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(a)},flattenToArrayOffset:function(a,b){console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(a,b)},getPosition:function(){var a;
return function(){void 0===a&&(a=new p);console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return a.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(a){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(a)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(a){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead.");
return a.applyMatrix4(this)},multiplyVector4:function(a){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");
return a.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(a){console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.");
return this.applyToBufferAttribute(a)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(a,b,c,d,e,f){console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.");return this.makePerspective(a,b,d,c,e,f)}});Fa.prototype.isIntersectionLine=function(a){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");return this.intersectsLine(a)};
ja.prototype.multiplyVector3=function(a){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return a.applyQuaternion(this)};Object.assign(qb.prototype,{isIntersectionBox:function(a){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionPlane:function(a){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");return this.intersectsPlane(a)},
isIntersectionSphere:function(a){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)}});Object.assign(Aa.prototype,{area:function(){console.warn("THREE.Triangle: .area() has been renamed to .getArea().");return this.getArea()},barycoordFromPoint:function(a,b){console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().");return this.getBarycoord(a,b)},midpoint:function(a){console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint().");
return this.getMidpoint(a)},normal:function(a){console.warn("THREE.Triangle: .normal() has been renamed to .getNormal().");return this.getNormal(a)},plane:function(a){console.warn("THREE.Triangle: .plane() has been renamed to .getPlane().");return this.getPlane(a)}});Object.assign(Aa,{barycoordFromPoint:function(a,b,c,d,e){console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().");return Aa.getBarycoord(a,b,c,d,e)},normal:function(a,b,c,d){console.warn("THREE.Triangle: .normal() has been renamed to .getNormal().");
return Aa.getNormal(a,b,c,d)}});Object.assign(gb.prototype,{extractAllPoints:function(a){console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead.");return this.extractPoints(a)},extrude:function(a){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");return new fb(this,a)},makeGeometry:function(a){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new vb(this,a)}});Object.assign(C.prototype,
{fromAttribute:function(a,b,c){console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(a,b,c)},distanceToManhattan:function(a){console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(a)},lengthManhattan:function(){console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(p.prototype,
{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");
return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(b,a)},applyProjection:function(a){console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead.");return this.applyMatrix4(a)},fromAttribute:function(a,b,c){console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(a,
b,c)},distanceToManhattan:function(a){console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(a)},lengthManhattan:function(){console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(ea.prototype,{fromAttribute:function(a,b,c){console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(a,
b,c)},lengthManhattan:function(){console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(N.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}});Object.assign(A.prototype,{getChildByName:function(a){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");
return this.getObjectByName(a)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(a,b){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(b,a)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}});Object.defineProperties(A.prototype,
{eulerOrder:{get:function(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function(a){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=a}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});
Object.defineProperties(Bc.prototype,{objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}});Object.defineProperty(Cc.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}});Object.defineProperty(E.prototype,"__arcLengthDivisions",{get:function(){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.");
return this.arcLengthDivisions},set:function(a){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.");this.arcLengthDivisions=a}});la.prototype.setLens=function(a,b){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");void 0!==b&&(this.filmGauge=b);this.setFocalLength(a)};Object.defineProperties(ca.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(a){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");
this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=a}},shadowCameraTop:{set:function(a){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");
this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");this.shadow.camera.far=a}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(a){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");
this.shadow.bias=a}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(a){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");this.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=a}}});Object.defineProperties(T.prototype,{length:{get:function(){console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead.");
return this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}});Object.assign(F.prototype,{addIndex:function(a){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(a)},addDrawCall:function(a,b,c){void 0!==c&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.");console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(a,b)},
clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}});Object.defineProperties(F.prototype,{drawcalls:{get:function(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");
return this.groups}}});Object.defineProperties(Nd.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.");return this}}});Object.defineProperties(O.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},
wrapRGB:{get:function(){console.warn("THREE.Material: .wrapRGB has been removed.");return new I}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(a){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.");this.flatShading=1===a}}});Object.defineProperties(Ja.prototype,{metal:{get:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");
return!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(va.prototype,{derivatives:{get:function(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");return this.extensions.derivatives},set:function(a){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=a}}});Object.assign(Xd.prototype,
{getCurrentRenderTarget:function(){console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget().");return this.getRenderTarget()},getMaxAnisotropy:function(){console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy().");return this.capabilities.getMaxAnisotropy()},getPrecision:function(){console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision.");return this.capabilities.precision},resetGLState:function(){console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset().");
return this.state.reset()},supportsFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");
return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")},
supportsBlendMinMax:function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.");return this.capabilities.vertexTextures},supportsInstancedArrays:function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");
return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(a){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(a)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},
setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}});Object.defineProperties(Xd.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");this.shadowMap.type=a}},
shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(Ue.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},
renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});
Object.defineProperties(hb.prototype,{wrapS:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=a}},wrapT:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=a}},magFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");
return this.texture.magFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=a}},minFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=a}},anisotropy:{get:function(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");
return this.texture.anisotropy},set:function(a){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=a}},offset:{get:function(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function(a){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=a}},repeat:{get:function(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},
set:function(a){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=a}},format:{get:function(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function(a){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=a}},type:{get:function(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function(a){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");
this.texture.type=a}},generateMipmaps:{get:function(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function(a){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=a}}});Object.defineProperties(We.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}}});jc.prototype.load=function(a){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");
var b=this;(new je).load(a,function(a){b.setBuffer(a)});return this};ne.prototype.getData=function(){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()};cd.prototype.updateCubeMap=function(a,b){console.warn("THREE.CubeCamera: .updateCubeMap() is now .update().");return this.update(a,b)};k.WebGLRenderTargetCube=Ib;k.WebGLRenderTarget=hb;k.WebGLRenderer=Xd;k.ShaderLib=rb;k.UniformsLib=L;k.UniformsUtils=Da;k.ShaderChunk=V;k.FogExp2=Ob;k.Fog=Pb;
k.Scene=rd;k.Sprite=Ac;k.LOD=Bc;k.SkinnedMesh=td;k.Skeleton=Cc;k.Bone=sd;k.Mesh=oa;k.LineSegments=aa;k.LineLoop=ud;k.Line=ua;k.Points=Qb;k.Group=vd;k.VideoTexture=Yd;k.DataTexture=ib;k.CompressedTexture=Rb;k.CubeTexture=ab;k.CanvasTexture=zc;k.DepthTexture=Dc;k.Texture=Y;k.CompressedTextureLoader=df;k.DataTextureLoader=be;k.CubeTextureLoader=ce;k.TextureLoader=xd;k.ObjectLoader=ff;k.MaterialLoader=Md;k.BufferGeometryLoader=ee;k.DefaultLoadingManager=ma;k.LoadingManager=ae;k.JSONLoader=fe;k.ImageLoader=
Yc;k.ImageBitmapLoader=ge;k.FontLoader=gf;k.FileLoader=Ka;k.Loader=ic;k.LoaderUtils=Be;k.Cache=Hb;k.AudioLoader=je;k.SpotLightShadow=zd;k.SpotLight=Ad;k.PointLight=Bd;k.RectAreaLight=Fd;k.HemisphereLight=yd;k.DirectionalLightShadow=Cd;k.DirectionalLight=Dd;k.AmbientLight=Ed;k.LightShadow=Eb;k.Light=ca;k.StereoCamera=hf;k.PerspectiveCamera=la;k.OrthographicCamera=Jb;k.CubeCamera=cd;k.ArrayCamera=qd;k.Camera=Qa;k.AudioListener=ke;k.PositionalAudio=me;k.AudioContext=le;k.AudioAnalyser=ne;k.Audio=jc;
k.VectorKeyframeTrack=hc;k.StringKeyframeTrack=Gd;k.QuaternionKeyframeTrack=ad;k.NumberKeyframeTrack=gc;k.ColorKeyframeTrack=Jd;k.BooleanKeyframeTrack=Hd;k.PropertyMixer=oe;k.PropertyBinding=qa;k.KeyframeTrack=da;k.AnimationUtils=fa;k.AnimationObjectGroup=kf;k.AnimationMixer=pe;k.AnimationClip=Ba;k.Uniform=Nd;k.InstancedBufferGeometry=qe;k.BufferGeometry=F;k.Geometry=N;k.InterleavedBufferAttribute=re;k.InstancedInterleavedBuffer=se;k.InterleavedBuffer=kc;k.InstancedBufferAttribute=te;k.Face3=Wa;k.Object3D=
A;k.Raycaster=mf;k.Layers=Sd;k.EventDispatcher=xa;k.Clock=of;k.QuaternionLinearInterpolant=Id;k.LinearInterpolant=bd;k.DiscreteInterpolant=Ld;k.CubicInterpolant=Kd;k.Interpolant=na;k.Triangle=Aa;k.Math=S;k.Spherical=pf;k.Cylindrical=qf;k.Plane=Fa;k.Frustum=ld;k.Sphere=Ea;k.Ray=qb;k.Matrix4=M;k.Matrix3=sa;k.Box3=Va;k.Box2=ve;k.Line3=Lb;k.Euler=jb;k.Vector4=ea;k.Vector3=p;k.Vector2=C;k.Quaternion=ja;k.Color=I;k.ImmediateRenderObject=dd;k.VertexNormalsHelper=ed;k.SpotLightHelper=lc;k.SkeletonHelper=
mc;k.PointLightHelper=nc;k.RectAreaLightHelper=oc;k.HemisphereLightHelper=pc;k.GridHelper=fd;k.PolarGridHelper=Od;k.FaceNormalsHelper=gd;k.DirectionalLightHelper=qc;k.CameraHelper=hd;k.BoxHelper=Fb;k.Box3Helper=id;k.PlaneHelper=jd;k.ArrowHelper=Gb;k.AxesHelper=kd;k.Shape=gb;k.Path=Pa;k.ShapePath=he;k.Font=ie;k.CurvePath=Za;k.Curve=E;k.ShapeUtils=Xa;k.WebGLUtils=Ve;k.WireframeGeometry=Sb;k.ParametricGeometry=Ec;k.ParametricBufferGeometry=Tb;k.TetrahedronGeometry=Gc;k.TetrahedronBufferGeometry=Ub;k.OctahedronGeometry=
Hc;k.OctahedronBufferGeometry=sb;k.IcosahedronGeometry=Ic;k.IcosahedronBufferGeometry=Vb;k.DodecahedronGeometry=Jc;k.DodecahedronBufferGeometry=Wb;k.PolyhedronGeometry=Fc;k.PolyhedronBufferGeometry=pa;k.TubeGeometry=Kc;k.TubeBufferGeometry=Xb;k.TorusKnotGeometry=Lc;k.TorusKnotBufferGeometry=Yb;k.TorusGeometry=Mc;k.TorusBufferGeometry=Zb;k.TextGeometry=Rc;k.TextBufferGeometry=$b;k.SphereGeometry=Sc;k.SphereBufferGeometry=ub;k.RingGeometry=Tc;k.RingBufferGeometry=ac;k.PlaneGeometry=xc;k.PlaneBufferGeometry=
pb;k.LatheGeometry=Uc;k.LatheBufferGeometry=bc;k.ShapeGeometry=vb;k.ShapeBufferGeometry=wb;k.ExtrudeGeometry=fb;k.ExtrudeBufferGeometry=Ia;k.EdgesGeometry=cc;k.ConeGeometry=Vc;k.ConeBufferGeometry=Wc;k.CylinderGeometry=xb;k.CylinderBufferGeometry=Ya;k.CircleGeometry=Xc;k.CircleBufferGeometry=dc;k.BoxGeometry=Kb;k.BoxBufferGeometry=mb;k.ShadowMaterial=yb;k.SpriteMaterial=eb;k.RawShaderMaterial=ec;k.ShaderMaterial=va;k.PointsMaterial=Ha;k.MeshPhysicalMaterial=zb;k.MeshStandardMaterial=Sa;k.MeshPhongMaterial=
Ja;k.MeshToonMaterial=Ab;k.MeshNormalMaterial=Bb;k.MeshLambertMaterial=Cb;k.MeshDepthMaterial=cb;k.MeshDistanceMaterial=db;k.MeshBasicMaterial=za;k.LineDashedMaterial=Db;k.LineBasicMaterial=U;k.Material=O;k.Float64BufferAttribute=wc;k.Float32BufferAttribute=z;k.Uint32BufferAttribute=lb;k.Int32BufferAttribute=vc;k.Uint16BufferAttribute=kb;k.Int16BufferAttribute=uc;k.Uint8ClampedBufferAttribute=tc;k.Uint8BufferAttribute=sc;k.Int8BufferAttribute=rc;k.BufferAttribute=T;k.ArcCurve=fc;k.CatmullRomCurve3=
X;k.CubicBezierCurve=La;k.CubicBezierCurve3=Ta;k.EllipseCurve=ia;k.LineCurve=wa;k.LineCurve3=Ma;k.QuadraticBezierCurve=Na;k.QuadraticBezierCurve3=Ua;k.SplineCurve=Oa;k.REVISION="91";k.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};k.CullFaceNone=0;k.CullFaceBack=1;k.CullFaceFront=2;k.CullFaceFrontBack=3;k.FrontFaceDirectionCW=0;k.FrontFaceDirectionCCW=1;k.BasicShadowMap=0;k.PCFShadowMap=1;k.PCFSoftShadowMap=2;k.FrontSide=0;k.BackSide=1;k.DoubleSide=2;k.FlatShading=1;k.SmoothShading=2;k.NoColors=0;k.FaceColors=1;
k.VertexColors=2;k.NoBlending=0;k.NormalBlending=1;k.AdditiveBlending=2;k.SubtractiveBlending=3;k.MultiplyBlending=4;k.CustomBlending=5;k.AddEquation=100;k.SubtractEquation=101;k.ReverseSubtractEquation=102;k.MinEquation=103;k.MaxEquation=104;k.ZeroFactor=200;k.OneFactor=201;k.SrcColorFactor=202;k.OneMinusSrcColorFactor=203;k.SrcAlphaFactor=204;k.OneMinusSrcAlphaFactor=205;k.DstAlphaFactor=206;k.OneMinusDstAlphaFactor=207;k.DstColorFactor=208;k.OneMinusDstColorFactor=209;k.SrcAlphaSaturateFactor=
210;k.NeverDepth=0;k.AlwaysDepth=1;k.LessDepth=2;k.LessEqualDepth=3;k.EqualDepth=4;k.GreaterEqualDepth=5;k.GreaterDepth=6;k.NotEqualDepth=7;k.MultiplyOperation=0;k.MixOperation=1;k.AddOperation=2;k.NoToneMapping=0;k.LinearToneMapping=1;k.ReinhardToneMapping=2;k.Uncharted2ToneMapping=3;k.CineonToneMapping=4;k.UVMapping=300;k.CubeReflectionMapping=301;k.CubeRefractionMapping=302;k.EquirectangularReflectionMapping=303;k.EquirectangularRefractionMapping=304;k.SphericalReflectionMapping=305;k.CubeUVReflectionMapping=
306;k.CubeUVRefractionMapping=307;k.RepeatWrapping=1E3;k.ClampToEdgeWrapping=1001;k.MirroredRepeatWrapping=1002;k.NearestFilter=1003;k.NearestMipMapNearestFilter=1004;k.NearestMipMapLinearFilter=1005;k.LinearFilter=1006;k.LinearMipMapNearestFilter=1007;k.LinearMipMapLinearFilter=1008;k.UnsignedByteType=1009;k.ByteType=1010;k.ShortType=1011;k.UnsignedShortType=1012;k.IntType=1013;k.UnsignedIntType=1014;k.FloatType=1015;k.HalfFloatType=1016;k.UnsignedShort4444Type=1017;k.UnsignedShort5551Type=1018;
k.UnsignedShort565Type=1019;k.UnsignedInt248Type=1020;k.AlphaFormat=1021;k.RGBFormat=1022;k.RGBAFormat=1023;k.LuminanceFormat=1024;k.LuminanceAlphaFormat=1025;k.RGBEFormat=1023;k.DepthFormat=1026;k.DepthStencilFormat=1027;k.RGB_S3TC_DXT1_Format=33776;k.RGBA_S3TC_DXT1_Format=33777;k.RGBA_S3TC_DXT3_Format=33778;k.RGBA_S3TC_DXT5_Format=33779;k.RGB_PVRTC_4BPPV1_Format=35840;k.RGB_PVRTC_2BPPV1_Format=35841;k.RGBA_PVRTC_4BPPV1_Format=35842;k.RGBA_PVRTC_2BPPV1_Format=35843;k.RGB_ETC1_Format=36196;k.RGBA_ASTC_4x4_Format=
37808;k.RGBA_ASTC_5x4_Format=37809;k.RGBA_ASTC_5x5_Format=37810;k.RGBA_ASTC_6x5_Format=37811;k.RGBA_ASTC_6x6_Format=37812;k.RGBA_ASTC_8x5_Format=37813;k.RGBA_ASTC_8x6_Format=37814;k.RGBA_ASTC_8x8_Format=37815;k.RGBA_ASTC_10x5_Format=37816;k.RGBA_ASTC_10x6_Format=37817;k.RGBA_ASTC_10x8_Format=37818;k.RGBA_ASTC_10x10_Format=37819;k.RGBA_ASTC_12x10_Format=37820;k.RGBA_ASTC_12x12_Format=37821;k.LoopOnce=2200;k.LoopRepeat=2201;k.LoopPingPong=2202;k.InterpolateDiscrete=2300;k.InterpolateLinear=2301;k.InterpolateSmooth=
2302;k.ZeroCurvatureEnding=2400;k.ZeroSlopeEnding=2401;k.WrapAroundEnding=2402;k.TrianglesDrawMode=0;k.TriangleStripDrawMode=1;k.TriangleFanDrawMode=2;k.LinearEncoding=3E3;k.sRGBEncoding=3001;k.GammaEncoding=3007;k.RGBEEncoding=3002;k.LogLuvEncoding=3003;k.RGBM7Encoding=3004;k.RGBM16Encoding=3005;k.RGBDEncoding=3006;k.BasicDepthPacking=3200;k.RGBADepthPacking=3201;k.CubeGeometry=Kb;k.Face4=function(a,b,c,d,e,f,g){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");
return new Wa(a,b,c,e,f,g)};k.LineStrip=0;k.LinePieces=1;k.MeshFaceMaterial=function(a){console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead.");return a};k.MultiMaterial=function(a){void 0===a&&(a=[]);console.warn("THREE.MultiMaterial has been removed. Use an Array instead.");a.isMultiMaterial=!0;a.materials=a;a.clone=function(){return a.slice()};return a};k.PointCloud=function(a,b){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new Qb(a,b)};k.Particle=
function(a){console.warn("THREE.Particle has been renamed to THREE.Sprite.");return new Ac(a)};k.ParticleSystem=function(a,b){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new Qb(a,b)};k.PointCloudMaterial=function(a){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new Ha(a)};k.ParticleBasicMaterial=function(a){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new Ha(a)};k.ParticleSystemMaterial=
function(a){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new Ha(a)};k.Vertex=function(a,b,c){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");return new p(a,b,c)};k.DynamicBufferAttribute=function(a,b){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");return(new T(a,b)).setDynamic(!0)};k.Int8Attribute=function(a,b){console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead.");
return new rc(a,b)};k.Uint8Attribute=function(a,b){console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead.");return new sc(a,b)};k.Uint8ClampedAttribute=function(a,b){console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead.");return new tc(a,b)};k.Int16Attribute=function(a,b){console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead.");return new uc(a,b)};k.Uint16Attribute=
function(a,b){console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead.");return new kb(a,b)};k.Int32Attribute=function(a,b){console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead.");return new vc(a,b)};k.Uint32Attribute=function(a,b){console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead.");return new lb(a,b)};k.Float32Attribute=function(a,b){console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead.");
return new z(a,b)};k.Float64Attribute=function(a,b){console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead.");return new wc(a,b)};k.ClosedSplineCurve3=sf;k.SplineCurve3=tf;k.Spline=xe;k.AxisHelper=function(a){console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper.");return new kd(a)};k.BoundingBoxHelper=function(a,b){console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead.");return new Fb(a,b)};k.EdgesHelper=
function(a,b){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.");return new aa(new cc(a.geometry),new U({color:void 0!==b?b:16777215}))};k.WireframeHelper=function(a,b){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.");return new aa(new Sb(a.geometry),new U({color:void 0!==b?b:16777215}))};k.XHRLoader=function(a){console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader.");return new Ka(a)};k.BinaryTextureLoader=
function(a){console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader.");return new be(a)};k.GeometryUtils={merge:function(a,b,c){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");if(b.isMesh){b.matrixAutoUpdate&&b.updateMatrix();var d=b.matrix;b=b.geometry}a.merge(b,d,c)},center:function(a){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");
return a.center()}};k.ImageUtils={crossOrigin:void 0,loadTexture:function(a,b,c,d){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var e=new xd;e.setCrossOrigin(this.crossOrigin);a=e.load(a,c,void 0,d);b&&(a.mapping=b);return a},loadTextureCube:function(a,b,c,d){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var e=new ce;e.setCrossOrigin(this.crossOrigin);a=e.load(a,c,void 0,d);b&&(a.mapping=
b);return a},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};k.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");
a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};k.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");this.clear=function(){};this.render=function(){};
this.setClearColor=function(){};this.setSize=function(){}};k.SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};k.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")};
Object.defineProperty(k,"__esModule",{value:!0})});

!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("three")):"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.altizure=t(require("three")):e.altizure=t(e.THREE)}("undefined"!=typeof self?self:this,function(__WEBPACK_EXTERNAL_MODULE_0__){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=36)}([function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_0__},function(e,t,r){var n,i,o,a;a=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r.EarthBasic.HyperClasses.CONSTANTS,i={EarthResolution:n.EarthResolution,scale:n.scale,EARTH_RADIUS:n.EARTH_RADIUS,EQUATOR:n.EQUATOR};t.default=i,e.exports=t.default},i=[e,t,r(4)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){"use strict";var n=r(22),i=r(38),o=Object.prototype.toString;function a(e){return"[object Array]"===o.call(e)}function s(e){return null!==e&&"object"==typeof e}function l(e){return"[object Function]"===o.call(e)}function u(e,t){if(null!==e&&void 0!==e)if("object"==typeof e||a(e)||(e=[e]),a(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}e.exports={isArray:a,isArrayBuffer:function(e){return"[object ArrayBuffer]"===o.call(e)},isBuffer:i,isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:s,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===o.call(e)},isFile:function(e){return"[object File]"===o.call(e)},isBlob:function(e){return"[object Blob]"===o.call(e)},isFunction:l,isStream:function(e){return s(e)&&l(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:u,merge:function e(){var t={};function r(r,n){"object"==typeof t[n]&&"object"==typeof r?t[n]=e(t[n],r):t[n]=r}for(var n=0,i=arguments.length;n<i;n++)u(arguments[n],r);return t},extend:function(e,t,r){return u(t,function(t,i){e[i]=r&&"function"==typeof t?n(t,r):t}),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t,r){var n,i,o,a;a=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r.EarthBasic.HyperClasses.EarthMath;t.default=n,e.exports=t.default},i=[e,t,r(4)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n;n=function(e,t){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=116)}([function(t,r){t.exports=e},function(e,t,r){e.exports=function(){var e=e||function(e,t){var r=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),n={},i=n.lib={},o=i.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=i.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var a=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=a<<24-(n+o)%4*8}else for(var o=0;o<i;o+=4)t[n+o>>>2]=r[o>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r,n=[],i=0;i<t;i+=4){var o=function(t){var t=t,r=987654321,n=4294967295;return function(){var i=((r=36969*(65535&r)+(r>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return i/=4294967296,(i+=.5)*(e.random()>.5?1:-1)}}(4294967296*(r||e.random()));r=987654071*o(),n.push(4294967296*o()|0)}return new a.init(n,t)}}),s=n.enc={},l=s.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(r,t/2)}},u=s.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(r,t)}},c=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},h=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,i=r.sigBytes,o=this.blockSize,s=4*o,l=i/s,u=(l=t?e.ceil(l):e.max((0|l)-this._minBufferSize,0))*o,c=e.min(4*u,i);if(u){for(var h=0;h<u;h+=o)this._doProcessBlock(n,h);var f=n.splice(0,u);r.sigBytes-=c}return new a.init(f,c)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),f=(i.Hasher=h.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new f.HMAC.init(e,r).finalize(t)}}}),n.algo={});return n}(Math);return e}()},function(e,t,r){e.exports=function(e){var t,r,n,i,o,a,s,l,u,c,h,f,d,p,m,v,g,y,_,w,b,x,k;e.lib.Cipher||(n=(r=e).lib,i=n.Base,o=n.WordArray,a=n.BufferedBlockAlgorithm,(s=r.enc).Utf8,l=s.Base64,u=r.algo,c=u.EvpKDF,h=n.Cipher=a.extend({cfg:i.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?k:w}return function(t){return{encrypt:function(r,n,i){return e(n).encrypt(t,r,n,i)},decrypt:function(r,n,i){return e(n).decrypt(t,r,n,i)}}}}()}),n.StreamCipher=h.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),f=r.mode={},d=n.BlockCipherMode=i.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),p=f.CBC=function(){function e(e,r,n){var i=this._iv;if(i){var o=i;this._iv=t}else var o=this._prevBlock;for(var a=0;a<n;a++)e[r+a]^=o[a]}var r=d.extend();return r.Encryptor=r.extend({processBlock:function(t,r){var n=this._cipher,i=n.blockSize;e.call(this,t,r,i),n.encryptBlock(t,r),this._prevBlock=t.slice(r,r+i)}}),r.Decryptor=r.extend({processBlock:function(t,r){var n=this._cipher,i=n.blockSize,o=t.slice(r,r+i);n.decryptBlock(t,r),e.call(this,t,r,i),this._prevBlock=o}}),r}(),m=r.pad={},v=m.Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,i=n<<24|n<<16|n<<8|n,a=[],s=0;s<n;s+=4)a.push(i);var l=o.create(a,n);e.concat(l)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.BlockCipher=h.extend({cfg:h.cfg.extend({mode:p,padding:v}),reset:function(){h.reset.call(this);var e=this.cfg,t=e.iv,r=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=r.createEncryptor;else{var n=r.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==n?this._mode.init(this,t&&t.words):(this._mode=n.call(r,this,t&&t.words),this._mode.__creator=n)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else{var t=this._process(!0);e.unpad(t)}return t},blockSize:4}),g=n.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),y=r.format={},_=y.OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;if(r)var n=o.create([1398893684,1701076831]).concat(r).concat(t);else var n=t;return n.toString(l)},parse:function(e){var t=l.parse(e),r=t.words;if(1398893684==r[0]&&1701076831==r[1]){var n=o.create(r.slice(2,4));r.splice(0,4),t.sigBytes-=16}return g.create({ciphertext:t,salt:n})}},w=n.SerializableCipher=i.extend({cfg:i.extend({format:_}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var i=e.createEncryptor(r,n),o=i.finalize(t),a=i.cfg;return g.create({ciphertext:o,key:r,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),b=r.kdf={},x=b.OpenSSL={execute:function(e,t,r,n){n||(n=o.random(8));var i=c.create({keySize:t+r}).compute(e,n),a=o.create(i.words.slice(t),4*r);return i.sigBytes=4*t,g.create({key:i,iv:a,salt:n})}},k=n.PasswordBasedCipher=w.extend({cfg:w.cfg.extend({kdf:x}),encrypt:function(e,t,r,n){var i=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize);n.iv=i.iv;var o=w.encrypt.call(this,e,t,i.key,n);return o.mixIn(i),o},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var i=n.kdf.execute(r,e.keySize,e.ivSize,t.salt);return n.iv=i.iv,w.decrypt.call(this,e,t,i.key,n)}}))}(r(1),r(5))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),o=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.version="1.0.0"}return n(e,null,[{key:"degreeToRadian",value:function(e){return e*(Math.PI/180)}},{key:"radianToDegree",value:function(e){return e*(180/Math.PI)}},{key:"webMercatorXToRadianLog",value:function(t){return t/e.EARTH_RADIUS}},{key:"webMercatorXToDegreeLog",value:function(t){var r=e.webMercatorXToRadianLog(t);return e.radianToDegree(r)}},{key:"webMercatorYToRadianLat",value:function(t){if(isNaN(t))throw{error:"webMercatorYToRadianLat",detail:t};var r=t/e.EARTH_RADIUS,n=Math.pow(Math.E,r);return 2*Math.atan(n)-Math.PI/2}},{key:"webMercatorYToDegreeLat",value:function(e){var t=this.webMercatorYToRadianLat(e);return this.radianToDegree(t)}},{key:"getTileWebMercatorEnvelopeByGrid",value:function(t,r,n){var i=e.EQUATOR/2,o=2*i/Math.pow(2,t),a=r*o-i,s=i-n*o;return{minX:a,minY:s-o,maxX:a+o,maxY:s}}},{key:"webMercatorToDegreeGeographic",value:function(t,r){return[e.webMercatorXToDegreeLog(t),e.webMercatorYToDegreeLat(r)]}},{key:"getTileGeographicEnvelopByGrid",value:function(t,r,n){var i=e.getTileWebMercatorEnvelopeByGrid(t,r,n),o=e.webMercatorToDegreeGeographic(i.minX,i.minY),a=e.webMercatorToDegreeGeographic(i.maxX,i.maxY);return{minLon:o[0],minLat:o[1],maxLon:a[0],maxLat:a[1]}}},{key:"geographicToCartesianCoord",value:function(t,r,n){if(!(t>=-180.001&&t<=180.001))throw console.warn(t),{error:"invalid lon",detail:"geographicToCartesianCoord"};if(!(r>=-90.001&&r<=90.001))throw console.warn(r),{error:"invalid lat",detail:"geographicToCartesianCoord"};var i=e.degreeToRadian(t),o=e.degreeToRadian(r),a=Math.sin(i),s=Math.cos(i),l=Math.sin(o),u=Math.cos(o);return{x:n*a*u,y:n*l,z:n*s*u}}},{key:"geographicToEarthSurface",value:function(t,r,n,o){var a=(new i.Vector3,e.getTileGridByGeographic(t,r,n)),s=a.column,l=a.row,u=e.getTileCartesianEnvelopByGrid(t,s,l,o),c=e.getTileGeographicEnvelopByGrid(t,s,l),h=u,f=c.maxLon-c.minLon,d=c.maxLat-c.minLat,p=r-c.minLon,m=c.maxLon-r,v=c.maxLat-n,g=n-c.minLat,y=h[2].clone().multiplyScalar(m/f).add(h[1].clone().multiplyScalar(p/f)),_=h[3].clone().multiplyScalar(m/f).add(h[0].clone().multiplyScalar(p/f));return y.multiplyScalar(g/d).add(_.multiplyScalar(v/d))}},{key:"geographicToEarthSurfaceByIntersection",value:function(t,r,n,o){var a=e.getTileGridByGeographic(t,r,n),s=a.column,l=a.row,u=e.getTileCartesianEnvelopByGrid(t,s,l,o),c=u[0].clone(),h=u[1].clone(),f=u[2].clone(),d=c.clone().sub(h),p=f.clone().sub(h).clone().cross(d).normalize(),m=-c.clone().sub(new i.Vector3(0,0,0)).dot(p),v=new i.Plane(p,m),g=e.geographicToCartesianCoord(r,n,1.1*o),y=new i.Line3(new i.Vector3(0,0,0),g),_=new i.Vector3;return v.intersectLine(y,_),_}},{key:"getGeoNormalOnEarthSurface",value:function(t,r,n){var o=e.getTileGridByGeographic(t,r,n),a=o.column,s=o.row,l=e.getTileGeographicEnvelopByGrid(t,a,s),u={lat:(l.minLat+l.maxLat)/2,lon:(l.minLon+l.maxLon)/2},c=e.geographicToCartesianCoord(u.lon,u.lat,1);return(c=new i.Vector3(c.x,c.y,c.z)).normalize(),c}},{key:"getLocalSystemOnEarthSurface",value:function(t,r,n,o){var a=e.getTileGridByGeographic(t,r,n),s=a.column,l=a.row,u=e.getTileGeographicEnvelopByGrid(t,s,l),c=(u.minLon,u.minLat,u.maxLon,u.maxLat,e.getTileCartesianEnvelopByGrid(t,s,l,o)),h=c[0].clone(),f=c[1].clone(),d=c[2].clone(),p=h.clone().sub(f),m=d.clone().sub(f).clone().cross(p).normalize(),v=-h.clone().sub(new i.Vector3(0,0,0)).dot(m),g=new i.Plane(m,v),y=e.geographicToCartesianCoord(r,n,1.1*o),_=new i.Line3(new i.Vector3(0,0,0),y),w=new i.Vector3;g.intersectLine(_,w);var b=f.clone().sub(d).normalize(),x=m.clone().cross(b).normalize();return m.clone().cross(b).normalize(),{origin:e.geographicToEarthSurface(t,r,n,o),lng:b,lat:x,alt:m}}},{key:"getTileCartesianEnvelopByGrid",value:function(t,r,n,o){var a=e.getTileGeographicEnvelopByGrid(t,r,n),s=[];s[3]=e.geographicToCartesianCoord(a.minLon,a.minLat,o),s[2]=e.geographicToCartesianCoord(a.minLon,a.maxLat,o),s[1]=e.geographicToCartesianCoord(a.maxLon,a.maxLat,o),s[0]=e.geographicToCartesianCoord(a.maxLon,a.minLat,o);for(var l=0;l<4;l++)s[l]=new i.Vector3(s[l].x,s[l].y,s[l].z);return s}},{key:"getTileCartesianEnvelopOnEarthSurface",value:function(t,r,n,o,a){var s=e.getTileGeographicEnvelopByGrid(t,r,n),l=[];l[3]=e.geographicToEarthSurface(a,s.minLon,s.minLat,o),l[2]=e.geographicToEarthSurface(a,s.minLon,s.maxLat,o),l[1]=e.geographicToEarthSurface(a,s.maxLon,s.maxLat,o),l[0]=e.geographicToEarthSurface(a,s.maxLon,s.minLat,o);for(var u=0;u<4;u++)l[u]=new i.Vector3(l[u].x,l[u].y,l[u].z);return l}},{key:"getTileCartesianGeometryOnEarthSurface",value:function(t,r,n,o,a,s){for(var l=e.getTileWebMercatorEnvelopeByGrid(t,r,n),u=[],c=[],h=[],f=[],d=(l.maxX-l.minX)/a,p=(l.maxY-l.minY)/a,m=1/a,v=[],g=[],y=[],_=[],w=0;w<=a;w++){v.push(l.minX+w*d),g.push(l.minY+w*p);var b=w*m;y.push(b),_.push(b)}for(var x=0;x<=a;x++)for(var k=0;k<=a;k++){var A=v[k],M=g[x],S=e.webMercatorToDegreeGeographic(A,M),P=e.geographicToEarthSurface(s,S[0],S[1],o);u.push(new i.Vector3(P.x,P.y,P.z)),h.push(new i.Vector2(y[k],_[x]))}for(var T=0;T<a;T++)for(var O=0;O<a;O++){var C=(a+1)*T+O,E=(a+1)*(T+1)+O,I=E+1,R=C+1,L=new i.Face3(I,E,C),j=new i.Face3(C,R,I);c.push(L,j),f.push([h[I],h[E],h[C]],[h[C],h[R],h[I]])}f.length!==c.length&&console.warn("unequal uvs and vertices");var z=new i.Geometry;return z.vertices=u,z.faces=c,z.faceVertexUvs[0]=f,z}},{key:"getTileCartesianGeometryByGrid",value:function(t,r,n,o,a){isNaN(a)&&(console.warn("segment not a number",a),a=1),(a=Math.floor(a))<=0||a>999?(console.warn("segment out of range",a,"level",t),a=1):a<1&&(a=1);for(var s=e.getTileWebMercatorEnvelopeByGrid(t,r,n),l=[],u=[],c=[],h=[],f=(s.maxX-s.minX)/a,d=(s.maxY-s.minY)/a,p=1/a,m=[],v=[],g=[],y=[],_=0;_<=a;_++){m.push(s.minX+_*f),v.push(s.minY+_*d);var w=_*p;g.push(w),y.push(w)}for(var b=0;b<=a;b++)for(var x=0;x<=a;x++){var k=m[x],A=v[b],M=e.webMercatorToDegreeGeographic(k,A),S=e.geographicToCartesianCoord(M[0],M[1],o);l.push(new i.Vector3(S.x,S.y,S.z)),c.push(new i.Vector2(g[x],y[b]))}for(var P=0;P<a;P++)for(var T=0;T<a;T++){var O=(a+1)*P+T,C=(a+1)*(P+1)+T,E=C+1,I=O+1,R=new i.Face3(E,C,O),L=new i.Face3(O,I,E);u.push(R,L),h.push([c[E],c[C],c[O]],[c[O],c[I],c[E]])}h.length!==u.length&&console.warn("unequal uvs and vertices");var j=new i.Geometry;return j.vertices=l,j.faces=u,j.faceVertexUvs[0]=h,j}},{key:"radianLogToWebMercatorX",value:function(t){if(!(!isNaN(t)&&t<=Math.PI+.001&&t>=-(Math.PI+.001)))throw{detail:"invalid radianLog"};return e.EARTH_RADIUS*t}},{key:"degreeLogToWebMercatorX",value:function(t){if(!(!isNaN(t)&&t<=180.001&&t>=-180.001))throw{detail:"invalid degreeLog"};var r=e.degreeToRadian(t);return e.radianLogToWebMercatorX(r)}},{key:"radianLatToWebMercatorY",value:function(t){if(!(t<=Math.PI/2+.001&&t>=-(Math.PI/2+.001)))throw{detail:"invalid radianLat"};var r=Math.PI/4+t/2,n=Math.tan(r),i=Math.log(n);return e.EARTH_RADIUS*i}},{key:"degreeLatToWebMercatorY",value:function(t){if(!(t<=90.001&&t>=-90.001))throw{detail:"invalid degreeLat"};var r=e.degreeToRadian(t);return e.radianLatToWebMercatorY(r)}},{key:"radianGeographicToWebMercator",value:function(t,r){return[e.radianLogToWebMercatorX(t),e.radianLatToWebMercatorY(r)]}},{key:"degreeGeographicToWebMercator",value:function(t,r){return[e.degreeLogToWebMercatorX(t),e.degreeLatToWebMercatorY(r)]}},{key:"numerationSystemTo10",value:function(e,t){return parseInt(t,e)}},{key:"numerationSystemFrom10",value:function(e,t){return t.toString(e)}},{key:"numerationSystemChange",value:function(t,r,n){var i=e.numerationSystemTo10(t,n);return e.numerationSystemFrom10(r,i)}},{key:"utmToWgs84",value:function(e,t,r){var n=r.split("_");if(2!==n.length)return{};var i=Number(n[0]),o=/[n-z]/i.test(n[1]);!1===o&&(t=1e7-t);var a=6378137,s=.081819191,l=.006739497,u=t/.9996/(a*(1-Math.pow(s,2)/4-3*Math.pow(s,4)/64-5*Math.pow(s,6)/256)),c=(1-Math.sqrt(1-s*s))/(1+Math.sqrt(1-s*s)),h=3*c/2-27*Math.pow(c,3)/32,f=21*Math.pow(c,2)/16-55*Math.pow(c,4)/32,d=151*Math.pow(c,3)/96,p=1097*Math.pow(c,4)/512,m=u+h*Math.sin(2*u)+f*Math.sin(4*u)+d*Math.sin(6*u)+p*Math.sin(8*u),v=a/Math.pow(1-Math.pow(s*Math.sin(m),2),.5),g=a*(1-s*s)/Math.pow(1-Math.pow(s*Math.sin(m),2),1.5),y=v*Math.tan(m)/g,_=5e5-e,w=_/(.9996*v),b=w*w/2,x=Math.pow(Math.tan(m),2),k=l*Math.pow(Math.cos(m),2),A=(5+3*x+10*k-4*k*k-9*l)*Math.pow(w,4)/24,M=(61+90*x+298*k+45*x*x-252*l-3*k*k)*Math.pow(w,6)/720,S=180*((_/(.9996*v)-(1+2*x+k)*Math.pow(w,3)/6+(5-2*k+28*x-3*Math.pow(k,2)+8*l+24*Math.pow(x,2))*Math.pow(w,5)/120)/Math.cos(m))/Math.PI,P=180*(m-y*(b+A+M))/Math.PI;return!1===o&&(P=-P),{latitude:P,longitude:i>0?6*i-183-S:3-S}}},{key:"sphericalToGeographic",value:function(t,r){var n=r,i=Math.PI/2-t;return[e.radianToDegree(n),e.radianToDegree(i)]}},{key:"earthSurfaceToGeographic",value:function(t,r,n){function o(e,t,r){t=t.clone(),r=r.clone().normalize(),e=e.clone(),a&&console.log("distanceTo",t,r,e);var n=t.clone().add(r.multiplyScalar(e.clone().sub(t).dot(r)));return a&&console.log("proj",n),n.distanceTo(e)}var a=!1;a&&console.log("target",r);var s=new i.Spherical;s.setFromVector3(r);var l=e.sphericalToGeographic(s.phi,s.theta),u=e.getTileGridByGeographic(t,l[0],l[1]),c=e.getTileCartesianEnvelopByGrid(t,u.column,u.row,n);a&&console.log("cart",c);var h=c[1].clone().sub(c[2]),f=c[0].clone().sub(c[3]),d=o(r,c[2],h),p=o(r,c[3],f);a&&console.log("dist",d,p);var m=d+p;d/=m,p/=m,a&&console.log("b1",d,"b2",p,"bsum",m);var v=new i.Vector3;v.lerpVectors(c[2],c[3],d);var g=new i.Vector3;g.lerpVectors(c[1],c[0],d);var y=r.distanceTo(v)/g.distanceTo(v);a&&console.log("a1",y);var _=e.getTileGeographicEnvelopByGrid(t,u.column,u.row,n);return{lng:_.minLon+(_.maxLon-_.minLon)*y,lat:_.minLat+(_.maxLat-_.minLat)*(1-d)}}},{key:"getNoneGroundCartesianFromLngLatAlt",value:function(t,r,n,o,a){new i.Vector3;var s=e.getTileGridByGeographic(t,r,n),l=s.column,u=s.row,c=e.getTileCartesianEnvelopByGrid(t,l,u,a),h=c[0].clone(),f=c[1].clone(),d=c[2].clone(),p=h.clone().sub(f),m=d.clone().sub(f).clone().cross(p).normalize(),v=e.getTileGeographicEnvelopByGrid(t,l,u),g=c,y=v.maxLon-v.minLon,_=v.maxLat-v.minLat,w=r-v.minLon,b=v.maxLon-r,x=v.maxLat-n,k=n-v.minLat,A=g[2].clone().multiplyScalar(b/y).add(g[1].clone().multiplyScalar(w/y)),M=g[3].clone().multiplyScalar(b/y).add(g[0].clone().multiplyScalar(w/y));return A.multiplyScalar(k/_).add(M.multiplyScalar(x/_)).clone().add(m.multiplyScalar(o*a/e.EARTH_RADIUS))}},{key:"getLngLatAltFromNoneGroundCartesian",value:function(t,r,n){var i=e.projectCartesianOntoEarthSurface(t,r.clone(),n),o=e.earthSurfaceToGeographic(t,i.clone(),n),a=r.clone().sub(i).length()*(r.length()>i.length()?1:-1)/n*e.EARTH_RADIUS;return{lng:o.lng,lat:o.lat,alt:a}}},{key:"projectCartesianOntoEarthSurface",value:function(t,r,n){var o=new i.Spherical;o.setFromVector3(r);var a=e.sphericalToGeographic(o.phi,o.theta),s=e.getTileGridByGeographic(t,a[0],a[1]),l=e.getTileCartesianEnvelopByGrid(t,s.column,s.row,n),u=l[0].clone(),c=l[1].clone(),h=l[2].clone(),f=u.clone().sub(c),d=h.clone().sub(c).clone().cross(f).normalize();return u.clone().sub(r).projectOnVector(d).add(r)}},{key:"getTileGridByGeographic",value:function(t,r,n){var i=e.degreeGeographicToWebMercator(r,n),o=e.EQUATOR/Math.pow(2,t),a=e.EQUATOR/2;return{column:Math.floor((i[0]+a)/o),row:Math.floor((a-i[1])/o)}}},{key:"EQUATOR",get:function(){return 40075016.686}},{key:"EARTH_RADIUS",get:function(){return 6378137}}]),e}();t.default=o},function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){var t,r,n,i,o,a;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(a=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)o=e[t],a.set(o,i),i+=o.length;return a}},o={arraySet:function(e,t,r,n,i){for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,i)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(n)},function(e,t,r){e.exports=function(e){return r=(t=e).lib,n=r.Base,i=r.WordArray,o=t.algo,a=o.MD5,s=o.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:a,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,n=r.hasher.create(),o=i.create(),a=o.words,s=r.keySize,l=r.iterations;a.length<s;){u&&n.update(u);var u=n.update(e).finalize(t);n.reset();for(var c=1;c<l;c++)u=n.finalize(u),n.reset();o.concat(u)}return o.sigBytes=4*s,o}}),t.EvpKDF=function(e,t,r){return s.create(r).compute(e,t)},e.EvpKDF;var t,r,n,i,o,a,s}(r(1),r(32),r(31))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){this.controls=e,this.priority=0,this.interruptible=!0,this.easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}}},this.adjustPlane=function(t,r){var n=e.groundPlane;if(null!=e.plane){var i=e.picker.pickPoint(t,r);null!=i&&(null==n&&(n=e.plane.clone()),e.plane.setFromNormalAndCoplanarPoint(e.plane.normal,i))}},this.adjustCenter=function(){var t=e.groundPlane,r=e.domElement.width||e.domElement.clientWidth,n=e.domElement.height||e.domElement.clientHeight,i=e.picker.pickPoint(r/2,n/2);if(null!=i){var o=e.object.position,a=o.clone().sub(e.center),s=o.clone().sub(i),l=Math.atan2(a.x,a.z),u=Math.atan2(s.x,s.z);Math.abs(l-u)<.001&&(null==t&&(t=e.plane.clone()),e.center=i)}}};n.prototype.onMouseDown=function(e,t){},n.prototype.onMouseMove=function(e,t){},n.prototype.onMouseUp=function(){},n.prototype.transformStart=function(e,t){},n.prototype.transform=function(e,t){},n.prototype.transformEnd=function(e,t){},n.prototype.update=function(e,t){},n.prototype.onLimit=function(e){},n.prototype.detach=function(){var e=this.controls;this.type===e.handler.type&&(e.handler=null,e.changed())},n.prototype.constructor=n,t.default=n},function(e,t,r){e.exports=function(e){return function(){function t(e,t,r){for(var n=[],o=0,a=0;a<t;a++)if(a%4){var s=r[e.charCodeAt(a-1)]<<a%4*2,l=r[e.charCodeAt(a)]>>>6-a%4*2;n[o>>>2]|=(s|l)<<24-o%4*8,o++}return i.create(n,o)}var r=e,n=r.lib,i=n.WordArray,o=r.enc;o.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],o=0;o<r;o+=3)for(var a=t[o>>>2]>>>24-o%4*8&255,s=t[o+1>>>2]>>>24-(o+1)%4*8&255,l=t[o+2>>>2]>>>24-(o+2)%4*8&255,u=a<<16|s<<8|l,c=0;c<4&&o+.75*c<r;c++)i.push(n.charAt(u>>>6*(3-c)&63));var h=n.charAt(64);if(h)for(;i.length%4;)i.push(h);return i.join("")},parse:function(e){var r=e.length,n=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var o=0;o<n.length;o++)i[n.charCodeAt(o)]=o}var a=n.charAt(64);if(a){var s=e.indexOf(a);-1!==s&&(r=s)}return t(e,r,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64}(r(1))},function(e,t,r){e.exports=function(e){return function(t){function r(e,t,r,n,i,o,a){var s=e+(t&r|~t&n)+i+a;return(s<<o|s>>>32-o)+t}function n(e,t,r,n,i,o,a){var s=e+(t&n|r&~n)+i+a;return(s<<o|s>>>32-o)+t}function i(e,t,r,n,i,o,a){var s=e+(t^r^n)+i+a;return(s<<o|s>>>32-o)+t}function o(e,t,r,n,i,o,a){var s=e+(r^(t|~n))+i+a;return(s<<o|s>>>32-o)+t}var a=e,s=a.lib,l=s.WordArray,u=s.Hasher,c=a.algo,h=[];!function(){for(var e=0;e<64;e++)h[e]=4294967296*t.abs(t.sin(e+1))|0}();var f=c.MD5=u.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var a=0;a<16;a++){var s=t+a,l=e[s];e[s]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}var u=this._hash.words,c=e[t+0],f=e[t+1],d=e[t+2],p=e[t+3],m=e[t+4],v=e[t+5],g=e[t+6],y=e[t+7],_=e[t+8],w=e[t+9],b=e[t+10],x=e[t+11],k=e[t+12],A=e[t+13],M=e[t+14],S=e[t+15],P=u[0],T=u[1],O=u[2],C=u[3];P=r(P,T,O,C,c,7,h[0]),C=r(C,P,T,O,f,12,h[1]),O=r(O,C,P,T,d,17,h[2]),T=r(T,O,C,P,p,22,h[3]),P=r(P,T,O,C,m,7,h[4]),C=r(C,P,T,O,v,12,h[5]),O=r(O,C,P,T,g,17,h[6]),T=r(T,O,C,P,y,22,h[7]),P=r(P,T,O,C,_,7,h[8]),C=r(C,P,T,O,w,12,h[9]),O=r(O,C,P,T,b,17,h[10]),T=r(T,O,C,P,x,22,h[11]),P=r(P,T,O,C,k,7,h[12]),C=r(C,P,T,O,A,12,h[13]),O=r(O,C,P,T,M,17,h[14]),T=r(T,O,C,P,S,22,h[15]),P=n(P,T,O,C,f,5,h[16]),C=n(C,P,T,O,g,9,h[17]),O=n(O,C,P,T,x,14,h[18]),T=n(T,O,C,P,c,20,h[19]),P=n(P,T,O,C,v,5,h[20]),C=n(C,P,T,O,b,9,h[21]),O=n(O,C,P,T,S,14,h[22]),T=n(T,O,C,P,m,20,h[23]),P=n(P,T,O,C,w,5,h[24]),C=n(C,P,T,O,M,9,h[25]),O=n(O,C,P,T,p,14,h[26]),T=n(T,O,C,P,_,20,h[27]),P=n(P,T,O,C,A,5,h[28]),C=n(C,P,T,O,d,9,h[29]),O=n(O,C,P,T,y,14,h[30]),T=n(T,O,C,P,k,20,h[31]),P=i(P,T,O,C,v,4,h[32]),C=i(C,P,T,O,_,11,h[33]),O=i(O,C,P,T,x,16,h[34]),T=i(T,O,C,P,M,23,h[35]),P=i(P,T,O,C,f,4,h[36]),C=i(C,P,T,O,m,11,h[37]),O=i(O,C,P,T,y,16,h[38]),T=i(T,O,C,P,b,23,h[39]),P=i(P,T,O,C,A,4,h[40]),C=i(C,P,T,O,c,11,h[41]),O=i(O,C,P,T,p,16,h[42]),T=i(T,O,C,P,g,23,h[43]),P=i(P,T,O,C,w,4,h[44]),C=i(C,P,T,O,k,11,h[45]),O=i(O,C,P,T,S,16,h[46]),T=i(T,O,C,P,d,23,h[47]),P=o(P,T,O,C,c,6,h[48]),C=o(C,P,T,O,y,10,h[49]),O=o(O,C,P,T,M,15,h[50]),T=o(T,O,C,P,v,21,h[51]),P=o(P,T,O,C,k,6,h[52]),C=o(C,P,T,O,p,10,h[53]),O=o(O,C,P,T,b,15,h[54]),T=o(T,O,C,P,f,21,h[55]),P=o(P,T,O,C,_,6,h[56]),C=o(C,P,T,O,S,10,h[57]),O=o(O,C,P,T,g,15,h[58]),T=o(T,O,C,P,A,21,h[59]),P=o(P,T,O,C,m,6,h[60]),C=o(C,P,T,O,x,10,h[61]),O=o(O,C,P,T,d,15,h[62]),T=o(T,O,C,P,w,21,h[63]),u[0]=u[0]+P|0,u[1]=u[1]+T|0,u[2]=u[2]+O|0,u[3]=u[3]+C|0},_doFinalize:function(){var e=this._data,r=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;r[i>>>5]|=128<<24-i%32;var o=t.floor(n/4294967296),a=n;r[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),r[14+(i+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),e.sigBytes=4*(r.length+1),this._process();for(var s=this._hash,l=s.words,u=0;u<4;u++){var c=l[u];l[u]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return s},clone:function(){var e=u.clone.call(this);return e._hash=this._hash.clone(),e}});a.MD5=u._createHelper(f),a.HmacMD5=u._createHmacHelper(f)}(Math),e.MD5}(r(1))},function(e,r){e.exports=t},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),o=function(e){return e&&e.__esModule?e:{default:e}}(r(11)),a=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._parent=t,this._node=new i.Object3D,this._node.matrixAutoUpdate=!1,this._children=[],null!==this._parent&&this._parent.addChild(this),this._matrix=new o.default,this._matrixWorld=new o.default,this.matrixWorldNeedsUpdate=!1,this._property={type:"HyperNode"}}return n(e,[{key:"destruct",value:function(){this._property.type="destructed";var e=!0;if(this.children&&this.children.length>0)for(var t=this.children.length-1;t>=0;t--)e=e&&this.children[t].destruct();return this._children=[],this.parent&&(e=e&&this.parent.removeChild(this)),this._parent=null,e}},{key:"addChild",value:function(e){return(Array.prototype.indexOf?function(e,t){return-1!==e.indexOf(t)}:function(e,t){for(var r=-1,n=e.length;++r<n;)if(e[r]===t)return!0;return!1})(this._children,e)?(console.warn("Trying to add an exisitng child."),!1):(this._children.push(e),this._node.add(e.sceneNode),!0)}},{key:"removeChild",value:function(e){var t=(Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1})(this._children,e);return-1===t?(console.warn("Trying to remove an un-exisitng child."),!1):(this._children.splice(t,1),this._node.remove(e.sceneNode),!0)}},{key:"applyToChildren",value:function(e,t,r,n){for(var i=!0,o=0;o<this._children.length;o++)i=e(this._children[o],t,r,n)&&i;return i}},{key:"traverse",value:function(e,t,r,n){var i=!0;i=i&&t(e,r,n);for(var o=0;o<e._children.length;o++)i=i&&this.traverse(e._children[o],t,r,n);return i}},{key:"setMatrix",value:function(e,t){this._matrix.copy(e),this.matrixWorldNeedsUpdate=!0,this.updateMatrixWorld(!1,t)}},{key:"updateMatrixWorld",value:function(e,t){!0!==this.matrixWorldNeedsUpdate&&!0!==e||(null===this.parent?this._matrixWorld.copy(this._matrix):this._matrixWorld.multiplyMatrices(this.parent.matrixWorld,this._matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var r=this.children,n=0,i=r.length;n<i;n++)r[n].updateMatrixWorld(e,t)}},{key:"sceneUpdated",value:function(e){this.applyToChildren(function(e,t){e.sceneUpdated(t)},e)}},{key:"updateVisibility",value:function(e){this.applyToChildren(function(e,t){e.updateVisibility(t)},e)}},{key:"animate",value:function(e){this.applyToChildren(function(e,t){e.animate(t)},e)}},{key:"initInfo",value:function(){console.warn("HyperNode.initInfo is not implemented")}},{key:"sceneNode",get:function(){return this._node}},{key:"children",get:function(){return this._children}},{key:"parent",get:function(){return this._parent}},{key:"matrix",get:function(){return this._matrix}},{key:"matrixWorld",get:function(){return this._matrixWorld}},{key:"type",get:function(){return this._property.type}},{key:"property",get:function(){return JSON.parse(JSON.stringify(this._property))},set:function(e){this._property=JSON.parse(JSON.stringify(e))}},{key:"JSON",get:function(){for(var e=[],t=0;t<this.children.length;t++)e.push(this.children[t].JSON);return{property:this.property,children:e}}}]),e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),o=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}return n(e,[{key:"setValue",value:function(e,t,r,n,i,o,a,s,l,u,c,h,f,d,p,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=r,v[12]=n,v[1]=i,v[5]=o,v[9]=a,v[13]=s,v[2]=l,v[6]=u,v[10]=c,v[14]=h,v[3]=f,v[7]=d,v[11]=p,v[15]=m,this}},{key:"fromArray",value:function(e,t){void 0===t&&(t=0);for(var r=0;r<16;r++)this.elements[r]=e[r+t];return this}},{key:"copy",value:function(e){var t=e.elements;return this.setValue(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"toThreeMatrix4",value:function(){var e=new i.Matrix4;return e.fromArray(this.elements),e}},{key:"identity",value:function(){return this.setValue(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var r=e.elements,n=t.elements,i=this.elements,o=r[0],a=r[4],s=r[8],l=r[12],u=r[1],c=r[5],h=r[9],f=r[13],d=r[2],p=r[6],m=r[10],v=r[14],g=r[3],y=r[7],_=r[11],w=r[15],b=n[0],x=n[4],k=n[8],A=n[12],M=n[1],S=n[5],P=n[9],T=n[13],O=n[2],C=n[6],E=n[10],I=n[14],R=n[3],L=n[7],j=n[11],z=n[15];return i[0]=o*b+a*M+s*O+l*R,i[4]=o*x+a*S+s*C+l*L,i[8]=o*k+a*P+s*E+l*j,i[12]=o*A+a*T+s*I+l*z,i[1]=u*b+c*M+h*O+f*R,i[5]=u*x+c*S+h*C+f*L,i[9]=u*k+c*P+h*E+f*j,i[13]=u*A+c*T+h*I+f*z,i[2]=d*b+p*M+m*O+v*R,i[6]=d*x+p*S+m*C+v*L,i[10]=d*k+p*P+m*E+v*j,i[14]=d*A+p*T+m*I+v*z,i[3]=g*b+y*M+_*O+w*R,i[7]=g*x+y*S+_*C+w*L,i[11]=g*k+y*P+_*E+w*j,i[15]=g*A+y*T+_*I+w*z,this}},{key:"decompose",value:function(e,t,r){var n,o;void 0===n&&(n=new i.Vector3,o=new i.Matrix4);var a=this.elements,s=n.set(a[0],a[1],a[2]).length(),l=n.set(a[4],a[5],a[6]).length(),u=n.set(a[8],a[9],a[10]).length();this.determinant()<0&&(s=-s),e.x=a[12],e.y=a[13],e.z=a[14],o.elements.set(this.elements);var c=1/s,h=1/l,f=1/u;return o.elements[0]*=c,o.elements[1]*=c,o.elements[2]*=c,o.elements[4]*=h,o.elements[5]*=h,o.elements[6]*=h,o.elements[8]*=f,o.elements[9]*=f,o.elements[10]*=f,t.setFromRotationMatrix(o),r.x=s,r.y=l,r.z=u,this}},{key:"lookAt",value:function(e,t,r){var n,o,a;void 0===n&&(n=new i.Vector3,o=new i.Vector3,a=new i.Vector3);var s=this.elements;return a.subVectors(e,t).normalize(),0===a.lengthSq()&&(a.z=1),n.crossVectors(r,a).normalize(),0===n.lengthSq()&&(a.z+=1e-4,n.crossVectors(r,a).normalize()),o.crossVectors(a,n),s[0]=n.x,s[4]=o.x,s[8]=a.x,s[1]=n.y,s[5]=o.y,s[9]=a.y,s[2]=n.z,s[6]=o.z,s[10]=a.z,this}},{key:"getInverse",value:function(e,t){var r=this.elements,n=e.elements,i=n[0],o=n[1],a=n[2],s=n[3],l=n[4],u=n[5],c=n[6],h=n[7],f=n[8],d=n[9],p=n[10],m=n[11],v=n[12],g=n[13],y=n[14],_=n[15],w=d*y*h-g*p*h+g*c*m-u*y*m-d*c*_+u*p*_,b=v*p*h-f*y*h-v*c*m+l*y*m+f*c*_-l*p*_,x=f*g*h-v*d*h+v*u*m-l*g*m-f*u*_+l*d*_,k=v*d*c-f*g*c-v*u*p+l*g*p+f*u*y-l*d*y,A=i*w+o*b+a*x+s*k;if(0===A){var M="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(!0===t)throw new Error(M);return console.warn(M),this.identity()}var S=1/A;return r[0]=w*S,r[1]=(g*p*s-d*y*s-g*a*m+o*y*m+d*a*_-o*p*_)*S,r[2]=(u*y*s-g*c*s+g*a*h-o*y*h-u*a*_+o*c*_)*S,r[3]=(d*c*s-u*p*s-d*a*h+o*p*h+u*a*m-o*c*m)*S,r[4]=b*S,r[5]=(f*y*s-v*p*s+v*a*m-i*y*m-f*a*_+i*p*_)*S,r[6]=(v*c*s-l*y*s-v*a*h+i*y*h+l*a*_-i*c*_)*S,r[7]=(l*p*s-f*c*s+f*a*h-i*p*h-l*a*m+i*c*m)*S,r[8]=x*S,r[9]=(v*d*s-f*g*s-v*o*m+i*g*m+f*o*_-i*d*_)*S,r[10]=(l*g*s-v*u*s+v*o*h-i*g*h-l*o*_+i*u*_)*S,r[11]=(f*u*s-l*d*s-f*o*h+i*d*h+l*o*m-i*u*m)*S,r[12]=k*S,r[13]=(f*g*a-v*d*a+v*o*p-i*g*p-f*o*y+i*d*y)*S,r[14]=(v*u*a-l*g*a-v*o*c+i*g*c+l*o*y-i*u*y)*S,r[15]=(l*d*a-f*u*a+f*o*c-i*d*c-l*o*p+i*u*p)*S,this}},{key:"compose",value:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this}},{key:"makeRotationFromQuaternion",value:function(e){var t=this.elements,r=e.x,n=e.y,i=e.z,o=e.w,a=r+r,s=n+n,l=i+i,u=r*a,c=r*s,h=r*l,f=n*s,d=n*l,p=i*l,m=o*a,v=o*s,g=o*l;return t[0]=1-(f+p),t[4]=c-g,t[8]=h+v,t[1]=c+g,t[5]=1-(u+p),t[9]=d-m,t[2]=h-v,t[6]=d+m,t[10]=1-(u+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"scale",value:function(e){var t=this.elements,r=e.x,n=e.y,i=e.z;return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,this}},{key:"setPosition",value:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],o=e[1],a=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],f=e[14];return e[3]*(+i*s*c-n*l*c-i*a*h+r*l*h+n*a*f-r*s*f)+e[7]*(+t*s*f-t*l*h+i*o*h-n*o*f+n*l*u-i*s*u)+e[11]*(+t*l*c-t*a*f-i*o*c+r*o*f+i*a*u-r*l*u)+e[15]*(-n*a*u-t*s*c+t*a*h+n*o*c-r*o*h+r*s*u)}},{key:"makeBasis",value:function(e,t,r){return this.setValue(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,r){return this.setValue(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}},{key:"makeTranslation",value:function(e,t,r){return this.setValue(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}}]),e}();t.default=o},function(e,t,r){e.exports=function(e){return e}(r(1),r(15),r(129),r(127),r(7),r(8),r(32),r(56),r(145),r(57),r(147),r(146),r(144),r(31),r(140),r(5),r(2),r(130),r(132),r(131),r(134),r(133),r(135),r(136),r(137),r(139),r(138),r(128),r(126),r(148),r(143),r(142),r(141))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={timedPromise:function(e,t){var r=new Promise(function(e,r){var n=setTimeout(function(){clearTimeout(n),r("Timed out in "+t+"ms.")},t)});return Promise.race([e,r])},throttle:function(e,t){var r=void 0,n=void 0,i=void 0;return function(){var o=this,a=arguments;r?(clearTimeout(n),n=setTimeout(function(){Date.now()-i>=t&&(e.apply(o,a),i=Date.now())},t-(Date.now()-i))):(e.apply(o,a),i=Date.now(),r=!0)}},debounce:function(e,t){var r=void 0;return function(){var n=this,i=arguments;clearTimeout(r),r=setTimeout(function(){return e.apply(n,i)},t)}}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0),s=n(r(51)),l=n(r(3)),u=n(r(93)),c=n(r(50)),h=n(r(11)),f=r(26),d=function(e){function t(e,r,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,n,i,o)),u=s.options.earthRadius;s.envelop={geo:null,cartesian:null,fullCartesian:null};var c=t.EarthResolution,f=Math.pow(2,c),d=Math.pow(2,s.level);d>f?(s.geometry=l.default.getTileCartesianGeometryOnEarthSurface(s.level,s.x,s.y,u,1,c),s.envelop.cartesian=l.default.getTileCartesianEnvelopOnEarthSurface(s.level,s.x,s.y,u,c)):(s.geometry=l.default.getTileCartesianGeometryByGrid(s.level,s.x,s.y,u,f/d),s.envelop.cartesian=l.default.getTileCartesianEnvelopByGrid(s.level,s.x,s.y,u)),s.envelop.geo=l.default.getTileGeographicEnvelopByGrid(s.level,s.x,s.y),s.bbox=(new a.Box3).setFromPoints(s.geometry.vertices),s.boxMesh=o.display_lod?s._bBoxMesh():null;var p={lon:(s.envelop.geo.minLon+s.envelop.geo.maxLon)/2,lat:(s.envelop.geo.minLat+s.envelop.geo.maxLat)/2};s.center={geo:p,cartesian:l.default.geographicToEarthSurface(c,p.lon,p.lat,u)};for(var m=s.geometry.vertices.length,v=Math.sqrt(m),g=[],y=[],_=0;_<v-1;_++)g[_]=s.geometry.vertices[_],y[_]=s.geometry.vertices[m-1-_];for(var w=[],b=[],x=0;x<v-1;x++)w[x]=s.geometry.vertices[m-v-x*v],b[x]=s.geometry.vertices[x*v+v-1];return s.envelop.fullCartesian=g.concat(b,y,w),s.matrix=new h.default,function(){this.geometry.computeBoundingSphere();var e=this.geometry.boundingSphere.center.clone(),t=this.geometry.boundingSphere.radius,r=0===t?1:t;this.matrix.setValue(r,0,0,e.x,0,r,0,e.y,0,0,r,e.z,0,0,0,1)}.bind(s)(),s.meshHolder=new a.Object3D,s.meshHolder.name="meshHolder",s.meshHolder.matrixAutoUpdate=!1,s.meshHolder.matrix.copy(s.matrix.clone().premultiply(s.earthToWorldMatrix)),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,null,[{key:"EarthResolution",get:function(){return 6}},{key:"Materials",get:function(){var e=new a.MeshPhongMaterial({color:0,flatShading:!0,vertexColors:a.VertexColors,shininess:0}),t=function(e){var t=new a.DataTexture(Uint8Array.from([0,10,40,255]),1,1,a.RGBAFormat,a.UnsignedByteType,a.UVMapping);return t.needsUpdate=!0,t}(),r=new f.GroundSelfShaderMaterial;return r.setTexture(t),{gridPatch:e,gridBoundary:new a.LineBasicMaterial({color:6674686,linewidth:3}),atmosphereGround:r}}}]),o(t,[{key:"dispose",value:function(){var e=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",this).call(this);return this.isInScene()&&this._removeFromSceneGraph(),this.mesh&&this.meshHolder.remove(this.mesh),this.meshHolder=void 0,this.geometry.dispose(),this.envelop.cartesian=void 0,this.envelop.geo=void 0,this.envelop.fullCartesian=void 0,this.envelop=void 0,this.bbox=void 0,this.center.cartesian=void 0,this.center.geo=void 0,this.center=void 0,e}},{key:"updateMatrix",value:function(){return this.meshHolder.matrix.multiplyMatrices(this.earthToWorldMatrix,this.matrix),!0}},{key:"mark",value:function(){this.boxMesh&&(this.boxMesh.visible=!0)}},{key:"unmark",value:function(){this.boxMesh&&(this.boxMesh.visible=!1)}},{key:"onLoaded",value:function(e){var r=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onLoaded",this).call(this,e);return r&&this.meshHolder.add(this.mesh),r}},{key:"isFrontFacing",value:function(e,t){var r=!1;if(this.level<2)return!0;var n=this.envelop.cartesian,i=[],o=(new a.Matrix3).getNormalMatrix(e),s=new a.Vector3;t.getWorldDirection(s);for(var l=0;l<n.length;l++)if(i[l]=n[l].clone().normalize().applyMatrix3(o).normalize(),r=s.clone().dot(i[l])<0)return isFinite;return r}},{key:"isInFrustum",value:function(e,t,r,n){var i,o=this.debug,a=void 0!==r?r:this.bbox.clone().applyMatrix4(t);return i=e.intersectsBox(a),o&&console.log("isInFrustum",i),i}},{key:"screenArea",value:function(e,t,r,n){function i(){var e=[],r=h;e[0]=new a.Vector3(r.min.x,r.min.y,r.min.z),e[1]=new a.Vector3(r.max.x,r.min.y,r.min.z),e[2]=new a.Vector3(r.max.x,r.max.y,r.min.z),e[3]=new a.Vector3(r.min.x,r.max.y,r.min.z),e[4]=new a.Vector3(r.min.x,r.min.y,r.max.z),e[5]=new a.Vector3(r.max.x,r.min.y,r.max.z),e[6]=new a.Vector3(r.max.x,r.max.y,r.max.z),e[7]=new a.Vector3(r.min.x,r.max.y,r.max.z);for(var n={front:!1,back:!1},i=0;i<e.length;i++)if(e[i].applyMatrix4(t),e[i].z>1?n.back=!0:e[i].z<1&&(n.front=!0),n.front&&n.back)return o&&console.log("onPlane",s.info()),!0}var o=!1,s=this,l=0;o&&console.log("screenArea",this.info());var u=this.earthToWorldMatrix.toThreeMatrix4(),h=this.bbox.clone().applyMatrix4(u),f=this.isInFrustum(r,u,h,t),d=this.isFrontFacing(u,e);return f&&d?(l=this.level<3?function(){var e=0,r=[],n=h;r[0]=new a.Vector3(n.min.x,n.min.y,n.min.z),r[1]=new a.Vector3(n.max.x,n.min.y,n.min.z),r[2]=new a.Vector3(n.max.x,n.max.y,n.min.z),r[3]=new a.Vector3(n.min.x,n.max.y,n.min.z),r[4]=new a.Vector3(n.min.x,n.min.y,n.max.z),r[5]=new a.Vector3(n.max.x,n.min.y,n.max.z),r[6]=new a.Vector3(n.max.x,n.max.y,n.max.z),r[7]=new a.Vector3(n.min.x,n.max.y,n.max.z);for(var i={front:!1,back:!1},l=0;l<r.length;l++)if(r[l].applyMatrix4(t),r[l].z>1?i.back=!0:r[l].z<1&&(i.front=!0),i.front&&i.back)return o&&console.log("area max"),Number.MAX_VALUE/s.level;for(var u=[[0,1,2,3],[7,6,5,4],[3,2,6,7],[5,6,2,1],[4,5,1,0],[0,3,7,4]],f=0;f<u.length;f++)e+=function(e){if(4!==e.length)return console.error("projecting wrong number of vertices",e),0;var t=[];o&&console.log(JSON.stringify(e));for(var n=0;n<e.length;n++){var i=e[n];t[n]=r[i].clone(),t[n].z=0}o&&console.log(JSON.stringify(t));for(var a=0,s=[],l=0;l<t.length;l++)s.push({x:t[l].x,y:t[l].y});return(a=c.default.polygonIntersectArea([{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],s))<0&&(a=0),o&&console.log(a),isNaN(a)&&(console.warn("wrong area"),console.warn(JSON.stringify(t))),a}(u[f]);return e}():function(){if(i())return o&&console.log("onPlane"),Number.MAX_VALUE/s.level;for(var e=[],r=0;r<s.envelop.fullCartesian.length;r++)e[r]=s.envelop.fullCartesian[r].clone(),e[r].applyMatrix4(u).applyMatrix4(t);for(var n=0,a=[],l=0;l<e.length;l++)a.push({x:e[l].x,y:e[l].y});return o&&console.log("poly",a),n=c.default.polygonIntersectArea([{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],a),o&&console.log("area",n),n<0&&(n=0),n}(),o&&console.log("visible area",l),this.setVisibility(!0)):(this.setVisibility(!1),l=0,o&&console.log("inivisible")),l}},{key:"tileLoader",value:function(){var e,t=this;return this.useTexture?function(e){return new Promise(function(t,r){var n=new a.TextureLoader;n.crossOrigin="",n.load(e,function(e){t(e)},function(e){},function(e){console.warn("An error happened".xhr),r(e)})})}((e=t.planet,void 0===e||"earth"===e?"China"===t.options.countryName?t.level<=8?u.default.getBlueMarbleCNImageUrl(t.level,t.x,t.y):u.default.getGoogleCNImageUrl(t.level,t.x,t.y):t.level<=8?u.default.getBlueMarbleImageUrl(t.level,t.x,t.y):u.default.getGoogleImageUrl(t.level,t.x,t.y):"lunar"===e?u.default.getNasaMoonTrekImageUrl(t.level,t.x,t.y):"mars"===e?u.default.getNasaMarsTrekImageUrl(t.level,t.x,t.y):void 0)).then(function(e){return Promise.resolve(e)}).then(function(e){return Promise.resolve(t.tileTexturedGrid(e))}):Promise.resolve(t.tileGrid())}},{key:"tileTexturedGrid",value:function(e){e.anisotropy=this.options.maxAnisotropy;var t=this._normlizedGeometry();if(null===t)return null;void 0===this&&console.log("catch undefined this");var r=new f.GroundSelfShaderMaterial;r.setTexture(e);var n=new a.Mesh(t,r);return n.matrixAutoUpdate=!1,void 0===n&&console.warn("undefined mesh"),n}},{key:"tileGrid",value:function(){var e=this.geometry.clone();e.computeBoundingSphere();var r=e.boundingSphere.center.clone(),n=e.boundingSphere.radius,i=0===n?1:1/n,o=new a.Matrix4;if(o.set(i,0,0,-i*r.x,0,i,0,-i*r.y,0,0,i,-i*r.z,0,0,0,1),e.applyMatrix(o),null===e)return null;var s=t.Materials.atmosphereGround,l=new a.Mesh(e,s);return l.matrixAutoUpdate=!1,l}},{key:"_normlizedGeometry",value:function(){var e=this.geometry.clone();e.computeBoundingSphere();var t=e.boundingSphere.center.clone(),r=e.boundingSphere.radius,n=0===r?1:1/r,i=new a.Matrix4;return i.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),e.applyMatrix(i),e}},{key:"_bBoxMesh",value:function(){return new a.BoxHelper(new a.Mesh(this.geometry))}},{key:"_addToSceneGraph",value:function(e){var t=this.options.debug;void 0===this.mesh?console.warn(JSON.stringify(this.info())+", mesh undefined, cannot add to scene"):void 0===e?console.warn("sceneGraphRoot undefined"):void 0!==this.sceneGraphRoot?console.warn("Twice adding to scene attempt",this.info()):(this.setVisibility(this.visible),e.add(this.meshHolder),null!==this.boxMesh&&e.add(this.boxMesh),this.sceneGraphRoot=e,t&&console.log("add to scene",this.info()))}},{key:"_removeFromSceneGraph",value:function(){var e=this.options.debug,t=!0;return void 0!==this.sceneGraphRoot&&void 0!==this.mesh?(this.sceneGraphRoot.remove(this.meshHolder),null!==this.boxMesh&&this.sceneGraphRoot.remove(this.boxMesh),this.sceneGraphRoot=void 0,this.mesh.place_holder?this.mesh.visible=!1:this.mesh.visible=!0,e&&console.log("remove scene",this.info()),t):(console.warn("_removeFromSceneGraph fail",this),t=!1)}},{key:"setVisibility",value:function(e){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setVisibility",this).call(this,e),this.isInScene()&&void 0!==this.mesh&&!this.options.fullScene&&(this.mesh.place_holder?this.mesh.visible=!1:this.mesh.visible=e)}},{key:"earthRadius",get:function(){return this.options.earthRadius}},{key:"debug",get:function(){return this.options.debug}},{key:"useColor",get:function(){return this.options.useColor}},{key:"useTexture",get:function(){return this.options.useTexture}},{key:"planet",get:function(){return this.options.planet}},{key:"earthToWorldMatrix",get:function(){return this.options.treeMatrixWorld}}]),t}();t.default=d},function(e,t,r){e.exports=function(e){return r=(t=e).lib,n=r.Base,i=r.WordArray,(o=t.x64={}).Word=n.extend({init:function(e,t){this.high=e,this.low=t}}),o.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,r=[],n=0;n<t;n++){var o=e[n];r.push(o.high),r.push(o.low)}return i.create(r,this.sigBytes)},clone:function(){for(var e=n.clone.call(this),t=e.words=this.words.slice(0),r=t.length,i=0;i<r;i++)t[i]=t[i].clone();return e}}),e;var t,r,n,i,o}(r(1))},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0),s=n(r(35)),l=n(r(34)),u=n(r(9)),c=function(){function e(){var t=this;i(this,e),r.p="/js/";var n=r(162);this.worker=new n,this.callback=null,this.worker.onmessage=function(e){var r=t.callback;r&&r(null,e.data)},this.worker.onError=function(e){for(var t=0;t<1e4;t++)console.warn("Worker runtime error",e.message)}}return o(e,[{key:"terminate",value:function(){if(this.worker)try{this.worker.terminate(),this.callback=void 0}catch(e){return console.error("MaskLoaderThread terminate failed",e),this.callback=void 0,!1}return!0}},{key:"scheduleLoad",value:function(e){var t=this,r=this;return new Promise(function(n,i){r.callback=function(e,t){e?i(e):n(t)},t.worker.postMessage(e)})}}]),e}(),h=function(e){function t(e){i(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.HOST?{HOST:e.HOST}:void 0));return r.manager=e,r.isDebug=e.isDebug,r.allowWorker=e.allowWorker,r.worker=void 0,r.altizureApi=e.altizureApi,r.altizureApi||console.error("MaskMgrService: altizureApi not defined.",r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"destruct",value:function(){var e=!0;return this.postConfig=void 0,this.allowWorker&&this.worker&&(e=e&&this.worker.terminate(),this.worker=void 0),e}},{key:"getAll",value:function(e,t){var r=this,n={dataset:r.manager.PID,usage:r.manager.usage},i=Date.now();return r.isDebug&&console.log("service get all ...",n),"localhost"!==window.location.hostname?r.altizureApi[r.manager.usage+"Mask"]({pid:r.manager.PID}).then(function(r){var n=r.maskInfos;if(n.length>0){var i=n.map(function(e){var t=e;return{pack_mask:{width:t.width,height:t.height,data:t.data,poly_num:t.polyNum},property:{level:t.level,alpha:t.alpha,color:t.color,wave:t.wave}}});e&&e(i)}else console.warn("download all mask error"),t&&t()}).catch(function(e){t&&t()}):u.default.post(r.baseURL+"/api/mask/get_all",n,r.postConfig).then(function(n){if(r.isDebug){var o=Date.now();console.log("download time",i,"->",o," = ",(o-i)/1e3,"s")}var a=n.data;if(r.isDebug&&console.log("get res data",a),"success"===a.status){var s=a.summary.maskInfos;s.length>0?e&&e(s):(console.warn("download all mask error"),t&&t())}else t&&t()}).catch(function(e){t&&t()})}},{key:"getAllWorker",value:function(e,t){var r=this,n=this;if(n.allowWorker)try{n.worker=new c}catch(e){console.error("Cannot initiate web worker",e),n.allowWorker=!1,n.worker=null}if(this.worker){var i=this.baseURL;("/"===i.substr(0,"/".length)||""===i)&&(i=window.location.protocol+"//"+window.location.host+i);var o={dataset:this.manager.PID,usage:this.manager.usage,baseURL:i,maskSize:this.manager.maskSize,isDebug:!1,edit:this.manager.edit};return this.worker.scheduleLoad(o).then(function(i){r.worker.terminate(),r.worker=void 0,n.isDebug&&console.log("get res from worker",i),null!==i.data?e&&e(i.data):t&&t()})}return console.log("worker failed"),this.getAll(e,t)}},{key:"uploadAll",value:function(e,t,r){var n={dataset:this.manager.PID,usage:this.manager.usage,maskInfos:e,maskBox:{minX:0,minY:0,maxX:1,maxY:1}};return u.default.post(this.baseURL+"/api/mask/update_all",n,this.postConfig).then(function(e){t&&t()}).catch(function(e){console.log("upload error",e),r&&r()})}},{key:"getNormalTex",value:function(e,t){var r="http://172.18.22.83:18090/public/images/editor/assets/img/waternormals.jpg";this.manager.isDebug&&console.log("service: to download tex",r);var n=new a.TextureLoader;n.crossOrigin="",n.load(r,function(t){e&&e(t)},function(e){console.log("water normal"+e.loaded/e.total*100+"% loaded")},function(e){console.log("Loading water normal error!",e),t&&t()})}},{key:"preProcess",value:function(){var e=this.baseURL+"/api/mask/update_format";return console.log("preprocess ...",e),u.default.get(e,{},this.postConfig).then(function(e){console.log(e)}).catch(function(e){console.log(e)})}}]),t}(),f=function(){function e(t){i(this,e),this.common=l.default.getInstance(t.dataPath),this.baseURL=t.dataPath,this.manager=t,this.isDebug=!1,this.altizureApi=t.altizureApi,this.altizureApi||console.error("MaskMgrServiceLocal: altizureApi not defined."),this.useAltizureApi=t.useAltizureApi}return o(e,[{key:"destruct",value:function(){}},{key:"getAll",value:function(e,t){var r=this;if(this.useAltizureApi&&this.altizureApi)return r.altizureApi.projectMask({pid:r.manager.PID,usage:r.manager.usage}).then(function(r){var n=r.maskInfos;if(n.length>0){var i=n.map(function(e){var t=e;return{pack_mask:{width:t.width,height:t.height,data:t.data,poly_num:t.polyNum},property:{level:t.level,alpha:t.alpha,color:t.color,wave:t.wave}}});e&&e(i)}else console.warn("api download all mask error"),t&&t()}).catch(function(e){t&&t()});var n=r.baseURL+"/"+r.manager.usage+"_summary.json";r.isDebug&&console.log("to download summary ...",n),(0,u.default)({method:"get",url:n,responseType:"json"}).then(function(t){var i=t.data;r.isDebug&&console.log("local service success",n,"summary",i);var o=i.maskInfos;r.manager.maskInfos=o,r.manager.downloadSucess=!0,e&&e(o)}).catch(function(e){console.error("get mask summary json error",e),t&&t()})}},{key:"uploadAll",value:function(e,t,r){console.warn("Upload summary is not supported in desktop!")}},{key:"getNormalTex",value:function(e,t){var r=new a.TextureLoader;r.crossOrigin="",r.load("img/waternormals.jpg",function(t){e&&e(t)},function(e){console.log("water"+e.loaded/e.total*100+"% loaded")},function(e){console.log("Loading water normal error!",e),t&&t()})}}]),e}(),d=function(){function e(t){i(this,e),this.info=t.info,this.PID=t.PID,this.dataPath=t.dataPath,this.usage=t.usage,this.maskSize=t.maskSize,this.MaskType=t.MaskType,this.maxMaskNum=t.maxMaskNum,this.allowWorker=t.allowWorker,this.edit=t.edit,this.HOST=t.HOST,this.altizureApi=t.altizureApi,this.maskInfos=void 0,this.maskSettings={},this.backupMaskInfos=null,this.nameCnt=0,this.isModified=!1,this.isDebug=t.isDebug,this._initService()}return o(e,[{key:"destruct",value:function(){var e=!0;for(var t in this.service&&(e&=this.service.destruct()),this.maskSettings)e&=this.maskSettings[t].destruct();return this.backupMaskInfos&&(this.backupMaskInfos=[]),e}},{key:"_initService",value:function(){switch(window.location.protocol){case"http:":case"https:":this.service=new h(this);break;case"file:":var e=this.dataPath.indexOf(":"),t=e>0?this.dataPath.substr(0,e):this.dataPath;"http"!==t&&"https"!==t||(this.useAltizureApi=!0),this.allowWorker=!1,this.service=new f(this);break;default:console.error("Unknown browsing protocol, please report to support@altizure.com ",window.location.protocol)}}},{key:"_defaultMaskOpts",value:function(e){return"string"==typeof e&&(e=Number(e)),{usage:this.usage,maskId:e,maskSize:this.maskSize,info:this.info,PID:this.PID,dataPath:this.dataPath,manager:this,edit:this.edit,isDebug:!1}}},{key:"_backupMaskInfos",value:function(e){this.backupMaskInfos=Object.assign({},e),this.modified=!1}},{key:"_setMaskSettings",value:function(e,t,r){var n=this;n.clearAll(),n.isDebug&&console.log("init masks #",e.length);for(var i=0;i<e.length;++i)!function(i){var o=n._defaultMaskOpts(i),a=new t(o),s=e[i];r&&a.workerInitMask?(a.workerInitMask(s),n.maskSettings[i]=a):a.initMask(s,function(){n.isDebug&&console.log("set mask #poly",a.acumulate_poly_num),n.maskSettings[i]=a})}(i)}},{key:"numSettings",value:function(){return Object.keys(this.maskSettings).length}},{key:"addefaultSetting",value:function(){var e=this,t=Date.now();if(e.numSettings()===e.maxMaskNum)return console.warn("exceed max mask num"),null;for(;e.maskSettings[this.nameCnt];)e.nameCnt+=1;var r=e._defaultMaskOpts(e.nameCnt),n=this.MaskType;e.isDebug&&console.log("add default setting",this.nameCnt,r);var i=new n(r);if(i.resetMask(),e.maskSettings[this.nameCnt]=i,e.nameCnt+=1,e.isDebug){var o=Date.now();console.log("add default time",(o-t)/1e3)}return i}},{key:"_downloadSettings",value:function(e,t,r){var n=this,i=this;this.service.getAll(function(r){i.isDebug&&console.log("get all infos success",r),i._setMaskSettings(r,e),i.nameCnt=r.length,t&&t(),i.edit&&i._backupMaskInfos(r)},function(){if(i.isDebug&&console.log("get all infos error",i.usage),r&&r(),i.edit){var e=i._getMaskInfos();n._backupMaskInfos(e)}})}},{key:"workerDownloadAll",value:function(e){var t=this,r=this;this.service.getAll(function(t){r.isDebug&&console.log("get all infos success",t),r._setMaskSettings(t,e),r.nameCnt=t.length,r.edit&&r._backupMaskInfos(t)},function(){if(r.isDebug&&console.log("workerDownloadAll error",r.usage),r.edit){var e=r._getMaskInfos();t._backupMaskInfos(e)}})}},{key:"_getMaskInfos",value:function(){var e=[];for(var t in this.maskSettings){this.maskSettings[t].updateMaskInfo();var r=this.maskSettings[t].maskInfo;e.push(r)}return e}},{key:"uploadAll",value:function(){var e=this,t=e._getMaskInfos();this.service.uploadAll(t,function(){e._backupMaskInfos(t)})}},{key:"abortAll",value:function(){var e=[];for(var t in this.backupMaskInfos)e.push(this.backupMaskInfos[t]);this.isDebug&&console.log("abort all",e),e&&(this._setMaskSettings(e,this.MaskType),this.modified=!1)}},{key:"resetAll",value:function(){for(var e in this.maskSettings)this.maskSettings[e].resetMask()}},{key:"clearAll",value:function(){for(var e in this.maskSettings)this.maskSettings[e].remove&&this.maskSettings[e].remove(),this.maskSettings[e].destruct();this.maskSettings={}}},{key:"getSetting",value:function(e){return this.maskSettings[e]}}]),e}();t.default=d},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),a=n(r(120)),s=n(r(71)),l=n(r(73)),u=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.maskSize=t.maskSize,this.isDebug=t.isDebug,this.debugVisualize=!1,this.usage=t.usage,this.MaskType=t.MaskType,this.manager=t.manager,this.edit=t.edit,this.maskId=t.maskId,this.info=t.info,this.PID=t.PID,this.dataPath=t.dataPath,this.maskInfo={},this.polygons=[],this.orthoInfo=null,this.acumulate_poly_num=0,this.cut_color_style="rgb(255,0,0)",this.res_color_style="rgb(0,255,0)";var r=Date.now();if(this.edit){this.orthoCanvas=document.createElement("canvas"),this.orthoCanvas.width=this.maskSize,this.orthoCanvas.height=this.maskSize;var n=this.orthoCanvas.getContext("2d"),i=n.getImageData(0,0,this.orthoCanvas.width,this.orthoCanvas.height);n.putImageData(i,0,0),this.curMaskRGB=i.data,this.preMaskRGB=new Uint8ClampedArray(this.curMaskRGB),this.preMaskRGB.set(this.curMaskRGB)}else this.curMaskRGB=new Uint8ClampedArray(this.maskSize*this.maskSize*4);this.curMaskTexture=void 0;var o=void 0;if(this.isDebug&&(o=Date.now(),console.log("create mask time",r,"->",o," = ",(o-r)/1e3,"s"),r=Date.now()),this.downloadSucess=!1,this.updateOrthoInfo(),this.cntWhite=0,this.isDebug){var a=Date.now();console.log("init ortho time",r,"->",a," = ",(a-r)/1e3,"s")}}return i(e,[{key:"destruct",value:function(){for(var e in this.curMaskRGB=[],this.preMaskRGB=[],this.orthoCanvas=void 0,this.polygons=[],this.orthoInfo=void 0,this.dataPath=void 0,this.maskInfo&&(this.maskInfo.pack_mask&&(this.maskInfo.pack_mask.data=[],this.maskInfo.pack_mask=void 0),this.maskInfo.texData=[],this.maskInfo.rgba=[],this.maskInfo=void 0),this.curMaskTexture&&this.curMaskTexture.dispose(),this.curMaskTexture=void 0,this.orthoInfo)this.orthoInfo[e]=void 0;return this.orthoInfo=void 0,!0}},{key:"updateOrthoInfo",value:function(){var e=this.info,t=void 0,r=void 0;e.transformation?(t=e.transformation.getOnloadMatrixRef(),r=e.transformation.getTransBBox(e,!0)):(t=new o.Matrix4,r=[e.min_bound,e.max_bound]);var n=(new o.Matrix4).extractRotation(t.clone());this.isDebug&&console.log("update onload transformation",t),n=n.transpose(),this.orthoInfo={origin:e.origin.clone(),x_dir:new o.Vector3(1,0,0).applyMatrix4(n),y_dir:new o.Vector3(0,1,0).applyMatrix4(n),z_dir:new o.Vector3(0,0,1).applyMatrix4(n),min_bound:r[0],max_bound:r[1],width:r[1].x-r[0].x,height:r[1].z-r[0].z,area:(r[1].x-r[0].x)*(r[1].z-r[0].z)}}},{key:"drawBBox",value:function(e){if(null!=e){console.log("draw bbox");var t=this.info;if(this.orthoInfo){var r=(new o.Vector3).subVectors(t.max_bound,t.min_bound).length()/100;e.add(a.default.drawSphere(this.orthoInfo.min_bound,r,16711680)),e.add(a.default.drawSphere(this.orthoInfo.max_bound,r,255));var n=(new o.Vector3).addVectors(this.orthoInfo.min_bound,this.orthoInfo.max_bound).multiplyScalar(.5);e.add(a.default.drawSphere(n,2*r,16777215)),e.add(a.default.drawSphere(new o.Vector3(0,0,0),2*r,16776960)),console.log("draw bbox center",n);var i=this.orthoInfo.origin,s=this.orthoInfo.x_dir,l=this.orthoInfo.y_dir,u=this.orthoInfo.z_dir;e.add(a.default.drawLine(i,s.clone().multiplyScalar(100*r).add(i),16711680)),e.add(a.default.drawLine(i,l.clone().multiplyScalar(100*r).add(i),65280)),e.add(a.default.drawLine(i,u.clone().multiplyScalar(100*r).add(i),255)),e.add(a.default.drawBoxByPoint(this.orthoInfo.min_bound,this.orthoInfo.max_bound))}}}},{key:"_setMaskFromInfo",value:function(e,t){var r=this,n=Date.now(),i=e.pack_mask,o=s.default.unpackToImage(i);if(i.width!==r.maskSize){var a=r.maskSize/i.width,l=s.default.downsampleImage(o.rgba,i.width,i.height,a);o.rgba=[],o.rgba=l.rgba,o.cntWhite=l.cntWhite}r.cntWhite=o.cntWhite;var u=o.rgba;if(this.curMaskRGB.set(u),this.edit){this.acumulate_poly_num=i.poly_num,this.preMaskRGB.set(u),this.removePolygons();var c=r.orthoCanvas.getContext("2d"),h=c.createImageData(r.orthoCanvas.width,r.orthoCanvas.height);h.data.set(r.curMaskRGB),c.putImageData(h,0,0)}this.isDebug&&console.log("unpack + create time",(Date.now()-n)/1e3,"s"),t&&t()}},{key:"init",value:function(e,t,r){var n=this;n.isDebug&&console.log("init mask info",e),null!==e&&void 0!==e&&e.pack_mask?(n._setMaskFromInfo(e),n.downloadSucess=!0,t&&t(e),n._debugVisualizeMask()):r&&r()}},{key:"updateMaskInfo",value:function(e){if(e&&e.pack_mask)this.maskInfo.pack_mask=e.packed_mask;else{var t=this.curMaskRGB,r=this.maskSize,n=this.maskSize,i=l.default.getMaskfromImageData(t,r,n,1),o=s.default.pack_boolean(i);o.poly_num=this.acumulate_poly_num,this.maskInfo.pack_mask=o}}},{key:"reset",value:function(e,t){var r=this,n=this.maskSize,i=this.maskSize;r.acumulate_poly_num=0,void 0===t&&(t="white"),r.cntWhite="white"===t?n*i:0,new Promise(function(e){var o=Date.now();if(r.edit){var a=r.orthoCanvas.getContext("2d");a.fillStyle=t,a.fillRect(0,0,n,i);var s=a.getImageData(0,0,n,i);r.curMaskRGB.set(s.data),a.fillStyle="white",a.fillRect(0,0,n,i),s=a.getImageData(0,0,n,i),r.preMaskRGB.set(s.data)}else{var l="white"===t?255:0;r.curMaskRGB.fill(l)}if(r.isDebug){var u=Date.now();console.log("reset preapre time",o,"->",u," = ",(u-o)/1e3,"s")}e(r.curMaskRGB)}).then(function(t){if(r.debugVisualize){var o=a.default.convertFboToImage(t,n,i);a.default.showImage(o)}e&&e(t)}),r.removePolygons()}},{key:"maskToTexture",value:function(e){var t=Date.now(),r=new Uint8Array(e,1);if(this.isDebug){var n=Date.now();console.log("array copy time",(n-t)/1e3)}var i=new o.DataTexture(r,this.maskSize,this.maskSize,o.RGBAFormat,o.UnsignedByteType);if(i.needsUpdate=!0,this.isDebug){var a=Date.now();console.log("mask to tex time",(a-t)/1e3)}return i}},{key:"remove",value:function(){this.removePolygons()}},{key:"removePolygons",value:function(){this.isDebug&&console.log("remove polys",this.polygons);for(var e=this,t=0;t<e.polygons.length;++t)e.polygons[t].remove();e.polygons=[]}},{key:"drawPolygonsInMask",value:function(e){if(!0===this.edit){for(var t=this,r=this.orthoCanvas.width,n=this.orthoCanvas.height,i=this.orthoCanvas.getContext("2d"),o=0;o<e.length;++o){var a=e[o],s=a.is_reserve?this.res_color_style:this.cut_color_style;0===o&&(i.fillStyle=a.is_reserve?"black":"white",i.fillRect(0,0,r,n)),this.orthoCanvas=a.paintToCanvas(this.orthoCanvas,s)}var l=i.getImageData(0,0,r,n);t.cntWhite=0;for(var u=0;u<l.data.length;u+=4)(function(e,r,n){return 255===e[n+1]&&255===r[n+1]?(t.curMaskRGB[n]=0,t.curMaskRGB[n+1]=255,t.curMaskRGB[n+2]=0,!0):(t.curMaskRGB[n]=255,t.curMaskRGB[n+1]=0,t.curMaskRGB[n+2]=0,!1)})(l.data,t.preMaskRGB,u)&&(t.cntWhite+=1);return t._debugVisualizeMask(),this.curMaskRGB}}},{key:"applyPolygon",value:function(e,t){!0===this.edit&&(void 0===e&&(e=this.polygons),this.isDebug&&console.log("apply polygons",e),this.acumulate_poly_num+=e.length,t&&t(),this.removePolygons(),this.preMaskRGB.set(this.curMaskRGB),this.manager.uploadAll(),this._debugVisualizeMask())}},{key:"_debugVisualizeMask",value:function(){if(this.debugVisualize){console.log("draw mask");var e=this.maskSize,t=this.maskSize,r=a.default.convertFboToImage(this.curMaskRGB,e,t);a.default.showImage(r)}}},{key:"getArea",value:function(){return this.cntWhite/(this.maskSize*this.maskSize)*this.orthoInfo.area}}]),e}();t.default=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),a=n(r(17)),s=n(r(43)),l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.viewer=e.viewer,r.isShown=e.show,r.scene=r.viewer.scene,r.renderer=r.viewer.renderer,r.createDefault=e.createDefault,r.normalTex=e.normalTex,r.dynamic_water=null,r.aMeshMirror=null,r.isDebug=!1,r.water_properties={},r._setOrthoProperties(),r.default_properties=e.default_properties?e.default_properties:{level:.5*(r.water_properties.max_level+r.water_properties.min_level),alpha:.9,color:2138762,wave:.2*r.water_properties.max_wave},r.manager.default_properties=r.default_properties,r.setPropoerties(),r._initLighting(),r.card_item=null,r.card_header=null,r.isDebug&&r.drawBBox(r.viewer.scene),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"_setOrthoProperties",value:function(){this.water_properties.width=this.orthoInfo.max_bound.x-this.orthoInfo.min_bound.x,this.water_properties.height=this.orthoInfo.max_bound.z-this.orthoInfo.min_bound.z,this.water_properties.max_level=this.orthoInfo.max_bound.y,this.water_properties.min_level=this.orthoInfo.min_bound.y,this.water_properties.position=(new o.Vector3).addVectors(this.orthoInfo.min_bound,this.orthoInfo.max_bound).multiplyScalar(.5),this.water_properties.max_wave=Math.max(this.water_properties.width,this.water_properties.height)/100,this.water_properties.min_wave=0,this.water_properties.max_area=this.water_properties.width*this.water_properties.height}},{key:"setPropoerties",value:function(e){e?(this.water_properties.level=e.level,this.water_properties.color=e.color,this.water_properties.alpha=e.alpha,this.water_properties.wave=e.wave):(this.water_properties.level=this.default_properties.level,this.water_properties.color=this.default_properties.color,this.water_properties.alpha=this.default_properties.alpha,this.water_properties.wave=this.default_properties.wave)}},{key:"_initLighting",value:function(){if(this.directionalLight_water)console.log("directionalLight_water already initialized");else{this.directionalLight_water=new o.DirectionalLight(16777045,1);var e=Math.max(this.water_properties.width,this.water_properties.height);if(this.directionalLight_water.position.set(-.2*e,.5*e,.2*e),this.directionalLight_water.position.add(this.water_properties.position),this.isDebug){var t=new o.DirectionalLightHelper(this.directionalLight_water,e/10);this.viewer.scene.add(t)}}}},{key:"initMask",value:function(e,t){var r=this;r.init(e,function(){r.setPropoerties(e.property),r.createWaterTex(r.curMaskRGB),r.isDebug&&console.log("donwload water property",r.water_properties),t&&t()},function(){r.createDefault&&r.resetMask(t)})}},{key:"createWaterTex",value:function(e){var t=this.maskToTexture(e);this._createWaterMesh(this.normalTex,t)}},{key:"updateWaterTex",value:function(e){var t=this.maskToTexture(e);this.dynamic_water.setMask(t),this.aMeshMirror.material=this.dynamic_water.material,this.show()}},{key:"resetMask",value:function(e){var t=this;this.reset(function(r){t.dynamic_water?t.updateWaterTex(r):t.createWaterTex(r),e&&e(t)},"black")}},{key:"_createWaterMesh",value:function(e,t){var r=this,n=e;n.wrapS=n.wrapT=o.RepeatWrapping;var i={textureWidth:r.mask_size,textureHeight:r.mask_size,waterNormals:n,alpha:r.water_properties.alpha,sunDirection:(new o.Vector3).subVectors(r.directionalLight_water.position,r.water_properties.position).normalize(),sunColor:16777215,waterColor:r.water_properties.color,betaVersion:0,side:o.FrontSide,distortionScale:0,noiseScale:r.water_properties.wave,eye:r.viewer.camera.matrixWorld,cropMask:t,time:10};r.isDebug&&console.log("creater water properties",i),r.dynamic_water=new s.default(r.renderer,r.viewer.camera,r.scene,i),r.aMeshMirror=new o.Mesh(new o.PlaneBufferGeometry(r.water_properties.width,r.water_properties.height,10,10),r.dynamic_water.material),r.aMeshMirror.add(r.dynamic_water),r.aMeshMirror.rotation.x=.5*-Math.PI;var a=this.water_properties.position;a.setY(this.water_properties.level),r.aMeshMirror.position.copy(a),r.scene.add(r.aMeshMirror),r.aMeshMirror.visible=r.isShown,r.dynamic_water.updateMatrixWorld(),r.directionalLight_water.target=r.dynamic_water,r.render()}},{key:"setCamera",value:function(e){console.warn("WaterSetting setCamera",e),this.dynamic_water&&this.dynamic_water.setCamera(e)}},{key:"render",value:function(){var e=this;e.dynamic_water&&e.renderer&&(e.dynamic_water.material.uniforms.time.value+=.1,e.dynamic_water.material.needsUpdate=!0,e.dynamic_water.render())}},{key:"show",value:function(){null!=this.aMeshMirror&&(this.aMeshMirror.visible=!0)}},{key:"hide",value:function(){null!=this.aMeshMirror&&(this.aMeshMirror.visible=!1)}},{key:"apply",value:function(e){var t=this,r=this.polygons;this.applyPolygon(r,function(){t.updateWaterTex(t.curMaskRGB)})}},{key:"updateMaskInfo",value:function(){a.default.prototype.updateMaskInfo.call(this),this.maskInfo.property={level:this.water_properties.level,alpha:this.water_properties.alpha,color:this.water_properties.color,wave:this.water_properties.wave}}},{key:"active",value:function(){this.card_item&&(this.isDebug&&console.log("active ",this.maskId),this.card_item.addClass("water-active"))}},{key:"deactive",value:function(){this.card_item&&(this.isDebug&&console.log("deactive ",this.maskId),this.card_item.removeClass("water-active"))}},{key:"remove",value:function(){a.default.prototype.remove.call(this),this.card_item&&this.card_item.remove(),this.scene.remove(this.aMeshMirror)}},{key:"getWater",value:function(){return this.dynamic_water}},{key:"levelRange",get:function(){return this.water_properties.max_level-this.water_properties.min_level}},{key:"level",set:function(e){this.water_properties.level=e,this.aMeshMirror&&this.aMeshMirror.position.setY(this.water_properties.level)},get:function(){return this.water_properties.level}},{key:"minLevel",get:function(){return this.water_properties.min_level}},{key:"maxLevel",get:function(){return this.water_properties.max_level}},{key:"alpha",set:function(e){this.water_properties.alpha=e,this.dynamic_water&&(this.dynamic_water.material.uniforms.alpha.value=this.water_properties.alpha)},get:function(){return this.water_properties.alpha}},{key:"color",set:function(e){this.isDebug&&console.log("set color",e),this.water_properties.color=e,this.dynamic_water&&(this.dynamic_water.material.uniforms.waterColor.value=new o.Color(e))},get:function(){return this.water_properties.color}},{key:"wave",set:function(e){this.water_properties.wave=e,this.dynamic_water&&(this.dynamic_water.material.uniforms.noiseScale.value=this.water_properties.wave)}},{key:"wavePercent",set:function(e){this.water_properties.wave=e*(this.water_properties.max_wave-this.water_properties.min_wave)+this.water_properties.min_wave,this.dynamic_water&&(this.dynamic_water.material.uniforms.noiseScale.value=this.water_properties.wave),this.isDebug&&console.log("set wave ",this.water_properties.wave)},get:function(){return(this.water_properties.wave-this.water_properties.min_wave)/(this.water_properties.max_wave-this.water_properties.min_wave)}},{key:"center",get:function(){for(var e=0;e<this.polygons.length;++e);}}]),t}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r(10)),o=function(e){function t(e,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o.TreeType=r,o.TileType=n,o.name="",o.sceneNode.matrixAutoUpdate=!1,o._property.type="HyperEntity",o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),n(t,[{key:"initInfo",value:function(){return Promise.reject("initInfo not impelemented.")}},{key:"box",get:function(){return console.warn("HyperEntity.box is not impelemented"),null}}]),t}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r(10)),o=function(e){function t(e,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.EntityType=r,i.options=n,i._property.type="HyperLayer",i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),n(t,[{key:"startImport",value:function(){for(var e=this.options.dataSeeds,t=[],r=0;r<e.length;r++){var n=new(0,this.EntityType)(this,e[r]),i=this._import(n);t.push(i)}return Promise.all(t)}},{key:"_import",value:function(e){return e.startImport().then(function(){return Promise.resolve(1)}).catch(function(e){return console.error("import error:",e),Promise.resolve(0)})}},{key:"clear",value:function(){console.warn("clear is not implemented")}}]),t}();t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0},a=r(0),s=n(r(51)),l=n(r(28)),u=n(r(75)),c=function(e){function t(e,r,n,i,o,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,n,o,a));return s.name=l.default.makeTileName(n,e,r),s.size=i,s.boundingBox=s.initBBox(),s.boxMesh=a.showBBox?s._bBoxMesh():null,s.eventQueue=a.eventQueue,s.trial=0,s.maxReloads=2,s.currentDisplayMode=0,s.texture_material=null,s.orthoSelectioinMaterial=null,s.cropConfig=a.cropConfig,s.side=a.side,s.shadowMapMaterial=null,s.shadowMapConfig=a.shadowMapConfig,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),i(t,[{key:"info",value:function(){return{level:this.level,x:this.x,y:this.y}}},{key:"onError",value:function(e,t){void 0!==this.options.onError?this.options.onError(e,t):console.warn("onError not defined")}},{key:"isInFrustum",value:function(e,t){for(var r=[],n=0;n<this.boundingBox.length;n++){var i=this.boundingBox[n].clone();i.applyMatrix4(t.matrixWorld),r.push(i)}var o=new a.Box3;return o.setFromPoints(r),e.intersectsBox(o)}},{key:"screenArea",value:function(e,t,r,n){function i(e){function r(e,t,r){return e<=t?t:e>=r?r:e}if(4!==e.length)return console.error("projecting wrong number of vertices",e),0;var i=[];o&&console.log(JSON.stringify(e));for(var l={front:!1,back:!1},u=0;u<e.length;u++){var c=e[u];if(i[u]=s.boundingBox[c].clone(),i[u].applyMatrix4(n.matrixWorld),i[u].applyMatrix4(t),i[u].z>1&&(l.back=!0),i[u].z<1&&(l.front=!0),l.front&&l.back)return o&&console.log("area max"),Math.max(.1,1/s.level);i[u].x=r(i[u].x,-1,1),i[u].y=r(i[u].y,-1,1),i[u].z=0}o&&console.log(JSON.stringify(i));var h=0,f=(new a.Vector3).subVectors(i[0],i[2]),d=(new a.Vector3).subVectors(i[0],i[1]),p=(new a.Vector3).subVectors(i[0],i[3]);o&&console.log(f,d,p);var m=d.clone().cross(f),v=f.clone().cross(p);return o&&console.log(m,v),m.z*v.z<0?h=Math.max(m.z,v.z):(h+=.5*m.z,h+=.5*v.z),h<0&&(h=0),o&&console.log(h),isNaN(h)&&(console.warn("wrong area"),console.warn(s.info()),console.warn(JSON.stringify(s.boundingBox)),console.warn(JSON.stringify(i)),console.warn(JSON.stringify(e))),h}var o=!1,s=this,l=0;return this.isInFrustum(r,n)?(o&&console.log("visible"),l=i([0,1,2,3])+i([7,6,5,4])+.8*i([3,2,6,7])+.8*i([5,6,2,1])+.8*i([4,5,1,0])+.8*i([0,3,7,4]),this.setVisibility(!0)):(this.setVisibility(!1),l=0,o&&console.log("inivisible")),l}},{key:"tileLoader",value:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"tileLoader",this).call(this)}},{key:"dispose",value:function(){var e=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",this).call(this);return this.orthoSelectioinMaterial&&(this.orthoSelectioinMaterial instanceof Array?this.orthoSelectioinMaterial.forEach(function(e){e.dispose()}):this.orthoSelectioinMaterial.dispose()),this.size=void 0,this.boundingBox=void 0,e}},{key:"onLoaded",value:function(e){this.loaded&&console.warn("trying to assign mesh to a loaded tile",this,e),this.options.maxAnisotropy&&e.material&&e.material.map&&(e.material.map.anisotropy=this.options.maxAnisotropy,e.material.map.needsUpdate=!0,e.material.needsUpdate=!0),this.mesh=e,this.options.debug&&console.log("onload",JSON.stringify(this.info())),this.initOrthoSelectionMaterial(this.cropConfig.orthoInfo),this.loaded=!0,this.updateBBox()}},{key:"initBBox",value:function(){var e=this.options.info,t=e.x_dir.clone().multiplyScalar(e.min_bound.x+e.x_unit*this.x),r=e.x_dir.clone().multiplyScalar(e.min_bound.x+e.x_unit*(this.x+this.size)),n=e.y_dir.clone().multiplyScalar(e.min_bound.y+e.y_unit*this.y),i=e.y_dir.clone().multiplyScalar(e.min_bound.y+e.y_unit*(this.y+this.size)),o=e.z1,a=e.z2;if(this.parent){var s=this.parent.boundingBox[0].clone();s.sub(e.origin),o=e.z_dir.clone().multiplyScalar(s.dot(e.z_dir));var l=this.parent.boundingBox[4].clone();l.sub(e.origin),a=e.z_dir.clone().multiplyScalar(l.dot(e.z_dir))}var u=[];return u[0]=e.origin.clone().add(t).add(n).add(o),u[1]=e.origin.clone().add(r).add(n).add(o),u[2]=e.origin.clone().add(r).add(i).add(o),u[3]=e.origin.clone().add(t).add(i).add(o),u[4]=e.origin.clone().add(t).add(n).add(a),u[5]=e.origin.clone().add(r).add(n).add(a),u[6]=e.origin.clone().add(r).add(i).add(a),u[7]=e.origin.clone().add(t).add(i).add(a),u}},{key:"updateBBox",value:function(){var e=this.options.debug,t=this.options.info;if(e&&console.log("updateBBox",this.info()),void 0===this.mesh||null===this.mesh)return console.warn("updateBBox: mesh is not loaded"),this.boundingBox;this.mesh.geometry.computeBoundingBox();var r=this.mesh.geometry.boundingBox,n=r.min.x,i=r.max.x,o=r.min.y,s=r.max.y,l=r.min.z,u=r.max.z,c=[];c[0]=new a.Vector3(n,o,l),c[1]=new a.Vector3(i,o,l),c[2]=new a.Vector3(i,s,l),c[3]=new a.Vector3(n,s,l),c[4]=new a.Vector3(n,o,u),c[5]=new a.Vector3(i,o,u),c[6]=new a.Vector3(i,s,u),c[7]=new a.Vector3(n,s,u);for(var h=0;h<c.length;h++)this.mesh.updateMatrix(),c[h].applyMatrix4(this.mesh.matrix);for(var f=[],d=0;d<c.length;d++){c[d].sub(t.origin);var p=c[d].clone().dot(t.z_dir);f[d]=p}var m=Math.min.apply(null,f),v=Math.max.apply(null,f),g=t.z_dir.clone().multiplyScalar(m),y=t.z_dir.clone().multiplyScalar(v),_=this.boundingBox[0].clone();_.sub(t.origin);var w=t.z_dir.clone().multiplyScalar(_.dot(t.z_dir)),b=this.boundingBox[4].clone();b.sub(t.origin);for(var x=t.z_dir.clone().multiplyScalar(b.dot(t.z_dir)),k=0;k<4;k++)this.boundingBox[k].sub(w).add(g);for(var A=4;A<this.boundingBox.length;A++)this.boundingBox[A].sub(x).add(y);return function e(r,n,i){for(var o=0;o<r.nodes.length;o++){var a=r.nodes[o];if(!a.loaded){var s=a.boundingBox[0].clone();s.sub(t.origin);var l=t.z_dir.clone().multiplyScalar(s.dot(t.z_dir)),u=a.boundingBox[4].clone();u.sub(t.origin);for(var c=t.z_dir.clone().multiplyScalar(u.dot(t.z_dir)),h=0;h<4;h++)a.boundingBox[h].sub(l).add(n);for(var f=4;f<8;f++)a.boundingBox[f].sub(c).add(i);e(a,n,i)}}}(this,g,y),this.isInScene()&&this.boxMesh&&this.sceneGraphRoot.remove(this.boxMesh),this.boxMesh&&(this.boxMesh.geometry.dispose(),this.boxMesh.material.dispose(),this.boxMesh=this._bBoxMesh()),this.isInScene()&&this.boxMesh&&this.sceneGraphRoot.add(this.boxMesh),this.boundingBox}},{key:"_bBoxMesh",value:function(){var e=this,t=new a.BoxGeometry(1,1,1);t.vertices[0]=e.boundingBox[6].clone(),t.vertices[1]=e.boundingBox[2].clone(),t.vertices[2]=e.boundingBox[5].clone(),t.vertices[3]=e.boundingBox[1].clone(),t.vertices[4]=e.boundingBox[3].clone(),t.vertices[5]=e.boundingBox[7].clone(),t.vertices[6]=e.boundingBox[0].clone(),t.vertices[7]=e.boundingBox[4].clone();var r=new a.MeshPhongMaterial({color:function(e){var t=1e4*Math.sin(e++);return 16777215*(t-Math.floor(t))}(e.level+e.x+e.y),wireframe:!0});return new a.Mesh(t,r)}},{key:"updateDisplayMode",value:function(){function e(e,t){e instanceof Array?e.forEach(function(e){e.flatShading=t}):e.flatShading=t}if(this.isInScene()){if(this.currentDisplayMode===this.options.displayMode)return console.warn("no need to update material",this.currentDisplayMode,this.options.displayMode),!1;if(void 0===this.mesh)return console.error("expected mesh not in scene",this.info()),!1;var t=this.options.displayMode,r=this.options.viewModeType;if(this.mesh.castShadow=!1,this.mesh.receiveShadow=!1,t===r.TEXTURE){if(null===this.texture_material)return console.warn("texture lost",this.info()),!1;e(this.texture_material,!1),this.mesh.material=this.texture_material}else if(t===r.FLAT)this._storeTextureMaterial(),this.mesh.material=this.options.materials.flat;else if(t===r.WIREFRAME)this._storeTextureMaterial(),this.mesh.material=this.options.materials.wireframe;else if(t===r.SELECT)this.displaySelectionOrCrop(!0);else if(t===r.CROP)this.displaySelectionOrCrop(!1);else if(t===r.SHADOWMAP)this.displayShadowMapMaterial();else if(t===r.TRANSPARENT)this.displayTransparentMaterial();else if(t===r.PHONGFLAT){if(null===this.texture_material)return console.warn("texture lost",this.info()),!1;e(this.texture_material,!0),this.mesh.material=this.texture_material}this.currentDisplayMode=t}return!0}},{key:"displaySelectionOrCrop",value:function(e){if(this._storeTextureMaterial(),this.initOrthoSelectionMaterial(this.cropConfig.orthoInfo),e?this.setOrthoSelectionMask(this.cropConfig.selectTex,this.cropConfig.cropTex):this.setCropMask(this.cropConfig.cropTex),this.orthoSelectioinMaterial)if(this.orthoSelectioinMaterial instanceof Array){for(var t=[],r=0;r<this.orthoSelectioinMaterial.length;r++){this.orthoSelectioinMaterial[r].orthoInfo=this.cropConfig.orthoInfo;var n=this.orthoSelectioinMaterial[r].material;t.push(n)}this.mesh.material=t}else this.orthoSelectioinMaterial.orthoInfo=this.cropConfig.orthoInfo,this.mesh.material=this.orthoSelectioinMaterial.material}},{key:"initOrthoSelectionMaterial",value:function(e){function t(t){var r={map:t.map,material:t,info:e,decodeMatrix:n.mesh.matrix,side:n.side};return null!==r.toLoadSpaceMatrix&&void 0!==r.decodeMatrix||console.error("get decode matrix",r.toLoadSpaceMatrix),new u.default(r)}var r=this;if(null===e||void 0===e||null===this.mesh||null===this.mesh.material||null!==this.orthoSelectioinMaterial)return!1;var n=this,i=this.mesh.material;return i instanceof Array?(this.orthoSelectioinMaterial=[],i.forEach(function(e){r.orthoSelectioinMaterial.push(t(e))})):this.orthoSelectioinMaterial=t(i),!0}},{key:"updateOrthoInfo",value:function(e){this.orthoSelectioinMaterial}},{key:"setOrthoSelectionMask",value:function(e,t){return null===e||void 0===e?(console.log("tex undefined sel",e),!1):!!this.orthoSelectioinMaterial&&(this.orthoSelectioinMaterial.maskTexture=e,this.orthoSelectioinMaterial.cropTexture=t,!0)}},{key:"setCropMask",value:function(e){return null!==e&&void 0!==e||console.log("tex undefined cc",e),!!this.orthoSelectioinMaterial&&(this.orthoSelectioinMaterial.maskTexture=e,this.orthoSelectioinMaterial.cropTexture=e,!0)}},{key:"displayShadowMapMaterial",value:function(){if(this._storeTextureMaterial(),!this.shadowMapMaterial)if(this.mesh.geometry.normal||this.mesh.geometry.computeVertexNormals(),this.texture_material instanceof Array){this.shadowMapMaterial=[];for(var e=0;e<this.texture_material.length;e++){var t=new a.MeshPhongMaterial({map:this.texture_material.map});this.shadowMapMaterial.push(t)}}else this.shadowMapMaterial=new a.MeshPhongMaterial({map:this.texture_material.map});this.mesh.material=this.shadowMapMaterial,this.mesh.castShadow=!0,this.mesh.receiveShadow=!0}},{key:"displayTransparentMaterial",value:function(){if(this._storeTextureMaterial(),!this.shadowMapMaterial)if(this.texture_material instanceof Array){this.shadowMapMaterial=[];for(var e=0;e<this.texture_material.length;e++){var t=new a.MeshPhongMaterial({map:this.texture_material[e].map,dithering:!0,transparent:!0,opacity:.5});this.shadowMapMaterial.push(t)}}else this.shadowMapMaterial=new a.MeshPhongMaterial({map:this.texture_material.map,dithering:!0,transparent:!0,opacity:.5});this.mesh.material=this.shadowMapMaterial}},{key:"setVisibility",value:function(e){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setVisibility",this).call(this,e),this.isInScene()&&void 0!==this.mesh&&!this.options.fullScene&&(this.mesh.place_holder?this.mesh.visible=!1:this.mesh.visible=e)}},{key:"_addToSceneGraph",value:function(e){var t=this,r=this.options.debug;void 0===this.mesh?console.warn(JSON.stringify(this.info())+", mesh undefined, cannot add to scene"):void 0===e?console.warn("sceneGraphRoot undefined"):void 0!==this.sceneGraphRoot?console.warn("Twice adding to scene attempt",this.info()):(this.setVisibility(this.visible),e.add(this.mesh),null!==this.boxMesh&&e.add(this.boxMesh),t.sceneGraphRoot=e,t.options.displayMode!==this.currentDisplayMode&&t.updateDisplayMode(),r&&console.log("add to scene",this.info()))}},{key:"_removeFromSceneGraph",value:function(){var e=this.options.debug,t=!0;return void 0!==this.sceneGraphRoot&&void 0!==this.mesh?(this.sceneGraphRoot.remove(this.mesh),null!==this.boxMesh&&this.sceneGraphRoot.remove(this.boxMesh),this.sceneGraphRoot=void 0,this.mesh.place_holder?this.mesh.visible=!1:this.mesh.visible=!0,0!==this.currentDisplayMode&&(this.mesh.material=this.texture_material,this.texture_material=null,this.currentDisplayMode=0),e&&console.log("remove scene",this.info()),t):(console.warn("_removeFromSceneGraph fail",this),t=!1)}},{key:"_storeTextureMaterial",value:function(){this.currentDisplayMode!==this.options.viewModeType.TEXTURE&&this.currentDisplayMode!==this.options.viewModeType.PHONGFLAT||null!==this.texture_material||(this.texture_material=this.mesh.material)}}]),t}();t.default=c},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),a=n(r(52)),s=n(r(44)),l=n(r(72)),u=function(e){function t(e,r,n,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,a)),l=a.viewModeType;s.displayMode=l.TEXTURE,s.PID=a.PID,s.info=i,s.maxLevel=i.maxLevel,s.minLevel=i.minLevel,s.max_length=Math.max(i.x_tiles,i.y_tiles),i.x_unit=(i.max_bound.x-i.min_bound.x)/i.x_tiles,i.y_unit=(i.max_bound.y-i.min_bound.y)/i.y_tiles,i.z1=i.z_dir.clone().multiplyScalar(i.floor_height),i.z2=i.z_dir.clone().multiplyScalar(i.max_bound.z),s.smart_options.MIN_AREA=.01*(i.isMobile?2:1);var u=Math.min(Math.max(a.quality||60,0),100),c=Math.min(.8*s.MAX_CACHE_SIZE,80);return s.tree_size_limit=Math.min(c+Math.floor(.8*(s.MAX_CACHE_SIZE-c)*u/100-4),450),s.node_options.isMobile=i.isMobile,s.node_options.displayMode=s.displayMode,s.node_options.info=s.info,s.node_options.basepath=n,s.node_options.showBBox=s.smart_options.bbox,s.node_options.fullScene=s.smart_options.fullScene,s.node_options.maxAnisotropy=a.maxAnisotropy,s.node_options.materials={flat:new o.MeshPhongMaterial({color:8947848,specular:8947848,shininess:30,flatShading:!0}),wireframe:new o.MeshBasicMaterial({color:12303291,wireframe:!0})},s.node_options.viewModeType=l,s.node_options.cropConfig={orthoInfo:null,cropTex:null,selectTex:null},s.node_options.side=a.side,s.dataPath=a.dataPath,s.root=new s.Node(0,0,0,s.max_length,null,s.node_options),s.numOfNodes++,s.altizureApi=a.altizureApi,s.altizureApi||console.error("AltizureProjectTree altizureApi undefined."),s.crop_options={editMask:a.editMask,HOST:a.HOST},a.viewMode!==l.SELECT&&a.viewMode!==l.CROP||s.initCrop(),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"destruct",value:function(){var e=!0;return this.cropManager&&(e&=this.cropManager.destruct(),this.cropManager=void 0),this.node_options.cropConfig.cropTex&&(this.node_options.cropConfig.cropTex.dispose(),this.node_options.cropConfig.cropTex=void 0),this.node_options.cropConfig.selectTex&&(this.node_options.cropConfig.selectTex.dispose(),this.node_options.cropConfig.selectTex=void 0),e&&function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"initCrop",value:function(){var e={PID:this.PID,dataPath:this.dataPath,usage:"crop",maskSize:this.node_options.isMobile?512:2048,info:this.info,tree:this,MaskType:s.default,maxMaskNum:1,edit:this.crop_options.editMask,isDebug:!1,allowWorker:!0,HOST:this.crop_options.HOST,altizureApi:this.altizureApi};this.cropManager=new l.default(e),this.cropManager.downloadAll()}},{key:"setDisplayMode",value:function(e){if({0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0}[e.toString()]){if(this.smart_options.debug&&(console.log("setDisplayMode",e),console.log("node_options",this.node_options.displayMode)),e!==this.displayMode){if(this.node_options.displayMode=e,void 0===this.root||null===this.root)return void console.warn("no root available");(function e(t){for(var r=t.updateDisplayMode(),n=0;n<t.nodes.length;n++)r=e(t.nodes[n])&&r;return r})(this.root)||console.warn("setDisplayMode has problems"),this.displayMode=e}}else console.warn("Display mode "+e+" is not supported. Using default mode instead...")}},{key:"updateOrthoSelectionMask",value:function(e,t,r){r?this.node_options.cropConfig.selectTex=t:this.node_options.cropConfig.cropTex=t,this.node_options.cropConfig.orthoInfo=e,this.setDisplayMode(this.node_options.viewModeType.TEXTURE),r?this.setDisplayMode(this.node_options.viewModeType.SELECT):this.setDisplayMode(this.node_options.viewModeType.CROP)}},{key:"expand",value:function(e){if(e.level>=this.maxLevel)return console.warn(e,"exceed max level",this.maxLevel),!1;if(e.nodes.length>0)return console.warn(e,"children exist"),!1;if(0===e.nodes.length){for(var t=e.x,r=e.y,n=e.size,i=e.level,o=0;o<4;o++){var a=t+o%2*n*.5,s=r+Math.floor(o/2)*n*.5;e.nodes[o]=new this.Node(a,s,i+1,n/2,e,this.node_options),this.numOfNodes++}return!0}return console.warn("unknown giveBirth error"),!1}}]),t}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._version="0.0.1"}return n(e,null,[{key:"detectIE",value:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10)}var n=e.indexOf("Edge/");return n>0&&parseInt(e.substring(n+5,e.indexOf(".",n)),10)}},{key:"isMobile",value:function(){return/iPhone|iPod|iPad|Android|BlackBerry/.test(navigator.userAgent)}}]),e}();t.default=i},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=n(r(9)),a=n(r(12)),s=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.apiUrl=t.apiUrl,this.key=t.key,this.altitoken=t.altitoken}return i(e,[{key:"destruct",value:function(){}},{key:"project",value:function(e){var t=e.pid,r=e.timeout?e.timeout:1e4,n='{project(id: "'+t+'") { id name owner { id name } isImported views date versionControl cloudPath { key dataUrl } geoInfo { mercatorTransform transformed manualAligned autoAligned minLat minLong maxLat maxLong centerLat centerLong } annotations{edges{node{ id modelx modely modelz title description color glyph createTimestamp editTimestamp cameraPosition {x y z} centerPosition {x y z}}}} modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter initialCamPos {cameraPos centerPos} }}}';return this._request(n,r).then(function(e){return Promise.resolve(e.data.data.project)}).catch(function(e){return console.error("api:project",e),Promise.reject(e)})}},{key:"my",value:function(e){var t=e&&e.timeout?e.timeout:1e4;return this._request("{my{self{ id name email balance company country joined}\n   projects { edges {node { id name owner {id username name} views date versionControl  cloudPath { key dataUrl }  geoInfo { mercatorTransform transformed manualAligned autoAligned minLat minLong maxLat maxLong centerLat centerLong }  modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter}}}}}}",t).then(function(e){return Promise.resolve(e.data.data.my)}).catch(function(e){return console.error("api:my",e),Promise.reject(e)})}},{key:"allProjects",value:function(e){var t=e.limit,r=e.timeout?e.timeout:2e4,n="{ allProjects (first: "+t+") { edges { node { id name showLocation visibility geoInfo {autoAligned minLat minLong maxLat maxLong centerLat centerLong } cloudPath {key dataUrl} versionControl  modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter}  views owner {name joined} date  } } } }";return this._request(n,r).then(function(e){for(var t=[],r=e.data.data.allProjects.edges,n=0;n<r.length;n++)t.push(r[n].node);return Promise.resolve(t)}).catch(function(e){return console.error("api:allProjects",e),Promise.reject(e)})}},{key:"getCountryName",value:function(e){var t=(e=e||{}).timeout?e.timeout:1e4;return this._request("{ getGeoIPInfo { countryName } }",t).then(function(e){var t=e.data.data.getGeoIPInfo.countryName;return Promise.resolve(t)}).catch(function(e){return console.warn("api:getGeoIPInfo",e,"set to China"),Promise.resolve("China")})}},{key:"geoNearProjects",value:function(e){var t=e.limit,r=e.center,n=e.span,i=e.timeout?e.timeout:1e4,o=function(e){var t=e[0],r=e[1];return t<-180?t=-180:t>180&&(t=180),r<-90?r=-90:r>90&&(r=90),[t,r]}([r.lng,r.lat]),a="{geoNearProjects(center: "+("{ latitude: "+o[1]+", longitude:"+o[0]+" }")+", span:"+n+", limit: "+t+") {id name visibility geoInfo {autoAligned minLat minLong maxLat maxLong centerLat centerLong } cloudPath {key dataUrl} versionControl  modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter}  views owner {name joined} date }}";return this._request(a,i).then(function(e){var t=e.data.data.geoNearProjects;return Promise.resolve(t)}).catch(function(e){return console.error("api:geoNearProjects",e),Promise.reject(e)})}},{key:"_request",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n={key:this.key};this.altitoken&&(n.altitoken=this.altitoken);var i=this;return r--,(0,o.default)({method:"post",url:this.apiUrl,timeout:t,headers:n,data:"query="+e,responseType:"json"}).catch(function(n){return n instanceof Error&&n.message.includes("timeout")&&r>0?i._request(e,2*t,r):Promise.reject(n)})}},{key:"cropMask",value:function(e){var t=e.pid,r=e.timeout?e.timeout:1e4,n='{project(id: "'+t+'") { \n      cropMask { \n        usage \n        maskBox { minX minY maxX maxY } \n        maskInfos { polyNum width height data } \n      } \n    }}';return this._request(n,r).then(function(e){return Promise.resolve(e.data.data.project.cropMask)}).catch(function(e){return console.error("api:cropMask",e),Promise.reject(e)})}},{key:"waterMask",value:function(e){var t=e.pid,r=e.timeout?e.timeout:1e4,n='{project(id: "'+t+'"){\n      waterMask {\n        maskInfos { level alpha wave color polyNum width height data }\n        maskBox { minX minY maxX maxY }\n      }\n    }}';return this._request(n,r).then(function(e){return Promise.resolve(e.data.data.project.waterMask)}).catch(function(e){return console.error("api:waterMask",e),Promise.reject(e)})}},{key:"projectMask",value:function(e){var t=e.pid,r=e.usage;return"crop"===r?this.cropMask({pid:t}):"water"===r?this.waterMask({pid:t}):Promise.reject(new Error("Unknown mask usage "+r))}},{key:"solution",value:function(e){var t=e.sid,r=e.timeout?e.timeout:1e4,n='{\n      solution (id: "'+t+'") {\n        id name visibility scene history owner {\n          name\n        }\n      }\n    }';return this._request(n,r).then(function(e){var t=e.data.data.solution;if("string"==typeof t.scene&&t.scene.length>0){var r=a.default.AES.decrypt(decodeURIComponent(t.scene),"altizure-environment").toString(a.default.enc.Utf8);t.scene=r}else console.warn("scene",t);return Promise.resolve(t)}).catch(function(e){return console.error("api:solution",e),Promise.reject(e)})}},{key:"createProjectSolution",value:function(e){var t=e.name,r=e.timeout?e.timeout:1e4,n='mutation{\n      createProjectSolution(name: "'+t+'"){\n        id name scene history owner {\n          id name\n        }\n      }\n    }';return this._request(n,r).then(function(e){return Promise.resolve(e.data.data.createProjectSolution)}).catch(function(e){return console.error("api:createProjectSolution",e),Promise.reject(e)})}},{key:"updateProjectSolution",value:function(e){var t=e.id,r=e.options.data.name,n=a.default.AES.encrypt(e.options.data.scene,"altizure-environment").toString(),i=encodeURIComponent(n),o=void 0!==e.options.preserveScene&&e.options.preserveScene,s=e.timeout?e.timeout:1e4,l='mutation{\n      updateProjectSolution(\n        id: "'+t+'", \n        options: {\n          data: {name: "'+r+'", scene: "'+i+'"}, \n          preserveScene: '+o+"\n        }\n      ){\n        id name scene history owner {\n          id name\n        }\n      }\n    }";return this._request(l,s).then(function(e){return Promise.resolve(e.data.data.updateProjectSolution)}).catch(function(e){return console.error("api:updateProjectSolution",e),Promise.reject(e)})}},{key:"removeProjectSolution",value:function(e){var t=e.id,r=e.timeout?e.timeout:1e4,n='mutation{\n      removeProjectSolution(id: "'+t+'"){\n        id name scene history owner {\n          id name\n        }\n      }\n    }';return this._request(n,r).then(function(e){return Promise.resolve(e.data.data.removeProjectSolution)}).catch(function(e){return console.error("api:createProjectSolution",e),Promise.reject(e)})}},{key:"altitoken",set:function(e){this._altitoken=e},get:function(){return this._altitoken}},{key:"key",set:function(e){this._key=e},get:function(){return this._key}}]),e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);t.default=function(){var e=1,t=new n.Matrix4,r=new n.Matrix4,i=new n.Matrix4;this.objToViewer=function(e){return e.applyMatrix4(r)},this.viewerToObj=function(e){return e.applyMatrix4(i)},this.tileToWorld=function(e){return e.applyMatrix4(t)},this.set=function(o){t=o.onload||t;var a=1/(e=o.scale||e);r=t.clone().multiply((new n.Matrix4).makeScale(a,a,a)),i=(new n.Matrix4).getInverse(r)},this.getOnloadMatrix=function(){return t.clone()},this.getOnloadMatrixRef=function(){return t},this.getViewerToObjMatrix=function(){return i.clone()},this.getObjToViewerMatrix=function(){return r.clone()},this.profileToWorld=function(e,t,r,n,i){var o=t.clone().multiplyScalar(i.x),a=r.clone().multiplyScalar(i.y),s=n.clone().multiplyScalar(i.z);return e.clone().add(o).add(a).add(s)},this.getBBoxCoord=function(e,t){return[this.profileToWorld(e.origin,e.x_dir,e.y_dir,e.z_dir,e.min_bound),this.profileToWorld(e.origin,e.x_dir,e.y_dir,e.z_dir,e.max_bound)]},this.transBBox=function(e,t,r,i,o,a,s){var l=new Array(8);l[0]=e.clone(),l[1]=new n.Vector3(e.x,t.y,e.z),l[2]=new n.Vector3(t.x,e.y,e.z),l[3]=new n.Vector3(t.x,t.y,e.z);for(var u=0;u<4;++u)l[u+4]=l[u].clone().setZ(t.z);for(var c=new Array(2),h=0;h<8;++h){var f=this.profileToWorld(r,i,o,a,l[h]);s&&f.applyMatrix4(s),0===h?(c[0]=f.clone(),c[1]=f.clone()):(c[0].x=Math.min(c[0].x,f.x),c[0].y=Math.min(c[0].y,f.y),c[0].z=Math.min(c[0].z,f.z),c[1].x=Math.max(c[1].x,f.x),c[1].y=Math.max(c[1].y,f.y),c[1].z=Math.max(c[1].z,f.z))}return c},this.getTransBBox=function(e,r){return this.transBBox(e.min_bound,e.max_bound,e.origin,e.x_dir,e.y_dir,e.z_dir,r?t:null)}}},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.AtmosphereSelfShaderMaterial=t.GroundSelfShaderMaterial=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(0),l=.0025,u=.001,c=20,h=-.95,f=.999,d=1.00505,p=[.65,.57,.475],m=.25,v={uniforms:{center:{type:"v3",value:new s.Vector3(0,0,0)},focus:{type:"v3",value:new s.Vector3(0,0,0)},v3InvWavelength:{type:"v3",value:new s.Vector3(1/Math.pow(p[0],4),1/Math.pow(p[1],4),1/Math.pow(p[2],4))},fInnerRadius:{type:"f",value:f},fInnerRadius2:{type:"f",value:f*f},fOuterRadius:{type:"f",value:d},fOuterRadius2:{type:"f",value:d*d},fKrESun:{type:"f",value:l*c},fKmESun:{type:"f",value:u*c},fKr4PI:{type:"f",value:4*l*Math.PI},fKm4PI:{type:"f",value:4*u*Math.PI},fScale:{type:"f",value:1/(d-f)},fScaleDepth:{type:"f",value:m},fScaleOverScaleDepth:{type:"f",value:1/(d-f)/m},g:{type:"f",value:h},g2:{type:"f",value:h*h},nSamples:{type:"i",value:3},fSamples:{type:"f",value:3},fNightScale:{type:"f",value:1},fExposure:{type:"f",value:2}},vertexShader_atmosphere:"\n  //\n  // Atmospheric scattering vertex shader\n  //\n  // Author: Sean O'Neil\n  //\n  // Copyright (c) 2004 Sean O'Neil\n  //\n  uniform vec3 v3InvWavelength; // 1 / pow(wavelength, 4) for the red, green, and blue channels\n  uniform float fOuterRadius;   // The outer (atmosphere) radius\n  uniform float fOuterRadius2;  // fOuterRadius^2\n  uniform float fInnerRadius;   // The inner (planetary) radius\n  uniform float fInnerRadius2;  // fInnerRadius^2\n  uniform float fKrESun;      // Kr * ESun\n  uniform float fKmESun;      // Km * ESun\n  uniform float fKr4PI;     // Kr * 4 * PI\n  uniform float fKm4PI;     // Km * 4 * PI\n  uniform float fScale;     // 1 / (fOuterRadius - fInnerRadius)\n  uniform float fScaleDepth;    // The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  uniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n\n  uniform vec3 center;\n\n  const int nSamples = 3;\n  const float fSamples = 3.0;\n  varying vec3 v3Direction;\n  varying vec3 c0;\n  varying vec3 c1;\n  varying float depth;\n  varying vec3 v3LightPosition;\n\n  float scale(float fCos)\n  {\n    float x = 1.0 - fCos;\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n  }\n  void main(void)\n  {\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n\n    vec3 modelPos = (modelMatrix * vec4(position, 1.0)).xyz;\n    vec3 translatedPosition = modelPos - center;\n    vec3 translatedCameraPosition = cameraPosition - center;\n\n    float fCameraHeight = max(0.0, length(cameraPosition - center));\n    float fCameraHeight2 = pow(fCameraHeight, 2.0);\n\n    v3LightPosition = normalize(vec3(1e8, 1e8, 1e8));\n\n    vec3 v3Ray = translatedPosition - translatedCameraPosition;\n\n    float fFar = length(v3Ray);\n    v3Ray /= fFar;\n    vec3 v3Start;\n    float fStartOffset;\n    if(fCameraHeight>fOuterRadius){\n      // camera in space\n      // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n      float B = 2.0 * dot(translatedCameraPosition, v3Ray);\n      float C = fCameraHeight2 - fOuterRadius2;\n      float fDet = max(0.0, B*B - 4.0 * C);\n      float fNear = 0.5 * (-B - sqrt(fDet));\n      // Calculate the ray's starting position, then calculate its scattering offset\n      v3Start = translatedCameraPosition + v3Ray * fNear;\n      fFar -= fNear;\n      float fStartAngle = dot(v3Ray, v3Start) / fOuterRadius;\n      float fStartDepth = exp(-1.0 / fScaleDepth);\n      fStartOffset = fStartDepth * scale(fStartAngle);\n      depth = clamp(fStartOffset, 0.0, 1.0);\n    }else{\n      // camera in atmosphere\n      v3Start = translatedCameraPosition;\n      float fHeight = length(v3Start);\n\n      // float closeSurfaceDiff = min(0.0001 * (fInnerRadius - fOuterRadius), (fInnerRadius - fHeight));\n      float closeSurfaceDiff = min(0.0, (fInnerRadius - fHeight));\n      float fDepth = exp(fScaleOverScaleDepth * closeSurfaceDiff);\n      // float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fCameraHeight));\n      \n      float fStartAngle = dot(v3Ray, v3Start) / fHeight;\n      fStartOffset = fDepth*scale(fStartAngle);\n      // float fStartDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fCameraHeight));\n      float fStartDepth = exp(fScaleOverScaleDepth * closeSurfaceDiff);\n      depth = clamp(fStartDepth*scale(fStartAngle),0.0,1.0);\n    }\n    // Initialize the scattering loop variables\n    float fSampleLength = fFar / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = v3Ray * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n    // Now loop through the sample rays\n    vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n    for(int i=0; i<nSamples; i++)\n    {\n      float fHeight = length(v3SamplePoint);\n      // float closeSurfaceDiff = min(0.0001 * (fInnerRadius - fOuterRadius), (fInnerRadius - fHeight));\n      // float fDepth = exp(fScaleOverScaleDepth * closeSurfaceDiff);\n      // if (fInnerRadius >= fHeight) break;\n      float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n      float fLightAngle = dot(v3LightPosition, v3SamplePoint) / fHeight;\n      float fCameraAngle = dot(v3Ray, v3SamplePoint) / fHeight;\n      float fScatter = (fStartOffset + fDepth * (scale(fLightAngle) - scale(fCameraAngle)));\n      vec3 v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n      v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n      v3SamplePoint += v3SampleRay;\n    }\n    // Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    c0 = v3FrontColor * (v3InvWavelength * fKrESun);\n    c1 = v3FrontColor * fKmESun;\n\n    v3Direction = translatedCameraPosition - translatedPosition;\n  }\n  ",fragmentShader_atmosphere:"\n  //\n  // Atmospheric scattering fragment shader\n  //\n  // Author: Sean O'Neil\n  //\n  // Copyright (c) 2004 Sean O'Neil\n  //\n  uniform float fExposure;\n  varying vec3 v3LightPosition;\n  uniform float g;\n  uniform float g2;\n  uniform float fOuterRadius;   // The outer (atmosphere) radius\n\n  uniform vec3 center;\n\n  varying vec3 v3Direction;\n  varying vec3 c0;\n  varying vec3 c1;\n  varying float depth;\n  // Calculates the Mie phase function\n  float getMiePhase(float fCos, float fCos2, float g, float g2)\n  {\n    return 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCos2) / pow(max(0.0, 1.0 + g2 - 2.0 * g * fCos), 1.5);\n  }\n  // Calculates the Rayleigh phase function\n  float getRayleighPhase(float fCos2)\n  {\n    return 0.75 + 0.75 * fCos2;\n  }\n  void main (void)\n  {\n    float fCameraHeight = length(cameraPosition - center);\n\n    float fCos = dot(v3LightPosition, v3Direction) / length(v3Direction);\n    float fCos2 = fCos * fCos;\n    float rayleighPhase = getRayleighPhase(fCos2);\n    float miePhase = getMiePhase(fCos, fCos2, g, g2);\n    float sun = 2.0*((1.0 - 0.2) / (2.0 + 0.2)) * (1.0 + fCos*fCos) / pow(max(0.0, 1.0 + 0.2 - 2.0*(-0.2)*fCos), 1.0);\n    vec3 color = rayleighPhase * c0 +\n            miePhase * c1 +\n            depth * sun * vec3(0.05,0.05,0.1);\n    color = vec3(1.0) - exp(-fExposure*color);\n    float nightmult = clamp(max(color.x, max(color.y, color.z))*1.5,0.0,1.0);\n    gl_FragColor = vec4(color, nightmult);\n    if(fCameraHeight<=fOuterRadius)gl_FragColor.a = nightmult + fOuterRadius - fCameraHeight;\n  }\n  ",vertexShader_ground:"\n  //\n  // Atmospheric scattering vertex shader\n  //\n  // Author: Sean O'Neil\n  //\n  // Copyright (c) 2004 Sean O'Neil\n  //\n  // Ported for use with three.js/WebGL by James Baicoianu\n  // varying vec3 v3LightPosition;   // The direction vector to the light source\n  uniform vec3 v3InvWavelength; // 1 / pow(wavelength, 4) for the red, green, and blue channels\n  uniform vec3 focus; // focus point on earth in earth space\n  uniform float fOuterRadius;   // The outer (atmosphere) radius\n  uniform float fOuterRadius2;  // fOuterRadius^2\n  uniform float fInnerRadius;   // The inner (planetary) radius\n  uniform float fInnerRadius2;  // fInnerRadius^2\n  uniform float fKrESun;      // Kr * ESun\n  uniform float fKmESun;      // Km * ESun\n  uniform float fKr4PI;     // Kr * 4 * PI\n  uniform float fKm4PI;     // Km * 4 * PI\n  uniform float fScale;     // 1 / (fOuterRadius - fInnerRadius)\n  uniform float fScaleDepth;    // The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  uniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n  uniform sampler2D tDiffuse;\n\n  uniform vec3 center;\n\n  // varying vec3 v3Direction;\n  varying vec3 c0;\n  varying vec3 c1;\n  varying vec2 vUv;\n  const int nSamples = 3;\n  const float fSamples = 3.0;\n  float scale(float fCos)\n  {\n    float x = 1.0 - fCos;\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n  }\n  void main(void)\n  {\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 modelPos = (modelMatrix * vec4(position, 1.0)).xyz;\n    vec3 translatedPosition = modelPos - center;\n    vec3 translatedCameraPosition = cameraPosition - center;\n\n    float fCameraHeight = max(0.0, length(cameraPosition - center));\n    float fCameraHeight2 = pow(fCameraHeight, 2.0);\n    \n    // vec3 focusWorld = (modelMatrix * vec4(focus, 1.0)).xyz - center;\n    // v3LightPosition = normalize(focusWorld);\n    vec3 v3LightPosition = normalize(vec3(1e8, 1e8, 1e8));\n\n    vec3 v3Ray = translatedPosition - translatedCameraPosition;\n    float fFar = length(v3Ray);\n    v3Ray /= fFar;\n    vec3 v3Start;\n    if(fCameraHeight>fOuterRadius){\n        // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n      float B = 2.0 * dot(translatedCameraPosition, v3Ray);\n      float C = fCameraHeight2 - fOuterRadius2;\n      float fDet = max(0.0, B*B - 4.0 * C);\n      float fNear = 0.5 * (-B - sqrt(fDet));\n      // Calculate the ray's starting position, then calculate its scattering offset\n      v3Start = translatedCameraPosition + v3Ray * fNear;\n      fFar -= fNear;\n    }else{\n      v3Start = translatedCameraPosition;\n    }\n    float fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);\n    float fCameraAngle = dot(-v3Ray, translatedPosition) / length(translatedPosition);\n    float fLightAngle = dot(v3LightPosition, translatedPosition) / length(translatedPosition);\n    float fCameraScale = scale(fCameraAngle);\n    float fLightScale = scale(fLightAngle);\n    float fCameraOffset = fDepth*fCameraScale;\n    float fTemp = (fLightScale + fCameraScale);\n    // Initialize the scattering loop variables\n    float fSampleLength = fFar / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = v3Ray * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n    // Now loop through the sample rays\n    vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n    vec3 v3Attenuate;\n    for(int i=0; i<nSamples; i++)\n    {\n      float fHeight = length(v3SamplePoint);\n      float closeSurfaceDiff = min(0.6 * (fInnerRadius - fOuterRadius), (fInnerRadius - fHeight));\n      // float closeSurfaceDiff = min(0.0, (fInnerRadius - fHeight));\n      float fDepth = exp(fScaleOverScaleDepth * closeSurfaceDiff);\n      fCameraOffset = clamp(fCameraOffset, -0.1, 0.1);\n      float fScatter = fDepth*fTemp - fCameraOffset;\n      // float fScatter = fDepth*fTemp;\n      // origianlly float fScatter = fDepth*fTemp - fCameraOffset;\n      v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n      v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n      v3SamplePoint += v3SampleRay;\n    }\n    // Calculate the attenuation factor for the ground\n    c0 = v3Attenuate;\n    c1 = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    vUv = uv;\n  }\n  ",fragmentShader_ground:"\n  //\n  // Atmospheric scattering fragment shader\n  //\n  // Author: Sean O'Neil\n  //\n  // Copyright (c) 2004 Sean O'Neil\n  //\n  // Ported for use with three.js/WebGL by James Baicoianu\n  uniform float fNightScale;\n  // varying vec3 v3LightPosition;\n  uniform sampler2D tDiffuse;\n  varying vec3 c0;\n  varying vec3 c1;\n  varying vec2 vUv;\n  uniform float fExposure;\n\n  uniform vec3 center;\n\n  // void main (void)\n  // {\n  //   vec3 diffuseTex = texture2D( tDiffuse, vUv ).xyz;\n  //   vec3 diffuseNightTex = diffuseTex * 0.1;\n  //   vec3 day = diffuseTex * c0;\n  //   vec3 night = fNightScale * diffuseNightTex * diffuseNightTex * diffuseNightTex * (1.0 - c0);\n  //   vec3 color = c1 + day + night;\n  //   color = 1.0 - exp(-fExposure * color);\n  //   gl_FragColor = vec4(color, 1.0);\n  // }\n\n  void main (void)\n  {\n    vec3 diffuseTex = texture2D( tDiffuse, vUv ).xyz;\n    vec3 diffuseNightTex = diffuseTex * 0.1;\n    vec3 day = diffuseTex * c0;\n    vec3 night = fNightScale * diffuseNightTex * diffuseNightTex * diffuseNightTex * (1.0 - c0);\n    vec3 color = c1 + day + night;\n    color = 1.0 - exp(-fExposure * color);\n    gl_FragColor = vec4(color, 1.0);\n  }\n  "},g=function(e){function t(e){n(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.uniforms=v.uniforms,r.vertexShader=v.vertexShader_atmosphere,r.fragmentShader=v.fragmentShader_atmosphere,r.transparent=!0,r.extensions.derivatives=!0,r.side=s.BackSide,r.depthWrite=!0,r}return o(t,s.ShaderMaterial),a(t,[{key:"passCameraHeight",value:function(e){this.uniforms.fCameraHeight.value=e,this.uniforms.fCameraHeight2.value=e*e}},{key:"setExposure",value:function(e){this.uniforms.fExposure.value=e}},{key:"setCenter",value:function(e){this.uniforms.center.value=e}},{key:"setFocus",value:function(e){this.uniforms.focus.value=e}}]),t}(),y=function(e){function t(e){n(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.uniforms={tDiffuse:{type:"t",value:null}};for(var o=Object.keys(v.uniforms),a=0;a<o.length;a++)r.uniforms[o[a]]=v.uniforms[o[a]];return r.vertexShader=v.vertexShader_ground,r.fragmentShader=v.fragmentShader_ground,r.transparent=!1,r.extensions.derivatives=!0,r}return o(t,s.ShaderMaterial),a(t,[{key:"passCameraHeight",value:function(e){this.uniforms.fCameraHeight.value=e,this.uniforms.fCameraHeight2.value=e*e}},{key:"loadGroundTexture",value:function(e){var t=this;(new s.TextureLoader).load(e,function(e){t.uniforms.tDiffuse.value=e,console.log(e)},function(t){console.log(t.loaded/t.total*100+"% loaded "+e)},function(e){console.log("An error happened")})}},{key:"setTexture",value:function(e){this.uniforms.tDiffuse.value=e}},{key:"setExposure",value:function(e){this.uniforms.fExposure.value=e}},{key:"setCenter",value:function(e){this.uniforms.center.value=e}}]),t}();t.GroundSelfShaderMaterial=y,t.AtmosphereSelfShaderMaterial=g},function(e,t,r){"use strict";function n(e){this.size=0,this.limit=e,this._keymap={}}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.prototype.put=function(e,t){var r={key:e,value:t};if(this._keymap[e]=r,this.tail?(this.tail.newer=r,r.older=this.tail):this.head=r,this.tail=r,this.size===this.limit)return this.shift();this.size++},n.prototype.shift=function(){var e=this.head;return e&&(this.head.newer?(this.head=this.head.newer,this.head.older=void 0):this.head=void 0,e.newer=e.older=void 0,delete this._keymap[e.key]),e},n.prototype.get=function(e,t){var r=this._keymap[e];if(void 0!==r)return r===this.tail?t?r:r.value:(r.newer&&(r===this.head&&(this.head=r.newer),r.newer.older=r.older),r.older&&(r.older.newer=r.newer),r.newer=void 0,r.older=this.tail,this.tail&&(this.tail.newer=r),this.tail=r,t?r:r.value)},n.prototype.find=function(e){return this._keymap[e]},n.prototype.set=function(e,t){var r,n=this.get(e,!0);return n?(r=n.value,n.value=t):(r=this.put(e,t))&&(r=r.value),r},n.prototype.remove=function(e){var t=this._keymap[e];if(t)return delete this._keymap[t.key],t.newer&&t.older?(t.older.newer=t.newer,t.newer.older=t.older):t.newer?(t.newer.older=void 0,this.head=t.newer):t.older?(t.older.newer=void 0,this.tail=t.older):this.head=this.tail=void 0,this.size--,t.value},n.prototype.removeAll=function(){this.head=this.tail=void 0,this.size=0,this._keymap={}},"function"==typeof Object.keys?n.prototype.keys=function(){return Object.keys(this._keymap)}:n.prototype.keys=function(){var e=[];for(var t in this._keymap)e.push(t);return e},n.prototype.forEach=function(e,t,r){var n;if(!0===t?(r=!0,t=void 0):"object"!==(void 0===t?"undefined":i(t))&&(t=this),r)for(n=this.tail;n;)e.call(t,n.key,n.value,this),n=n.older;else for(n=this.head;n;)e.call(t,n.key,n.value,this),n=n.newer},n.prototype.toJSON=function(){for(var e=[],t=this.head;t;)e.push({key:t.key.toJSON(),value:t.value.toJSON()}),t=t.newer;return e},n.prototype.toString=function(){for(var e="",t=this.head;t;)e+=String(t.key)+":"+t.value,(t=t.newer)&&(e+=" < ");return e},t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={getMeshes:function(e){return e},getTileFromMesh:function(e){return e.parent.parent},makeTileName:function(e,t,r){return e+"_"+t+"_"+r},parseTileName:function(e){var t=e.split("_");return{level:t[0],x:t[1],y:t[2]}},getNumOfFaces:function(e){if(!e.hasOwnProperty("name"))return 0;if(""===e.name)return 0;for(var t=0,r=n.getMeshes(e),i=0;i<r.length;++i)t+=r[i].geometry.getIndex().count/3;return t},getNumOfVertices:function(e){if(!e.hasOwnProperty("name"))return 0;if(""===e.name)return 0;for(var t=0,r=n.getMeshes(e),i=0;i<r.length;++i)t+=r[i].geometry.getAttribute("position").count;return t}};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=[],t=0;this.getLength=function(){return e.length-t},this.isEmpty=function(){return 0===e.length},this.enqueue=function(t){e.push(t)},this.dequeue=function(){if(0!==e.length){var r=e[t];return 2*++t>=e.length&&(e=e.slice(t),t=0),r}},this.peek=function(){return e.length>0?e[t]:void 0},this.clear=function(){e=[],t=0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};n.isMobile=/iPhone|iPod|iPad|Android|BlackBerry/.test(navigator.userAgent),n.createDiv=function(e,t,r,n){var i=document.createElement("div");return"undefined"!=typeof id&&(i.id=t+"_div"),void 0!==t&&(i.className=t),void 0!==r&&(i.style.cssText=r),void 0!==n&&(i.innerHTML=n),e.appendChild(i),i},t.default=n},function(e,t,r){e.exports=function(e){var t,r,n,i,o;r=(t=e).lib,n=r.Base,i=t.enc,o=i.Utf8,t.algo.HMAC=n.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=o.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),a=this._iKey=t.clone(),s=i.words,l=a.words,u=0;u<r;u++)s[u]^=1549556828,l[u]^=909522486;i.sigBytes=a.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})}(r(1))},function(e,t,r){e.exports=function(e){return r=(t=e).lib,n=r.WordArray,i=r.Hasher,o=t.algo,a=[],s=o.SHA1=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],s=r[3],l=r[4],u=0;u<80;u++){if(u<16)a[u]=0|e[t+u];else{var c=a[u-3]^a[u-8]^a[u-14]^a[u-16];a[u]=c<<1|c>>>31}var h=(n<<5|n>>>27)+l+a[u];h+=u<20?1518500249+(i&o|~i&s):u<40?1859775393+(i^o^s):u<60?(i&o|i&s|o&s)-1894007588:(i^o^s)-899497514,l=s,s=o,o=i<<30|i>>>2,i=n,n=h}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+s|0,r[4]=r[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}}),t.SHA1=i._createHelper(s),t.HmacSHA1=i._createHmacHelper(s),e.SHA1;var t,r,n,i,o,a,s}(r(1))},function(e,t,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r(9)),o={},a=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.dataPath=t,this.report={content:null,loading:!1,read:!1},this.db={content:null,loading:!1,ready:!1},this.callbacks=[],this.callbacks_db=[]}return n(e,[{key:"_readReport",value:function(e){var t=this.dataPath+"/param.json",r=this.dataPath+"/final_report.json",n=this.report;return(0,i.default)({method:"get",url:t,responseType:"json",timeout:3e4}).then(function(t){var r=t.data;n.content=r,e()}).catch(function(t){return(0,i.default)({method:"get",url:r,responseType:"json",timeout:3e4}).then(function(t){var r=t.data;n.content=r,e()}).catch(function(t){e()})})}},{key:"getReport",value:function(e){var t=this,r=this.report;r.read?e(r.content):(this.callbacks.push(e),r.loading||(r.loading=!0,this._readReport(function(){r.read=!0,r.loading=!1,t.callbacks.map(function(e){e(r.content)}),t.callbacks=[]})))}},{key:"_readDatabase",value:function(e){var t=this.dataPath+"/db.json",r=this.db;(0,i.default)({method:"get",url:t,responseType:"json",timeout:3e4}).then(function(t){var n=t.data;r.content=n,e()}).catch(function(t){e()})}},{key:"getDatabase",value:function(e){var t=this,r=this.db;r.ready?e(r.content):(this.callbacks_db.push(e),r.loading||(r.loading=!0,this._readDatabase(function(){r.ready=!0,r.loading=!1,t.callbacks_db.map(function(e){e(r.content)}),t.callbacks_db=[]})))}}],[{key:"getInstance",value:function(t){var r=t;return o[r]||(o[r]=new e(r)),o[r]}}]),e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(12));t.default=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r={"www.altizure.com":!0,"beta.altizure.com":!0,"site.altizure.com":!0,"www.altizure.cn":!0,"site.altizure.cn":!0,"127.0.0.1":!0,localhost:!0},i=void 0;t&&t.HOST&&(r[i=n.default.AES.decrypt(t.HOST,"altizure-environment").toString(n.default.enc.Utf8)]=!0),i&&"TilesViewerLocal"===i?this.baseURL="https://www.altizure.cn":"127.0.0.1"===window.location.hostname?this.baseURL="https://www.altizure.cn":this.baseURL=r[window.location.hostname]?window.location.protocol+"//"+window.location.host:"https://www.altizure.cn",this.postConfig={headers:{"Content-Type":"application/json; charset=UTF-8"},credentials:"include"}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=n(r(18)),a=n(r(16)),s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.viewer=e.viewer,r.updateMaskFormat=e.updateMaskFormat,r.normalTex=null,r.downloadSucess=!1,r.isDebug=!1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"destruct",value:function(){var e=this;a.default.prototype.destruct.call(this),this.viewer.cameraControls.removeEventListener("changing",e._updateLightDirection),e.directionalLight_water&&e.directionalLight_water.dispose()}},{key:"updateDBFormat",value:function(){this.service.preProcess&&(console.log("0. update db format ...",this.service.preProcess),this.service.preProcess())}},{key:"downloadAll",value:function(){var e=this;this.updateMaskFormat&&e.updateDBFormat(),e.isDebug&&console.log("1. download normal tex ..."),e.service.getNormalTex(function(t){t&&(e.normalTex=t,e.isDebug&&(console.log("normal tex loaded",e.normalTex),console.log("2. download water settings ...")),e._downloadSettings(o.default,function(){}))})}},{key:"_defaultMaskOpts",value:function(e){var t=a.default.prototype._defaultMaskOpts.call(this);return t.viewer=this.viewer,t.show=!0,t.directionalLight_water=this.directionalLight_water,t.normalTex=this.normalTex,t.createDefault=!1,t.maskId=e,t.default_properties=this.default_properties,t}},{key:"renderWaters",value:function(){for(var e in this.maskSettings)this.maskSettings[e].render()}},{key:"removeWater",value:function(e){this.maskSettings[e]&&(this.maskSettings[e].remove(),delete this.maskSettings[e],this.isDebug&&console.log("after delete #",Object.keys(this.maskSettings)),this.nameCnt=0,this.isModified=!0)}},{key:"setCamera",value:function(e){for(var t in console.warn("WaterManager setCamera"),this.maskSettings)this.maskSettings[t].setCamera(e)}}]),t}();t.default=s},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),a=n(r(30)),s=n(r(10)),l=n(r(20)),u=n(r(11)),c=n(r(95)),h=n(r(98)),f=n(r(54)),d=n(r(78)),p=n(r(3)),m=n(r(14)),v=n(r(41)),g=n(r(106)),y=n(r(42)),_=n(r(24)),w=n(r(92)),b=n(r(99)),x=function(){function e(t,r){function n(e){void 0!==e&&e?i(e):x.updateSceneQueue.add({force:!1})}function i(e){if(x.isInitialized){x.camera.updateMatrix(),x.camera.updateMatrixWorld(!0),x.camera.updateProjectionMatrix();try{x.camera.matrixWorldInverse.getInverse(x.camera.matrixWorld,!0)}catch(e){return console.warn("catch earth",e),!1}var t=(new o.Matrix4).multiplyMatrices(x.camera.projectionMatrix,x.camera.matrixWorldInverse),r=new o.Frustum;r.setFromMatrix((new o.Matrix4).multiplyMatrices(x.camera.projectionMatrix,x.camera.matrixWorldInverse));var n={camera:x.camera,pvmatrix:t,frustum:r,viewportSize:x.renderer.getSize()};if(!function(e){var t=!0,r=e.camera,n=e.pvmatrix;if(isNaN(r.far)||isNaN(r.near))return!1;if(!n||!n.elements)return!1;for(var i=0;i<n.elements.length;i++)t&=!isNaN(n.elements[i]);return t}(n))return!1;for(var i in x.layers)x.layers[i]&&x.layers[i].sceneUpdated(n);new o.Vector3,new o.Quaternion,new o.Vector3}}function u(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];void 0!==e&&e?m():x.updateVisibilityThrottle.add({force:!1})}function m(){if(!x.isInitialized)return!1;x.camera.updateMatrix(),x.camera.updateMatrixWorld(!0),x.camera.updateProjectionMatrix(),x.camera.matrixWorldInverse.getInverse(x.camera.matrixWorld);var e=new o.Frustum;e.setFromMatrix((new o.Matrix4).multiplyMatrices(x.camera.projectionMatrix,x.camera.matrixWorldInverse));var t={frustum:e};for(var r in x.layers)x.layers[r]&&x.layers[r].updateVisibility(t);return!0}function v(){x.camera.updateProjectionMatrix(),x.effect?x.effect.render(x.scene,x.camera):x.renderer.render(x.scene,x.camera)}(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),r.isMobile=/iPhone|iPod|iPad|Android|BlackBerry/.test(navigator.userAgent);var x=this;this.HOST=r.HOST,this.rootContainer=null,this.config=r,this.scale=e.scale,this.options={},this.scaleParams={minDistance:this.scale-this.scale/1e3,maxDistance:4*this.scale,eye:new o.Vector3(0,0,0),NEAR:x.scale/1e10,FAR:6*x.scale,earthPosition:new o.Vector3(0,0,0)},this.threeContainer=null,this.renderer=null,this.scene=null,this.camera=null,this.effect=null,this.earthNode=new s.default(null),this.earthNode.sceneNode.name="earthNode",this.earthRadius=this.scale,this.earthSurfaceTree=null,this.layers={earth:null,altizureMesh:null,accessory:null},this.control=null,this.clock=new o.Clock,this.isInitialized=!1,this.isDestructed=!1,this.layersReady=null;var k=null;this.updateSceneQueue=null,this.updateVisibilityThrottle=null,this.updateVisibility=u,this._api=new _.default({apiUrl:r.api.API_HOST,key:r.api.API_KEY}),r.api.altitoken&&(this._api.altitoken=r.api.altitoken),this.layersReady=function(){function s(e,t,r,n){var i=["z-index: 2;","position: absolute;","left:0px;","top:0px;","width:100%;","height:100%;","font-size:12pt;","text-align: center;","vertical-align: middle;","text-align: -webkit-center;","vertical-align: -webkit-middle;","background-color: #"+r.toString(16)+";","color: #"+(16777215-r).toString(16)+";","margin:0px;","padding:0px;"].join(""),o=a.default.createDiv(e,"ErrorDiv",i),s=["position: relative;","top:40%;","font-size:12pt;","text-align: center;","vertical-align: middle;","text-align: -webkit-center;","vertical-align: -webkit-middle;","margin:0px;","padding:0px;"].join(""),l=a.default.createDiv(o,"ErrorTextDiv",s);return l.innerHTML=t,n&&(l.innerHTML+='<br><br><a href="'+n+'" class="btn-link">Learn More</a>'),o}return function(){function e(e,t){return void 0===e?(e=t,t):e}var t=r||{};x.config=t,x.config.showOurLogo=e(t.showOurLogo,!0),x.config.i18n=e(t.i18n,{basic:{}}),x.config.projectInfo=e(t.projectInfo,{}),x.config.renderItems=e(t.renderItems,{}),x.config.renderItems.planet=e(t.renderItems.planet,"earth"),x.config.renderItems.earth=e(t.renderItems.earth,!0),x.config.renderItems.earthUseTexture=e(t.renderItems.earthUseTexture,!0),x.config.renderItems.orbitRing=e(t.renderItems.orbitRing,!1),x.config.renderItems.featureInView=e(t.renderItems.featureInView,!0),x.config.renderItems.tileBox=e(t.renderItems.tileBox,!1),x.config.renderItems.background=e(t.renderItems.background,{}),x.config.renderItems.background.transparent=e(t.renderItems.background.transparent,!1),x.config.renderItems.background.opacity=e(t.renderItems.background.opacity,.8),x.config.renderItems.background.color=e(t.renderItems.background.color,2565927),x.config.renderItems.background.image=e(t.renderItems.background.image,void 0),x.config.develop=e(t.develop,!1),x.config.control=e(t.control,{}),x.config.control.doubleTap=e(t.control.doubleTap,!0)}(),x.rootContainer=document.getElementById(t),x.rootContainer?x.threeContainer=function(e){var t=["z-index: 0;","position: relative;","left:0px;","top:0px;","width:100%;","height:100%;","margin:0px;","overflow: hidden !important;","padding:0px;"];return x.config.renderItems.background.image&&t.push("background-image: "+x.config.renderItems.background.image),t=t.join(""),a.default.createDiv(e,"ThreeDiv",t)}(x.rootContainer):console.log("Invalid "+t),function(){x.scene=new o.Scene;var e=x.threeContainer.clientWidth/x.threeContainer.clientHeight,t=x.scaleParams.NEAR,r=x.scaleParams.FAR;x.camera=new o.PerspectiveCamera(45,e,t,r),x.scene.add(x.camera),x.camera.position.copy(x.scaleParams.eye);var n=new o.AmbientLight(16777215,1);x.scene.add(n);var a=new o.PointLight(13696511,1.1,0);if(a.color.setHex(16777215),a.position.set(0,0,0),x.lights={ambient:n,point:a},f.default.webgl){x.config.renderItems.background.transparent?x.renderer=new o.WebGLRenderer({antialias:!0,alpha:!0}):x.renderer=new o.WebGLRenderer({antialias:!0,alpha:!1}),x.config.renderItems.background.transparent?x.renderer.setClearColor(new o.Color(x.config.renderItems.background.color),x.config.renderItems.background.opacity):x.renderer.setClearColor(new o.Color(x.config.renderItems.background.color));var l=.3*((void 0!==window.devicePixelRatio?window.devicePixelRatio:1)-1)+1;x.renderer.setPixelRatio(l),x.renderer.setSize(x.threeContainer.clientWidth,x.threeContainer.clientHeight),x.threeContainer.appendChild(x.renderer.domElement),x.renderer.context.getExtension("OES_standard_derivatives"),x._spotLight=new b.default({renderer:x.renderer,color:65280});var u={promiseFn:function(e){return i(e.force),Promise.resolve()},timer:1250,timeout:1e4,debug:!1};x.updateSceneQueue=new y.default(u);var c={promiseFn:function(e){return e.force,m(),Promise.resolve()},timer:200,timeout:1e4,debug:!1};x.updateVisibilityThrottle=new y.default(c),v()}else{if(f.default.browser.isWeChat){var h=/iPhone|iPod|iPad/.test(navigator.userAgent)?"Open in Safari":"Open with Browser";return void s(x.rootContainer,'1. Click the button on upper right corner. <br>2. Select "'+h+'".',x.config.renderItems.background.color)}s(x.rootContainer,"No WebGL Support",x.config.renderItems.background.color,"/support/articles/faq_compatibility")}}(),function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];n(e),u(e)}x.control=new d.default({camera:x.camera,openning:{poseTo:r.camera.poseTo,flyTo:r.camera.flyTo},handlers:void 0,earthNode:x.earthNode,layers:x.layers,domElement:x.renderer.domElement,showAnchor:x.config.develop}),x.control.addEventListener("onCameraChange",function(){e(),k&&k.add({message:0})}),x.control.addEventListener("onCameraEnd",function(){e(!0)}),x.control.addEventListener("onCameraStart",function(){e(!1)}),window.addEventListener("resize",function(){x.camera.aspect=x.threeContainer.clientWidth/x.threeContainer.clientHeight,x.camera.updateProjectionMatrix(),x.renderer.setSize(x.threeContainer.clientWidth,x.threeContainer.clientHeight),x.effect&&x.effect.setSize(x.threeContainer.clientWidth,x.threeContainer.clientHeight)},!1),x.updateVis=e}(),x.isInitialized=!0,function(){function t(){var e={debug:!1,maxLevel:x.config.isMobile&&x.config.renderItems.earthUseTexture?10:14,minLevel:0,tree_size_limit:x.config.isMobile?x.config.renderItems.earthUseTexture?120:300:350,MAX_THREADS:x.config.isMobile?3:8,MAX_CACHE_SIZE:x.config.isMobile?x.config.renderItems.earthUseTexture?140:320:400,MIN_AREA:.6,maxAnisotropy:o,allow_worker:!1,display_lod:!1,useColor:!1,planet:x.config.renderItems.planet,useTexture:x.config.renderItems.earthUseTexture,fullScene:!0,earthRadius:x.scale,countryName:a,onError:function(e){console.error(e)},renderItems:{orbitRing:x.config.renderItems.orbitRing},eventHandlers:r.eventHandlers};return Promise.resolve(new l.default(x.earthNode,h.default,{dataSeeds:[e]}))}function i(){var e=[];"China"===a?(e[0]="oss_sz",e[1]="oss_usw",e[2]="local"):(e[0]="oss_usw",e[1]="oss_sz",e[2]="local");var t={debug:!1,cloudPriorityList:e,isMobile:x.config.isMobile,onError:function(e){console.warn(e)},earthRadius:x.scale,fullScene:!1,quality:x.config.isMobile?40:60,display_lod:!1,allow_worker:!x.config.isMobile,bbox:x.config.renderItems.tileBox,MAX_THREADS:x.config.isMobile?3:8,MAX_CACHE_SIZE:x.config.isMobile?140:250,ENTITY_CACHE_SIZE:x.config.isMobile?50:150,MIN_AREA:.1,maxAnisotropy:o,HOST:x.HOST,altizureApi:x._api};return Promise.resolve(new c.default(x.earthNode,t))}x.scene.add(x.earthNode.sceneNode);var o=x.renderer.capabilities.getMaxAnisotropy(),a="China";return x._api.getCountryName().then(function(r){a=r;var o=[!x.config.renderItems.earth||t().then(function(e){return e.sceneNode.name="earthLayer sceneNode",x.layers.earth=e,e.startImport()}).then(function(){return n(!0),x.control.earthEntity=x.layers.earth.children[0],x.spotLights[0].addToScene(x.layers.earth.children[0].practicalSceneNode),x.atmosphere=new w.default({earthSceneNode:x.earthNode,camera:x.camera,scale:e.scale}),Promise.resolve()}).catch(function(e){return console.error("earthTask error",e),Promise.reject(e)}),i().then(function(e){return e.sceneNode.name="altizureMesh layer scene node",x.layers.altizureMesh=e,Promise.resolve()})];return Promise.all(o)})}().then(function(e){return Promise.resolve()}).catch(function(e){return console.error("initLayer error",e),Promise.resolve()})}(),this.layersReady.then(function(){!function(){function e(e,t){var r=[];if("private"===e.visibility)console.warn("private project");else for(var n=0;n<e.length;n++){var i=e[n];if(!t||i.showLocation&&void 0!==i.geoInfo&&i.geoInfo.autoAligned&&i.geoInfo.centerLong&&i.geoInfo.minLong)try{var o=new g.default;o.id=i.id,o.name=i.name,o.views=i.views,o.owner={name:i.owner.name||"unknown",joined:i.owner.joined||"unknown"},o.date=i.date,o.geoInfo={autoAligned:i.geoInfo.autoAligned,minLat:i.geoInfo.minLat,minLong:i.geoInfo.minLong,maxLat:i.geoInfo.maxLat,maxLong:i.geoInfo.maxLong,centerLat:i.geoInfo.centerLat,centerLong:i.geoInfo.centerLong},o.cloudPath=i.cloudPath,o.versionControl=i.versionControl||"",o.modelTransform=i.modelTransform,o.valid?r.push(o):console.warn("invalid",i)}catch(e){console.log("response",e)}}return r}var t=x.config.isMobile?20:50,r=[];if(x.config.renderItems.featureInView){var n={promiseFn:function(n){var i=x.control.focus,o={lng:i.lng,lat:i.lat},a=Math.min(Math.max(i.alt/p.default.EARTH_RADIUS/x.scale/1.5*60,.05),89);return x._api.geoNearProjects({limit:t,center:o,span:a}).then(function(t){var n=e(t);return x.addAltizureProjects(r.concat(n))})},timer:2500,timeout:1e4,debug:!1};k=new y.default(n),x._api.allProjects({limit:t}).then(function(n){var i=e(n,!0);return i.length>t/2&&(i=i.slice(0,Math.floor(t/2)),r=i),x.addAltizureProjects(i)}).catch(function(e){return console.warn("getFeaturedProjects",e),Promise.resolve()})}}()}),function e(){if(!x.isDestructed){requestAnimationFrame(e);var t=x.clock.getElapsedTime();x.control.update();var r=(new o.Matrix4).multiplyMatrices(x.camera.projectionMatrix,x.camera.matrixWorldInverse),n=new o.Frustum;n.setFromMatrix((new o.Matrix4).multiplyMatrices(x.camera.projectionMatrix,x.camera.matrixWorldInverse));var i={camera:x.camera,pvmatrix:r,frustum:n,viewportSize:x.renderer.getSize(),currentTime:t};x.earthNode&&x.earthNode.animate(i),v()}}(),this.attachEffect=function(e,t){return x.threeContainer&&x.renderer?(x.effect=new e(x.renderer,t),x.effect&&x.effect.setSize(x.threeContainer.clientWidth,x.threeContainer.clientHeight),x.effect):(console.error("The renderer has not been initialized"),null)},this.updateScene=n,this.render=v}return i(e,[{key:"destruct",value:function(){var e=!0;return e=e&&this.earthNode.destruct(),this.earthNode=null,this.layers={},this.isInitialized=!1,this.layersReady=null,this.removeListeners(),this.control.destruct(),this.renderer.forceContextLoss(),this.renderer.context=null,this.renderer.domElement=null,this.renderer=null,this.isDestructed=!0,e}},{key:"addAltizureProjects",value:function(e,t){var r=this;t=t||{eventHandlers:{onEntityCreated:function(){r.updateScene(!1)},onEntityModelInitialized:function(){r.updateScene(!1)},onImportFinished:function(){},onError:function(e){console.error(e)}}};for(var n=[],i=0;i<e.length;i++){var o=void 0;if(e[i]instanceof g.default)o=e[i];else{o=new g.default;var a=e[i];o.id=a.id,o.name=a.name,o.views=a.views,o.owner={name:a.owner.name||"unknown",joined:a.owner.joined||"unknown"},o.date=a.date,o.geoInfo={autoAligned:a.geoInfo.autoAligned,minLat:a.geoInfo.minLat,minLong:a.geoInfo.minLong,maxLat:a.geoInfo.maxLat,maxLong:a.geoInfo.maxLong,centerLat:a.geoInfo.centerLat,centerLong:a.geoInfo.centerLong},o.cloudPath=a.cloudPath,o.versionControl=a.versionControl||"",o.modelTransform={origin:a.modelTransform.origin,xDir:a.modelTransform.xDir,yDir:a.modelTransform.yDir,zDir:a.modelTransform.zDir,minBound:a.modelTransform.minBound,maxBound:a.modelTransform.maxBound,xTiles:a.modelTransform.xTiles,yTiles:a.modelTransform.yTiles,zTiles:a.modelTransform.zTiles,floorHeight:a.modelTransform.floorHeight,onLoadTrans:a.modelTransform.onLoadTrans,lengthUnitToMeter:a.modelTransform.lengthUnitToMeter}}o.valid?n.push(o):console.warn("invalid project info",e[i])}var s={type:"custom",data:n};return this.layersReady.then(function(){return r.layers.altizureMesh.import(s,t)}).then(function(){return Promise.resolve()}).catch(function(e){return console.warn("addAltizureProject failed",e),Promise.resolve()})}},{key:"pickProject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=this.control.pickEarthContactPoint({rawX:e.x,rawY:e.y});if(r){var n=new o.Vector2(r.lng,r.lat),i=t,a=void 0;return this.visibleAltizureProjects().map(function(e){var t=new o.Vector2(e.geoInfo.centerLong,e.geoInfo.centerLat).distanceTo(n);t<i&&(i=t,a=e)}),a}}},{key:"visibleAltizureProjects",value:function(){return this.layers.altizureMesh.visibleAltizureProjects()}},{key:"animate",value:function(){}},{key:"accessoryLayer",get:function(){return this.layers.accessory}},{key:"earthSceneRoot",get:function(){return this.earthNode}},{key:"width",get:function(){return this.threeContainer.clientWidth}},{key:"height",get:function(){return this.threeContainer.clientHeight}},{key:"spotLights",get:function(){return[this._spotLight]}}],[{key:"scale",get:function(){return 1}},{key:"GeoCoord",get:function(){return v.default}},{key:"HyperClasses",get:function(){return{HyperLayer:l.default,HyperNode:s.default,PMatrix:u.default,EarthMath:p.default,CONSTANTS:{EarthResolution:m.default.EarthResolution,scale:e.scale,EARTH_RADIUS:p.default.EARTH_RADIUS,EQUATOR:p.default.EQUATOR}}}}]),e}();t.default=x},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=n(r(53)),a=n(r(103)),s=r(0),l=function(){function e(t,r){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.FOREST_CAPACITY=t.FOREST_CAPACITY,this.MAX_DOWNLOAD_CONCURRENCY=t.MAX_DOWNLOAD_CONCURRENCY,this.MIN_AREA=t.MIN_AREA,this.MAX_LEVEL=t.MAX_LEVEL,this.allowWorker=t.allowWorker,r=r||{},this.trees=r.trees,this.CACHE_CAPACITY=r.CACHE_CAPACITY,this.CACHE_CAPACITY<this.FOREST_CAPACITY+10&&(this.CACHE_CAPACITY=this.FOREST_CAPACITY+Math.min(100,Math.max(.4*this.FOREST_CAPACITY,10))),this.retriever=new a.default({cacheCapacity:this.CACHE_CAPACITY,dockCapacity:this.MAX_DOWNLOAD_CONCURRENCY,allowWorker:this.allowWorker})}return i(e,[{key:"destruct",value:function(){var e=!0;return this.trees=[],e=e&&this.retriever.destruct(),this.retriever=null,e}},{key:"clear",value:function(){this.trees=[],this.retriever.clear()}},{key:"add",value:function(e){var t=this._indexOf(e);return-1===t?(this.trees.push(e),!0):(console.warn("tree already exists",e,t),!1)}},{key:"remove",value:function(e){var t=this._indexOf(e);return-1!==t&&(this.trees.splice(t,1),!0)}},{key:"apply",value:function(e,t){for(var r=!0,n=0;n<this.trees.length;n++)r=e(this.trees[n],t)&&r;return r}},{key:"sceneUpdated",value:function(e){if(0===this.trees.length)return!0;var t=this._updateTree(e);return t||console.warn("_updateTree failed"),this._retrieveTiles().then(function(e){return Promise.resolve()}).catch(function(e){return console.error(e),Promise.resolve()}),t}},{key:"_updateTree",value:function(e){function t(e,t){if(!e.sceneGraphRoot||!e.sceneGraphRoot.matrixWorld)return 0;for(var o=0,a=e.sceneGraphRoot.matrixWorld.elements;o<a.length;o++)if(isNaN(a[o]))return 0;var s=t.screenArea(r,n,i,e.sceneGraphRoot);return t.ssArea=s,s}var r=e.camera,n=e.pvmatrix,i=e.frustum,a=!0,s=new o.default(function(e,t){return t.key-e.key});this.apply(function(e){a=e.traverse(e.root,function(e){return e.needsPrune=!0,!0})&&a;var r=e.root,n=t(e,r),i={node:r,tree:e};s.enqueue(n,i)});var l=0;do{if(l>=this.FOREST_CAPACITY)break;var u=s.dequeue(),c=u.key,h=u.value.node,f=u.value.tree;if(c<this.MIN_AREA)break;if(h.needsPrune=!1,h.level<this.MAX_LEVEL&&h.level<f.maxLevel&&!h.is404){0===h.nodes.length&&(a=f.expand(h)&&a);for(var d=0;d<h.nodes.length;d++){var p=h.nodes[d];p.needsPrune=!0;var m=t(f,p);m>0||p.setVisibility(!1),m>=this.MIN_AREA&&s.enqueue(m,{tree:f,node:p})}l+=4}}while(!s.isEmpty());return s.clear(),s=void 0,this.apply(function(e){a=e.traverse(e.root,function(t){return!t.needsPrune||e.prune(t)})&&a}),a}},{key:"_retrieveTiles",value:function(){function e(e,t){return r.retriever.request(e.PID,t,null).then(function(r){if(!t.expired){if(!t.loaded){if(!function(e){return e instanceof s.Mesh?void 0!==e.material||(console.warn("[Forest] material/map not ready",e.material),!1):(console.error("[Forest] Invalid mesh",e),!1)}(r))return console.error("request returns unexpected mesh",r),Promise.reject(new Error("Unexpected mesh"));t.setVisibility(t.visible),t.onLoaded(r),t.displayByload(e.sceneGraphRoot),e.flags.modelInitialized||e._onContentInitialized()}return Promise.resolve()}return Promise.resolve()}).catch(function(e){return"[Dock] abortPending"===e.message||"local data"===e||"local data"===e.message||"expired"===e||console.warn("[Network unstable] Forest._retrieveTiles",e),Promise.resolve()})}var t=this.retriever.abortPending(),r=this,n=new o.default(function(e,t){return t.key-e.key}),i=new o.default(function(e,t){return t.key-e.key});this.apply(function(e){var t=e.root.ssArea,r={tree:e,node:e.root};n.enqueue(t,r),i.enqueue(t,r)});for(var a=[];!n.isEmpty();){var l=n.dequeue(),u=e(l.value.tree,l.value.node);a.push(u)}for(;!i.isEmpty();)for(var c=i.dequeue(),h=c.value.tree,f=c.value.node.nodes,d=0;d<f.length;d++){var p=f[d],m=e(h,p);a.push(m),i.enqueue(p.ssArea,{tree:h,node:p})}return t.then(function(){return Promise.all(a)})}},{key:"_indexOf",value:function(e){return(Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1})(this.trees,e)}}]),e}();t.default=l},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),a=n(r(12)),s=n(r(21)),l=n(r(104)),u=n(r(115)),c="decoding error",h=!1,f=function(e){function t(e,r,n,i,o,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,n,i,o,a));return s.basepath=a.basepath,s.isMobile=a.isMobile,s._file_name="",s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),i(t,[{key:"fileName",value:function(){if(""===this._file_name){var e=this.options.info.tile_salt;this._file_name=a.default.MD5(this.name+e).toString(a.default.enc.Hex)}return this._file_name}},{key:"tileLoader",value:function(e){var t=this,r=this.fileName(),n={extendModel:!1,displayMode:0,needNormal:!0,isMobile:t.isMobile};return new Promise(function(e,n){function i(e,t){return e.substr(0,t.length)===t}var o=new XMLHttpRequest;o.open("GET",t.basepath+r+".ab",!0),o.timeout=6e4,o.responseType="arraybuffer",o.onreadystatechange=function(r){4===o.readyState&&(404===o.status||303===o.status?n("not found"):200===o.status?e(o.response):0===o.status||403===o.status?(console.warn("timeout or other network problem"),i(t.basepath,"http:")||i(t.basepath,"https:")||(console.log("local file load error"),n("not found")),n("local data")):(console.warn("download tile request fail",o.status),n("cannot load tile")))},o.ontimeout=function(){t.onError(10200,t.basepath+r+".ab"),n("request time out")},o.onerror=function(e){console.warn("request error",e),n("request error")},o.send()}).then(function(e){return t.trial++,function(e){return new Promise(function(i,o){t.eventQueue.add(t.tileDecoder,t,{aBuf:e,fn:r,loader_options:n},function(t){e=null,i(t)},function(t){e=null,o(t)},t.isMobile?20:10)})}(e)}).catch(function(e){return e===c&&t.trial<t.maxReloads?t.tileLoader():Promise.reject(e)})}},{key:"tileDecoder",value:function(e,t,r){var n=e.aBuf,i=e.fn,a=e.loader_options;return this.expired?(r("expired"),!1):((new u.default).parse(n,{robust:h},function(e){n=null;try{var s=e.readJSON(i+".txt");for(var u in s.urls)s.urls.hasOwnProperty(u)&&(function(e,t){return!(e.length<t.length)&&e.substr(-t.length)===t}(u,".aa")?s[u]=decodeURIComponent(escape(e.readText(u))):s[u]=decodeURIComponent(escape(e.readText(u+".aa"))));for(var f in s.materials)if(s.materials.hasOwnProperty(f)){var d=s.materials[f].map_Kd;d&&(s[d]=e.readImg(d))}e.clearData(),s.decodeParams||(a&&a.decodeParams?s.decodeParams=a.decodeParams:s.decodeParams=DEFAULT_DECODE_PARAMS),s.options=a,(new l.default).decodeModel(s).then(function(e){var n=e.children[0].children[0];return n.parent.parent.children=[],n.parent.parent=null,n.parent.children=[],n.parent=null,n instanceof o.Mesh?(t(n),!0):(console.warn("unknown mesh type",n),r("unknown mesh type"),!1)}).catch(function(e){return console.warn("decoding error",e),r(c),!1})}catch(e){return console.warn("decoding error",e),h=!0,r(c),!1}}),!1)}},{key:"onWorkerLoad",value:function(e){if(void 0===this.options)return Promise.reject("expired");e.filename!==this.fileName()&&console.error("MeshTile > decode callback mismatch");var t={extendModel:!1,displayMode:0,needNormal:!0,isMobile:this.isMobile};this.trial++;var r=e.status;if(200===r){var n=e.pixels,i=e.width,o=e.height,a=new u.default;return a.parseBundle(n,i,o,{}),this.decodeTile(a,t)}return 404===r||403===r||303===r?Promise.reject("not found"):0===r?(this.onError(10200,e.filename),Promise.reject("local data")):(console.warn(e,r),Promise.reject("cannot load tile"))}},{key:"decodeTile",value:function(e,t){var r=this,n=this.fileName();return new Promise(function(i,a){if(r.expired)return a("expired"),!1;try{var s=e.readJSON(n+".txt");for(var u in s.urls)s.urls.hasOwnProperty(u)&&(function(e,t){return!(e.length<t.length)&&e.substr(-t.length)===t}(u,".aa")?s[u]=decodeURIComponent(escape(e.readText(u))):s[u]=decodeURIComponent(escape(e.readText(u+".aa"))));for(var f in s.materials)if(s.materials.hasOwnProperty(f)){var d=s.materials[f].map_Kd;d&&(s[d]=e.readImg(d))}e.clearData(),s.decodeParams||(t&&t.decodeParams?s.decodeParams=t.decodeParams:s.decodeParams=DEFAULT_DECODE_PARAMS),s.options=t,(new l.default).decodeModel(s).then(function(e){var t=e.children[0].children[0];return t.parent.parent.children=[],t.parent.parent=null,t.parent.children=[],t.parent=null,t instanceof o.Mesh?(i(t),!0):(console.warn("unknown mesh type",t),a("unknown mesh type"),!1)}).catch(function(e){return console.warn("decoding error",e),a(c),!1})}catch(e){return console.warn("decoding error",e),h=!0,a(c),!1}})}},{key:"tileLoaderTest",value:function(e){return Promise.resolve(function(e){var t=new o.BoxGeometry(1,1,1);t.vertices[0]=e.boundingBox[6].clone(),t.vertices[1]=e.boundingBox[2].clone(),t.vertices[2]=e.boundingBox[5].clone(),t.vertices[3]=e.boundingBox[1].clone(),t.vertices[4]=e.boundingBox[3].clone(),t.vertices[5]=e.boundingBox[7].clone(),t.vertices[6]=e.boundingBox[0].clone(),t.vertices[7]=e.boundingBox[4].clone();var r=new o.MeshPhongMaterial({color:function(e){var t=1e4*Math.sin(e++);return 16777215*(t-Math.floor(t))}(e.level+e.x+e.y),flatShading:!0});return new o.Mesh(t,r)}(this))}}]),t}();t.default=f},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=n(r(21)),a=n(r(9)),s=function(e,t,r,n,i,a){o.default.call(this,e,t,r,n,i,a),this.basepath=a.basepath,this.length_unit_to_meter=a.info.length_unit_to_meter};(s.prototype=Object.create(o.default.prototype)).constructor=s,s.prototype.getModel=function(){return this.name},s.prototype.getJsName=function(){return this.basepath+this.getModel()+".json"},s.prototype.tileLoader=function(){var e,t,r=this;return t={url:r.getJsName(),timeout:3e4},new Promise(function(n,o){(0,a.default)({method:"get",url:t.url,timeout:t.timeout}).then(function(t){var a=t.data,s=a.length;0===s&&o(new Error("empty"));for(var l=new i.BufferGeometry,u=new Float32Array(3*s),c=new Float32Array(3*s),h=a.length-1;h>=0;h--)for(var f=a[h][0],d=a[h][1],p=0;p<3;p++)u[3*h+p]=f[p]/r.length_unit_to_meter,c[3*h+p]=d[p]/256;l.addAttribute("position",new i.BufferAttribute(u,3)),l.addAttribute("color",new i.BufferAttribute(c,3)),l.boundingSphere=null;var m=new i.PointsMaterial({vertexColors:!0,size:3,sizeAttenuation:!1});(e=new i.Points(l,m)).name=r.name,n(e)}).catch(function(e){console.warn(e),o(e)})})},t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r(3)),o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"longGang",value:function(e,t,r){this.center={lng:0,lat:0},this.bbox={maxLat:0,minLat:0,maxLng:0,minLng:0};var n=i.default.degreeGeographicToWebMercator(e.lng,e.lat),o=[n[0]+t[0],n[1]+t[1]],a=i.default.webMercatorToDegreeGeographic(o[0],o[1]);this.center.lng=a[0],this.center.lat=a[1];var s=i.default.webMercatorXToDegreeLog(o[0]+r.max_bound[0]),l=i.default.webMercatorXToDegreeLog(o[0]+r.min_bound[0]),u=i.default.webMercatorYToDegreeLat(o[1]+r.max_bound[1]),c=i.default.webMercatorYToDegreeLat(o[1]+r.min_bound[1]);return{center:{lng:a[0],lat:a[1]},bbox:{maxLng:s,minLng:l,maxLat:u,minLat:c}}}}]),e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.promiseFn=t.promiseFn,this.timer=t.timer,this.timeout=t.timeout,void 0!==t.promiseFn&&void 0!==this.timer&&void 0!==this.timeout?(this.processingTask=null,this.deferredTask=null,this.debug=t.debug||!1,this._running=null):console.error("RefreshQueue invalid construction.",t)}return n(e,[{key:"add",value:function(e){var t=this;null===this.processingTask?(this.processingTask=e,null!==this._running?this._running.then(function(){t._running=t._run()}):this._running=this._run()):null===this.deferredTask?this.deferredTask=e:null!==this.deferredTask?this.deferredTask=e:console.warn("RefreshQueue.add(): unknown condition")}},{key:"_run",value:function(){var e=this.debug;if(null===this.processingTask)return e&&console.log("no processingTask"),this._running=null,Promise.resolve();var t=this;return function(e,t){return Promise.race([e,new Promise(function(e,r){setTimeout(function(){r(new Error("Refresh task time out "+t))},t)})])}(this.promiseFn(this.processingTask),t.timeout).catch(function(r){return e&&console.warn("refresh task failed:",t.processingTask,r),Promise.resolve()}).then(function(){return t.processingTask=t.deferredTask,t.deferredTask=null,function(e){return new Promise(function(t,r){setTimeout(function(){t()},e)})}(t.timer)}).then(function(){return t._run()})}}]),e}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i={uniforms:n.UniformsUtils.merge([n.UniformsLib.fog,{normalSampler:{type:"t",value:null},mirrorSampler:{type:"t",value:null},alpha:{type:"f",value:1},time:{type:"f",value:0},distortionScale:{type:"f",value:20},noiseScale:{type:"f",value:1},textureMatrix:{type:"m4",value:new n.Matrix4},sunColor:{type:"c",value:new n.Color(8355711)},sunDirection:{type:"v3",value:new n.Vector3(.70707,.70707,0)},eye:{type:"v3",value:new n.Vector3(0,0,0)},waterColor:{type:"c",value:new n.Color(5592405)},cropMask:{type:"t",value:null},useMask:{type:"b",value:!1}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec3 worldPosition;","varying vec3 modelPosition;","varying vec3 surfaceX;","varying vec3 surfaceY;","varying vec3 surfaceZ;","varying vec2 vUv;","void main()","{","  mirrorCoord = modelMatrix * vec4(position, 1.0);","  worldPosition = mirrorCoord.xyz;","  modelPosition = position;","  surfaceX = vec3( modelMatrix[0][0], modelMatrix[0][1], modelMatrix[0][2]);","  surfaceY = vec3( modelMatrix[1][0], modelMatrix[1][1], modelMatrix[1][2]);","  surfaceZ = vec3( modelMatrix[2][0], modelMatrix[2][1], modelMatrix[2][2]);","  vUv = uv;","  mirrorCoord = textureMatrix * mirrorCoord;","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float distortionScale;","uniform float noiseScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec3 worldPosition;","varying vec3 modelPosition;","varying vec3 surfaceX;","varying vec3 surfaceY;","varying vec3 surfaceZ;","varying vec2 vUv;","uniform sampler2D cropMask;","uniform bool useMask;","void sunLight(const vec3 surfaceNormal, const vec3 eyeDirection, in float shiny, in float spec, in float diffuse, inout vec3 diffuseColor, inout vec3 specularColor)","{","  vec3 reflection = normalize(reflect(-sunDirection, surfaceNormal));","  float direction = max(0.0, dot(eyeDirection, reflection));","  specularColor += pow(direction, shiny) * sunColor * spec;","  diffuseColor += max(dot(sunDirection, surfaceNormal), 0.0) * sunColor * diffuse;","}","vec3 getNoise(in vec2 uv)","{","  vec2 uv0 = uv / (103.0 * noiseScale) + vec2(time / 17.0, time / 29.0);","  vec2 uv1 = uv / (107.0 * noiseScale) - vec2(time / -19.0, time / 31.0);","  vec2 uv2 = uv / (vec2(8907.0, 9803.0) * noiseScale) + vec2(time / 101.0, time /   97.0);","  vec2 uv3 = uv / (vec2(1091.0, 1027.0) * noiseScale) - vec2(time / 109.0, time / -113.0);","  vec4 noise = texture2D(normalSampler, uv0) +","    texture2D(normalSampler, uv1) +","    texture2D(normalSampler, uv2) +","    texture2D(normalSampler, uv3);","  return noise.xyz * 0.5 - 1.0;","}",n.ShaderChunk.common,n.ShaderChunk.fog_pars_fragment,"void main()","{","  vec3 worldToEye = eye - worldPosition;","  vec3 eyeDirection = normalize(worldToEye);","  if (useMask) {","    vec2 os_uv = vec2(vUv.x, 1.0 - vUv.y);","    float mask_val = texture2D(cropMask, os_uv).y;","    if(mask_val < 0.05) {","      discard;","    }","  }","  vec3 noise = getNoise(modelPosition.xy * 1.0);","  vec3 distordCoord = noise.x * surfaceX + noise.y * surfaceY;","  vec3 distordNormal = distordCoord + surfaceZ;","  if(dot(eyeDirection, surfaceZ) < 0.0)","    distordNormal = distordNormal * -1.0;","  vec3 diffuseLight = vec3(0.0);","  vec3 specularLight = vec3(0.0);","  sunLight(distordNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight);","  float distance = length(worldToEye);","  vec2 distortion = distordCoord.xy * distortionScale * sqrt(distance) * 0.07;"," vec3 mirrorDistord = mirrorCoord.xyz + vec3(distortion.x, distortion.y, 1.0);"," vec3 reflectionSample = texture2DProj(mirrorSampler, mirrorDistord).xyz;","  float theta = max(dot(eyeDirection, distordNormal), 0.0);","  float reflectance = 0.3 + (1.0 - 0.3) * pow((1.0 - theta), 3.0);","  vec3 scatter = max(0.0, dot(distordNormal, eyeDirection)) * waterColor;","  vec3 albedo = mix(sunColor * diffuseLight * 0.3 + scatter, (vec3(0.1) + reflectionSample * 0.9 + reflectionSample * specularLight), reflectance);"," vec3 outgoingLight = albedo;",n.ShaderChunk.fog_fragment," gl_FragColor = vec4( outgoingLight, alpha );","}"].join("\n")},o=function(e,t,r,o){function a(e,t){return void 0!==e?e:t}n.Object3D.call(this),this.name="water_"+this.id,o=o||{},this.matrixNeedsUpdate=!0;var s=a(o.textureWidth,512),l=a(o.textureHeight,512);this.clipBias=a(o.clipBias,-1e-4),this.alpha=a(o.alpha,1),this.time=a(o.time,0),this.normalSampler=a(o.waterNormals,null),this.sunDirection=a(o.sunDirection,new n.Vector3(.70707,.70707,0)),this.sunColor=new n.Color(a(o.sunColor,16777215)),this.waterColor=new n.Color(a(o.waterColor,8355711)),this.eye=a(o.eye,new n.Vector3(0,0,0)),this.distortionScale=a(o.distortionScale,20),this.noiseScale=a(o.noiseScale,1),this.side=a(o.side,n.FrontSide),this.fog=a(o.fog,!1),this.renderer=e,this.scene=r,this.mirrorPlane=new n.Plane,this.normal=new n.Vector3(0,0,1),this.cameraWorldPosition=new n.Vector3,this.rotationMatrix=new n.Matrix4,this.lookAtPosition=new n.Vector3(0,0,-1),this.clipPlane=new n.Vector4,this.cropMask=a(o.cropMask,null),this.useMask=null!==this.cropMask,t instanceof n.PerspectiveCamera?this.camera=t:(this.camera=new n.PerspectiveCamera,console.log(this.name+": camera is not a Perspective Camera!")),this.textureMatrix=new n.Matrix4,this.mirrorCamera=this.camera.clone(),this.texture=new n.WebGLRenderTarget(s,l),this.tempTexture=new n.WebGLRenderTarget(s,l);var u=i,c=n.UniformsUtils.clone(u.uniforms);this.material=new n.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:c,transparent:!0,side:this.side,fog:this.fog}),this.mesh=new n.Object3D,this.material.uniforms.mirrorSampler.value=this.texture.texture,this.material.uniforms.textureMatrix.value=this.textureMatrix,this.material.uniforms.alpha.value=this.alpha,this.material.uniforms.time.value=this.time,this.material.uniforms.normalSampler.value=this.normalSampler,this.material.uniforms.sunColor.value=this.sunColor,this.material.uniforms.waterColor.value=this.waterColor,this.material.uniforms.sunDirection.value=this.sunDirection,this.material.uniforms.distortionScale.value=this.distortionScale,this.material.uniforms.noiseScale.value=this.noiseScale,this.material.uniforms.eye.value=this.eye,this.material.uniforms.cropMask.value=this.cropMask,this.material.uniforms.useMask.value=this.useMask,n.Math.isPowerOfTwo(s)&&n.Math.isPowerOfTwo(l)||(this.texture.generateMipmaps=!1,this.tempTexture.generateMipmaps=!1)};(o.prototype=Object.create(n.Object3D.prototype)).setMask=function(e){this.material.uniforms.cropMask.value=e,this.material.uniforms.useMask.value=null!==e},o.prototype.setCamera=function(e){console.warn("Water setCamera"),this.camera=e,this.mirrorCamera=this.camera.clone(),this.updateTextureMatrix()},o.prototype.renderWithMirror=function(e){this.updateTextureMatrix(),this.matrixNeedsUpdate=!1;var t=e.camera;e.camera=this.mirrorCamera,e.render(!0),this.render(),this.matrixNeedsUpdate=!0,e.camera=t,e.updateTextureMatrix()},o.prototype.updateTextureMatrix=function(){function e(e){return e?e<0?-1:1:0}void 0!==this.parent&&(this.mesh=this.parent),this.updateMatrixWorld(),this.camera.updateMatrixWorld(),this.cameraWorldPosition.setFromMatrixPosition(this.camera.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal=new n.Vector3(0,0,1).applyEuler(this.mesh.rotation);var t=this.camera.position.clone().sub(this.mesh.position);if(this.normal.dot(t)<0){var r=new n.Vector3(0,0,1).applyEuler(this.mesh.rotation);this.normal.reflect(r)}var i=this.mesh.position.clone().sub(this.cameraWorldPosition);i.reflect(this.normal).negate(),i.add(this.mesh.position),this.rotationMatrix.extractRotation(this.camera.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition);var o=this.mesh.position.clone().sub(this.lookAtPosition);o.reflect(this.normal).negate(),o.add(this.mesh.position),this.up.set(0,-1,0),this.up.applyMatrix4(this.rotationMatrix),this.up.reflect(this.normal).negate(),this.mirrorCamera.near=1,this.mirrorCamera.far=1e5,this.mirrorCamera.position.copy(i),this.mirrorCamera.up=this.up,this.mirrorCamera.lookAt(o),this.mirrorCamera.aspect=this.camera.aspect,this.mirrorCamera.updateProjectionMatrix(),this.mirrorCamera.updateMatrixWorld(),this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix),this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse),this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,this.mesh.position),this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse),this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);var a=new n.Vector4,s=this.mirrorCamera.projectionMatrix;a.x=(e(this.clipPlane.x)+s.elements[8])/s.elements[0],a.y=(e(this.clipPlane.y)+s.elements[9])/s.elements[5],a.z=-1,a.w=(1+s.elements[10])/s.elements[14];var l=new n.Vector4;l=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(a)),s.elements[2]=l.x,s.elements[6]=l.y,s.elements[10]=l.z+1-this.clipBias,s.elements[14]=l.w;var u=new n.Vector3;u.setFromMatrixPosition(this.camera.matrixWorld),this.eye=u,this.material.uniforms.eye.value=this.eye},o.prototype.render=function(e){if(this.matrixNeedsUpdate&&this.updateTextureMatrix(),this.matrixNeedsUpdate=!0,void 0!==this.scene&&this.scene instanceof n.Scene){this.material.visible=!1;var t=void 0!==e&&e?this.tempTexture:this.texture;!0!==this.renderer.autoClear&&this.renderer.clearTarget(t,!0,!0,!0),this.renderer.render(this.scene,this.mirrorCamera,t,!0),this.material.visible=!0,this.material.uniforms.mirrorSampler.value=t.texture}},o.prototype.getMirrorCamera=function(e){var t=void 0!==e&&e?this.tempTexture:this.texture;this.renderer.render(this.scene,this.mirrorCamera,t,!0);var r=this.renderer.getContext(),n=t.width,i=t.height,o=new Uint8Array(n*i*4);r.readPixels(0,0,n,i,r.RGBA,r.UNSIGNED_BYTE,o);var a={mirrorCamera:this.mirrorCamera,renderTexture:t,imgArray:o};return console.log("water res",a),a},t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),o=function(e){return e&&e.__esModule?e:{default:e}}(r(17)),a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.projectTree=e.tree,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"resetMask",value:function(){var e=this;e.reset(function(t){e.edit&&e.updateSelectioinMask(t,!0),e.updateSelectioinMask(t,!1)},"white")}},{key:"initMask",value:function(e,t){var r=this;this.init(e,function(){r.isDebug&&console.log("init crop mask",e),t&&t(),r.update(!0),r.update(!1),r.edit||(r.curMaskRGB=[])},function(){t&&t(),console.log("Failed to init crop mask!"),r.edit?r.resetMask():r.curMaskRGB=[]})}},{key:"workerInitMask",value:function(e){var t=this.maskSize,r=this.maskSize;if(!0===this.edit||void 0!==e.texData&&null!==e.texData){if(this.edit){this.cntWhite=e.cntWhite;var n=e.rgba;void 0===n&&(n=new Uint8ClampedArray(t*r*4).fill(255)),this.curMaskRGB.set(n),this.preMaskRGB.set(n),this.acumulate_poly_num=e.pack_mask.poly_num;var o=this.orthoCanvas.getContext("2d"),a=o.createImageData(t,r);a.data.set(this.curMaskRGB),o.putImageData(a,0,0),this.removePolygons(),this._debugVisualizeMask(),this.updateMaskInfo(e)}if(this.projectTree){var s=new i.DataTexture(e.texData,t,r,i.RGBAFormat,i.UnsignedByteType);s.needsUpdate=!0,this.projectTree.updateOrthoSelectionMask(this.orthoInfo,s,!1),this.edit||(e.texData=[],e.rgb=[],e.pack_mask.data=[],e=void 0)}}}},{key:"updateSelectioinMask",value:function(e,t){if(e&&e.length>0){var r=this;r.updateOrthoInfo();var n=r.maskToTexture(e),i=r.projectTree;i?i.updateOrthoSelectionMask(r.orthoInfo,n,t):console.log("project tree invalid!!!")}else console.log("mask data is not valid")}},{key:"update",value:function(e){e?this.edit&&(this.updateSelectioinMask(this.preMaskRGB,!1),this.updateSelectioinMask(this.curMaskRGB,!0)):(this.edit&&this.updateSelectioinMask(this.curMaskRGB,!0),this.updateSelectioinMask(this.curMaskRGB,!1))}},{key:"apply",value:function(){var e=this,t=this.polygons;this.applyPolygon(t,function(){e.update(!1)})}}]),t}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(e,t){function r(e){y.debug&&e!==y.recognizerState&&console.log("RecognizerState =>",e),y.recognizerState=e}function i(e){return{identifier:e.identifier,pageX:e.pageX,pageY:e.pageY}}function o(e){for(var t={touches:[]},r=0;r<e.touches.length;++r)t.touches.push(i(e.touches[r]));return t.type=e.type,t}function a(e){for(;y.recognizerStateQueue.length>=y.thresholds.gestureQueueLength;)y.recognizerStateQueue.shift();y.recognizerStateQueue.push(e),y.debug&&console.log(y.recognizerStateQueue)}function s(){y.recognizerStateQueue=[]}function l(e){if(y.recognizerStateQueue.length!==y.thresholds.gestureQueueLength)return!1;for(var t=0,r=0;r<y.recognizerStateQueue.length;++r)y.recognizerStateQueue[r]===e&&(t+=1);return t/y.thresholds.gestureQueueLength>=y.thresholds.gestureConsistency}function u(e){if(y.debug&&console.log("onTouchStart"),y.rawTouchDebug&&console.log(e),!1!==y.enabled)switch(!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)&&e.preventDefault(),y.domElement.addEventListener("touchend",h,!1),y.domElement.addEventListener("touchmove",c,!1),y.debug&&console.log(y.recognizerState),f=0,d=Date.now(),m=o(e),e.touches.length){case 1:r(y.recognizerState===g.TOBETAP?g.TOBEDOUBLETAP:g.TOUCHSTART);break;case 2:if(y.recognizerState===g.NONE)r(g.TOUCHSTART),s();else if(y.recognizerState===g.DRAGGING){r(g.TOUCHSTART),s();var t={type:"drag-end"};t.touchEvent=e,y.dispatchEvent(t)}}}function c(e){if(y.debug&&console.log("onTouchMove"),y.rawTouchDebug&&console.log(e),!1!==y.enabled){e.preventDefault(),e.stopPropagation(),f+=1;var t=Date.now();if(p>1e3/60)return y.debug&&console.log("skip the events",p),p=0,void(d=t);switch(e.touches.length){case 1:if(y.recognizerState===g.TOUCHSTART){if(a(g.TOBEDRAG),l(g.TOBEDRAG)){r(g.DRAGSTART);var i={type:"drag-start"};i.touchEvent=null===v?m:v,y.dispatchEvent(i)}}else if(y.recognizerState===g.TOBEDOUBLETAP&&(a(g.TOBEDRAG),l(g.TOBEDRAG))){r(g.DBLTAPDRAGSTART);var s={type:"dbltap-drag-start"};s.touchEvent=null===v?m:v,y.dispatchEvent(s)}if(y.recognizerState===g.DRAGSTART||y.recognizerState===g.DRAGGING){r(g.DRAGGING);var u={type:"drag"};u.touchEvent=e,y.dispatchEvent(u)}else if(y.recognizerState===g.DBLTAPDRAGSTART||y.recognizerState===g.DBLTAPDRAGGING){r(g.DBLTAPDRAGGING);var c={type:"dbltap-drag"};c.touchEvent=e,y.dispatchEvent(c)}break;case 2:if(y.recognizerState===g.TOUCHSTART||y.recognizerState===g.TOBEROTATE||y.recognizerState===g.TOBEPINCH||y.recognizerState===g.TOBETWOFINGERSWEEP){for(var h=[new n.Vector2,new n.Vector2],_=[new n.Vector2,new n.Vector2],w=0;w<2;++w)h[w].set(m.touches[w].pageX,m.touches[w].pageY);for(var b=0;b<2;++b)_[b].set(e.touches[b].pageX,e.touches[b].pageY);for(var x=[new n.Vector2,new n.Vector2],k=0;k<2;++k)x[k].subVectors(_[k],h[k]);var A=[new n.Vector2,new n.Vector2];A[0].subVectors(h[1],h[0]),A[1].subVectors(h[0],h[1]);var M=[new n.Vector2,new n.Vector2];M[0].subVectors(_[1],_[0]),M[1].subVectors(_[0],_[1]);var S=A[0].length()*M[0].length(),P=A[0].dot(M[0])/S,T=new n.Vector3(A[0].x,A[0].y,0),O=new n.Vector3(M[0].x,M[0].y,0),C=T.cross(O).z/S,E=Math.atan2(C,P),I=Math.abs(M[0].length()-A[0].length()),R=Math.abs(A[0].length()*E);if(y.debug&&(console.log("last",h,"current",_,"delta",x),console.log("dir-angle",180*E/Math.PI,"scale-delta",I,"rotate-delta",R)),I-R>y.thresholds.twoFingerSweepTorlerance||I>R&&R>y.thresholds.twoFingerSweepTorlerance){for(var L=I;L>y.thresholds.twoFingerSweepTorlerance;)a(g.TOBEPINCH),L-=y.thresholds.twoFingerSweepTorlerance;if(l(g.TOBEPINCH)){r(g.PINCHSTART),m=null===v?m:v;var j={type:"pinch-start",scale:1,rotation:0},z=new n.Vector2;z.addVectors(h[0],h[1]),z.multiplyScalar(.5),j.center={pageX:z.x,pageY:z.y},j.deltaTime=1e3/60,j.touchEvent=m,j.deltaX=0,j.deltaY=0,y.dispatchEvent(j),j.type="pinchrotate-start",y.dispatchEvent(j)}}else if(R-I>y.thresholds.twoFingerSweepTorlerance||I<R&&I>y.thresholds.twoFingerSweepTorlerance){for(var B=R;B>y.thresholds.twoFingerSweepTorlerance;)a(g.TOBEROTATE),B-=y.thresholds.twoFingerSweepTorlerance;if(l(g.TOBEROTATE)){r(g.ROTATESTART);var D={type:"rotate-start",scale:1,rotation:0},N=new n.Vector2;N.addVectors(h[0],h[1]),N.multiplyScalar(.5),D.center={pageX:N.x,pageY:N.y},D.deltaTime=1e3/60,D.touchEvent=m,D.deltaX=0,D.deltaY=0,y.dispatchEvent(D),D.type="pinchrotate-start",y.dispatchEvent(D)}}else if(x[0].y*x[1].y>0&&Math.abs(x[0].y)>y.thresholds.twoFingerSweepOffset&&Math.abs(x[1].y)>y.thresholds.twoFingerSweepOffset){for(var U=.5*(Math.abs(x[0].y)+Math.abs(x[1].y));U>y.thresholds.twoFingerSweepOffset;)a(g.TOBETWOFINGERSWEEP),U-=y.thresholds.twoFingerSweepOffset;if(l(g.TOBETWOFINGERSWEEP)){r(g.TWOFINGERSWEEPSTART);var F={type:"twofingersweep-start",scale:1,rotation:0},H=new n.Vector2;H.addVectors(h[0],h[1]),H.multiplyScalar(.5),F.center={pageX:H.x,pageY:H.y},F.deltaTime=1e3/60,F.touchEvent=m,F.deltaX=0,F.deltaY=0,y.dispatchEvent(F)}}else a(g.TOUCHSTART)}if(y.recognizerState===g.TWOFINGERSWEEPSTART||y.recognizerState===g.TWOFINGERSWEEP){r(g.TWOFINGERSWEEP);for(var V=[new n.Vector2,new n.Vector2],W=0;W<2;++W)V[W].set(e.touches[W].pageX,e.touches[W].pageY);var G={type:"twofingersweep",scale:1,rotation:0},Y=new n.Vector2;Y.addVectors(V[0],V[1]),Y.multiplyScalar(.5),G.center={pageX:Y.x,pageY:Y.y},G.deltaTime=1e3/60,G.touchEvent=e,G.deltaX=0,G.deltaY=0,y.dispatchEvent(G)}else if(y.recognizerState===g.PINCHSTART||y.recognizerState===g.PINCH){for(var K=[new n.Vector2,new n.Vector2],X=0;X<2;++X)K[X].set(m.touches[X].pageX,m.touches[X].pageY);r(g.PINCH);for(var Z=[new n.Vector2,new n.Vector2],q=0;q<2;++q)Z[q].set(e.touches[q].pageX,e.touches[q].pageY);var Q={type:"pinch"},J=new n.Vector2;J.subVectors(K[1],K[0]);var $=new n.Vector2;$.subVectors(Z[1],Z[0]);var ee=J.length(),te=$.length(),re=J.dot($)/(ee*te),ne=new n.Vector3(J.x,J.y,0),ie=new n.Vector3($.x,$.y,0),oe=ne.cross(ie).z/(ee*te);Q.scale=te/ee,Math.abs(ee)<1e-7&&(Q.scale=1),Q.rotation=180*Math.atan2(oe,re)/Math.PI;var ae=new n.Vector2;ae.addVectors(Z[0],Z[1]),ae.multiplyScalar(.5),Q.center={pageX:ae.x,pageY:ae.y},Q.deltaTime=1e3/60,Q.touchEvent=e,Q.deltaX=0,Q.deltaY=0,y.dispatchEvent(Q),Q.type="pinchrotate",y.dispatchEvent(Q)}else if(y.recognizerState===g.ROTATESTART||y.recognizerState===g.ROTATE){for(var se=[new n.Vector2,new n.Vector2],le=0;le<2;++le)se[le].set(m.touches[le].pageX,m.touches[le].pageY);r(g.ROTATE);for(var ue=[new n.Vector2,new n.Vector2],ce=0;ce<2;++ce)ue[ce].set(e.touches[ce].pageX,e.touches[ce].pageY);var he={type:"rotate"},fe=new n.Vector2;fe.subVectors(se[1],se[0]);var de=new n.Vector2;de.subVectors(ue[1],ue[0]);var pe=fe.length(),me=de.length(),ve=fe.dot(de)/(pe*me),ge=new n.Vector3(fe.x,fe.y,0),ye=new n.Vector3(de.x,de.y,0),_e=ge.cross(ye).z/(pe*me);he.scale=me/pe,Math.abs(pe)<1e-7&&(he.scale=1),he.rotation=180*Math.atan2(_e,ve)/Math.PI;var we=new n.Vector2;we.addVectors(ue[0],ue[1]),we.multiplyScalar(.5),he.center={pageX:we.x,pageY:we.y},he.deltaTime=1e3/60,he.touchEvent=e,he.deltaX=0,he.deltaY=0,y.dispatchEvent(he),he.type="pinchrotate",y.dispatchEvent(he)}break;default:y.debug&&console.log(e)}v=o(e),p=Date.now()-t,y.debug&&console.log("touchMove",d,"ms")}}function h(e){if(y.debug&&console.log("onTouchEnd"),y.rawTouchDebug&&console.log(e),!1!==y.enabled){y.debug&&console.log(f),y.debug&&console.log(y.handlers),y.debug&&console.log(e),y.debug&&console.log(m),y.debug&&console.log(y.recognizerState);var t=Date.now();if(y.recognizerState===g.TWOFINGERSWEEP){r(g.NONE),s();var n={type:"twofingersweep-end"};n.touchEvent=v,y.dispatchEvent(n)}else if(y.recognizerState===g.ROTATE){r(g.NONE),s();var i={type:"rotate-end"};i.touchEvent=v,y.dispatchEvent(i),i.type="pinchrotate-end",y.dispatchEvent(i)}if(y.recognizerState===g.PINCH){r(g.NONE),s();var o={type:"pinch-end"};o.touchEvent=v,y.dispatchEvent(o),o.type="pinchrotate-end",y.dispatchEvent(o)}else switch(m.touches.length){case 1:if(0===f){if(t-d>y.thresholds.singleTapTimeout){r(g.NONE),y.debug&&console.log("Cancel a tap because it is hold for too long");break}if(y.recognizerState!==g.TOBEDOUBLETAP)y.debug&&console.log("first Tapping"),r(g.TOBETAP),setTimeout(function(){var e=m;return function(){if(y.recognizerState===g.TOBETAP){r(g.TAP);var t={type:"tap"};t.touchEvent=e,y.dispatchEvent(t),r(g.NONE)}}}(),y.thresholds.doubleTapTimeout);else{y.debug&&console.log("second Tapping"),r(g.DOUBLETAP);var a={type:"double-tap"};a.touchEvent=m,y.dispatchEvent(a),r(g.NONE)}}else if(y.recognizerState===g.DRAGGING){r(g.NONE),s();var l={type:"drag-end"};l.touchEvent=e,y.dispatchEvent(l)}else if(y.recognizerState===g.DBLTAPDRAGGING){r(g.NONE),s();var u={type:"dbltap-drag-end"};u.touchEvent=e,y.dispatchEvent(u)}}f=-1,m=null,v=null,y.domElement.removeEventListener("touchend",h,!1),y.domElement.removeEventListener("touchmove",c,!1)}}if(void 0!==e){(t=t||{}).handlers=t.handlers||{},t.thresholds=t.thresholds||{},this.domElement=e,this.enabled=!0,this.debug=t.debug||!1,this.rawTouchDebug=!1,this.handlers={tap:t.handlers.tap||null,"double-tap":t.handlers["double-tap"]||null,"drag-start":t.handlers["drag-start"]||null,drag:t.handlers.drag||null,"drag-end":t.handlers["drag-end"]||null,"pinch-start":t.handlers["pinch-start"]||null,pinch:t.handlers.pinch||null,"pinch-end":t.handlers["pinch-end"]||null,"rotate-start":t.handlers["rotate-start"]||null,rotate:t.handlers.rotate||null,"rotate-end":t.handlers["rotate-end"]||null,"twofingersweep-start":t.handlers["twofingersweep-start"]||null,twofingersweep:t.handlers.twofingersweep||null,"twofingersweep-end":t.handlers["twofingersweep-end"]||null},this.thresholds={doubleTapTimeout:void 0===t.thresholds.doubleTapTimeout?500:t.thresholds.doubleTapTimeout,singleTapTimeout:250,holdTapTimeout:600,twoFingerSweepTorlerance:4,twoFingerSweepOffset:void 0===t.thresholds.twoFingerSweepOffset?2:t.thresholds.twoFingerSweepOffset,gestureQueueLength:void 0===t.thresholds.gestureQueueLength?3:t.thresholds.gestureQueueLength,gestureConsistency:void 0===t.thresholds.gestureConsistency?.66:t.thresholds.gestureConsistency},this.thresholds.twoFingerSweepOffset=Math.max(1,this.thresholds.twoFingerSweepOffset),this.thresholds.twoFingerSweepTorlerance=Math.max(1,this.thresholds.twoFingerSweepTorlerance),this.debug&&console.log("Init recognizer",this.handlers,this.thresholds);var f=-1,d=0,p=0,m=null,v=null,g={NONE:-1,TOUCHSTART:0,TOBETAP:1,TOBEDOUBLETAP:2,TAP:3,DOUBLETAP:4,TOBEDRAG:10,DRAGSTART:11,DRAGGING:12,DRAGEND:13,TOBEPINCH:20,PINCHSTART:21,PINCH:22,PINCHEND:22,TOBEROTATE:30,ROTATESTART:31,ROTATE:32,ROTATEEND:33,TOBETWOFINGERSWEEP:40,TWOFINGERSWEEPSTART:41,TWOFINGERSWEEP:42,TWOFINGERSWEEPEND:43,DBLTAPDRAGSTART:51,DBLTAPDRAGGING:52,DBLTAPDRAGEND:53};this.recognizerState=g.NONE,this.recognizerStateQueue=[];var y=this;y.domElement.addEventListener("touchstart",u,!1),this.removeListeners=function(){y.domElement.removeEventListener("touchstart",u,!1)}}else console.error("Invalid domElement")};(i.prototype=Object.create(n.EventDispatcher.prototype)).constructor=i,i.prototype.destruct=function(){return this.removeListeners(),!0},t.default=i},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n},a=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0},s=n(r(48)),l=n(r(3)),u=n(r(88)),c=r(0),h=Math.PI/180,f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r._mat=new c.Matrix4,r._anchor=new c.Vector3,r._orbitSphDelta=new c.Spherical(0,0,0),r._swirlSphDelta=new c.Spherical(0,0,0),r.needsApplyDelta=!1,r.matNeedsUpdate=!1,r.poseNeedsUpdate=!1;var n=Object.assign({},{earth_scale:1,EARTH_RESOLUTION:6,minTilt:10,maxTilt:40,minNorth:0,maxNorth:360,minAlt:.1,maxAlt:2*l.default.EARTH_RADIUS},e);return r.earth_scale=n.earth_scale,r.EARTH_RESOLUTION=n.EARTH_RESOLUTION,r._minTilt=n.minTilt,r._maxTilt=n.maxTilt,r._minAlt=n.minAlt,r._maxAlt=n.maxAlt,r.minPolarAngleVert=10*h,r.maxPolarAngleVert=170*h,r._updateMat(!0),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),i(t,[{key:"destruct",value:function(){return this.reset(),!0}},{key:"add",value:function(e){return this.lng=this.lng+e.lng,this.lat=this.lat+e.lat,this.alt=this.alt+e.alt,this.north=this.north+e.north,this.tilt=this.tilt+e.tilt,this.up=this.up+e.up,this}},{key:"reset",value:function(){a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this),this._onPoseChange(),this._updateMat(!0)}},{key:"clone",value:function(){console.warn("ni")}},{key:"_updateMat",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.matNeedsUpdate||e){var t=l.default.getLocalSystemOnEarthSurface(this.EARTH_RESOLUTION,this.lng,this.lat,this.earth_scale),r=t.origin,n=t.alt,i=this.tilt/180*Math.PI,o=this.north/180*Math.PI,a=new c.Spherical(this.alt/l.default.EARTH_RADIUS*this.earth_scale,i,o),s=(new c.Vector3).setFromSpherical(a),u=this._sphereLocalCoordinates(n.clone()),h=u.x.clone().multiplyScalar(s.x).add(u.y.clone().multiplyScalar(s.y)).add(u.z.clone().multiplyScalar(s.z)).add(r),f=u.z.clone().negate();f.applyAxisAngle(u.y.clone(),o);var d=(new c.Matrix4).lookAt(h,r.clone(),f);d.setPosition(h),this._mat.copy(d)}this.matNeedsUpdate=!1}},{key:"_updatePose",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this.poseNeedsUpdate||e)&&this._matToPose(),this.poseNeedsUpdate=!1}},{key:"_matToPose",value:function(e){var r=void 0;if(e&&!e.equals(this.matrix)?r=t._earthPicker.intersect(e.clone()):(e=this.matrix,r=this._centerIntersection()),r){var n=r.clone();return this._matToPoseWithAnchor(e,n)}}},{key:"_matToPoseWithAnchor",value:function(e,r){var n=this.EARTH_RESOLUTION,i=this.earth_scale,a=l.default.earthSurfaceToGeographic(n,r,i),s=a.lng,u=a.lat,c=this._matToAltNorthTiltWithAnchor(e,r),h={lng:s,lat:u,alt:c.alt,north:c.north,tilt:c.tilt,up:0};return h.tilt>=0&&h.tilt<=t.MAX_TILT||(h.tilt=Math.max(0,Math.min(t.MAX_TILT,h.tilt))),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"lng",h.lng,this),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"lat",h.lat,this),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"alt",h.alt,this),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"north",h.north,this),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"tilt",h.tilt,this),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"up",h.up,this),{lng:this._lng,lat:this._lat,alt:this._alt,north:this._north,tilt:this._tilt,up:this._up}}},{key:"_matToAltNorthTiltWithAnchor",value:function(e,t){var r=this.earth_scale,n=(new c.Vector3).setFromMatrixPosition(e),i=this._toEarthLocalSpherical(n,t).sph;return{alt:Math.max(i.radius/r*l.default.EARTH_RADIUS,.1),north:i.theta/Math.PI*180,tilt:i.phi/Math.PI*180}}},{key:"_onPoseChange",value:function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(this.matNeedsUpdate=!0)}},{key:"_onMatChange",value:function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(this.poseNeedsUpdate=!0)}},{key:"_sphereLocalCoordinates",value:function(e,t){var r=new c.Vector3,n=new c.Vector3,i=new c.Vector3;return t||(t=new c.Vector3(0,1,0)),n.copy(e).normalize(),0===n.lengthSq()&&(n.z=1),r.crossVectors(t,n).normalize(),0===r.lengthSq()&&(n.z+=1e-4,r.crossVectors(t,n).normalize()),i.crossVectors(r,n),{x:r,y:n,z:i}}},{key:"_toEarthLocalSpherical",value:function(e,t){var r=this._sphereLocalCoordinates(t),n=e.clone().sub(t),i=new c.Vector3(n.clone().dot(r.x),n.clone().dot(r.y),n.clone().dot(r.z)),o=new c.Spherical;return o.setFromVector3(i),{sph:o,x:r.x,y:r.y,z:r.z}}},{key:"orbitLeft",value:function(e){if(0!==e){var t=this.anchor,r=this.matrix.clone(),n=new c.Vector3(r.elements[12],r.elements[13],r.elements[14]),i=t.distanceTo(n);i=Math.max(1/l.default.EARTH_RADIUS*this.earth_scale,Math.min(i,this.earth_scale));var o=45*Math.PI/180,a=i*Math.tan(o/2),s=2*Math.atan2(a,this.earth_scale);this._orbitSphDelta.theta+=e*s,this.needsApplyDelta=!0}}},{key:"orbitUp",value:function(e){if(e){var t=this.anchor,r=this.matrix.clone(),n=new c.Vector3(r.elements[12],r.elements[13],r.elements[14]),i=t.distanceTo(n);i=Math.max(1/l.default.EARTH_RADIUS*this.earth_scale,Math.min(i,this.earth_scale));var o=45*h,a=i*Math.tan(o/2),s=2*Math.atan2(a,this.earth_scale);this._orbitSphDelta.phi+=e*s,this.needsApplyDelta=!0}}},{key:"dolly",value:function(e){0!==e&&(this._orbitSphDelta.radius+=e,this.needsApplyDelta=!0)}},{key:"swirlLeft",value:function(e){this._swirlSphDelta.theta+=e*h,this.needsApplyDelta=!0}},{key:"swirlUp",value:function(e){this._swirlSphDelta.phi+=e*h,this.needsApplyDelta=!0}},{key:"applyDelta",value:function(){if(this.needsApplyDelta){var e=this.matrix.clone(),t=this.anchor,r=(new c.Vector3).setFromMatrixPosition(e),n=new c.Vector3(1,0,0).transformDirection(e),i=new c.Vector3(0,1,0).transformDirection(e),o=void 0;if(this._orbitSphDelta.radius){var a=l.default.EARTH_RADIUS/this.earth_scale,s=r.clone().sub(t),u=1+this._orbitSphDelta.radius/10;u=Math.max(.01,u);var h,f=s.length()*u;h=f>this.maxAlt/a?t.clone().addScaledVector(s.clone().normalize(),this.maxAlt/a):f<this.minAlt/a?t.clone().addScaledVector(s.clone().normalize(),this.minAlt/a):t.clone().addScaledVector(s,u),o=e.clone().setPosition(h)}else o=e;var d=o.clone();if(this._swirlSphDelta.theta){var p=t.clone().normalize(),m=(new c.Matrix4).makeRotationAxis(p,this._swirlSphDelta.theta);d.premultiply((new c.Matrix4).getInverse(m))}if(this._swirlSphDelta.phi){var v=(new c.Matrix4).setPosition(t.clone().negate()),g=(new c.Matrix4).makeRotationAxis(n,this._swirlSphDelta.phi),y=(new c.Matrix4).setPosition(t).multiply(g).multiply(v),_=(new c.Matrix4).getInverse(y).multiply(d),w=(new c.Vector3).setFromMatrixPosition(_),b=new c.Vector3(0,1,0).transformDirection(_),x=new c.Vector3(0,0,-1).transformDirection(_).normalize(),k=w.clone().projectOnVector(x).clone().negate().add(w);k.length()>=.98*this.earth_scale||k.clone().dot(b)<=0||d.premultiply((new c.Matrix4).getInverse(y));var A=(new c.Matrix4).getInverse(d),M=(new c.Vector3).setFromMatrixPosition(A);if(0!==M.x){var S=t.clone().applyMatrix4(A),P=M.clone().sub(S).normalize(),T=P.clone().setX(0).normalize(),O=(new c.Matrix4).setPosition(S.clone().negate()).premultiply((new c.Matrix4).makeRotationFromQuaternion((new c.Quaternion).setFromUnitVectors(P,T))).premultiply((new c.Matrix4).setPosition(S.clone()));d.multiply((new c.Matrix4).getInverse(O))}}var C=(new c.Matrix4).identity();if(this._orbitSphDelta.theta){var E=(new c.Matrix4).makeRotationAxis(i,this._orbitSphDelta.theta);C.copy(E)}if(this._orbitSphDelta.phi){var I=(new c.Matrix4).makeRotationAxis(n,this._orbitSphDelta.phi);C.multiply(I)}var R=(new c.Matrix4).getInverse(C).multiply(d);this.matrix=R,this._orbitSphDelta.theta=0,this._orbitSphDelta.phi=0,this._orbitSphDelta.radius=0,this._swirlSphDelta.theta=0,this._swirlSphDelta.phi=0,this._orbitSphDelta.radius=0,this.needsApplyDelta=!1}}},{key:"putAnchor",value:function(e){return e?this._anchor.copy(e):this._updateAnchor()}},{key:"recommendedFrustum",value:function(e){e.camera,e.targetFocus}},{key:"_updateAnchor",value:function(){var e=this._centerIntersection();return e&&this._anchor.copy(e),this.anchor}},{key:"_centerIntersection",value:function(){return t._earthPicker.intersect(this.matrix)}},{key:"matrix",get:function(){return this._updateMat(),this._mat.clone()},set:function(e){e.isMatrix4?e.equals(this.matrix)||(this._mat.copy(e),this._onMatChange()):console.error("Unknown matrix",e)}},{key:"POS",get:function(){var e=new c.Vector3,t=new c.Quaternion,r=new c.Vector3;return this.matrix.clone().decompose(e,t,r),{position:e,orientation:t,scale:r}}},{key:"value",get:function(){return a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"value",this)},set:function(e){var t=Object.assign({},this.value,e);this.lng=t.lng,this.lat=t.lat,this.alt=t.alt,this.north=t.north,this.tilt=t.tilt,this.up=t.up}},{key:"lng",set:function(e){isNaN(e)||e===this.lng||(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"lng",e,this),this._onPoseChange())},get:function(){return this._updatePose(),a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"lng",this)}},{key:"lat",set:function(e){isNaN(e)||e===this.lat||(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"lat",e,this),this._onPoseChange())},get:function(){return this._updatePose(),a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"lat",this)}},{key:"alt",set:function(e){!isNaN(e)&&e!==this.alt&&e>=.1&&(void 0===this.minAlt&&void 0===this.maxAlt||(e=Math.max(this.minAlt,Math.min(this.maxAlt,e))),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"alt",e,this),this._onPoseChange())},get:function(){return this._updatePose(),a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"alt",this)}},{key:"north",set:function(e){isNaN(e)||e===this.north||(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"north",e,this),this._onPoseChange())},get:function(){return this._updatePose(),a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"north",this)}},{key:"tilt",set:function(e){e=Math.max(0,Math.min(t.MAX_TILT,e)),isNaN(e)||(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"tilt",e,this),this._onPoseChange())},get:function(){return this._updatePose(),a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"tilt",this)}},{key:"up",set:function(e){isNaN(e)||e===this.up||(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"up",e,this),this._onPoseChange())},get:function(){return this._updatePose(),a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"up",this)}},{key:"anchor",set:function(e){this._anchor.copy(e)},get:function(){return this._anchor.clone()}},{key:"maxAlt",set:function(e){(e=Math.max(.1,Math.min(2*l.default.EARTH_RADIUS,e)))<this.minAlt&&(console.warn("altRangeMax",e,this.minAlt),this._minAlt=e),this._maxAlt=e},get:function(){return this._maxAlt}},{key:"minAlt",set:function(e){(e=Math.max(.1,Math.min(2*l.default.EARTH_RADIUS,e)))>this.maxAlt&&(console.warn("altRangeMin",e,this.maxAlt),this._maxAlt=e),this._minAlt=e},get:function(){return this._minAlt}},{key:"maxTilt",set:function(e){(e=Math.max(0,Math.min(t.MAX_TILT,e)))<this.minTilt&&(console.warn("TiltRangeMax",e,this.minTilt),this._minTilt=e),this._maxTilt=e},get:function(){return this._maxTilt}},{key:"minTilt",set:function(e){(e=Math.max(0,Math.min(t.MAX_TILT,e)))>this.maxTilt&&(console.warn("TiltRangeMin",e,this.maxTilt),this._maxTilt=e),this._minTilt=e},get:function(){return this._minTilt}},{key:"distanceToAnchor",get:function(){var e=(new c.Vector3).setFromMatrixPosition(this.matrix),t=this.anchor;return e.distanceTo(t)}}]),t}();f._earthPicker=new u.default,f.MAX_TILT=75,t.default=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),o=function(){function e(t){var r=t.camera,n=t.domElement;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._camera=r,this._domElement=n,this._rayCaster=new i.Raycaster,this.mouseOffsetNeedsUpdate=!0}return n(e,[{key:"pick",value:function(e,t){var r=this._NDC(e,t),n=r.x,o=r.y;return this._rayCaster.setFromCamera(new i.Vector2(n,o),this.camera),this._rayCaster.intersectObjects(this.targets,!0)}},{key:"_NDC",value:function(e,t){var r=this.mouseOffset;return e-=r.left,t-=r.top,{x:e=e/this.domWidth*2-1,y:t=-t/this.domHeight*2+1}}},{key:"_NDC_inv",value:function(e,t){var r=this.mouseOffset;return{x:(e+1)/2*this.domWidth+r.left,y:(1-t)/2*this.domHeight+r.top}}},{key:"_updateMouseOffset",value:function(){var e=this._domElement.getBoundingClientRect();this._mouseOffset={left:e.left,top:e.top},this.mouseOffsetNeedsUpdate=!1}},{key:"camera",get:function(){return this._camera}},{key:"mouseOffset",get:function(){return this.mouseOffsetNeedsUpdate&&this._updateMouseOffset(),this._mouseOffset}},{key:"domWidth",get:function(){return this._domElement.clientWidth}},{key:"domHeight",get:function(){return this._domElement.clientHeight}},{key:"targets",get:function(){return[]}}]),e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r(3)),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.lng,n=void 0===r?0:r,i=t.lat,o=void 0===i?0:i,a=t.alt,s=void 0===a?0:a,l=t.north,u=void 0===l?0:l,c=t.tilt,h=void 0===c?0:c,f=t.up,d=void 0===f?0:f;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.lng=n,this.lat=o,this.alt=s,this.north=u,this.tilt=h,this.up=d}return n(e,[{key:"reset",value:function(){this.lng=0,this.lat=0,this.alt=0,this.north=0,this.tilt=0,this.up=0}},{key:"clone",value:function(){return new e(this.value)}},{key:"equals",value:function(e){return e.lat===this.lat&&e.lng===this.lng&&e.alt===this.alt&&e.north===this.north&&e.tilt===this.tilt&&e.up===this.up}},{key:"add",value:function(e){return this.lng=this.lng+e.lng,this.lat=this.lat+e.lat,this.alt=this.alt+e.alt,this.north=this.north+e.north,this.tilt=this.tilt+e.tilt,this.up=this.up+e.up,this}},{key:"lng",set:function(e){(e%=360)>=180?e-=360:e<=-180&&(e+=360),this._lng=e},get:function(){return this._lng}},{key:"lat",set:function(e){this._lat=Math.max(Math.min(87,e),-87)},get:function(){return this._lat}},{key:"alt",set:function(e){this._alt=Math.max(-1*i.default.EARTH_RADIUS,e)},get:function(){return this._alt}},{key:"north",set:function(e){e=(e%360+360)%360,this._north=e},get:function(){return this._north}},{key:"tilt",set:function(e){this._tilt=e},get:function(){return this._tilt}},{key:"up",set:function(e){this._up=e},get:function(){return this._up}},{key:"value",set:function(e){var t=e.lng,r=e.lat,n=e.alt,i=e.north,o=e.tilt,a=e.up;void 0!==t&&(this._pose.lng=t),void 0!==r&&(this._pose.lat=r),void 0!==n&&(this._pose.alt=n),void 0!==i&&(this._pose.north=i),void 0!==o&&(this._pose.tilt=o),void 0!==a&&(this._pose.up=a)},get:function(){return{lng:this.lng,lat:this.lat,alt:this.alt,north:this.north,tilt:this.tilt,up:this.up}}}]),e}();t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0),s=n(r(97)),l=n(r(39)),u=n(r(3)),c=n(r(14)),h=n(r(11)),f=n(r(50)),d=n(r(96)),p=n(r(25)),m=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default,r)),i=n;n.debug=!1,n.isMobile=r.isMobile,n.earthRadius=r.earthRadius,n.debug&&console.log("AltizureMeshEntity",r),n.options.viewModeType={TEXTURE:0,FLAT:1,WIREFRAME:2,SELECT:3,CROP:4},n.options.viewMode=n.options.viewModeType.CROP,n.options.PID=n.PID,n._onError=r.onError,n._apiInfo=r.apiInfo,n._projectInfo=function(e){function t(e){return e instanceof Array&&3===e.length?new a.Vector3(e[0],e[1],e[2]):e&&e.x&&e.y&&e.z?new a.Vector3(e.x,e.y,e.z):void console.error("objToVec3 invalid obj",e)}var r=i._apiInfo.modelTransform;return{origin:t(r.origin),x_dir:t(r.xDir),y_dir:t(r.yDir),z_dir:t(r.zDir),max_bound:t(r.maxBound),min_bound:t(r.minBound),x_tiles:r.xTiles,y_tiles:r.yTiles,z_tiles:r.zTiles,floor_height:r.floorHeight,length_unit_to_meter:r.lengthUnitToMeter,isMobile:i.isMobile,minLevel:0,maxLevel:function(e,t){for(var r=Math.max(e,t),n=0;r>1;)r/=2,n++;return n}(r.xTiles,r.yTiles),onLoadTrans:r.onLoadTrans}}(n._apiInfo),n._infoImporting=!1,n._infoImported=!1,n.cameraFov=-1,n.tanHalfFov=0,n.markerObject3D=new a.Object3D,n.markerObject3D.matrixAutoUpdate=!1;var o=function(){if(!this._apiInfo)return console.warn("createEarthSpaceMarker _apiInfo not available"),null;var e=c.default.EarthResolution,t=this._apiInfo.geoInfo.centerLong,r=this._apiInfo.geoInfo.centerLat,n=u.default.geographicToEarthSurface(e,t,r,this.earthRadius),i=u.default.getGeoNormalOnEarthSurface(e,t,r),o=this.earthRadius/10,a={dir:i,origin:n,earthRadius:this.earthRadius,projInfo:this._apiInfo},s={maxAnisotropy:this.options.maxAnisotropy,color:16109078,length:o};return new d.default(a,s)}.bind(n);return n.marker=o(),null!==n.marker&&(n.sceneNode.add(n.markerObject3D),n.markerObject3D.add(n.marker),n.marker.updateMatrixWorld(!0)),n._tree=null,n.name=n.PID,n.sceneNode.name=n.name,n.treeNode=new a.Object3D,n.sceneNode.add(n.treeNode),n.eventHandlers={onEntityCreated:r.eventHandlers.onEntityCreated,onEntityModelInitialized:r.eventHandlers.onEntityModelInitialized},n.randomSpinOffset=Math.random()*Math.PI*2,n.currentTime=0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"destruct",value:function(){var e=!0;return(e=e&&this.deport())&&function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"startImport",value:function(){var e=!1;this._infoImporting=!0,e&&console.log("startImport",this._apiInfo);var t=this;return Promise.resolve().then(function(){return t._infoImporting?(function(){var r=t.earthRadius,n=r/u.default.EARTH_RADIUS,o=c.default.EarthResolution,s={longitude:t._apiInfo.geoInfo.centerLong,latitude:t._apiInfo.geoInfo.centerLat},l=u.default.getLocalSystemOnEarthSurface(o,s.longitude,s.latitude,r),f=new h.default;if(f.makeBasis(l.lng.multiplyScalar(n),l.lat.multiplyScalar(n),l.alt.multiplyScalar(n)),f.setPosition(l.origin),1!==t.projectInfo.length_unit_to_meter){var d=t.projectInfo.length_unit_to_meter,m=(new h.default).makeScale(d,d,d);e&&console.log(d,m),f.multiply(m)}var v=new h.default;v.makeTranslation(-t.projectInfo.origin.x,-t.projectInfo.origin.y,-(t.projectInfo.min_bound.z+t.projectInfo.origin.z)),f.multiply(v),t.setMatrix(f),t.options.eventHandlers={onContentDisposed:function(){return!0},onContentInitialized:function(){return t.marker.fadeOutBox(t.currentTime),t.eventHandlers.onEntityModelInitialized(),!0}};var g=t.projectInfo,y={origin:g.origin.clone(),x_dir:g.x_dir.clone(),y_dir:g.y_dir.clone(),z_dir:g.z_dir.clone(),max_bound:g.max_bound.clone(),min_bound:g.min_bound.clone(),x_tiles:g.x_tiles,y_tiles:g.y_tiles,z_tiles:g.z_tiles,floor_height:g.floorHeight||g.floor_height,length_unit_to_meter:g.lengthUnitToMeter||g.length_unit_to_meter,isMobile:g.isMobile,minLevel:g.minLevel,maxLevel:g.maxLevel,tile_salt:g.tile_salt||t.versionControl,onLoadTrans:g.onLoadTrans};if(void 0===y.transformation){var _=new a.Matrix4;y.onLoadTrans instanceof Array?3===y.onLoadTrans.length?_.makeRotationX(Math.PI*y.onLoadTrans[0]).multiply((new a.Matrix4).makeRotationY(Math.PI*y.onLoadTrans[1])).multiply((new a.Matrix4).makeRotationZ(Math.PI*y.onLoadTrans[2])):16===y.onLoadTrans.length?_.set.apply(_,y.onLoadTrans):console.error("AltizureMeshEntity createTree: incorrect onLoadTrans",y.onLoadTrans):"object"===i(y.onLoadTrans)&&void 0!==y.onLoadTrans.x&&void 0!==y.onLoadTrans.y&&void 0!==y.onLoadTrans.z&&_.makeRotationX(Math.PI*y.onLoadTrans.x).multiply((new a.Matrix4).makeRotationY(Math.PI*y.onLoadTrans.y)).multiply((new a.Matrix4).makeRotationZ(Math.PI*y.onLoadTrans.z));var w=_.multiply((new a.Matrix4).makeTranslation(-y.origin.x,-y.origin.y,-y.origin.z));void 0===y.length_unit_to_meter&&(y.length_unit_to_meter=1),y.transformation=new p.default,y.transformation.set({onload:w,scale:y.length_unit_to_meter})}t.options.dataPath=t.preferredPath,t._tree=new t.TreeType(t.TileType,t.treeNode,t.dataUrl,y,t.options),t._infoImported=!0,t._infoImporting=!1,t.options.forest&&t.options.forest.add(t._tree);try{var b=new h.default;b.getInverse(t.matrix,!0),t.markerObject3D.matrix.copy(b)}catch(r){console.warn("inverse failed")}}(),t.eventHandlers.onEntityCreated(),Promise.resolve()):Promise.reject(new Error("import is stopped (possibly by deport)"))}).catch(function(e){return Promise.reject(e)})}},{key:"deport",value:function(){var e=!0;return this._infoImported=!1,this._infoImporting=!1,this.options.forest&&this.options.forest.remove(this._tree),this._tree&&(e=e&&this._tree.destruct(),this._tree=null),this.debug&&console.log("AltizureMeshEntity deport",this._apiInfo.name,e?"success":"fail"),e}},{key:"detach",value:function(){return this.parent.removeEntity(this)}},{key:"sceneUpdated",value:function(e){var t=this,r=this.checkVisibility(e),n=r.area;r.centerInScreen&&n>.01?(new a.Color(65280),this._infoImported||this._infoImporting||(null!==this._tree?console.warn("this._tree exists",this._tree):(this.marker.addBox(),this.startImport().then(function(){return t.debug&&console.log("startImport resolved",t.options),Promise.resolve()}).catch(function(e){return Promise.resolve(e)})))):n>=.005&&n<=.01?new a.Color(16776960):n<.001&&n>=0?(new a.Color(16711680),this._infoImported?this.deport():this._infoImporting&&this.deport()):n<0?(this.marker.visable=!1,new a.Color(16711680)):new a.Color(16776960);var i=t.marker.age<3;return n<=.001&&n>1e-4||i?this.marker.addTag():n<=9e-5&&n>0&&!i&&this.marker.removeTag(),n>.1&&!i?this.marker.hideTag():(n<=.1&&n>1e-4||i)&&this.marker.showTag(),Promise.resolve()}},{key:"updateVisibility",value:function(e){if(null!==this._tree){var t=e.frustum;this._tree.updateVisibility(t)}}},{key:"checkVisibility",value:function(e){var t=this,r={area:0,centerInScreen:!1},n=new a.Vector3;e.camera.getWorldDirection(n),n.normalize();var i=this.parent.matrixWorld.toThreeMatrix4(),o=(new a.Matrix3).getNormalMatrix(i),s=this.normal.clone().applyMatrix3(o).normalize();if(!(n.clone().dot(s)<-.1))return r.centerInScreen=!1,r.area=-1,r;var l=function(t){for(var r=[],n={front:!1,back:!1},o=0;o<t.length;o++)if(r[o]=t[o].clone(),r[o].applyMatrix4(i).applyMatrix4(e.pvmatrix),r[o].z>1?n.back=!0:r[o].z<1&&(n.front=!0),n.front&&n.back)return 666;for(var a=0,s=[],l=0;l<r.length;l++)s.push({x:r[l].x,y:r[l].y});return(a=f.default.polygonIntersectArea([{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],s))<0&&(a=0),a}(this.CartesianEnvelope);return r.area=l,r.centerInScreen=!(l<=0)&&function(t){var r=t.clone();return r.applyMatrix4(i).applyMatrix4(e.pvmatrix),r.x<=1&&r.x>=-1&&r.y<=1&&r.y>=-1&&r.z<=1&&r.z>=-1}(t.center),r}},{key:"animate",value:function(e){this.currentTime=e.currentTime,function(){var t=this.parent.matrixWorld.toThreeMatrix4(),r=e.camera.position.clone(),n=this.center.applyMatrix4(t),i=r.sub(n).length(),o=Math.min(i/10,this.earthRadius/10);this.marker.setLength(o),this.cameraFov!==e.camera.fov&&(this.cameraFov=e.camera.fov,this.tanHalfFov=Math.tan(.5*e.camera.fov*Math.PI/180));var s=.5*e.viewportSize.height/this.tanHalfFov,l=o/this.earthRadius*15e3*(160/s)*10;if(this.marker.tagHolder.scale.set(l,l,1),this.marker.dropPin.isDropping){var u=this.marker.dropPin;if(null===u.start)u.start=this.currentTime;else{var c=u.span-(this.currentTime-u.start);if(c<=0)u.isDropping=!1,u.start=null,this.marker.position.copy(this.marker.init.origin);else{var h=this._apiInfo.views||1;h=Math.max(h,1)/100;var f=c/u.span/h,d=i*f*f,p=this.marker.init.origin.clone().normalize().multiplyScalar(d);this.marker.position.copy(this.marker.init.origin).add(p)}this.marker.visible=!0}}if(null!==this.marker.box){var m=new a.Quaternion;m.setFromAxisAngle(new a.Vector3(0,1,0),this.randomSpinOffset+5*e.currentTime),this.marker.boxHolder.quaternion.copy(m);var v=Math.min(i/100,this.earthRadius/1e3);if(this.marker.boxHolder.position.set(0,v,0),this.marker.fadingBox.isFading){var g=e.currentTime-this.marker.fadingBox.start;if(g>this.marker.fadingBox.span)this.marker.fadingBox.isFading=!1,this.marker.fadingBox.start=0,this.marker.removeBox();else{var y=g/this.marker.fadingBox.span;this.marker.box.material.opacity=this.marker.box.material.opacity*(1-y*y),this.marker.box.material.needsUpdate=!0}}}}.bind(this)()}},{key:"versionControl",get:function(){return this._apiInfo.versionControl}},{key:"preferredPath",get:function(){for(var e=this.options.cloudPriorityList,t=this._apiInfo.cloudPath,r=0;r<e.length;r++)for(var n=0;n<t.length;n++)if(t[n].key===e[r])return t[n].dataUrl;console.error("preferredPath error",this.projectName,t,e)}},{key:"projectName",get:function(){return this._apiInfo.name}},{key:"projectInfo",get:function(){return this._projectInfo}},{key:"dataUrl",get:function(){var e=this.preferredPath;return e&&e.length>0&&"/"===e[0]&&(e="https://www.altizure.com"+e),e+"/web/"}},{key:"CartesianEnvelope",get:function(){if(!this._apiInfo)return null;var e=c.default.EarthResolution,t=this._apiInfo.geoInfo,r=t.minLong,n=t.maxLong,i=t.minLat,o=t.maxLat,s=[];s[3]=u.default.geographicToEarthSurface(e,r,i,this.earthRadius),s[2]=u.default.geographicToEarthSurface(e,r,o,this.earthRadius),s[1]=u.default.geographicToEarthSurface(e,n,o,this.earthRadius),s[0]=u.default.geographicToEarthSurface(e,n,i,this.earthRadius);for(var l=0;l<4;l++)s[l]=new a.Vector3(s[l].x,s[l].y,s[l].z);return s}},{key:"center",get:function(){var e=c.default.EarthResolution,t=this._apiInfo.geoInfo.centerLong,r=this._apiInfo.geoInfo.centerLat;return u.default.geographicToEarthSurface(e,t,r,this.earthRadius)}},{key:"normal",get:function(){if(!this._apiInfo)return null;var e=this._apiInfo.geoInfo.centerLong,t=this._apiInfo.geoInfo.centerLat,r=u.default.geographicToCartesianCoord(e,t,1);return new a.Vector3(r.x,r.y,r.z).normalize()}}]),t}();t.default=m},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"polygonIntersectArea",value:function(e,t){function r(e,t){this.x=e,this.y=t}function n(e,t){this.mn=e,this.mx=t}function i(){this.x=0,this.y=0}function o(){this.ip=null,this.rx=null,this.ry=null,this.in=0}function a(e,t){for(var r=e.length;r--;)t.min.x=Math.min(t.min.x,e[r].x),t.min.y=Math.min(t.min.y,e[r].y),t.max.x=Math.max(t.max.x,e[r].x),t.max.y=Math.max(t.max.y,e[r].y)}function s(e,t,r){return t.x*r.y-t.y*r.x+e.x*(t.y-r.y)+e.y*(r.x-t.x)}function l(e,t){return e.mn<t.mx&&t.mn<e.mx}function u(e,t,r,n,i){d+=i*(r-e)*(n+t)/2}function c(e,t,r,a){for(var s=e.length,l=s;l--;)t[l]=new o,t[l].ip=new i,t[l].ip.x=-8&Math.floor((e[l].x-a.min.x)*p-v)|r|1&l,t[l].ip.y=-8&Math.floor((e[l].y-a.min.y)*m-v)|r;for(t[0].ip.y+=1&s,t[s]=t[0],l=s;l--;)t[l].rx=t[l].ip.x<t[l+1].ip.x?new n(t[l].ip.x,t[l+1].ip.x):new n(t[l+1].ip.x,t[l].ip.x),t[l].ry=t[l].ip.y<t[l+1].ip.y?new n(t[l].ip.y,t[l+1].ip.y):new n(t[l+1].ip.y,t[l].ip.y),t[l].in=0}function h(e,t,r,n,i,o,a,s){var l=i/(i+o),c=a/(a+s);u(Math.floor(e.ip.x+l*(t.ip.x-e.ip.x)),Math.floor(e.ip.y+l*(t.ip.y-e.ip.y)),t.ip.x,t.ip.y,1),u(n.ip.x,n.ip.y,Math.floor(r.ip.x+c*(n.ip.x-r.ip.x)),Math.floor(r.ip.y+c*(n.ip.y-r.ip.y)),1),++e.in,--r.in}function f(e,t,r,n){for(var i=0,o=n,a=e[0].ip;o--;)if(r[o].rx.mn<a.x&&a.x<r[o].rx.mx){var l=s(a,r[o].ip,r[o+1].ip)>0;i+=l!==r[o].ip.x<r[o+1].ip.x?0:l?-1:1}for(var c=0;c<t;++c)0!==i&&u(e[c].ip.x,e[c].ip.y,e[c+1].ip.x,e[c+1].ip.y,i),i+=e[c].in}var d=0,p=0,m=0,v=25e3;return function(e,t){for(var n=e.length,i=t.length,o=[],u=n+1;u--;)o[u]=null;var v=[];for(u=i+1;u--;)v[u]=null;var g=new function(e,t){this.min=e,this.max=t}(new r(1/0,1/0),new r(-1/0,-1/0));if(n<3||i<3)return 0;a(e,g),a(t,g);var y=g.max.x-g.min.x;p=5e4/y;var _=g.max.y-g.min.y,w=p*(m=5e4/_);c(e,o,0,g),c(t,v,2,g);for(var b=0;b<n;++b)for(var x=0;x<i;++x)if(l(o[b].rx,v[x].rx)&&l(o[b].ry,v[x].ry)){var k=-s(o[b].ip,v[x].ip,v[x+1].ip),A=s(o[b+1].ip,v[x].ip,v[x+1].ip),M=k<0;if(M===A<0){var S=s(v[x].ip,o[b].ip,o[b+1].ip),P=-s(v[x+1].ip,o[b].ip,o[b+1].ip);S<0==P<0&&(M?h(o[b],o[b+1],v[x],v[x+1],k,A,S,P):h(v[x],v[x+1],o[b],o[b+1],S,P,k,A))}}return f(o,n,v,i),f(v,i,o,n),d/w}(e,t)}},{key:"testPolygonIntersectArea",value:function(){function t(e){for(var t=[],r=0;r<e.length;r++)t[r]={x:e[r][0],y:e[r][1]};return t}function r(r,n){r=t(r),n=t(n),console.log("polygons intersect area",e.polygonIntersectArea(r,n),e.polygonIntersectArea(r,r))}r([[2,3],[2,3],[2,3],[2,4],[3,3],[2,3],[2,3]],[[1,1],[1,4],[4,4],[4,1],[1,1]]),r([[1,7],[4,7],[4,6],[2,6],[2,3],[4,3],[4,2],[1,2]],[[3,1],[5,1],[5,4],[3,4],[3,5],[6,5],[6,0],[3,0]]),r([[1,1],[1,2],[2,1],[2,2]],[[0,0],[0,4],[4,4],[4,0]]),r([[0,0],[3,0],[3,2],[1,2],[1,1],[2,1],[2,3],[0,3]],[[0,0],[0,4],[4,4],[4,0]]),r([[0,0],[1,0],[0,1]],[[0,0],[0,1],[1,1],[1,0]]),r([[1,3],[2,3],[2,0],[1,0]],[[0,1],[3,1],[3,2],[0,2]]),r([[0,0],[0,2],[2,2],[2,0]],[[1,1],[3,1],[3,3],[1,3]]),r([[0,0],[0,4],[4,4],[4,0]],[[1,1],[1,2],[2,2],[2,1]])}}]),e}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(t,r,n,i,o){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.x=t,this.y=r,this.level=n,this.options=o,this.loaded=!1,this.loading=!1,this.expired=!1,this.name="SmartTile_"+this.level+"_"+this.x+"_"+this.y,this.mesh=void 0,this.visible=!0,this.sceneGraphRoot=void 0,this.parent=i,this.nodes=[],this.needsPrune=!1}return n(e,[{key:"info",value:function(){return{level:this.level,x:this.x,y:this.y}}},{key:"isInFrustum",value:function(){return console.error("isInFrustum is not implemented."),!1}},{key:"screenArea",value:function(){return console.error("screenArea is not implemented."),0}},{key:"tileLoader",value:function(){return console.warn("tileLoader is not implemented"),Promise.reject("tileLoader is not implemented")}},{key:"onLoaded",value:function(e){var t=!0;return this.loaded?(console.warn("trying to assign mesh to a loaded tile",this,e),t=!1):(this.mesh=e,this.options.debug&&console.log("onload",JSON.stringify(this.info())),this.loaded=!0),t}},{key:"dispose",value:function(){return this.options.debug&&console.log("disposing",JSON.stringify(this.info())),this.isInScene()&&this._removeFromSceneGraph(),this.x=void 0,this.y=void 0,this.level=void 0,this.parent=void 0,this.options=void 0,this.name=void 0,this.visible=void 0,this.mesh=void 0,this.loaded=!1,this.expired=!0,this.sceneGraphRoot=void 0,this.nodes=void 0,!0}},{key:"isInScene",value:function(){return void 0!==this.sceneGraphRoot}},{key:"setVisibility",value:function(e){this.visible=e}},{key:"displayByload",value:function(e){this.options.debug&&console.log("displayByload",JSON.stringify(this.info()));var t=!1;return this.loaded?t=null!==this.parent||this.isInScene()?this._replaceParentAttempt(e)&&t:this._addToSceneAsync(e)&&t:(console.error("not loaded but display atttempt"),t=!1)}},{key:"_replaceParentAttempt",value:function(e){var t=!1;if(!this.loaded)return console.error("not loaded but display atttempt"),!1;if(null!==this.parent||this.isInScene()){for(var r=this.parent.nodes,n=!0,i=0;i<r.length&&(n=r[i].loaded&&n);i++);if(n&&this.parent.isInScene()){for(this.parent._removeFromSceneGraph(),i=0;i<r.length;i++)r[i]._addToSceneAsync(e);t=!0}}else this._addToSceneAsync(e),t=!0;return t}},{key:"_addToSceneAsync",value:function(e){return this._addToSceneGraph(e),this._beReplacedAttempt(e),!0}},{key:"_beReplacedAttempt",value:function(e,t){var r=!0;if(!this.loaded)return console.error("not loaded but display atttempt"),!1;if(!this.isInScene())return console.error("not in scene but be replaced atttempt"),!1;if(0===this.nodes.length)r=!1;else if(4===this.nodes.length){for(var n=!0,i=0;i<this.nodes.length&&(n=this.nodes[i].loaded&&n);i++);if(n){this._removeFromSceneGraph();for(var o=0;o<this.nodes.length;o++)this.nodes[o]._addToSceneAsync(e);r=!0}}else console.error("node with unexpected number of children",this),r=!1;return r}},{key:"displayByPrune",value:function(e){this.options.debug&&console.log("displayByPrune",JSON.stringify(this.info()));var t=!1;if(!this.loaded)return!1;if(null===this.parent)this._addToSceneGraph(e),t=!0;else{if(!this.parent.loaded)return!1;for(var r=this.parent.nodes,n=!0,i=0;i<r.length&&(n=r[i].loaded&&n);i++);n&&(this.parent.isInScene()||this.isInScene()||function(e){for(var t=e.parent;null!==t;){if(t.isInScene())return t;t=t.parent}}(this)||this._addToSceneGraph(e),t=!0)}return t}},{key:"_addToSceneGraph",value:function(e){var t=this.options.debug,r=!0;return void 0===this.mesh?(console.warn(JSON.stringify(this.info())+", mesh undefined, cannot add to scene"),r=!1):void 0===e?(console.warn("sceneGraphRoot undefined"),r=!1):void 0!==this.sceneGraphRoot?(console.warn("Twice adding to scene attempt",this.info()),r=!1):(this.setVisibility(this.visible),e.add(this.mesh),this.sceneGraphRoot=e,t&&console.log("add to scene",this.info()),r=r&&!0),r}},{key:"_removeFromSceneGraph",value:function(){var e=this.options.debug,t=!0;return void 0!==this.sceneGraphRoot&&void 0!==this.mesh?(this.sceneGraphRoot.remove(this.mesh),this.sceneGraphRoot=void 0,this.mesh.place_holder?this.mesh.visible=!1:this.mesh.visible=!0,e&&console.log("remove from scene",this.info()),t):(console.warn("_removeFromSceneGraph fail",this),t=!1)}},{key:"is404",get:function(){return!(!this.mesh||!this.mesh.place_holder)}}],[{key:"releaseMemory",value:function(){return console.warn("releaseMemory is not implemented"),!1}}]),e}();t.default=i},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=n(r(112)),a=n(r(29)),s=n(r(119)),l=n(r(53)),u=function(){function e(t,r,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.MAX_THREADS=n.MAX_THREADS||8,this.MAX_CACHE_SIZE=n.MAX_CACHE_SIZE||100,this.Node=t,this.sceneGraphRoot=r,this.root=null,this.tree_size_limit=1,this.numOfNodes=0,this.maxLevel=0,this.minLevel=0,this.smart_options=n,this.smart_options.loading={session:0,left:0,total:0},this.smart_options.debug&&(console.log("sceneGraphRoot",JSON.stringify(this.sceneGraphRoot.matrixWorld)),console.log("smart option",this.smart_options)),this.eventQueue=new s.default,this.tile_retriever=null,this.node_options={debug:this.smart_options.debug,onError:this.smart_options.onError,eventQueue:this.eventQueue},this.flags={modelInitialized:!1},this.eventHandlers=n.eventHandlers||{onContentDisposed:void 0,onContentInitialized:void 0}}return i(e,[{key:"destruct",value:function(){var e=!0;return e=e&&this.dispose(this.root),this.root=null,this._onContentDisposed(),this.tile_retriever&&(e=e&&this.tile_retriever.destruct(),this.tile_retriever=null),e}},{key:"expand",value:function(e){return console.error("expand is not implemented"),!1}},{key:"dispose",value:function(e){var t=this.smart_options.debug;if(void 0===e)return!1;var r=!0;void 0===e.nodes&&console.warn("inspect",e.info());for(var n=0;n<e.nodes.length;n++)r=this.dispose(e.nodes[n])&&r;return t&&console.log("delete",JSON.stringify(e.info())),r=e.dispose()&&r,e=void 0,this.numOfNodes--,r}},{key:"prune",value:function(e){if(void 0===e)return console.warn("Trying to prune undefined node"),!1;var t=!0;if(e.isInScene()||e.displayByPrune(this.sceneGraphRoot),e.nodes.length>0){for(var r=0;r<e.nodes.length;r++)t=this.dispose(e.nodes[r])&&t;e.nodes=[]}return t}},{key:"updateVisibility",value:function(e){var t=!0;this.smart_options.frustum=e;var r=this.sceneGraphRoot;return r&&(t=this.traverse(this.root,function(t){var n=t.isInFrustum(e,r);return t.setVisibility(n),!0})&&t),t||console.warn("updateVisibility has problems"),t}},{key:"updateView",value:function(e,t,r){var n=!0,i=this.smart_options.debug;return this.smart_options.camera=e,this.smart_options.pvmatrix=t,this.smart_options.frustum=r,this.sceneGraphRoot.updateMatrixWorld(),i&&(console.log("update view"),console.time("rebuild")),n=this.rebuild()&&n,i&&console.timeEnd("rebuild"),i&&console.log("updateView numOfNodes",this.numOfNodes),this.numOfNodes>500&&console.warn("Out of cache capacity",JSON.stringify(e),JSON.stringify(t)),n||console.warn("updateView has problems"),n}},{key:"traverse",value:function(e,t,r,n){var i=!0;i=i&&t(e,r,n);for(var o=0;o<e.nodes.length;o++)i=i&&this.traverse(e.nodes[o],t,r,n);return i}},{key:"rebuild",value:function(){var e=this.smart_options.debug,t=this,r=!0,n=this.smart_options.MIN_AREA;e&&console.log("MIN_AREA",n);var i=new l.default(function(e,t){return t.key-e.key}),o=0;(r=this.traverse(this.root,function(e){return e.needsPrune=!0,!0})&&r)||console.warn("init needsPrune has problems"),i.enqueue(Number.MAX_VALUE,this.root),o++;do{if(o>=this.tree_size_limit){e&&console.warn("tree size limit reached",this.tree_size_limit);break}var a=i.dequeue();void 0===a&&(console.warn("undefined element in priority queue",a),console.log("pq empty",i.isEmpty()));var s=a.key,u=a.value;if(s<n){e&&console.log("min area reached",s,n);break}if(u.needsPrune=!1,e&&console.log("node in tree",u.info()),u.level<this.maxLevel){0===u.nodes.length&&(r=this.expand(u)&&r);for(var c=0;c<u.nodes.length;c++){var h=u.nodes[c];h.needsPrune=!0;var f=h.screenArea(this.smart_options.camera,this.smart_options.pvmatrix,this.smart_options.frustum,this.sceneGraphRoot);f>0||h.setVisibility(!1),f>=n&&i.enqueue(f,h)}o+=4}}while(!i.isEmpty());if(r||console.warn("expand has problems"),i.clear(),(r=this.traverse(this.root,function(e){return!e.needsPrune||t.prune(e)})&&r)||console.warn("prune has problems"),e){var d={size:0,level:0,nodes:[]};this.traverse(this.root,function(e,t){return t.size++,e.level>t.level&&(t.level=e.level),t.nodes.push({x:e.x,y:e.y,level:e.level}),!0},d),console.log("smart tree",d)}return r}},{key:"loadUnloadedTiles",value:function(){function e(){if(r){console.log("validateScene");var e=i.sceneGraphRoot.children,t=0,n=void 0,o=void 0,a=[];try{for(var s=0;s<e.length;s++){var l=e[s];"EarthSurfaceTree"===i.name&&"meshHolder"===l.name&&(l=l.children[0]),(n=l.debug_info)&&(null===l.geometry&&(console.warn("escaper mesh",l),a.push(l)),t+=(o=Math.pow(2,i.maxLevel-n.level))*o)}var u=Math.pow(2,i.maxLevel);t===u*u?console.log("validated",t):console.warn("validation fail",t,"/",u*u,i.sceneGraphRoot)}catch(e){console.warn("validation exception",e)}}}var t=this,r=this.smart_options.debug,n=new a.default;n.enqueue(this.root);var i=this,s=0;for(null===this.tile_retriever&&(this.tile_retriever=new o.default({debug:this.smart_options.debug,cache_size:this.MAX_CACHE_SIZE,dock_capacity:this.MAX_THREADS,allow_worker:window.Worker&&this.smart_options.allow_worker,display_lod:this.smart_options.display_lod})),this.tile_retriever.clear(),function e(t){t.loaded&&i.tile_retriever.request(t,void 0,function(){});for(var r=t.nodes,n=0;n<r.length;n++)e(r[n])}(this.root),this.smart_options.loading.session++,this.smart_options.loading.total=0,this.smart_options.loading.left=0;!n.isEmpty();){var l;!function(){var o=n.dequeue();if(o.loaded||(s++,t.smart_options.loading.total++,t.smart_options.loading.left++,t.tile_retriever.request(o,t.smart_options.loading.session,function(t,n){o.expired||n!==i.smart_options.loading.session||(o.setVisibility(o.visible),o.onLoaded(t),o.displayByload(i.sceneGraphRoot),i.flags.modelInitialized||i._onContentInitialized(),r&&(t.debug_info=o.info()),n===i.smart_options.loading.session&&0==--i.smart_options.loading.left&&(r||window.dispatchEvent(new CustomEvent("load_complete",{detail:i})),r&&(console.log("loading session",n,"successfully completed"),console.log("TileRetriever info",i.tile_retriever.info()),e())))})),void 0!==o.nodes)for(l=0;l<o.nodes.length;l++)n.enqueue(o.nodes[l])}()}r&&console.log("loadRootTiles node number",s)}},{key:"_onContentInitialized",value:function(){this.flags.modelInitialized=!0,this.eventHandlers.onContentInitialized&&this.eventHandlers.onContentInitialized()}},{key:"_onContentDisposed",value:function(){this.flags.modelInitialized=!1,this.eventHandlers.onContentDisposed&&this.eventHandlers.onContentDisposed()}}]),e}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(108)),i=function(e){this.heap=new n.default(e)};i.prototype.constructor=i,i.prototype.enqueue=function(e,t){return this.heap.insert(e,t)},i.prototype.dequeue=function(){return this.heap.extractMinimum()},i.prototype.clear=function(){this.heap.clear()},i.prototype.isEmpty=function(){return this.heap.isEmpty()},t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,browser:{isWeChat:navigator.userAgent.indexOf("MicroMessenger")>=0,isOpera:!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,isFirefox:"undefined"!=typeof InstallTrigger,isSafari:Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,isChrome:!!window.chrome,isIE:!!document.documentMode},getWebGLErrorMessage:function(){var e=document.createElement("div");return e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.textAlign="center",e.style.background="#eee",e.style.color="#000",e.style.padding="1em",e.style.width="475px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,r,i;t=void 0!==(e=e||{}).parent?e.parent:document.body,r=void 0!==e.id?e.id:"oldie",(i=n.getWebGLErrorMessage()).id=r,t.appendChild(i)}};window.Detector=n,n.webgl=n.webgl,n.canvas=n.canvas,t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(){var e=this,t=null,r=[];this.add=function(n,i,o){if(n)return r.push([n,i,o]),void(1===r.length&&function n(i){t=setTimeout(function(){i=e.add(),r.length&&n(i)},i||0)}(o));var a=r.shift();return a?(a[0].call(a[1]||window),a[2]):0},this.clear=function(){clearTimeout(t),r=[]}}},function(e,t,r){e.exports=function(e){return function(t){var r=e,n=r.lib,i=n.WordArray,o=n.Hasher,a=r.algo,s=[],l=[];!function(){function e(e){return 4294967296*(e-(0|e))|0}for(var r=2,n=0;n<64;)(function(e){for(var r=t.sqrt(e),n=2;n<=r;n++)if(!(e%n))return!1;return!0})(r)&&(n<8&&(s[n]=e(t.pow(r,.5))),l[n]=e(t.pow(r,1/3)),n++),r++}();var u=[],c=a.SHA256=o.extend({_doReset:function(){this._hash=new i.init(s.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],c=r[5],h=r[6],f=r[7],d=0;d<64;d++){if(d<16)u[d]=0|e[t+d];else{var p=u[d-15],m=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,v=u[d-2],g=(v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10;u[d]=m+u[d-7]+g+u[d-16]}var y=s&c^~s&h,_=n&i^n&o^i&o,w=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),b=(s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25),x=f+b+y+l[d]+u[d],k=w+_;f=h,h=c,c=s,s=a+x|0,a=o,o=i,i=n,n=x+k|0}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+a|0,r[4]=r[4]+s|0,r[5]=r[5]+c|0,r[6]=r[6]+h|0,r[7]=r[7]+f|0},_doFinalize:function(){var e=this._data,r=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return r[i>>>5]|=128<<24-i%32,r[14+(i+64>>>9<<4)]=t.floor(n/4294967296),r[15+(i+64>>>9<<4)]=n,e.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});r.SHA256=o._createHelper(c),r.HmacSHA256=o._createHmacHelper(c)}(Math),e.SHA256}(r(1))},function(e,t,r){e.exports=function(e){return function(){function t(){return a.create.apply(a,arguments)}var r=e,n=r.lib,i=n.Hasher,o=r.x64,a=o.Word,s=o.WordArray,l=r.algo,u=[t(1116352408,3609767458),t(1899447441,602891725),t(3049323471,3964484399),t(3921009573,2173295548),t(961987163,4081628472),t(1508970993,3053834265),t(2453635748,2937671579),t(2870763221,3664609560),t(3624381080,2734883394),t(310598401,1164996542),t(607225278,1323610764),t(1426881987,3590304994),t(1925078388,4068182383),t(2162078206,991336113),t(2614888103,633803317),t(3248222580,3479774868),t(3835390401,2666613458),t(4022224774,944711139),t(264347078,2341262773),t(604807628,2007800933),t(770255983,1495990901),t(1249150122,1856431235),t(1555081692,3175218132),t(1996064986,2198950837),t(2554220882,3999719339),t(2821834349,766784016),t(2952996808,2566594879),t(3210313671,3203337956),t(3336571891,1034457026),t(3584528711,2466948901),t(113926993,3758326383),t(338241895,168717936),t(666307205,1188179964),t(773529912,1546045734),t(1294757372,1522805485),t(1396182291,2643833823),t(1695183700,2343527390),t(1986661051,1014477480),t(2177026350,1206759142),t(2456956037,344077627),t(2730485921,1290863460),t(2820302411,3158454273),t(3259730800,3505952657),t(3345764771,106217008),t(3516065817,3606008344),t(3600352804,1432725776),t(4094571909,1467031594),t(275423344,851169720),t(430227734,3100823752),t(506948616,1363258195),t(659060556,3750685593),t(883997877,3785050280),t(958139571,3318307427),t(1322822218,3812723403),t(1537002063,2003034995),t(1747873779,3602036899),t(1955562222,1575990012),t(2024104815,1125592928),t(2227730452,2716904306),t(2361852424,442776044),t(2428436474,593698344),t(2756734187,3733110249),t(3204031479,2999351573),t(3329325298,3815920427),t(3391569614,3928383900),t(3515267271,566280711),t(3940187606,3454069534),t(4118630271,4000239992),t(116418474,1914138554),t(174292421,2731055270),t(289380356,3203993006),t(460393269,320620315),t(685471733,587496836),t(852142971,1086792851),t(1017036298,365543100),t(1126000580,2618297676),t(1288033470,3409855158),t(1501505948,4234509866),t(1607167915,987167468),t(1816402316,1246189591)],c=[];!function(){for(var e=0;e<80;e++)c[e]=t()}();var h=l.SHA512=i.extend({_doReset:function(){this._hash=new s.init([new a.init(1779033703,4089235720),new a.init(3144134277,2227873595),new a.init(1013904242,4271175723),new a.init(2773480762,1595750129),new a.init(1359893119,2917565137),new a.init(2600822924,725511199),new a.init(528734635,4215389547),new a.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],h=r[6],f=r[7],d=n.high,p=n.low,m=i.high,v=i.low,g=o.high,y=o.low,_=a.high,w=a.low,b=s.high,x=s.low,k=l.high,A=l.low,M=h.high,S=h.low,P=f.high,T=f.low,O=d,C=p,E=m,I=v,R=g,L=y,j=_,z=w,B=b,D=x,N=k,U=A,F=M,H=S,V=P,W=T,G=0;G<80;G++){var Y=c[G];if(G<16)var K=Y.high=0|e[t+2*G],X=Y.low=0|e[t+2*G+1];else{var Z=c[G-15],q=Z.high,Q=Z.low,J=(q>>>1|Q<<31)^(q>>>8|Q<<24)^q>>>7,$=(Q>>>1|q<<31)^(Q>>>8|q<<24)^(Q>>>7|q<<25),ee=c[G-2],te=ee.high,re=ee.low,ne=(te>>>19|re<<13)^(te<<3|re>>>29)^te>>>6,ie=(re>>>19|te<<13)^(re<<3|te>>>29)^(re>>>6|te<<26),oe=c[G-7],ae=oe.high,se=oe.low,le=c[G-16],ue=le.high,ce=le.low,X=$+se,K=J+ae+(X>>>0<$>>>0?1:0),X=X+ie,K=K+ne+(X>>>0<ie>>>0?1:0),X=X+ce,K=K+ue+(X>>>0<ce>>>0?1:0);Y.high=K,Y.low=X}var he=B&N^~B&F,fe=D&U^~D&H,de=O&E^O&R^E&R,pe=C&I^C&L^I&L,me=(O>>>28|C<<4)^(O<<30|C>>>2)^(O<<25|C>>>7),ve=(C>>>28|O<<4)^(C<<30|O>>>2)^(C<<25|O>>>7),ge=(B>>>14|D<<18)^(B>>>18|D<<14)^(B<<23|D>>>9),ye=(D>>>14|B<<18)^(D>>>18|B<<14)^(D<<23|B>>>9),_e=u[G],we=_e.high,be=_e.low,xe=W+ye,ke=V+ge+(xe>>>0<W>>>0?1:0),xe=xe+fe,ke=ke+he+(xe>>>0<fe>>>0?1:0),xe=xe+be,ke=ke+we+(xe>>>0<be>>>0?1:0),xe=xe+X,ke=ke+K+(xe>>>0<X>>>0?1:0),Ae=ve+pe,Me=me+de+(Ae>>>0<ve>>>0?1:0);V=F,W=H,F=N,H=U,N=B,U=D,B=j+ke+((D=z+xe|0)>>>0<z>>>0?1:0)|0,j=R,z=L,R=E,L=I,E=O,I=C,O=ke+Me+((C=xe+Ae|0)>>>0<xe>>>0?1:0)|0}p=n.low=p+C,n.high=d+O+(p>>>0<C>>>0?1:0),v=i.low=v+I,i.high=m+E+(v>>>0<I>>>0?1:0),y=o.low=y+L,o.high=g+R+(y>>>0<L>>>0?1:0),w=a.low=w+z,a.high=_+j+(w>>>0<z>>>0?1:0),x=s.low=x+D,s.high=b+B+(x>>>0<D>>>0?1:0),A=l.low=A+U,l.high=k+N+(A>>>0<U>>>0?1:0),S=h.low=S+H,h.high=M+F+(S>>>0<H>>>0?1:0),T=f.low=T+W,f.high=P+V+(T>>>0<W>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[30+(n+128>>>10<<5)]=Math.floor(r/4294967296),t[31+(n+128>>>10<<5)]=r,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});r.SHA512=i._createHelper(h),r.HmacSHA512=i._createHmacHelper(h)}(),e.SHA512}(r(1),r(15))},function(e,t,r){"use strict";function n(e,t){if(t<65537&&(e.subarray&&a||!e.subarray&&o))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r}var i=r(4),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(e){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=!1}for(var s=new i.Buf8(256),l=0;l<256;l++)s[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;s[254]=s[254]=1,t.string2buf=function(e){var t,r,n,o,a,s=e.length,l=0;for(o=0;o<s;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(n=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=new i.Buf8(l),a=0,o=0;a<l;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(n=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),r<128?t[a++]=r:r<2048?(t[a++]=192|r>>>6,t[a++]=128|63&r):r<65536?(t[a++]=224|r>>>12,t[a++]=128|r>>>6&63,t[a++]=128|63&r):(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63,t[a++]=128|r>>>6&63,t[a++]=128|63&r);return t},t.buf2binstring=function(e){return n(e,e.length)},t.binstring2buf=function(e){for(var t=new i.Buf8(e.length),r=0,n=t.length;r<n;r++)t[r]=e.charCodeAt(r);return t},t.buf2string=function(e,t){var r,i,o,a,l=t||e.length,u=new Array(2*l);for(i=0,r=0;r<l;)if((o=e[r++])<128)u[i++]=o;else if((a=s[o])>4)u[i++]=65533,r+=a-1;else{for(o&=2===a?31:3===a?15:7;a>1&&r<l;)o=o<<6|63&e[r++],a--;a>1?u[i++]=65533:o<65536?u[i++]=o:(o-=65536,u[i++]=55296|o>>10&1023,u[i++]=56320|1023&o)}return n(u,i)},t.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0?t:0===r?t:r+s[e[r]]>t?r:t}},function(e,t,r){"use strict";e.exports=function(e,t,r,n){for(var i=65535&e|0,o=e>>>16&65535|0,a=0;0!==r;){r-=a=r>2e3?2e3:r;do{o=o+(i=i+t[n++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0}},function(e,t,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,r){"use strict";var n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();e.exports=function(e,t,r,i){var o=n,a=i+r;e^=-1;for(var s=i;s<a;s++)e=e>>>8^o[255&(e^t[s])];return-1^e}},function(e,t,r){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){var r=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var n;try{(n=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),n=n.getBlob()}catch(t){n=new Blob([e])}return new Worker(r.createObjectURL(n))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}},function(e,t,r){e.exports=function(){return r(64)('!function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var r={};e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=9)}([function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var i={arraySet:function(t,e,r,n,i){if(e.subarray&&t.subarray)return void t.set(e.subarray(r,r+n),i);for(var a=0;a<n;a++)t[i+a]=e[r+a]},flattenChunks:function(t){var e,r,n,i,a,o;for(n=0,e=0,r=t.length;e<r;e++)n+=t[e].length;for(o=new Uint8Array(n),i=0,e=0,r=t.length;e<r;e++)a=t[e],o.set(a,i),i+=a.length;return o}},a={arraySet:function(t,e,r,n,i){for(var a=0;a<n;a++)t[i+a]=e[r+a]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,i)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,a))},e.setTyped(n)},function(t,e,r){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(t,e,r){"use strict";function n(t,e){if(e<65537&&(t.subarray&&o||!t.subarray&&a))return String.fromCharCode.apply(null,i.shrinkBuf(t,e));for(var r="",n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r}var i=r(0),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(t){a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){o=!1}for(var s=new i.Buf8(256),h=0;h<256;h++)s[h]=h>=252?6:h>=248?5:h>=240?4:h>=224?3:h>=192?2:1;s[254]=s[254]=1,e.string2buf=function(t){var e,r,n,a,o,s=t.length,h=0;for(a=0;a<s;a++)r=t.charCodeAt(a),55296==(64512&r)&&a+1<s&&56320==(64512&(n=t.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),h+=r<128?1:r<2048?2:r<65536?3:4;for(e=new i.Buf8(h),o=0,a=0;o<h;a++)r=t.charCodeAt(a),55296==(64512&r)&&a+1<s&&56320==(64512&(n=t.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),r<128?e[o++]=r:r<2048?(e[o++]=192|r>>>6,e[o++]=128|63&r):r<65536?(e[o++]=224|r>>>12,e[o++]=128|r>>>6&63,e[o++]=128|63&r):(e[o++]=240|r>>>18,e[o++]=128|r>>>12&63,e[o++]=128|r>>>6&63,e[o++]=128|63&r);return e},e.buf2binstring=function(t){return n(t,t.length)},e.binstring2buf=function(t){for(var e=new i.Buf8(t.length),r=0,n=e.length;r<n;r++)e[r]=t.charCodeAt(r);return e},e.buf2string=function(t,e){var r,i,a,o,h=e||t.length,f=new Array(2*h);for(i=0,r=0;r<h;)if((a=t[r++])<128)f[i++]=a;else if((o=s[a])>4)f[i++]=65533,r+=o-1;else{for(a&=2===o?31:3===o?15:7;o>1&&r<h;)a=a<<6|63&t[r++],o--;o>1?f[i++]=65533:a<65536?f[i++]=a:(a-=65536,f[i++]=55296|a>>10&1023,f[i++]=56320|1023&a)}return n(f,i)},e.utf8border=function(t,e){var r;for(e=e||t.length,e>t.length&&(e=t.length),r=e-1;r>=0&&128==(192&t[r]);)r--;return r<0?e:0===r?e:r+s[t[r]]>e?r:e}},function(t,e,r){"use strict";function n(t,e,r,n){for(var i=65535&t|0,a=t>>>16&65535|0,o=0;0!==r;){o=r>2e3?2e3:r,r-=o;do{i=i+e[n++]|0,a=a+i|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}t.exports=n},function(t,e,r){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(t,e,r){"use strict";function n(t,e,r,n){var a=i,o=n+r;t^=-1;for(var s=n;s<o;s++)t=t>>>8^a[255&(t^e[s])];return-1^t}var i=function(){for(var t,e=[],r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}();t.exports=n},function(t,e,r){"use strict";function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=n},function(t,e,r){"use strict";(function(t){function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(t.length!==e.length)return!1;for(var r=t.length;r--;)if(t[r]!==e[r])return!1;return!0}function a(t,e){return(t[e]<<24)+(t[e+1]<<16)+(t[e+2]<<8)+(t[e+3]<<0)}function o(t,e){return t[e]<<0}function s(t){for(var e="",r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e}function h(t){if("string"==typeof t){var e=t;t=new Array(e.length);for(var r=0,n=e.length;r<n;r++)t[r]=e[r].charCodeAt(0)}else{"ArrayBuffer"===g.call(t).slice(8,-1)&&(t=new Uint8Array(t))}this.i=0,this.bytes=t,this.png=new c.default,this.dataChunks=[]}Object.defineProperty(e,"__esModule",{value:!0});var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=r(14),l=n(u),d=r(8),c=n(d),_=function(t,e){try{var r=l.default.inflate(t);e(null,r)}catch(t){e(t)}},p=Array.prototype.slice,g=Object.prototype.toString;h.prototype.readBytes=function(t){var e=this.i+t;if(e>this.bytes.length)throw new Error("Unexpectedly reached end of file");var r=p.call(this.bytes,this.i,e);return this.i=e,r},h.prototype.decodeHeader=function(){if(0!==this.i)throw new Error("file pointer should be at 0 to read the header");var t=this.readBytes(8);if(!i(t,[137,80,78,71,13,10,26,10]))throw new Error("invalid PNGReader file (bad signature)");this.header=t},h.prototype.decodeChunk=function(){var t=a(this.readBytes(4),0);if(t<0)throw new Error("Bad chunk length "+(4294967295&t));var e=s(this.readBytes(4)),r=this.readBytes(t),n=this.readBytes(4);switch(e){case"IHDR":this.decodeIHDR(r);break;case"PLTE":this.decodePLTE(r);break;case"IDAT":this.decodeIDAT(r);break;case"IEND":this.decodeIEND(r)}return{}.crc=n,e},h.prototype.decodeIHDR=function(t){var e=this.png;e.setWidth(a(t,0)),e.setHeight(a(t,4)),e.setBitDepth(o(t,8)),e.setColorType(o(t,9)),e.setCompressionMethod(o(t,10)),e.setFilterMethod(o(t,11)),e.setInterlaceMethod(o(t,12))},h.prototype.decodePLTE=function(t){this.png.setPalette(t)},h.prototype.decodeIDAT=function(t){this.dataChunks.push(t)},h.prototype.decodeIEND=function(){},h.prototype.decodePixels=function(e){var r,n,i,a,o=this.png,s=this,h=0;for(a=this.dataChunks.length;a--;)h+=this.dataChunks[a].length;var f=new t(h);for(r=0,i=0,a=this.dataChunks.length;r<a;r++){var u=this.dataChunks[r];for(n=0;n<u.length;n++)f[i++]=u[n]}_(f,function(t,r){if(t)return e(t);try{0===o.getInterlaceMethod()?s.interlaceNone(r):s.interlaceAdam7(r)}catch(t){return e(t)}e()})},h.prototype.interlaceNone=function(e){for(var r,n=this.png,i=Math.max(1,n.colors*n.bitDepth/8),a=i*n.width,s=new t(i*n.width*n.height),h=0,f=0;f<e.length;f+=a+1){switch(r=p.call(e,f+1,f+a+1),o(e,f)){case 0:this.unFilterNone(r,s,i,h,a);break;case 1:this.unFilterSub(r,s,i,h,a);break;case 2:this.unFilterUp(r,s,i,h,a);break;case 3:this.unFilterAverage(r,s,i,h,a);break;case 4:this.unFilterPaeth(r,s,i,h,a);break;default:throw new Error("unkown filtered scanline")}h+=a}n.pixels=s},h.prototype.interlaceAdam7=function(t){throw new Error("Adam7 interlacing is not implemented yet")},h.prototype.unFilterNone=function(t,e,r,n,i){for(var a=0,o=i;a<o;a++)e[n+a]=t[a]},h.prototype.unFilterSub=function(t,e,r,n,i){for(var a=0;a<r;a++)e[n+a]=t[a];for(;a<i;a++)e[n+a]=t[a]+e[n+a-r]&255},h.prototype.unFilterUp=function(t,e,r,n,i){var a=0;if(n-i<0)for(;a<i;a++)e[n+a]=t[a];else for(;a<i;a++){var o=t[a],s=e[n+a-i];e[n+a]=o+s&255}},h.prototype.unFilterAverage=function(t,e,r,n,i){var a=0;if(n-i<0){for(;a<r;a++)e[n+a]=t[a];for(;a<i;a++)e[n+a]=t[a]+(e[n+a-r]>>1)&255}else{for(;a<r;a++)e[n+a]=t[a]+(e[n-i+a]>>1)&255;for(;a<i;a++){var o=t[a],s=e[n+a-r],h=e[n+a-i];e[n+a]=o+(s+h>>1)&255}}},h.prototype.unFilterPaeth=function(t,e,r,n,i){var a=0;if(n-i<0){for(;a<r;a++)e[n+a]=t[a];for(;a<i;a++)e[n+a]=t[a]+e[n+a-r]&255}else{for(;a<r;a++)e[n+a]=t[a]+e[n+a-i]&255;for(;a<i;a++){var o=t[a],s=e[n+a-r],h=e[n+a-i],f=e[n+a-i-r],u=s+h-f,l=Math.abs(u-s),d=Math.abs(u-h),c=Math.abs(u-f),_=void 0;_=l<=d&&l<=c?s:d<=c?h:f,e[n+a]=o+_&255}}},h.prototype.parse=function(t,e){"function"==typeof t&&(e=t),"object"!==(void 0===t?"undefined":f(t))&&(t={});try{for(this.decodeHeader();this.i<this.bytes.length;){var r=this.decodeChunk();if("IHDR"===r&&!1===t.data||"IEND"===r)break}var n=this.png;this.decodePixels(function(t){e(t,n)})}catch(t){e(t)}},e.default=h}).call(e,r(11).Buffer)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){this.width=0,this.height=0,this.bitDepth=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.alpha=!1,this.pixelBits=0,this.palette=null,this.pixels=null};n.prototype.getWidth=function(){return this.width},n.prototype.setWidth=function(t){this.width=t},n.prototype.getHeight=function(){return this.height},n.prototype.setHeight=function(t){this.height=t},n.prototype.getBitDepth=function(){return this.bitDepth},n.prototype.setBitDepth=function(t){if(-1===[2,4,8,16].indexOf(t))throw new Error("invalid bith depth "+t);this.bitDepth=t},n.prototype.getColorType=function(){return this.colorType},n.prototype.setColorType=function(t){var e=0,r=!1;switch(t){case 0:e=1;break;case 2:e=3;break;case 3:e=1;break;case 4:e=2,r=!0;break;case 6:e=4,r=!0;break;default:throw new Error("invalid color type")}this.colors=e,this.alpha=r,this.colorType=t},n.prototype.getCompressionMethod=function(){return this.compressionMethod},n.prototype.setCompressionMethod=function(t){if(0!==t)throw new Error("invalid compression method "+t);this.compressionMethod=t},n.prototype.getFilterMethod=function(){return this.filterMethod},n.prototype.setFilterMethod=function(t){if(0!==t)throw new Error("invalid filter method "+t);this.filterMethod=t},n.prototype.getInterlaceMethod=function(){return this.interlaceMethod},n.prototype.setInterlaceMethod=function(t){if(0!==t&&1!==t)throw new Error("invalid interlace method "+t);this.interlaceMethod=t},n.prototype.setPalette=function(t){if(t.length%3!=0)throw new Error("incorrect PLTE chunk length");if(t.length>3*Math.pow(2,this.bitDepth))throw new Error("palette has more colors than 2^bitdepth");this.palette=t},n.prototype.getPalette=function(){return this.palette},n.prototype.getPixel=function(t,e){if(!this.pixels)throw new Error("pixel data is empty");if(t>=this.width||e>=this.height)throw new Error("x,y position out of bound");var r=this.colors*this.bitDepth/8*(e*this.width+t),n=this.pixels;switch(this.colorType){case 0:return[n[r],n[r],n[r],255];case 2:return[n[r],n[r+1],n[r+2],255];case 3:return[this.palette[3*n[r]+0],this.palette[3*n[r]+1],this.palette[3*n[r]+2],255];case 4:return[n[r],n[r],n[r],n[r+1]];case 6:return[n[r],n[r+1],n[r+2],n[r+3]]}},e.default=n},function(t,e,r){"use strict";var n=r(7),i=function(t){return t&&t.__esModule?t:{default:t}}(n);onmessage=function(t){var e=t.data.path,r=t.data.filename,n=t.data.key,a=new XMLHttpRequest;a.open("GET",e,!0),a.timeout=3e4,a.responseType="arraybuffer",a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status){var t=a.response,e=new i.default(t);e.parse(function(e,i){if(e)throw console.warn("BundleLoader parse error",e),e;var o=i.getWidth(),s=i.getHeight(),h=i.pixels;postMessage({key:n,filename:r,status:a.status,pixels:h,width:o,height:s}),t=null})}else postMessage({key:n,filename:r,status:a.status,data:null})},a.send()},onerror=function(t){throw console.error("BundleLoader error",t),t}},function(t,e,r){"use strict";function n(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[e-2]?2:"="===t[e-1]?1:0}function i(t){return 3*t.length/4-n(t)}function a(t){var e,r,i,a,o,s=t.length;a=n(t),o=new l(3*s/4-a),r=a>0?s-4:s;var h=0;for(e=0;e<r;e+=4)i=u[t.charCodeAt(e)]<<18|u[t.charCodeAt(e+1)]<<12|u[t.charCodeAt(e+2)]<<6|u[t.charCodeAt(e+3)],o[h++]=i>>16&255,o[h++]=i>>8&255,o[h++]=255&i;return 2===a?(i=u[t.charCodeAt(e)]<<2|u[t.charCodeAt(e+1)]>>4,o[h++]=255&i):1===a&&(i=u[t.charCodeAt(e)]<<10|u[t.charCodeAt(e+1)]<<4|u[t.charCodeAt(e+2)]>>2,o[h++]=i>>8&255,o[h++]=255&i),o}function o(t){return f[t>>18&63]+f[t>>12&63]+f[t>>6&63]+f[63&t]}function s(t,e,r){for(var n,i=[],a=e;a<r;a+=3)n=(t[a]<<16)+(t[a+1]<<8)+t[a+2],i.push(o(n));return i.join("")}function h(t){for(var e,r=t.length,n=r%3,i="",a=[],o=0,h=r-n;o<h;o+=16383)a.push(s(t,o,o+16383>h?h:o+16383));return 1===n?(e=t[r-1],i+=f[e>>2],i+=f[e<<4&63],i+="=="):2===n&&(e=(t[r-2]<<8)+t[r-1],i+=f[e>>10],i+=f[e>>4&63],i+=f[e<<2&63],i+="="),a.push(i),a.join("")}e.byteLength=i,e.toByteArray=a,e.fromByteArray=h;for(var f=[],u=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,_=d.length;c<_;++c)f[c]=d[c],u[d.charCodeAt(c)]=c;u["-".charCodeAt(0)]=62,u["_".charCodeAt(0)]=63},function(t,e,r){"use strict";(function(t){function n(){return a.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function i(t,e){if(n()<e)throw new RangeError("Invalid typed array length");return a.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e),t.__proto__=a.prototype):(null===t&&(t=new a(e)),t.length=e),t}function a(t,e,r){if(!(a.TYPED_ARRAY_SUPPORT||this instanceof a))return new a(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return f(this,t)}return o(this,t,e,r)}function o(t,e,r,n){if("number"==typeof e)throw new TypeError(\'"value" argument must not be a number\');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?d(t,e,r,n):"string"==typeof e?u(t,e,r):c(t,e)}function s(t){if("number"!=typeof t)throw new TypeError(\'"size" argument must be a number\');if(t<0)throw new RangeError(\'"size" argument must not be negative\')}function h(t,e,r,n){return s(e),e<=0?i(t,e):void 0!==r?"string"==typeof n?i(t,e).fill(r,n):i(t,e).fill(r):i(t,e)}function f(t,e){if(s(e),t=i(t,e<0?0:0|_(e)),!a.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function u(t,e,r){if("string"==typeof r&&""!==r||(r="utf8"),!a.isEncoding(r))throw new TypeError(\'"encoding" must be a valid string encoding\');var n=0|g(e,r);t=i(t,n);var o=t.write(e,r);return o!==n&&(t=t.slice(0,o)),t}function l(t,e){var r=e.length<0?0:0|_(e.length);t=i(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function d(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("\'offset\' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("\'length\' is out of bounds");return e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n),a.TYPED_ARRAY_SUPPORT?(t=e,t.__proto__=a.prototype):t=l(t,e),t}function c(t,e){if(a.isBuffer(e)){var r=0|_(e.length);return t=i(t,r),0===t.length?t:(e.copy(t,0,0,r),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||q(e.length)?i(t,0):l(t,e);if("Buffer"===e.type&&Q(e.data))return l(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function _(t){if(t>=n())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n().toString(16)+" bytes");return 0|t}function p(t){return+t!=t&&(t=0),a.alloc(+t)}function g(t,e){if(a.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return j(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return W(t).length;default:if(n)return j(t).length;e=(""+e).toLowerCase(),n=!0}}function w(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if(r>>>=0,e>>>=0,r<=e)return"";for(t||(t="utf8");;)switch(t){case"hex":return I(this,e,r);case"utf8":case"utf-8":return R(this,e,r);case"ascii":return T(this,e,r);case"latin1":case"binary":return P(this,e,r);case"base64":return z(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function b(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function v(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=a.from(e,n)),a.isBuffer(e))return 0===e.length?-1:m(t,e,r,n,i);if("number"==typeof e)return e&=255,a.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):m(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function m(t,e,r,n,i){function a(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}var o=1,s=t.length,h=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;o=2,s/=2,h/=2,r/=2}var f;if(i){var u=-1;for(f=r;f<s;f++)if(a(t,f)===a(e,-1===u?0:f-u)){if(-1===u&&(u=f),f-u+1===h)return u*o}else-1!==u&&(f-=f-u),u=-1}else for(r+h>s&&(r=s-h),f=r;f>=0;f--){for(var l=!0,d=0;d<h;d++)if(a(t,f+d)!==a(e,d)){l=!1;break}if(l)return f}return-1}function y(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=e.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var o=0;o<n;++o){var s=parseInt(e.substr(2*o,2),16);if(isNaN(s))return o;t[r+o]=s}return o}function k(t,e,r,n){return X(j(e,t.length-r),t,r,n)}function x(t,e,r,n){return X(K(e),t,r,n)}function E(t,e,r,n){return x(t,e,r,n)}function A(t,e,r,n){return X(W(e),t,r,n)}function B(t,e,r,n){return X(G(e,t.length-r),t,r,n)}function z(t,e,r){return 0===e&&r===t.length?V.fromByteArray(t):V.fromByteArray(t.slice(e,r))}function R(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var a=t[i],o=null,s=a>239?4:a>223?3:a>191?2:1;if(i+s<=r){var h,f,u,l;switch(s){case 1:a<128&&(o=a);break;case 2:h=t[i+1],128==(192&h)&&(l=(31&a)<<6|63&h)>127&&(o=l);break;case 3:h=t[i+1],f=t[i+2],128==(192&h)&&128==(192&f)&&(l=(15&a)<<12|(63&h)<<6|63&f)>2047&&(l<55296||l>57343)&&(o=l);break;case 4:h=t[i+1],f=t[i+2],u=t[i+3],128==(192&h)&&128==(192&f)&&128==(192&u)&&(l=(15&a)<<18|(63&h)<<12|(63&f)<<6|63&u)>65535&&l<1114112&&(o=l)}}null===o?(o=65533,s=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|1023&o),n.push(o),i+=s}return S(n)}function S(t){var e=t.length;if(e<=$)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=$));return r}function T(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function P(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function I(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=e;a<r;++a)i+=H(t[a]);return i}function U(t,e,r){for(var n=t.slice(e,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function C(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function D(t,e,r,n,i,o){if(!a.isBuffer(t))throw new TypeError(\'"buffer" argument must be a Buffer instance\');if(e>i||e<o)throw new RangeError(\'"value" argument is out of bounds\');if(r+n>t.length)throw new RangeError("Index out of range")}function M(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,a=Math.min(t.length-r,2);i<a;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function O(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,a=Math.min(t.length-r,4);i<a;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function L(t,e,r,n,i,a){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function N(t,e,r,n,i){return i||L(t,e,r,4,3.4028234663852886e38,-3.4028234663852886e38),J.write(t,e,r,n,23,4),r+4}function Y(t,e,r,n,i){return i||L(t,e,r,8,1.7976931348623157e308,-1.7976931348623157e308),J.write(t,e,r,n,52,8),r+8}function Z(t){if(t=F(t).replace(tt,""),t.length<2)return"";for(;t.length%4!=0;)t+="=";return t}function F(t){return t.trim?t.trim():t.replace(/^\\s+|\\s+$/g,"")}function H(t){return t<16?"0"+t.toString(16):t.toString(16)}function j(t,e){e=e||1/0;for(var r,n=t.length,i=null,a=[],o=0;o<n;++o){if((r=t.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&a.push(239,191,189);continue}if(o+1===n){(e-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;a.push(r)}else if(r<2048){if((e-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function K(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}function G(t,e){for(var r,n,i,a=[],o=0;o<t.length&&!((e-=2)<0);++o)r=t.charCodeAt(o),n=r>>8,i=r%256,a.push(i),a.push(n);return a}function W(t){return V.toByteArray(Z(t))}function X(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function q(t){return t!==t}var V=r(10),J=r(12),Q=r(13);e.Buffer=a,e.SlowBuffer=p,e.INSPECT_MAX_BYTES=50,a.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=n(),a.poolSize=8192,a._augment=function(t){return t.__proto__=a.prototype,t},a.from=function(t,e,r){return o(null,t,e,r)},a.TYPED_ARRAY_SUPPORT&&(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0})),a.alloc=function(t,e,r){return h(null,t,e,r)},a.allocUnsafe=function(t){return f(null,t)},a.allocUnsafeSlow=function(t){return f(null,t)},a.isBuffer=function(t){return!(null==t||!t._isBuffer)},a.compare=function(t,e){if(!a.isBuffer(t)||!a.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},a.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(t,e){if(!Q(t))throw new TypeError(\'"list" argument must be an Array of Buffers\');if(0===t.length)return a.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=a.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var o=t[r];if(!a.isBuffer(o))throw new TypeError(\'"list" argument must be an Array of Buffers\');o.copy(n,i),i+=o.length}return n},a.byteLength=g,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)b(this,e,e+1);return this},a.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)b(this,e,e+3),b(this,e+1,e+2);return this},a.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)b(this,e,e+7),b(this,e+1,e+6),b(this,e+2,e+5),b(this,e+3,e+4);return this},a.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?R(this,0,t):w.apply(this,arguments)},a.prototype.equals=function(t){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===a.compare(this,t)},a.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},a.prototype.compare=function(t,e,r,n,i){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(e>>>=0,r>>>=0,n>>>=0,i>>>=0,this===t)return 0;for(var o=i-n,s=r-e,h=Math.min(o,s),f=this.slice(n,i),u=t.slice(e,r),l=0;l<h;++l)if(f[l]!==u[l]){o=f[l],s=u[l];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},a.prototype.indexOf=function(t,e,r){return v(this,t,e,r,!0)},a.prototype.lastIndexOf=function(t,e,r){return v(this,t,e,r,!1)},a.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return y(this,t,e,r);case"utf8":case"utf-8":return k(this,t,e,r);case"ascii":return x(this,t,e,r);case"latin1":case"binary":return E(this,t,e,r);case"base64":return A(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,t,e,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var $=4096;a.prototype.slice=function(t,e){var r=this.length;t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);var n;if(a.TYPED_ARRAY_SUPPORT)n=this.subarray(t,e),n.__proto__=a.prototype;else{var i=e-t;n=new a(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+t]}return n},a.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=this[t],i=1,a=0;++a<e&&(i*=256);)n+=this[t+a]*i;return n},a.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},a.prototype.readUInt8=function(t,e){return e||C(t,1,this.length),this[t]},a.prototype.readUInt16LE=function(t,e){return e||C(t,2,this.length),this[t]|this[t+1]<<8},a.prototype.readUInt16BE=function(t,e){return e||C(t,2,this.length),this[t]<<8|this[t+1]},a.prototype.readUInt32LE=function(t,e){return e||C(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},a.prototype.readUInt32BE=function(t,e){return e||C(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},a.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=this[t],i=1,a=0;++a<e&&(i*=256);)n+=this[t+a]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*e)),n},a.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=e,i=1,a=this[t+--n];n>0&&(i*=256);)a+=this[t+--n]*i;return i*=128,a>=i&&(a-=Math.pow(2,8*e)),a},a.prototype.readInt8=function(t,e){return e||C(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},a.prototype.readInt16LE=function(t,e){e||C(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},a.prototype.readInt16BE=function(t,e){e||C(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},a.prototype.readInt32LE=function(t,e){return e||C(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},a.prototype.readInt32BE=function(t,e){return e||C(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},a.prototype.readFloatLE=function(t,e){return e||C(t,4,this.length),J.read(this,t,!0,23,4)},a.prototype.readFloatBE=function(t,e){return e||C(t,4,this.length),J.read(this,t,!1,23,4)},a.prototype.readDoubleLE=function(t,e){return e||C(t,8,this.length),J.read(this,t,!0,52,8)},a.prototype.readDoubleBE=function(t,e){return e||C(t,8,this.length),J.read(this,t,!1,52,8)},a.prototype.writeUIntLE=function(t,e,r,n){if(t=+t,e|=0,r|=0,!n){D(this,t,e,r,Math.pow(2,8*r)-1,0)}var i=1,a=0;for(this[e]=255&t;++a<r&&(i*=256);)this[e+a]=t/i&255;return e+r},a.prototype.writeUIntBE=function(t,e,r,n){if(t=+t,e|=0,r|=0,!n){D(this,t,e,r,Math.pow(2,8*r)-1,0)}var i=r-1,a=1;for(this[e+i]=255&t;--i>=0&&(a*=256);)this[e+i]=t/a&255;return e+r},a.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||D(this,t,e,1,255,0),a.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},a.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||D(this,t,e,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):M(this,t,e,!0),e+2},a.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||D(this,t,e,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):M(this,t,e,!1),e+2},a.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||D(this,t,e,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):O(this,t,e,!0),e+4},a.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||D(this,t,e,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):O(this,t,e,!1),e+4},a.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);D(this,t,e,r,i-1,-i)}var a=0,o=1,s=0;for(this[e]=255&t;++a<r&&(o*=256);)t<0&&0===s&&0!==this[e+a-1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+r},a.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);D(this,t,e,r,i-1,-i)}var a=r-1,o=1,s=0;for(this[e+a]=255&t;--a>=0&&(o*=256);)t<0&&0===s&&0!==this[e+a+1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+r},a.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||D(this,t,e,1,127,-128),a.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},a.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||D(this,t,e,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):M(this,t,e,!0),e+2},a.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||D(this,t,e,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):M(this,t,e,!1),e+2},a.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||D(this,t,e,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):O(this,t,e,!0),e+4},a.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||D(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):O(this,t,e,!1),e+4},a.prototype.writeFloatLE=function(t,e,r){return N(this,t,e,!0,r)},a.prototype.writeFloatBE=function(t,e,r){return N(this,t,e,!1,r)},a.prototype.writeDoubleLE=function(t,e,r){return Y(this,t,e,!0,r)},a.prototype.writeDoubleBE=function(t,e,r){return Y(this,t,e,!1,r)},a.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i,o=n-r;if(this===t&&r<e&&e<n)for(i=o-1;i>=0;--i)t[i+e]=this[i+r];else if(o<1e3||!a.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+o),e);return o},a.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!a.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0);var o;if("number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{var s=a.isBuffer(t)?t:j(new a(t,n).toString()),h=s.length;for(o=0;o<r-e;++o)this[o+e]=s[o%h]}return this};var tt=/[^+\\/0-9A-Za-z-_]/g}).call(e,r(23))},function(t,e){e.read=function(t,e,r,n,i){var a,o,s=8*i-n-1,h=(1<<s)-1,f=h>>1,u=-7,l=r?i-1:0,d=r?-1:1,c=t[e+l];for(l+=d,a=c&(1<<-u)-1,c>>=-u,u+=s;u>0;a=256*a+t[e+l],l+=d,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=n;u>0;o=256*o+t[e+l],l+=d,u-=8);if(0===a)a=1-f;else{if(a===h)return o?NaN:1/0*(c?-1:1);o+=Math.pow(2,n),a-=f}return(c?-1:1)*o*Math.pow(2,a-n)},e.write=function(t,e,r,n,i,a){var o,s,h,f=8*a-i-1,u=(1<<f)-1,l=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,c=n?0:a-1,_=n?1:-1,p=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-o))<1&&(o--,h*=2),e+=o+l>=1?d/h:d*Math.pow(2,1-l),e*h>=2&&(o++,h/=2),o+l>=u?(s=0,o=u):o+l>=1?(s=(e*h-1)*Math.pow(2,i),o+=l):(s=e*Math.pow(2,l-1)*Math.pow(2,i),o=0));i>=8;t[r+c]=255&s,c+=_,s/=256,i-=8);for(o=o<<i|s,f+=i;f>0;t[r+c]=255&o,c+=_,o/=256,f-=8);t[r+c-_]|=128*p}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e,r){"use strict";var n=r(0).assign,i=r(15),a=r(16),o=r(4),s={};n(s,i,a,o),t.exports=s},function(t,e,r){"use strict";function n(t){if(!(this instanceof n))return new n(t);this.options=h.assign({level:_,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var r=s.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==c)throw new Error(u[r]);if(e.header&&s.deflateSetHeader(this.strm,e.header),e.dictionary){var i;if(i="string"==typeof e.dictionary?f.string2buf(e.dictionary):"[object ArrayBuffer]"===d.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(r=s.deflateSetDictionary(this.strm,i))!==c)throw new Error(u[r]);this._dict_set=!0}}function i(t,e){var r=new n(e);if(r.push(t,!0),r.err)throw r.msg;return r.result}function a(t,e){return e=e||{},e.raw=!0,i(t,e)}function o(t,e){return e=e||{},e.gzip=!0,i(t,e)}var s=r(17),h=r(0),f=r(2),u=r(1),l=r(6),d=Object.prototype.toString,c=0,_=-1,p=0,g=8;n.prototype.push=function(t,e){var r,n,i=this.strm,a=this.options.chunkSize;if(this.ended)return!1;n=e===~~e?e:!0===e?4:0,"string"==typeof t?i.input=f.string2buf(t):"[object ArrayBuffer]"===d.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new h.Buf8(a),i.next_out=0,i.avail_out=a),1!==(r=s.deflate(i,n))&&r!==c)return this.onEnd(r),this.ended=!0,!1;0!==i.avail_out&&(0!==i.avail_in||4!==n&&2!==n)||("string"===this.options.to?this.onData(f.buf2binstring(h.shrinkBuf(i.output,i.next_out))):this.onData(h.shrinkBuf(i.output,i.next_out)))}while((i.avail_in>0||0===i.avail_out)&&1!==r);return 4===n?(r=s.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===c):2!==n||(this.onEnd(c),i.avail_out=0,!0)},n.prototype.onData=function(t){this.chunks.push(t)},n.prototype.onEnd=function(t){t===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Deflate=n,e.deflate=i,e.deflateRaw=a,e.gzip=o},function(t,e,r){"use strict";function n(t){if(!(this instanceof n))return new n(t);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var r=o.inflateInit2(this.strm,e.windowBits);if(r!==f.Z_OK)throw new Error(u[r]);this.header=new d,o.inflateGetHeader(this.strm,this.header)}function i(t,e){var r=new n(e);if(r.push(t,!0),r.err)throw r.msg;return r.result}function a(t,e){return e=e||{},e.raw=!0,i(t,e)}var o=r(20),s=r(0),h=r(2),f=r(4),u=r(1),l=r(6),d=r(18),c=Object.prototype.toString;n.prototype.push=function(t,e){var r,n,i,a,u,l,d=this.strm,_=this.options.chunkSize,p=this.options.dictionary,g=!1;if(this.ended)return!1;n=e===~~e?e:!0===e?f.Z_FINISH:f.Z_NO_FLUSH,"string"==typeof t?d.input=h.binstring2buf(t):"[object ArrayBuffer]"===c.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new s.Buf8(_),d.next_out=0,d.avail_out=_),r=o.inflate(d,f.Z_NO_FLUSH),r===f.Z_NEED_DICT&&p&&(l="string"==typeof p?h.string2buf(p):"[object ArrayBuffer]"===c.call(p)?new Uint8Array(p):p,r=o.inflateSetDictionary(this.strm,l)),r===f.Z_BUF_ERROR&&!0===g&&(r=f.Z_OK,g=!1),r!==f.Z_STREAM_END&&r!==f.Z_OK)return this.onEnd(r),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&r!==f.Z_STREAM_END&&(0!==d.avail_in||n!==f.Z_FINISH&&n!==f.Z_SYNC_FLUSH)||("string"===this.options.to?(i=h.utf8border(d.output,d.next_out),a=d.next_out-i,u=h.buf2string(d.output,i),d.next_out=a,d.avail_out=_-a,a&&s.arraySet(d.output,d.output,i,a,0),this.onData(u)):this.onData(s.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(g=!0)}while((d.avail_in>0||0===d.avail_out)&&r!==f.Z_STREAM_END);return r===f.Z_STREAM_END&&(n=f.Z_FINISH),n===f.Z_FINISH?(r=o.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===f.Z_OK):n!==f.Z_SYNC_FLUSH||(this.onEnd(f.Z_OK),d.avail_out=0,!0)},n.prototype.onData=function(t){this.chunks.push(t)},n.prototype.onEnd=function(t){t===f.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Inflate=n,e.inflate=i,e.inflateRaw=a,e.ungzip=i},function(t,e,r){"use strict";function n(t,e){return t.msg=C[e],e}function i(t){return(t<<1)-(t>4?9:0)}function a(t){for(var e=t.length;--e>=0;)t[e]=0}function o(t){var e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out),0!==r&&(T.arraySet(t.output,e.pending_buf,e.pending_out,r,t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))}function s(t,e){P._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,o(t.strm)}function h(t,e){t.pending_buf[t.pending++]=e}function f(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function u(t,e,r,n){var i=t.avail_in;return i>n&&(i=n),0===i?0:(t.avail_in-=i,T.arraySet(e,t.input,t.next_in,i,r),1===t.state.wrap?t.adler=I(t.adler,e,i,r):2===t.state.wrap&&(t.adler=U(t.adler,e,i,r)),t.next_in+=i,t.total_in+=i,i)}function l(t,e){var r,n,i=t.max_chain_length,a=t.strstart,o=t.prev_length,s=t.nice_match,h=t.strstart>t.w_size-ft?t.strstart-(t.w_size-ft):0,f=t.window,u=t.w_mask,l=t.prev,d=t.strstart+ht,c=f[a+o-1],_=f[a+o];t.prev_length>=t.good_match&&(i>>=2),s>t.lookahead&&(s=t.lookahead);do{if(r=e,f[r+o]===_&&f[r+o-1]===c&&f[r]===f[a]&&f[++r]===f[a+1]){a+=2,r++;do{}while(f[++a]===f[++r]&&f[++a]===f[++r]&&f[++a]===f[++r]&&f[++a]===f[++r]&&f[++a]===f[++r]&&f[++a]===f[++r]&&f[++a]===f[++r]&&f[++a]===f[++r]&&a<d);if(n=ht-(d-a),a=d-ht,n>o){if(t.match_start=e,o=n,n>=s)break;c=f[a+o-1],_=f[a+o]}}}while((e=l[e&u])>h&&0!=--i);return o<=t.lookahead?o:t.lookahead}function d(t){var e,r,n,i,a,o=t.w_size;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=o+(o-ft)){T.arraySet(t.window,t.window,o,o,0),t.match_start-=o,t.strstart-=o,t.block_start-=o,r=t.hash_size,e=r;do{n=t.head[--e],t.head[e]=n>=o?n-o:0}while(--r);r=o,e=r;do{n=t.prev[--e],t.prev[e]=n>=o?n-o:0}while(--r);i+=o}if(0===t.strm.avail_in)break;if(r=u(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=r,t.lookahead+t.insert>=st)for(a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+st-1])&t.hash_mask,t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,!(t.lookahead+t.insert<st)););}while(t.lookahead<ft&&0!==t.strm.avail_in)}function c(t,e){var r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(d(t),0===t.lookahead&&e===D)return bt;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+r;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,s(t,!1),0===t.strm.avail_out))return bt;if(t.strstart-t.block_start>=t.w_size-ft&&(s(t,!1),0===t.strm.avail_out))return bt}return t.insert=0,e===L?(s(t,!0),0===t.strm.avail_out?mt:yt):(t.strstart>t.block_start&&(s(t,!1),t.strm.avail_out),bt)}function _(t,e){for(var r,n;;){if(t.lookahead<ft){if(d(t),t.lookahead<ft&&e===D)return bt;if(0===t.lookahead)break}if(r=0,t.lookahead>=st&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+st-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-ft&&(t.match_length=l(t,r)),t.match_length>=st)if(n=P._tr_tally(t,t.strstart-t.match_start,t.match_length-st),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=st){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+st-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=P._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(s(t,!1),0===t.strm.avail_out))return bt}return t.insert=t.strstart<st-1?t.strstart:st-1,e===L?(s(t,!0),0===t.strm.avail_out?mt:yt):t.last_lit&&(s(t,!1),0===t.strm.avail_out)?bt:vt}function p(t,e){for(var r,n,i;;){if(t.lookahead<ft){if(d(t),t.lookahead<ft&&e===D)return bt;if(0===t.lookahead)break}if(r=0,t.lookahead>=st&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+st-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=st-1,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-ft&&(t.match_length=l(t,r),t.match_length<=5&&(t.strategy===G||t.match_length===st&&t.strstart-t.match_start>4096)&&(t.match_length=st-1)),t.prev_length>=st&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-st,n=P._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-st),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+st-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=st-1,t.strstart++,n&&(s(t,!1),0===t.strm.avail_out))return bt}else if(t.match_available){if(n=P._tr_tally(t,0,t.window[t.strstart-1]),n&&s(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return bt}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=P._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<st-1?t.strstart:st-1,e===L?(s(t,!0),0===t.strm.avail_out?mt:yt):t.last_lit&&(s(t,!1),0===t.strm.avail_out)?bt:vt}function g(t,e){for(var r,n,i,a,o=t.window;;){if(t.lookahead<=ht){if(d(t),t.lookahead<=ht&&e===D)return bt;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=st&&t.strstart>0&&(i=t.strstart-1,(n=o[i])===o[++i]&&n===o[++i]&&n===o[++i])){a=t.strstart+ht;do{}while(n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&i<a);t.match_length=ht-(a-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=st?(r=P._tr_tally(t,1,t.match_length-st),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=P._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(s(t,!1),0===t.strm.avail_out))return bt}return t.insert=0,e===L?(s(t,!0),0===t.strm.avail_out?mt:yt):t.last_lit&&(s(t,!1),0===t.strm.avail_out)?bt:vt}function w(t,e){for(var r;;){if(0===t.lookahead&&(d(t),0===t.lookahead)){if(e===D)return bt;break}if(t.match_length=0,r=P._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(s(t,!1),0===t.strm.avail_out))return bt}return t.insert=0,e===L?(s(t,!0),0===t.strm.avail_out?mt:yt):t.last_lit&&(s(t,!1),0===t.strm.avail_out)?bt:vt}function b(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}function v(t){t.window_size=2*t.w_size,a(t.head),t.max_lazy_match=S[t.level].max_lazy,t.good_match=S[t.level].good_length,t.nice_match=S[t.level].nice_length,t.max_chain_length=S[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=st-1,t.match_available=0,t.ins_h=0}function m(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Q,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new T.Buf16(2*at),this.dyn_dtree=new T.Buf16(2*(2*nt+1)),this.bl_tree=new T.Buf16(2*(2*it+1)),a(this.dyn_ltree),a(this.dyn_dtree),a(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new T.Buf16(ot+1),this.heap=new T.Buf16(2*rt+1),a(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new T.Buf16(2*rt+1),a(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function y(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=J,e=t.state,e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?lt:gt,t.adler=2===e.wrap?0:1,e.last_flush=D,P._tr_init(e),Y):n(t,F)}function k(t){var e=y(t);return e===Y&&v(t.state),e}function x(t,e){return t&&t.state?2!==t.state.wrap?F:(t.state.gzhead=e,Y):F}function E(t,e,r,i,a,o){if(!t)return F;var s=1;if(e===K&&(e=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),a<1||a>$||r!==Q||i<8||i>15||e<0||e>9||o<0||o>q)return n(t,F);8===i&&(i=9);var h=new m;return t.state=h,h.strm=t,h.wrap=s,h.gzhead=null,h.w_bits=i,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=a+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+st-1)/st),h.window=new T.Buf8(2*h.w_size),h.head=new T.Buf16(h.hash_size),h.prev=new T.Buf16(h.w_size),h.lit_bufsize=1<<a+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new T.Buf8(h.pending_buf_size),h.d_buf=1*h.lit_bufsize,h.l_buf=3*h.lit_bufsize,h.level=e,h.strategy=o,h.method=r,k(t)}function A(t,e){return E(t,e,Q,tt,et,V)}function B(t,e){var r,s,u,l;if(!t||!t.state||e>N||e<0)return t?n(t,F):F;if(s=t.state,!t.output||!t.input&&0!==t.avail_in||s.status===wt&&e!==L)return n(t,0===t.avail_out?j:F);if(s.strm=t,r=s.last_flush,s.last_flush=e,s.status===lt)if(2===s.wrap)t.adler=0,h(s,31),h(s,139),h(s,8),s.gzhead?(h(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),h(s,255&s.gzhead.time),h(s,s.gzhead.time>>8&255),h(s,s.gzhead.time>>16&255),h(s,s.gzhead.time>>24&255),h(s,9===s.level?2:s.strategy>=W||s.level<2?4:0),h(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(h(s,255&s.gzhead.extra.length),h(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=U(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=dt):(h(s,0),h(s,0),h(s,0),h(s,0),h(s,0),h(s,9===s.level?2:s.strategy>=W||s.level<2?4:0),h(s,kt),s.status=gt);else{var d=Q+(s.w_bits-8<<4)<<8,c=-1;c=s.strategy>=W||s.level<2?0:s.level<6?1:6===s.level?2:3,d|=c<<6,0!==s.strstart&&(d|=ut),d+=31-d%31,s.status=gt,f(s,d),0!==s.strstart&&(f(s,t.adler>>>16),f(s,65535&t.adler)),t.adler=1}if(s.status===dt)if(s.gzhead.extra){for(u=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>u&&(t.adler=U(t.adler,s.pending_buf,s.pending-u,u)),o(t),u=s.pending,s.pending!==s.pending_buf_size));)h(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>u&&(t.adler=U(t.adler,s.pending_buf,s.pending-u,u)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=ct)}else s.status=ct;if(s.status===ct)if(s.gzhead.name){u=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>u&&(t.adler=U(t.adler,s.pending_buf,s.pending-u,u)),o(t),u=s.pending,s.pending===s.pending_buf_size)){l=1;break}l=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,h(s,l)}while(0!==l);s.gzhead.hcrc&&s.pending>u&&(t.adler=U(t.adler,s.pending_buf,s.pending-u,u)),0===l&&(s.gzindex=0,s.status=_t)}else s.status=_t;if(s.status===_t)if(s.gzhead.comment){u=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>u&&(t.adler=U(t.adler,s.pending_buf,s.pending-u,u)),o(t),u=s.pending,s.pending===s.pending_buf_size)){l=1;break}l=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,h(s,l)}while(0!==l);s.gzhead.hcrc&&s.pending>u&&(t.adler=U(t.adler,s.pending_buf,s.pending-u,u)),0===l&&(s.status=pt)}else s.status=pt;if(s.status===pt&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&o(t),s.pending+2<=s.pending_buf_size&&(h(s,255&t.adler),h(s,t.adler>>8&255),t.adler=0,s.status=gt)):s.status=gt),0!==s.pending){if(o(t),0===t.avail_out)return s.last_flush=-1,Y}else if(0===t.avail_in&&i(e)<=i(r)&&e!==L)return n(t,j);if(s.status===wt&&0!==t.avail_in)return n(t,j);if(0!==t.avail_in||0!==s.lookahead||e!==D&&s.status!==wt){var _=s.strategy===W?w(s,e):s.strategy===X?g(s,e):S[s.level].func(s,e);if(_!==mt&&_!==yt||(s.status=wt),_===bt||_===mt)return 0===t.avail_out&&(s.last_flush=-1),Y;if(_===vt&&(e===M?P._tr_align(s):e!==N&&(P._tr_stored_block(s,0,0,!1),e===O&&(a(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),o(t),0===t.avail_out))return s.last_flush=-1,Y}return e!==L?Y:s.wrap<=0?Z:(2===s.wrap?(h(s,255&t.adler),h(s,t.adler>>8&255),h(s,t.adler>>16&255),h(s,t.adler>>24&255),h(s,255&t.total_in),h(s,t.total_in>>8&255),h(s,t.total_in>>16&255),h(s,t.total_in>>24&255)):(f(s,t.adler>>>16),f(s,65535&t.adler)),o(t),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?Y:Z)}function z(t){var e;return t&&t.state?(e=t.state.status)!==lt&&e!==dt&&e!==ct&&e!==_t&&e!==pt&&e!==gt&&e!==wt?n(t,F):(t.state=null,e===gt?n(t,H):Y):F}function R(t,e){var r,n,i,o,s,h,f,u,l=e.length;if(!t||!t.state)return F;if(r=t.state,2===(o=r.wrap)||1===o&&r.status!==lt||r.lookahead)return F;for(1===o&&(t.adler=I(t.adler,e,l,0)),r.wrap=0,l>=r.w_size&&(0===o&&(a(r.head),r.strstart=0,r.block_start=0,r.insert=0),u=new T.Buf8(r.w_size),T.arraySet(u,e,l-r.w_size,r.w_size,0),e=u,l=r.w_size),s=t.avail_in,h=t.next_in,f=t.input,t.avail_in=l,t.next_in=0,t.input=e,d(r);r.lookahead>=st;){n=r.strstart,i=r.lookahead-(st-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+st-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--i);r.strstart=n,r.lookahead=st-1,d(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=st-1,r.match_available=0,t.next_in=h,t.input=f,t.avail_in=s,r.wrap=o,Y}var S,T=r(0),P=r(22),I=r(3),U=r(5),C=r(1),D=0,M=1,O=3,L=4,N=5,Y=0,Z=1,F=-2,H=-3,j=-5,K=-1,G=1,W=2,X=3,q=4,V=0,J=2,Q=8,$=9,tt=15,et=8,rt=286,nt=30,it=19,at=2*rt+1,ot=15,st=3,ht=258,ft=ht+st+1,ut=32,lt=42,dt=69,ct=73,_t=91,pt=103,gt=113,wt=666,bt=1,vt=2,mt=3,yt=4,kt=3;S=[new b(0,0,0,0,c),new b(4,4,8,4,_),new b(4,5,16,8,_),new b(4,6,32,32,_),new b(4,4,16,16,p),new b(8,16,32,32,p),new b(8,16,128,128,p),new b(8,32,128,256,p),new b(32,128,258,1024,p),new b(32,258,258,4096,p)],e.deflateInit=A,e.deflateInit2=E,e.deflateReset=k,e.deflateResetKeep=y,e.deflateSetHeader=x,e.deflate=B,e.deflateEnd=z,e.deflateSetDictionary=R,e.deflateInfo="pako deflate (from Nodeca project)"},function(t,e,r){"use strict";function n(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=n},function(t,e,r){"use strict";t.exports=function(t,e){var r,n,i,a,o,s,h,f,u,l,d,c,_,p,g,w,b,v,m,y,k,x,E,A,B;r=t.state,n=t.next_in,A=t.input,i=n+(t.avail_in-5),a=t.next_out,B=t.output,o=a-(e-t.avail_out),s=a+(t.avail_out-257),h=r.dmax,f=r.wsize,u=r.whave,l=r.wnext,d=r.window,c=r.hold,_=r.bits,p=r.lencode,g=r.distcode,w=(1<<r.lenbits)-1,b=(1<<r.distbits)-1;t:do{_<15&&(c+=A[n++]<<_,_+=8,c+=A[n++]<<_,_+=8),v=p[c&w];e:for(;;){if(m=v>>>24,c>>>=m,_-=m,0===(m=v>>>16&255))B[a++]=65535&v;else{if(!(16&m)){if(0==(64&m)){v=p[(65535&v)+(c&(1<<m)-1)];continue e}if(32&m){r.mode=12;break t}t.msg="invalid literal/length code",r.mode=30;break t}y=65535&v,m&=15,m&&(_<m&&(c+=A[n++]<<_,_+=8),y+=c&(1<<m)-1,c>>>=m,_-=m),_<15&&(c+=A[n++]<<_,_+=8,c+=A[n++]<<_,_+=8),v=g[c&b];r:for(;;){if(m=v>>>24,c>>>=m,_-=m,!(16&(m=v>>>16&255))){if(0==(64&m)){v=g[(65535&v)+(c&(1<<m)-1)];continue r}t.msg="invalid distance code",r.mode=30;break t}if(k=65535&v,m&=15,_<m&&(c+=A[n++]<<_,(_+=8)<m&&(c+=A[n++]<<_,_+=8)),(k+=c&(1<<m)-1)>h){t.msg="invalid distance too far back",r.mode=30;break t}if(c>>>=m,_-=m,m=a-o,k>m){if((m=k-m)>u&&r.sane){t.msg="invalid distance too far back",r.mode=30;break t}if(x=0,E=d,0===l){if(x+=f-m,m<y){y-=m;do{B[a++]=d[x++]}while(--m);x=a-k,E=B}}else if(l<m){if(x+=f+l-m,(m-=l)<y){y-=m;do{B[a++]=d[x++]}while(--m);if(x=0,l<y){m=l,y-=m;do{B[a++]=d[x++]}while(--m);x=a-k,E=B}}}else if(x+=l-m,m<y){y-=m;do{B[a++]=d[x++]}while(--m);x=a-k,E=B}for(;y>2;)B[a++]=E[x++],B[a++]=E[x++],B[a++]=E[x++],y-=3;y&&(B[a++]=E[x++],y>1&&(B[a++]=E[x++]))}else{x=a-k;do{B[a++]=B[x++],B[a++]=B[x++],B[a++]=B[x++],y-=3}while(y>2);y&&(B[a++]=B[x++],y>1&&(B[a++]=B[x++]))}break}}break}}while(n<i&&a<s);y=_>>3,n-=y,_-=y<<3,c&=(1<<_)-1,t.next_in=n,t.next_out=a,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=a<s?s-a+257:257-(a-s),r.hold=c,r.bits=_}},function(t,e,r){"use strict";function n(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new b.Buf16(320),this.work=new b.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=O,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new b.Buf32(pt),e.distcode=e.distdyn=new b.Buf32(gt),e.sane=1,e.back=-1,S):I}function o(t){var e;return t&&t.state?(e=t.state,e.wsize=0,e.whave=0,e.wnext=0,a(t)):I}function s(t,e){var r,n;return t&&t.state?(n=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?I:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,o(t))):I}function h(t,e){var r,n;return t?(n=new i,t.state=n,n.window=null,r=s(t,e),r!==S&&(t.state=null),r):I}function f(t){return h(t,wt)}function u(t){if(bt){var e;for(g=new b.Buf32(512),w=new b.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(k(E,t.lens,0,288,g,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;k(A,t.lens,0,32,w,0,t.work,{bits:5}),bt=!1}t.lencode=g,t.lenbits=9,t.distcode=w,t.distbits=5}function l(t,e,r,n){var i,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new b.Buf8(a.wsize)),n>=a.wsize?(b.arraySet(a.window,e,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>n&&(i=n),b.arraySet(a.window,e,r-n,i,a.wnext),n-=i,n?(b.arraySet(a.window,e,r-n,n,0),a.wnext=n,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0}function d(t,e){var r,i,a,o,s,h,f,d,c,_,p,g,w,pt,gt,wt,bt,vt,mt,yt,kt,xt,Et,At,Bt=0,zt=new b.Buf8(4),Rt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return I;r=t.state,r.mode===X&&(r.mode=q),s=t.next_out,a=t.output,f=t.avail_out,o=t.next_in,i=t.input,h=t.avail_in,d=r.hold,c=r.bits,_=h,p=f,xt=S;t:for(;;)switch(r.mode){case O:if(0===r.wrap){r.mode=q;break}for(;c<16;){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}if(2&r.wrap&&35615===d){r.check=0,zt[0]=255&d,zt[1]=d>>>8&255,r.check=m(r.check,zt,2,0),d=0,c=0,r.mode=L;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&d)<<8)+(d>>8))%31){t.msg="incorrect header check",r.mode=dt;break}if((15&d)!==M){t.msg="unknown compression method",r.mode=dt;break}if(d>>>=4,c-=4,kt=8+(15&d),0===r.wbits)r.wbits=kt;else if(kt>r.wbits){t.msg="invalid window size",r.mode=dt;break}r.dmax=1<<kt,t.adler=r.check=1,r.mode=512&d?G:X,d=0,c=0;break;case L:for(;c<16;){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}if(r.flags=d,(255&r.flags)!==M){t.msg="unknown compression method",r.mode=dt;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=dt;break}r.head&&(r.head.text=d>>8&1),512&r.flags&&(zt[0]=255&d,zt[1]=d>>>8&255,r.check=m(r.check,zt,2,0)),d=0,c=0,r.mode=N;case N:for(;c<32;){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}r.head&&(r.head.time=d),512&r.flags&&(zt[0]=255&d,zt[1]=d>>>8&255,zt[2]=d>>>16&255,zt[3]=d>>>24&255,r.check=m(r.check,zt,4,0)),d=0,c=0,r.mode=Y;case Y:for(;c<16;){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}r.head&&(r.head.xflags=255&d,r.head.os=d>>8),512&r.flags&&(zt[0]=255&d,zt[1]=d>>>8&255,r.check=m(r.check,zt,2,0)),d=0,c=0,r.mode=Z;case Z:if(1024&r.flags){for(;c<16;){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}r.length=d,r.head&&(r.head.extra_len=d),512&r.flags&&(zt[0]=255&d,zt[1]=d>>>8&255,r.check=m(r.check,zt,2,0)),d=0,c=0}else r.head&&(r.head.extra=null);r.mode=F;case F:if(1024&r.flags&&(g=r.length,g>h&&(g=h),g&&(r.head&&(kt=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),b.arraySet(r.head.extra,i,o,g,kt)),512&r.flags&&(r.check=m(r.check,i,g,o)),h-=g,o+=g,r.length-=g),r.length))break t;r.length=0,r.mode=H;case H:if(2048&r.flags){if(0===h)break t;g=0;do{kt=i[o+g++],r.head&&kt&&r.length<65536&&(r.head.name+=String.fromCharCode(kt))}while(kt&&g<h);if(512&r.flags&&(r.check=m(r.check,i,g,o)),h-=g,o+=g,kt)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=j;case j:if(4096&r.flags){if(0===h)break t;g=0;do{kt=i[o+g++],r.head&&kt&&r.length<65536&&(r.head.comment+=String.fromCharCode(kt))}while(kt&&g<h);if(512&r.flags&&(r.check=m(r.check,i,g,o)),h-=g,o+=g,kt)break t}else r.head&&(r.head.comment=null);r.mode=K;case K:if(512&r.flags){for(;c<16;){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}if(d!==(65535&r.check)){t.msg="header crc mismatch",r.mode=dt;break}d=0,c=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=X;break;case G:for(;c<32;){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}t.adler=r.check=n(d),d=0,c=0,r.mode=W;case W:if(0===r.havedict)return t.next_out=s,t.avail_out=f,t.next_in=o,t.avail_in=h,r.hold=d,r.bits=c,P;t.adler=r.check=1,r.mode=X;case X:if(e===z||e===R)break t;case q:if(r.last){d>>>=7&c,c-=7&c,r.mode=ft;break}for(;c<3;){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}switch(r.last=1&d,d>>>=1,c-=1,3&d){case 0:r.mode=V;break;case 1:if(u(r),r.mode=rt,e===R){d>>>=2,c-=2;break t}break;case 2:r.mode=$;break;case 3:t.msg="invalid block type",r.mode=dt}d>>>=2,c-=2;break;case V:for(d>>>=7&c,c-=7&c;c<32;){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}if((65535&d)!=(d>>>16^65535)){t.msg="invalid stored block lengths",r.mode=dt;break}if(r.length=65535&d,d=0,c=0,r.mode=J,e===R)break t;case J:r.mode=Q;case Q:if(g=r.length){if(g>h&&(g=h),g>f&&(g=f),0===g)break t;b.arraySet(a,i,o,g,s),h-=g,o+=g,f-=g,s+=g,r.length-=g;break}r.mode=X;break;case $:for(;c<14;){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}if(r.nlen=257+(31&d),d>>>=5,c-=5,r.ndist=1+(31&d),d>>>=5,c-=5,r.ncode=4+(15&d),d>>>=4,c-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=dt;break}r.have=0,r.mode=tt;case tt:for(;r.have<r.ncode;){for(;c<3;){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}r.lens[Rt[r.have++]]=7&d,d>>>=3,c-=3}for(;r.have<19;)r.lens[Rt[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,Et={bits:r.lenbits},xt=k(x,r.lens,0,19,r.lencode,0,r.work,Et),r.lenbits=Et.bits,xt){t.msg="invalid code lengths set",r.mode=dt;break}r.have=0,r.mode=et;case et:for(;r.have<r.nlen+r.ndist;){for(;Bt=r.lencode[d&(1<<r.lenbits)-1],gt=Bt>>>24,wt=Bt>>>16&255,bt=65535&Bt,!(gt<=c);){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}if(bt<16)d>>>=gt,c-=gt,r.lens[r.have++]=bt;else{if(16===bt){for(At=gt+2;c<At;){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}if(d>>>=gt,c-=gt,0===r.have){t.msg="invalid bit length repeat",r.mode=dt;break}kt=r.lens[r.have-1],g=3+(3&d),d>>>=2,c-=2}else if(17===bt){for(At=gt+3;c<At;){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}d>>>=gt,c-=gt,kt=0,g=3+(7&d),d>>>=3,c-=3}else{for(At=gt+7;c<At;){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}d>>>=gt,c-=gt,kt=0,g=11+(127&d),d>>>=7,c-=7}if(r.have+g>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=dt;break}for(;g--;)r.lens[r.have++]=kt}}if(r.mode===dt)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=dt;break}if(r.lenbits=9,Et={bits:r.lenbits},xt=k(E,r.lens,0,r.nlen,r.lencode,0,r.work,Et),r.lenbits=Et.bits,xt){t.msg="invalid literal/lengths set",r.mode=dt;break}if(r.distbits=6,r.distcode=r.distdyn,Et={bits:r.distbits},xt=k(A,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,Et),r.distbits=Et.bits,xt){t.msg="invalid distances set",r.mode=dt;break}if(r.mode=rt,e===R)break t;case rt:r.mode=nt;case nt:if(h>=6&&f>=258){t.next_out=s,t.avail_out=f,t.next_in=o,t.avail_in=h,r.hold=d,r.bits=c,y(t,p),s=t.next_out,a=t.output,f=t.avail_out,o=t.next_in,i=t.input,h=t.avail_in,d=r.hold,c=r.bits,r.mode===X&&(r.back=-1);break}for(r.back=0;Bt=r.lencode[d&(1<<r.lenbits)-1],gt=Bt>>>24,wt=Bt>>>16&255,bt=65535&Bt,!(gt<=c);){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}if(wt&&0==(240&wt)){for(vt=gt,mt=wt,yt=bt;Bt=r.lencode[yt+((d&(1<<vt+mt)-1)>>vt)],gt=Bt>>>24,wt=Bt>>>16&255,bt=65535&Bt,!(vt+gt<=c);){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}d>>>=vt,c-=vt,r.back+=vt}if(d>>>=gt,c-=gt,r.back+=gt,r.length=bt,0===wt){r.mode=ht;break}if(32&wt){r.back=-1,r.mode=X;break}if(64&wt){t.msg="invalid literal/length code",r.mode=dt;break}r.extra=15&wt,r.mode=it;case it:if(r.extra){for(At=r.extra;c<At;){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}r.length+=d&(1<<r.extra)-1,d>>>=r.extra,c-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=at;case at:for(;Bt=r.distcode[d&(1<<r.distbits)-1],gt=Bt>>>24,wt=Bt>>>16&255,bt=65535&Bt,!(gt<=c);){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}if(0==(240&wt)){for(vt=gt,mt=wt,yt=bt;Bt=r.distcode[yt+((d&(1<<vt+mt)-1)>>vt)],gt=Bt>>>24,wt=Bt>>>16&255,bt=65535&Bt,!(vt+gt<=c);){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}d>>>=vt,c-=vt,r.back+=vt}if(d>>>=gt,c-=gt,r.back+=gt,64&wt){t.msg="invalid distance code",r.mode=dt;break}r.offset=bt,r.extra=15&wt,r.mode=ot;case ot:if(r.extra){for(At=r.extra;c<At;){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}r.offset+=d&(1<<r.extra)-1,d>>>=r.extra,c-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=dt;break}r.mode=st;case st:if(0===f)break t;if(g=p-f,r.offset>g){if((g=r.offset-g)>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=dt;break}g>r.wnext?(g-=r.wnext,w=r.wsize-g):w=r.wnext-g,g>r.length&&(g=r.length),pt=r.window}else pt=a,w=s-r.offset,g=r.length;g>f&&(g=f),f-=g,r.length-=g;do{a[s++]=pt[w++]}while(--g);0===r.length&&(r.mode=nt);break;case ht:if(0===f)break t;a[s++]=r.length,f--,r.mode=nt;break;case ft:if(r.wrap){for(;c<32;){if(0===h)break t;h--,d|=i[o++]<<c,c+=8}if(p-=f,t.total_out+=p,r.total+=p,p&&(t.adler=r.check=r.flags?m(r.check,a,p,s-p):v(r.check,a,p,s-p)),p=f,(r.flags?d:n(d))!==r.check){t.msg="incorrect data check",r.mode=dt;break}d=0,c=0}r.mode=ut;case ut:if(r.wrap&&r.flags){for(;c<32;){if(0===h)break t;h--,d+=i[o++]<<c,c+=8}if(d!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=dt;break}d=0,c=0}r.mode=lt;case lt:xt=T;break t;case dt:xt=U;break t;case ct:return C;case _t:default:return I}return t.next_out=s,t.avail_out=f,t.next_in=o,t.avail_in=h,r.hold=d,r.bits=c,(r.wsize||p!==t.avail_out&&r.mode<dt&&(r.mode<ft||e!==B))&&l(t,t.output,t.next_out,p-t.avail_out)?(r.mode=ct,C):(_-=t.avail_in,p-=t.avail_out,t.total_in+=_,t.total_out+=p,r.total+=p,r.wrap&&p&&(t.adler=r.check=r.flags?m(r.check,a,p,t.next_out-p):v(r.check,a,p,t.next_out-p)),t.data_type=r.bits+(r.last?64:0)+(r.mode===X?128:0)+(r.mode===rt||r.mode===J?256:0),(0===_&&0===p||e===B)&&xt===S&&(xt=D),xt)}function c(t){if(!t||!t.state)return I;var e=t.state;return e.window&&(e.window=null),t.state=null,S}function _(t,e){var r;return t&&t.state?(r=t.state,0==(2&r.wrap)?I:(r.head=e,e.done=!1,S)):I}function p(t,e){var r,n,i=e.length;return t&&t.state?(r=t.state,0!==r.wrap&&r.mode!==W?I:r.mode===W&&(n=1,(n=v(n,e,i,0))!==r.check)?U:l(t,e,i,i)?(r.mode=ct,C):(r.havedict=1,S)):I}var g,w,b=r(0),v=r(3),m=r(5),y=r(19),k=r(21),x=0,E=1,A=2,B=4,z=5,R=6,S=0,T=1,P=2,I=-2,U=-3,C=-4,D=-5,M=8,O=1,L=2,N=3,Y=4,Z=5,F=6,H=7,j=8,K=9,G=10,W=11,X=12,q=13,V=14,J=15,Q=16,$=17,tt=18,et=19,rt=20,nt=21,it=22,at=23,ot=24,st=25,ht=26,ft=27,ut=28,lt=29,dt=30,ct=31,_t=32,pt=852,gt=592,wt=15,bt=!0;e.inflateReset=o,e.inflateReset2=s,e.inflateResetKeep=a,e.inflateInit=f,e.inflateInit2=h,e.inflate=d,e.inflateEnd=c,e.inflateGetHeader=_,e.inflateSetDictionary=p,e.inflateInfo="pako inflate (from Nodeca project)"},function(t,e,r){"use strict";var n=r(0),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,e,r,h,f,u,l,d){var c,_,p,g,w,b,v,m,y,k=d.bits,x=0,E=0,A=0,B=0,z=0,R=0,S=0,T=0,P=0,I=0,U=null,C=0,D=new n.Buf16(16),M=new n.Buf16(16),O=null,L=0;for(x=0;x<=15;x++)D[x]=0;for(E=0;E<h;E++)D[e[r+E]]++;for(z=k,B=15;B>=1&&0===D[B];B--);if(z>B&&(z=B),0===B)return f[u++]=20971520,f[u++]=20971520,d.bits=1,0;for(A=1;A<B&&0===D[A];A++);for(z<A&&(z=A),T=1,x=1;x<=15;x++)if(T<<=1,(T-=D[x])<0)return-1;if(T>0&&(0===t||1!==B))return-1;for(M[1]=0,x=1;x<15;x++)M[x+1]=M[x]+D[x];for(E=0;E<h;E++)0!==e[r+E]&&(l[M[e[r+E]]++]=E);if(0===t?(U=O=l,b=19):1===t?(U=i,C-=257,O=a,L-=257,b=256):(U=o,O=s,b=-1),I=0,E=0,x=A,w=u,R=z,S=0,p=-1,P=1<<z,g=P-1,1===t&&P>852||2===t&&P>592)return 1;for(var N=0;;){N++,v=x-S,l[E]<b?(m=0,y=l[E]):l[E]>b?(m=O[L+l[E]],y=U[C+l[E]]):(m=96,y=0),c=1<<x-S,_=1<<R,A=_;do{_-=c,f[w+(I>>S)+_]=v<<24|m<<16|y|0}while(0!==_);for(c=1<<x-1;I&c;)c>>=1;if(0!==c?(I&=c-1,I+=c):I=0,E++,0==--D[x]){if(x===B)break;x=e[r+l[E]]}if(x>z&&(I&g)!==p){for(0===S&&(S=z),w+=A,R=x-S,T=1<<R;R+S<B&&!((T-=D[R+S])<=0);)R++,T<<=1;if(P+=1<<R,1===t&&P>852||2===t&&P>592)return 1;p=I&g,f[p]=z<<24|R<<16|w-u|0}}return 0!==I&&(f[w+I]=x-S<<24|64<<16|0),d.bits=z,0}},function(t,e,r){"use strict";function n(t){for(var e=t.length;--e>=0;)t[e]=0}function i(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}function a(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function o(t){return t<256?at[t]:at[256+(t>>>7)]}function s(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function h(t,e,r){t.bi_valid>W-r?(t.bi_buf|=e<<t.bi_valid&65535,s(t,t.bi_buf),t.bi_buf=e>>W-t.bi_valid,t.bi_valid+=r-W):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)}function f(t,e,r){h(t,r[2*e],r[2*e+1])}function u(t,e){var r=0;do{r|=1&t,t>>>=1,r<<=1}while(--e>0);return r>>>1}function l(t){16===t.bi_valid?(s(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}function d(t,e){var r,n,i,a,o,s,h=e.dyn_tree,f=e.max_code,u=e.stat_desc.static_tree,l=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,c=e.stat_desc.extra_base,_=e.stat_desc.max_length,p=0;for(a=0;a<=G;a++)t.bl_count[a]=0;for(h[2*t.heap[t.heap_max]+1]=0,r=t.heap_max+1;r<K;r++)n=t.heap[r],a=h[2*h[2*n+1]+1]+1,a>_&&(a=_,p++),h[2*n+1]=a,n>f||(t.bl_count[a]++,o=0,n>=c&&(o=d[n-c]),s=h[2*n],t.opt_len+=s*(a+o),l&&(t.static_len+=s*(u[2*n+1]+o)));if(0!==p){do{for(a=_-1;0===t.bl_count[a];)a--;t.bl_count[a]--,t.bl_count[a+1]+=2,t.bl_count[_]--,p-=2}while(p>0);for(a=_;0!==a;a--)for(n=t.bl_count[a];0!==n;)(i=t.heap[--r])>f||(h[2*i+1]!==a&&(t.opt_len+=(a-h[2*i+1])*h[2*i],h[2*i+1]=a),n--)}}function c(t,e,r){var n,i,a=new Array(G+1),o=0;for(n=1;n<=G;n++)a[n]=o=o+r[n-1]<<1;for(i=0;i<=e;i++){var s=t[2*i+1];0!==s&&(t[2*i]=u(a[s]++,s))}}function _(){var t,e,r,n,a,o=new Array(G+1);for(r=0,n=0;n<Y-1;n++)for(st[n]=r,t=0;t<1<<$[n];t++)ot[r++]=n;for(ot[r-1]=n,a=0,n=0;n<16;n++)for(ht[n]=a,t=0;t<1<<tt[n];t++)at[a++]=n;for(a>>=7;n<H;n++)for(ht[n]=a<<7,t=0;t<1<<tt[n]-7;t++)at[256+a++]=n;for(e=0;e<=G;e++)o[e]=0;for(t=0;t<=143;)nt[2*t+1]=8,t++,o[8]++;for(;t<=255;)nt[2*t+1]=9,t++,o[9]++;for(;t<=279;)nt[2*t+1]=7,t++,o[7]++;for(;t<=287;)nt[2*t+1]=8,t++,o[8]++;for(c(nt,F+1,o),t=0;t<H;t++)it[2*t+1]=5,it[2*t]=u(t,5);ft=new i(nt,$,Z+1,F,G),ut=new i(it,tt,0,H,G),lt=new i(new Array(0),et,0,j,X)}function p(t){var e;for(e=0;e<F;e++)t.dyn_ltree[2*e]=0;for(e=0;e<H;e++)t.dyn_dtree[2*e]=0;for(e=0;e<j;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*q]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function g(t){t.bi_valid>8?s(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function w(t,e,r,n){g(t),n&&(s(t,r),s(t,~r)),I.arraySet(t.pending_buf,t.window,e,r,t.pending),t.pending+=r}function b(t,e,r,n){var i=2*e,a=2*r;return t[i]<t[a]||t[i]===t[a]&&n[e]<=n[r]}function v(t,e,r){for(var n=t.heap[r],i=r<<1;i<=t.heap_len&&(i<t.heap_len&&b(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!b(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n}function m(t,e,r){var n,i,a,s,u=0;if(0!==t.last_lit)do{n=t.pending_buf[t.d_buf+2*u]<<8|t.pending_buf[t.d_buf+2*u+1],i=t.pending_buf[t.l_buf+u],u++,0===n?f(t,i,e):(a=ot[i],f(t,a+Z+1,e),s=$[a],0!==s&&(i-=st[a],h(t,i,s)),n--,a=o(n),f(t,a,r),0!==(s=tt[a])&&(n-=ht[a],h(t,n,s)))}while(u<t.last_lit);f(t,q,e)}function y(t,e){var r,n,i,a=e.dyn_tree,o=e.stat_desc.static_tree,s=e.stat_desc.has_stree,h=e.stat_desc.elems,f=-1;for(t.heap_len=0,t.heap_max=K,r=0;r<h;r++)0!==a[2*r]?(t.heap[++t.heap_len]=f=r,t.depth[r]=0):a[2*r+1]=0;for(;t.heap_len<2;)i=t.heap[++t.heap_len]=f<2?++f:0,a[2*i]=1,t.depth[i]=0,t.opt_len--,s&&(t.static_len-=o[2*i+1]);for(e.max_code=f,r=t.heap_len>>1;r>=1;r--)v(t,a,r);i=h;do{r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],v(t,a,1),n=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=n,a[2*i]=a[2*r]+a[2*n],t.depth[i]=(t.depth[r]>=t.depth[n]?t.depth[r]:t.depth[n])+1,a[2*r+1]=a[2*n+1]=i,t.heap[1]=i++,v(t,a,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],d(t,e),c(a,f,t.bl_count)}function k(t,e,r){var n,i,a=-1,o=e[1],s=0,h=7,f=4;for(0===o&&(h=138,f=3),e[2*(r+1)+1]=65535,n=0;n<=r;n++)i=o,o=e[2*(n+1)+1],++s<h&&i===o||(s<f?t.bl_tree[2*i]+=s:0!==i?(i!==a&&t.bl_tree[2*i]++,t.bl_tree[2*V]++):s<=10?t.bl_tree[2*J]++:t.bl_tree[2*Q]++,s=0,a=i,0===o?(h=138,f=3):i===o?(h=6,f=3):(h=7,f=4))}function x(t,e,r){var n,i,a=-1,o=e[1],s=0,u=7,l=4;for(0===o&&(u=138,l=3),n=0;n<=r;n++)if(i=o,o=e[2*(n+1)+1],!(++s<u&&i===o)){if(s<l)do{f(t,i,t.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(f(t,i,t.bl_tree),s--),f(t,V,t.bl_tree),h(t,s-3,2)):s<=10?(f(t,J,t.bl_tree),h(t,s-3,3)):(f(t,Q,t.bl_tree),h(t,s-11,7));s=0,a=i,0===o?(u=138,l=3):i===o?(u=6,l=3):(u=7,l=4)}}function E(t){var e;for(k(t,t.dyn_ltree,t.l_desc.max_code),k(t,t.dyn_dtree,t.d_desc.max_code),y(t,t.bl_desc),e=j-1;e>=3&&0===t.bl_tree[2*rt[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}function A(t,e,r,n){var i;for(h(t,e-257,5),h(t,r-1,5),h(t,n-4,4),i=0;i<n;i++)h(t,t.bl_tree[2*rt[i]+1],3);x(t,t.dyn_ltree,e-1),x(t,t.dyn_dtree,r-1)}function B(t){var e,r=4093624447;for(e=0;e<=31;e++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*e])return C;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return D;for(e=32;e<Z;e++)if(0!==t.dyn_ltree[2*e])return D;return C}function z(t){dt||(_(),dt=!0),t.l_desc=new a(t.dyn_ltree,ft),t.d_desc=new a(t.dyn_dtree,ut),t.bl_desc=new a(t.bl_tree,lt),t.bi_buf=0,t.bi_valid=0,p(t)}function R(t,e,r,n){h(t,(O<<1)+(n?1:0),3),w(t,e,r,!0)}function S(t){h(t,L<<1,3),f(t,q,nt),l(t)}function T(t,e,r,n){var i,a,o=0;t.level>0?(t.strm.data_type===M&&(t.strm.data_type=B(t)),y(t,t.l_desc),y(t,t.d_desc),o=E(t),i=t.opt_len+3+7>>>3,(a=t.static_len+3+7>>>3)<=i&&(i=a)):i=a=r+5,r+4<=i&&-1!==e?R(t,e,r,n):t.strategy===U||a===i?(h(t,(L<<1)+(n?1:0),3),m(t,nt,it)):(h(t,(N<<1)+(n?1:0),3),A(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),m(t,t.dyn_ltree,t.dyn_dtree)),p(t),n&&g(t)}function P(t,e,r){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(ot[r]+Z+1)]++,t.dyn_dtree[2*o(e)]++),t.last_lit===t.lit_bufsize-1}var I=r(0),U=4,C=0,D=1,M=2,O=0,L=1,N=2,Y=29,Z=256,F=Z+1+Y,H=30,j=19,K=2*F+1,G=15,W=16,X=7,q=256,V=16,J=17,Q=18,$=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],tt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],et=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],rt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],nt=new Array(2*(F+2));n(nt);var it=new Array(2*H);n(it);var at=new Array(512);n(at);var ot=new Array(256);n(ot);var st=new Array(Y);n(st);var ht=new Array(H);n(ht);var ft,ut,lt,dt=!1;e._tr_init=z,e._tr_stored_block=R,e._tr_flush_block=T,e._tr_tally=P,e._tr_align=S},function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r}]);\n//# sourceMappingURL=BundleLoader.js.map',r.p+"BundleLoader.js")}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=n(r(40)),a=n(r(9)),s=function(e,t,r,n,i,a){o.default.call(this,e,t,r,n,i,a)};(s.prototype=Object.create(o.default.prototype)).constructor=s,s.prototype.addCamera=function(e,t,r,n,o){var a,s=new i.Vector3(t[0],t[1],t[2]),l=new i.Vector3(t[3],t[4],t[5]),u=new i.Vector3(t[6],t[7],t[8]);u.normalize().multiplyScalar(e),l.normalize().multiplyScalar(u.length()*t[9]);var c=l.clone().cross(u).normalize().multiplyScalar(l.length()*t[10]),h=new Array(4),f=s.clone().add(u);h[0]=f.clone().sub(l).sub(c),h[1]=f.clone().add(l).sub(c),h[2]=f.clone().add(l).add(c),h[3]=f.clone().sub(l).add(c);var d=[h[0],h[1],h[1],h[2],h[2],h[3],h[3],h[0],s,h[0],s,h[1],s,h[2],s,h[3],f,f.clone().sub(c),f,f.clone().sub(l),f,f.clone().sub(u)],p=[];for(a=0;a<22;a++)a<16?p.push({r:.48,g:.45,b:.89}):a<18?p.push({r:1,g:0,b:0}):a<20?p.push({r:0,g:1,b:0}):a<22&&p.push({r:0,g:0,b:1});for(a=0;a<d.length;a++)r[3*(22*o+a)]=d[a].x,r[3*(22*o+a)+1]=d[a].y,r[3*(22*o+a)+2]=d[a].z,n[3*(22*o+a)]=p[a].r,n[3*(22*o+a)+1]=p[a].g,n[3*(22*o+a)+2]=p[a].b},s.prototype.tileLoader=function(){var e,t,r=this;return new Promise(function(n,o){(0,a.default)({method:"get",url:r.getJsName(),timeout:6e6}).then(function(o){var a,s,l,u=o.data,c=new i.BufferGeometry,h=new i.LineBasicMaterial({vertexColors:i.VertexColors});if(u instanceof Array)for(l=parseFloat(u[0][0])/r.length_unit_to_meter,a=new Float32Array(3*(u.length-1)*22),s=new Float32Array(3*(u.length-1)*22),e=1;e<u.length;e++){var f=u[e];for(t=0;t<3;t++)f[t]=f[t]/r.length_unit_to_meter;r.addCamera(l,f,a,s,e-1)}else{l=parseFloat(u.camera_scale/r.length_unit_to_meter);var d=u.camera_info,p=3*d.length*22;for(a=new Float32Array(p),s=new Float32Array(p),e=0;e<d.length;e++){var m=d[e].display;for(t=0;t<3;t++)m[t]=m[t]/r.length_unit_to_meter;r.addCamera(l,m,a,s,e)}}c.addAttribute("position",new i.BufferAttribute(a,3)),c.addAttribute("color",new i.BufferAttribute(s,3));var v=new i.LineSegments(c,h);v.name=r.name,n(v)}).catch(function(e,t,n){console.warn(e,t,n),"timeout"===t&&r.onError(10200),o(n)})})},t.default=s},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=n(r(54)),a=n(r(113)),s=n(r(109)),l=n(r(110)),u=n(r(91)),c=n(r(123)),h=n(r(30)),f=n(r(55)),d=n(r(80)),p=n(r(79)),m=n(r(18)),v=n(r(36)),g=n(r(24)),y=n(r(12)),_=function(e,t,r,n){function _(e){var t=["z-index: 1;","position: relative;","left:0px;","top:0px;","width:100%;","height:100%;","margin:0px;","overflow: hidden !important;","padding:0px;"].join("");return h.default.createDiv(e,"ThreeDiv",t)}function w(e){var t=h.default.createDiv(S.threeContainer,"alti-viewer-attribution no_select"),r=S.config.i18n.basic,n=S.config.projectInfo,i="<span>"+r.copyrightAltizure+'</span><a href="https://www.altizure.com" target="_blank" class="viewer-logo-essential">Altizure™</a>';i=!1!==e?i:"";var o=n.author,a=n.authorLink,s="<span>"+r.copyrightUser+'</span><a href="'+a+'" target="_blank" class="viewer-logo-essential">©'+o+"</a>";s=o?s:"",t.innerHTML=s+i}function b(e,t,r,n){var i=["z-index: 2;","position: absolute;","left:0px;","top:0px;","width:100%;","height:100%;","font-size:12pt;","text-align: center;","vertical-align: middle;","text-align: -webkit-center;","vertical-align: -webkit-middle;","background-color: #"+r.toString(16)+";","color: #"+(16777215-r).toString(16)+";","margin:0px;","padding:0px;"].join(""),o=h.default.createDiv(e,"ErrorDiv",i),a=["position: relative;","top:40%;","font-size:12pt;","text-align: center;","vertical-align: middle;","text-align: -webkit-center;","vertical-align: -webkit-middle;","margin:0px;","padding:0px;"].join(""),s=h.default.createDiv(o,"ErrorTextDiv",a);return s.innerHTML=t,n&&(s.innerHTML+='<br><br><a href="'+n+'" class="btn-link">Learn More</a>'),o}function x(e){if(S.isInitialized){var t=S.clock.getElapsedTime();if(t-A>=.5){S.camera.updateMatrix(),S.camera.updateMatrixWorld(!0),S.camera.updateProjectionMatrix(),S.camera.matrixWorldInverse.getInverse(S.camera.matrixWorld);var r,n=(new i.Matrix4).multiplyMatrices(S.camera.projectionMatrix,S.camera.matrixWorldInverse),o=new i.Frustum;o.setFromMatrix((new i.Matrix4).multiplyMatrices(S.camera.projectionMatrix,S.camera.matrixWorldInverse)),S.dataManager.data.map(function(t){(r=t.tree).updateView(S.camera,n,o),e&&r.loadUnloadedTiles()}),A=t,M=t}}}function k(){if(!S.isInitialized)return!1;var e=!0,t=S.clock.getElapsedTime();if(t-M>=.08){S.camera.updateMatrix(),S.camera.updateMatrixWorld(!0),S.camera.updateProjectionMatrix(),S.camera.matrixWorldInverse.getInverse(S.camera.matrixWorld);var r,n=new i.Frustum;n.setFromMatrix((new i.Matrix4).multiplyMatrices(S.camera.projectionMatrix,S.camera.matrixWorldInverse)),S.dataManager.data.map(function(t){r=t.tree,e=r.updateVisibility(n)&&e}),M=t}return e||console.warn("updateTreeVisibility has a problem"),e}this.rootContainer=null,this.stats=null,this.monitor=null,this.loadingWidget=null,this.buttons={},this.threeContainer=null,this.renderer=null,this.effect=null,this.scene=null,this.widgetScene=null,this.defaultClippingPlanes=null,this.withWidget=!1,this.camera=null,this.cameraControls=null,this.fpsControls=null,this.config=n,this.dataManager=new u.default(t,r,n.tree_options),this.eventQueue=null,this.PID=null,this.lastFrameTime=1e3/60,this.animateFrameTime=1e3/60,this.staticFrameTime=1e3/30,this.frameTimeTorelance=2,this.isAnimating=!1,this.clock=new i.Clock,this.isInitialized=!1;var A=this.clock.getElapsedTime()-1,M=this.clock.getElapsedTime()-.3,S=this;this.toyManager=new a.default,this.ortho_picker=null,this.waterManager=null;var P=void 0;n.API_HOST?P=y.default.AES.decrypt(n.API_HOST,"altizure-environment").toString(y.default.enc.Utf8):(P="http://172.18.22.83:18082/graphql",console.error("Viewer: API_HOST is not defined"));var T=void 0;n.API_KEY?T=y.default.AES.decrypt(n.API_KEY,"altizure-environment").toString(y.default.enc.Utf8):(T="ToA0NQtp92u58EAqyUyKYg5bVBdPNIuFozRkDuq",console.error("Viewer: API_KEY is not defined")),this._altizureApi=new g.default({apiUrl:P,key:T}),n.altitoken&&(this._altizureApi.altitoken=n.altitoken),n.altizureApi=this._altizureApi,function(){if(S.rootContainer=document.getElementById(e),S.rootContainer){S.threeContainer=_(S.rootContainer),w(S.config.showOurLogo),S.eventQueue=new f.default,S.scene=new i.Scene,S.widgetScene=new i.Scene,S.camera=new i.PerspectiveCamera(30,null,1,1e4),S.camera.lookAt(S.scene.position),S.camera.updateProjectionMatrix(),S.scene.add(S.camera);var t=new i.AmbientLight(8421504);S.widgetScene.add(t);var r=new i.PointLight(16777215);if(S.camera.add(r),o.default.webgl){S.renderer=new i.WebGLRenderer({antialias:!0}),S.renderer.setClearColor(new i.Color(S.config.backgroundColor)),S.renderer.setPixelRatio(void 0!==window.devicePixelRatio?window.devicePixelRatio:1),S.threeContainer.appendChild(S.renderer.domElement),S.renderer.context.getExtension("OES_standard_derivatives"),S.renderer.autoClear=!0,S.renderer.autoClearDepth=!0,S.picker=new c.default(S.camera,S.renderer,S.scene),S.ortho_picker=new c.default(S.camera,S.renderer,new i.Plane(new i.Vector3(0,1,0),0)),S.cameraControls=new d.default(S.camera,S.threeContainer,S.picker),S.cameraControls.userPanSpeed=100,S.cameraControls.userZoomSpeed=1,1===n.ui.control_mode&&(S.fpsControls=new p.default(S.camera,S.scene,S.threeContainer),S.fpsControls.addEventListener("changed",function(){x(!0),S.isAnimating=!1,S.threeContainer.dispatchEvent(new CustomEvent("changed"))}),S.fpsControls.addEventListener("changing",function(){k(),S.isAnimating=!1,S.threeContainer.dispatchEvent(new CustomEvent("changing"))}));var a=S.config.isMobile;S.cameraControls.addEventListener("changed",function(){x(!0),S.isAnimating=!1,S.threeContainer.dispatchEvent(new CustomEvent("changed"))}),S.cameraControls.addEventListener("changing",function(){k(),S.isAnimating=!0,S.threeContainer.dispatchEvent(new CustomEvent("changing"))}),S.cameraControls.addEventListener("animating",function(){S.isAnimating=!0,S.threeContainer.dispatchEvent(new CustomEvent("changing"))}),S.threeContainer.addEventListener("resize",function(){S.resize(),x(!0)}),window.addEventListener("resize",function(){S.threeContainer.dispatchEvent(new CustomEvent("resize"))}),window.addEventListener("load_complete",function(e){e.detail===S.dataManager.getTreeByType()&&(S.config.orbit?(S.config.orbit=!1,S.cameraControls.animateOrbit()):S.config.cameraMotion&&(S.config.cameraMotion=!1,S.cameraControls.animateViewpoint()))}),S.threeContainer.addEventListener("dblclick",function(){S.cameraControls.enabled&&S.cameraControls.animateZoomIn()}),a&&!1!==S.config.ui.interact&&(S.cameraControls.userRotateSpeed=3,document.body.style.overflow="hidden");S.dataManager.loadInfo(S.config,function(){S.dataManager.constructSmartTrees(S.scene,S.renderer,n,S.PID);var e=S.dataManager.getDataByType();if(e&&(function(e){n.orbit=e.orbit||n.orbit,S.camera.position.set(null===n.camPosition.x?Number(e.camera_pos.x):n.camPosition.x,null===n.camPosition.y?Number(e.camera_pos.y):n.camPosition.y,null===n.camPosition.z?Number(e.camera_pos.z):n.camPosition.z),S.cameraControls.maxPolarAngle=Math.PI/2*(null===n.maxPolarAngle?e.maxPolarAngle:n.maxPolarAngle),!1!==e.clampZoomDistance&&(S.cameraControls.maxDistance=null===n.maxDistance?e.maxDistance:n.maxDistance,S.cameraControls.minDistance=e.minDistance),S.cameraControls.maxOrthoHeight=Math.tan(S.camera.fov*Math.PI/360)*S.cameraControls.maxDistance,S.cameraControls.minOrthoHeight=Math.tan(S.camera.fov*Math.PI/360)*S.cameraControls.minDistance,S.cameraControls.maxPanDistance=e.maxPanDistance,S.cameraControls.center.set(null===n.camViewAt.x?Number(e.center_pos.x):n.camViewAt.x,null===n.camViewAt.y?Number(e.center_pos.y):n.camViewAt.y,null===n.camViewAt.z?Number(e.center_pos.z):n.camViewAt.z),S.cameraControls.centerPan=null==e.centerPan?S.cameraControls.center.clone():new i.Vector3(e.centerPan.x,e.centerPan.y,e.centerPan.z),S.camera.lookAt(S.cameraControls.center),S.camera.far=10*e.max_bound.clone().sub(e.min_bound).length(),S.camera.near=S.camera.far/1e5,S.cameraControls.plane=(new i.Plane).setFromNormalAndCoplanarPoint(new i.Vector3(0,1,0),new i.Vector3(0,0,0))}(e.info),S.loadingWidget=new s.default(e.tree,16777215-n.backgroundColor),S.threeContainer.appendChild(S.loadingWidget.domElement),S.config.showFPS&&(S.stats=new Stats,S.stats.domElement.style.position="absolute",S.stats.domElement.style.top="0px",S.stats.domElement.style.zIndex=100,S.threeContainer.appendChild(S.stats.domElement),S.monitor=new l.default(e.sceneGraphRoot,e.tree,S.renderer),S.monitor.domElement.style.position="absolute",S.monitor.domElement.style.right="0px",S.monitor.domElement.style.top="0px",S.monitor.domElement.style.zIndex=100,S.threeContainer.appendChild(S.monitor.domElement),S.threeContainer.addEventListener("click",function(e){var t=S.picker.pickTile(e.clientX,e.clientY);S.monitor.updateTileName(t)}))),S.isInitialized=!0,S.camera.updateMatrix(),S.camera.updateMatrixWorld(),S.camera.updateProjectionMatrix(),S.camera.matrixWorldInverse.getInverse(S.camera.matrixWorld),S.config.waterMode){var t={PID:S.PID,viewer:S,dataPath:""+S.config.dataPath,usage:"water",MaskType:m.default,maskSize:512,info:S.dataManager.getInfoByType(),maxMaskNum:3,updateMaskFormat:S.config.updateMaskFormat,isDebug:!1,edit:S.config.editMask,HOST:S.config.HOST,altizureApi:S._altizureApi},r=t.info.transformation.getTransBBox(t.info,!0);S.ortho_picker=new c.default(S.camera,S.renderer,new i.Plane(new i.Vector3(0,1,0),(r[0].y+r[1].y)/2)),S.waterManager=new v.default(t),S.waterManager.downloadAll()}S.threeContainer.dispatchEvent(new CustomEvent("resize")),S.threeContainer.dispatchEvent(new CustomEvent("initialized")),S.timeLast=1e3*S.clock.getElapsedTime(),S.animate()},function(){b(S.rootContainer,"No data",n.backgroundColor),S.isInitialized=!1})}else{if(o.default.browser.isWeChat){var u=/iPhone|iPod|iPad/.test(navigator.userAgent)?"Open in Safari":"Open with Browser";return void b(S.rootContainer,'1. Click the button on upper right corner. <br>2. Select "'+u+'".',S.config.backgroundColor)}b(S.rootContainer,"No WebGL Support",S.config.backgroundColor,"/support/articles/faq_compatibility")}}else console.log("Invalid "+e)}(),this.render=function(){if(S.renderer.clearStencil(),S.renderer.clearColor(),S.renderer.clearDepth(),S.withWidget){S.renderer.render(S.scene,S.camera);var e=S.renderer.clippingPlanes;S.defaultClippingPlanes&&(S.renderer.clippingPlanes=S.defaultClippingPlanes),S.renderer.render(S.widgetScene,S.camera),S.renderer.clippingPlanes=e}else S.waterManager&&S.waterManager.renderWaters(),S.effect?S.effect.render(S.scene,S.camera):S.renderer.render(S.scene,S.camera);S.renderer.context.flush()},this.updateOrthoPicker=function(e){var t=new i.Plane(new i.Vector3(0,1,0),e);S.ortho_picker?S.ortho_picker.updateSgr(t):S.ortho_picker=new c.default(S.camera,S.renderer,t)}};_.prototype.constructor=_,_.prototype.resize=function(){if(this.threeContainer&&this.isInitialized){var e=this.threeContainer.clientWidth,t=this.threeContainer.clientHeight;this.renderer.setSize(e,t),this.camera.aspect=e/t,this.camera instanceof i.OrthographicCamera&&(this.camera.right=this.camera.top*this.camera.aspect,this.camera.left=-this.camera.right),this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t),this.effect&&this.effect.setSize(e,t),this.threeContainer.dispatchEvent(new CustomEvent("changed"))}},_.prototype.animate=function(){var e=this;if(e.isInitialized){var t=1e3*e.clock.getElapsedTime(),r=this.isAnimating?this.animateFrameTime:this.staticFrameTime;t-e.timeLast>Math.min(Math.max(r,1.2*e.lastFrameTime),200)-e.frameTimeTorelance&&(this.toyManager.update(),e.render(),e.update(),e.lastFrameTime=1e3*e.clock.getElapsedTime()-t,e.timeLast=t),this.renderFrameid=requestAnimationFrame(function(){e.animate()})}},_.prototype.stop=function(){if(this.renderFrameid&&cancelAnimationFrame(this.renderFrameid),this.rootContainer)for(;this.rootContainer.firstChild;)this.rootContainer.removeChild(this.rootContainer.firstChild)},_.prototype.attachEffect=function(e,t){return this.threeContainer&&this.renderer?(this.effect=new e(this.renderer,t),this.effect&&this.effect.setSize(this.threeContainer.clientWidth,this.threeContainer.clientHeight),this.effect):(console.error("The renderer has not been initialized"),null)},_.prototype.update=function(){if(1===this.config.ui.control_mode&&null!==this.fpsControls)this.fpsControls.update();else if(this.cameraControls.update(),1===this.camera.up.y);else{var e=this.camera.up.clone(),t=new i.Vector3(0,1,0),r=e.clone().cross(t).normalize(),n=e.angleTo(t);Math.abs(n)<=.01?this.camera.up.set(0,1,0):(e.applyAxisAngle(r,.01*Math.sign(n)),this.camera.up.copy(e))}this.loadingWidget&&this.loadingWidget.update(),this.config.showFPS&&this.stats&&this.monitor&&(this.stats.update(),this.monitor.update())},t.default=_},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(37)),o=n(r(12)),a=function(e){function t(e,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i={op0:"op0"};if((n=n||{}).camera)i.camera=n.camera;else{var a=114.263885,s=22.335836,l=1e7,u=6.6,c=60;n.altlonglat&&(void 0!==n.altlonglat.longitude&&(a=n.altlonglat.longitude),void 0!==n.altlonglat.latitude&&(s=n.altlonglat.latitude),void 0!==n.altlonglat.altitude&&(l=n.altlonglat.altitude)),n.orientation&&(void 0!==n.orientation.northing&&(u=n.orientation.northing),void 0!==n.orientation.tilt&&(c=n.orientation.tilt)),i.camera={flyTo:{lng:a,lat:s,alt:l,north:u,tilt:c}}}i.renderItems=n.renderItems,i.develop=n.develop,i.eventHandlers=n.eventHandlers,i.control=n.control,i.HOST=n.AUTHORIZED_HOST;var h=void 0,f=void 0;return n.api?(n.api.API_HOST?h=o.default.AES.decrypt(n.api.API_HOST,"altizure-environment").toString(o.default.enc.Utf8):(h="http://172.18.22.83:18082/graphql",console.warn("Earth: API_HOST")),n.api.API_KEY?f=o.default.AES.decrypt(n.api.API_KEY,"altizure-environment").toString(o.default.enc.Utf8):(f="ToA0NQtp92u58EAqyUyKYg5bVBdPNIuFozRkDuq",console.warn("Earth: API_KEY"))):(console.warn("Earth: api"),h="http://172.18.22.83:18082/graphql",f="ToA0NQtp92u58EAqyUyKYg5bVBdPNIuFozRkDuq"),i.api={API_HOST:h,API_KEY:f},function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),t}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(13)),i=r(0);t.default={loadTexture:function(e){var t=e.textureUrl,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12e4,o=new Promise(function(e,r){var n=new i.TextureLoader;n.setCrossOrigin("anonymous"),n.withCredentials=!0,n.load(t,function(t){e(t)},function(e){console.log(e.loaded/e.total*100+"% loaded")},function(e){r(e)})});return n.default.timedPromise(o,r)}}},function(e,t,r){"use strict";e.exports=r(149).polyfill()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={decodeNumMat:function(e){for(var t=e.width,r=e.height,n=e.data,i=this.decodeNumArray(n),o=0,a=[],s=0;s<t;s++){a[s]=[];for(var l=0;l<r;l++)a[s][l]=i[o],o++}return a},encodeNumMat:function(e){for(var t=e.length,r=e[0].length,n=[],i=0;i<t;i++)for(var o=0;o<r;o++)n.push(e[i][o]);return{width:t,height:r,data:this.encodeNumArray(n)}},_firstChar:48,decodeNumArray:function(e){var t,r=[],n=[];for(t=0;t<e.length;t+=3){var i=e.charAt(t).charCodeAt()-this._firstChar,o=e.charAt(t+1).charCodeAt()-this._firstChar,a=e.charAt(t+2).charCodeAt()-this._firstChar;n.push(i>>2&63),n.push((3&i)<<4|o>>4&15),n.push((15&o)<<2|a>>6&3),n.push(63&a)}for(t=0;t<n.length;t++)63!==n[t]&&r.push(n[t]);return r},encodeNumArray:function(e){for(var t=[],r=0;r<e.length;r+=4){var n=e[r],i=r+1<e.length?e[r+1]:63,o=r+2<e.length?e[r+2]:63,a=r+3<e.length?e[r+3]:63;this.encodeSet(n,i,o,a,t)}return this.stringFromArray(t)},stringFromArray:function(e){for(var t="",r=0;r<e.length;r++)t+=e[r];return t},encodeSet:function(e,t,r,n,i){var o=(63&e)<<2|t>>4&3,a=(15&t)<<4|r>>2&15,s=(3&r)<<6|63&n;i.push(String.fromCharCode(o+this._firstChar)),i.push(String.fromCharCode(a+this._firstChar)),i.push(String.fromCharCode(s+this._firstChar))},pack_boolean:function(e){for(var t={width:e.length,height:e[0].length,data:[]},r=0,n=!1,i=0;i<e.length;i++)for(var o=0;o<e[i].length;o++)e[i][o]===n?(r++,0):e[i][o]===!n?(t.data.push(r),r,n=!n,r=1,0):(console.warn("Error: unknown entry ["+i+","+o+"]="+e[i][o]),0),0;return t.data.push(r),r,t},unpack_boolean:function(e){for(var t=e.width,r=e.height,n=e.data,i=[],o=r;o--;)i[o]=[];var a=!1;o=0;for(var s=0,l=0;l<n.length;l+=16)for(var u=0;u<16;++u){var c=n[u+l],h=function(e,r,n,o){for(var a=c,s=e,l=r;a--;)i[s][l]=o,++l===t&&(s++,l=0);return{row:s,col:l}}(o,s,0,a);o=h.row,s=h.col,a=!a}return i},unpackToImage:function(e){for(var t=e.width,r=e.height,n=e.data,i=new Uint8ClampedArray(t*r*4),o=0,a=!1,s=0,l=0,u=0;u<n.length;u+=16)for(var c=0;c<16;++c){var h=n[c+u],f=function(e,r,n,o){for(var a=h,s=e,l=r,u=4*(s*t+l);a--;)i[u]=i[u+1]=i[u+2]=i[u+3]=o,u+=4,++l===t&&(s++,l=0);return{row:s,col:l}}(s,l,0,a?255:0);s=f.row,l=f.col,o+=!0===a?1:0,a=!a}return{rgba:i,cntWhite:o}},downsampleImage:function(e,t,r,n){for(var i=Math.floor(t*n),o=Math.floor(r*n),a=new Uint8ClampedArray(i*o*4),s=0,l=0,u=0,c=0;c<o;++c)for(var h=0;h<i;++h)u=4*(c/n*t+h/n),a[l=4*(c*i+h)]=e[u],a[l+1]=e[u+1],a[l+2]=e[u+2],a[l+3]=e[u+3],s+=0!==a[l]?1:0;return{rgba:a,cntWhite:s}}};t.default=n},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=n(r(44)),a=n(r(16)),s=function(e){function t(e){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,t),e.allowWorker=!1;var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.projectTree=e.tree,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"_defaultMaskOpts",value:function(e){var t=a.default.prototype._defaultMaskOpts.call(this);return t.tree=this.projectTree,t.isDebug=this.isDebug,t}},{key:"downloadAll",value:function(){if(this.allowWorker)this.workerDownloadAll();else{var e=this;this._downloadSettings(o.default,function(){},function(){e.addefaultSetting()})}}}]),t}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={getMaskfromImageData:function(e,t,r,n){for(var i=[],o=r;o--;)i.push([]);for(var a=0;a<r;a++)for(var s=0;s<t;s++){0!==e[4*(a*t+s)+n]?(i[a][s]=!0,0):(i[a][s]=!1,0)}return i},isEqual:function(e,t){if(e.length!==t.length)return console.warn("Un identical row length :"+e.length+", "+t.length),!1;for(var r=0;r<e.length;r++){if(e[r].length!==t[r].length)return console.warn("Un identical col length :"+e[r].length+", "+t[r].length),!1;for(var n=0;n<e[r].length;n++)if(e[r][n]!==t[r][n])return!1}return!0},boolMaskToImageData:function(e){for(var t=e.length,r=e[0].length,n=new Uint8ClampedArray(r*t*4),i=0,o=0;o<t;++o)for(var a=0;a<r;++a){var s=4*(o*r+a);e[o][a]?(n[s]=n[s+1]=n[s+2]=255,n[s+3]=255,i++):(n[s]=n[s+1]=n[s+2]=0,n[s+3]=0)}return{rgb:n,cntWhite:i}}};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i={uniforms:{ambient:{type:"v3",value:new n.Vector3},diffuse:{type:"v3",value:new n.Vector3},lightDirection:{type:"v3",value:new n.Vector3},modelTexture:{type:"t",value:null},orthoMask:{type:"t",value:null},cropMask:{type:"t",value:null},ortho_origin:{type:"v3",value:new n.Vector3},ortho_x_dir:{type:"v3",value:new n.Vector3},ortho_y_dir:{type:"v3",value:new n.Vector3},ortho_z_dir:{type:"v3",value:new n.Vector3},ortho_min_bound:{type:"v3",value:new n.Vector3},ortho_max_bound:{type:"v3",value:new n.Vector3},decodeMatrix:{type:"m4",value:new n.Matrix4},transformMatrix:{type:"m4",value:new n.Matrix4}},vertexShader:["uniform vec3 ortho_origin;","uniform vec3 ortho_x_dir;","uniform vec3 ortho_y_dir;","uniform vec3 ortho_z_dir;","uniform vec3 ortho_min_bound;","uniform vec3 ortho_max_bound;","varying vec3 vNormal;","varying vec2 vUv;","varying vec2 vMaskUv;","uniform mat4 decodeMatrix;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","vUv = uv;","vec4 vtrans = decodeMatrix * vec4(position, 1);","vec3 vori = vtrans.xyz - ortho_origin;","vec3 vViewPosition = vec3(dot(vori, ortho_x_dir), dot(vori, ortho_y_dir), dot(vori, ortho_z_dir));","vMaskUv = ((vViewPosition - ortho_min_bound)/(ortho_max_bound - ortho_min_bound)).xz;","}"].join("\n"),fragmentShader:["uniform sampler2D modelTexture;","uniform sampler2D orthoMask;","uniform sampler2D cropMask;","uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 lightDirection;","varying vec3 vNormal;","varying vec2 vUv;","varying vec2 vMaskUv;","void main() {","vec4 lDirection = viewMatrix * vec4( lightDirection, 0.0 );","vec3 lVector = normalize( lDirection.xyz );","vec3 normal = normalize( vNormal );","float lambert = max(dot( normal, lVector ), 0.0);","vec2 os_uv = vMaskUv;","float os_val = max(texture2D(orthoMask, os_uv).y, 0.3) * texture2D(cropMask, os_uv).y;","if(os_val < 0.05) {","discard;","}","gl_FragColor = vec4(os_val * texture2D(modelTexture, vUv).xyz, 1.0);","}"].join("\n")};t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),o=function(e){return e&&e.__esModule?e:{default:e}}(r(74)),a=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._modelTexture=t.map,this._ambient=t.ambient||new i.Vector3(.3,.3,.3),this._diffuse=t.diffuse||new i.Vector3(.6,.6,.6),this._lightDirection=t.lightDirection||new i.Vector3(200,0,200),this._mask=null;for(var r=t.info,n=new Uint8Array(16),a=new Uint8Array(16),s=0;s<16;s++)n[s]=255,a[s]=128;this._light_texture=new i.DataTexture(n,2,2,i.RGBAFormat,i.UnsignedByteType),this._dim_texture=new i.DataTexture(a,2,2,i.RGBAFormat,i.UnsignedByteType),this._select_texture=this._dim_texture,this.dtex=this._light_texture,this.dtex.needsUpdate=!0,this.cropTex=this._light_texture,this.cropTex.needsUpdate=!0,this._material=function(e,t,r,n,a,s,l,u){var c={uniforms:i.UniformsUtils.clone(o.default.uniforms),vertexShader:o.default.vertexShader,fragmentShader:o.default.fragmentShader,side:void 0===t.side?i.FrontSide:t.side},h=new i.ShaderMaterial(c);return h.uniforms.ambient.value=r,h.uniforms.diffuse.value=n,h.uniforms.lightDirection.value=a,h.uniforms.modelTexture.value=s,h.uniforms.ortho_origin.value=e.origin,h.uniforms.ortho_x_dir.value=e.x_dir,h.uniforms.ortho_y_dir.value=e.y_dir,h.uniforms.ortho_z_dir.value=e.z_dir,h.uniforms.ortho_min_bound.value=e.min_bound,h.uniforms.ortho_max_bound.value=e.max_bound,h.uniforms.decodeMatrix.value=t.decodeMatrix,h.uniforms.transformMatrix.value=e.transformMatrix,h.uniforms.orthoMask.value=l,h.uniforms.cropMask.value=u,h.needsUpdate=!0,h}(r,t,this._ambient,this._diffuse,this._lightDirection,this._modelTexture,this.dtex,this.cropTex)}return n(e,[{key:"dispose",value:function(){this.dtex.dispose(),this.dtex=void 0,this.cropTex.dispose(),this.cropTex=void 0,this._dim_texture.dispose(),this._light_texture.dispose(),this._material.dispose(),this._material=void 0}},{key:"dim",value:function(){this.dtex=this._select_texture,this.dtex.needsUpdate=!0,this._material.uniforms.orthoMask.value=this.dtex}},{key:"clear",value:function(){this._select_texture=this._dim_texture,this.dtex=this._select_texture,this._material.uniforms.orthoMask.value=this.dtex}},{key:"light",value:function(){this.dtex=this._light_texture,this.dtex.needsUpdate=!0,this._material.uniforms.orthoMask.value=this.dtex}},{key:"orthoInfo",set:function(e){var t=e;this._material.uniforms.ortho_origin.value=t.origin,this._material.uniforms.ortho_x_dir.value=t.x_dir,this._material.uniforms.ortho_y_dir.value=t.y_dir,this._material.uniforms.ortho_z_dir.value=t.z_dir,this._material.uniforms.ortho_min_bound.value=t.min_bound,this._material.uniforms.ortho_max_bound.value=t.max_bound}},{key:"decodeMatrix",set:function(e){this._material.uniforms.decodeMatrix.value=e}},{key:"maskTexture",set:function(e){this._select_texture=e,this.dtex=this._select_texture,this._material.uniforms.orthoMask.value=this.dtex,this.dtex.needsUpdate=!0}},{key:"cropTexture",set:function(e){this.cropTex=e,this._material.uniforms.cropMask.value=this.cropTex}},{key:"material",get:function(){return this._material}}]),e}();t.default=a},function(e,t,r){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(118)),a=function(e){function t(e){var r=e.camera,i=e.handlers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),a=o;if(!r||(i&&s.forEach(function(e){i&&i[e]&&(a[e]=i[e])}),0))return n(o,void 0);o._camera=r,o._enabled=!0,o._handlers={};var s=["onCameraChange","onCameraStart","onCameraEnd"];return s.forEach(function(e){a._handlers["_"+e]=function(t){if(a.dispatchEvent({type:e}),a[e])return a[e](t)}}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"destruct",value:function(){}},{key:"triggerChangeEvent",value:function(){this.dispatchEvent({type:"onCameraChange"})}},{key:"camera",get:function(){return this._camera}}]),t}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraSwitcherConsts=void 0;var n=r(0),i=function(e){return e&&e.__esModule?e:{default:e}}(r(6)),o=function(e,t){i.default.call(this,e),this.type="switch",this.priority=500,this.needRefresh=!0,this.loop=!0;var r,o,s=new n.Clock,l=a.easing,u=t.cameras||[],c=0,h=s.getElapsedTime(),f=this;this.update=function(t){var n=u.length;if(!(n<1)){r=s.getElapsedTime(),null==o&&(o=r);var i=r-o,a=u[c].duration,d=u[c].easing;if(i>a){if(!1===this.loop&&c>=n-2)return void f.detach();i-=a,a=u[c=(c+1)%n].duration,o=r}var p=u[c].position,m=u[(c+1)%n].position,v=u[c].target,g=u[(c+1)%n].target,y=u[c].quaternion,_=u[(c+1)%n].quaternion,w=i/a;d===l.IN?w=f.easing.Quadratic.In(w):d===l.OUT?w=f.easing.Quadratic.Out(w):d===l.INOUT&&(w=f.easing.Quadratic.InOut(w));var b=v.clone().sub(p).normalize(),x=g.clone().sub(m).normalize(),k=e.object.up;y&&_&&(b.cross(k).lengthSq()<1e-5||x.cross(k).lengthSq()<1e-5)&&(t.quaternion=y.clone().slerp(_,w));var A=p.clone().lerp(m,w),M=v.clone().lerp(g,w);t.position=A,t.center=M,Math.abs(h-r)>4&&(t.refresh=!0,h=r)}},this.generateRandomCameras=function(e,t,r){for(var i=0;i<e;i++){var o=new n.Vector3((Math.random()-.5)*r[0],Math.random()*r[1],(Math.random()-.5)*r[2]),a=(new n.Vector3).addVectors(t,o);u.push({position:a,target:t.clone(),duration:8})}}},a={easing:{NONE:"linear",IN:"easein",OUT:"easeout",INOUT:"easeinout"}};o.prototype.constructor=o,o.prototype=Object.create(i.default.prototype),t.default=o,t.CameraSwitcherConsts=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=n(r(13)),a=n(r(76)),s=n(r(46)),l=n(r(87)),u=n(r(3)),c=n(r(90)),h=n(r(89)),f=n(r(45)),d=r(0),p={NONE:0,ORBIT:1,DOLLY:2,SWIRL:3,TOUCH_ORBIT:11,TOUCH_DOLLY:12,TOUCH_SWIRL:13,FLYTO:21},m=d.MOUSE.LEFT,v=d.MOUSE.MIDDLE,g=d.MOUSE.RIGHT,y=function(e){function t(e){var r=e.camera,n=e.openning,i=e.handlers,a=e.earthNode,u=e.layers,m=e.domElement,v=e.showAnchor,g=void 0===v||v;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var y=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{camera:r,handlers:i}));y.dd=!0;var _=y;return y.earth_scale=1,y.EARTH_RESOLUTION=6,y._pose=new s.default({earth_scale:y.earth_scale,EARTH_RESOLUTION:y.EARTH_RESOLUTION}),y._cameraPath=null,y.earthNode=a,y.layers=u,y.domElement=m,function(){_.preventDefault=_._preventDefault.bind(_),_.onMouseDown=_._onMouseDown.bind(_),_.onMouseMove=_._onMouseMove.bind(_),_.onMouseUp=_._onMouseUp.bind(_);var e=_._onMouseWheel.bind(_),t=o.default.debounce(function(e){_._wheelBursting=!1},500);_.onMouseWheel=function(r){r.preventDefault(),e(r),t(r)},_.onDragStart=_._onDragStart.bind(_),_.onDrag=_._onDrag.bind(_),_.onDragEnd=_._onDragEnd.bind(_),_.onTwoFingerStart=_._onTwoFingerStart.bind(_),_.onTwoFinger=_._onTwoFinger.bind(_),_.onTwoFingerEnd=_._onTwoFingerEnd.bind(_)}(),y.gestureRecognizer=new f.default(y.domElement,{debug:!1}),y.orbitSpeed=.1,y.swirlSpeed=12,y.dollySpeed=2.5,y.enabled=!0,y._enabledDamping=!1,y._state=p.NONE,y._orbitStart=new d.Vector2(0,0),y._orbitEnd=new d.Vector2(0,0),y._swirlStart=new d.Vector2(0,0),y._swirlEnd=new d.Vector2(0,0),y._dollyPoint=new d.Vector2(0,0),y._dollyStart=0,y._dollyEnd=0,y._wheelBursting=!1,y._showAnchor=g,y.showContact=!1,y._anchorScaleFactor=1,y._targetCenterFocus=null,y._picker=new c.default({camera:r,layers:u,domElement:m}),y._earthPicker=new h.default({camera:r,domElement:m,control:y,scale:y.earth_scale,resolution:y.EARTH_RESOLUTION}),function(){var e=n.poseTo,t=n.flyTo,r=n.time,i=Object.assign({},{lat:22.335836,lng:114.263885,alt:1e6,north:0,tilt:60,up:0},t),o=Object.assign({},i,e),a=Object.assign({},i,t);r=void 0===r?3e3:r;var u=Date.now();_._cameraPath=new l.default(new s.default(o),new s.default(o),{start:u-1,current:u,end:u}),_._pose.value=o,_.flyToPose(a,r)}(),_._updateFrustum=o.default.throttle(function(){_.__updateFrustum()},30),_._updateNearFar=o.default.throttle(function(){_.__updateNearFar()},300),y}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"destruct",value:function(){this.enabled=!1,this.cameraPath.destruct()}},{key:"cameraPose",value:function(){return this._pose.value}},{key:"freeze",value:function(){this.enabled=!1}},{key:"unfreeze",value:function(){this.enabled=!0}},{key:"tiltRange",value:function(){console.warn("tiltRange is under construction.")}},{key:"altRange",value:function(e){var t=e.max,r=e.min;return void 0!==r&&(this._pose.minAlt=r),void 0!==t&&(this._pose.maxAlt=t),{max:this._pose.maxAlt,min:this._pose.minAlt}}},{key:"flyToPose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,r=this;return this.state!==p.FLYTO&&(this.cameraPath.sync(this._pose.matrix),this.state=p.FLYTO),this._putAnchor(),this.cameraPath.destinate(e,t).then(function(){return r._pose.value=r.cameraPath.dst.value,r._putAnchor(),r.state=p.NONE,r.onCameraChange(),Promise.resolve()}).catch(function(e){return r._pose.matrix=r.cameraPath.dst.matrix,r._putAnchor(),r.onCameraChange(),"destination changed"===e.message?Promise.resolve(e.message):Promise.reject(e)})}},{key:"flyToMat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this;return this.state!==p.FLYTO&&(this.cameraPath.sync(this._pose.matrix),this.state=p.FLYTO),this._putAnchor(),r&&r.isVector3?this._targetCenterFocus=r.clone():this._targetCenterFocus=null,this.cameraPath.destinate(e,t).then(function(){return n._pose.matrix=n.cameraPath.dst.matrix,n._putAnchor(),n.state=p.NONE,n.onCameraChange(),Promise.resolve()}).catch(function(e){return n._pose.matrix=n.cameraPath.dst.matrix,n._putAnchor(),n.onCameraChange(),"destination changed"===e.message?Promise.resolve(e.message):Promise.reject(e)})}},{key:"flyToMatNorthUp",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new d.Vector3,i=new d.Quaternion,o=new d.Vector3;e.decompose(n,i,o);var a=n.clone(),s=o.clone(),l=n.clone().normalize(),u=new d.Vector3(0,0,-1).applyQuaternion(i.clone()),c=u.clone().cross(l).normalize(),h=c.clone().cross(u).normalize();(new d.Matrix4).makeBasis(c.normalize(),h.normalize(),u.negate().normalize()).decompose(n,i,o);var f=i.clone(),p=(new d.Matrix4).compose(a,f,s);return this.flyToMat(p,t,r)}},{key:"flyToMatWithFocus",value:function(e,t,r){return this._targetCenterFocus=r.clone(),console.log("flyToMatWithFocus",this._targetCenterFocus),this.flyToMat(e,t)}},{key:"breakDamping",value:function(){console.warn("ni")}},{key:"stopFlying",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.state===p.FLYTO){var t=e?new Error("destination changed"):new Error("stopFlying");this.cameraPath.interrupt(t),this.state=p.NONE}}},{key:"restoreView",value:function(){this._targetCenterFocus=null;var e=this._camera,t=e.view,r=this;return t?new Promise(function(n,i){setTimeout(function(){e.setViewOffset(t.fullWidth,t.fullHeight,0,0,t.fullWidth,t.fullHeight),r._handlers._onCameraChange(),n()},1e3)}):Promise.reject()}},{key:"update",value:function(){if(!this.cameraPath)return!1;var e=void 0;if(this.state!==p.FLYTO)this._pose.applyDelta(),e=this._pose.matrix;else{var t=this.cameraPath.pose;if(t){var r=t.matrix;this._pose.matrix=r,e=r,this.__updateFrustum()}else e=this._pose.matrix}if(!this.__prevCamToEarth||!e.equals(this.__prevCamToEarth)){try{var n=(new d.Matrix4).getInverse(e,!0)}catch(e){return console.error("no inverse"),!1}if(this.earthNode.setMatrix(n),this._handlers._onCameraChange(),this.__prevCamToEarth?this.__prevCamToEarth.copy(e):this.__prevCamToEarth=e,(this.showContact||this.showAnchor)&&this.earthEntity){var i=(new d.Vector3).setFromMatrixPosition(e),o=this._pose.anchor,a=i.distanceTo(o),s=.002*this._anchorScaleFactor*a,l=this.earthEntity.focusPoint;this.showAnchor?(l.position.copy(o),l.scale.set(s,s,s),l.visible=!0):l.visible=!1,this.showContact&&this.earthEntity.contactPoint.scale.set(s,s,s)}}return!0}},{key:"_mount",value:function(){this.domElement.addEventListener("contextmenu",this.preventDefault),this.domElement.addEventListener("mousedown",this.onMouseDown),this.domElement.addEventListener("mousewheel",this.onMouseWheel),this.domElement.addEventListener("MozMousePixelScroll",this.onMouseWheel),this.gestureRecognizer.addEventListener("drag-start",this.onDragStart,!1),this.gestureRecognizer.addEventListener("pinch-start",this.onTwoFingerStart,!1),this.gestureRecognizer.addEventListener("twofingersweep-start",this.onTwoFingerStart,!1),this.gestureRecognizer.addEventListener("rotate-start",this.onTwoFingerStart,!1)}},{key:"_unmount",value:function(){this.domElement.removeEventListener("contextmenu",this.preventDefault,!1),this.domElement.removeEventListener("mousedown",this.onMouseDown,!1),this.domElement.removeEventListener("mousewheel",this.onMouseWheel,!1),this.domElement.removeEventListener("MozMousePixelScroll",this.onMouseWheel,!1)}},{key:"_preventDefault",value:function(e){e.preventDefault()}},{key:"_onMouseDown",value:function(e){if(this.enabled){if(e.preventDefault(),this.stopFlying(!0),e.button===m){if(!this.enabledOrbit)return;this._handleOrbitStart(e.clientX,e.clientY),this.state=p.ORBIT}else if(e.button===v){if(!this.enabledDolly)return;this.state=p.DOLLY}else if(e.button===g){if(!this.enabledSwirl)return;this._handleSwirlStart(e.clientX,e.clientY),this.state=p.SWIRL}this.state!==p.NONE&&(this.domElement.addEventListener("mousemove",this.onMouseMove),this.domElement.addEventListener("mouseup",this.onMouseUp),this.domElement.addEventListener("mouseout",this.onMouseUp),this._handlers._onCameraStart(e))}}},{key:"_onMouseWheel",value:function(e){if(this.enabled&&this.enabledDolly){e.preventDefault();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?t=this.dollySpeed:t<0&&(t=-this.dollySpeed),this._wheelBursting||(this.stopFlying(!0),this._pose.distanceToAnchor>.1*this.earth_scale?this._putAnchor():this._putAnchor({x:e.clientX,y:e.clientY}),this._wheelBursting=!0),this.dolly(-t)}}},{key:"_onMouseMove",value:function(e){if(this.enabled){e.preventDefault();var t=this.state;if(t===p.ORBIT){if(!this.enabledOrbit)return;this._handleOrbitMove(e.clientX,e.clientY)}else if(t===p.DOLLY){if(!this.enabledDolly)return}else if(t===p.SWIRL){if(!this.enabledSwirl)return;this._handleSwirl(e.clientX,e.clientY)}if(this.showContact&&this.earthEntity){var r={x:e.clientX,y:e.clientY},n=this.pickProjectContactPointInEarth({rawX:r.x,rawY:r.y},"altizureMesh");if(n){var i=this.earthEntity.contactPoint;i.position.copy(n),i.visible=!0}}}}},{key:"_onMouseUp",value:function(e){this.enabled&&(this.state===p.ORBIT?(this.enabledOrbit&&this._handlers._onCameraEnd(e),this.state=p.NONE):this.state===p.DOLLY?(this.enabledDolly&&this._handlers._onCameraEnd(e),this.state=p.NONE):this.state===p.SWIRL&&(this.enabledSwirl&&this._handlers._onCameraEnd(e),this.state=p.NONE),this.domElement.removeEventListener("mousemove",this.onMouseMove),this.domElement.removeEventListener("mouseup",this.onMouseUp),this.domElement.removeEventListener("mouseout",this.onMouseUp))}},{key:"_onDragStart",value:function(e){if(this.enabledOrbit){this.stopFlying(!0);var t=e.touchEvent,r=t.touches[0].pageX,n=t.touches[0].pageY;this._handleOrbitStart(r,n),this.state=p.ORBIT,this.gestureRecognizer.addEventListener("drag",this.onDrag),this.gestureRecognizer.addEventListener("drag-end",this.onDragEnd),this._handlers._onCameraStart(t)}}},{key:"_onDrag",value:function(e){if(this.enabledOrbit){var t=e.touchEvent;this._handleOrbitMove(t.touches[0].pageX,t.touches[0].pageY),this.state=p.ORBIT}}},{key:"_onDragEnd",value:function(e){if(this.enabledOrbit){var t=e.touchEvent;this.gestureRecognizer.removeEventListener("drag",this.onDrag),this.gestureRecognizer.removeEventListener("drag-end",this.onDragEnd),this._handlers._onCameraEnd(t),console.log("_onDragEnd"),this.state=p.NONE}}},{key:"_onTwoFingerStart",value:function(e){if(this.enabledSwirl||this.enabledDolly){this.stopFlying(!0);var t=e.center;this._handleSwirlStart(t.pageX,t.pageY),this.state=p.SWIRL;var r=this.__twoTouchPoints(e),n=r.p,i=r.q,o=n.distanceTo(i);isNaN(o)||(this._dollyStart=o),this.gestureRecognizer.addEventListener("pinch",this.onTwoFinger),this.gestureRecognizer.addEventListener("pinch-end",this.onTwoFingerEnd),this.gestureRecognizer.addEventListener("twofingersweep",this.onTwoFinger),this.gestureRecognizer.addEventListener("twofingersweep-end",this.onTwoFingerEnd),this.gestureRecognizer.addEventListener("rotate",this.onTwoFinger),this.gestureRecognizer.addEventListener("rotate-end",this.onTwoFingerEnd),this._handlers._onCameraStart(event)}}},{key:"_onTwoFinger",value:function(e){if(this.enabledSwirl||this.enabledDolly){var t=e.center;this._handleSwirl(t.pageX,t.pageY);var r=this.__twoTouchPoints(e),n=r.p,i=r.q,o=n.distanceTo(i);if(!isNaN(o)){if(this._dollyEnd=o,0!==this._dollyStart){var a=(this._dollyEnd-this._dollyStart)/-50;this.dolly(a*this.dollySpeed)}this._dollyStart=this._dollyEnd}this.state=p.SWIRL}}},{key:"_onTwoFingerEnd",value:function(e){if(this._onDragEnd(e),this.enabledSwirl||this.enabledDolly){var t=e.touchEvent;this._dollyStart=this._dollyEnd=0,this.gestureRecognizer.removeEventListener("pinch",this.onTwoFinger),this.gestureRecognizer.removeEventListener("pinch-end",this.onTwoFingerEnd),this.gestureRecognizer.removeEventListener("twofingersweep",this.onTwoFinger),this.gestureRecognizer.removeEventListener("twofingersweep-end",this.onTwoFingerEnd),this.gestureRecognizer.removeEventListener("rotate",this.onTwoFinger),this.gestureRecognizer.removeEventListener("rotate-end",this.onTwoFingerEnd),this._handlers._onCameraEnd(t),console.log("_onTwoFingerEnd"),this.state=p.NONE}}},{key:"_handleOrbitStart",value:function(e,t){this._putAnchor({x:e,y:t}),this._orbitStart.set(e,t)}},{key:"_handleOrbitMove",value:function(e,t){this._orbitEnd.set(e,t);var r=(new d.Vector3).subVectors(this._orbitEnd,this._orbitStart),n=Math.min(this.domElement.clientHeight,this.domElement.clientWidth,50);this.orbitLeft(r.x/n*this.orbitSpeed),this.orbitUp(r.y/n*this.orbitSpeed),this._orbitStart.copy(this._orbitEnd)}},{key:"_handleSwirlStart",value:function(e,t){this._putAnchor({x:e,y:t}),this._swirlStart.set(e,t)}},{key:"_handleSwirl",value:function(e,t){this._swirlEnd.set(e,t);var r=(new d.Vector3).subVectors(this._swirlEnd,this._swirlStart),n=Math.min(this.domElement.clientHeight,this.domElement.clientWidth,50);this.swirlLeft(r.x/n*this.swirlSpeed),this.swirlUp(r.y/n*this.swirlSpeed),this._swirlStart.copy(this._swirlEnd)}},{key:"putCenterAnchor",value:function(){var e=this.domWidth/2,t=this.domHeight/2;return this._putAnchor({x:e,y:t})}},{key:"_putAnchor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._pose;if(e){var r=this.pickProjectContactPointInEarth({rawX:e.x,rawY:e.y},"marker");return r||(r=this.pickProjectContactPointInEarth({rawX:e.x,rawY:e.y})),void t.putAnchor(r)}t.putAnchor()}},{key:"__updateNearFar",value:function(){var e=this._camera,t=void 0,r=void 0,n=this._pose.matrix,i=(new d.Vector3).setFromMatrixPosition(n),o=this._pose.anchor,a=i.distanceTo(o),s=i.length();o.length()<.8*this.earth_scale?(t=1e-5,r=s):(t=.01*a,r=s+Math.min(Math.max(10*a,s),2*this.earth_scale)),e.near=t,e.far=r,e.updateProjectionMatrix()}},{key:"__updateFrustum",value:function(){var e=this._targetCenterFocus;if(e){var t=this._camera,r=this._pose.matrix;if(!t.view)return void console.warn("No view ready.");var n=e.clone(),i=(new d.Matrix4).getInverse(r);n.applyMatrix4(i);var o=t.fov,a=t.aspect,s=t.near,l=t.far,u=new d.PerspectiveCamera(o,a,s,l),c=n.project(u),h=(c.x+1)/2*this.domWidth,f=(1-c.y)/2*this.domHeight,p=t.view,m=h-(p.offsetX+p.width/2),v=f-(p.offsetY+p.height/2),g=p.offsetX+m,y=p.offsetY+v;t.setViewOffset(p.fullWidth,p.fullHeight,g,y,p.width,p.height)}}},{key:"__twoTouchPoints",value:function(e){var t=e.touchEvent.touches;return{p:new d.Vector2(t[0].pageX,t[0].pageY),q:new d.Vector2(t[1].pageX,t[1].pageY)}}},{key:"orbitLeft",value:function(e){0!==e&&this._pose.orbitLeft(e)}},{key:"orbitUp",value:function(e){0!==e&&this._pose.orbitUp(e)}},{key:"dolly",value:function(e){var t=this;0!==e&&function(){var r=t,n=e/3;r._pose.dolly(n);for(var i=60;i<180;i+=60)setTimeout(function(){r._pose.dolly(n)},i)}()}},{key:"swirlLeft",value:function(e){this.enabledSwirlLeft&&e&&this._pose.swirlLeft(e)}},{key:"swirlUp",value:function(e){this.enabledSwirlUp&&e&&this._pose.swirlUp(e)}},{key:"pickEarthContactPoint",value:function(e){var t=e.rawX,r=e.rawY,n=this._earthPicker.pick(t,r);if(n.length>0){var i=this._pose.matrix,o=n[0].point.clone();o.applyMatrix4(i);var a=u.default.earthSurfaceToGeographic(this.EARTH_RESOLUTION,o,this.earth_scale);return{lng:a.lng,lat:a.lat,alt:0}}}},{key:"pickProjectContactPoint",value:function(e){var t=e.rawX,r=e.rawY,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"altizureMesh",i=this.pickProjectContactPointInEarth({rawX:t,rawY:r},n);if(i)return u.default.getLngLatAltFromNoneGroundCartesian(this.EARTH_RESOLUTION,i,this.earth_scale)}},{key:"pickProjectContactPointInEarth",value:function(e){var t=e.rawX,r=e.rawY,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"altizureMesh";this._picker.layerName=n;var i=this._picker.pick(t,r);if(i.length>0){var o=this._pose.matrix,a=i[0].point.clone();return a.applyMatrix4(o),a}}},{key:"mapToWindow",value:function(e,t){return this._picker._NDC_inv(e,t)}},{key:"onCameraChange",value:function(){this._updateNearFar()}},{key:"__unlock_MAX_TILT",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:180;s.default.MAX_TILT=e}},{key:"cameraPath",get:function(){return this._cameraPath}},{key:"pose",get:function(){return this._pose.value},set:function(e){this._pose.value=e,this._handlers._onCameraChange()}},{key:"camToEarth",get:function(){return this._pose.matrix}},{key:"POS",get:function(){return this._pose.POS}},{key:"state",set:function(e){this._state=e},get:function(){return this._state}},{key:"enabled",set:function(e){this._enabled=e,this.enabledOrbit=e,this.enabledDolly=e,this.enabledSwirl=e,e?this._mount():(this._unmount(),console.log("unmount"),this.state=p.NONE)},get:function(){return this._enabled}},{key:"enabledOrbit",set:function(e){this._enabledOrbit=e},get:function(){return this._enabledOrbit}},{key:"enabledDolly",set:function(e){this._enabledDolly=e},get:function(){return this._enabledDolly}},{key:"enabledSwirl",set:function(e){this._enabledSwirl=e,this._enabledSwirlLeft=e,this._enabledSwirlUp=e},get:function(){return this._enabledSwirl}},{key:"enabledSwirlUp",set:function(e){this._enabledSwirlUp=e,e&&(this._enabledSwirl=!0)},get:function(){return this._enabledSwirlUp}},{key:"enabledSwirlLeft",set:function(e){this._enabledSwirlLeft=e,e&&(this._enabledSwirl=!0)},get:function(){return this._enabledSwirlLeft}},{key:"enableRotate",set:function(e){this.enabledOrbit=e}},{key:"focus",get:function(){return this._pose.value}},{key:"domWidth",get:function(){return this.domElement.clientWidth}},{key:"domHeight",get:function(){return this.domElement.clientHeight}},{key:"showAnchor",get:function(){return this._showAnchor},set:function(e){this._showAnchor=e}}]),t}();t.default=y},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(e){return e&&e.__esModule?e:{default:e}}(r(84)),o=function(e,t,r,o){this.object=e,this.scene=t,this.domElement=void 0!==r?r:document,this.enabled=!1;var a,s,l,u,c,h=1,f=10,d=30,p=!1,m=!1,v=!1,g=!1,y=!1,_=!1,w=null,b=new n.Vector3(0,0,0),x=this,k={type:"changed"},A=!1,M=(o||{}).debug;!function(){var e=["<span style='font-size:40px'>Press Enter to play</span>","<br />","(W, A, S, D = Move, SPACE = Jump, MOUSE = Look around)"].join("\n");(u=document.createElement("div")).id="blocker",u.style.position="absolute",u.style.top="0",u.style.left="0",u.style.width="100%",u.style.height="100%",u.style.background="rgba(0,0,0,0.5)",(c=document.createElement("div")).id="instructions",c.style.width="100%",c.style.height="100%",c.style.display="-webkit-box",c.style.display="-moz-box",c.style.display="box",c.style["-webkit-box-orient"]="horizontal",c.style["-moz-box-orient"]="horizontal",c.style["box-orient"]="horizontal",c.style["-webkit-box-pack"]="center",c.style["-moz-box-pack"]="center",c.style["box-pack"]="center",c.style["-webkit-box-align"]="center",c.style["-moz-box-align"]="center",c.style["box-align"]="center",c.style.color="#ffffff",c.innerHTML=e,u.appendChild(c),x.domElement.appendChild(u)}(),function(){if("pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document){M&&console.log("have pointer lock");var e=document.body,t=function(t){M&&console.log("pointerlockchange"),document.pointerLockElement===e||document.mozPointerLockElement===e||document.webkitPointerLockElement===e?(p=!0,s.enabled=!0,u.style.display="none"):(s.enabled=!1,u.style.display="-webkit-box",u.style.display="-moz-box",u.style.display="box",c.style.display="")},r=function(e){console.warn("pointerlockerror",e),c.style.display=""};document.addEventListener("pointerlockchange",t,!1),document.addEventListener("mozpointerlockchange",t,!1),document.addEventListener("webkitpointerlockchange",t,!1),document.addEventListener("pointerlockerror",r,!1),document.addEventListener("mozpointerlockerror",r,!1),document.addEventListener("webkitpointerlockerror",r,!1)}else c.innerHTML="Your browser doesn't seem to support Pointer Lock API"}(),function(){var e={onMove:function(){console.log("onMove"),x.dispatchEvent(k)}};s=new i.default(x.object,e),x.scene.add(s.getObject());document.addEventListener("keydown",function(e){switch(e.keyCode){case 38:case 87:m=!0;break;case 37:case 65:g=!0;break;case 40:case 83:v=!0;break;case 39:case 68:y=!0;break;case 32:!0===_&&(b.y+=d),_=!1;break;case 13:x.enabled=!0,function(){if(M&&console.log("startFPS"),!A){M&&console.log("camera rotation",x.object.rotation),s.initRotation(x.object.rotation),x.object.rotation.set(0,0,0),M&&console.log("camera position",x.object.position);var e=x.object.position;s.getObject().position.set(e.x,e.y,e.z),x.object.position.set(0,0,0),M&&console.log("cacmera scale",x.object.scale),x.object.updateMatrix(),A=!0}c.style.display="none";var t=document.body;if(t.requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,/Firefox/i.test(navigator.userAgent)){var r=function e(){document.fullscreenElement!==t&&document.mozFullscreenElement!==t&&document.mozFullScreenElement!==t||(document.removeEventListener("fullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),t.requestPointerLock())};document.addEventListener("fullscreenchange",r,!1),document.addEventListener("mozfullscreenchange",r,!1),t.requestFullscreen=t.requestFullscreen||t.mozRequestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullscreen,t.requestFullscreen()}else t.requestPointerLock()}()}},!1),document.addEventListener("keyup",function(e){switch(e.keyCode){case 38:case 87:m=!1,x.dispatchEvent(k);break;case 37:case 65:g=!1,x.dispatchEvent(k);break;case 40:case 83:v=!1,x.dispatchEvent(k);break;case 39:case 68:y=!1,x.dispatchEvent(k);break;case 27:m=!1,g=!1,v=!1,y=!1,x.enabled=!1,x.dispatchEvent(k)}},!1),l=new n.Raycaster(new n.Vector3,new n.Vector3(0,-1,0))}(),this.update=function(){if(p&&s.enabled&&x.enabled){null===w&&(w=(performance||Date).now());var e=(performance||Date).now(),t=(e-w)/1e3;b.x-=10*b.x*t,b.z-=10*b.z*t,m&&(b.z-=400*t),v&&(b.z+=400*t),g&&(b.x-=400*t),y&&(b.x+=400*t),l.ray.origin.copy(s.getObject().position);var r=void 0;1===x.scene.children.length?r=x.scene.children[0].children:2===x.scene.children.length?r=x.scene.children[1].children:3===x.scene.children.length&&(r=x.scene.children[2].children);var i=l.intersectObjects(r),o=i.length>0;o?(b.y-=9.8*f*t,a=i[0].point.clone()):b.y=0;var u=new n.Vector3(0,0,1);(u=s.getDirection(u)).multiplyScalar(b.z*t);var c=new n.Vector3(1,0,0);(c=s.getDirection(c)).multiplyScalar(b.x*t);var d=new n.Vector3(0,1,0);d.multiplyScalar(b.y*t);var k=u.add(c).add(d),A=h;o&&s.getObject().position.y+k.y<a.y+A&&(b.y=0,k.y=0,s.getObject().position.y=a.y+A,_=!0),s.getObject().translateX(k.x),s.getObject().translateY(k.y),s.getObject().translateZ(k.z),w=e}}};(o.prototype=Object.create(n.EventDispatcher.prototype)).constructor=o,t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=n(r(85)),a=n(r(86)),s=n(r(83)),l=n(r(82)),u=n(r(81)),c=n(r(77)),h=n(r(117)),f=n(r(45)),d=function(e,t,r){function n(e,t){var r;switch(e){case"rotate":r=o.default;break;case"zoom":r=a.default;break;case"pan":r=s.default;break;case"ortho":r=l.default;break;case"orbit":r=u.default;break;case"switch":r=c.default;break;default:throw new Error("Control handler "+e+" is not implemented.")}if(v.handler&&!v.handler.interruptible)return!1;if(!v.handler||v.handler.type!==e){var n=new r(v,t);if(v.handler&&v.handler.priority>n.priority)return!1;v.handler&&v.handler.detach(),v.handler=n}return!0}function d(e){!1!==v.enabled&&(!1===v.enableActions.pan&&0===e.button||!1===v.enableActions.zoom&&1===e.button||!1===v.enableActions.rotate&&2===e.button||(e.preventDefault(),v.handler&&v.handler.onMouseMove(e.clientX,e.clientY)))}function p(e){!1!==v.enabled&&!1!==v.userRotate&&(!1===v.enableActions.pan&&0===e.button||!1===v.enableActions.zoom&&1===e.button||!1===v.enableActions.rotate&&2===e.button||(document.removeEventListener("mousemove",d,!1),document.removeEventListener("mouseup",p,!1),k=!1,v.handler&&v.handler.onMouseUp()))}this.object=e,this.domElement=void 0!==t?t:document,this.picker=r,this.handler=null,this.plane=null,this.centerPan=new i.Vector3,this.maxPanDistance=2e3,this.minOrthoHeight=0,this.maxOrthoHeight=1/0,this.enabled=!0,this.enableActions={zoom:!0,rotate:!0,pan:!0},this.center=new i.Vector3,this.userZoom=!0,this.userZoomSpeed=1,this.userRotate=!0,this.userRotateSpeed=1,this.userPan=!0,this.userPanSpeed=2,this.autoRotateSpeed=.8,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minDistance=0,this.maxDistance=1/0,this.orthoCamera=!1,this.changeEventThreshold=.001,this.groundPlane=null,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40,ROTATE:65,ZOOM:83,PAN:68};this.gestureRecognizer=new f.default(this.domElement,{debug:!1}),this.gestureRecognizer.addEventListener("tap",function(e){},!1),this.gestureRecognizer.addEventListener("double-tap",function(e){v.animateZoomIn()},!1),this.gestureRecognizer.addEventListener("drag-start",function(e){v.dragStart(e.touchEvent.touches[0].pageX*window.devicePixelRatio,e.touchEvent.touches[0].pageY*window.devicePixelRatio)},!1),this.gestureRecognizer.addEventListener("drag",function(e){v.dragMove(e.touchEvent.touches[0].pageX*window.devicePixelRatio,e.touchEvent.touches[0].pageY*window.devicePixelRatio)},!1),this.gestureRecognizer.addEventListener("drag-end",function(e){v.dragEnd()},!1),this.gestureRecognizer.addEventListener("pinch-start",function(e){v.transformStart(e.scale,0,e.deltaTime,0,0)},!1),this.gestureRecognizer.addEventListener("pinch",function(e){v.transform(e.scale,0,e.deltaTime,0,0,e)},!1),this.gestureRecognizer.addEventListener("pinch-end",function(e){v.transformEnd()},!1),this.gestureRecognizer.addEventListener("rotate-start",function(e){v.transformStart(1,e.rotation,e.deltaTime,0,0)},!1),this.gestureRecognizer.addEventListener("rotate",function(e){v.transform(1,e.rotation,e.deltaTime,0,0,e)},!1),this.gestureRecognizer.addEventListener("rotate-end",function(e){v.transformEnd()},!1),this.gestureRecognizer.addEventListener("twofingersweep-start",function(e){v.transformStart(e.scale,e.rotation,e.deltaTime,e.center.pageX,e.center.pageY)},!1),this.gestureRecognizer.addEventListener("twofingersweep",function(e){v.transform(e.scale,e.rotation,e.deltaTime,e.center.pageX,e.center.pageY,e)},!1),this.gestureRecognizer.addEventListener("twofingersweep-end",function(e){v.transformEnd()},!1);var m,v=this,g=new i.Vector3,y=!0,_=!1,w=null,b=0,x=0,k=!1,A=!1,M=null,S={type:"changed"},P={type:"changing"},T={type:"animating"};this.animateZoomIn=function(){!0===n("zoom")&&v.handler.animateZoomIn()},this.animateZoomOut=function(){!0===n("zoom")&&v.handler.animateZoomOut()},this.animateRotateLeft=function(){!0===n("rotate")&&v.handler.animateRotateLeft()},this.animateRotateRight=function(){!0===n("rotate")&&v.handler.animateRotateRight()},this.animateRotateUp=function(){!0===n("rotate")&&v.handler.animateRotateUp(y)},this.animateRotateToTop=function(e){!0===n("rotate")&&v.handler.animateRotateToTop(e)},this.animateRotateToBottom=function(){!0===n("rotate")&&v.handler.animateRotateToBottom()},this.animateRotateAngle=function(e,t,r){!0===n("rotate")&&v.handler.animateRotateAngle(e,t,r)},this.animateToPerspective=function(e,t){if("number"!=typeof e){if(!this.orthoCamera)return;var r=e,o=this.domElement.clientWidth/this.domElement.clientHeight,a=this.object.near,s=this.object.far,l=this.object.position,u=this.object.top,c=l.clone().sub(this.center),h=1/Math.tan(10*Math.PI/360)*u;r.camera=new i.PerspectiveCamera(10,o,a,s),r.camera.position.copy(this.center).add(c.normalize().multiplyScalar(h)),r.camera.lookAt(this.center),r.camera.updateProjectionMatrix(),this.object=r.camera,this.orthoCamera=!1,this.changeEventThreshold=.001,this.maxPolarAngle=m,r.picker.camera=r.camera;var f=this;this.animateToPerspective(u,function(){f.animateRotateUp()})}else{var d=e;y=!1,!0===n("ortho")&&v.handler.animateToPerspective(d,this.object.fov,t)}},this.animateToOrtho=function(e,t){if("number"!=typeof e&&void 0===t){if(this.orthoCamera)return;var r,o,a,s,l,u=e,c=this.object.near,h=this.object.far,f=this;this.animateRotateToTop(function(){l=f.plane.distanceToPoint(f.object.position),r=Math.tan(f.object.fov*Math.PI/360)*l*2,o=r*f.object.aspect,a=f.object.position.clone(),s=f.object.rotation.clone();f.animateToOrtho(r/2,function(){u.camera=new i.OrthographicCamera(-o/2,o/2,r/2,-r/2,c,h),u.camera.position.set(a.x,a.y,a.z),u.camera.rotation.copy(s),u.camera.lookAt(f.center),u.camera.updateProjectionMatrix(),f.object=u.camera,f.orthoCamera=!0,f.changeEventThreshold=1e-5,m=f.maxPolarAngle,f.maxPolarAngle=0,u.picker.camera=u.camera,u.camera.updateMatrix(),u.camera.updateMatrixWorld(),u.camera.matrixWorldInverse.getInverse(u.camera.matrixWorld)})})}else{var d=e;!0===n("ortho")&&v.handler.animateToOrtho(d,this.object.fov,t)}},this.animatePanTo=function(e){var t=e.clone().sub(v.center).dot(v.plane.normal),r=e.clone().sub(v.plane.normal.clone().multiplyScalar(t));r.clone().sub(this.center).length()<v.changeEventThreshold||!0===n("pan")&&v.handler.animatePanTo(this.center,r)},this.animateFlyTo=function(e,t){var r=[];r.push({position:v.object.position.clone(),target:v.center.clone(),duration:1}),r.push({position:e.clone(),target:t.clone(),duration:1}),!0===n("switch",{cameras:r})&&(v.handler.loop=!1)},this.animateOrbit=function(){n("orbit")},this.animateViewpoint=function(e){!0===n("switch",{cameras:e=e||[]})&&(v.handler.loop=!0)},this.dragStart=function(e,t){!1!==v.enabled&&!1!==v.userPan&&!1!==v.enableActions.pan&&(!0===n("pan")&&(_=!0,v.handler.onMouseDown(e,t)),h.default.sendEvent(h.default.Events.Control.Multitouch.OneFingerDrag,!0))},this.dragMove=function(e,t){!1!==v.enabled&&!1!==v.userPan&&_&&v.handler.onMouseMove(e,t)},this.dragEnd=function(){!1!==v.enabled&&!1!==v.userPan&&_&&(_=!1,v.handler.onMouseUp())},this.transformStart=function(e,t,r,n,i){!1!==v.enabled&&(b=t,x=i,w=null,h.default.sendEvent(h.default.Events.Control.Multitouch.TwoFingersTransform,!0))},this.transformEnd=function(){!1!==v.enabled&&(v.handler&&("tilt"===w?v.handler.onMouseUp():v.handler.transformEnd()),w=null)},this.transform=function(e,t,r,i,o,a){if(!1!==v.enabled)if(w)"tilt"===w?v.handler.onMouseMove(0,o):v.handler.transform(e,t);else{var s=100*(Math.abs(e-1)-.08),l=Math.abs(t-b)-1,u=.5*(Math.abs(o-x)-1);a.deltaX*a.deltaY<0&&(u=0),s>0&&s>l&&s>u&&!0===v.enableActions.zoom?!0===n("zoom")&&(v.handler.transformStart(),w="pinch"):l>0&&l>u?!0===n("rotate")&&(v.handler.transformStart(e,t),w="rotate"):u>0&&!0===n("rotate")&&(v.handler.onMouseDown(0,o),w="tilt")}},this.changed=function(){v.dispatchEvent(S)},this.update=function(){if(this.handler){var e;if("switch"===this.handler.type)return e={},this.handler.update(e),e.position&&(e.quaternion||e.center)&&(this.object.position.copy(e.position),e.quaternion?this.object.quaternion.copy(e.quaternion):(this.center.copy(e.center),this.object.lookAt(this.center)),this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.updateProjectionMatrix()),void(!0===e.refresh?this.dispatchEvent(S):this.dispatchEvent(T));var t=this.object.position,r=t.clone().sub(this.center),n=Math.atan2(r.x,r.z),o=Math.atan2(Math.sqrt(r.x*r.x+r.z*r.z),r.y),a=r.length();e={scale:1,panVector:new i.Vector3,thetaDelta:0,phiDelta:0,fov:this.object.fov};var s={radius:this.orthoCamera?this.object.right:a},l=v.handler.needRefresh;this.handler.update(e,s),a*=e.scale,n+=e.thetaDelta,o+=e.phiDelta,this.object.fov=e.fov;var u=e.scale;v.orthoCamera&&(Math.abs(this.object.top*u)>this.minOrthoHeight&&Math.abs(this.object.top*u)<this.maxOrthoHeight?(this.object.left*=u,this.object.right*=u,this.object.top*=u,this.object.bottom*=u):this.handler&&this.handler.onLimit("radius")),o>=this.maxPolarAngle-Math.PI/1800&&(y=!0),o<=this.minPolarAngle+Math.PI/1800&&(y=!1),o=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,o)),o=Math.max(1e-6,Math.min(Math.PI-1e-6,o)),this.center.clone().add(e.panVector).sub(this.centerPan).length()>this.maxPanDistance&&e.panVector.multiplyScalar(0);var c=this.minDistance,h=this.maxDistance;if(v.groundPlane){var f=new i.Ray(t.clone(),r.clone().normalize().negate()).intersectPlane(v.groundPlane);if(f){var d=t.clone().sub(f).length()-r.length();c-=Math.max(d,0),h-=Math.max(d,0)}}((a=Math.max(c,Math.min(h,a)))<=c||a>=h)&&this.handler&&this.handler.onLimit("radius"),r.x=a*Math.sin(o)*Math.sin(n),r.y=a*Math.cos(o),r.z=a*Math.sin(o)*Math.cos(n),this.center.add(e.panVector),t.copy(this.center).add(r),this.object.lookAt(this.center),g.distanceTo(this.object.position)>v.changeEventThreshold&&(!0===e.refresh?this.dispatchEvent(S):!0===l?this.dispatchEvent(T):this.dispatchEvent(P),g.copy(this.object.position)),this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.updateProjectionMatrix(),e.callback&&e.callback()}},this.getRadius=function(){return v.orthoCamera?v.object.right:v.object.position.clone().sub(v.center).length()},this.getPhi=function(){var e=this.object.position.clone().sub(this.center);return Math.atan2(Math.sqrt(e.x*e.x+e.z*e.z),e.y)},this.getUserScrolled=function(){return A},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",function(e){if(!1!==v.enabled&&!1!==v.userRotate&&(!1!==v.enableActions.pan||0!==e.button)&&!(!1===v.enableActions.zoom&&1===e.button||!1===v.enableActions.rotate&&2===e.button)){if(e.preventDefault(),!k){var t=!1;0===e.button?t=n("pan"):1===e.button?t=n("zoom"):2===e.button&&(t=n("rotate")),t&&(k=!0,v.handler.onMouseDown(e.clientX,e.clientY))}var r=0===e.button?h.default.Events.Control.Mouse.MousePan:1===e.button?h.default.Events.Control.Mouse.MouseZoom:h.default.Events.Control.Mouse.MouseRotate;h.default.sendEvent(r,!0),document.addEventListener("mousemove",d,!1),document.addEventListener("mouseup",p,!1)}},!1),function(e,t,r){var n="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"MozMousePixelScroll";e.addEventListener(n,"wheel"===n?t:function(e){!e&&(e=window.event);var r={originalEvent:e,target:e.target||e.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"===e.type?0:1,deltaX:0,deltaY:0,deltaZ:0,preventDefault:function(){e.preventDefault?e.preventDefault():e.returnValue=!1}};"mousewheel"===n?(r.deltaY=-.025*e.wheelDelta,e.wheelDeltaX&&(r.deltaX=-.025*e.wheelDeltaX)):r.deltaY=e.detail,t(r)},!1)}(this.domElement,function(e){if(!1===v.enabled)return!1;if(!1===v.userZoom)return!0;if(!k&&!1!==v.enableActions.zoom){if(e.preventDefault(),A=!0,!0===n("zoom",{wheel:!0})){var t=40*-e.deltaY;v.handler.onMouseWheel(t)}h.default.sendEvent(h.default.Events.Control.Mouse.MouseScroll,!0),M&&clearTimeout(M),A&&(M=setTimeout(function(){A=!1},1e3))}})};(d.prototype=Object.create(i.EventDispatcher.prototype)).constructor=d,t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(e){return e&&e.__esModule?e:{default:e}}(r(6)),o=function(e){i.default.call(this,e),this.type="orbit",this.priority=100,this.needRefresh=!0;var t=new n.Clock,r=t.getElapsedTime();this.update=function(e){var n=t.getElapsedTime();e.thetaDelta=2*Math.PI/60/60*.4,Math.abs(r-n)>4&&(e.refresh=!0,r=n)}};o.prototype.constructor=o,o.prototype=Object.create(i.default.prototype),t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(e){return e&&e.__esModule?e:{default:e}}(r(6)),o=function(e){i.default.call(this,e),this.type="ortho",this.priority=2e3,this.interruptible=!1;var t,r,o,a,s,l,u,c,h=new n.Clock,f=this;this.animateToOrtho=function(n,i,o){s=10,a=i,l=n,u=e.maxDistance,e.maxDistance=1/0,t=h.getElapsedTime(),r=t+.5,c=o},this.animateToPerspective=function(n,i,o){s=30,a=i,l=n,u=e.maxDistance,e.maxDistance=1/0,t=h.getElapsedTime(),r=t+.5,c=o},this.update=function(n,i){o=h.getElapsedTime();var d=i.radius;if(Math.abs(n.fov-s)<.05)n.callback=c,c=null,e.maxDistance=u,f.detach();else{var p=f.easing.Quadratic.Out((o-t)/(r-t));p=o>r?1:p,n.fov=a+p*(s-a);var m=1/Math.tan(n.fov*Math.PI/360)*l;n.scale=m/d,Math.abs(n.fov-s)<.05&&(n.callback=c,c=null,e.maxDistance=u,f.detach())}},this.detach=function(){null!=u&&(e.maxDistance=u,u=null),i.default.prototype.detach.call(this)}};o.prototype.constructor=o,o.prototype=Object.create(i.default.prototype),t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(e){return e&&e.__esModule?e:{default:e}}(r(6)),o=function(e){function t(e,t,r){var i=v.controls.plane,o=v.controls.picker;if(null!=i){var a=o.getRay(e.x,e.y).direction.angleTo(i.normal)-.5*Math.PI,s=15/180*Math.PI;if(Math.abs(a)<s){var l=v.controls.object.position.clone().sub(v.controls.center).normalize(),u=i.normal.clone().cross(l),c=a<=0?-(a+s):s-a,h=(new n.Matrix4).makeRotationAxis(u,c);i=i.clone().applyMatrix4(h)}var f=o.sceneGraphRoot;o.sceneGraphRoot=i;var d=o.pickPoint(e.x,e.y),p=o.pickPoint(t.x,t.y);if(o.sceneGraphRoot=f,null==d||null==p){var m=o.getRay(e.x,e.y).clone();if(m.direction.negate(),p=m.intersectPlane(i),(m=o.getRay(t.x,t.y).clone()).direction.negate(),null==(d=m.intersectPlane(i))||null==p)return}var g=(new n.Vector3).subVectors(d,p);r.panVector=g}}i.default.call(this,e),this.type="pan",this.priority=900;var r,o,a,s=new n.Clock,l=!1,u=!1,c=new n.Vector2,h=new n.Vector2,f=new n.Vector2,d=new n.Vector2,p=new n.Vector3,m=new n.Vector3,v=this;this.animatePanTo=function(e,t){u=!0,p.copy(e),m.copy(t),a=r=s.getElapsedTime(),o=r+1},this.update=function(e){var n;if(a=s.getElapsedTime(),u){var i=m.clone().sub(p);if(a>o)e.panVector=i,v.detach();else{n=v.easing.Quadratic.InOut((a-r)/(o-r)),n=a>o?1:n;var g=i.multiplyScalar(n);p.add(g),e.panVector=g}}else{n=(a-r)/(o-r)*4,n=1-Math.pow(2,-n);var y=h.clone();h=c.clone().add(f.clone().sub(c).multiplyScalar(n)),d.subVectors(h,y),l&&d.length()<.5?(l=!1,v.detach()):t(y,h,e)}},this.onMouseDown=function(e,t){u&&(u=!1),l=!1,c.set(e,t),f.set(e,t),h.set(e,t),a=r=s.getElapsedTime(),o=r+.05,v.adjustPlane(e,t),v.adjustCenter()},this.onMouseMove=function(e,t){u||(c.copy(h),f.set(e,t),a=r=s.getElapsedTime(),o=r+.05)},this.onMouseUp=function(){if(!u){var e=(d=f.clone().sub(h)).length();e>=1?(l=!0,e>3&&(f=h.clone().add(d.multiplyScalar(3)),r=s.getElapsedTime(),o=r+.2,c.set(h.x,h.y))):v.detach()}}};o.prototype.constructor=o,o.prototype=Object.create(i.default.prototype),t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(e,t){var r=this;e.rotation.set(0,0,0),e.updateMatrix();var i=new n.Object3D;i.add(e);var o=new n.Object3D;o.position.y=10,o.add(i);var a=new n.Object3D;a.add(o);var s=Math.PI/2,l=t.onMove,u=function(e){if(!1!==r.enabled){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,n=e.movementY||e.mozMovementY||e.webkitMovementY||0;o.rotation.y-=.002*t,i.rotation.x-=.002*n,i.rotation.x=Math.max(-s,Math.min(s,i.rotation.x)),l&&l()}};this.dispose=function(){document.removeEventListener("mousemove",u,!1)},document.addEventListener("mousemove",u,!1),this.enabled=!1,this.getObject=function(){return a},this.initRotation=function(e){o.rotation.y=e.y,i.rotation.x=e.x},this.getDirection=function(e){var t=e.clone(),r=new n.Euler(0,0,0,"YXZ");return r.set(i.rotation.x,o.rotation.y,0),t.applyEuler(r),t}};i.prototype.constructor=i,t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(e){return e&&e.__esModule?e:{default:e}}(r(6)),o=function(e){function t(e,t){void 0===e&&(e=o()),t.thetaDelta-=e}function r(e,t){void 0===e&&(e=o()),t.phiDelta-=e}function o(){return 2*Math.PI/60/60*e.autoRotateSpeed}i.default.call(this,e),this.type="rotate",this.priority=900;var a,s,l,u,c=new n.Clock,h=!1,f=!1,d=!1,p=new n.Vector2,m=new n.Vector2,v=new n.Vector2,g=new n.Vector2,y=new n.Vector2,_=new n.Vector2,w=0,b=0,x=0,k=this;this.animateRotateLeft=function(){f=!0,y.set(0,0),_.set(Math.PI/3,0),l=a=c.getElapsedTime(),s=a+1,k.adjustCenter()},this.animateRotateRight=function(){f=!0,y.set(0,0),_.set(-Math.PI/3,0),l=a=c.getElapsedTime(),s=a+1,k.adjustCenter()},this.animateRotateUp=function(e){f=!0,y.set(0,0),k.adjustCenter(),l=a=c.getElapsedTime(),s=a+1,e?_.set(0,Math.PI/9):_.set(0,-Math.PI/9)},this.animateRotateToTop=function(t){t&&(this.interruptible=!1),f=!0,y.set(0,0),_.set(0,e.getPhi()),l=a=c.getElapsedTime(),s=a+1,u=t},this.animateRotateAngle=function(e,t,r){e&&(this.interruptible=!1),f=!0,y.set(0,0),_.set(t,r),l=a=c.getElapsedTime(),s=a+1,u=e},this.animateRotateToBottom=function(){f=!0;var t=e.getPhi(),r=e.maxPolarAngle;t>r&&(e.maxPolarAngle=Math.PI,u=function(){e.maxPolarAngle=r}),y.set(0,0),_.set(0,t-r),l=a=c.getElapsedTime(),s=a+1},this.update=function(n){var i;if(l=c.getElapsedTime(),f)if(Math.abs(_.x-y.x)<Math.PI/180&&Math.abs(y.y-_.y)<Math.PI/180)u&&(n.callback=u,u=null,this.interruptible=!0),k.detach();else{i=k.easing.Quadratic.InOut((l-a)/(s-a)),i=l>s?1:i;var o=_.clone().sub(y).multiplyScalar(i);t(o.x,n),r(o.y,n),y.add(o)}else if(d){h&&Math.abs(x-b)<.01&&k.detach(),i=(l-a)/(s-a)*4,i=1-Math.pow(2,-i);var A=b;b=w+i*(x-w),t(Math.PI*(A-b)/180,n)}else{i=(l-a)/(s-a)*4,i=1-Math.pow(2,-i);var M=m.clone();m=p.clone().add(v.clone().sub(p).multiplyScalar(i)),g.subVectors(m,M),h&&g.length()<.5?k.detach():(t(2*Math.PI*g.x/1800*e.userRotateSpeed,n),r(2*Math.PI*g.y/1800*e.userRotateSpeed,n))}},this.onMouseDown=function(e,t){f&&(f=!1),d=!1,h=!1,p.set(e,t),v.set(e,t),m.set(e,t),l=a=c.getElapsedTime(),s=a+.05,k.adjustCenter()},this.onMouseMove=function(e,t){f||(p.copy(m),v.set(e,t),l=a=c.getElapsedTime(),s=a+.05)},this.onMouseUp=function(){f||((g=v.clone().sub(m)).length()>=1?(h=!0,v=m.clone().add(g.multiplyScalar(3)),a=c.getElapsedTime(),s=a+.2,p.set(m.x,m.y)):k.detach())},this.transformStart=function(e,t){d=!0,h=!1,w=t,x=t,b=t,a=c.getElapsedTime(),s=a+.05,k.adjustCenter()},this.transform=function(e,t){for(w=b,x=t;w>180;)w-=360;for(;w<-180;)w+=360;for(;x-w>180;)x-=360;for(;x-w<-180;)x+=360;a=c.getElapsedTime(),s=a+.05},this.transformEnd=function(){var e=Math.abs(x-b);if(e>.01){for(h=!0,w=b,e>2&&(x+=2*(x-b));x-w>180;)x-=360;for(;x-w<-180;)x+=360;a=c.getElapsedTime(),s=a+.2}else k.detach()}};o.prototype.constructor=o,o.prototype=Object.create(i.default.prototype),t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(e){return e&&e.__esModule?e:{default:e}}(r(6)),o=function(e,t){function r(){A.adjustCenter(),x=e.getRadius(),_=.001*x}function o(e){void 0===e&&(e=s()),x*=w/=e}function a(e){void 0===e&&(e=s()),x*=w*=e}function s(){return Math.pow(.95,e.userZoomSpeed)}i.default.call(this,e),this.type="zoom",this.priority=900;var l,u,c,h=new n.Clock,f=!1,d=!1,p=!1,m=new n.Vector2,v=new n.Vector2,g=new n.Vector2,y=new n.Vector2,_=1,w=1,b=0,x=0,k=0,A=this;d=!0===(t=t||{}).wheel,r(),this.animateZoomIn=function(){p=!0,f=!0,x=.75*e.getRadius(),b=e.getRadius(),c=l=h.getElapsedTime(),u=l+.2},this.animateZoomOut=function(){p=!0,f=!0,x=1.5*e.getRadius(),b=e.getRadius(),c=l=h.getElapsedTime(),u=l+.2},this.update=function(e,t){var r=t.radius,n=((c=h.getElapsedTime())-l)/(u-l)*4;n=1-Math.pow(2,-n),d&&c>u&&(f=!0),Math.abs(r*w-x)<_&&f?A.detach():e.scale=(b+n*(x-b))/r,w=1},this.onMouseDown=function(t,n){p&&(p=!1),m.set(t,n),g.set(t,n),v.set(t,n),r(),b=e.getRadius(),c=l=h.getElapsedTime(),u=l+.1,f=!1},this.onMouseMove=function(t,r){p||(m.copy(v),g.set(t,r),y.subVectors(g,m),b=e.getRadius(),y.y>0?o():a(),c=l=h.getElapsedTime(),u=l+.1)},this.onMouseUp=function(){p||(b=e.getRadius(),l=h.getElapsedTime(),u=l+.3,f=!0)},this.onMouseWheel=function(t){if(p&&(p=!1),!((c=h.getElapsedTime())-l<.04)){var r;if(l=h.getElapsedTime(),u=l+.5,b=e.getRadius(),t>0){for(t=Math.max(t,10),r=.95;t/10>=1;)r*=.95,t/=10;a(r)}else{for(t=Math.max(-t,10),r=.95;t/10>=1;)r*=.95,t/=10;o(r)}f=!1}},this.transformStart=function(){r(),k=x,b=x,l=h.getElapsedTime(),u=l+.1,f=!1},this.transform=function(t){var r=t;b=e.getRadius(),x=k/r,l=h.getElapsedTime(),u=l+.1},this.transformEnd=function(){b=e.getRadius(),l=h.getElapsedTime(),u=l+.3,f=!0},this.onLimit=function(e){"radius"===e&&A.detach()}};o.prototype.constructor=o,o.prototype=Object.create(i.default.prototype),t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=n(r(48)),a=n(r(13)),s=n(r(46)),l=r(0),u=function(){function e(t,r,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),t instanceof s.default&&r instanceof s.default&&n instanceof Object&&void 0!==n.start&&void 0!==n.end?(this.src=t,this.dst=r,this.time=n,this._enabled=!1):console.error("EarthCameraPath",t,r,n)}return i(e,[{key:"destruct",value:function(){return this.enabled=!1,this.src.destruct(),this.dst.destruct(),this.time={},!0}},{key:"sync",value:function(e){e instanceof o.default?this.src.value=e.value:e.isMatrix4&&(this.src.matrix=e)}},{key:"destinate",value:function(t,r){if(!(arguments.length>2&&void 0!==arguments[2])||arguments[2],this.onFail(new Error("destination changed")),t.isMatrix4)this.dst.matrix=t;else{if(!(t instanceof Object))return Promise.reject();this.dst.value=t}this.duration=r,this.enabled=!0;var n=this;return this.destinated=a.default.timedPromise(new Promise(function(e,t){n._onDestinated=e,n._onInterrupted=t}),e.MAX_FLY_DURATION),this.destinated}},{key:"interrupt",value:function(e){this.onFail(e)}},{key:"_interpolateMatirx",value:function(e){var t=this.src.POS,r=t.position,n=t.orientation,i=this.dst.POS,o=i.position,a=i.orientation,u=r.clone().lerp(o,e),c=n.clone().slerp(a,e).normalize(),h=new l.Vector3(1,1,1),f=(new l.Matrix4).compose(u,c,h),d=new s.default;return d.matrix=f,d}},{key:"_interpolatePose",value:function(e){var t=this.src.value,r=this.dst.value,n={};return["lng","lat","alt","north","tilt","up"].forEach(function(i){n[i]=function(e,t,r){return e*(1-r)+r*t}(t[i],r[i],e)}),new s.default(n)}},{key:"_interpolateSpherical",value:function(e){var t=this.src.POS,r=t.position,n=t.orientation,i=this.dst.POS,o=i.position,a=i.orientation,u=(new l.Spherical).setFromVector3(r.clone()),c=(new l.Spherical).setFromVector3(o.clone()),h=new l.Spherical((1-e)*u.radius+e*c.radius,(1-e)*u.phi+e*c.phi,(1-e)*u.theta+e*c.theta),f=(new l.Vector3).setFromSpherical(h),d=n.clone().slerp(a,e).normalize(),p=new l.Vector3(1,1,1),m=(new l.Matrix4).compose(f,d,p),v=new s.default;return v.matrix=m,v}},{key:"orbitLeft",value:function(e,t){(new l.Quaternion).setFromEuler(new l.Euler(0,0,this.north)).clone().inverse()}},{key:"swirlLeft",value:function(e,t){}},{key:"onComplete",value:function(){this.src.value=this.dst.value,this.enabled=!1,this._onDestinated()}},{key:"_onDestinated",value:function(){}},{key:"onFail",value:function(e){if(this.enabled){var t=this.pose;if(t){var r=t.matrix;this.src.matrix=r,this.dst.matrix=r}this.enabled=!1,this._onInterrupted(e)}}},{key:"_onInterrupted",value:function(){}},{key:"reset",value:function(){this.src.reset(),this.dst.reset(),this.duration=0,this.onFail()}},{key:"enabled",set:function(e){this._enabled=e},get:function(){return this._enabled}},{key:"focus",get:function(){return new l.Vector3}},{key:"pose",get:function(){if(this.enabled){this.time.current=Date.now();var e=this.time.current-this.time.start,t=e/(this.time.end-this.time.start);return isNaN(t)?(console.error("pose",t),void this.onFail()):(t>1?t=1:t<0?(console.warn(e/1e3+" seconds to start."),t=0):(t=.50005*(Math.sin((t-.5)*Math.PI)+1),t=Math.min(Math.max(t,0),1)),t>=1?(this.onComplete(),this.dst):this._interpolateSpherical(t))}}},{key:"duration",set:function(t){if(t<0||t>e.MAX_FLY_DURATION)console.error("EarthCameraPath.duration",t);else{var r=Date.now();this.time.start=r-1,this.time.current=r,this.time.end=r+t}}}],[{key:"MAX_FLY_DURATION",get:function(){return 3e5}}]),e}();t.default=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=n(r(3)),a=n(r(14)),s=r(0),l=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.dd=!0,this.scale=1,this.resolution=a.default.EarthResolution,this.rayCaster=new s.Raycaster,this.proxy=this._createProxy(),this.tempCam=new s.PerspectiveCamera(40,1,1e-7,2.5)}return i(e,[{key:"intersect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Vector2(0,0);this.tempCam.matrix.identity(),this.tempCam.applyMatrix(e),this.tempCam.updateMatrixWorld(!0),this.rayCaster.setFromCamera(t,this.tempCam);var r=this.rayCaster.intersectObject(this.proxy,!1);if(r.length>0)return r[0].point}},{key:"_createProxy",value:function(){var e=o.default.getTileCartesianGeometryByGrid(0,0,0,this.scale,Math.pow(2,this.resolution));return new s.Mesh(e)}}]),e}();t.default=l},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=n(r(47)),a=n(r(3)),s=r(0),l=function(e){function t(e){var r=e.camera,n=e.domElement,i=e.control,o=e.scale,a=e.resolution;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{camera:r,domElement:n}));return s._control=i,s.scale=o,s.resolution=a,s.proxy=s._createProxy(),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"_createProxy",value:function(){var e=a.default.getTileCartesianGeometryByGrid(0,0,0,this.scale,Math.pow(2,this.resolution)),t=new s.Mesh(e);return t.matrixAutoUpdate=!1,t}},{key:"earthToCam",get:function(){var e=this._control._pose.matrix;return(new s.Matrix4).getInverse(e)}},{key:"targets",get:function(){return this.proxy.matrix.identity(),this.proxy.applyMatrix(this.earthToCam),this.proxy.updateMatrixWorld(!0),[this.proxy]},set:function(e){console.warn("Not allowed")}}]),t}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r(47)),o=function(e){function t(e){var r=e.camera,n=e.layers,i=e.domElement;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{camera:r,domElement:i}));return o._layers=n,o.layerName="altizureMesh",o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),n(t,[{key:"layer",get:function(){return this._layers[this.layerName]},set:function(e){this.layerName=e}},{key:"targets",get:function(){if(!this.layer)return[];for(var e=[],t=0;t<this.layer.children.length;t++)if(this.layer.children[t].visible){var r=this.layer.children[t].treeNode;r&&e.push(r)}return e},set:function(e){console.warn("Not allowed")}}]),t}();t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),a=n(r(22)),s=n(r(114)),l=function(){function e(t,r,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.data=[],this.trash=[];for(var i=0;i<t.length;i++)this.data.push({path:t[i],type:r[i],tree_options:n[i],info:null,tree:null,sceneGraphRoot:null})}return i(e,[{key:"loadInfo",value:function(e,t,r){var n=this,i=0;this.data.map(function(a){a.info=new s.default(a.path,e.isMobile,e.versionControl),a.info.load(a.path,function(e){i+=1;var r=new o.Object3D;r.applyMatrix(e.transformation.getOnloadMatrix()),r.updateMatrixWorld(),a.sceneGraphRoot=r,i===n.data.length&&t()},r)})}},{key:"constructSmartTrees",value:function(e,t,r,n){this.data.map(function(i){var s=i.info,l=i.path,u=i.type,c=i.tree_options||{};c.display_lod=r.debugMode,c.bbox=r.bbox,c.quality=r.quality,c.onError=r.errorFunction,c.MAX_CACHE_SIZE=s.lru_size,c.maxAnisotropy=t.getMaxAnisotropy(),c.viewModeType=r.viewModeType,c.viewMode=r.viewMode,c.PID=n,c.dataPath=r.dataPath,c.editMask=r.editMask,c.side=r.waterMode?o.DoubleSide:o.FrontSide,c.eventHandlers=r.eventHandlers,c.HOST=r.HOST,c.altizureApi=r.altizureApi;var h=i.sceneGraphRoot;e.add(h),h.name=l,i.tree=new a.default(u,h,l,s,c)})}},{key:"removeTree",value:function(e){var t=null;this.data.map(function(r,n){if(r.type===e){var i=r.sceneGraphRoot;i&&i.parent&&i.parent.remove(i),t=n}}),null!=t&&(this.trash.push(this.data[t]),this.data.splice(t,1))}},{key:"restoreTree",value:function(e,t){var r=null;this.trash.map(function(n,i){if(n.type===e){var o=n.sceneGraphRoot;o&&t.add(o),r=i}}),null!=r&&(this.data.push(this.trash[r]),this.trash.splice(r,1))}},{key:"getDataByType",value:function(e){if(!e)return this.data[0];var t=null;return this.data.map(function(r){r.type===e&&(t=r)}),t}},{key:"getTreeByType",value:function(e){var t=this.getDataByType(e);return t?t.tree:null}},{key:"getInfoByType",value:function(e){var t=this.getDataByType(e);return t?t.info:null}},{key:"getSceneGraphRootByType",value:function(e){var t=this.getDataByType(e);return t?t.sceneGraphRoot:null}}]),e}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r(10)),o=r(26),a=r(0),s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=e.earthSceneNode,n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r));n._camera=e.camera;var i=e.scale,s=new a.SphereBufferGeometry(1.00505*i,512,512);return n.material=new o.AtmosphereSelfShaderMaterial,n.mesh=new a.Mesh(s,n.material),n.mesh.name="Atmosphere mesh",n.sceneNode.name="Atmosphere Class",n.sceneNode.add(n.mesh),n.height=0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),n(t,[{key:"destruct",value:function(){return this.sceneNode.remove(this.mesh),this.mesh.geometry.dispose(),this.mesh.material.map&&this.mesh.material.map.dispose(),this.mesh.material.dispose(),this.mesh=null,!0}},{key:"animate",value:function(e){var t=new a.Vector3;t.setFromMatrixPosition(this.matrixWorld),this.material.setCenter(t.clone())}},{key:"_XYZ",value:function(){function e(e,r,n,i){var o,s=new a.Geometry;return o=i?new a.LineDashedMaterial({linewidth:1,color:n,dashSize:t/1e3,gapSize:t/300}):new a.LineBasicMaterial({linewidth:1,color:n}),s.vertices.push(e.clone()),s.vertices.push(r.clone()),s.computeLineDistances(),new a.LineSegments(s,o)}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001;return function(t){var r=new a.Object3D;return r.add(e(new a.Vector3(0,0,0),new a.Vector3(t,0,0),16711680,!1)),r.add(e(new a.Vector3(0,0,0),new a.Vector3(-t,0,0),16711680,!0)),r.add(e(new a.Vector3(0,0,0),new a.Vector3(0,t,0),65280,!1)),r.add(e(new a.Vector3(0,0,0),new a.Vector3(0,-t,0),65280,!0)),r.add(e(new a.Vector3(0,0,0),new a.Vector3(0,0,t),255,!1)),r.add(e(new a.Vector3(0,0,0),new a.Vector3(0,0,-t),255,!0)),r}(t)}},{key:"updateMatrixWorld",value:function(e){if(!0!==this.matrixWorldNeedsUpdate&&!0!==e||(null===this.parent?this._matrixWorld.copy(this._matrix):this._matrixWorld.multiplyMatrices(this.parent.matrixWorld,this._matrix),this.matrixWorldNeedsUpdate=!1,e=!0),e){var t=this.matrixWorld.elements;this.sceneNode.matrix.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],1)}}}]),t}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r(3)),o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"getBlueMarbleCNImageUrl",value:function(e,t,r){return"http://172.18.22.83:18090/bluemarble/wtb200401/"+e+"/"+t+"/"+r+".jpg"}},{key:"getBlueMarbleImageUrl",value:function(e,t,r){return"http://172.18.22.83:18090/bluemarble/wtb200401/"+e+"/"+t+"/"+r+".jpg"}},{key:"getOSMImageUrl",value:function(e,t,r){return"http://"+["a","b","c"][(e+r+t)%3]+".tile.openstreetmap.org/"+e+"/"+t+"/"+r+".png"}},{key:"getBingImageUrl",value:function(e,t,r){var n,o=t,a=r,s=i.default.numerationSystemFrom10(2,o),l=i.default.numerationSystemFrom10(2,a),u=s.length-l.length;if(u>0)for(n=0;n<u;n++)l="0"+l;else if(u<0)for(u=-u,n=0;n<u;n++)s="0"+s;var c="";for(n=0;n<l.length;n++)c+=l[n]+s[n];var h=i.default.numerationSystemChange(2,4,c);if(h.length<e)for(u=e-h.length,n=0;n<u;n++)h="0"+h;return"//ecn.t"+(e+r+t)%8+".tiles.virtualearth.net/tiles/h"+h+".jpeg?g=1239&mkt=en-us"}},{key:"getCartoImageUrl",value:function(e,t,r){return"//cartodb-basemaps-c.global.ssl.fastly.net/light_all/"+e+"/"+t+"/"+r+".png"}},{key:"getGoogleCNImageUrl",value:function(e,t,r){return"http://mt"+["0","1","2","3"][(e+r+t)%4]+".google.cn/vt/lyrs=s&x="+t+"&y="+r+"&z="+e}},{key:"getGoogleImageUrl",value:function(e,t,r){return"https://mts"+["1","2","3","0"][(e+r+t)%4]+".google.com/vt/lyrs=s&x="+t+"&y="+r+"&z="+e}},{key:"getGaodeImageUrl",value:function(e,t,r){return"https://wprd0"+["1","2","3","4"][(e+r+t)%4]+".is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=6&x="+t+"&y="+r+"&z="+e}},{key:"getTencentImageUrl",value:function(e,t,r){var n=["0","1","2","3"][(e+r+t)%4],i=t,o=Math.pow(2,e)-1-r;return"http://p"+n+".map.gtimg.com/sateTiles/"+e+"/"+Math.floor(i/16)+"/"+Math.floor(o/16)+"/"+i+"_"+o+".jpg?version=117"}},{key:"getOpenCycleImageUrl",value:function(e,t,r){return"https://"+["a","b","c"][(e+r+t)%3]+".tile.opencyclemap.org/cycle/"+e+"/"+t+"/"+r+".png"}},{key:"getGoogleMoonImageUrl",value:function(e,t,r){return"https://crossorigin.me/http://mw"+["1","2"][(e+(r=Math.pow(2,e)-1-r)+t)%2]+".google.com/mw-planetary/lunar/lunarmaps_v1/clem_bw/"+e+"/"+t+"/"+r+".jpg"}},{key:"getHiriseMarsVisibleImageUrl",value:function(e,t,r){return"https://crossorigin.me/http://gmaps-bkup.uahirise.org/mars/visible/"+e+"/"+t+"/"+(r=Math.pow(2,e)-1-r)+".jpg"}},{key:"getNasaMarsTrekImageUrl",value:function(e,t,r){return"https://trektiles.jpl.nasa.gov/trektiles/Mars/EQ/Mars_Viking_MDIM21_ClrMosaic_global_232m/1.0.0//default/default028mm/"+e+"/"+r+"/"+t+".png"}},{key:"getNasaMoonTrekImageUrl",value:function(e,t,r){return"https://moontrek.jpl.nasa.gov/trektiles/Moon/EQ/LRO_WAC_Mosaic_Global_303ppd_v02/1.0.0//default/default028mm/"+e+"/"+r+"/"+t+".jpg"}},{key:"getEsriLunarImageUrl",value:function(e,t,r){return"https://crossorigin.me/https://webgis2.wr.usgs.gov/Lunar_Global_GIS/ESRI.ArcGIS.ADF.Web.DataSources.ArcGISServer.TileHandler.ashx?tile=c2d7c76d558f4dfb8ffde861c9229b2e&level="+e+"&column="+t+"&row="+r}}]),e}();t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=n(r(52)),a=n(r(11)),s=function(e){function t(e,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,n));return i.maxLevel=n.maxLevel,i.minLevel=n.minLevel,i.tree_size_limit=n.tree_size_limit,i.node_options.earthRadius=n.earthRadius,i.node_options.useColor=n.useColor,i.node_options.planet=n.planet,i.node_options.useTexture=n.useTexture,i.node_options.maxAnisotropy=n.maxAnisotropy,i.node_options.fullScene=n.fullScene,i.node_options.countryName=n.countryName,i.node_options.treeMatrix=new a.default,i.node_options.treeMatrixWorld=new a.default,i.name="EarthSurfaceTree",i.root=new i.Node(0,0,0,null,i.node_options),i.numOfNodes++,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"expand",value:function(e){if(e.level>=this.maxLevel)return console.warn(e,"exceed max level",this.maxLevel),!1;if(e.nodes.length>0)return console.warn(e,"children exist"),!1;if(0===e.nodes.length){var t=e.x,r=e.y,n=e.level;return e.nodes[0]=new this.Node(2*t,2*r,n+1,e,this.node_options),e.nodes[1]=new this.Node(2*t,2*r+1,n+1,e,this.node_options),e.nodes[2]=new this.Node(2*t+1,2*r,n+1,e,this.node_options),e.nodes[3]=new this.Node(2*t+1,2*r+1,n+1,e,this.node_options),this.numOfNodes+=4,!0}return console.warn("unknown giveBirth error"),!1}},{key:"updateMatrix",value:function(e){this.matrixWorld.multiplyMatrices(e,this.matrix),function e(t){t.updateMatrix();for(var r=0;r<t.nodes.length;r++)e(t.nodes[r])}(this.root)}},{key:"matrix",get:function(){return this.node_options.treeMatrix}},{key:"matrixWorld",get:function(){return this.node_options.treeMatrixWorld}}]),t}();t.default=s},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=n(r(20)),a=n(r(49)),s=n(r(105)),l=n(r(38)),u=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a.default,r)),i=r.isMobile;n.featuredProjects={status:"empty",skip:0};var o={FOREST_CAPACITY:i?110:280,MAX_DOWNLOAD_CONCURRENCY:i?4:10,MIN_AREA:i?.1:.01,MAX_LEVEL:i?10:12,allowWorker:!0},u={trees:[],CACHE_CAPACITY:i?140:350};return n.forest=new l.default(o,u),n.entityCache=new s.default(r.ENTITY_CACHE_SIZE),n._visibleAltizureProjects=[],n.altizureApi=r.altizureApi,n.altizureApi||console.error("AltizureLayer altizureApi undefined."),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"destruct",value:function(){var e=!0;return e=e&&this.forest.destruct(),this.forest=null,e&&function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"import",value:function(e,t){var r=e.type,n=[];if("custom"===r){for(var i=e.data,o=0;o<i.length;o++){var a=i[o];a.id&&n.push({id:a.id,name:a.name,geoInfo:{centerLat:a.geoInfo.centerLat,centerLong:a.geoInfo.centerLong}})}return this._visibleAltizureProjects=n,this.importMore(e,t)}var s="AltizureLayer:"+r+"is not supported yet";return console.warn(s),Promise.reject(s)}},{key:"importMore",value:function(e,t){var r=t.eventHandlers.onImportFinished,n=t.eventHandlers.onError,i={onEntityCreated:t.eventHandlers.onEntityCreated,onEntityModelInitialized:t.eventHandlers.onEntityModelInitialized},o=e.type;if("featured"===o)return Promise.reject(new Error("feature import is not maintained."));if("custom"===o){for(var a=e.data,s=[],l=0;l<a.length;l++)if(this.validateTargetProject(a[l])){var u=this.createEntity(a[l],{eventHandlers:i});s.push(u)}else s.push(Promise.resolve(null));return Promise.all(s).then(function(e){for(var t=0,n=0;n<e.length;n++)e[n]&&(t+=1);return r("layer complete:"+t+"/"+e.length),Promise.resolve()}).catch(function(e){return console.warn("importMore error",e),Promise.rejct()})}if("animated"===o)return Promise.reject(new Error("animated import is not maintained."));if("ids"===o)return Promise.reject(new Error("ids import is not maintained."));var c="AltizureLayer unknown import type "+o;return n(c),Promise.reject(c)}},{key:"validateTargetProject",value:function(e){function t(e){return e>=-180.001&&e<=180.001}function r(e){return e>=-90.001&&e<=90.001}var n=!0;return!!e&&!!e.geoInfo&&!!e.geoInfo.autoAligned&&((n=(n=n&&t(e.geoInfo.minLong)&&t(e.geoInfo.maxLong)&&r(e.geoInfo.minLat)&&r(e.geoInfo.maxLat))&&Math.abs(e.geoInfo.maxLong-e.geoInfo.minLong)<2)&&Math.abs(e.geoInfo.maxLat-e.geoInfo.minLat)<2)}},{key:"createEntity",value:function(e,t){var r={PID:e.id,apiInfo:e,eventHandlers:t.eventHandlers,forest:this.forest,altizureApi:this.altizureApi};for(var n in this.options)r[n]=this.options[n];var i=this.entityCache.getByEntry({layer:this,entityOptions:r});return Promise.resolve(i)}},{key:"removeEntity",value:function(e){var t=!0;return(t=t&&e.deport())&&this.removeChild(e)}},{key:"sceneUpdated",value:function(e){this.forest.sceneUpdated(e),this.applyToChildren(function(e,t){e.sceneUpdated(t)},e)}},{key:"visibleAltizureProjects",value:function(){return Array.isArray(this._visibleAltizureProjects)?this._visibleAltizureProjects:(console.warn("_visibleAltizureProjects is not array",this._visibleAltizureProjects),[])}}]),t}();t.default=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){o.Object3D.call(this);var r=this;this.visible=!1,this.init={dir:e.dir.clone(),origin:e.origin.clone()};var n=e.dir,i=e.origin;this.earthRadius=e.earthRadius,this.projInfo=e.projInfo,this.maxAnisotropy=t.maxAnisotropy,this.age=100;try{this.age=function(){var e=new Date(Date.parse(r.projInfo.date));return(new Date-e)/864e5}()}catch(e){console.warn("invalid date",this.projInfo.date,e)}var s=void 0===t.color?16109078:t.color;s=this.age<3?16732945:s;var l=void 0===t.length?1:t.length;this.position.copy(i);var u=new o.BufferGeometry;u.addAttribute("position",new o.BufferAttribute(new Float32Array([0,0,0,0,1,0]),3)),this.line=new o.Line(u,new o.LineBasicMaterial({color:s})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.tagHolder=new o.Object3D,this.add(this.tagHolder),this.boxHolder=new o.Object3D,this.add(this.boxHolder);var c=new a.default(16,16,{margin:0});c.drawCircle(8,8,5,{outlineWidth:2,outlineStyle:"#"+s.toString(16),fillStyle:"rgb(240,144,7)"});var h=new o.SpriteMaterial({map:c.texture});this.dot=new o.Sprite(h),this.dot.scale.set(this.earthRadius/36e4,this.earthRadius/36e4,1),this.tagHolder.add(this.dot),this.setDirection(n),this.setLength(l),this.tag=null,this.box=null,this.fadingBox={isFading:!1,span:2,start:0},this.dropPin={isDropping:!0,span:.8,start:null}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=n(r(107)),s=n(r(3));i.prototype=Object.create(o.Object3D.prototype),i.prototype.constructor=i,i.prototype.setDirection=function(){var e,t=new o.Vector3;return function(r){r.y>.99999?this.quaternion.set(0,0,0,1):r.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(r.z,0,-r.x).normalize(),e=Math.acos(r.y),this.quaternion.setFromAxisAngle(t,e))}}(),i.prototype.setLength=function(e){var t,r=Math.max(.1,Math.min(this.projInfo.views/200,1.3));t=this.age>0&&this.age<10?Math.max(.6,Math.min(1.3-.07*this.age,1.3)):0,r=Math.max(t,r),this.line.scale.set(1,r*Math.max(0,e),1),this.line.updateMatrix(),this.tagHolder&&this.tagHolder.position.set(0,r*Math.max(0,e),0)},i.prototype.setColor=function(e){this.line.material.color.copy(e)},i.prototype.addTag=function(e,t){if(null===this.tag){var r=this.projInfo.name.substr(0),n=this.projInfo.owner.name.substr(0),i=new a.default(256,128,{margin:4});this.maxAnisotropy&&(i.texture.anisotropy=this.maxAnisotropy),i.clear().drawTextCooked({text:r,lineHeight:28,fillStyle:"rgb(255, 255, 255)",font:"normal normal 500 24px Arial",outlineWidth:2,resetCursorY:!0,trimText:!0}).drawTextCooked({text:n,lineHeight:24,fillStyle:"rgb(225, 225, 225)",outlineStyle:"black",font:"normal normal 500 20px Arial",outlineWidth:1,resetCursorY:!1,trimText:!0});var s=new o.SpriteMaterial({map:i.texture});this.tag=new o.Sprite(s),this.tag.scale.set(this.earthRadius/15e3,this.earthRadius/3e4,1),this.tag.position.set(0,0,0),this.tagHolder.add(this.tag)}},i.prototype.removeTag=function(){if(null!==this.tag){this.tag.visible=!1,this.tagHolder.remove(this.tag);try{this.tag.material.map.dispose()}catch(e){console.warn("removeTage error:",e)}this.tag.material.dispose(),this.tag=null}},i.prototype.showTag=function(){null!==this.tag&&(this.tag.visible=!0)},i.prototype.hideTag=function(){null!==this.tag&&(this.tag.visible=!1)},i.prototype.addBox=function(){var e=this,t=(this.projInfo.name,this.earthRadius/s.default.EARTH_RADIUS),r=this.spinCircleTexutre();if(null!==this.box)this.fadingBox.isFading&&(this.fadingBox.isFading=!1,this.fadingBox.start=0);else{this.box=function(){var e=new o.CircleBufferGeometry(1,32),t=new o.MeshBasicMaterial({map:r,color:16109078,transparent:!0,opacity:.8,depthWrite:!1});return new o.Mesh(e,t)}();var n=function(){var r=e.projInfo.modelTransform,n=Math.max(r.maxBound[0]-r.minBound[0],r.maxBound[1]-r.minBound[1])*r.lengthUnitToMeter*t;return{latWorld:n,lngWorld:n}}(),i=Math.max(n.latWorld,n.lngWorld),a=new o.Quaternion;a.setFromAxisAngle(new o.Vector3(1,0,0),-Math.PI/2),this.box.quaternion.copy(a),this.boxHolder.scale.set(i,i,i);var l=10*t;this.boxHolder.position.set(0,l,0),this.boxHolder.add(this.box)}},i.prototype.fadeOutBox=function(e){null===this.box?(this.fadingBox.isFading=!1,this.fadingBox.start=0):this.fadingBox.isFading||(this.fadingBox.isFading=!0,this.fadingBox.start=e)},i.prototype.removeBox=function(){null!==this.box&&(this.hideBox(),this.boxHolder.remove(this.box),this.box.geometry.dispose(),this.box.material.dispose(),this.box=null)},i.prototype.showBox=function(){this.box.visible=!0},i.prototype.hideBox=function(){this.box.visible=!1},i.prototype.spinCircleTexutre=function(){var e=new o.TextureLoader;e.setCrossOrigin("");var t=e.load("http://172.18.22.83:18090/public/images/earth/loadingSpin.png");return function(){return t}}(),t.default=i},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=n(r(19)),a=n(r(22)),s=function(e){function t(e,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a.default,r,n));return i.PID=n.PID,i._tree=null,i._bbox=null,i.options=n,i._infoImported=!1,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"startImport",value:function(){return Promise.resolve(this.bbox)}},{key:"updateMatrixWorld",value:function(e,t){if(!0!==this.matrixWorldNeedsUpdate&&!0!==e||(null===this.parent?this._matrixWorld.copy(this._matrix):this._matrixWorld.multiplyMatrices(this.parent.matrixWorld,this._matrix),this.matrixWorldNeedsUpdate=!1,e=!0),e){var r=this.matrixWorld.elements;this.sceneNode.matrix.set(r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],r[3],r[7],r[11],1)}}},{key:"bbox",get:function(){return this._bbox}}]),t}();t.default=s},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),a=n(r(19)),s=n(r(94)),l=n(r(14)),u=n(r(3)),c=r(26),h=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,s.default,l.default,r));return n._radius=r.earthRadius,n._tree=null,n.options=r,n._infoImported=!1,n.name="Earth Entity",n.loadPoliticalMap=!1,n.sceneNode.name="EarthEntity sceneNode",n.practicalSceneNode=new o.Object3D,n.practicalSceneNode.name="practicalSceneNode",n.practicalSceneNode.matrixAutoUpdate=!1,n.sceneNode.add(n.practicalSceneNode),n._useTexture=r.useTexture,n.northCap=null,n.southCap=null,n._treeNode=new o.Object3D,n._treeNode.name="_treeNode",n.sceneNode.add(n._treeNode),n._contactPoint=function(){var e=new o.SphereBufferGeometry(5,16,16),t=new o.MeshBasicMaterial({color:6674686}),r=new o.Mesh(e,t);return r.name="createContactPoint",r.visible=!1,r}(),n.practicalSceneNode.add(n._contactPoint),n.renderItems={orbitRing:r.renderItems.orbitRing},n._items=new o.Object3D,n.practicalSceneNode.add(n._items),n._focusPoint=function(){var e=new o.SphereBufferGeometry(5,16,16),t=new o.MeshBasicMaterial({color:6674686,side:o.DoubleSide}),r=new o.Mesh(e,t);return r.name="createFocusPoint",r.visible=!1,r}(),n.practicalSceneNode.add(n._focusPoint),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"destruct",value:function(){var e=!0;return this._tree&&(e=e&&this._tree.destruct(),this._tree=null),e&&function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"startImport",value:function(){this._tree=new this.TreeType(this.TileType,this._treeNode,this.options),this._infoImported=!0;var e=this;return this.initUI().then(function(){return e.initOptionalItems()}).then(function(){return Promise.resolve(e.bbox)})}},{key:"sceneUpdated",value:function(e){this._infoImported&&(this._tree.updateView(e.camera,e.pvmatrix,e.frustum),this._tree.loadUnloadedTiles())}},{key:"updateMatrixWorld",value:function(e,t){if(!0!==this.matrixWorldNeedsUpdate&&!0!==e||(null===this.parent?this._matrixWorld.copy(this._matrix):this._matrixWorld.multiplyMatrices(this.parent.matrixWorld,this._matrix),this.matrixWorldNeedsUpdate=!1,e=!0),e){var r=this.matrixWorld.elements;this.practicalSceneNode.matrix.set(r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],r[3],r[7],r[11],1),this._infoImported&&this._tree.updateMatrix(this.matrixWorld)}}},{key:"initUI",value:function(){function e(e){function r(e,t){var r=u.default.webMercatorToDegreeGeographic(e,t);return u.default.geographicToCartesianCoord(r[0],r[1],n)}for(var n=e.radius,i="north"===e.polar,a=e.imageUrl,s=l.default.EarthResolution,h=Math.pow(2,s),f=u.default.EQUATOR/2,d=-f,p=i?f:-f,m=i?n:-n,v=void 0,g=(f-d)/h,y=new Float32Array(9*h),_=new Float32Array(6*h),w=0;w<h;w++){y[9*w]=0,y[9*w+1]=m,y[9*w+2]=0,_[6*w]=.5,_[6*w+1]=.5;var b=i?w:(w+1)%h,x=r(d+g*b,p);y[9*w+3]=x.x,y[9*w+4]=x.y,y[9*w+5]=x.z,_[6*w+2]=.5+.5*Math.cos(2*Math.PI*b/h),_[6*w+3]=.5+.5*Math.sin(2*Math.PI*b/h);var k=i?(w+1)%h:w,A=r(d+g*k,p);y[9*w+6]=A.x,y[9*w+7]=A.y,y[9*w+8]=A.z,_[6*w+4]=.5+.5*Math.cos(2*Math.PI*k/h),_[6*w+5]=.5+.5*Math.sin(2*Math.PI*k/h)}var M=new o.BufferGeometry;M.addAttribute("position",new o.BufferAttribute(y,3)),M.addAttribute("uv",new o.BufferAttribute(_,2));var S=void 0,P=void 0;return function(){return(e=a,new Promise(function(t,r){var n;n="north"===e?"data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAeAAD/7gAOQWRvYmUAZMAAAAAB/9sAhAAQCwsLDAsQDAwQFw8NDxcbFBAQFBsfFxcXFxcfHhcaGhoaFx4eIyUnJSMeLy8zMy8vQEBAQEBAQEBAQEBAQEBAAREPDxETERUSEhUUERQRFBoUFhYUGiYaGhwaGiYwIx4eHh4jMCsuJycnLis1NTAwNTVAQD9AQEBAQEBAQEBAQED/wAARCAIAAgADASIAAhEBAxEB/8QAdAABAQEBAQEBAQAAAAAAAAAAAAECAwQFBgcBAQEBAQEAAAAAAAAAAAAAAAABAgMEEAEBAAICAgIBBAIBBQAAAAAAARECITESA0FRBGEiMhNxBYGhwUIjBhEBAQEBAQEAAwEAAAAAAAAAAAERAjEhQVESA//aAAwDAQACEQMRAD8A9/qnu/3X5l9nsn/o1vT6s/1l9ms00/8AVrOH0Px/xPR+J6/HSTWTuxz/ADvZ7tfT5fjzynzW71vyMY+R/s/wfV+N6pdtvLHNr8d+f7dfZ7rdOZnh9H/cfkfk+d139lsver4vEvHz8PT/AJc5Ncu6VFtR0rmAAKIoqCiEY22Xa4c9qlrUhawtrNrNq4uTLHkTNqauLtblvSJ4t6xYlSy1rWYa4Z8pGkaSs3dm7ouOiVjzx2XfJo1lLamTIJSzgysuUWOWcVo9mmOYkvAqmeEvSS/CC5WVkzc4po1bglQnBpjS8JnKWqjfayOetrXlVGjhMog0YjOTyUarO2uWvKJ5QHK6UuuI3vtnpzxte2asSZMNYwzcopFTKXZBfJMoCmUBAAFAAAyA/p3t/wBlr6tNtvZ7L44fI0/+k/I9Ot00/fptb39Mfma6fmba6+y3TWfykfL/ANl6/wAb0ezx/F2u2uPn7TjiWsddWOf5v5m35Xs223mLl5VvPfaV6Mk+Rz9QFQRUFALwxtsDeYl2crul3S1cdNtpXPas3ZPJnWpC1nbbhLvm4LEqr6+XSas6Y1jXlSFa4iX2MeSzmLrOL/ZmJdk4hf0NXDJlBNVbys6YWUMaMpbwmVRrFJNsktTyuUVrabWdMSWOnlcM3blRi7cou11+lm2tnSaGUal1+kuPgVAWIJLlUFRqKzF+AxchOhUAyAnJhVyDOBbWbUIM1crwNOdjOHbETxiYa48q6eES6pYSsCiKiZXB4gmV7MLgES1rB4mD+l/7P8D8T0aX2+raZk/fMvxf5e+v9tmvOuX6P/6Db8bG+3p3vlt/KZfl7z21/jPm1n/T3EKcDq5iKgB0W4Y22TVNtnLbZbsxWbVkMmUTKNLWdtsRXOy2/olWGvNzXXOXONZBVymQFMoKmNcMcyqIpkAA5goCcAIuT5ZymTVx1ljG/aZwZyamLMWYrOLKLnM5FItAAAAAFQFFlW3hnmKaixcsy4b/AG1UTWpvw1Jou2utgrnOYl5a8eMRma7SpQxhLlrpLQSWnkcmKil2ymaYwZBi0/w34ZT+vCKzyuFxhYmFqLwuEw0i8JgBX6f/AH23489909FtxeXyP8tezffbe7bXOay3zMjj1dqANAzdsLa5bVLSF2ZtZtTLNrcis0yIqBQVEw0iCKACoAohkFAAABFAAADDPy0lBFAEMKoIqUBRAFAABAaQAGs8MZXKosbvTnlZuGJnnCbSzkvay/FRUlysSzHSwGuGbRAMhUgGblfJCQFsyi8gLCgIyRan+BX0M55EV1chFPgHPauVrpu5VmtREq1mstAiggCKAAYRUoAAAAC5QBRAFEyuQAACwARKoCKAAAAACoAogChkBEaQEKAKimAJlUAUCA3NZWbrhZcLa0yx+hJ9tSfKIpQAQ5akhQYo34xLJgHsBMujkpkTKVWN3Ouu3TlYjUYqYasTCVqJgvCliCIshQZFEVAAAAAAAQFAAAAiouQAAQVAAAAABFAAAAAAAAAAAioZBcJzFlbmssUc/JYzZ47YamE/Iq5Qio3MJdYnRlUTDWElXIpZhC2oC5S0Khj11nJaxltjHXLJnhm3kGqxtFtwzaixmmFEVmhQVApOQZqRqxEVDCiCAAAAgKAAAAABAVFSgAAAAIoCKAAAAAAgCgAAAIUAy3rthghBv2TNzGTKiEqoqgAAHABmRLtFmmbyv9UBz8k8nT+s/r4Sxdd9mZ26WOe3FdGG/hk03nybdiGWaqIomVTCKzaTJvMJrRWuMJr2RM/uBdkXZEEBM8igCAAAAAAAAAAAAAAAAAAAACooCAoIAAAAACI0gI18IsBFgfALBFAVAGliLVSrlfJgyqNXZm7VKiar1fDF7dJOHPZusRnBm5BloBMgUyhdaDWJtHL+OzprrszvptnIoxe8tW2RnOUGs5MJOFzgVKzW5zGbASVWY0gAgKAAAAAAAAAAAAAABgAUAAAABBUAAAABBUBRFBKp2AAAsAAVAFAlVFMCXgHq1vDNia7cNZjUYY2mGMum3LlZilWGUq4T5wy0SltSd4KDWtq7ViXDVssBnySb4vSS4q7TPMRV8v0XMsYiwgvwzhekyoYFEEwjSABFoIAAAAAAACEpYQFEUBUWAAoIKAgqACmARGqgCKgAAAAAAAAKAAAAYVYqJMrgURvXaeOIzrvi8vH6/dvO29fZdrb8M89zxq8PX5ZmSYrlrtw3rcN6zhvMdMZw7cbOW+uNgLPmI18M91FMI0nYM4JmNCKmCLgUEwoDOFBALABIUAAABMmQUAAVAEKoJSFTMBpWZeWoCqkaVKhWsJtqqazgs4ahUVhZ2l7UF26c46YyxeKBFSdqioKAgAGBUAABRFAVAFWVBUaLElUR48Lpbrf0FjlJ9dbXTWuvw5azMdJ1h0jnV0ty6byXX9XKN+WWolMXDMmK6w29fGTDXK3nCY5Z1/lXSxFSzhlus4AnIsLAQVLwAioAAiiKgAAJUnbSAozaeciDaMzY8jRqoZZ5UW0EQJw1KzkyaOmvLWcMa7yQ1zeaspjtpc1u4ctbhZs2zY3dY57S5xHTOYSZEc7ricsx03c2WoSm3IUGVKiKZVAAAAIoIoAAACgIqKINZ4ZawqV5L2ShHN1am1jpNrXKNRZWa7SrHOVuNxl116y66/ujnpZjCzMvDUZrHs9eLmMS84ei2Vx8MVLFlS8pVsxM/LPcRVUiAFBRErVSxBlcAioAAACC1kF8PJm+nZc2Nz2/Zg43TeJmzt2tlTGtTBiXhPKytTxhvIikvCWpKZRQTICzt0m3w5NSrKldosrnNmtdsVuVmx3nSxjTaVvqtMue/NwxZi4dd5nlz74RYIuMCKliLemcZFVBUEUAMAAAAUgsABcKiBeCAqyAo8axIri6KsqEWI6RuVzlXW8txmvRHSVz0sreZG5WLFsNbzippbstxKqOe85s+GJOcOvs6y56xmtRUawzRQFBKi1EGakjVjORVEECgAM2NICVmt2J4wGZtg7axqlnPDK4zjC2pazyCoZPlFBQEyZQTVbla8nKVY1qWPR6rh18+cV5ZvXWbZn6tysWO21Tw+Wc5dJyqOVvODHDW2uOWJeQhLxymGrEiKmBqxkABFAAAAFQBqCCotmScGQFyIWXCo8oK5OiLKAK1GYqwb12sddbby4x10vw3GLHSbWThJk1rfDTLGUkxTeY6JftBSwKKyq4KGspVwzv/GpVLtMds5n2wlZ/prHTM+y2fbl8lllxZip/RjpmfZmfbmH9GOoa/wAYrSIljWYzaDNiZ4aZqVdSzK44I1rhBzuJUv263TW8udlSqhVSioIIqrGVgjTetwxHTXFnLXLNdZ0TaxNeBtl11s2mHPx8dmvXcL/K5VGNyRvbTMZxhDU2Id8GMQVNiRPlqAxcykq7THKf4RVAAAAXKAKIqouVt4ZX4B5p0JRzbUAFWIQG466Ocb1uG4zXSrqx5NRplq4Z2n0lpNgJVNpxmJKDQCjOzHs/jW9o57z9tZvixyKO3r9c1n9vs6nUYk2tW4vp9WP3bd/Ea93q85mfyn/Vn1b32ezba/E4/R133xMTt25nN5z8MW3XiG/brz5T/lzlcOplx0l121/jCpreIZmW5WUpLL0b3j/LP8dp+pauNW4OE2vCbZ4ZtMazJ/yzbipdrMJtmmi+dXyzHPnOF+cJqqlLcM28pVgGftOUVoIKLlZsxmrklSx1m9dNOs1582ct/wBl8eGpWbHby54b0v24S7SZxw3N9rMycNzpmx38oWOWu2Zl01uWvWbGPCzbPwzds3D04ljzba3XfPwlmLKti/BmUvSKl5jGGkKEEEVRMqAAAqAKuUWRUeadDOVly5NmVLBQWIqjereXOVqVYzY3K35Ofwnk1qY3nK4wzq1dl1Mb1qbTF4Z8k22toOkS3DOaUFyz7P40lN8eFS+VYx6NdNvZJv1/3dvyddbed8Y61eadt32TbXx9nM+NvmJLMvP7Wy7rXpxNd8XK/B69PH17Z5zeKm20177+nSfOZvxn2s7Z+Hn2znjp0vstvPX0s8bHLvr+vG5MYm1kWbR18dfGYYvriSGs25vHwlt+a1rpYbafKYFsuuTfqMycYW88Cpt8FuP8mCyXkCcf5T/yMfqWZQTbuJ8teKfJViX4OfsphFJ0Xo+Fx8AJ9GF46EX4Jcak1/VcfCjeeHTS/tjlJmYb14mG4xW9P4x20mY4azjDrpthuM10025xT2aSnfJm/LTLhizYt5dNpO3LbthuBYTtb0DAiooACiAKIAq5ZUHlWXlJFjk23cWMg0iqgCxplYo3nhJ2mSLqY3lPJm1ZBGo3GZhctI0m/SZbkzMKMa1Nv40s8dl7/wAIOOeVrW2uv0vjrfhn+a1rGu+2ut1l4qOnhr9F01+jL+zY41OY63XX6Zus+kvNNXXbiHl9J4fRZYahnbK23CWs+RVAEUAARQERURRFQVRBAAEbi5YlF1G5WvJzlajUpXbXrLpry5yyR0045bjFdJwvDN+1y0yzteHLZvfKeOIlWMxYnyRFTbio1eWalBMiCtJlMmQaTJlYCGVrIOKyFgw2KiiACCiLFFEWKLFygMtZWVlY1BpvXPwxK3rtfhUTfW5zhM4jpdrhjyn0oxnJOF8tZelzr9JqmScr+2pIDNjLV7MIM22JnLVjFiLqVlpm8VBQ7EUAABAEBFARFUQAAAVFEI1KyLCuk2zXfW8PNHfS8OnNYsdtdskc5XTXpphZym/DUY9ijmLtPoZaSot6QolZaqIrItZQXLUrIK1blkAc85Exiqw0ogqKIAqoAqoKNCKIqxlYo1GpWFVHTMsc84p5YQqY1tMzM7SVJcLxRVi9JBQyGImEBmrWUVErScIM4WWLcJ4WglqJyqKFEFAEEARQABUUAAAARY667cOLUrUSu025ddN83DzeTfruOW5WbHqTeZjHnjDVvDbGOf6GG/GXlmosZQoipQTKKliYayAzzBqoioCVBnsIiKAgqiKAqKIqoKKACiAjULUyAs5axwzK1NlRE5KmbgG5cwykoouUtEAqKiKJhTKC+ML+jOUtFSpktTLKhlLUNFyIqKAAAAogCoAKAoEAiK1NqwuVlSx3024xW5eMOGrtLw6SsWOkvGEsyTpVRnxiYawzUol1Twa8vtLsipZGatrPIqUXCIqCpUGMjNWcstAAACixQEFRQFQUURQFQBQBABUWKyGi5MplMmq0lpazlNFyiZMpq4VKAM2o1ZlPGplWEXeTxRLmxNCKkmFFEAFEUAABUAVAAVBRSAI3LhrXbNc41rxWpUsenWtTFjlreGtb8OkrnXT4S65anSxUcLozY6783DF4uEsWM4xEasZsZaES1MooM3a5XKK52GWjDNVmVTgAABVRVQVFAAAABckQBQMguTLIqLlMgABUVMplMplNXGsiZAxQyfKjWszWt7rJidpt7NdZw5zO1zS2eJiTtdtcUkxVvKKztwkWzIgI3NcxnaeNCVFRYKAAAAAAoAAAg1GVWDtrtw1rtiuOta8m5WbHp02lb6rz+q4dfPnFblYsXeZ5c++HTap4fIMWMWN284TCKx4H9eWs4Wbcorlv6/pJHbGcudzLylmErkAy2mBcogAKKsSKIAAoAAAAAAAAACKAnJzU2uF165BJCxflKCFakS9pisi4RAxlf0QBWp0wsqwFnaazlfkHTWRj24wZZ25W+JJ9YlaJCstaCKAAAqAKgAKigAKhKsRYo3N66zbM/Vwb1uGuaxY75y6TlynRNrG9Zsa21xyxK662bTDn442sKRmxnWO10vjlzneEs+q1rGPbrZy663C7SbzBZsNyvEgOToHRQBUFGhIogAAqKAAAAAAAAAACYUAQKALNcrrM1rfaaa4X56lrne8JhNL8tfKetMWcrh0xKm8xDDWMJDa/RGRV7IKFmEXe5kwa/qCLg274IqJYy3WbEqgRUVBQEABRBQAAWAI1HTXFnLllZssqWPRrwOU3rpp1mtys46eu4Xu5c/LnhvW4uL20zY1nDPjLctWJnFKOdt13xW5cHt08pmdxz02zxe08X2PMA5OgAAfKwqiNIogAAACiAKIAoAAAIoAAAgKBLhjaXa8tmC/oSTCgDWuJMue212uPhrnCa6lGcF1w6zWN7aTxP5TXngnMpWWm5jHKXnplvSLPoWYF2ZVAX5S9gx8q1iJhFEUFQBABQEVAUBQIAlajc3uMObcaiV0047Xa5uYxK3ry1GW5tcL6+e3K3Fw6aXFX8s118cPNvPHd6+LHD3ac5i9ROa8YDi7ARQAVUQUQAAAAAFAABUAVAAVFAAAwAAZAAAAakjPs2k4ihmxf7LjDM6VNokxWPG5bkXxnZhrm1rvhbI5/LPi+tZtrVjM4XyWIp2hFFswl6bxnVgVAEVAEBUUBFQBUUADKorUZjUWI1GtbisStRqVLF3/dizt211l0/VxddNmozV13uvFdP5RjbWbTM7X15xitRmvAGV7cXYVFEAEAAAAAAABQAAAAAAABRFAAAAAAAyzjnLQUIBFBQgM7T4ZuuHRLMpmmuYt1wjPiz63rym3Ca3DW1lWBrU2IZVEARUARQAAAAABUBGosrDUWI1GsskaG5WpWI3OViN6bcu0mJl59eK9Ov8W+WK+bhcKOToiggAAAAAKIKAAAAAAAAAAAKgCgAAAAAAAAAKiwAAEvTle3W8sWYSkZWAkaqiC6ioCAAKAAAAAAAALKgI1lcsi6Y3l09blHTXaSNys10xy7ziOHrvy667NxivEA5OgAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAgCWKgMXhYtjPTLSgAAAAAAAAAAAAAAoIoAZayysqxHbSukuK46V0y6SsWOADDQAAAAAAAAAAAAAAKgAAAAAAKIoAAAAAAAACAACAqAAze2jCKyG0EUBMgpLk7QFEUAAAAAAFAAEUABUa1uHSXLjK15NSpYouCwGRUQAAAAAAAABQEUAEVAAAAAAAFQBQAAAAAEVABUAQQVcmQAAELGHSs4SxWb0jdjOExdGvHjLMjXlxgRiVUnbRFDKAKIoAAKIAEFABFFEUR//9k=":"data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAeAAD/7gAOQWRvYmUAZMAAAAAB/9sAhAAQCwsLDAsQDAwQFw8NDxcbFBAQFBsfFxcXFxcfHhcaGhoaFx4eIyUnJSMeLy8zMy8vQEBAQEBAQEBAQEBAQEBAAREPDxETERUSEhUUERQRFBoUFhYUGiYaGhwaGiYwIx4eHh4jMCsuJycnLis1NTAwNTVAQD9AQEBAQEBAQEBAQED/wAARCAIAAgADASIAAhEBAxEB/8QAggABAQEBAQEBAAAAAAAAAAAAAAECAwQFBgEBAQEBAAAAAAAAAAAAAAAAAAECAxABAQACAQQBAQMICAQHAQAAAAERAgMhMRIEQQVRExRhcbHRIlM0FTJygpKisiNzkaFCYvCBwVLCQzUzEQEBAQEBAQEAAAAAAAAAAAAAARECMSFB/9oADAMBAAIRAxEAPwD9ris+Vjeu0rXjKDOuzXeM+OF7A47cV8suHLpvrtmPbnqXXXbuDzcVtxl6PHMJpJ2bnQHn5fXm8w+d/LLx8t3j7FrO0liD4vNpya9mvS9nbXfx2r6O/DrtOzwbentOXy1B9S+PJx5c9OKy5c+LbbTXFdNeaZw1IlreLjDnvxXD0yyzLPJZNchr53JbpetdOCzbtXk9zmztZHb0OPfGaYa92ureEzhZmitdDGUsWIHjAAAFAAAAAAEIqIKACyrlgtBvyZu0+E7r4gnWp4t4UGJDbXMaysB4t7tx7ZdNOebdLXfk49dp1eXk9Wy51B3mL2quPDNpcV6ZjAMYalLE7A1kwzK0CVFpAErTAKAAEXAIqUgLhQBw1lldpsmISAtoiglhMqQAAAUBiyM2TLdjFBnbSOe3HPh2vVZIupjnr5w5NrdcO2JYl0hqY+Tv6223J5V9D19PHTGHaaa/Y1JPg1cZmrUjWIlFEAAAAAAACplcGAJS0wAigAAgItZBqLKgDSWpkBI0kaBOphTIM3SGK1agM9TLSXUEWVMANd0TKgJe5UsyB5C+JYAqSKCUyWIDcq4YlxXSA5LKvcxhQICAAACUFyuWQGmbqq5Biani2gJFBQIAGaAAAAAACZBpMGTIKJlMgomVyAAAAgGBKCpkwmAaRYuAYyspYSAuTJgknyBkMLgEMrgwBUw1WQLEarICpU6g3DDMq2gVILgFx0YsxWpU26gjWtZjQMS2NZylizsAYqVddooLBMoKBkDBQwCRTAAAoAIAAAAAAACgmFUGcGGkoJgVKAuEi5AwGUBciKgCKosS07IA1lmKgtRKZBcnczCbAvYtZtMguTKAFqS1qariAJhb0ICJhagGDCgIoUCJQAwZMoCrEsSA1YxjFbZ2BYGtWwElKlIDWqoAAKgAAAAAigAAAAAACglUsBDAWgCKAqKAISgplAAFBGkEErNbSwGZK1IswqiYSxUtQIqar3Bc4Z8lrOALcrEwuAVMFzFgLIWEUGMr3WwwDItSAhFsQGrGWspYAADMuK2xhqAuCTAAAKgAAAAAAAKAICooIAAAopQBDAZBMGFXAMrEqSg3hnC5QAFwCKJQUSNYAiUuydwAW9gTyE8asQMUjVTxUS1LSxZOgE7LOiCC25EigplDILKvdhrIFjLWWe4KYMKDMVrxTAM0XCWAYWRIuQLUydTAGSGFwoAAC4QAAQAFAEBUUBAAAUUQAQUEjUrFWUFrFbrIJMtQkKCiRQAUGWmMrkEpmi4AkWdBm3qDfRm3qW9EmAayvlGLmmAazKrMioCLIUEEqwFZrSWARUhQCCwBUJQaygAgoCYXAQDAlpFFBMgqVcs0Gp1LElaBkEBQAAEAAAAAQUFwLAQKgLYkitYBlmtJjIEpeq+J2AkwJkBS1CgzYsirQRnPVpj5BuGEXAJTC4S34BeixmRpAAoLEpkBmkKsBYVYzaCNRBRUVEFEUCKy1ACiUEyuWRRcmcJJSwGpSmpQQXBgEjXwi5BmmSpYDWSRmNyguGVyUEBcIISLgBLEaygArNUBYUEy1LlzpLYDoZZ8gF8kzkwuMAki24TKbARvHRiNygzhcLQGbCRqsgsMhgCUBAAAKZSgDMtqgtRUBciKAqKoAIAsAZajKwFKAJhZqGVFwlLsx5dQbhSVKCmUyk7gtRTAIsiYMguEwZWUDCXKylAXKEQVMqmAIZak6M2AsSxMrlQKZATB4rGgY8TDTNBclrFrWvUCdVusXszaCXoTZL1JrgFuzUZky0C5ZqXKgZWJglwC0BABMguCmTIJiRF7gM2rLlnbusvRUXIxaa7A38rEqZRWlZi5BoQBFgAokVREy1hnAJeqYbwYBnNjUPEAAAUnRroDF6s2OmOpYDEi4OxkFwRMmQKRUQXIiguUqZMqGEaliWASAAKhAWphUyCWEuCpJQatyli4KDM7t2dGcYq3boCXoSp3Aa6JlOtMA1lARFAFHO7yXq3a8XvTk8Ltp8A9ssrnyb4fO9H2+Ta+O718udp0VHTj5ZejtLHz+uvVvXnoPXZlcOenLLMr97KK1iJNeqTbJN+qDa4mEly1IDKW4aseXm5NptiA9OuzTy8e+3y76b5B0ShQFjKxRUW1AUMpkFqRMrKC1nOFtyzYC+RN8JhnaA3N289HKStAtSxqFBkXCYBYuEjU7AyKUGajSyAxi5bNklAsUSgGcJlO4LnKkKAvZJEoNZS1kBb2TFWNTGAYiVqzqSAzMtLiAghkiCgCsckuOjhdsy616bHPfSdweC+t47eWr1cGts/aTe4TTmkuFiOvJxSzo8u/Hdeseq8nRjbbXaKjw8ns7ccb9b25v0qe1weWl2nw8nBxbf0s4/IzfVj7et08cys77a46PHpvtrr42t6b23FXDXSc/jTb3ZqxtxXa9EvqZgPRxe3rv0dLprtcvn/c7ce3R69OT9jr3KO3hrhm/s049rsm8s61FehFQEMlIolpKtjINZS1FwApIoEhhYAM2NJQIUAMmUUDJUUEWUMAZMpSAqypUgN1lpmgGMo0CYVMqCLImFyBamEysBMLhamQS3Bk2iQFFgCAAKigAIDG86Ns2A4bcd26fa8947x7vfZ8uPJx+VyDN08tcuV12ldppvF21uFRjXWWYryb+pt97nXpq9WtsrpkR5567Xhiul3kc99/kHo4tZjq6WR5OPnzcO15cCxnn16Pm+xzbcfSPo7ck2jxe5wXbS7a9z8F9P3J08q9+/Lptpn4fG4eLWSftYv2PXpenhlIPrItQVKsCKFiYaATBhcmQRUyoCWlTGQWAAAAYXCAAABkMAVFwYBAWAsSrEoJlcs0lBrC4SVcglStVASRcL2TIFQMAlo1NSzAEEUAAAAABAAATCoBhnaNAOPhLW7rJCzDny8t10qo4clu22I1OG7fs1y4OXy5Osevl2xPKIseKf6fLh6dpLrmV5uXi22vlO9NeHmx3IL1mzvp47a2Xq4cmu0n5XPi5NpyYvZUZno73mu07PVr6lly9Gu2uGrczog6gCpRWQWVrLMiqJaZFx0BMrGflqAohaAIoAICwIAAAAILBFBCAoVKqAsMJnC5BMCymQSrKUAAAwsRQXyY2quHu/wfPf8As2/QBPa9X99x/wB6frX8X6v77j/v6/rflhB+q/F+r++4/wC/r+s/F+p++4/7+v635fTj35Nppx63fe9tZM1myy4vSzvAfqvxfq/vuP8Av6/rPxfqfvuP+/r+t+VAfr5ZtJdbmXtYPJ9K/gOL+1/mr1gAAJQoJlUjSozs53SbdK3tUkoOenBppbWrtrt+yzy7WRnj21zm9wdtOKfLO88ezX3kkeXl555Yphr0cfFrvOrny+vx69Z3deLeTWW/LPPt06A4cfJrNsbPXr47dnxfZ5Ntbbr3T1ff3lk2B94BFDAAqLlnKiqgCWKACKAkihaAmFAAcvb5/wAN6+/Njy8ZMT8tuAdB4L7nvcGn33s8Ot4vnwv7Wue2cpx+5794vxO/DreCzONbfOa/b1QfQV5PX96b+lfb5pNZrnMn5Lhz19n6ny6ffcXDpOO9dddrfKwHvHk0+o8W3qb+ztLrePpvp8zb7HKe19T+7/EfcafdY8vDN8/EH0Bz9f2NPZ4debj7bfF7y/YvNy6cPFty7/0dJmg2Pn6+z9T5NPvuPg0nHeuum1vnY6a+3y+x633vqaS8s2xvx7/GO/2KPXUjx+r7/Jz+1twb8f3d00ztL3m0smPzOvq+ztzc3sce2sk4dvGWfPfv/wAAenBI823t76+/p6vjPHbTyu3z8/qefb3/AHfxe3racWnlM3TyuPLX4sB9Jx4fZ4ue7zjz/p7eO2ZjrGPX5Pe23x7HFpppjvrc3Ljw+1z82nPeHj1+849/HWdpt170HsnLx7a3bXabTXvi5xhn1+fj9jjnLx58bmTPTs+Z9L25/Dnl1n3d22u22es2x2en6P8AwOn59v0oO/s+7wer4/fWzzzjEz2dpZZLOsvWV8vfin1D3+eXrx8Ol49b/wB1+f8Ajl6fpXNeT1Zpv/T4bePafm7A9jh7v8Hz/wBTb9Du4e9/B8/9Tb9Cj8ud+k7j2+jwXWz2NulnXj/WSW3IluTX1vpP0/8AC8f3vJP9fedf+2f+39bj9X+mfeZ9ngn+pOvJpP8Aqn2z8r3et7WvJpjk2k3nfPTLxfVPa5PT9zg5+Prrtrdd9fjaS5/9Syz0l18EfU+oenx83F/MPT68e3Xk0n/Tfm4/S+Wiv0n0r+A4v7X+avW8n0r+A4v7X+avWAABWLltLAZlXODGC4sVHPfb7Hl/HeHJ4bR6rq4cnq67bTbHUHTe+euY4zpXp11k0w57ceeyxKlvlriPPy8G1/aejSeN6u18dtewPnTl5ZjW9o9E389cXu1vx6157fCgzy+tbLcPJeCzbth9Lj5ptMU34tdp0B7wGWgAEpFAAFAAAAAAARQHk+q/wHL/AGf82r1ufscGvscO3DvbNdsZs79LkHL6h/Ac39U9T+A4v9ufodebh15uHbh2tmu0xbO68fFrx8OvDrbdddfGW98IPj667bfQ7j43zfzeT7HBtrtwce2v9G6zH/Bj1/V4uDg/DzO2lzny+cvN/K/GXTi9jl4+K/8A1y9OoOPrcvDpy+9zckz6/nPjymc34fTm+l45vLPCzMvxjDnxepwcXBfX11/07nyl+c/a838qmPu5z8s4L/8AXnpj7AT6Ln8Nvf8AovJbr+bEd/qPHpyepvryb/d6dLd8eXa/ZHS+txfh762s8eO6+PTvinF6/HxevPX/AKXHJZfL5l+0Hl4/W9y8et4/dzpZPHHHr2+HP6RNvP2rdvOXfHn28r1zXT+VyS6cfscunFe/HL0evg4OP1+OcXFMaz/nftoPHx//ALPL/tT/AOKfTtp+M93T5884/JnZ6562k9rb2pb57a+Nnxj/AMRx2+mcV335dN99OXfa7eetxZnvPzA58n/7XF/tX/5O3vep+I0m2l8efj68e/5fsPW9DTg5Nubbfbl5dpi77/Yxv9Nm292/Ec08rbibdJkG/R9z8RpdOSePPx9OTT/1cfpXf2v92t8H03j4Oec85N995mXysuczHXo3r6OmnHy6acm+v323ndpcWXPwDz/S/wD+Hs/7m36E9HmnB9JvLf8Ap8sfnz0ez1vU4/W4bxaW2bW3ba97a5X6bw31Z6vntOObeWemb/yB5PQ9X6hrwTk4uXXScv7dm2ub+hr1pzep9RvHz7Tb8TM+UmJ5R9TXWa6zXXpNZiT8kcvZ9Tj9i8e21uu3FfLXbXuDs4e9/B8/9Tb9Du4e9/B8/wDU2/Qo/NcM47y6/eXGmer60xiY7fGHxnXh9nk4b066/Ot7NcdZ6x1zr6jX1Li4uX1/V25N/CSWZ/8AKfqceHn4+afs3G3zre71e1623tehwyba6Tj2t3327a6zOa139ksTj5bGfpXH6/FyXXi9mcnnOvD064+XzPqXH6/H7e+vr3OneydtdvmRvl9vi4dL6/o510vTk57/AE+T832R4nJ0fpPpX8Bxf2v81et5PpX8Bxf2v81etQAQAASpexaijPVZMrhqCMb411cpct80tnRx0lNTHSa5rW08NKzxyy9Wua/sqPFvzbSs/wBOLvrrtXbh49fH8qaY8enJOHezf57Ov387ztT2vV+82l+xNeCeOPsJVfWARQAAAABQAABKCwpFoMrEqgAAAAAAAAIACoAoABgATAqWAZKkaBmVrLOOqiK4e9/B8/8AU2/Q7G2uu2t12mddpiy/MoPyI/Sfyr0P3X+Lb9Z/KvQ/df4tv1or83LZcy4s7WO3L7nscvFrw77/AOnr18Z0zfy/a+9/KvQ/df4tv1n8q9D91/i2/Wo/Nj9J/KvQ/df4tv1n8q9D91/i2/WgfSv4Di/tf5q9bPHx6cWk4+OeOmvSSNKACAlVATCYaMCMqlWKJesY8cOmGaDnvv4vPze1rNbPl158XV8n2v2Lm9k0XX28ctl7PZw+zM/nfDt+83/Yb15eTj2k2TVfpsTbTMeXbfx2w8/r/UdfGa7Pbprpz4wqPbUVBQAABQAAABUqpQSNMqACAoAAAAgAAAAAACiAKIoBQBFjNuF1ohRayCioCiKAAKAAAIAAAACVWaCNRMKAzY1WaqOe2kvd5vZ9Oc0w9G+Z1OPeXpTB8nX6d91tbJl5vb4N5c2Yfd3sm2Xk9vWctkwzivlacWt1znq9fq+7eHbxtNvQ8J5SvHzcdlz9hzKlr9YioqgAACgJlQAAWJSLQZUQFCAAACAAAAAAAAAAAAqKAAIljPy2zYCypSFBZVsYlw38AgAKAAAKAIAAAADLSAAAJhUBjbTLn93Zcx3qYUea6b2peC7PViLgHi24rJivDzetttez7W2krjvpMdjWXqRpKjSCKoIoCLEICggKAgAAAAAKCKAgAAAAAAAAKCKAgAAACYFQGbOrUqUgNIqAKgCiKAAigAAACKgCooICAUBRQAKl1yqxEJVSNCsgKAAIKABgQFQAAAAAAUBFBAAAAAAFAAAAAAAQAArMaSwEABQKAZEoKEAURQAEUAARTAEAoJUKAAKKAgohFRoZt6mUVpAAMiKKsRQAKggEAFQAABFQBYgoqKgAACgAAAAAAAAIAAAAjLSWARSRQQoAAoIACiKAAKACBREEUwKqAALEaggYE7AWLImWpcop2RaAM1osUQADICARFgKioAAAACAKKAAACKAAAAAAAAAAAgAAioAqKCUVAFiEBagAAAKgCgAAAgqUBAAjSKBgq/CUVKutRZqgbVItidgaMiAqAoKCDNWFSA0igIAAAAAoAAAAIqAoAAAAAAAAAAAgACCoCoAAAAAAAAACoooigESqlEQhjLQEMdSL8inwi1KCNeTK4QW1J1qYWAUynemMUFABVSKozU+Wqz8oNJlfhAAFAAAAAAAAAAAAAAAAAAAAAAQAAABBUAAAAABYCC1BRUaAAAQAJEWkAhQBUKAlixnLUQLWbWrEwCRfkkamARcGFBAFBj5bZoNQqarQQAAAAAAAAAAAAAAAAAAAAAAAQAAAAABBUAAAVAVQQFEUAAAyM3rUFq46HTBOoJFXCY6gXsQvSJKoNdEhUF6YROoDXRJOphYCWhsmQaElyoCWKlBI0xO7aiAAAgKmQBTKEBRAFAAAAAAAAAAAAAAAAAEAAEUBABQAFRUAAgKKlBMmEndoBe0XCVAT5DUDbqi1lRqKioJSFJQLFz0RAMphcAM5w6TZnxLAbylZigigAAAgAgqWqLCs5awCC4QFyuWVQXJlm0gNAAAKAAAAAACgCBUBQAAAEVAAAURoEwogGTCfK0EpFx0LEGs9Ge6y9GZeoCxWb3A+U+Wr2Zio0sTIil6pg7LM0EmVmtbkXMBnCYM9U22oATsmeoKWiYyBMtIuQQVAQMJlRcdGLG52TawEjcjMalQEw1lMgki4S3CTbILhcYIUAAABQAgArIKQgCgAiNVkFAAAAABBQAACpFSIKKz2oNFEoJ2axgW9QZTYvcvVYhOwvaIDXhiIu1Y65RWqS4JCg15M2sgLFJGoDFuOhGrhAWTAmTKi4Zq5EEjSRQSsVus2KM3aue21dLGfHIia7V08nPxwXIOsuWnLWunlEVLMsyYreYlmQalmBnGFgKAAAAQFFQAAAUABKqUEikABRBFEAAABFCkKRBpKZAChKBL1atZ+SgWZRZeiKGTafMK1J06iFMJMqipU7tVOwF1JCWqAlFBAsIBhcAomDC2s5BTKZEFAUSxMNAM4ZsdMJgHPFMbOmDOEHPGGpVsys0BJmq1jCYADBgAMGAAwuFGVhYSAUVMICgAYAASqCUAFQAAAAFEFgABUAwmVyC4Zrc7M/KiQwoCLAEf/2Q==";var i=new Image;i.src=n,i.onload=function(){var e=new o.Texture(i);e.needsUpdate=!0,t(e)}})).then(function(e){return v=e,t.options.maxAnisotropy&&(v.anisotropy=t.options.maxAnisotropy),Promise.resolve()});var e}().then(function(){if(S=new c.GroundSelfShaderMaterial,t._useTexture)S.setTexture(v);else{var e=new o.DataTexture(Uint8Array.from([0,10,40,255]),1,1,o.RGBAFormat,o.UnsignedByteType,o.UVMapping);e.needsUpdate=!0,S.setTexture(e)}return P=new o.Mesh(M,S),Promise.resolve(P)}).catch(function(){return console.warn("Loading earth texture failed."),P=new o.Mesh(M),Promise.resolve(P)})}var t=this,r={radius:t._radius,polar:"north",imageUrl:"north"},n={radius:t._radius,polar:"south",imageUrl:"south"};return e(r).then(function(r){return r.name="northCap",t.northCap=r,t.practicalSceneNode.add(r),e(n)}).then(function(e){return e.name="southCap",t.southCap=e,t.practicalSceneNode.add(e),Promise.resolve()}).catch(function(e){return console.warn("EarthEntity initUI error:",e),Promise.resolve()})}},{key:"initOptionalItems",value:function(){var e=this,t=[];if(this.renderItems.orbitRing){var r=new Promise(function(t,r){for(var n=new o.Object3D,i=1.1*e._radius,a=Math.PI/180,s=new o.LineBasicMaterial({linewidth:.5,color:7329264,transparent:!0,opacity:.4}),l=new o.Geometry,u=0;u<360;u++){var c=i*Math.cos(a*u),h=i*Math.sin(a*u);l.vertices.push(new o.Vector3(.985*c,0,.985*h)),l.vertices.push(new o.Vector3(c,0,h)),u%30==0?(l.vertices.push(new o.Vector3(.935*c,0,.935*h)),l.vertices.push(new o.Vector3(c,0,h)),l.vertices.push(new o.Vector3(.935*c,0,.935*h)),l.vertices.push(new o.Vector3(c,0,h))):u%5==0&&(l.vertices.push(new o.Vector3(.965*c,0,.965*h)),l.vertices.push(new o.Vector3(c,0,h)),l.vertices.push(new o.Vector3(.965*c,0,.965*h)),l.vertices.push(new o.Vector3(c,0,h)))}var f=new o.LineSegments(l,s),d=new o.LineSegments(l,s);d.rotation.z=Math.PI/2,n.add(f),n.add(d),e._items.add(n),t()});t.push(r)}return Promise.all(t)}},{key:"treeNode",get:function(){return this._treeNode}},{key:"bbox",get:function(){return new o.Box3(new o.Vector3(-this._radius,-this._radius,-this._radius),new o.Vector3(this._radius,this._radius,this._radius))}},{key:"contactPoint",get:function(){return null===this._contactPoint?void console.warn("contactPoint not ready."):this._contactPoint}},{key:"focusPoint",get:function(){return null===this._focusPoint?void console.warn("focusPoint not ready."):this._focusPoint}}]),t}();t.default=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),o=function(e){function t(e){var r=e.renderer,n=e.color;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,1));return i.angle=Math.PI/6,i.penumbra=.1,i.decay=.1,i.distance=1e-4,i.castShadow=!0,i.intensity=3,i.shadow.mapSize.width=1024,i.shadow.mapSize.height=1024,i.shadow.camera.near=1e-6,i.shadow.camera.far=1e-4,i._enabled=!1,i._renderer=r,i.__defaultGammaInput=i._renderer.gammaInput,i.__defaultGammaOutput=i._renderer.gammaOutput,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.SpotLight),n(t,[{key:"addToScene",value:function(e){this.__scene=e,e.add(this),e.add(this.target)}},{key:"removeFromScene",value:function(){this.__scene.remove(this),this.__scene.remove(this.target)}},{key:"setPose",value:function(e){var t=e.position,r=e.target;t&&this.position.copy(t),r&&this.target.position.copy(r)}},{key:"enabled",set:function(e){e?(this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=i.PCFSoftShadowMap,this._renderer.gammaInput=!0,this._renderer.gammaOutput=!0):(this._renderer.shadowMap.enabled=!1,this._renderer.gammaInput=this.__defaultGammaInput,this._renderer.gammaOutput=this.__defaultGammaOutput)},get:function(){return this._enabled}}]),t}();t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=n(r(29)),a=n(r(101)),s=r(0),l=function(){function e(t,r){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._capacity=t.capacity,this._useWorker=t.useWorker;try{this._worker=this._useWorker?new a.default:null}catch(e){console.error("Cannot initiate web worker",e),this._worker=null,this._useWorker=!1}r=r||{},this.debug=void 0!==r.debug&&r.debug,this._size=0,this.waitQueue=new o.default,this._taskMap=new Map}return i(e,[{key:"destruct",value:function(){return this.waitQueue.clear(),this.waitQueue=null,this._capacity=0,this._size=0,this._taskMap.clear(),this._taskMap=null,this._worker&&(this._worker.terminate(),this._worker=null),!0}},{key:"clear",value:function(){this.waitQueue.clear(),this._size=0,this._taskMap.clear(),this._worker&&this._worker.terminate()}},{key:"abortPending",value:function(){for(var e=[];!this.waitQueue.isEmpty();){var t=this.waitQueue.dequeue().reject(new Error("[Dock] abortPending"));e.push(t)}return Promise.all(e)}},{key:"fill",value:function(){for(var e=this.waitQueue,t=this,r=this.capacity-this.size;r>0&&!e.isEmpty();){var n=e.dequeue();this.act(n).then(function(){t._size--,t.fill()}).catch(function(e){console.error("Dock.add",e)}),r=this.capacity-this.size}}},{key:"act",value:function(e){this._size++;var t=e.func,r=e.resolve,n=e.reject;return function(e){return Promise.race([e,new Promise(function(e,t){setTimeout(function(){t(new Error("timeout"))},12e4)})])}(t()).then(function(e){return r(e),Promise.resolve()}).catch(function(e){return n(e),Promise.resolve()})}},{key:"queue",value:function(e,t){function r(){var t=null,r=n._taskMap.get(i).tiles;return r.forEach(function(e){e.expired||(t=e)}),r.clear(),null===t?Promise.reject(new Error("[Dock] No active tile")):n.loadTileTask(e,t).then(function(e){return function(e){return e instanceof s.Mesh?void 0!==e.material||(console.warn("[Forest] material/map not ready",e.material),!1):(console.error("[Dock] Invalid mesh",e),!1)}(e)?Promise.resolve(e):Promise.reject(new Error("[Dock] Parsing error: invalid Mesh."))})}var n=this,i=this._getTileKey(e,t),o=null;if(this._taskMap.has(i)){var a=this._taskMap.get(i);a.tiles.add(t),o=a.task}else{var l=new Set;l.add(t);var u=new Promise(function(e,t){n.waitQueue.enqueue({func:r,resolve:function(t){return n._taskMap.delete(i),e(t)},reject:function(e){return n._taskMap.delete(i),t(e)}})});o=u;var c={task:u,tiles:l};this._taskMap.set(i,c),this.fill()}return o}},{key:"loadTileTask",value:function(e,t,r){return t.trial=0,this._useWorker?this._worker.scheduleLoad(t).then(function(e){return t.onWorkerLoad(e)}):t.tileLoader()}},{key:"_getTileKey",value:function(e,t){return e+(t.level+"_")+t.x+"_"+t.y}},{key:"size",get:function(){return this._size}},{key:"capacity",get:function(){return this._capacity}},{key:"info",get:function(){return{capacity:this.capacity,size:this.size,queue:this.waitQueue.getLength()}}}]),e}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){var t=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),r.p="/js/";var n=r(65);this.worker=new n,this.listeners=new Map,this.worker.onmessage=function(e){var r=e.data.key,n=e.data.filename;if(t.listeners.has(r)){var i=t.listeners.get(r);t.listeners.delete(r),200!==e.data.status&&404!==e.data.status&&0!==e.data.status&&console.warn("bundle load suffers error",e),i.map(function(t){t(null,e.data)})}else console.warn("Worker cannot find callback for tile",n)},this.worker.onError=function(e){for(var t=0;t<100;t++)console.warn("Worker runtime error",e.message)}}return n(e,[{key:"terminate",value:function(){if(this.worker)try{this.worker.terminate()}catch(e){return console.error("LoadWorker terminate failed",e),!1}return!0}},{key:"scheduleLoad",value:function(e){var t=this,r=e.fileName(),n=e.basepath+r;return new Promise(function(i,o){var a=function(e,t){e?o(e):i(t)};if(t.listeners.has(n))t.listeners.get(n).push(a);else{t.listeners.set(n,[a]);var s=e.basepath;"/"===s.substr(0,1)&&(s=window.location.protocol+"//"+window.location.host+s);var l={key:n,filename:r,path:s+r+".ab"};t.worker.postMessage(l)}})}}]),e}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r(27)),o=r(0),a=function(){function e(t,r){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.capacity=t.capacity,r=r||{},this.debug=void 0!==r.debug&&r.debug;var n=this;this.cache=new i.default(this.capacity),this.cache.shift=function(){var e=i.default.prototype.shift.call(this),t=e.value;if(t.geometry.dispose(),t.material.materials)for(var r=0;r<t.material.materials.length;r++){var n=t.material.materials[r];n.map&&(n.map.dispose(),n.map=void 0),n.dispose()}else if(Array.isArray(t.material))for(var o=0;o<t.material.length;o++){var a=t.material[o];a.map&&(a.map.dispose(),a.map=void 0),a.dispose()}else t.material.map&&(t.material.map.dispose(),t.material.map=void 0),t.material.dispose();return e},this.cache.removeAll=function(){for(var e=n.capacity+1;n.cache.head&&e>=0;)n.cache.shift(),e--;return e>=0||(console.warn("cache removeAll error"),!1)},this._stat={hit:0,miss:0}}return n(e,[{key:"destruct",value:function(){var e=!0;return e=this.cache.removeAll()&&e,this.cache=null,e||console.warn("SharedTileCache destruct failed"),this._stat.hit=0,this._stat.miss=0,e}},{key:"clear",value:function(){var e=!0;return(e=this.cache.removeAll()&&e)||console.warn("SharedTileCache clear failed"),this._stat.hit=0,this._stat.miss=0,e}},{key:"getTile",value:function(e,t){var r=this._getTileKey(e,t),n=this.cache.get(r);if(void 0===n)this._stat.miss++;else{if(!this._validateMesh(n)){console.warn("SharedTileCache provides invalid mesh",n);var i=this.cache.remove(r);if(i.geometry.dispose(),i.material.materials)for(var o=0;o<i.material.materials.length;o++){var a=i.material.materials[o];a.map&&(a.map.dispose(),a.map=void 0),a.dispose()}else if(Array.isArray(i.material))for(var s=0;s<i.material.length;s++){var l=i.material[s];l.map&&(l.map.dispose(),l.map=void 0),l.dispose()}else i.material.map&&(i.material.map.dispose(),i.material.map=void 0),i.material.dispose();return}this._stat.hit++}return n}},{key:"putTile",value:function(e,t,r){if(this._validateMesh(r)){var n=this._getTileKey(e,t);return!this.cache.get(n)&&(this.cache.put(n,r),!0)}return console.warn("[SharedTileCache] receives invalid tile."),!1}},{key:"_getTileKey",value:function(e,t){return e+(t.level+"_")+t.x+"_"+t.y}},{key:"_validateMesh",value:function(e){return e instanceof o.Mesh?void 0!==e.material||(console.warn("[Forest] material/map not ready",e.material),!1):(console.error("[Cache] Invalid mesh",e),!1)}},{key:"stat",get:function(){return this._stat}},{key:"info",get:function(){return{stat:this.stat,size:this.cache.size}}}]),e}();t.default=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=n(r(23)),a=n(r(102)),s=n(r(100)),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0)),u=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t.cacheCapacity,i=t.dockCapacity,l=function(e){var t=o.default.detectIE(),r=!!t&&t<=11;return r&&console.warn("You are using an old IE browser. Upgrade to IE 12 or later to get best viewing experience."),!r&&window.Worker&&e}(t.allowWorker);r=r||{},this.debug=void 0!==r.debug&&r.debug,this.cache=new a.default({capacity:n}),this.dock=new s.default({capacity:i,useWorker:l}),this.status="working"}return i(e,[{key:"destruct",value:function(){var e=!0;return e=this.dock.destruct()&&e,this.worker&&(e=e&&this.worker.terminate(),this.worker=void 0),(e=this.cache.destruct()&&e)||console.warn("SharedTileRetriever destruct failed."),this.status="destructed",e}},{key:"abortPending",value:function(){return this.dock.abortPending()}},{key:"clear",value:function(){var e=!0;return e=this.dock.clear()&&e,(e=this.cache.clear()&&e)||console.warn("SharedTileRetriever clear failed."),e}},{key:"request",value:function(e,t){function r(e){if(e){var t=e.clone();return t.place_holder=e.place_holder,t.visible=e.visible,t}return e}if("working"!==this.status)return console.warn("SharedTileRetriever destructing",t.info(),"request failed"),!1;var n=this,i=this.cache.getTile(e,t);return i?Promise.resolve(r(i)):this.dock.queue(e,t).then(function(e){return Promise.resolve(e)}).catch(function(e){return t.expired?Promise.resolve(void 0):"[Dock] abortPending"===e.message?Promise.reject(e):"not found"===e?Promise.resolve(function(e){var t=new l.BoxGeometry(1,1,1);t.vertices[0]=e.boundingBox[6].clone(),t.vertices[1]=e.boundingBox[2].clone(),t.vertices[2]=e.boundingBox[5].clone(),t.vertices[3]=e.boundingBox[1].clone(),t.vertices[4]=e.boundingBox[3].clone(),t.vertices[5]=e.boundingBox[7].clone(),t.vertices[6]=e.boundingBox[0].clone(),t.vertices[7]=e.boundingBox[4].clone();var r=new l.MeshPhongMaterial({opacity:0,transparent:!0}),n=new l.Mesh(t,r);return n.place_holder=!0,n.visible=!1,n}(t)):"local data"===e?Promise.reject(new Error("local data")):"expired"===e?Promise.reject(e):(console.warn("unknown load error",e),Promise.reject(e))}).then(function(i){return void 0!==i&&n.cache.putTile(e,t,i),Promise.resolve(r(i))})}},{key:"info",get:function(){return{cache:this.cache.info,dock:this.dock.info}}}]),e}();t.default=u},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,r,n,i){for(var o=r.decodeScales.length,a=r.decodeOffsets,s=r.decodeScales,l=t.attribRange[0],u=t.attribRange[1],c=l,h=new Float32Array(o*u),f=0;f<o;f++){var d=c+u,p=s[f],m=a[f];p&&(f<3&&(p=1,m=0),function(e,t,r,n,i,o,a,s){for(var l=0,u=t;u<r;u++){var c=e.charCodeAt(u);l+=c>>1^-(1&c),n[i]=s*(l+a),i+=o}}(e,c,d,h,f,o,m,p)),c=d}var v=3*t.indexRange[1],g=new Uint16Array(v);return function(e,t,r,n,i){for(var o=0,a=0;a<r;a++){var s=e.charCodeAt(t++);n[i++]=o-s,0===s&&o++}}(e,c,v,g,0),[n,i,h,g,r]}function o(e){return new Promise(function(t,r){var n=e.src;if("string"==typeof n)if(function(e,t){return e.substr(0,t.length)===t}(n,"data:")){var i=new l.Texture(e);i.image.onload=function(){(window.URL||window.webkitURL).revokeObjectURL(e.src),t(i)}}else{(new l.TextureLoader).load(n,function(r){(window.URL||window.webkitURL).revokeObjectURL(e.src),t(r)},void 0,function(e){r(e)})}else r("The img is not an image.")})}function a(e,t,r,n,i,o,a,s,u,h,f){function d(e,t){if(!(e&&e.isBufferAttribute&&t&&t.isBufferAttribute))return console.error("TWo buffer attribute must be valid.",e,t),null;var r=e.array.length+t.array.length,n=null;if(e.array.constructor===Uint16Array&&r>Math.pow(2,e.array.BYTES_PER_ELEMENT)){n=new Uint32Array(r);for(var i=0;i<e.array.length;++i)n[i]=e.array[i];for(var o=0,a=e.array.length;o<t.array.length;++o,++a)n[a]=t.array[o]}else(n=new e.array.constructor(r)).set(e.array),n.set(t.array,e.array.length);return new l.BufferAttribute(n,e.itemSize)}function p(e,t){if(!t||!t.isBufferGeometry)return console.error("THREE.BufferGeometry.merge(): geometry1 not an instance of THREE.BufferGeometry.",t),null;if(null!==e.index&&null===t.index)return console.error("The new geometries must have index because the original geometry has index"),null;var r=e.attributes,n=t.attributes,i=0;for(var o in n)if(void 0===r[o])r[o]=n[o].clone();else{var a=r[o],s=n[o];i=a.count,r[o]=d(a,s)}var l=e.index;if(null!==t.index)if(null===l)e.setIndex(t.index);else{var u=e.index.array.length;e.setIndex(d(e.index,t.index));for(var c=u;c<e.index.array.length;c++)e.index.array[c]+=i}return e}function m(e){return e&&e.isBufferGeometry?e.index?e.index.count:0:(console.error("geometry not an instance of THREE.BufferGeometry.",e),0)}for(var v=s.decodeScales,g=s.decodeOffsets,y=f,_=[],w=0;w<3;w++)_[w]=v[w]*g[w];var b=new l.Matrix4;b.multiply((new l.Matrix4).makeTranslation(_[0],_[1],_[2])).multiply((new l.Matrix4).makeScale(v[0],v[1],v[2]));var x=(new c).create(o,a,e.options),k={},A=e.urls[n][i].material;if(0===e.options.displayMode){var M=e.materials[A];k.name=A;var S=x.attributes.normal;if("map_Kd"in M){var P=M.map_Kd;P in t&&(k.map=t[P])}else if("Kd"in M){var T=M.Kd;k.color="rgb("+T[0]+", "+T[1]+", "+T[2]+")"}if("Ka"in M&&S){var O=M.Ka;k.emissive="rgb("+O[0]+", "+O[1]+", "+O[2]+")"}if("map_Ks"in M&&S){var C=M.map_Ks;C in t&&(k.specularMap=t[C])}else if("Ks"in M&&S){var E=M.Ks;k.specular="rgb("+E[0]+", "+E[1]+", "+E[2]+")"}if("d"in M){var I=M.d;k.opacity=I}if("Ns"in M&&S){var R=M.Ns;k.shininess=R}var L=null;if(S)L=new l.MeshPhongMaterial(k);else{var j={};for(var z in k)"shininess"!==z&&"specular"!==z&&"emissive"!==z&&(j[z]=k[z]);L=new l.MeshBasicMaterial(j)}h.push(L);var B=m(u);u=p(u,x);var D=m(x);if(u.addGroup(B,D,h.length-1),h.length===y){e={};var N;N=y>1?h:L;var U=new l.Mesh(u,N);U.applyMatrix(b);var F=new l.Object3D;F.add(U),r.add(F)}}else if(0!==e.options.displayMode){var H={};for(var V in k)"shininess"!==V&&"specular"!==V&&"emissive"!==V&&(H[V]=k[V]);var W=new l.MeshBasicMaterial(H);h.push(W);var G=m(u);u=p(u,x);var Y=m(x);if(u.addGroup(G,Y,h.length-1),h.length===y){e={};var K;K=y>1?h:W;var X=new l.Mesh(u,K);X.applyMatrix(b);var Z=new l.Object3D;Z.add(X),r.add(Z)}}return Promise.resolve()}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r(0),u=function(){function e(){n(this,e)}return s(e,[{key:"decodeModel",value:function(e){var t={},r=e.urls,n=new l.Object3D;for(var s in r)t[s]=new l.Object3D;var u=[],c={};for(var h in e.materials){var f=e.materials[h];f.hasOwnProperty("map_Kd")&&function(){var t=f.map_Kd;u.push(o(e[t]).then(function(e){e.wrapS=l.RepeatWrapping,e.wrapT=l.RepeatWrapping,e.needsUpdate=!0,c[t]=e}))}()}return Promise.all(u).then(function(){var t=e.decodeParams,o=new l.BufferGeometry,s=[],u=function(e){var t=e.urls,r=0;if(t)for(var n in t)t.hasOwnProperty(n)&&(r+=t[n].length);return r}(e),h=[];for(var f in r)for(var d=r[f],p=0;p<d.length;){var m=d[p],v=m.indexRange,g=e[f];if(v){var y=v[0]+3*v[1];if(g.length<y)break;m.decodeParam&&(t=m.decodeParam);var _=i(g,m,t,f,p);h.push(a(e,c,n,_[0],_[1],_[2],_[3],_[4],o,s,u))}++p}return Promise.all(h).then(function(){return Promise.resolve(n)})}).catch(function(e){return console.warn("Error in loading textures",e),Promise.reject(e)})}}]),e}(),c=function(){function e(){n(this,e)}return s(e,[{key:"create",value:function(e,t,r){var n,i,o=new l.BufferGeometry,a=new Float32Array(3*e.length/8);r.needNormal&&(i=new Float32Array(3*e.length/8)),0===r.displayMode&&(n=new Float32Array(2*e.length/8));var s,u,c,h,f,d,p,m,v=e.length;for(u=0,s=c=0;s<v;s+=8)h=e[s],f=e[s+1],d=e[s+2],a[u++]=h,a[u++]=f,a[u++]=d;if(u=0,c=3,0===r.displayMode)for(s=c;s<v;s+=8)p=e[s],m=e[s+1],n[u++]=p,n[u++]=m;u=0,c=5;var g,y=!0;if(r.needNormal)for(s=c;s<v;s+=8)h=e[s],f=e[s+1],d=e[s+2],i[u++]=h,i[u++]=f,i[u++]=d,h*h+f*f+d*d>1e-4&&(y=!1);if(y&&(r.needNormal=!1),!0===r.extendModel){var _,w,b=new Float32Array(3*t.length);for(r.needNormal&&(_=new Float32Array(3*t.length)),0===r.displayMode&&(w=new Float32Array(2*t.length)),g=0;g<t.length;++g)b[3*g]=a[3*t[g]],b[3*g+1]=a[3*t[g]+1],b[3*g+2]=a[3*t[g]+2],r.needNormal&&(_[3*g]=i[3*t[g]],_[3*g+1]=i[3*t[g]+1],_[3*g+2]=i[3*t[g]+2]),0===r.displayMode&&(w[2*g]=n[2*t[g]],w[2*g+1]=n[2*t[g]+1]);o.addAttribute("position",new l.BufferAttribute(b,3)),r.needNormal&&o.addAttribute("normal",new l.BufferAttribute(_,3)),0===r.displayMode&&o.addAttribute("uv",new l.BufferAttribute(_,2))}else o.setIndex(new l.BufferAttribute(t,1)),o.addAttribute("position",new l.BufferAttribute(a,3)),r.needNormal&&o.addAttribute("normal",new l.BufferAttribute(i,3)),0===r.displayMode&&o.addAttribute("uv",new l.BufferAttribute(n,2));return o.computeBoundingSphere(),o}}]),e}();t.default=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=n(r(27)),a=n(r(49)),s=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.limit=t||66,this.cache=new o.default(t),this.debug=!1,this.stat={hit:0,miss:0};var r=this;this.cache.shift=function(){var e=o.default.prototype.shift.call(this);return r.debug&&console.log("cache shift",e.value),e.value.detach(),e},this.cache.removeAll=function(){for(var e=t+1;r.cache.head&&e>=0;)r.cache.shift(),e--;return e>=0||(console.error("cache removeAll error"),!1)}}return i(e,[{key:"destruct",value:function(){var e=!0;return e=e&&this.cache.removeAll(),this.cache=void 0,this.stat=void 0,e||console.warn("TileCache destruct failed"),e}},{key:"info",value:function(){return{hit_rate:this.stat.hit+this.stat.miss===0?0:this.stat.hit/(this.stat.hit+this.stat.miss),size:this.cache.size}}},{key:"getByEntry",value:function(e){var t=this.debug,r=this;if(void 0===e||void 0===e.layer||void 0===e.entityOptions)return Promise.reject(new Error("AltizureMeshEntityCache invalid getByEntry params"));var n=e.layer,i=e.entityOptions,o=i.PID,s=this.cache.get(o);return void 0===s?(t&&console.log("miss"),s=new a.default(n,i),r.cache.put(o,s),r.stat.miss++,Promise.resolve(s)):(t&&console.log("hit"),r.stat.hit++,Promise.resolve(s))}}]),e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.id=null,this.name=null,this.views=null,this.owner={},this.owner.name=null,this.owner.joined=null,this.date=null,this.geoInfo={},this.geoInfo.autoAligned=null,this.geoInfo.minLat=null,this.geoInfo.minLong=null,this.geoInfo.maxLat=null,this.geoInfo.maxLong=null,this.geoInfo.centerLat=null,this.geoInfo.centerLong=null,this.versionControl=null,this.cloudPath=null,this.modelTransform=null}return n(e,[{key:"destruct",value:function(){this.id=null,this.name=null,this.views=null,this.owner.name=null,this.owner.joined=null,this.owner={},this.date=null,this.geoInfo.autoAligned=null,this.geoInfo.minLat=null,this.geoInfo.minLong=null,this.geoInfo.maxLat=null,this.geoInfo.maxLong=null,this.geoInfo.centerLat=null,this.geoInfo.centerLong=null,this.geoInfo={},this.versionControl=null,this.cloudPath=null,this.modelTransform.origin=null,this.modelTransform.xDir=null,this.modelTransform.yDir=null,this.modelTransform.zDir=null,this.modelTransform.minBound=null,this.modelTransform.maxBound=null,this.modelTransform.xTiles=null,this.modelTransform.yTiles=null,this.modelTransform.zTiles=null,this.modelTransform.floorHeight=null,this.modelTransform.onLoadTrans=null,this.modelTransform.lengthUnitToMeter=null,this.modelTransform={}}},{key:"loadInfo",value:function(){}},{key:"valid",get:function(){for(var e=["id","name","views","owner","date","geoInfo","versionControl","cloudPath","modelTransform"],t=0;t<e.length;t++)if(null===this[e[t]])return!1;e=Object.keys(this.owner);for(var r=0;r<e.length;r++)if(null===this.owner[e[r]])return!1;e=Object.keys(this.geoInfo);for(var n=0;n<e.length;n++)if(null===this.geoInfo[e[n]])return!1;e=Object.keys(this.modelTransform);for(var i=0;i<e.length;i++)if(null===this.modelTransform[e[i]])return console.error("invalid AltizureProjectInfo attribute this.modelTransform[",e[i],"]=",this[e[i]]),!1;var o=Math.max(Math.abs(this.geoInfo.maxLat-this.geoInfo.minLat),Math.abs(this.geoInfo.maxLong-this.geoInfo.minLong));return!(o>2&&(console.warn("Unusual large(",o,") project ",this.name,this.id),1))}}]),e}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(e,t,r){var i=document.createElement("canvas");i.width=e,i.height=t,this.canvas=i,this.style=r||{},this.style={margin:void 0===this.style.margin?.05*i.width:this.style.margin};var o=i.getContext("2d");this.context=o;var a=new n.Texture(i);this.texture=a,this.cursorY=0};i.prototype.clear=function(e){return void 0!==e?(this.context.fillStyle=e,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)):this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.texture.needsUpdate=!0,this},i.prototype.drawText=function(e,t,r,n,i){if(void 0!==i&&(this.context.font=i),void 0===t||null===t){var o=this.context.measureText(e);t=(this.canvas.width-o.width)/2}return this.context.fillStyle=n,this.context.strokeStyle="black",this.context.lineJoin="round",this.context.fillText(e,t,r),this.context.lineWidth=1,this.context.strokeText(e,t,r),this.context.fill(),this.context.stroke(),this.texture.needsUpdate=!0,this},i.prototype.drawTextCooked=function(e){var t=this,r=this.context,n=this.canvas,i=(e=e||{}).text,o={margin:void 0!==e.margin?e.margin:0,lineHeight:void 0!==e.lineHeight?e.lineHeight:.1,align:void 0!==e.align?e.align:"center",fillStyle:void 0!==e.fillStyle?e.fillStyle:"black",font:void 0!==e.font?e.font:"bold 102.4px Arial",outlineWidth:void 0!==e.outlineWidth?2*e.outlineWidth:2,outlineStyle:void 0!==e.outlineStyle?e.outlineStyle:"black",resetCursorY:void 0===e.resetCursorY||e.resetCursorY,trimText:void 0===e.trimText||e.trimText},a=o.lineHeight,s=o.margin;o.lineHeight<1&&(a=o.lineHeight*n.height),o.margin<1&&(s=o.margin*n.height),console.assert("string"==typeof i),r.save(),r.fillStyle=o.fillStyle,r.lineJoin="round",r.font=o.font,r.textBaseline="top";var l=s+this.style.margin;o.resetCursorY||(l=this.cursorY+s);do{var u;u=o.trimText?function(e){var i="",o=n.width-2*t.style.margin-2*s;if(r.measureText(e).width<o)return e.substr(0,e.length);var a=e.length-1;i=e.substr(0,a)+" ...";for(var l=r.measureText(i).width;a>0&&l>3*o;)a/=2,i=e.substr(0,a)+" ...",l=r.measureText(i).width;for(;a>0&&l>o;)a-=1,i=e.substr(0,a)+" ...",l=r.measureText(i).width;return i}(i):function(e){for(var i="",o=n.width-2*t.style.margin-2*s;i.length!==e.length&&!(r.measureText(i).width>o);)i+=e.substr(i.length,1);return i}(i),i=i.substr(u.length);var c=r.measureText(u),h=0;"left"===o.align?h=s+this.style.margin:"right"===o.align?h=n.width-s-c.width-this.style.margin:"center"===o.align?h=(n.width-c.width)/2:console.assert(!1),this.context.lineWidth=Math.max(1,o.outlineWidth),this.context.strokeStyle="black",this.context.strokeText(u,h,l),this.context.fillText(u,h,l),l+=a}while(i.length>0&&!o.trimText);return r.restore(),this.cursorY=l,this.texture.needsUpdate=!0,this},i.prototype.drawImage=function(){return this.context.drawImage.apply(this.context,arguments),this.texture.needsUpdate=!0,this},i.prototype.drawRectangle=function(e,t,r,n,i){return i={outlineWidth:(i=i||{}).outlineWidth||2,outlineStyle:i.outlineStyle||"rgb(0, 0, 0)",fillStyle:i.fillStyle||null},this.context.save(),null!==i.fillStyle&&(this.context.fillStyle=i.fillStyle,this.context.fillRect(e,t,r,n)),i.outlineWidth>0&&(this.context.strokeStyle=i.outlineStyle,this.context.lineWidth=i.outlineWidth,this.context.strokeRect(e,t,r,n)),this.context.restore(),this.texture.needsUpdate=!0,this},i.prototype.drawCircle=function(e,t,r,n){return n={outlineWidth:void 0===(n=n||{}).outlineWidth?2:2*n.outlineWidth,outlineStyle:void 0===n.outlineStyle?"rgb(0, 0, 0)":n.outlineStyle,fillStyle:void 0===n.fillStyle?null:n.fillStyle},this.context.save(),this.context.arc(e,t,r,0,2*Math.PI),n.outlineWidth>0&&(this.context.strokeStyle=n.outlineStyle,this.context.lineWidth=n.outlineWidth,this.context.stroke()),null!==n.fillStyle&&(this.context.fillStyle=n.fillStyle,this.context.fill()),this.context.restore(),this.texture.needsUpdate=!0,this},t.default=i},function(e,t,r){"use strict";function n(e,t,r,n){return t.degree--,e.next===e?t.child=void 0:t.child=e.next,o(e),r=s(r,e,n),e.isMarked=!1,r}function i(e,t,r){var o=e.parent;return o&&(e.isMarked?t=i(o,t=n(e,o,t,r),r):e.isMarked=!0),t}function o(e){var t=e.prev,r=e.next;t.next=r,r.prev=t,e.next=e,e.prev=e}function a(e,t,r){o(e),t.child=s(e,t.child,r),e.parent=t,e.isMarked=!1}function s(e,t,r){if(e||t){if(!e)return t;if(!t)return e;var n=e.next;return e.next=t.next,e.next.prev=e,t.next=n,t.next.prev=t,r(e,t)<0?e:t}}Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){this.minNode=void 0,this.nodeCount=0,e&&(this.compare=e)};l.prototype.clear=function(){this.minNode=void 0,this.nodeCount=0},l.prototype.decreaseKey=function(e,t){if(void 0===e)throw new Error("Cannot decrease key of non-existent node");if(this.compare({key:t},{key:e.key})>0)throw new Error("New key is larger than old key");e.key=t;var r=e.parent;r&&this.compare(e,r)<0&&(n(e,r,this.minNode,this.compare),i(r,this.minNode,this.compare)),this.compare(e,this.minNode)<0&&(this.minNode=e)},l.prototype.delete=function(e){var t=e.parent;t&&(n(e,t,this.minNode,this.compare),i(t,this.minNode,this.compare)),this.minNode=e,this.extractMinimum()},l.prototype.extractMinimum=function(){var e=this.minNode;if(e){if(e.child){var t=e.child;do{t.parent=void 0,t=t.next}while(t!==e.child)}var r;e.next!==e&&(r=e.next),o(e),this.nodeCount--,this.minNode=s(r,e.child,this.compare),r&&(this.minNode=r,this.minNode=function(e,t){for(var r=[],n=new u(e);n.hasNext();){for(var i=n.next();r[i.degree];){if(t(i,r[i.degree])>0){var o=i;r[(i=r[i.degree]).degree]=o}a(r[i.degree],i,t),r[i.degree]=void 0,i.degree++}r[i.degree]=i}e=void 0;for(var l=0;l<r.length;l++)r[l]&&(r[l].next=r[l],r[l].prev=r[l],e=s(e,r[l],t));return e}(this.minNode,this.compare))}return e},l.prototype.findMinimum=function(){return this.minNode},l.prototype.insert=function(e,t){var r=new function(e,t){this.key=e,this.value=t,this.prev=this,this.next=this,this.degree=0,this.parent=void 0,this.child=void 0,this.isMarked=void 0}(e,t);return this.minNode=s(this.minNode,r,this.compare),this.nodeCount++,r},l.prototype.isEmpty=function(){return void 0===this.minNode},l.prototype.size=function(){return this.isEmpty()?0:function e(t){var r=0,n=t;do{r++,n.child&&(r+=e(n.child)),n=n.next}while(n!==t);return r}(this.minNode)},l.prototype.union=function(e){this.minNode=s(this.minNode,e.minNode,this.compare),this.nodeCount+=e.nodeCount},l.prototype.compare=function(e,t){return e.key>t.key?1:e.key<t.key?-1:0};var u=function(e){this.items=[];var t=e;do{this.items.push(t),t=t.next}while(e!==t)};u.prototype.hasNext=function(){return this.items.length>0},u.prototype.next=function(){return this.items.shift()},t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e,t){var r=document.createElement("div");r.id="widget_load";var n=document.createElement("div");return n.id="loadText",n.innerHTML="Loading : 0%",n.style.cssText="color:#"+t.toString(16)+";",r.appendChild(n),{domElement:r,update:function(){var t=e.smart_options.loading.total,r=e.smart_options.loading.left;n.innerHTML=0===r?"Loading complete.":t<=0?"Loading complete.":"Loading : "+Math.max(10,((t-r)/t*100).toFixed(2))+"%"}}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(30)),o=n(r(28));t.default=function(e,t,r){var n=document.createElement("div");n.id="monitor",n.style.cssText="width:180px;opacity:0.9;cursor:pointer;background-color:#002";var a="padding:0 0 3px 3px;text-align:left;position:relative;color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;line-height:15px",s=i.default.createDiv,l=s(n,"sceneText",a,"Scene: 0"),u=s(n,"cacheText",a,"Cache: 0"),c=s(n,"visText",a,"Vis: 0"),h=s(n,"loadText",a,"Load: 0"),f=s(n,"sceneTriText",a,"Scene Tri.: 0"),d=s(n,"sceneVerText",a,"Scene Ver.: 0"),p=s(n,"visTriText",a,"Vis Tri.: 0"),m=s(n,"visVerText",a,"Vis Ver.: 0"),v=s(n,"tile",a,"Tile: "),g=s(n,"",a,"Programs: "),y=s(n,"",a,"Geometries: "),_=s(n,"",a,"Textures: "),w=s(n,"",a,"Draw calls: "),b=s(n,"",a,"Points: "),x=s(n,"",a,"Vertices: "),k=s(n,"",a,"Faces: "),A=function(){g.innerHTML="Programs: "+r.info.programs.length,y.innerHTML="Geometries: "+r.info.memory.geometries,_.innerHTML="Textures: "+r.info.memory.textures,w.innerHTML="Draw calls: "+r.info.render.calls,b.innerHTML="Points: "+r.info.render.points,x.innerHTML="Vertices: "+r.info.render.vertices,k.innerHTML="Faces: "+r.info.render.faces};return{domElement:n,update:function(){l.innerHTML="Scene: "+e.children.length,u.innerHTML="Cache: "+t.tile_retriever.cacheSize();for(var r=0,n=0;n<e.children.length;++n)e.children[n].visible&&r++;c.innerHTML="Vis: "+r,h.innerHTML="Load: "+t.smart_options.loading.total,function(){for(var t=0,r=0,n=0,i=0,a=0,s=0,l=0;l<e.children.length;++l)t+=a=o.default.getNumOfFaces(e.children[l]),r+=s=o.default.getNumOfVertices(e.children[l]),e.children[l].visible&&(n+=a,i+=s);f.innerHTML="Scene Tri.: "+t,d.innerHTML="Scene Ver.: "+r,p.innerHTML="Vis Tri.: "+n,m.innerHTML="Vis Ver.: "+i}(),A()},updateTileName:function(e){v.innerHTML="Tile: "+e}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(e){return e&&e.__esModule?e:{default:e}}(r(27)),o=function(e){var t=e.limit||500;this.debug=!1,this.cache=new i.default(t),this.loadFunc=e.loadFunc,this.display_lod=!1,"boolean"==typeof e.display_lod&&(this.display_lod=e.display_lod);var r=this;this.cache.shift=function(){var e=i.default.prototype.shift.call(this);return this.debug&&console.log("cache shift",e.value),r.releaseMemory(e.value),e},this.cache.removeAll=function(){for(var e=t+1;r.cache.head&&e>=0;)r.cache.shift(),e--;return e>=0||(console.warn("cache removeAll error"),!1)},this.stat={hit:0,miss:0}};o.prototype.destruct=function(){var e=!0;return this.loadFunc=void 0,e=e&&this.cache.removeAll(),this.cache=void 0,this.stat=void 0,e||console.warn("TileCache destruct failed"),e},o.prototype.releaseMemory=function(e){this.debug&&console.log("releasing",e),this.debug&&e.debug_info&&console.log("releasing",JSON.stringify(e.debug_info));try{e.geometry.dispose(),e.geometry=null}catch(e){console.warn("dispose geometry failed")}try{e.material.map&&(e.material.map.dispose(),e.material.map=void 0)}catch(e){console.warn("can not re-allocate texture")}try{e.material.dispose(),e.material=null}catch(e){console.war("dispose material failed")}return null},o.prototype.loadByURL=function(e){},o.prototype.info=function(){return{hit_rate:this.stat.hit+this.stat.miss===0?0:this.stat.hit/(this.stat.hit+this.stat.miss),size:this.cache.size}},o.prototype.getSize=function(){return this.cache.size},o.prototype.get=function(e){var t=e.level+"_"+e.x+"_"+e.y,r=this.cache.get(t),i=this,o=i.debug;return o&&console.log("get",t),void 0===r?(o&&console.log("miss"),i.display_lod?(r=function(e){var t=new n.BoxGeometry(1,1,1);t.vertices[0]=e.boundingBox[6].clone(),t.vertices[1]=e.boundingBox[2].clone(),t.vertices[2]=e.boundingBox[5].clone(),t.vertices[3]=e.boundingBox[1].clone(),t.vertices[4]=e.boundingBox[3].clone(),t.vertices[5]=e.boundingBox[7].clone(),t.vertices[6]=e.boundingBox[0].clone(),t.vertices[7]=e.boundingBox[4].clone();var r=i.debug||i.display_lod?new n.MeshPhongMaterial({color:function(e){var t=1e4*Math.sin(e++);return 16777215*(t-Math.floor(t))}(e.level+e.x+e.y)}):new n.MeshPhongMaterial({opacity:0,transparent:!0});return new n.Mesh(t,r)}(e),i.cache.put(t,r),i.stat.miss++,function(e){return new Promise(function(t){return setTimeout(t,e)})}(Math.random()%10).then(function(){return Promise.resolve(r)})):(i.stat.miss++,i.loadFunc(e).then(function(e){var r=i.cache.get(t);return r?(o&&console.warn("duplicated copy arrived"),i.releaseMemory(e),e=r):i.cache.put(t,e),Promise.resolve(e)}).catch(function(a){var s=i.cache.get(t);return o&&console.warn("loadFunc failed:",a),s?(o&&console.warn("IMPORTANT: 1st copy is success but 2nd copy fail"),Promise.resolve(s)):e.expired?Promise.resolve():"not found"===a?((r=function(e){var t=new n.BoxGeometry(1,1,1);t.vertices[0]=e.boundingBox[2].clone(),t.vertices[1]=e.boundingBox[2].clone(),t.vertices[2]=e.boundingBox[1].clone(),t.vertices[3]=e.boundingBox[1].clone(),t.vertices[4]=e.boundingBox[3].clone(),t.vertices[5]=e.boundingBox[3].clone(),t.vertices[6]=e.boundingBox[0].clone(),t.vertices[7]=e.boundingBox[0].clone();var r=i.debug||i.display_lod?new n.MeshPhongMaterial({color:function(e){var t=1e4*Math.sin(e++);return 16777215*(t-Math.floor(t))}(e.level+e.x+e.y)}):new n.MeshPhongMaterial({opacity:0,transparent:!0});return new n.Mesh(t,r)}(e)).place_holder=!0,r.visible=!1,i.cache.put(t,r),Promise.resolve(r)):Promise.reject(a)}))):(o&&console.log("hit"),i.stat.hit++,Promise.resolve(r))},t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,r){var n=r.capacity,i=0,o=this,a=r.debug;o.info=function(){return{capacity:n,size:i}},o.fill=function(){var t=e;if(t)for(var r=n-i;r>0&&!t.isEmpty();){var a=t.dequeue();o.send(a),r=n-i}},o.send=function(e){i++,a&&e.tile.expired&&console.warn("sending an expired node",e.tile),function(e){return Promise.race([e,new Promise(function(e,t){setTimeout(function(){t("Time out")},c)})])}(function(e){function r(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}return t?r(e.level)&&r(e.x)&&r(e.y)?t.get(e):(console.warn("getTile error",e),Promise.reject("unrecognize tile_info, "+JSON.stringify(e.info()))):Promise.reject("tile_cache is already destructed.")}(e.tile)).then(function(t){e.callback(t,e.session),i--,o.fill()}).catch(function(e){a&&console.warn("get tile",e,"will try to load next time"),i--,o.fill()})}}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=n(r(29)),l=n(r(111)),u=n(r(23)),c=6e6,h=function(){function e(){var t=this;i(this,e),r.p="/js/";var n=r(65);this.worker=new n,this.listeners=new Map,this.worker.onmessage=function(e){var r=e.data.filename;if(t.listeners.has(r)){var n=t.listeners.get(r);t.listeners.delete(r),200!==e.data.status&&404!==e.data.status&&0!==e.data.status&&console.warn("bundle load suffers error",e),n.map(function(t){t(null,e.data)})}else console.warn("Worker cannot find callback for tile",r)},this.worker.onError=function(e){for(var t=0;t<1e4;t++)console.warn("Worker runtime error",e.message)}}return a(e,[{key:"terminate",value:function(){if(this.worker)try{this.worker.terminate()}catch(e){return console.error("LoaderThread terminate failed",e),!1}return!0}},{key:"scheduleLoad",value:function(e){var t=this,r=e.fileName();return new Promise(function(n,i){var o=function(e,t){e?i(e):n(t)};if(t.listeners.has(r)){var a=t.listeners.get(r);a.push(o),t.listeners.set(r,a)}else{t.listeners.set(r,[o]);var s=e.basepath;(function(e,t){return e.substr(0,t.length)===t})(s,"/")&&(s=window.location.protocol+"//"+window.location.host+s);var l={filename:r,path:s+r+".ab"};t.worker.postMessage(l)}})}}]),e}(),f=function(){function e(t){i(this,e),this.debug=t.debug;var r=u.default.detectIE();if(r&&(r=r<=11),r&&console.warn("You are using an old IE browser. Upgrade to IE 12 or later to get best viewing experience."),this.allowWorker=!r&&(t.allow_worker||!1),this.allowWorker)try{this.worker=new h}catch(e){console.error("Cannot initiate web worker",e),this.allowWorker=!1,this.worker=null}this.wait_queue=new s.default,this.tile_cache=new l.default({limit:t.cache_size,debug:this.debug,display_lod:t.display_lod,loadFunc:this.loadTile.bind(this)}),this.dock=new o(this.wait_queue,this.tile_cache,{capacity:t.dock_capacity,debug:this.debug}),this.status="working"}return a(e,[{key:"destruct",value:function(){var e=!0;return this.status="destructing",this.wait_queue.clear(),this.wait_queue=void 0,this.allowWorker&&this.worker&&(e=e&&this.worker.terminate(),this.worker=void 0),e=e&&this.tile_cache.destruct(),this.tile_cache=void 0,this.dock=void 0,e||console.warn("TileRetriever destruct failed."),this.status="destructed",e}},{key:"loadTile",value:function(e){return"working"!==this.status?Promise.reject("TileRetriever destructing"):(e.trial=0,this.worker?this.worker.scheduleLoad(e).then(function(t){return e.onWorkerLoad(t)}):e.tileLoader())}},{key:"info",value:function(){return{cache:this.tile_cache.info(),queue:this.wait_queue.getLength(),dock:this.dock.info()}}},{key:"cacheSize",value:function(){return this.tile_cache.getSize()}},{key:"request",value:function(e,t,r){"working"===this.status?(this.wait_queue.enqueue({tile:e,session:t,callback:r}),this.dock.fill()):console.warn("TileRetriever destructing",e.info(),"request failed")}},{key:"clear",value:function(){this.debug&&this.wait_queue.getLength()>0&&console.log("clear wait queue length",this.wait_queue.getLength()),this.wait_queue.clear()}}]),e}();t.default=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(){this.toys=[]};i.prototype={constructor:i,Toys:function(){return this.toys},AddToy:function(e){this.toys.push(e),console.log("add toy, # ",this.toys.length)},ClearToys:function(){for(var e=this.toys.length;e--;)this.toys[e].Data()instanceof n.Mesh&&this.toys[e].render();this.toys=[]},Water:function(){for(var e=this.Toys().length;e--;)if("water"===this.Toys()[e].Category())return this.Toys()[e];return null},UpdateWater:function(e){for(var t=this.Toys().length;t--;)if("water"===this.Toys()[t].Category())return this.Toys()[t]=e,!0;return!1},update:function(){for(var e=this.toys.length;e--;)this.toys[e].update()}},t.default=i},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=n(r(25)),a=n(r(9)),s=function(e,t,r){this.REQUIRED_FIELDS=["origin","x_dir","y_dir","z_dir","max_bound","min_bound","x_tiles","y_tiles","z_tiles","camera_pos","onload_trans","maxDistance","minDistance","maxPanDistance","maxPolarAngle"],this.OPTIONAL_FIELDS=["center_pos","centerPan","grid_step","level_start","total_level","min_area","lru_size","length_unit_to_meter","floor_height","useLowTexture","extra","display_mode","mode","enableLighting"],Object.freeze(this.REQUIRED_FIELDS),Object.freeze(this.OPTIONAL_FIELDS),this.isMobile=t,this.tile_salt=r,this.transformation=new o.default};s.prototype.load=function(e,t,r){var n=this,o=n.isMobile?e+"info_m.txt":e+"info.txt";(0,a.default)({method:"get",url:o}).then(function(e){for(var r=e.data,a=0;a<n.REQUIRED_FIELDS.length;a++){var s=n.REQUIRED_FIELDS[a];r.hasOwnProperty(s)||console.error("Missing field in "+o+": "+s)}n.origin=new i.Vector3(r.origin.x,r.origin.y,r.origin.z),n.x_dir=new i.Vector3(r.x_dir.x,r.x_dir.y,r.x_dir.z),n.y_dir=new i.Vector3(r.y_dir.x,r.y_dir.y,r.y_dir.z),n.z_dir=new i.Vector3(r.z_dir.x,r.z_dir.y,r.z_dir.z),n.max_bound=new i.Vector3(r.max_bound.x,r.max_bound.y,r.max_bound.z),n.min_bound=new i.Vector3(r.min_bound.x,r.min_bound.y,r.min_bound.z),n.x_tiles=r.x_tiles,n.y_tiles=r.y_tiles,n.z_tiles=r.z_tiles,n.camera_pos=r.camera_pos,n.center_pos=r.hasOwnProperty("center_pos")?r.center_pos:new i.Vector3(0,0,0),n.grid_step=r.grid_step,n.centerPan=r.centerPan,n.maxDistance=Number(r.maxDistance),n.maxPanDistance=r.maxPanDistance,n.maxPolarAngle=r.maxPolarAngle,n.minDistance=Number(r.minDistance),n.mode=r.mode,n.extra=r.extra,n.enableLighting=/true/i.test(r.enableLighting),n.clampZoomDistance=r.clampZoomDistance+""!="false",n.minLevel=r.hasOwnProperty("level_start")?r.level_start:0,n.maxLevel=r.hasOwnProperty("total_level")?r.total_level:Math.ceil(Math.log(Math.max(r.x_tiles,r.y_tiles))/Math.LN2),n.min_area=r.hasOwnProperty("min_area")?r.min_area:.01,n.lru_size=r.hasOwnProperty("lru_size")?r.lru_size:500,n.length_unit_to_meter=r.hasOwnProperty("length_unit_to_meter")?r.length_unit_to_meter:.037,n.floor_height=r.hasOwnProperty("floor_height")?r.floor_height:0,n.useLowTexture=r.hasOwnProperty("useLowTexture")?r.useLowTexture:0,n.tile_salt=r.hasOwnProperty("version_control")?r.version_control:n.tile_salt;var l=new i.Matrix4;r.onload_trans instanceof Array?l.set.apply(l,r.onload_trans):l.makeRotationX(Math.PI*r.onload_trans.x).multiply((new i.Matrix4).makeRotationY(Math.PI*r.onload_trans.y)).multiply((new i.Matrix4).makeRotationZ(Math.PI*r.onload_trans.z));var u=l.multiply((new i.Matrix4).makeTranslation(-n.origin.x,-n.origin.y,-n.origin.z));n.transformation.set({onload:u,scale:n.length_unit_to_meter}),n.maxPolarAngle=Math.max(2/3,n.maxPolarAngle),t&&t(n)}).catch(function(e){console.log("ViewerDataInfo",e);var t=e.response.data,n=e.response.status,i=e.response.headers;r&&r(t,n,i)})},s.prototype.constructor=s,t.default=s},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(){var e;s&&(e=console).log.apply(e,arguments)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=n(r(122)),s=!1,l=new(n(r(55)).default),u=window.URL||window.webkitURL;null==u&&(u={createObjectURL:function(){return""}});var c=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.data={},this.entries=[],this.buffer=null,this.storeBuffer=null!=t&&t,this.context=null}return o(e,[{key:"_parsePixels",value:function(e,t){new a.default(e).parse(function(e,r){if(e)console.error("Bundle: fail to parse bundle png",e);else{var n=r.getWidth(),o=r.getHeight(),a=r.pixels;i("Image width and height",n,o),i("Image pixels",a.length,a),t(a,n,o)}})}},{key:"_parsePixelsFast",value:function(e,t,r){this.context=null==this.context?document.createElement("canvas").getContext("2d"):this.context,this.context.imageSmoothingEnabled=!1;var n=this.context;return this._parseImg(e,function(e){var r=e.width,o=e.height;n.canvas.width=r,n.canvas.height=o,n.drawImage(e,0,0);var a=n.getImageData(0,0,r,o).data;i("Image width and height",r,e.height),i("Canvas data array",a.length,a);var s=a.length/(r*o);t(a,r,o,s)},r)}},{key:"_parseImg",value:function(e,t,r){r=r||"image/jpeg";var n=new Image;switch(n.onload=function(){u.revokeObjectURL(n.src),null!=t&&t(n)},n.onerror=function(){console.error("Bundle: failed to create <img> with buffer")},window.location.protocol){case"http:":case"https:":n.src=this._parseURI(e,r);break;case"file:":n.src=this._parseImgURI(e,r);break;default:console.error("Unknown browsing protocal, please report to support@altizure.com ")}return n}},{key:"_parseURI",value:function(e,t){var r=null==t?new Blob([e]):new Blob([e],{type:t});return u.createObjectURL(r)}},{key:"_Uint8ToString",value:function(e){var t=[];if(Uint8Array.prototype.subarray)for(var r=0;r<e.byteLength;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,Math.min(r+32768,e.byteLength))));else if(Uint8Array.prototype.slice)for(var n=0;n<e.byteLength;n+=32768)t.push(String.fromCharCode.apply(null,e.slice(n,Math.min(n+32768,e.byteLength))));else for(var i=0;i<e.byteLength;i+=32768){for(var o=new Uint8Array(Math.min(32768,e.byteLength-i)),a=0;a<o.byteLength;++a)o[a]=e[i+a];t.push(String.fromCharCode.apply(null,o))}return t.join("")}},{key:"_parseImgURI",value:function(e,t){if(e instanceof Uint8Array)return null==t?"data:;base64,"+btoa(this._Uint8ToString(e)):"data:"+t+";base64,"+btoa(this._Uint8ToString(e));if(e instanceof ArrayBuffer){var r=new Uint8Array(e);return null==t?"data:;base64,"+btoa(this._Uint8ToString(r)):"data:"+t+";base64,"+btoa(this._Uint8ToString(r))}console.error("Unknow type ",e)}},{key:"parseBundle",value:function(e,t,r,n){n=n||{};var o=0,a="",l=new Uint8Array(t*r*3),u=n.password||"";this.storeBuffer&&(this.buffer=l);for(var c=0;c<e.length;c++)(c+1)%4!=0&&(l[o++]=e[c]);if(i("Extracted Uint8Array",l.length,l),s){for(var h="",f=500;f<800;f++)h+=l[f]+",";console.log("500 to 800 bytes"),console.log(h)}for(o=0;o<l.length&&!(l[o]<5);)a+=String.fromCharCode(l[o++]);i("Found the string 0 char at index "+o+" with value "+l[o]),i(a),o++;var d=0;if(""!==u)for(var p=o;p<l.length;p++){var m=l[p];m^=u.charCodeAt(d),l[p]=m,d=(d+1)%u.length}this.entries=[];var v=a.split("\n");v=(a=v.join("")).split(";");for(var g=0;g<v.length;g++)if(""!==v[g]){var y=v[g].split(",");this.entries.push({path:y[0],type:y[1],length:parseInt(y[2],10)})}i("this.entries",this.entries);for(var _=0;_<this.entries.length;_++){var w=this.entries[_],b=l.subarray(o,o+w.length);i("Extracting "+w.path+": length "+b.length),i("Starts at "+o+" with value "+b[0]),i("Ends at "+(o+w.length)+" with value "+b[b.length-1]),o+=w.length,this.data[w.path]=b}}},{key:"parse",value:function(e,t,r){var n=this;i("ArrayBuffer",e.byteLength),(t.robust?this._parsePixels.bind(this):this._parsePixelsFast.bind(this))(e,function(e,i,o){n.parseBundle(e,i,o,t),l.add(function(){r(n)},10)})}},{key:"load",value:function(e,t,r){var n=this,i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onprogress=function(e){var r=.999*(e.total<=0?0:e.loaded/(e.total+5));null!=t&&t(null,r)},i.onload=function(){n.parse(i.response,function(e){null!=t&&t(e,1)},r)},i.send()}},{key:"exists",value:function(e){return null!=this.data[e]}},{key:"read",value:function(e){return null===this.data[e]&&console.error("Bundle: ["+e+"] not found."),this.data[e]}},{key:"readText",value:function(e){var t="",r=this.read(e);if(null==r)return t;for(var n=0;n<r.length;n++)t+=String.fromCharCode(r[n]);return t}},{key:"readJSON",value:function(e){var t=this.readText(e);return""===t?{}:JSON.parse(t)}},{key:"readElement",value:function(e,t){var r=document.createElement(t);return r.textContent=this.readText(e),r}},{key:"readScript",value:function(e){return this.readElement(e,"script")}},{key:"readCSS",value:function(e){return this.readElement(e,"style")}},{key:"readImg",value:function(e,t){var r=this.read(e);return null===r?(console.error("Cannot read ",e),""):this._parseImg(r,t)}},{key:"readDataURL",value:function(e,t){var r=this.read(e);return null===r?"":this._parseURI(r,t)}},{key:"readRGBA",value:function(e,t,r){this.parsePixels(this.read(e),t,r)}},{key:"clearData",value:function(){this.data={}}}]),e}();t.default=c},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var r=document.createEvent("CustomEvent");return r.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),r}Object.defineProperty(t,"__esModule",{value:!0}),t.Water=t.WaterManager=t.WaterSetting=t.MaskManager=t.MaskSetting=t.RefreshQueue=t.EarthMath=t.BrowserCapatibility=t.ServiceLocal=t.ServiceRemote=t.AltizureApi=t.LoadUtil=t.EventUtil=t.Transformation=t.GeoCoord=t.Forest=t.AltizureProjectTree=t.AltizureProjectTile=t.MeshSmartTile=t.PointSmartTile=t.CameraSmartTile=t.EarthBasic=t.HyperEntity=t.HyperLayer=t.HyperNode=t.HyperViewer=t.Viewer=void 0;var o=n(r(67)),a=n(r(37)),s=n(r(10)),l=n(r(20)),u=n(r(19)),c=n(r(68)),h=n(r(66)),f=n(r(40)),d=n(r(39)),p=n(r(22)),m=n(r(41)),v=n(r(25)),g=n(r(24)),y=n(r(13)),_=n(r(69)),w=n(r(42)),b=n(r(21)),x=n(r(35)),k=n(r(34)),A=n(r(38)),M=n(r(3)),S=n(r(23)),P=n(r(17)),T=n(r(16)),O=n(r(18)),C=n(r(36)),E=n(r(43));r(70),"function"==typeof window.CustomEvent||(i.prototype=window.Event.prototype,window.CustomEvent=i),Int8Array.__proto__.from||(Int8Array.__proto__.from=function(e,t,r){var n=Int8Array.__proto__;if("function"!=typeof this)throw new TypeError("# is not a constructor");if(this.__proto__!==n)throw new TypeError("this is not a typed array.");if("function"!=typeof(t=t||function(e){return e}))throw new TypeError("specified argument is not a function");if(!(e=Object(e)).length)return new this(0);for(var i=[],o=0;o<e.length;o++)i.push(e[o]);var a=new this((i=i.map(t,r)).length);for(o=0;o<a.length;o++)a[o]=i[o];return a}),void 0===window.Math.log2&&(window.Math.log2=function(e){return window.Math.log(e)/window.Math.log(2)}),t.Viewer=o.default,t.HyperViewer=a.default,t.HyperNode=s.default,t.HyperLayer=l.default,t.HyperEntity=u.default,t.EarthBasic=c.default,t.CameraSmartTile=h.default,t.PointSmartTile=f.default,t.MeshSmartTile=d.default,t.AltizureProjectTile=b.default,t.AltizureProjectTree=p.default,t.Forest=A.default,t.GeoCoord=m.default,t.Transformation=v.default,t.EventUtil=y.default,t.LoadUtil=_.default,t.AltizureApi=g.default,t.ServiceRemote=x.default,t.ServiceLocal=k.default,t.BrowserCapatibility=S.default,t.EarthMath=M.default,t.RefreshQueue=w.default,t.MaskSetting=P.default,t.MaskManager=T.default,t.WaterSetting=O.default,t.WaterManager=C.default,t.Water=E.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"sendEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.name){if((!t||!o[e.name])&&(o[e.name]=!0,window.ga&&("www.altizure.com"===window.location.hostname||"altizure.com"===window.location.hostname||"beta.altizure.com"===window.location.hostname))){var r=e.name.split(",");ga.apply(void 0,["send","event"].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(r)))}}else console.error("Event not defined",e)}}]),e}(),o={};i.Events=function e(t,r){for(var n=Object.keys(t),i=0;i<n.length;i++){var o=n[i],a=r?r+","+o:o;e(t[o],a)}return t.name=r,t}({Control:{Multitouch:{OneFingerDrag:{},OneFingerTap:{},OneFingerDoubleTap:{},OneFingerDoubleTapDrag:{},TwoFingersPinch:{},TwoFingersRotate:{},TwoFingersTransform:{},TwoFingersSweep:{}},Mouse:{MouseScroll:{},MousePan:{},MouseZoom:{},MouseRotate:{}},Click:{Rotate:{},Zoom:{},Ortho:{}}},ViewMode:{click:{Texture:{},Surface:{},Wireframe:{},Earth:{}}},CustomMap:{view:{}},Flight:{view:{},edit:{}},Ruler:{edit:{}},Lights:{click:{}},Locator:{click:{}},Screenshot:{click:{}},Share:{click:{Flight:{},CustomMap:{},Vanilla:{}}},VisImage:{click:{}},Crop:{edit:{}}},null),t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}}},{key:"dispatchEvent",value:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,e)}}}}]),e}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(){var e=this,t=null,r=[];this.add=function(n,i,o,a,s,l){if(n)return r.push([n,i,o,a,s,l]),void(1===r.length&&function n(i){t=setTimeout(function(){i=e.add(),r.length&&n(i)},i||0)}(l));var u=r.shift();return u?(u[0].call(u[1],u[2],u[3],u[4]),u[5]):0},this.clear=function(){clearTimeout(t),r=[]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i={drawBbox:function(e){return i._drawWireframeBox(e.boundingBox)},drawBox:function(e){var t=[];return t[0]=new n.Vector3(e.min.x,e.min.y,e.min.z),t[1]=new n.Vector3(e.min.x,e.min.y,e.max.z),t[2]=new n.Vector3(e.max.x,e.min.y,e.max.z),t[3]=new n.Vector3(e.max.x,e.min.y,e.min.z),t[4]=new n.Vector3(e.min.x,e.max.y,e.min.z),t[5]=new n.Vector3(e.min.x,e.max.y,e.max.z),t[6]=new n.Vector3(e.max.x,e.max.y,e.max.z),t[7]=new n.Vector3(e.max.x,e.max.y,e.min.z),i._drawWireframeBox(t)},drawBoxByPoint:function(e,t){var r=[];return r[0]=e.clone(),r[1]=new n.Vector3(e.x,e.y,t.z),r[2]=new n.Vector3(t.x,e.y,t.z),r[3]=new n.Vector3(t.x,e.y,e.z),r[4]=new n.Vector3(e.x,t.y,e.z),r[5]=new n.Vector3(e.x,t.y,t.z),r[6]=t.clone(),r[7]=new n.Vector3(t.x,t.y,e.z),i._drawWireframeBox(r)},_drawWireframeBox:function(e){for(var t=new n.Geometry,r=[0,1,2,3,0,4,7,3,2,6,7,6,5,1,2,6,5,4,0,1],i=0;i<r.length;++i)t.vertices.push(e[r[i]]);var o=new n.LineBasicMaterial({color:65280});return new n.Line(t,o)},buildAxes:function(e){var t=new n.Object3D;t.name="xyzaxes",t.add(this.drawLine(new n.Vector3(0,0,0),new n.Vector3(e,0,0),16711680,!1)),t.add(this.drawLine(new n.Vector3(0,0,0),new n.Vector3(0,e,0),65280,!1)),t.add(this.drawLine(new n.Vector3(0,0,0),new n.Vector3(0,0,e),255,!1));var r=new n.PlaneGeometry(e,e),i=new n.MeshBasicMaterial({side:n.DoubleSide,color:8947848});i.opacity=.5,i.transparent=!0;var o=new n.Mesh(r,i);return o.applyMatrix((new n.Matrix4).makeRotationX(Math.PI/2)),o.applyMatrix((new n.Matrix4).makeTranslation(e/2,0,e/2)),t.add(o),t},buildTransAxes:function(e,t,r,i,o){var a=new n.Object3D;return a.add(this.drawLine(e,e.clone().add(t.clone().multiplyScalar(o)),16711680,!0)),a.add(this.drawLine(e,e.clone().add(r.clone().multiplyScalar(o)),65280,!0)),a.add(this.drawLine(e,e.clone().add(i.clone().multiplyScalar(o)),255,!0)),a},drawLine:function(e,t,r,i){var o,a=new n.Geometry;return o=i?new n.LineDashedMaterial({linewidth:3,color:r,dashSize:3,gapSize:3}):new n.LineBasicMaterial({linewidth:3,color:r}),a.vertices.push(e.clone()),a.vertices.push(t.clone()),a.computeLineDistances(),new n.LineSegments(a,o)},drawSphere:function(e,t,r){var i=new n.SphereGeometry(t,32,32),o=new n.MeshBasicMaterial({color:r}),a=new n.Mesh(i,o);return a.position.copy(e),a},buildLocalAxes:function(e,t){var r=new n.Object3D;e.matrixWorldNeedsUpdate=!0;var i=new n.Vector3(0,0,0);e.localToWorld(i);var o=new n.Vector3(t,0,0);e.localToWorld(o);var a=new n.Vector3(0,t,0);e.localToWorld(a);var s=new n.Vector3(0,0,t);return e.localToWorld(s),r.add(this.drawLine(i,o,16711680,!1)),r.add(this.drawLine(i,a,65280,!1)),r.add(this.drawLine(i,s,255,!1)),r},renderAsImage:function(e,t,r,o,a){var s=e.getContext(),l=new n.WebGLRenderTarget(o,a,{minFilter:n.NearestFilter,magFilter:n.NearestFilter,format:n.RGBAFormat});e.setSize(o,a),r.aspect=o/a,r instanceof n.OrthographicCamera&&(r.right=r.top*r.aspect,r.left=-r.right),e.render(t,r,l,!0);var u=new Uint8Array(o*a*4);return s.readPixels(0,0,o,a,s.RGBA,s.UNSIGNED_BYTE,u),this.flipImageInY(u,o,a),i.convertFboToImage(u,o,a)},flipImageInY:function(e,t,r){var n,i,o;for(n=0;n<4*t;n+=4)for(i=0;i<Math.floor(r/2);i++){var a=t*i*4+n,s=[];for(o=0;o<4;o++)s[o]=e[a+o];var l=t*(r-i-1)*4+n;for(o=0;o<4;o++)e[a+o]=e[l+o],e[l+o]=s[o]}},convertFboToImage:function(e,t,r){var n=document.createElement("canvas");n.width=t,n.height=r;var i=n.getContext("2d"),o=i.createImageData(t,r);return o.data.set(e),i.putImageData(o,0,0),n.toDataURL("image/jpeg",.9)},showImage:function(e){console.warn("I am just too lazy to convert this.")}};t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){this.width=0,this.height=0,this.bitDepth=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.alpha=!1,this.pixelBits=0,this.palette=null,this.pixels=null};n.prototype.getWidth=function(){return this.width},n.prototype.setWidth=function(e){this.width=e},n.prototype.getHeight=function(){return this.height},n.prototype.setHeight=function(e){this.height=e},n.prototype.getBitDepth=function(){return this.bitDepth},n.prototype.setBitDepth=function(e){if(-1===[2,4,8,16].indexOf(e))throw new Error("invalid bith depth "+e);this.bitDepth=e},n.prototype.getColorType=function(){return this.colorType},n.prototype.setColorType=function(e){var t=0,r=!1;switch(e){case 0:t=1;break;case 2:t=3;break;case 3:t=1;break;case 4:t=2,r=!0;break;case 6:t=4,r=!0;break;default:throw new Error("invalid color type")}this.colors=t,this.alpha=r,this.colorType=e},n.prototype.getCompressionMethod=function(){return this.compressionMethod},n.prototype.setCompressionMethod=function(e){if(0!==e)throw new Error("invalid compression method "+e);this.compressionMethod=e},n.prototype.getFilterMethod=function(){return this.filterMethod},n.prototype.setFilterMethod=function(e){if(0!==e)throw new Error("invalid filter method "+e);this.filterMethod=e},n.prototype.getInterlaceMethod=function(){return this.interlaceMethod},n.prototype.setInterlaceMethod=function(e){if(0!==e&&1!==e)throw new Error("invalid interlace method "+e);this.interlaceMethod=e},n.prototype.setPalette=function(e){if(e.length%3!=0)throw new Error("incorrect PLTE chunk length");if(e.length>3*Math.pow(2,this.bitDepth))throw new Error("palette has more colors than 2^bitdepth");this.palette=e},n.prototype.getPalette=function(){return this.palette},n.prototype.getPixel=function(e,t){if(!this.pixels)throw new Error("pixel data is empty");if(e>=this.width||t>=this.height)throw new Error("x,y position out of bound");var r=this.colors*this.bitDepth/8*(t*this.width+e),n=this.pixels;switch(this.colorType){case 0:return[n[r],n[r],n[r],255];case 2:return[n[r],n[r+1],n[r+2],255];case 3:return[this.palette[3*n[r]+0],this.palette[3*n[r]+1],this.palette[3*n[r]+2],255];case 4:return[n[r],n[r],n[r],n[r+1]];case 6:return[n[r],n[r+1],n[r+2],n[r+3]]}},t.default=n},function(e,t,r){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+(e[t+3]<<0)}function o(e,t){return e[t]<<0}function a(e){if("string"==typeof e){var t=e;e=new Array(t.length);for(var r=0,n=t.length;r<n;r++)e[r]=t[r].charCodeAt(0)}else"ArrayBuffer"===h.call(e).slice(8,-1)&&(e=new Uint8Array(e));this.i=0,this.bytes=e,this.png=new u.default,this.dataChunks=[]}Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=n(r(152)),u=n(r(121)),c=Array.prototype.slice,h=Object.prototype.toString;a.prototype.readBytes=function(e){var t=this.i+e;if(t>this.bytes.length)throw new Error("Unexpectedly reached end of file");var r=c.call(this.bytes,this.i,t);return this.i=t,r},a.prototype.decodeHeader=function(){if(0!==this.i)throw new Error("file pointer should be at 0 to read the header");var e=this.readBytes(8);if(!function(e,t){if(e.length!==t.length)return!1;for(var r=e.length;r--;)if(e[r]!==t[r])return!1;return!0}(e,[137,80,78,71,13,10,26,10]))throw new Error("invalid PNGReader file (bad signature)");this.header=e},a.prototype.decodeChunk=function(){var e=i(this.readBytes(4),0);if(e<0)throw new Error("Bad chunk length "+(4294967295&e));var t=function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}(this.readBytes(4)),r=this.readBytes(e);this.readBytes(4);switch(t){case"IHDR":this.decodeIHDR(r);break;case"PLTE":this.decodePLTE(r);break;case"IDAT":this.decodeIDAT(r);break;case"IEND":this.decodeIEND(r)}return t},a.prototype.decodeIHDR=function(e){var t=this.png;t.setWidth(i(e,0)),t.setHeight(i(e,4)),t.setBitDepth(o(e,8)),t.setColorType(o(e,9)),t.setCompressionMethod(o(e,10)),t.setFilterMethod(o(e,11)),t.setInterlaceMethod(o(e,12))},a.prototype.decodePLTE=function(e){this.png.setPalette(e)},a.prototype.decodeIDAT=function(e){this.dataChunks.push(e)},a.prototype.decodeIEND=function(){},a.prototype.decodePixels=function(t){var r,n,i,o,a=this.png,s=this,u=0;for(o=this.dataChunks.length;o--;)u+=this.dataChunks[o].length;var c=new e(u);for(r=0,i=0,o=this.dataChunks.length;r<o;r++){var h=this.dataChunks[r];for(n=0;n<h.length;n++)c[i++]=h[n]}!function(e,t){try{t(null,l.default.inflate(e))}catch(e){t(e)}}(c,function(e,r){if(e)return t(e);try{0===a.getInterlaceMethod()?s.interlaceNone(r):s.interlaceAdam7(r)}catch(e){return t(e)}t()})},a.prototype.interlaceNone=function(t){for(var r,n=this.png,i=Math.max(1,n.colors*n.bitDepth/8),a=i*n.width,s=new e(i*n.width*n.height),l=0,u=0;u<t.length;u+=a+1){switch(r=c.call(t,u+1,u+a+1),o(t,u)){case 0:this.unFilterNone(r,s,i,l,a);break;case 1:this.unFilterSub(r,s,i,l,a);break;case 2:this.unFilterUp(r,s,i,l,a);break;case 3:this.unFilterAverage(r,s,i,l,a);break;case 4:this.unFilterPaeth(r,s,i,l,a);break;default:throw new Error("unkown filtered scanline")}l+=a}n.pixels=s},a.prototype.interlaceAdam7=function(e){throw new Error("Adam7 interlacing is not implemented yet")},a.prototype.unFilterNone=function(e,t,r,n,i){for(var o=0,a=i;o<a;o++)t[n+o]=e[o]},a.prototype.unFilterSub=function(e,t,r,n,i){for(var o=0;o<r;o++)t[n+o]=e[o];for(;o<i;o++)t[n+o]=e[o]+t[n+o-r]&255},a.prototype.unFilterUp=function(e,t,r,n,i){var o=0;if(n-i<0)for(;o<i;o++)t[n+o]=e[o];else for(;o<i;o++){var a=e[o],s=t[n+o-i];t[n+o]=a+s&255}},a.prototype.unFilterAverage=function(e,t,r,n,i){var o=0;if(n-i<0){for(;o<r;o++)t[n+o]=e[o];for(;o<i;o++)t[n+o]=e[o]+(t[n+o-r]>>1)&255}else{for(;o<r;o++)t[n+o]=e[o]+(t[n-i+o]>>1)&255;for(;o<i;o++){var a=e[o],s=t[n+o-r],l=t[n+o-i];t[n+o]=a+(s+l>>1)&255}}},a.prototype.unFilterPaeth=function(e,t,r,n,i){var o=0;if(n-i<0){for(;o<r;o++)t[n+o]=e[o];for(;o<i;o++)t[n+o]=e[o]+t[n+o-r]&255}else{for(;o<r;o++)t[n+o]=e[o]+t[n+o-i]&255;for(;o<i;o++){var a,s=e[o],l=t[n+o-r],u=t[n+o-i],c=t[n+o-i-r],h=l+u-c,f=Math.abs(h-l),d=Math.abs(h-u),p=Math.abs(h-c);a=f<=d&&f<=p?l:d<=p?u:c,t[n+o]=s+a&255}}},a.prototype.parse=function(e,t){"function"==typeof e&&(t=e),"object"!==(void 0===e?"undefined":s(e))&&(e={});try{for(this.decodeHeader();this.i<this.bytes.length;){var r=this.decodeChunk();if("IHDR"===r&&!1===e.data||"IEND"===r)break}var n=this.png;this.decodePixels(function(e){t(e,n)})}catch(e){t(e)}},t.default=a}).call(t,r(125).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(e){return e&&e.__esModule?e:{default:e}}(r(28));t.default=function(e,t,r){function o(e,t){var r=window.devicePixelRatio||1,i=s.canvas.height,o=s.drawingBufferHeight,a=new n.Vector3(e/s.canvas.clientWidth*(s.drawingBufferWidth/s.canvas.width)*2-1,1-2*(t*o/i+(i-o)/r)/s.canvas.clientHeight,0);l.setFromCamera(a.clone(),u.camera)}function a(e,t){var r;if(o(e,t),u.sceneGraphRoot instanceof n.Plane){var i=l.ray.intersectPlane(u.sceneGraphRoot);r=null==i?[]:[{point:i}]}else r=l.intersectObjects(u.sceneGraphRoot.children,!0);return r}this.camera=e,this.sceneGraphRoot=r;var s=t.getContext(),l=new n.Raycaster,u=this;this.pickPoint=function(e,t){var r=a(e,t);return r.length>0?r[0].point:null},this.pickObject=function(e,t){var r=a(e,t);return r.length>0?r[0].object:null},this.pickTile=function(e,t){var r=this.pickObject(e,t);return null===r?null:i.default.getTileFromMesh(r).name},this.pickLeafTile=function(e,t,r){var o=a(e,t);if(0===o.length)return null;var s=i.default.getTileFromMesh(o[0].object).name;if(i.default.parseTileName(s).level===r.maxLevel)return s;var l=o[0].point,u=r.info,c=(new n.Matrix4).getInverse(u.onload_transformation),h=l.clone().applyMatrix4(c),f=u.x_dir.clone().multiplyScalar(u.min_bound.x),d=u.y_dir.clone().multiplyScalar(u.min_bound.y),p=u.origin.clone().add(f).add(d),m=(h=h.sub(p)).clone().dot(u.x_dir),v=h.clone().dot(u.y_dir);return m=Math.floor(m/u.x_unit),v=Math.floor(v/u.y_unit),m=Math.min(u.x_tiles-1,Math.max(0,m)),v=Math.min(u.y_tiles-1,Math.max(0,v)),i.default.makeTileName(r.maxLevel,m,v)},this.worldToScreen=function(e){var t=window.devicePixelRatio||1,r=(new n.Matrix4).multiplyMatrices(u.camera.projectionMatrix,u.camera.matrixWorldInverse),i=e.clone().applyMatrix4(r),o=.5*(i.x+1)*s.canvas.clientWidth*(s.canvas.width/s.drawingBufferWidth),a=(.5*(1-i.y)*s.canvas.clientHeight-(s.canvas.height-s.drawingBufferHeight)/t)*(s.canvas.height/s.drawingBufferHeight);return new n.Vector2(o,a)},this.isPointVisible=function(e){var t=e.clone(),r=u.camera.position.clone().sub(t).normalize();return new n.Raycaster(t,r).intersectObjects(u.sceneGraphRoot.children,!0).length<1},this.pickTileDirect=function(e,r,o){var a,l,c,h,f=new n.WebGLRenderTarget(s.drawingBufferWidth,s.drawingBufferHeight,{minFilter:n.NearestFilter});for(c=0;c<u.sceneGraphRoot.children.length;c++)if(""!==(l=u.sceneGraphRoot.children[c]).name){var d=c>255?255:c,p=c>512?c-512:0,m=Math.min(255,Math.max(c-256,0)),v=new n.Color;v.setRGB(d/255,m/255,p/255);var g=new n.MeshBasicMaterial({color:v});for(a=i.default.getMeshes(l),h=0;h<a.length;h++)a[h].temp_material=a[h].material,a[h].material=g}t.render(o,u.camera,f,!0);var y=new Uint8Array(4),_=new n.DataTexture(y,1,1);for(s.readPixels(e,s.drawingBufferHeight-r,1,1,s.RGBA,s.UNSIGNED_BYTE,_.image.data),c=0;c<u.sceneGraphRoot.children.length;c++)if(""!==(l=u.sceneGraphRoot.children[c]).name)for(a=i.default.getMeshes(l),h=0;h<a.length;h++)a[h].material=a[h].temp_material,delete a[h].temp_material;var w=y[0]+y[1]+y[2];return w<u.sceneGraphRoot.children.length?u.sceneGraphRoot.children[w].name:null},this.getRay=function(e,t){return o(e,t),l.ray},this.updateSgr=function(e){this.sceneGraphRoot=e}}},function(e,t,r){"use strict";function n(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function i(e){return a[e>>18&63]+a[e>>12&63]+a[e>>6&63]+a[63&e]}function o(e,t,r){for(var n,o=[],a=t;a<r;a+=3)n=(e[a]<<16)+(e[a+1]<<8)+e[a+2],o.push(i(n));return o.join("")}t.byteLength=function(e){return 3*e.length/4-n(e)},t.toByteArray=function(e){var t,r,i,o,a,u=e.length;o=n(e),a=new l(3*u/4-o),r=o>0?u-4:u;var c=0;for(t=0;t<r;t+=4)i=s[e.charCodeAt(t)]<<18|s[e.charCodeAt(t+1)]<<12|s[e.charCodeAt(t+2)]<<6|s[e.charCodeAt(t+3)],a[c++]=i>>16&255,a[c++]=i>>8&255,a[c++]=255&i;return 2===o?(i=s[e.charCodeAt(t)]<<2|s[e.charCodeAt(t+1)]>>4,a[c++]=255&i):1===o&&(i=s[e.charCodeAt(t)]<<10|s[e.charCodeAt(t+1)]<<4|s[e.charCodeAt(t+2)]>>2,a[c++]=i>>8&255,a[c++]=255&i),a},t.fromByteArray=function(e){for(var t,r=e.length,n=r%3,i="",s=[],l=0,u=r-n;l<u;l+=16383)s.push(o(e,l,l+16383>u?u:l+16383));return 1===n?(t=e[r-1],i+=a[t>>2],i+=a[t<<4&63],i+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],i+=a[t>>10],i+=a[t>>4&63],i+=a[t<<2&63],i+="="),s.push(i),s.join("")};for(var a=[],s=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,h=u.length;c<h;++c)a[c]=u[c],s[u.charCodeAt(c)]=c;s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},function(e,t,r){"use strict";(function(e){function n(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function i(e,t){if(n()<t)throw new RangeError("Invalid typed array length");return o.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=o.prototype:(null===e&&(e=new o(t)),e.length=t),e}function o(e,t,r){if(!(o.TYPED_ARRAY_SUPPORT||this instanceof o))return new o(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return a(this,e,t,r)}function a(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n),o.TYPED_ARRAY_SUPPORT?(e=t).__proto__=o.prototype:e=u(e,t),e}(e,t,r,n):"string"==typeof t?function(e,t,r){if("string"==typeof r&&""!==r||(r="utf8"),!o.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|h(t,r),a=(e=i(e,n)).write(t,r);return a!==n&&(e=e.slice(0,a)),e}(e,t,r):function(e,t){if(o.isBuffer(t)){var r=0|c(t.length);return 0===(e=i(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||function(e){return e!=e}(t.length)?i(e,0):u(e,t);if("Buffer"===t.type&&U(t.data))return u(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t){if(s(t),e=i(e,t<0?0:0|c(t)),!o.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function u(e,t){var r=t.length<0?0:0|c(t.length);e=i(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function c(e){if(e>=n())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n().toString(16)+" bytes");return 0|e}function h(e,t){if(o.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return j(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return z(e).length;default:if(n)return j(e).length;t=(""+t).toLowerCase(),n=!0}}function f(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function d(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:p(e,t,r,n,i);if("number"==typeof t)return t&=255,o.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):p(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function p(e,t,r,n,i){function o(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var a,s=1,l=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,l/=2,u/=2,r/=2}if(i){var c=-1;for(a=r;a<l;a++)if(o(e,a)===o(t,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===u)return c*s}else-1!==c&&(a-=a-c),c=-1}else for(r+u>l&&(r=l-u),a=r;a>=0;a--){for(var h=!0,f=0;f<u;f++)if(o(e,a+f)!==o(t,f)){h=!1;break}if(h)return a}return-1}function m(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[r+a]=s}return a}function v(e,t,r,n){return B(j(t,e.length-r),e,r,n)}function g(e,t,r,n){return B(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function y(e,t,r,n){return g(e,t,r,n)}function _(e,t,r,n){return B(z(t),e,r,n)}function w(e,t,r,n){return B(function(e,t){for(var r,n,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)r=e.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function b(e,t,r){return 0===t&&r===e.length?D.fromByteArray(e):D.fromByteArray(e.slice(t,r))}function x(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,a,s,l,u=e[i],c=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=r)switch(h){case 1:u<128&&(c=u);break;case 2:128==(192&(o=e[i+1]))&&(l=(31&u)<<6|63&o)>127&&(c=l);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(l=(15&u)<<12|(63&o)<<6|63&a)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&l<1114112&&(c=l)}null===c?(c=65533,h=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=h}return function(e){var t=e.length;if(t<=F)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=F));return r}(n)}function k(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function A(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function M(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=L(e[o]);return i}function S(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function P(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function T(e,t,r,n,i,a){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function O(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function C(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function E(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function I(e,t,r,n,i){return i||E(e,0,r,4),N.write(e,t,r,n,23,4),r+4}function R(e,t,r,n,i){return i||E(e,0,r,8),N.write(e,t,r,n,52,8),r+8}function L(e){return e<16?"0"+e.toString(16):e.toString(16)}function j(e,t){t=t||1/0;for(var r,n=e.length,i=null,o=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function z(e){return D.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(H,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function B(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}var D=r(124),N=r(150),U=r(151);t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,o.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=n(),o.poolSize=8192,o._augment=function(e){return e.__proto__=o.prototype,e},o.from=function(e,t,r){return a(null,e,t,r)},o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0})),o.alloc=function(e,t,r){return function(e,t,r,n){return s(t),t<=0?i(e,t):void 0!==r?"string"==typeof n?i(e,t).fill(r,n):i(e,t).fill(r):i(e,t)}(null,e,t,r)},o.allocUnsafe=function(e){return l(null,e)},o.allocUnsafeSlow=function(e){return l(null,e)},o.isBuffer=function(e){return!(null==e||!e._isBuffer)},o.compare=function(e,t){if(!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!U(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=o.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var a=e[r];if(!o.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,i),i+=a.length}return n},o.byteLength=h,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)f(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)f(this,t,t+3),f(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)f(this,t,t+7),f(this,t+1,t+6),f(this,t+2,t+5),f(this,t+3,t+4);return this},o.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?x(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return M(this,t,r);case"utf8":case"utf-8":return x(this,t,r);case"ascii":return k(this,t,r);case"latin1":case"binary":return A(this,t,r);case"base64":return b(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},o.prototype.compare=function(e,t,r,n,i){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var a=i-n,s=r-t,l=Math.min(a,s),u=this.slice(n,i),c=e.slice(t,r),h=0;h<l;++h)if(u[h]!==c[h]){a=u[h],s=c[h];break}return a<s?-1:s<a?1:0},o.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return d(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return d(this,e,t,r,!1)},o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return m(this,e,t,r);case"utf8":case"utf-8":return v(this,e,t,r);case"ascii":return g(this,e,t,r);case"latin1":case"binary":return y(this,e,t,r);case"base64":return _(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var F=4096;o.prototype.slice=function(e,t){var r,n=this.length;if(e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),o.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=o.prototype;else{var i=t-e;r=new o(i,void 0);for(var a=0;a<i;++a)r[a]=this[a+e]}return r},o.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||P(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},o.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||P(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},o.prototype.readUInt8=function(e,t){return t||P(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return t||P(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return t||P(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||P(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||P(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){t||P(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt16BE=function(e,t){t||P(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt32LE=function(e,t){return t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return t||P(e,4,this.length),N.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return t||P(e,4,this.length),N.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return t||P(e,8,this.length),N.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return t||P(e,8,this.length),N.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){e=+e,t|=0,r|=0,n||T(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){e=+e,t|=0,r|=0,n||T(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||T(this,e,t,1,255,0),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||T(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):O(this,e,t,!0),t+2},o.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||T(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):O(this,e,t,!1),t+2},o.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||T(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):C(this,e,t,!0),t+4},o.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||T(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):C(this,e,t,!1),t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);T(this,e,t,r,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<r&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);T(this,e,t,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||T(this,e,t,1,127,-128),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||T(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):O(this,e,t,!0),t+2},o.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||T(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):O(this,e,t,!1),t+2},o.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||T(this,e,t,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):C(this,e,t,!0),t+4},o.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||T(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):C(this,e,t,!1),t+4},o.prototype.writeFloatLE=function(e,t,r){return I(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return I(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return R(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return R(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,a=n-r;if(this===e&&r<t&&t<n)for(i=a-1;i>=0;--i)e[i+t]=this[i+r];else if(a<1e3||!o.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var s=o.isBuffer(e)?e:j(new o(e,n).toString()),l=s.length;for(a=0;a<r-t;++a)this[a+t]=s[a%l]}return this};var H=/[^+\/0-9A-Za-z-_]/g}).call(t,r(63))},function(e,t,r){e.exports=function(e){return function(){var t=e,r=t.lib,n=r.BlockCipher,i=t.algo,o=[],a=[],s=[],l=[],u=[],c=[],h=[],f=[],d=[],p=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;for(var r=0,n=0,t=0;t<256;t++){var i=n^n<<1^n<<2^n<<3^n<<4;i=i>>>8^255&i^99,o[r]=i,a[i]=r;var m=e[r],v=e[m],g=e[v],y=257*e[i]^16843008*i;s[r]=y<<24|y>>>8,l[r]=y<<16|y>>>16,u[r]=y<<8|y>>>24,c[r]=y;var y=16843009*g^65537*v^257*m^16843008*r;h[i]=y<<24|y>>>8,f[i]=y<<16|y>>>16,d[i]=y<<8|y>>>24,p[i]=y,r?(r=m^e[e[e[g^m]]],n^=e[e[n]]):r=n=1}}();var m=[0,1,2,4,8,16,32,64,128,27,54],v=i.AES=n.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,n=this._nRounds=r+6,i=4*(n+1),a=this._keySchedule=[],s=0;s<i;s++)if(s<r)a[s]=t[s];else{var l=a[s-1];s%r?r>6&&s%r==4&&(l=o[l>>>24]<<24|o[l>>>16&255]<<16|o[l>>>8&255]<<8|o[255&l]):(l=o[(l=l<<8|l>>>24)>>>24]<<24|o[l>>>16&255]<<16|o[l>>>8&255]<<8|o[255&l],l^=m[s/r|0]<<24),a[s]=a[s-r]^l}for(var u=this._invKeySchedule=[],c=0;c<i;c++){var s=i-c;if(c%4)var l=a[s];else var l=a[s-4];u[c]=c<4||s<=4?l:h[o[l>>>24]]^f[o[l>>>16&255]]^d[o[l>>>8&255]]^p[o[255&l]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,s,l,u,c,o)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,h,f,d,p,a);var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,i,o,a,s){for(var l=this._nRounds,u=e[t]^r[0],c=e[t+1]^r[1],h=e[t+2]^r[2],f=e[t+3]^r[3],d=4,p=1;p<l;p++){var m=n[u>>>24]^i[c>>>16&255]^o[h>>>8&255]^a[255&f]^r[d++],v=n[c>>>24]^i[h>>>16&255]^o[f>>>8&255]^a[255&u]^r[d++],g=n[h>>>24]^i[f>>>16&255]^o[u>>>8&255]^a[255&c]^r[d++],y=n[f>>>24]^i[u>>>16&255]^o[c>>>8&255]^a[255&h]^r[d++];u=m,c=v,h=g,f=y}var m=(s[u>>>24]<<24|s[c>>>16&255]<<16|s[h>>>8&255]<<8|s[255&f])^r[d++],v=(s[c>>>24]<<24|s[h>>>16&255]<<16|s[f>>>8&255]<<8|s[255&u])^r[d++],g=(s[h>>>24]<<24|s[f>>>16&255]<<16|s[u>>>8&255]<<8|s[255&c])^r[d++],y=(s[f>>>24]<<24|s[u>>>16&255]<<16|s[c>>>8&255]<<8|s[255&h])^r[d++];e[t]=m,e[t+1]=v,e[t+2]=g,e[t+3]=y},keySize:8});t.AES=n._createHelper(v)}(),e.AES}(r(1),r(7),r(8),r(5),r(2))},function(e,t,r){e.exports=function(e){return function(){function t(e){return e<<8&4278255360|e>>>8&16711935}var r=e,n=r.lib,i=n.WordArray,o=r.enc;o.Utf16=o.Utf16BE={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i+=2){var o=t[i>>>2]>>>16-i%4*8&65535;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>1]|=e.charCodeAt(n)<<16-n%2*16;return i.create(r,2*t)}},o.Utf16LE={stringify:function(e){for(var r=e.words,n=e.sigBytes,i=[],o=0;o<n;o+=2){var a=t(r[o>>>2]>>>16-o%4*8&65535);i.push(String.fromCharCode(a))}return i.join("")},parse:function(e){for(var r=e.length,n=[],o=0;o<r;o++)n[o>>>1]|=t(e.charCodeAt(o)<<16-o%2*16);return i.create(n,2*r)}}}(),e.enc.Utf16}(r(1))},function(e,t,r){e.exports=function(e){return r=(t=e).lib,n=r.CipherParams,i=t.enc,o=i.Hex,t.format.Hex={stringify:function(e){return e.ciphertext.toString(o)},parse:function(e){var t=o.parse(e);return n.create({ciphertext:t})}},e.format.Hex;var t,r,n,i,o}(r(1),r(2))},function(e,t,r){e.exports=function(e){return function(){if("function"==typeof ArrayBuffer){var t=e,r=t.lib,n=r.WordArray,i=n.init;(n.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var t=e.byteLength,r=[],n=0;n<t;n++)r[n>>>2]|=e[n]<<24-n%4*8;i.call(this,r,t)}else i.apply(this,arguments)}).prototype=n}}(),e.lib.WordArray}(r(1))},function(e,t,r){e.exports=function(e){return e.mode.CFB=function(){function t(e,t,r,n){var i=this._iv;if(i){var o=i.slice(0);this._iv=void 0}else var o=this._prevBlock;n.encryptBlock(o,0);for(var a=0;a<r;a++)e[t+a]^=o[a]}var r=e.lib.BlockCipherMode.extend();return r.Encryptor=r.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize;t.call(this,e,r,i,n),this._prevBlock=e.slice(r,r+i)}}),r.Decryptor=r.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize,o=e.slice(r,r+i);t.call(this,e,r,i,n),this._prevBlock=o}}),r}(),e.mode.CFB}(r(1),r(2))},function(e,t,r){e.exports=function(e){return e.mode.CTRGladman=function(){function t(e){if(255==(e>>24&255)){var t=e>>16&255,r=e>>8&255,n=255&e;255===t?(t=0,255===r?(r=0,255===n?n=0:++n):++r):++t,e=0,e+=t<<16,e+=r<<8,e+=n}else e+=1<<24;return e}function r(e){return 0===(e[0]=t(e[0]))&&(e[1]=t(e[1])),e}var n=e.lib.BlockCipherMode.extend(),i=n.Encryptor=n.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,o=this._iv,a=this._counter;o&&(a=this._counter=o.slice(0),this._iv=void 0),r(a);var s=a.slice(0);n.encryptBlock(s,0);for(var l=0;l<i;l++)e[t+l]^=s[l]}});return n.Decryptor=i,n}(),e.mode.CTRGladman}(r(1),r(2))},function(e,t,r){e.exports=function(e){return e.mode.CTR=(t=e.lib.BlockCipherMode.extend(),r=t.Encryptor=t.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,i=this._iv,o=this._counter;i&&(o=this._counter=i.slice(0),this._iv=void 0);var a=o.slice(0);r.encryptBlock(a,0),o[n-1]=o[n-1]+1|0;for(var s=0;s<n;s++)e[t+s]^=a[s]}}),t.Decryptor=r,t),e.mode.CTR;var t,r}(r(1),r(2))},function(e,t,r){e.exports=function(e){return e.mode.ECB=((t=e.lib.BlockCipherMode.extend()).Encryptor=t.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),t.Decryptor=t.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),t),e.mode.ECB;var t}(r(1),r(2))},function(e,t,r){e.exports=function(e){return e.mode.OFB=(t=e.lib.BlockCipherMode.extend(),r=t.Encryptor=t.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,i=this._iv,o=this._keystream;i&&(o=this._keystream=i.slice(0),this._iv=void 0),r.encryptBlock(o,0);for(var a=0;a<n;a++)e[t+a]^=o[a]}}),t.Decryptor=r,t),e.mode.OFB;var t,r}(r(1),r(2))},function(e,t,r){e.exports=function(e){return e.pad.AnsiX923={pad:function(e,t){var r=e.sigBytes,n=4*t,i=n-r%n,o=r+i-1;e.clamp(),e.words[o>>>2]|=i<<24-o%4*8,e.sigBytes+=i},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},e.pad.Ansix923}(r(1),r(2))},function(e,t,r){e.exports=function(e){return e.pad.Iso10126={pad:function(t,r){var n=4*r,i=n-t.sigBytes%n;t.concat(e.lib.WordArray.random(i-1)).concat(e.lib.WordArray.create([i<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},e.pad.Iso10126}(r(1),r(2))},function(e,t,r){e.exports=function(e){return e.pad.Iso97971={pad:function(t,r){t.concat(e.lib.WordArray.create([2147483648],1)),e.pad.ZeroPadding.pad(t,r)},unpad:function(t){e.pad.ZeroPadding.unpad(t),t.sigBytes--}},e.pad.Iso97971}(r(1),r(2))},function(e,t,r){e.exports=function(e){return e.pad.NoPadding={pad:function(){},unpad:function(){}},e.pad.NoPadding}(r(1),r(2))},function(e,t,r){e.exports=function(e){return e.pad.ZeroPadding={pad:function(e,t){var r=4*t;e.clamp(),e.sigBytes+=r-(e.sigBytes%r||r)},unpad:function(e){for(var t=e.words,r=e.sigBytes-1;!(t[r>>>2]>>>24-r%4*8&255);)r--;e.sigBytes=r+1}},e.pad.ZeroPadding}(r(1),r(2))},function(e,t,r){e.exports=function(e){return r=(t=e).lib,n=r.Base,i=r.WordArray,o=t.algo,a=o.SHA1,s=o.HMAC,l=o.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:a,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,n=s.create(r.hasher,e),o=i.create(),a=i.create([1]),l=o.words,u=a.words,c=r.keySize,h=r.iterations;l.length<c;){var f=n.update(t).finalize(a);n.reset();for(var d=f.words,p=d.length,m=f,v=1;v<h;v++){m=n.finalize(m),n.reset();for(var g=m.words,y=0;y<p;y++)d[y]^=g[y]}o.concat(f),u[0]++}return o.sigBytes=4*c,o}}),t.PBKDF2=function(e,t,r){return l.create(r).compute(e,t)},e.PBKDF2;var t,r,n,i,o,a,s,l}(r(1),r(32),r(31))},function(e,t,r){e.exports=function(e){return function(){function t(){for(var e=this._X,t=this._C,r=0;r<8;r++)s[r]=t[r];t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<s[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<s[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<s[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<s[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<s[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<s[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<s[6]>>>0?1:0)|0,this._b=t[7]>>>0<s[7]>>>0?1:0;for(var r=0;r<8;r++){var n=e[r]+t[r],i=65535&n,o=n>>>16,a=((i*i>>>17)+i*o>>>15)+o*o,u=((4294901760&n)*n|0)+((65535&n)*n|0);l[r]=a^u}e[0]=l[0]+(l[7]<<16|l[7]>>>16)+(l[6]<<16|l[6]>>>16)|0,e[1]=l[1]+(l[0]<<8|l[0]>>>24)+l[7]|0,e[2]=l[2]+(l[1]<<16|l[1]>>>16)+(l[0]<<16|l[0]>>>16)|0,e[3]=l[3]+(l[2]<<8|l[2]>>>24)+l[1]|0,e[4]=l[4]+(l[3]<<16|l[3]>>>16)+(l[2]<<16|l[2]>>>16)|0,e[5]=l[5]+(l[4]<<8|l[4]>>>24)+l[3]|0,e[6]=l[6]+(l[5]<<16|l[5]>>>16)+(l[4]<<16|l[4]>>>16)|0,e[7]=l[7]+(l[6]<<8|l[6]>>>24)+l[5]|0}var r=e,n=r.lib,i=n.StreamCipher,o=r.algo,a=[],s=[],l=[],u=o.RabbitLegacy=i.extend({_doReset:function(){var e=this._key.words,r=this.cfg.iv,n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],i=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var o=0;o<4;o++)t.call(this);for(var o=0;o<8;o++)i[o]^=n[o+4&7];if(r){var a=r.words,s=a[0],l=a[1],u=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),c=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8),h=u>>>16|4294901760&c,f=c<<16|65535&u;i[0]^=u,i[1]^=h,i[2]^=c,i[3]^=f,i[4]^=u,i[5]^=h,i[6]^=c,i[7]^=f;for(var o=0;o<4;o++)t.call(this)}},_doProcessBlock:function(e,r){var n=this._X;t.call(this),a[0]=n[0]^n[5]>>>16^n[3]<<16,a[1]=n[2]^n[7]>>>16^n[5]<<16,a[2]=n[4]^n[1]>>>16^n[7]<<16,a[3]=n[6]^n[3]>>>16^n[1]<<16;for(var i=0;i<4;i++)a[i]=16711935&(a[i]<<8|a[i]>>>24)|4278255360&(a[i]<<24|a[i]>>>8),e[r+i]^=a[i]},blockSize:4,ivSize:2});r.RabbitLegacy=i._createHelper(u)}(),e.RabbitLegacy}(r(1),r(7),r(8),r(5),r(2))},function(e,t,r){e.exports=function(e){return function(){function t(){for(var e=this._X,t=this._C,r=0;r<8;r++)s[r]=t[r];t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<s[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<s[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<s[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<s[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<s[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<s[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<s[6]>>>0?1:0)|0,this._b=t[7]>>>0<s[7]>>>0?1:0;for(var r=0;r<8;r++){var n=e[r]+t[r],i=65535&n,o=n>>>16,a=((i*i>>>17)+i*o>>>15)+o*o,u=((4294901760&n)*n|0)+((65535&n)*n|0);l[r]=a^u}e[0]=l[0]+(l[7]<<16|l[7]>>>16)+(l[6]<<16|l[6]>>>16)|0,e[1]=l[1]+(l[0]<<8|l[0]>>>24)+l[7]|0,e[2]=l[2]+(l[1]<<16|l[1]>>>16)+(l[0]<<16|l[0]>>>16)|0,e[3]=l[3]+(l[2]<<8|l[2]>>>24)+l[1]|0,e[4]=l[4]+(l[3]<<16|l[3]>>>16)+(l[2]<<16|l[2]>>>16)|0,e[5]=l[5]+(l[4]<<8|l[4]>>>24)+l[3]|0,e[6]=l[6]+(l[5]<<16|l[5]>>>16)+(l[4]<<16|l[4]>>>16)|0,e[7]=l[7]+(l[6]<<8|l[6]>>>24)+l[5]|0}var r=e,n=r.lib,i=n.StreamCipher,o=r.algo,a=[],s=[],l=[],u=o.Rabbit=i.extend({_doReset:function(){for(var e=this._key.words,r=this.cfg.iv,n=0;n<4;n++)e[n]=16711935&(e[n]<<8|e[n]>>>24)|4278255360&(e[n]<<24|e[n]>>>8);var i=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],o=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var n=0;n<4;n++)t.call(this);for(var n=0;n<8;n++)o[n]^=i[n+4&7];if(r){var a=r.words,s=a[0],l=a[1],u=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),c=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8),h=u>>>16|4294901760&c,f=c<<16|65535&u;o[0]^=u,o[1]^=h,o[2]^=c,o[3]^=f,o[4]^=u,o[5]^=h,o[6]^=c,o[7]^=f;for(var n=0;n<4;n++)t.call(this)}},_doProcessBlock:function(e,r){var n=this._X;t.call(this),a[0]=n[0]^n[5]>>>16^n[3]<<16,a[1]=n[2]^n[7]>>>16^n[5]<<16,a[2]=n[4]^n[1]>>>16^n[7]<<16,a[3]=n[6]^n[3]>>>16^n[1]<<16;for(var i=0;i<4;i++)a[i]=16711935&(a[i]<<8|a[i]>>>24)|4278255360&(a[i]<<24|a[i]>>>8),e[r+i]^=a[i]},blockSize:4,ivSize:2});r.Rabbit=i._createHelper(u)}(),e.Rabbit}(r(1),r(7),r(8),r(5),r(2))},function(e,t,r){e.exports=function(e){return function(){function t(){for(var e=this._S,t=this._i,r=this._j,n=0,i=0;i<4;i++){r=(r+e[t=(t+1)%256])%256;var o=e[t];e[t]=e[r],e[r]=o,n|=e[(e[t]+e[r])%256]<<24-8*i}return this._i=t,this._j=r,n}var r=e,n=r.lib,i=n.StreamCipher,o=r.algo,a=o.RC4=i.extend({_doReset:function(){for(var e=this._key,t=e.words,r=e.sigBytes,n=this._S=[],i=0;i<256;i++)n[i]=i;for(var i=0,o=0;i<256;i++){var a=i%r,s=t[a>>>2]>>>24-a%4*8&255;o=(o+n[i]+s)%256;var l=n[i];n[i]=n[o],n[o]=l}this._i=this._j=0},_doProcessBlock:function(e,r){e[r]^=t.call(this)},keySize:8,ivSize:0});r.RC4=i._createHelper(a);var s=o.RC4Drop=a.extend({cfg:a.cfg.extend({drop:192}),_doReset:function(){a._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)t.call(this)}});r.RC4Drop=i._createHelper(s)}(),e.RC4}(r(1),r(7),r(8),r(5),r(2))},function(e,t,r){e.exports=function(e){return function(t){function r(e,t,r){return e^t^r}function n(e,t,r){return e&t|~e&r}function i(e,t,r){return(e|~t)^r}function o(e,t,r){return e&r|t&~r}function a(e,t,r){return e^(t|~r)}function s(e,t){return e<<t|e>>>32-t}var l=e,u=l.lib,c=u.WordArray,h=u.Hasher,f=l.algo,d=c.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),p=c.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),m=c.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),v=c.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),g=c.create([0,1518500249,1859775393,2400959708,2840853838]),y=c.create([1352829926,1548603684,1836072691,2053994217,0]),_=f.RIPEMD160=h.extend({_doReset:function(){this._hash=c.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var l=0;l<16;l++){var u=t+l,c=e[u];e[u]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}var h,f,_,w,b,x,k,A,M,S,P=this._hash.words,T=g.words,O=y.words,C=d.words,E=p.words,I=m.words,R=v.words;x=h=P[0],k=f=P[1],A=_=P[2],M=w=P[3],S=b=P[4];for(var L,l=0;l<80;l+=1)L=h+e[t+C[l]]|0,L+=l<16?r(f,_,w)+T[0]:l<32?n(f,_,w)+T[1]:l<48?i(f,_,w)+T[2]:l<64?o(f,_,w)+T[3]:a(f,_,w)+T[4],L=(L=s(L|=0,I[l]))+b|0,h=b,b=w,w=s(_,10),_=f,f=L,L=x+e[t+E[l]]|0,L+=l<16?a(k,A,M)+O[0]:l<32?o(k,A,M)+O[1]:l<48?i(k,A,M)+O[2]:l<64?n(k,A,M)+O[3]:r(k,A,M)+O[4],L=(L=s(L|=0,R[l]))+S|0,x=S,S=M,M=s(A,10),A=k,k=L;L=P[1]+_+M|0,P[1]=P[2]+w+S|0,P[2]=P[3]+b+x|0,P[3]=P[4]+h+k|0,P[4]=P[0]+f+A|0,P[0]=L},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(t.length+1),this._process();for(var i=this._hash,o=i.words,a=0;a<5;a++){var s=o[a];o[a]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}return i},clone:function(){var e=h.clone.call(this);return e._hash=this._hash.clone(),e}});l.RIPEMD160=h._createHelper(_),l.HmacRIPEMD160=h._createHmacHelper(_)}(Math),e.RIPEMD160}(r(1))},function(e,t,r){e.exports=function(e){return r=(t=e).lib,n=r.WordArray,i=t.algo,o=i.SHA256,a=i.SHA224=o.extend({_doReset:function(){this._hash=new n.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=o._doFinalize.call(this);return e.sigBytes-=4,e}}),t.SHA224=o._createHelper(a),t.HmacSHA224=o._createHmacHelper(a),e.SHA224;var t,r,n,i,o,a}(r(1),r(56))},function(e,t,r){e.exports=function(e){return function(t){var r=e,n=r.lib,i=n.WordArray,o=n.Hasher,a=r.x64,s=a.Word,l=r.algo,u=[],c=[],h=[];!function(){for(var e=1,t=0,r=0;r<24;r++){u[e+5*t]=(r+1)*(r+2)/2%64;var n=t%5,i=(2*e+3*t)%5;e=n,t=i}for(var e=0;e<5;e++)for(var t=0;t<5;t++)c[e+5*t]=t+(2*e+3*t)%5*5;for(var o=1,a=0;a<24;a++){for(var l=0,f=0,d=0;d<7;d++){if(1&o){var p=(1<<d)-1;p<32?f^=1<<p:l^=1<<p-32}128&o?o=o<<1^113:o<<=1}h[a]=s.create(l,f)}}();var f=[];!function(){for(var e=0;e<25;e++)f[e]=s.create()}();var d=l.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new s.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var r=this._state,n=this.blockSize/2,i=0;i<n;i++){var o=e[t+2*i],a=e[t+2*i+1];o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),a=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8);var s=r[i];s.high^=a,s.low^=o}for(var l=0;l<24;l++){for(var d=0;d<5;d++){for(var p=0,m=0,v=0;v<5;v++){var s=r[d+5*v];p^=s.high,m^=s.low}var g=f[d];g.high=p,g.low=m}for(var d=0;d<5;d++)for(var y=f[(d+4)%5],_=f[(d+1)%5],w=_.high,b=_.low,p=y.high^(w<<1|b>>>31),m=y.low^(b<<1|w>>>31),v=0;v<5;v++){var s=r[d+5*v];s.high^=p,s.low^=m}for(var x=1;x<25;x++){var s=r[x],k=s.high,A=s.low,M=u[x];if(M<32)var p=k<<M|A>>>32-M,m=A<<M|k>>>32-M;else var p=A<<M-32|k>>>64-M,m=k<<M-32|A>>>64-M;var S=f[c[x]];S.high=p,S.low=m}var P=f[0],T=r[0];P.high=T.high,P.low=T.low;for(var d=0;d<5;d++)for(var v=0;v<5;v++){var x=d+5*v,s=r[x],O=f[x],C=f[(d+1)%5+5*v],E=f[(d+2)%5+5*v];s.high=O.high^~C.high&E.high,s.low=O.low^~C.low&E.low}var s=r[0],I=h[l];s.high^=I.high,s.low^=I.low}},_doFinalize:function(){var e=this._data,r=e.words,n=(this._nDataBytes,8*e.sigBytes),o=32*this.blockSize;r[n>>>5]|=1<<24-n%32,r[(t.ceil((n+1)/o)*o>>>5)-1]|=128,e.sigBytes=4*r.length,this._process();for(var a=this._state,s=this.cfg.outputLength/8,l=s/8,u=[],c=0;c<l;c++){var h=a[c],f=h.high,d=h.low;f=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),d=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8),u.push(d),u.push(f)}return new i.init(u,s)},clone:function(){for(var e=o.clone.call(this),t=e._state=this._state.slice(0),r=0;r<25;r++)t[r]=t[r].clone();return e}});r.SHA3=o._createHelper(d),r.HmacSHA3=o._createHmacHelper(d)}(Math),e.SHA3}(r(1),r(15))},function(e,t,r){e.exports=function(e){return r=(t=e).x64,n=r.Word,i=r.WordArray,o=t.algo,a=o.SHA512,s=o.SHA384=a.extend({_doReset:function(){this._hash=new i.init([new n.init(3418070365,3238371032),new n.init(1654270250,914150663),new n.init(2438529370,812702999),new n.init(355462360,4144912697),new n.init(1731405415,4290775857),new n.init(2394180231,1750603025),new n.init(3675008525,1694076839),new n.init(1203062813,3204075428)])},_doFinalize:function(){var e=a._doFinalize.call(this);return e.sigBytes-=16,e}}),t.SHA384=a._createHelper(s),t.HmacSHA384=a._createHmacHelper(s),e.SHA384;var t,r,n,i,o,a,s}(r(1),r(15),r(57))},function(e,t,r){e.exports=function(e){return function(){function t(e,t){var r=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=r,this._lBlock^=r<<e}function r(e,t){var r=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=r,this._rBlock^=r<<e}var n=e,i=n.lib,o=i.WordArray,a=i.BlockCipher,s=n.algo,l=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],u=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],h=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],f=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=s.DES=a.extend({_doReset:function(){for(var e=this._key,t=e.words,r=[],n=0;n<56;n++){var i=l[n]-1;r[n]=t[i>>>5]>>>31-i%32&1}for(var o=this._subKeys=[],a=0;a<16;a++){for(var s=o[a]=[],h=c[a],n=0;n<24;n++)s[n/6|0]|=r[(u[n]-1+h)%28]<<31-n%6,s[4+(n/6|0)]|=r[28+(u[n+24]-1+h)%28]<<31-n%6;s[0]=s[0]<<1|s[0]>>>31;for(var n=1;n<7;n++)s[n]=s[n]>>>4*(n-1)+3;s[7]=s[7]<<5|s[7]>>>27}for(var f=this._invSubKeys=[],n=0;n<16;n++)f[n]=o[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,n,i){this._lBlock=e[n],this._rBlock=e[n+1],t.call(this,4,252645135),t.call(this,16,65535),r.call(this,2,858993459),r.call(this,8,16711935),t.call(this,1,1431655765);for(var o=0;o<16;o++){for(var a=i[o],s=this._lBlock,l=this._rBlock,u=0,c=0;c<8;c++)u|=h[c][((l^a[c])&f[c])>>>0];this._lBlock=l,this._rBlock=s^u}var d=this._lBlock;this._lBlock=this._rBlock,this._rBlock=d,t.call(this,1,1431655765),r.call(this,8,16711935),r.call(this,2,858993459),t.call(this,16,65535),t.call(this,4,252645135),e[n]=this._lBlock,e[n+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});n.DES=a._createHelper(d);var p=s.TripleDES=a.extend({_doReset:function(){var e=this._key,t=e.words;this._des1=d.createEncryptor(o.create(t.slice(0,2))),this._des2=d.createEncryptor(o.create(t.slice(2,4))),this._des3=d.createEncryptor(o.create(t.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});n.TripleDES=a._createHelper(p)}(),e.TripleDES}(r(1),r(7),r(8),r(5),r(2))},function(e,t,r){(function(t,n){!function(t,r){e.exports=r()}(0,function(){"use strict";function e(e){return"function"==typeof e}function i(){var e=setTimeout;return function(){return e(o,1)}}function o(){for(var e=0;e<k;e+=2)(0,I[e])(I[e+1]),I[e]=void 0,I[e+1]=void 0;k=0}function a(e,t){var r=arguments,n=this,i=new this.constructor(l);void 0===i[L]&&_(i);var o=n._state;return o?function(){var e=r[o-1];S(function(){return y(o,i,e,n._result)})}():m(n,i,e,t),i}function s(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(l);return h(t,e),t}function l(){}function u(e){try{return e.then}catch(e){return D.error=e,D}}function c(t,r,n){r.constructor===t.constructor&&n===a&&r.constructor.resolve===s?function(e,t){t._state===z?d(e,t._result):t._state===B?p(e,t._result):m(t,void 0,function(t){return h(e,t)},function(t){return p(e,t)})}(t,r):n===D?(p(t,D.error),D.error=null):void 0===n?d(t,r):e(n)?function(e,t,r){S(function(e){var n=!1,i=function(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}(r,t,function(r){n||(n=!0,t!==r?h(e,r):d(e,r))},function(t){n||(n=!0,p(e,t))},e._label);!n&&i&&(n=!0,p(e,i))},e)}(t,r,n):d(t,r)}function h(e,t){e===t?p(e,new TypeError("You cannot resolve a promise with itself")):function(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}(t)?c(e,t,u(t)):d(e,t)}function f(e){e._onerror&&e._onerror(e._result),v(e)}function d(e,t){e._state===j&&(e._result=t,e._state=z,0!==e._subscribers.length&&S(v,e))}function p(e,t){e._state===j&&(e._state=B,e._result=t,S(f,e))}function m(e,t,r,n){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+z]=r,i[o+B]=n,0===o&&e._state&&S(v,e)}function v(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,i=void 0,o=e._result,a=0;a<t.length;a+=3)n=t[a],i=t[a+r],n?y(r,n,i,o):i(o);e._subscribers.length=0}}function g(){this.error=null}function y(t,r,n,i){var o=e(n),a=void 0,s=void 0,l=void 0,u=void 0;if(o){if((a=function(e,t){try{return e(t)}catch(e){return N.error=e,N}}(n,i))===N?(u=!0,s=a.error,a.error=null):l=!0,r===a)return void p(r,new TypeError("A promises callback cannot return that same promise."))}else a=i,l=!0;r._state!==j||(o&&l?h(r,a):u?p(r,s):t===z?d(r,a):t===B&&p(r,a))}function _(e){e[L]=U++,e._state=void 0,e._result=void 0,e._subscribers=[]}function w(e,t){this._instanceConstructor=e,this.promise=new e(l),this.promise[L]||_(this.promise),x(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?d(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&d(this.promise,this._result))):p(this.promise,new Error("Array Methods must be provided an Array"))}function b(e){this[L]=U++,this._result=this._state=void 0,this._subscribers=[],l!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof b?function(e,t){try{t(function(t){h(e,t)},function(t){p(e,t)})}catch(t){p(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}var x=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},k=0,A=void 0,M=void 0,S=function(e,t){I[k]=e,I[k+1]=t,2===(k+=2)&&(M?M(o):R())},P="undefined"!=typeof window?window:void 0,T=P||{},O=T.MutationObserver||T.WebKitMutationObserver,C="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),E="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,I=new Array(1e3),R=void 0;R=C?function(){return t.nextTick(o)}:O?function(){var e=0,t=new O(o),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}():E?function(){var e=new MessageChannel;return e.port1.onmessage=o,function(){return e.port2.postMessage(0)}}():void 0===P?function(){try{var e=r(163);return void 0!==(A=e.runOnLoop||e.runOnContext)?function(){A(o)}:i()}catch(e){return i()}}():i();var L=Math.random().toString(36).substring(16),j=void 0,z=1,B=2,D=new g,N=new g,U=0;return w.prototype._enumerate=function(e){for(var t=0;this._state===j&&t<e.length;t++)this._eachEntry(e[t],t)},w.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===s){var i=u(e);if(i===a&&e._state!==j)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(r===b){var o=new r(l);c(o,e,i),this._willSettleAt(o,t)}else this._willSettleAt(new r(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},w.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===j&&(this._remaining--,e===B?p(n,r):this._result[t]=r),0===this._remaining&&d(n,this._result)},w.prototype._willSettleAt=function(e,t){var r=this;m(e,void 0,function(e){return r._settledAt(z,t,e)},function(e){return r._settledAt(B,t,e)})},b.all=function(e){return new w(this,e).promise},b.race=function(e){var t=this;return new t(x(e)?function(r,n){for(var i=e.length,o=0;o<i;o++)t.resolve(e[o]).then(r,n)}:function(e,t){return t(new TypeError("You must pass an array to race."))})},b.resolve=s,b.reject=function(e){var t=new this(l);return p(t,e),t},b._setScheduler=function(e){M=e},b._setAsap=function(e){S=e},b._asap=S,b.prototype={constructor:b,then:a,catch:function(e){return this.then(null,e)}},b.polyfill=function(){var e=void 0;if(void 0!==n)e=n;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=b},b.Promise=b,b})}).call(t,r(161),r(63))},function(e,t){t.read=function(e,t,r,n,i){var o,a,s=8*i-n-1,l=(1<<s)-1,u=l>>1,c=-7,h=r?i-1:0,f=r?-1:1,d=e[t+h];for(h+=f,o=d&(1<<-c)-1,d>>=-c,c+=s;c>0;o=256*o+e[t+h],h+=f,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;c>0;a=256*a+e[t+h],h+=f,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,n),o-=u}return(d?-1:1)*a*Math.pow(2,o-n)},t.write=function(e,t,r,n,i,o){var a,s,l,u=8*o-i-1,c=(1<<u)-1,h=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+h>=1?f/l:f*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(t*l-1)*Math.pow(2,i),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;e[r+d]=255&s,d+=p,s/=256,i-=8);for(a=a<<i|s,u+=i;u>0;e[r+d]=255&a,d+=p,a/=256,u-=8);e[r+d-p]|=128*m}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){"use strict";var n={};(0,r(4).assign)(n,r(153),r(154),r(60)),e.exports=n},function(e,t,r){"use strict";function n(e){if(!(this instanceof n))return new n(e);this.options=a.assign({level:f,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var r=o.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==h)throw new Error(l[r]);if(t.header&&o.deflateSetHeader(this.strm,t.header),t.dictionary){var i;if(i="string"==typeof t.dictionary?s.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=o.deflateSetDictionary(this.strm,i))!==h)throw new Error(l[r]);this._dict_set=!0}}function i(e,t){var r=new n(t);if(r.push(e,!0),r.err)throw r.msg;return r.result}var o=r(155),a=r(4),s=r(58),l=r(33),u=r(62),c=Object.prototype.toString,h=0,f=-1,d=0,p=8;n.prototype.push=function(e,t){var r,n,i=this.strm,l=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?4:0,"string"==typeof e?i.input=s.string2buf(e):"[object ArrayBuffer]"===c.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new a.Buf8(l),i.next_out=0,i.avail_out=l),1!==(r=o.deflate(i,n))&&r!==h)return this.onEnd(r),this.ended=!0,!1;0!==i.avail_out&&(0!==i.avail_in||4!==n&&2!==n)||("string"===this.options.to?this.onData(s.buf2binstring(a.shrinkBuf(i.output,i.next_out))):this.onData(a.shrinkBuf(i.output,i.next_out)))}while((i.avail_in>0||0===i.avail_out)&&1!==r);return 4===n?(r=o.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===h):2!==n||(this.onEnd(h),i.avail_out=0,!0)},n.prototype.onData=function(e){this.chunks.push(e)},n.prototype.onEnd=function(e){e===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=n,t.deflate=i,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,i(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,i(e,t)}},function(e,t,r){"use strict";function n(e){if(!(this instanceof n))return new n(e);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var r=o.inflateInit2(this.strm,t.windowBits);if(r!==l.Z_OK)throw new Error(u[r]);this.header=new h,o.inflateGetHeader(this.strm,this.header)}function i(e,t){var r=new n(t);if(r.push(e,!0),r.err)throw r.msg;return r.result}var o=r(158),a=r(4),s=r(58),l=r(60),u=r(33),c=r(62),h=r(156),f=Object.prototype.toString;n.prototype.push=function(e,t){var r,n,i,u,c,h,d=this.strm,p=this.options.chunkSize,m=this.options.dictionary,v=!1;if(this.ended)return!1;n=t===~~t?t:!0===t?l.Z_FINISH:l.Z_NO_FLUSH,"string"==typeof e?d.input=s.binstring2buf(e):"[object ArrayBuffer]"===f.call(e)?d.input=new Uint8Array(e):d.input=e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new a.Buf8(p),d.next_out=0,d.avail_out=p),(r=o.inflate(d,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&m&&(h="string"==typeof m?s.string2buf(m):"[object ArrayBuffer]"===f.call(m)?new Uint8Array(m):m,r=o.inflateSetDictionary(this.strm,h)),r===l.Z_BUF_ERROR&&!0===v&&(r=l.Z_OK,v=!1),r!==l.Z_STREAM_END&&r!==l.Z_OK)return this.onEnd(r),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&r!==l.Z_STREAM_END&&(0!==d.avail_in||n!==l.Z_FINISH&&n!==l.Z_SYNC_FLUSH)||("string"===this.options.to?(i=s.utf8border(d.output,d.next_out),u=d.next_out-i,c=s.buf2string(d.output,i),d.next_out=u,d.avail_out=p-u,u&&a.arraySet(d.output,d.output,i,u,0),this.onData(c)):this.onData(a.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(v=!0)}while((d.avail_in>0||0===d.avail_out)&&r!==l.Z_STREAM_END);return r===l.Z_STREAM_END&&(n=l.Z_FINISH),n===l.Z_FINISH?(r=o.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===l.Z_OK):n!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),d.avail_out=0,!0)},n.prototype.onData=function(e){this.chunks.push(e)},n.prototype.onEnd=function(e){e===l.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=n,t.inflate=i,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,i(e,t)},t.ungzip=i},function(e,t,r){"use strict";function n(e,t){return e.msg=P[t],t}function i(e){return(e<<1)-(e>4?9:0)}function o(e){for(var t=e.length;--t>=0;)e[t]=0}function a(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(k.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function s(e,t){A._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,a(e.strm)}function l(e,t){e.pending_buf[e.pending++]=t}function u(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function c(e,t,r,n){var i=e.avail_in;return i>n&&(i=n),0===i?0:(e.avail_in-=i,k.arraySet(t,e.input,e.next_in,i,r),1===e.state.wrap?e.adler=M(e.adler,t,i,r):2===e.state.wrap&&(e.adler=S(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)}function h(e,t){var r,n,i=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-re?e.strstart-(e.w_size-re):0,u=e.window,c=e.w_mask,h=e.prev,f=e.strstart+te,d=u[o+a-1],p=u[o+a];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(r=t)+a]===p&&u[r+a-1]===d&&u[r]===u[o]&&u[++r]===u[o+1]){o+=2,r++;do{}while(u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&o<f);if(n=te-(f-o),o=f-te,n>a){if(e.match_start=t,a=n,n>=s)break;d=u[o+a-1],p=u[o+a]}}}while((t=h[t&c])>l&&0!=--i);return a<=e.lookahead?a:e.lookahead}function f(e){var t,r,n,i,o,a=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=a+(a-re)){k.arraySet(e.window,e.window,a,a,0),e.match_start-=a,e.strstart-=a,e.block_start-=a,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=a?n-a:0}while(--r);t=r=a;do{n=e.prev[--t],e.prev[t]=n>=a?n-a:0}while(--r);i+=a}if(0===e.strm.avail_in)break;if(r=c(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=ee)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+ee-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<ee)););}while(e.lookahead<re&&0!==e.strm.avail_in)}function d(e,t){for(var r,n;;){if(e.lookahead<re){if(f(e),e.lookahead<re&&t===T)return he;if(0===e.lookahead)break}if(r=0,e.lookahead>=ee&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ee-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-re&&(e.match_length=h(e,r)),e.match_length>=ee)if(n=A._tr_tally(e,e.strstart-e.match_start,e.match_length-ee),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=ee){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ee-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(s(e,!1),0===e.strm.avail_out))return he}return e.insert=e.strstart<ee-1?e.strstart:ee-1,t===E?(s(e,!0),0===e.strm.avail_out?de:pe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?he:fe}function p(e,t){for(var r,n,i;;){if(e.lookahead<re){if(f(e),e.lookahead<re&&t===T)return he;if(0===e.lookahead)break}if(r=0,e.lookahead>=ee&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ee-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=ee-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-re&&(e.match_length=h(e,r),e.match_length<=5&&(e.strategy===N||e.match_length===ee&&e.strstart-e.match_start>4096)&&(e.match_length=ee-1)),e.prev_length>=ee&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-ee,n=A._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-ee),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ee-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=ee-1,e.strstart++,n&&(s(e,!1),0===e.strm.avail_out))return he}else if(e.match_available){if((n=A._tr_tally(e,0,e.window[e.strstart-1]))&&s(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return he}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=A._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<ee-1?e.strstart:ee-1,t===E?(s(e,!0),0===e.strm.avail_out?de:pe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?he:fe}function m(e,t){for(var r,n,i,o,a=e.window;;){if(e.lookahead<=te){if(f(e),e.lookahead<=te&&t===T)return he;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=ee&&e.strstart>0&&((n=a[i=e.strstart-1])===a[++i]&&n===a[++i]&&n===a[++i])){o=e.strstart+te;do{}while(n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<o);e.match_length=te-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=ee?(r=A._tr_tally(e,1,e.match_length-ee),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(s(e,!1),0===e.strm.avail_out))return he}return e.insert=0,t===E?(s(e,!0),0===e.strm.avail_out?de:pe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?he:fe}function v(e,t){for(var r;;){if(0===e.lookahead&&(f(e),0===e.lookahead)){if(t===T)return he;break}if(e.match_length=0,r=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(s(e,!1),0===e.strm.avail_out))return he}return e.insert=0,t===E?(s(e,!0),0===e.strm.avail_out?de:pe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?he:fe}function g(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function y(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=G,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new k.Buf16(2*J),this.dyn_dtree=new k.Buf16(2*(2*q+1)),this.bl_tree=new k.Buf16(2*(2*Q+1)),o(this.dyn_ltree),o(this.dyn_dtree),o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new k.Buf16($+1),this.heap=new k.Buf16(2*Z+1),o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new k.Buf16(2*Z+1),o(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function _(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=W,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?ie:ue,e.adler=2===t.wrap?0:1,t.last_flush=T,A._tr_init(t),R):n(e,j)}function w(e){var t=_(e);return t===R&&function(e){e.window_size=2*e.w_size,o(e.head),e.max_lazy_match=x[e.level].max_lazy,e.good_match=x[e.level].good_length,e.nice_match=x[e.level].nice_length,e.max_chain_length=x[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=ee-1,e.match_available=0,e.ins_h=0}(e.state),t}function b(e,t,r,i,o,a){if(!e)return j;var s=1;if(t===D&&(t=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),o<1||o>Y||r!==G||i<8||i>15||t<0||t>9||a<0||a>H)return n(e,j);8===i&&(i=9);var l=new y;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+ee-1)/ee),l.window=new k.Buf8(2*l.w_size),l.head=new k.Buf16(l.hash_size),l.prev=new k.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new k.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=a,l.method=r,w(e)}var x,k=r(4),A=r(160),M=r(59),S=r(61),P=r(33),T=0,O=1,C=3,E=4,I=5,R=0,L=1,j=-2,z=-3,B=-5,D=-1,N=1,U=2,F=3,H=4,V=0,W=2,G=8,Y=9,K=15,X=8,Z=286,q=30,Q=19,J=2*Z+1,$=15,ee=3,te=258,re=te+ee+1,ne=32,ie=42,oe=69,ae=73,se=91,le=103,ue=113,ce=666,he=1,fe=2,de=3,pe=4,me=3;x=[new g(0,0,0,0,function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(f(e),0===e.lookahead&&t===T)return he;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,s(e,!1),0===e.strm.avail_out))return he;if(e.strstart-e.block_start>=e.w_size-re&&(s(e,!1),0===e.strm.avail_out))return he}return e.insert=0,t===E?(s(e,!0),0===e.strm.avail_out?de:pe):(e.strstart>e.block_start&&(s(e,!1),e.strm.avail_out),he)}),new g(4,4,8,4,d),new g(4,5,16,8,d),new g(4,6,32,32,d),new g(4,4,16,16,p),new g(8,16,32,32,p),new g(8,16,128,128,p),new g(8,32,128,256,p),new g(32,128,258,1024,p),new g(32,258,258,4096,p)],t.deflateInit=function(e,t){return b(e,t,G,K,X,V)},t.deflateInit2=b,t.deflateReset=w,t.deflateResetKeep=_,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?j:(e.state.gzhead=t,R):j},t.deflate=function(e,t){var r,s,c,h;if(!e||!e.state||t>I||t<0)return e?n(e,j):j;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===ce&&t!==E)return n(e,0===e.avail_out?B:j);if(s.strm=e,r=s.last_flush,s.last_flush=t,s.status===ie)if(2===s.wrap)e.adler=0,l(s,31),l(s,139),l(s,8),s.gzhead?(l(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),l(s,255&s.gzhead.time),l(s,s.gzhead.time>>8&255),l(s,s.gzhead.time>>16&255),l(s,s.gzhead.time>>24&255),l(s,9===s.level?2:s.strategy>=U||s.level<2?4:0),l(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(l(s,255&s.gzhead.extra.length),l(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=S(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=oe):(l(s,0),l(s,0),l(s,0),l(s,0),l(s,0),l(s,9===s.level?2:s.strategy>=U||s.level<2?4:0),l(s,me),s.status=ue);else{var f=G+(s.w_bits-8<<4)<<8;f|=(s.strategy>=U||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(f|=ne),f+=31-f%31,s.status=ue,u(s,f),0!==s.strstart&&(u(s,e.adler>>>16),u(s,65535&e.adler)),e.adler=1}if(s.status===oe)if(s.gzhead.extra){for(c=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>c&&(e.adler=S(e.adler,s.pending_buf,s.pending-c,c)),a(e),c=s.pending,s.pending!==s.pending_buf_size));)l(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>c&&(e.adler=S(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=ae)}else s.status=ae;if(s.status===ae)if(s.gzhead.name){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=S(e.adler,s.pending_buf,s.pending-c,c)),a(e),c=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,l(s,h)}while(0!==h);s.gzhead.hcrc&&s.pending>c&&(e.adler=S(e.adler,s.pending_buf,s.pending-c,c)),0===h&&(s.gzindex=0,s.status=se)}else s.status=se;if(s.status===se)if(s.gzhead.comment){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=S(e.adler,s.pending_buf,s.pending-c,c)),a(e),c=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,l(s,h)}while(0!==h);s.gzhead.hcrc&&s.pending>c&&(e.adler=S(e.adler,s.pending_buf,s.pending-c,c)),0===h&&(s.status=le)}else s.status=le;if(s.status===le&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&a(e),s.pending+2<=s.pending_buf_size&&(l(s,255&e.adler),l(s,e.adler>>8&255),e.adler=0,s.status=ue)):s.status=ue),0!==s.pending){if(a(e),0===e.avail_out)return s.last_flush=-1,R}else if(0===e.avail_in&&i(t)<=i(r)&&t!==E)return n(e,B);if(s.status===ce&&0!==e.avail_in)return n(e,B);if(0!==e.avail_in||0!==s.lookahead||t!==T&&s.status!==ce){var d=s.strategy===U?v(s,t):s.strategy===F?m(s,t):x[s.level].func(s,t);if(d!==de&&d!==pe||(s.status=ce),d===he||d===de)return 0===e.avail_out&&(s.last_flush=-1),R;if(d===fe&&(t===O?A._tr_align(s):t!==I&&(A._tr_stored_block(s,0,0,!1),t===C&&(o(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),a(e),0===e.avail_out))return s.last_flush=-1,R}return t!==E?R:s.wrap<=0?L:(2===s.wrap?(l(s,255&e.adler),l(s,e.adler>>8&255),l(s,e.adler>>16&255),l(s,e.adler>>24&255),l(s,255&e.total_in),l(s,e.total_in>>8&255),l(s,e.total_in>>16&255),l(s,e.total_in>>24&255)):(u(s,e.adler>>>16),u(s,65535&e.adler)),a(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?R:L)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==ie&&t!==oe&&t!==ae&&t!==se&&t!==le&&t!==ue&&t!==ce?n(e,j):(e.state=null,t===ue?n(e,z):R):j},t.deflateSetDictionary=function(e,t){var r,n,i,a,s,l,u,c,h=t.length;if(!e||!e.state)return j;if(2===(a=(r=e.state).wrap)||1===a&&r.status!==ie||r.lookahead)return j;for(1===a&&(e.adler=M(e.adler,t,h,0)),r.wrap=0,h>=r.w_size&&(0===a&&(o(r.head),r.strstart=0,r.block_start=0,r.insert=0),c=new k.Buf8(r.w_size),k.arraySet(c,t,h-r.w_size,r.w_size,0),t=c,h=r.w_size),s=e.avail_in,l=e.next_in,u=e.input,e.avail_in=h,e.next_in=0,e.input=t,f(r);r.lookahead>=ee;){n=r.strstart,i=r.lookahead-(ee-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+ee-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--i);r.strstart=n,r.lookahead=ee-1,f(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=ee-1,r.match_available=0,e.next_in=l,e.input=u,e.avail_in=s,r.wrap=a,R},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,r){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,r){"use strict";e.exports=function(e,t){var r,n,i,o,a,s,l,u,c,h,f,d,p,m,v,g,y,_,w,b,x,k,A,M,S;r=e.state,n=e.next_in,M=e.input,i=n+(e.avail_in-5),o=e.next_out,S=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),l=r.dmax,u=r.wsize,c=r.whave,h=r.wnext,f=r.window,d=r.hold,p=r.bits,m=r.lencode,v=r.distcode,g=(1<<r.lenbits)-1,y=(1<<r.distbits)-1;e:do{p<15&&(d+=M[n++]<<p,p+=8,d+=M[n++]<<p,p+=8),_=m[d&g];t:for(;;){if(d>>>=w=_>>>24,p-=w,0==(w=_>>>16&255))S[o++]=65535&_;else{if(!(16&w)){if(0==(64&w)){_=m[(65535&_)+(d&(1<<w)-1)];continue t}if(32&w){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}b=65535&_,(w&=15)&&(p<w&&(d+=M[n++]<<p,p+=8),b+=d&(1<<w)-1,d>>>=w,p-=w),p<15&&(d+=M[n++]<<p,p+=8,d+=M[n++]<<p,p+=8),_=v[d&y];r:for(;;){if(d>>>=w=_>>>24,p-=w,!(16&(w=_>>>16&255))){if(0==(64&w)){_=v[(65535&_)+(d&(1<<w)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(x=65535&_,p<(w&=15)&&(d+=M[n++]<<p,(p+=8)<w&&(d+=M[n++]<<p,p+=8)),(x+=d&(1<<w)-1)>l){e.msg="invalid distance too far back",r.mode=30;break e}if(d>>>=w,p-=w,x>(w=o-a)){if((w=x-w)>c&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(k=0,A=f,0===h){if(k+=u-w,w<b){b-=w;do{S[o++]=f[k++]}while(--w);k=o-x,A=S}}else if(h<w){if(k+=u+h-w,(w-=h)<b){b-=w;do{S[o++]=f[k++]}while(--w);if(k=0,h<b){b-=w=h;do{S[o++]=f[k++]}while(--w);k=o-x,A=S}}}else if(k+=h-w,w<b){b-=w;do{S[o++]=f[k++]}while(--w);k=o-x,A=S}for(;b>2;)S[o++]=A[k++],S[o++]=A[k++],S[o++]=A[k++],b-=3;b&&(S[o++]=A[k++],b>1&&(S[o++]=A[k++]))}else{k=o-x;do{S[o++]=S[k++],S[o++]=S[k++],S[o++]=S[k++],b-=3}while(b>2);b&&(S[o++]=S[k++],b>1&&(S[o++]=S[k++]))}break}}break}}while(n<i&&o<s);n-=b=p>>3,d&=(1<<(p-=b<<3))-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=o<s?s-o+257:257-(o-s),r.hold=d,r.bits=p}},function(e,t,r){"use strict";function n(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function i(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=E,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new f.Buf32(ue),t.distcode=t.distdyn=new f.Buf32(ce),t.sane=1,t.back=-1,k):S}function o(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,i(e)):S}function a(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?S:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,o(e))):S}function s(e,t){var r,n;return e?(n=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new f.Buf16(320),this.work=new f.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=n,n.window=null,(r=a(e,t))!==k&&(e.state=null),r):S}function l(e){if(fe){var t;for(c=new f.Buf32(512),h=new f.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(v(y,e.lens,0,288,c,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;v(_,e.lens,0,32,h,0,e.work,{bits:5}),fe=!1}e.lencode=c,e.lenbits=9,e.distcode=h,e.distbits=5}function u(e,t,r,n){var i,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new f.Buf8(o.wsize)),n>=o.wsize?(f.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((i=o.wsize-o.wnext)>n&&(i=n),f.arraySet(o.window,t,r-n,i,o.wnext),(n-=i)?(f.arraySet(o.window,t,r-n,n,0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0}var c,h,f=r(4),d=r(59),p=r(61),m=r(157),v=r(159),g=0,y=1,_=2,w=4,b=5,x=6,k=0,A=1,M=2,S=-2,P=-3,T=-4,O=-5,C=8,E=1,I=2,R=3,L=4,j=5,z=6,B=7,D=8,N=9,U=10,F=11,H=12,V=13,W=14,G=15,Y=16,K=17,X=18,Z=19,q=20,Q=21,J=22,$=23,ee=24,te=25,re=26,ne=27,ie=28,oe=29,ae=30,se=31,le=32,ue=852,ce=592,he=15,fe=!0;t.inflateReset=o,t.inflateReset2=a,t.inflateResetKeep=i,t.inflateInit=function(e){return s(e,he)},t.inflateInit2=s,t.inflate=function(e,t){var r,i,o,a,s,c,h,ue,ce,he,fe,de,pe,me,ve,ge,ye,_e,we,be,xe,ke,Ae,Me,Se=0,Pe=new f.Buf8(4),Te=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return S;(r=e.state).mode===H&&(r.mode=V),s=e.next_out,o=e.output,h=e.avail_out,a=e.next_in,i=e.input,c=e.avail_in,ue=r.hold,ce=r.bits,he=c,fe=h,ke=k;e:for(;;)switch(r.mode){case E:if(0===r.wrap){r.mode=V;break}for(;ce<16;){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}if(2&r.wrap&&35615===ue){r.check=0,Pe[0]=255&ue,Pe[1]=ue>>>8&255,r.check=p(r.check,Pe,2,0),ue=0,ce=0,r.mode=I;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&ue)<<8)+(ue>>8))%31){e.msg="incorrect header check",r.mode=ae;break}if((15&ue)!==C){e.msg="unknown compression method",r.mode=ae;break}if(ce-=4,xe=8+(15&(ue>>>=4)),0===r.wbits)r.wbits=xe;else if(xe>r.wbits){e.msg="invalid window size",r.mode=ae;break}r.dmax=1<<xe,e.adler=r.check=1,r.mode=512&ue?U:H,ue=0,ce=0;break;case I:for(;ce<16;){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}if(r.flags=ue,(255&r.flags)!==C){e.msg="unknown compression method",r.mode=ae;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=ae;break}r.head&&(r.head.text=ue>>8&1),512&r.flags&&(Pe[0]=255&ue,Pe[1]=ue>>>8&255,r.check=p(r.check,Pe,2,0)),ue=0,ce=0,r.mode=R;case R:for(;ce<32;){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}r.head&&(r.head.time=ue),512&r.flags&&(Pe[0]=255&ue,Pe[1]=ue>>>8&255,Pe[2]=ue>>>16&255,Pe[3]=ue>>>24&255,r.check=p(r.check,Pe,4,0)),ue=0,ce=0,r.mode=L;case L:for(;ce<16;){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}r.head&&(r.head.xflags=255&ue,r.head.os=ue>>8),512&r.flags&&(Pe[0]=255&ue,Pe[1]=ue>>>8&255,r.check=p(r.check,Pe,2,0)),ue=0,ce=0,r.mode=j;case j:if(1024&r.flags){for(;ce<16;){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}r.length=ue,r.head&&(r.head.extra_len=ue),512&r.flags&&(Pe[0]=255&ue,Pe[1]=ue>>>8&255,r.check=p(r.check,Pe,2,0)),ue=0,ce=0}else r.head&&(r.head.extra=null);r.mode=z;case z:if(1024&r.flags&&((de=r.length)>c&&(de=c),de&&(r.head&&(xe=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),f.arraySet(r.head.extra,i,a,de,xe)),512&r.flags&&(r.check=p(r.check,i,de,a)),c-=de,a+=de,r.length-=de),r.length))break e;r.length=0,r.mode=B;case B:if(2048&r.flags){if(0===c)break e;de=0;do{xe=i[a+de++],r.head&&xe&&r.length<65536&&(r.head.name+=String.fromCharCode(xe))}while(xe&&de<c);if(512&r.flags&&(r.check=p(r.check,i,de,a)),c-=de,a+=de,xe)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=D;case D:if(4096&r.flags){if(0===c)break e;de=0;do{xe=i[a+de++],r.head&&xe&&r.length<65536&&(r.head.comment+=String.fromCharCode(xe))}while(xe&&de<c);if(512&r.flags&&(r.check=p(r.check,i,de,a)),c-=de,a+=de,xe)break e}else r.head&&(r.head.comment=null);r.mode=N;case N:if(512&r.flags){for(;ce<16;){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}if(ue!==(65535&r.check)){e.msg="header crc mismatch",r.mode=ae;break}ue=0,ce=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=H;break;case U:for(;ce<32;){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}e.adler=r.check=n(ue),ue=0,ce=0,r.mode=F;case F:if(0===r.havedict)return e.next_out=s,e.avail_out=h,e.next_in=a,e.avail_in=c,r.hold=ue,r.bits=ce,M;e.adler=r.check=1,r.mode=H;case H:if(t===b||t===x)break e;case V:if(r.last){ue>>>=7&ce,ce-=7&ce,r.mode=ne;break}for(;ce<3;){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}switch(r.last=1&ue,ce-=1,3&(ue>>>=1)){case 0:r.mode=W;break;case 1:if(l(r),r.mode=q,t===x){ue>>>=2,ce-=2;break e}break;case 2:r.mode=K;break;case 3:e.msg="invalid block type",r.mode=ae}ue>>>=2,ce-=2;break;case W:for(ue>>>=7&ce,ce-=7&ce;ce<32;){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}if((65535&ue)!=(ue>>>16^65535)){e.msg="invalid stored block lengths",r.mode=ae;break}if(r.length=65535&ue,ue=0,ce=0,r.mode=G,t===x)break e;case G:r.mode=Y;case Y:if(de=r.length){if(de>c&&(de=c),de>h&&(de=h),0===de)break e;f.arraySet(o,i,a,de,s),c-=de,a+=de,h-=de,s+=de,r.length-=de;break}r.mode=H;break;case K:for(;ce<14;){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}if(r.nlen=257+(31&ue),ue>>>=5,ce-=5,r.ndist=1+(31&ue),ue>>>=5,ce-=5,r.ncode=4+(15&ue),ue>>>=4,ce-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=ae;break}r.have=0,r.mode=X;case X:for(;r.have<r.ncode;){for(;ce<3;){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}r.lens[Te[r.have++]]=7&ue,ue>>>=3,ce-=3}for(;r.have<19;)r.lens[Te[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,Ae={bits:r.lenbits},ke=v(g,r.lens,0,19,r.lencode,0,r.work,Ae),r.lenbits=Ae.bits,ke){e.msg="invalid code lengths set",r.mode=ae;break}r.have=0,r.mode=Z;case Z:for(;r.have<r.nlen+r.ndist;){for(;ge=(Se=r.lencode[ue&(1<<r.lenbits)-1])>>>16&255,ye=65535&Se,!((ve=Se>>>24)<=ce);){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}if(ye<16)ue>>>=ve,ce-=ve,r.lens[r.have++]=ye;else{if(16===ye){for(Me=ve+2;ce<Me;){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}if(ue>>>=ve,ce-=ve,0===r.have){e.msg="invalid bit length repeat",r.mode=ae;break}xe=r.lens[r.have-1],de=3+(3&ue),ue>>>=2,ce-=2}else if(17===ye){for(Me=ve+3;ce<Me;){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}ce-=ve,xe=0,de=3+(7&(ue>>>=ve)),ue>>>=3,ce-=3}else{for(Me=ve+7;ce<Me;){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}ce-=ve,xe=0,de=11+(127&(ue>>>=ve)),ue>>>=7,ce-=7}if(r.have+de>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=ae;break}for(;de--;)r.lens[r.have++]=xe}}if(r.mode===ae)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=ae;break}if(r.lenbits=9,Ae={bits:r.lenbits},ke=v(y,r.lens,0,r.nlen,r.lencode,0,r.work,Ae),r.lenbits=Ae.bits,ke){e.msg="invalid literal/lengths set",r.mode=ae;break}if(r.distbits=6,r.distcode=r.distdyn,Ae={bits:r.distbits},ke=v(_,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,Ae),r.distbits=Ae.bits,ke){e.msg="invalid distances set",r.mode=ae;break}if(r.mode=q,t===x)break e;case q:r.mode=Q;case Q:if(c>=6&&h>=258){e.next_out=s,e.avail_out=h,e.next_in=a,e.avail_in=c,r.hold=ue,r.bits=ce,m(e,fe),s=e.next_out,o=e.output,h=e.avail_out,a=e.next_in,i=e.input,c=e.avail_in,ue=r.hold,ce=r.bits,r.mode===H&&(r.back=-1);break}for(r.back=0;ge=(Se=r.lencode[ue&(1<<r.lenbits)-1])>>>16&255,ye=65535&Se,!((ve=Se>>>24)<=ce);){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}if(ge&&0==(240&ge)){for(_e=ve,we=ge,be=ye;ge=(Se=r.lencode[be+((ue&(1<<_e+we)-1)>>_e)])>>>16&255,ye=65535&Se,!(_e+(ve=Se>>>24)<=ce);){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}ue>>>=_e,ce-=_e,r.back+=_e}if(ue>>>=ve,ce-=ve,r.back+=ve,r.length=ye,0===ge){r.mode=re;break}if(32&ge){r.back=-1,r.mode=H;break}if(64&ge){e.msg="invalid literal/length code",r.mode=ae;break}r.extra=15&ge,r.mode=J;case J:if(r.extra){for(Me=r.extra;ce<Me;){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}r.length+=ue&(1<<r.extra)-1,ue>>>=r.extra,ce-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=$;case $:for(;ge=(Se=r.distcode[ue&(1<<r.distbits)-1])>>>16&255,ye=65535&Se,!((ve=Se>>>24)<=ce);){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}if(0==(240&ge)){for(_e=ve,we=ge,be=ye;ge=(Se=r.distcode[be+((ue&(1<<_e+we)-1)>>_e)])>>>16&255,ye=65535&Se,!(_e+(ve=Se>>>24)<=ce);){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}ue>>>=_e,ce-=_e,r.back+=_e}if(ue>>>=ve,ce-=ve,r.back+=ve,64&ge){e.msg="invalid distance code",r.mode=ae;break}r.offset=ye,r.extra=15&ge,r.mode=ee;case ee:if(r.extra){for(Me=r.extra;ce<Me;){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}r.offset+=ue&(1<<r.extra)-1,ue>>>=r.extra,ce-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=ae;break}r.mode=te;case te:if(0===h)break e;if(de=fe-h,r.offset>de){if((de=r.offset-de)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=ae;break}de>r.wnext?(de-=r.wnext,pe=r.wsize-de):pe=r.wnext-de,de>r.length&&(de=r.length),me=r.window}else me=o,pe=s-r.offset,de=r.length;de>h&&(de=h),h-=de,r.length-=de;do{o[s++]=me[pe++]}while(--de);0===r.length&&(r.mode=Q);break;case re:if(0===h)break e;o[s++]=r.length,h--,r.mode=Q;break;case ne:if(r.wrap){for(;ce<32;){if(0===c)break e;c--,ue|=i[a++]<<ce,ce+=8}if(fe-=h,e.total_out+=fe,r.total+=fe,fe&&(e.adler=r.check=r.flags?p(r.check,o,fe,s-fe):d(r.check,o,fe,s-fe)),fe=h,(r.flags?ue:n(ue))!==r.check){e.msg="incorrect data check",r.mode=ae;break}ue=0,ce=0}r.mode=ie;case ie:if(r.wrap&&r.flags){for(;ce<32;){if(0===c)break e;c--,ue+=i[a++]<<ce,ce+=8}if(ue!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=ae;break}ue=0,ce=0}r.mode=oe;case oe:ke=A;break e;case ae:ke=P;break e;case se:return T;case le:default:return S}return e.next_out=s,e.avail_out=h,e.next_in=a,e.avail_in=c,r.hold=ue,r.bits=ce,(r.wsize||fe!==e.avail_out&&r.mode<ae&&(r.mode<ne||t!==w))&&u(e,e.output,e.next_out,fe-e.avail_out)?(r.mode=se,T):(he-=e.avail_in,fe-=e.avail_out,e.total_in+=he,e.total_out+=fe,r.total+=fe,r.wrap&&fe&&(e.adler=r.check=r.flags?p(r.check,o,fe,e.next_out-fe):d(r.check,o,fe,e.next_out-fe)),e.data_type=r.bits+(r.last?64:0)+(r.mode===H?128:0)+(r.mode===q||r.mode===G?256:0),(0===he&&0===fe||t===w)&&ke===k&&(ke=O),ke)},t.inflateEnd=function(e){if(!e||!e.state)return S;var t=e.state;return t.window&&(t.window=null),e.state=null,k},t.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?S:(r.head=t,t.done=!1,k):S},t.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&r.mode!==F?S:r.mode===F&&d(1,t,n,0)!==r.check?P:u(e,t,n,n)?(r.mode=se,T):(r.havedict=1,k):S},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,r){"use strict";var n=r(4),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,r,l,u,c,h,f){var d,p,m,v,g,y,_,w,b,x=f.bits,k=0,A=0,M=0,S=0,P=0,T=0,O=0,C=0,E=0,I=0,R=null,L=0,j=new n.Buf16(16),z=new n.Buf16(16),B=null,D=0;for(k=0;k<=15;k++)j[k]=0;for(A=0;A<l;A++)j[t[r+A]]++;for(P=x,S=15;S>=1&&0===j[S];S--);if(P>S&&(P=S),0===S)return u[c++]=20971520,u[c++]=20971520,f.bits=1,0;for(M=1;M<S&&0===j[M];M++);for(P<M&&(P=M),C=1,k=1;k<=15;k++)if(C<<=1,(C-=j[k])<0)return-1;if(C>0&&(0===e||1!==S))return-1;for(z[1]=0,k=1;k<15;k++)z[k+1]=z[k]+j[k];for(A=0;A<l;A++)0!==t[r+A]&&(h[z[t[r+A]]++]=A);if(0===e?(R=B=h,y=19):1===e?(R=i,L-=257,B=o,D-=257,y=256):(R=a,B=s,y=-1),I=0,A=0,k=M,g=c,T=P,O=0,m=-1,v=(E=1<<P)-1,1===e&&E>852||2===e&&E>592)return 1;for(;;){0,_=k-O,h[A]<y?(w=0,b=h[A]):h[A]>y?(w=B[D+h[A]],b=R[L+h[A]]):(w=96,b=0),d=1<<k-O,M=p=1<<T;do{u[g+(I>>O)+(p-=d)]=_<<24|w<<16|b|0}while(0!==p);for(d=1<<k-1;I&d;)d>>=1;if(0!==d?(I&=d-1,I+=d):I=0,A++,0==--j[k]){if(k===S)break;k=t[r+h[A]]}if(k>P&&(I&v)!==m){for(0===O&&(O=P),g+=M,C=1<<(T=k-O);T+O<S&&!((C-=j[T+O])<=0);)T++,C<<=1;if(E+=1<<T,1===e&&E>852||2===e&&E>592)return 1;u[m=I&v]=P<<24|T<<16|g-c|0}}return 0!==I&&(u[g+I]=k-O<<24|64<<16|0),f.bits=P,0}},function(e,t,r){"use strict";function n(e){for(var t=e.length;--t>=0;)e[t]=0}function i(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function o(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function a(e){return e<256?X[e]:X[256+(e>>>7)]}function s(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function l(e,t,r){e.bi_valid>z-r?(e.bi_buf|=t<<e.bi_valid&65535,s(e,e.bi_buf),e.bi_buf=t>>z-e.bi_valid,e.bi_valid+=r-z):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function u(e,t,r){l(e,r[2*t],r[2*t+1])}function c(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function h(e,t,r){var n,i,o=new Array(j+1),a=0;for(n=1;n<=j;n++)o[n]=a=a+r[n-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=c(o[s]++,s))}}function f(e){var t;for(t=0;t<E;t++)e.dyn_ltree[2*t]=0;for(t=0;t<I;t++)e.dyn_dtree[2*t]=0;for(t=0;t<R;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*D]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function d(e){e.bi_valid>8?s(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function p(e,t,r,n){var i=2*t,o=2*r;return e[i]<e[o]||e[i]===e[o]&&n[t]<=n[r]}function m(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&p(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!p(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function v(e,t,r){var n,i,o,s,c=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],i=e.pending_buf[e.l_buf+c],c++,0===n?u(e,i,t):(u(e,(o=Z[i])+C+1,t),0!==(s=H[o])&&l(e,i-=q[o],s),u(e,o=a(--n),r),0!==(s=V[o])&&l(e,n-=Q[o],s))}while(c<e.last_lit);u(e,D,t)}function g(e,t){var r,n,i,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=L,r=0;r<l;r++)0!==o[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):o[2*r+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=a[2*i+1]);for(t.max_code=u,r=e.heap_len>>1;r>=1;r--)m(e,o,r);i=l;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],m(e,o,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,o[2*i]=o[2*r]+o[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,o[2*r+1]=o[2*n+1]=i,e.heap[1]=i++,m(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,o,a,s,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(o=0;o<=j;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<L;r++)(o=l[2*l[2*(n=e.heap[r])+1]+1]+1)>p&&(o=p,m++),l[2*n+1]=o,n>u||(e.bl_count[o]++,a=0,n>=d&&(a=f[n-d]),s=l[2*n],e.opt_len+=s*(o+a),h&&(e.static_len+=s*(c[2*n+1]+a)));if(0!==m){do{for(o=p-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(o=p;0!==o;o--)for(n=e.bl_count[o];0!==n;)(i=e.heap[--r])>u||(l[2*i+1]!==o&&(e.opt_len+=(o-l[2*i+1])*l[2*i],l[2*i+1]=o),n--)}}(e,t),h(o,u,e.bl_count)}function y(e,t,r){var n,i,o=-1,a=t[1],s=0,l=7,u=4;for(0===a&&(l=138,u=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=t[2*(n+1)+1],++s<l&&i===a||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[2*N]++):s<=10?e.bl_tree[2*U]++:e.bl_tree[2*F]++,s=0,o=i,0===a?(l=138,u=3):i===a?(l=6,u=3):(l=7,u=4))}function _(e,t,r){var n,i,o=-1,a=t[1],s=0,c=7,h=4;for(0===a&&(c=138,h=3),n=0;n<=r;n++)if(i=a,a=t[2*(n+1)+1],!(++s<c&&i===a)){if(s<h)do{u(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(u(e,i,e.bl_tree),s--),u(e,N,e.bl_tree),l(e,s-3,2)):s<=10?(u(e,U,e.bl_tree),l(e,s-3,3)):(u(e,F,e.bl_tree),l(e,s-11,7));s=0,o=i,0===a?(c=138,h=3):i===a?(c=6,h=3):(c=7,h=4)}}function w(e,t,r,n){l(e,(S<<1)+(n?1:0),3),function(e,t,r,n){d(e),n&&(s(e,r),s(e,~r)),b.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}var b=r(4),x=4,k=0,A=1,M=2,S=0,P=1,T=2,O=29,C=256,E=C+1+O,I=30,R=19,L=2*E+1,j=15,z=16,B=7,D=256,N=16,U=17,F=18,H=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],V=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],W=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Y=new Array(2*(E+2));n(Y);var K=new Array(2*I);n(K);var X=new Array(512);n(X);var Z=new Array(256);n(Z);var q=new Array(O);n(q);var Q=new Array(I);n(Q);var J,$,ee,te=!1;t._tr_init=function(e){te||(function(){var e,t,r,n,o,a=new Array(j+1);for(r=0,n=0;n<O-1;n++)for(q[n]=r,e=0;e<1<<H[n];e++)Z[r++]=n;for(Z[r-1]=n,o=0,n=0;n<16;n++)for(Q[n]=o,e=0;e<1<<V[n];e++)X[o++]=n;for(o>>=7;n<I;n++)for(Q[n]=o<<7,e=0;e<1<<V[n]-7;e++)X[256+o++]=n;for(t=0;t<=j;t++)a[t]=0;for(e=0;e<=143;)Y[2*e+1]=8,e++,a[8]++;for(;e<=255;)Y[2*e+1]=9,e++,a[9]++;for(;e<=279;)Y[2*e+1]=7,e++,a[7]++;for(;e<=287;)Y[2*e+1]=8,e++,a[8]++;for(h(Y,E+1,a),e=0;e<I;e++)K[2*e+1]=5,K[2*e]=c(e,5);J=new i(Y,H,C+1,E,j),$=new i(K,V,0,I,j),ee=new i(new Array(0),W,0,R,B)}(),te=!0),e.l_desc=new o(e.dyn_ltree,J),e.d_desc=new o(e.dyn_dtree,$),e.bl_desc=new o(e.bl_tree,ee),e.bi_buf=0,e.bi_valid=0,f(e)},t._tr_stored_block=w,t._tr_flush_block=function(e,t,r,n){var i,o,a=0;e.level>0?(e.strm.data_type===M&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return k;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return A;for(t=32;t<C;t++)if(0!==e.dyn_ltree[2*t])return A;return k}(e)),g(e,e.l_desc),g(e,e.d_desc),a=function(e){var t;for(y(e,e.dyn_ltree,e.l_desc.max_code),y(e,e.dyn_dtree,e.d_desc.max_code),g(e,e.bl_desc),t=R-1;t>=3&&0===e.bl_tree[2*G[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=i&&(i=o)):i=o=r+5,r+4<=i&&-1!==t?w(e,t,r,n):e.strategy===x||o===i?(l(e,(P<<1)+(n?1:0),3),v(e,Y,K)):(l(e,(T<<1)+(n?1:0),3),function(e,t,r,n){var i;for(l(e,t-257,5),l(e,r-1,5),l(e,n-4,4),i=0;i<n;i++)l(e,e.bl_tree[2*G[i]+1],3);_(e,e.dyn_ltree,t-1),_(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),v(e,e.dyn_ltree,e.dyn_dtree)),f(e),n&&d(e)},t._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(Z[r]+C+1)]++,e.dyn_dtree[2*a(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){l(e,P<<1,3),u(e,D,Y),function(e){16===e.bi_valid?(s(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function i(e){if(u===setTimeout)return setTimeout(e,0);if((u===r||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function o(){p&&f&&(p=!1,f.length?d=f.concat(d):m=-1,d.length&&a())}function a(){if(!p){var e=i(o);p=!0;for(var t=d.length;t;){for(f=d,d=[];++m<t;)f&&f[m].run();m=-1,t=d.length}f=null,p=!1,function(e){if(c===clearTimeout)return clearTimeout(e);if((c===n||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}(e)}}function s(e,t){this.fun=e,this.array=t}function l(){}var u,c,h=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:r}catch(e){u=r}try{c="function"==typeof clearTimeout?clearTimeout:n}catch(e){c=n}}();var f,d=[],p=!1,m=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new s(e,t)),1!==d.length||p||i(a)},s.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=l,h.addListener=l,h.once=l,h.off=l,h.removeListener=l,h.removeAllListeners=l,h.emit=l,h.prependListener=l,h.prependOnceListener=l,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(e,t,r){e.exports=function(){return r(64)('!function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=27)}([function(t,e,n){"use strict";function r(t){return"[object Array]"===E.call(t)}function o(t){return"[object ArrayBuffer]"===E.call(t)}function i(t){return"undefined"!=typeof FormData&&t instanceof FormData}function s(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer}function u(t){return"string"==typeof t}function a(t){return"number"==typeof t}function c(t){return void 0===t}function f(t){return null!==t&&"object"==typeof t}function l(t){return"[object Date]"===E.call(t)}function p(t){return"[object File]"===E.call(t)}function h(t){return"[object Blob]"===E.call(t)}function d(t){return"[object Function]"===E.call(t)}function v(t){return f(t)&&d(t.pipe)}function m(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams}function y(t){return t.replace(/^\\s*/,"").replace(/\\s*$/,"")}function g(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)}function w(t,e){if(null!==t&&void 0!==t)if("object"==typeof t||r(t)||(t=[t]),r(t))for(var n=0,o=t.length;n<o;n++)e.call(null,t[n],n,t);else for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.call(null,t[i],i,t)}function b(){function t(t,n){"object"==typeof e[n]&&"object"==typeof t?e[n]=b(e[n],t):e[n]=t}for(var e={},n=0,r=arguments.length;n<r;n++)w(arguments[n],t);return e}function _(t,e,n){return w(e,function(e,r){t[r]=n&&"function"==typeof e?x(e,n):e}),t}var x=n(7),A=n(29),E=Object.prototype.toString;t.exports={isArray:r,isArrayBuffer:o,isBuffer:A,isFormData:i,isArrayBufferView:s,isString:u,isNumber:a,isObject:f,isUndefined:c,isDate:l,isFile:p,isBlob:h,isFunction:d,isStream:v,isURLSearchParams:m,isStandardBrowserEnv:g,forEach:w,merge:b,extend:_,trim:y}},function(t,e,n){"use strict";(function(e){function r(t,e){!o.isUndefined(t)&&o.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var o=n(0),i=n(24),s={"Content-Type":"application/x-www-form-urlencoded"},u={adapter:function(){var t;return"undefined"!=typeof XMLHttpRequest?t=n(3):void 0!==e&&(t=n(3)),t}(),transformRequest:[function(t,e){return i(e,"Content-Type"),o.isFormData(t)||o.isArrayBuffer(t)||o.isBuffer(t)||o.isStream(t)||o.isFile(t)||o.isBlob(t)?t:o.isArrayBufferView(t)?t.buffer:o.isURLSearchParams(t)?(r(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):o.isObject(t)?(r(e,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(t){return t>=200&&t<300}};u.headers={common:{Accept:"application/json, text/plain, */*"}},o.forEach(["delete","get","head"],function(t){u.headers[t]={}}),o.forEach(["post","put","patch"],function(t){u.headers[t]=o.merge(s)}),t.exports=u}).call(e,n(2))},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(f===setTimeout)return setTimeout(t,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(t,0);try{return f(t,0)}catch(e){try{return f.call(null,t,0)}catch(e){return f.call(this,t,0)}}}function i(t){if(l===clearTimeout)return clearTimeout(t);if((l===r||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}function s(){v&&h&&(v=!1,h.length?d=h.concat(d):m=-1,d.length&&u())}function u(){if(!v){var t=o(s);v=!0;for(var e=d.length;e;){for(h=d,d=[];++m<e;)h&&h[m].run();m=-1,e=d.length}h=null,v=!1,i(t)}}function a(t,e){this.fun=t,this.array=e}function c(){}var f,l,p=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(t){f=n}try{l="function"==typeof clearTimeout?clearTimeout:r}catch(t){l=r}}();var h,d=[],v=!1,m=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];d.push(new a(t,e)),1!==d.length||v||o(u)},a.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.prependListener=c,p.prependOnceListener=c,p.listeners=function(t){return[]},p.binding=function(t){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(t){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(t,e,n){"use strict";(function(e){var r=n(0),o=n(16),i=n(19),s=n(25),u=n(23),a=n(6),c="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||n(18);t.exports=function(t){return new Promise(function(f,l){var p=t.data,h=t.headers;r.isFormData(p)&&delete h["Content-Type"];var d=new XMLHttpRequest,v="onreadystatechange",m=!1;if("test"===e.env.NODE_ENV||"undefined"==typeof window||!window.XDomainRequest||"withCredentials"in d||u(t.url)||(d=new window.XDomainRequest,v="onload",m=!0,d.onprogress=function(){},d.ontimeout=function(){}),t.auth){var y=t.auth.username||"",g=t.auth.password||"";h.Authorization="Basic "+c(y+":"+g)}if(d.open(t.method.toUpperCase(),i(t.url,t.params,t.paramsSerializer),!0),d.timeout=t.timeout,d[v]=function(){if(d&&(4===d.readyState||m)&&(0!==d.status||d.responseURL&&0===d.responseURL.indexOf("file:"))){var e="getAllResponseHeaders"in d?s(d.getAllResponseHeaders()):null,n=t.responseType&&"text"!==t.responseType?d.response:d.responseText,r={data:n,status:1223===d.status?204:d.status,statusText:1223===d.status?"No Content":d.statusText,headers:e,config:t,request:d};o(f,l,r),d=null}},d.onerror=function(){l(a("Network Error",t,null,d)),d=null},d.ontimeout=function(){l(a("timeout of "+t.timeout+"ms exceeded",t,"ECONNABORTED",d)),d=null},r.isStandardBrowserEnv()){var w=n(21),b=(t.withCredentials||u(t.url))&&t.xsrfCookieName?w.read(t.xsrfCookieName):void 0;b&&(h[t.xsrfHeaderName]=b)}if("setRequestHeader"in d&&r.forEach(h,function(t,e){void 0===p&&"content-type"===e.toLowerCase()?delete h[e]:d.setRequestHeader(e,t)}),t.withCredentials&&(d.withCredentials=!0),t.responseType)try{d.responseType=t.responseType}catch(e){if("json"!==t.responseType)throw e}"function"==typeof t.onDownloadProgress&&d.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&d.upload&&d.upload.addEventListener("progress",t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then(function(t){d&&(d.abort(),l(t),d=null)}),void 0===p&&(p=null),d.send(p)})}}).call(e,n(2))},function(t,e,n){"use strict";function r(t){this.message=t}r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,t.exports=r},function(t,e,n){"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}},function(t,e,n){"use strict";var r=n(15);t.exports=function(t,e,n,o,i){var s=new Error(t);return r(s,e,n,o,i)}},function(t,e,n){"use strict";t.exports=function(t,e){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return t.apply(e,n)}}},function(t,e,n){t.exports=n(10)},function(t,e,n){"use strict";t.exports=n(28).polyfill()},function(t,e,n){"use strict";function r(t){var e=new s(t),n=i(s.prototype.request,e);return o.extend(n,s.prototype,e),o.extend(n,e),n}var o=n(0),i=n(7),s=n(12),u=n(1),a=r(u);a.Axios=s,a.create=function(t){return r(o.merge(u,t))},a.Cancel=n(4),a.CancelToken=n(11),a.isCancel=n(5),a.all=function(t){return Promise.all(t)},a.spread=n(26),t.exports=a,t.exports.default=a},function(t,e,n){"use strict";function r(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(t){e=t});var n=this;t(function(t){n.reason||(n.reason=new o(t),e(n.reason))})}var o=n(4);r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.source=function(){var t;return{token:new r(function(e){t=e}),cancel:t}},t.exports=r},function(t,e,n){"use strict";function r(t){this.defaults=t,this.interceptors={request:new s,response:new s}}var o=n(1),i=n(0),s=n(13),u=n(14),a=n(22),c=n(20);r.prototype.request=function(t){"string"==typeof t&&(t=i.merge({url:arguments[0]},arguments[1])),t=i.merge(o,this.defaults,{method:"get"},t),t.method=t.method.toLowerCase(),t.baseURL&&!a(t.url)&&(t.url=c(t.baseURL,t.url));var e=[u,void 0],n=Promise.resolve(t);for(this.interceptors.request.forEach(function(t){e.unshift(t.fulfilled,t.rejected)}),this.interceptors.response.forEach(function(t){e.push(t.fulfilled,t.rejected)});e.length;)n=n.then(e.shift(),e.shift());return n},i.forEach(["delete","get","head","options"],function(t){r.prototype[t]=function(e,n){return this.request(i.merge(n||{},{method:t,url:e}))}}),i.forEach(["post","put","patch"],function(t){r.prototype[t]=function(e,n,r){return this.request(i.merge(r||{},{method:t,url:e,data:n}))}}),t.exports=r},function(t,e,n){"use strict";function r(){this.handlers=[]}var o=n(0);r.prototype.use=function(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},r.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},r.prototype.forEach=function(t){o.forEach(this.handlers,function(e){null!==e&&t(e)})},t.exports=r},function(t,e,n){"use strict";function r(t){t.cancelToken&&t.cancelToken.throwIfRequested()}var o=n(0),i=n(17),s=n(5),u=n(1);t.exports=function(t){return r(t),t.headers=t.headers||{},t.data=i(t.data,t.headers,t.transformRequest),t.headers=o.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),o.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),(t.adapter||u.adapter)(t).then(function(e){return r(t),e.data=i(e.data,e.headers,t.transformResponse),e},function(e){return s(e)||(r(t),e&&e.response&&(e.response.data=i(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})}},function(t,e,n){"use strict";t.exports=function(t,e,n,r,o){return t.config=e,n&&(t.code=n),t.request=r,t.response=o,t}},function(t,e,n){"use strict";var r=n(6);t.exports=function(t,e,n){var o=n.config.validateStatus;n.status&&o&&!o(n.status)?e(r("Request failed with status code "+n.status,n.config,null,n.request,n)):t(n)}},function(t,e,n){"use strict";var r=n(0);t.exports=function(t,e,n){return r.forEach(n,function(n){t=n(t,e)}),t}},function(t,e,n){"use strict";function r(){this.message="String contains an invalid character"}function o(t){for(var e,n,o=String(t),s="",u=0,a=i;o.charAt(0|u)||(a="=",u%1);s+=a.charAt(63&e>>8-u%1*8)){if((n=o.charCodeAt(u+=.75))>255)throw new r;e=e<<8|n}return s}var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.prototype=new Error,r.prototype.code=5,r.prototype.name="InvalidCharacterError",t.exports=o},function(t,e,n){"use strict";function r(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var o=n(0);t.exports=function(t,e,n){if(!e)return t;var i;if(n)i=n(e);else if(o.isURLSearchParams(e))i=e.toString();else{var s=[];o.forEach(e,function(t,e){null!==t&&void 0!==t&&(o.isArray(t)&&(e+="[]"),o.isArray(t)||(t=[t]),o.forEach(t,function(t){o.isDate(t)?t=t.toISOString():o.isObject(t)&&(t=JSON.stringify(t)),s.push(r(e)+"="+r(t))}))}),i=s.join("&")}return i&&(t+=(-1===t.indexOf("?")?"?":"&")+i),t}},function(t,e,n){"use strict";t.exports=function(t,e){return e?t.replace(/\\/+$/,"")+"/"+e.replace(/^\\/+/,""):t}},function(t,e,n){"use strict";var r=n(0);t.exports=r.isStandardBrowserEnv()?function(){return{write:function(t,e,n,o,i,s){var u=[];u.push(t+"="+encodeURIComponent(e)),r.isNumber(n)&&u.push("expires="+new Date(n).toGMTString()),r.isString(o)&&u.push("path="+o),r.isString(i)&&u.push("domain="+i),!0===s&&u.push("secure"),document.cookie=u.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}()},function(t,e,n){"use strict";t.exports=function(t){return/^([a-z][a-z\\d\\+\\-\\.]*:)?\\/\\//i.test(t)}},function(t,e,n){"use strict";var r=n(0);t.exports=r.isStandardBrowserEnv()?function(){function t(t){var e=t;return n&&(o.setAttribute("href",e),e=o.href),o.setAttribute("href",e),{href:o.href,protocol:o.protocol?o.protocol.replace(/:$/,""):"",host:o.host,search:o.search?o.search.replace(/^\\?/,""):"",hash:o.hash?o.hash.replace(/^#/,""):"",hostname:o.hostname,port:o.port,pathname:"/"===o.pathname.charAt(0)?o.pathname:"/"+o.pathname}}var e,n=/(msie|trident)/i.test(navigator.userAgent),o=document.createElement("a");return e=t(window.location.href),function(n){var o=r.isString(n)?t(n):n;return o.protocol===e.protocol&&o.host===e.host}}():function(){return function(){return!0}}()},function(t,e,n){"use strict";var r=n(0);t.exports=function(t,e){r.forEach(t,function(n,r){r!==e&&r.toUpperCase()===e.toUpperCase()&&(t[e]=n,delete t[r])})}},function(t,e,n){"use strict";var r=n(0);t.exports=function(t){var e,n,o,i={};return t?(r.forEach(t.split("\\n"),function(t){o=t.indexOf(":"),e=r.trim(t.substr(0,o)).toLowerCase(),n=r.trim(t.substr(o+1)),e&&(i[e]=i[e]?i[e]+", "+n:n)}),i):i}},function(t,e,n){"use strict";t.exports=function(t){return function(e){return t.apply(null,e)}}},function(t,e,n){"use strict";var r=n(8),o=function(t){return t&&t.__esModule?t:{default:t}}(r);n(9),onmessage=function(t){function e(){var t=c?{texData:n(f,f),cntWhite:f*f,pack_mask:{poly_num:0,height:f,width:f,data:[0,f*f]}}:{texData:null},e=[];return e.push(t),{dataset:u.dataset,usage:u.usage,status:"failed",data:e}}function n(t,e){return new Uint8Array(t*e*4).fill(255)}function r(t){for(var e=t.width,n=t.height,r=t.data,o=new Uint8ClampedArray(e*n*4),i=0,s=!1,u=0,a=0,c=0;c<r.length;++c){var f=r[c],l=function(t,n,r,i){for(var s=r,u=t,a=n,c=4*(u*e+a);s--;)o[c]=o[c+1]=o[c+2]=o[c+3]=i,c+=4,++a===e&&(u++,a=0);return{row:u,col:a}}(u,a,f,s?255:0);u=l.row,a=l.col,i+=!0===s?1:0,s=!s}return{rgba:o,cntWhite:i}}function i(t,e,n,r){for(var o=Math.floor(e*r),i=Math.floor(n*r),s=o*i*4,u=new Uint8ClampedArray(s),a=0,c=0,f=0,l=0;l<i;++l)for(var p=0;p<o;++p)c=4*(l*o+p),f=4*(l/r*e+p/r),u[c]=t[f],u[c+1]=t[f+1],u[c+2]=t[f+2],u[c+3]=t[f+3],a+=0!==u[c]?1:0;return{rgba:u,cntWhite:a}}var s=t.data.isDebug,u={dataset:t.data.dataset,usage:t.data.usage},a=t.data.baseURL,c=t.data.edit,f=t.data.maskSize,l={headers:{"Content-Type":"application/json; charset=UTF-8"},credentials:"include"};s&&console.log("post api",a,u),o.default.post(a+"/api/mask/get_all",u,l).then(function(t){var n=t.data;if(s&&console.log("Worker::get res data",n),"success"===n.status){var o=n.summary.maskInfos;if(o.length>0){for(var a=0;a<o.length;++a){var l=o[a].pack_mask,p=l.width,h=l.height,d=r(l);if(p!==f){var v=f/p,m=i(d.rgba,p,h,v);d.rgba=[],d.rgba=m.rgba,d.cntWhite=m.cntWhite}var y=new Uint8Array(d.rgba,1);o[a].texData=y,o[a].cntWhite=d.cntWhite,c?o[a].rgba=d.rgba:(l.data=[],l=void 0)}postMessage({dataset:u.dataset,usage:u.usage,status:"success",data:o})}else console.warn("download all mask error"),postMessage(e())}else postMessage(e())}).catch(function(t){postMessage(e())})},onerror=function(t){throw console.error("MaskLoader error",t),t}},function(t,e,n){(function(e,r){!function(e,n){t.exports=n()}(0,function(){"use strict";function t(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}function o(t){return"function"==typeof t}function i(t){z=t}function s(t){V=t}function u(){return void 0!==X?function(){X(c)}:a()}function a(){var t=setTimeout;return function(){return t(c,1)}}function c(){for(var t=0;t<I;t+=2){(0,Q[t])(Q[t+1]),Q[t]=void 0,Q[t+1]=void 0}I=0}function f(t,e){var n=arguments,r=this,o=new this.constructor(p);void 0===o[tt]&&O(o);var i=r._state;return i?function(){var t=n[i-1];V(function(){return j(i,o,t,r._result)})}():E(r,o,t,e),o}function l(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(p);return b(n,t),n}function p(){}function h(){return new TypeError("You cannot resolve a promise with itself")}function d(){return new TypeError("A promises callback cannot return that same promise.")}function v(t){try{return t.then}catch(t){return ot.error=t,ot}}function m(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}function y(t,e,n){V(function(t){var r=!1,o=m(n,e,function(n){r||(r=!0,e!==n?b(t,n):x(t,n))},function(e){r||(r=!0,A(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,A(t,o))},t)}function g(t,e){e._state===nt?x(t,e._result):e._state===rt?A(t,e._result):E(e,void 0,function(e){return b(t,e)},function(e){return A(t,e)})}function w(t,e,n){e.constructor===t.constructor&&n===f&&e.constructor.resolve===l?g(t,e):n===ot?(A(t,ot.error),ot.error=null):void 0===n?x(t,e):o(n)?y(t,e,n):x(t,e)}function b(e,n){e===n?A(e,h()):t(n)?w(e,n,v(n)):x(e,n)}function _(t){t._onerror&&t._onerror(t._result),T(t)}function x(t,e){t._state===et&&(t._result=e,t._state=nt,0!==t._subscribers.length&&V(T,t))}function A(t,e){t._state===et&&(t._state=rt,t._result=e,V(_,t))}function E(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+nt]=n,o[i+rt]=r,0===i&&t._state&&V(T,t)}function T(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,o=void 0,i=t._result,s=0;s<e.length;s+=3)r=e[s],o=e[s+n],r?j(n,r,o,i):o(i);t._subscribers.length=0}}function S(){this.error=null}function C(t,e){try{return t(e)}catch(t){return it.error=t,it}}function j(t,e,n,r){var i=o(n),s=void 0,u=void 0,a=void 0,c=void 0;if(i){if(s=C(n,r),s===it?(c=!0,u=s.error,s.error=null):a=!0,e===s)return void A(e,d())}else s=r,a=!0;e._state!==et||(i&&a?b(e,s):c?A(e,u):t===nt?x(e,s):t===rt&&A(e,s))}function R(t,e){try{e(function(e){b(t,e)},function(e){A(t,e)})}catch(e){A(t,e)}}function L(){return st++}function O(t){t[tt]=st++,t._state=void 0,t._result=void 0,t._subscribers=[]}function k(t,e){this._instanceConstructor=t,this.promise=new t(p),this.promise[tt]||O(this.promise),H(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?x(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&x(this.promise,this._result))):A(this.promise,U())}function U(){return new Error("Array Methods must be provided an Array")}function B(t){return new k(this,t).promise}function P(t){var e=this;return new e(H(t)?function(n,r){for(var o=t.length,i=0;i<o;i++)e.resolve(t[i]).then(n,r)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function D(t){var e=this,n=new e(p);return A(n,t),n}function N(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function q(){throw new TypeError("Failed to construct \'Promise\': Please use the \'new\' operator, this object constructor cannot be called as a function.")}function M(t){this[tt]=L(),this._result=this._state=void 0,this._subscribers=[],p!==t&&("function"!=typeof t&&N(),this instanceof M?R(this,t):q())}function F(){var t=void 0;if(void 0!==r)t=r;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=M}var W=void 0;W=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var H=W,I=0,X=void 0,z=void 0,V=function(t,e){Q[I]=t,Q[I+1]=e,2===(I+=2)&&(z?z(c):Z())},J="undefined"!=typeof window?window:void 0,K=J||{},Y=K.MutationObserver||K.WebKitMutationObserver,$="undefined"==typeof self&&void 0!==e&&"[object process]"==={}.toString.call(e),G="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Q=new Array(1e3),Z=void 0;Z=$?function(){return function(){return e.nextTick(c)}}():Y?function(){var t=0,e=new Y(c),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}():G?function(){var t=new MessageChannel;return t.port1.onmessage=c,function(){return t.port2.postMessage(0)}}():void 0===J?function(){try{var t=n(31);return X=t.runOnLoop||t.runOnContext,u()}catch(t){return a()}}():a();var tt=Math.random().toString(36).substring(16),et=void 0,nt=1,rt=2,ot=new S,it=new S,st=0;return k.prototype._enumerate=function(t){for(var e=0;this._state===et&&e<t.length;e++)this._eachEntry(t[e],e)},k.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===l){var o=v(t);if(o===f&&t._state!==et)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(n===M){var i=new n(p);w(i,t,o),this._willSettleAt(i,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},k.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===et&&(this._remaining--,t===rt?A(r,n):this._result[e]=n),0===this._remaining&&x(r,this._result)},k.prototype._willSettleAt=function(t,e){var n=this;E(t,void 0,function(t){return n._settledAt(nt,e,t)},function(t){return n._settledAt(rt,e,t)})},M.all=B,M.race=P,M.resolve=l,M.reject=D,M._setScheduler=i,M._setAsap=s,M._asap=V,M.prototype={constructor:M,then:f,catch:function(t){return this.then(null,t)}},M.polyfill=F,M.Promise=M,M})}).call(e,n(2),n(30))},function(t,e){function n(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function r(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&n(t.slice(0,0))}t.exports=function(t){return null!=t&&(n(t)||r(t)||!!t._isBuffer)}},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){}]);\n//# sourceMappingURL=MaskLoader.js.map',r.p+"MaskLoader.js")}},function(e,t){}])},e.exports=n(r(0),r(9))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,factory;factory=function(module,exports,_three,_LngLatAlt,_HyperNode2,_PMatrix,_EarthConstants,_EarthMath,_HelperFunctions,_TransformControls){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _LngLatAlt2=_interopRequireDefault(_LngLatAlt),_HyperNode3=_interopRequireDefault(_HyperNode2),_PMatrix2=_interopRequireDefault(_PMatrix),_EarthConstants2=_interopRequireDefault(_EarthConstants),_EarthMath2=_interopRequireDefault(_EarthMath),_TransformControls2=_interopRequireDefault(_TransformControls);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var _get=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Marker=function(_HyperNode){function Marker(markerOptions){_classCallCheck(this,Marker);var debug=!1;debug&&console.log("Marker constructor");var __position=markerOptions.pose&&markerOptions.pose.position?markerOptions.pose.position:markerOptions.position,__orientation=markerOptions.pose&&markerOptions.pose.orientation?markerOptions.pose.orientation:markerOptions.orientation,__scale=markerOptions.pose&&markerOptions.pose.scale?markerOptions.pose.scale:markerOptions.scale,_ret;if(markerOptions.pose&&(markerOptions.pose.position=__position,markerOptions.pose.orientation=__orientation,markerOptions.pose.scale=__scale),markerOptions.position=__position,markerOptions.orientation=__orientation,markerOptions.scale=__scale,markerOptions=defaultVal(markerOptions),markerOptions.sandbox&&!markerOptions.earth&&(markerOptions.earth=markerOptions.sandbox),null===markerOptions.earth)return console.error("Marker constructor is not assigned with an earth"),_ret=void 0,_possibleConstructorReturn(_this,_ret);var _this=_possibleConstructorReturn(this,(Marker.__proto__||Object.getPrototypeOf(Marker)).call(this,markerOptions.earth.markerLayer));_this._position=markerOptions.position,markerOptions.orientation?_this._orientation=new _three.Quaternion(markerOptions.orientation.x,markerOptions.orientation.y,markerOptions.orientation.z,markerOptions.orientation.w):_this._orientation=new _three.Quaternion,_this._scale=markerOptions.scale,_this.earth=markerOptions.earth,_this._name=markerOptions.name,_this.shapeHolder=new _three.Object3D,_this.shapeHolder.name=_this._name+" shapeHolder",_this.sceneNode.add(_this.shapeHolder),_this.shapeHolder.visible=markerOptions.visible,markerOptions.showXYZ&&_this.shapeHolder.add(_this._XYZ(markerOptions.showXYZ)),_this.contentHolder=new _three.Object3D,_this.shapeHolder.add(_this.contentHolder),_this.decoHolder=new _three.Object3D,_this.shapeHolder.add(_this.decoHolder),_this._interactShape=null,_this._interactable=!1,void 0!==markerOptions.clickable&&(_this.clickable=markerOptions.clickable),_this.interactable=markerOptions.interactable,_this.ready4Interaction=!1,_this.animationTime=0;var _onClick=void 0,_onMouseOver=void 0,_onMouseEnter=void 0,_onMouseLeave=void 0,_onMouseDrag=void 0;if(markerOptions.eventHandlers&&(_onClick=markerOptions.eventHandlers._onClick?eval("("+markerOptions.eventHandlers._onClick+")"):null,_onMouseOver=markerOptions.eventHandlers._onMouseOver?eval("("+markerOptions.eventHandlers._onMouseOver+")"):null,_onMouseEnter=markerOptions.eventHandlers._onMouseEnter?eval("("+markerOptions.eventHandlers._onMouseEnter+")"):null,_onMouseLeave=markerOptions.eventHandlers._onMouseLeave?eval("("+markerOptions.eventHandlers._onMouseLeave+")"):null,_onMouseDrag=markerOptions.eventHandlers._onMouseDrag?eval("("+markerOptions.eventHandlers._onMouseDrag+")"):null),_this.eventHandlers={_onClick:_onClick,_onMouseOver:_onMouseOver,_onMouseEnter:_onMouseEnter,_onMouseLeave:_onMouseLeave,_onMouseDrag:_onMouseDrag},null===Marker.control&&(Marker.control=new _TransformControls2.default(_this.earth.earthView.camera,_this.earth.domElement)),_this._property.type="Marker",_this._property.pose={position:_this._position,orientation:_this._orientation,scale:_this._scale},_this._property.name=_this._name,_this._property.materialDescriptions=markerOptions.materialDescriptions?markerOptions.materialDescriptions:[],_this._property.patrolRoutes=markerOptions.patrolRoutes||[],_this._property.interactable=_this.interactable,_this._property.eventHandlers={_onClick:_this.eventHandlers._onClick?_this.eventHandlers._onClick.toString():null,_onMouseOver:_this.eventHandlers._onMouseOver?_this.eventHandlers._onMouseOver.toString():null,_onMouseEnter:_this.eventHandlers._onMouseEnter?_this.eventHandlers._onMouseEnter.toString():null,_onMouseLeave:_this.eventHandlers._onMouseLeave?_this.eventHandlers._onMouseLeave.toString():null,_onMouseDrag:_this.eventHandlers._onMouseDrag?_this.eventHandlers._onMouseDrag.toString():null},_this._property.patrolRoutes[0]){var patrol=_this._property.patrolRoutes[0];patrol.startTime&&setTimeout(function(){return _this.playAnimation(0,patrol.loop)},patrol.startTime)}function defaultVal(e){return void 0===e&&(e={}),void 0===e.position&&(e.position=new _LngLatAlt2.default),void 0===e.visible&&(e.visible=!0),void 0===e.earth&&(e.earth=null),void 0===e.name&&(e.name="unknown"),void 0===e.interactable&&(e.interactable=!1),e}return _this.setPose(_this._position,_this._orientation,_this._scale),_this}return _inherits(Marker,_HyperNode),_createClass(Marker,[{key:"destruct",value:function(){this.interactable&&(this.interactable=!1),this.needRemoveSelfRef&&this.removeSelfRef&&this.removeSelfRef(),_get(Marker.prototype.__proto__||Object.getPrototypeOf(Marker.prototype),"destruct",this).call(this)}},{key:"_interactBox",value:function(){if(!this.interactShape)return[];if(this.interactShape.isSprite){var e=Math.max(this.interactShape.scale.x,this.interactShape.scale.y),t=_EarthConstants2.default.EARTH_RADIUS/_EarthConstants2.default.scale*e/2,r=this.interactShape.position.z*_EarthConstants2.default.EARTH_RADIUS/_EarthConstants2.default.scale;return[new _three.Vector3(t,t,t+r),new _three.Vector3(t,-t,t+r),new _three.Vector3(-t,t,t+r),new _three.Vector3(-t,-t,t+r),new _three.Vector3(t,t,-t+r),new _three.Vector3(t,-t,-t+r),new _three.Vector3(-t,t,-t+r),new _three.Vector3(-t,-t,-t+r)]}if(!this.interactShape.geometry)return[];if(this.interactShape.geometry.computeBoundingBox(),!this.interactShape.geometry.boundingBox)return[];var n=this.interactShape.geometry.boundingBox,i=[new _three.Vector3(n.max.x,n.max.y,n.max.z),new _three.Vector3(n.min.x,n.max.y,n.max.z),new _three.Vector3(n.max.x,n.min.y,n.max.z),new _three.Vector3(n.max.x,n.max.y,n.min.z),new _three.Vector3(n.max.x,n.min.y,n.min.z),new _three.Vector3(n.min.x,n.max.y,n.min.z),new _three.Vector3(n.min.x,n.min.y,n.max.z),new _three.Vector3(n.min.x,n.min.y,n.min.z)],o=this.interactShape.scale,a=Math.max.apply(Math,[o.x,o.y,o.z]),s=_EarthConstants2.default.EARTH_RADIUS/_EarthConstants2.default.scale*a*this.scale;return i=i.map(function(e){return e.applyMatrix4((new _three.Matrix4).makeScale(s,s,s))})}},{key:"orientationByHorizontalPoints",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={lng:0,lat:0,alt:0},n=0;n<e.length;++n)r.lng+=e[n].lng,r.lat+=e[n].lat,r.alt+=e[n].alt;r.lng/=e.length,r.lat/=e.length,r.alt/=e.length;var i=_EarthMath2.default.getLocalSystemOnEarthSurface(_EarthConstants2.default.EarthResolution,r.lng,r.lat,_EarthConstants2.default.scale),o=function(e){var t=new _three.Vector3;e.map(function(e){t.add(e)}),t.multiplyScalar(1/e.length);var r=0,n=0,i=0,o=0,a=0,s=0;e.map(function(e){var l=e.clone().sub(t);r+=l.x*l.x,n+=l.x*l.y,i+=l.x*l.z,o+=l.y*l.y,a+=l.y*l.z,s+=l.z*l.z}),r/=e.length,n/=e.length,i/=e.length,o/=e.length,a/=e.length,s/=e.length;var l=new _three.Vector3(0,0,0),u=void 0,c=void 0,h=o*s-a*a;u=new _three.Vector3(h,i*a-n*s,n*a-i*o),c=h*h,l.dot(u)<0&&(c=-c);l.add(u.multiplyScalar(c));var f=r*s-i*i;u=new _three.Vector3(i*a-n*s,f,n*i-a*r),c=f*f,l.dot(u)<0&&(c=-c);l.add(u.multiplyScalar(c));var d=r*o-n*n;u=new _three.Vector3(n*a-i*o,n*i-a*r,d),c=d*d,l.dot(u)<0&&(c=-c);return l.add(u.multiplyScalar(c)),l.normalize()}(e.map(function(e){return function(e,t){var r=_EarthMath2.default.getNoneGroundCartesianFromLngLatAlt(_EarthConstants2.default.EarthResolution,t.lng,t.lat,t.alt,_EarthConstants2.default.scale).clone().sub(e.origin),n=1*r.dot(e.lng),i=1*r.dot(e.lat),o=1*r.dot(e.alt);return new _three.Vector3(n,i,o)}(i,e)}));if(o){o=o.normalize();var a=new _three.Vector3(0,0,t?-1:1),s=(new _three.Quaternion).setFromUnitVectors(o,a);return(new _three.Quaternion).multiplyQuaternions(this.shapeHolder.quaternion.clone(),s)}return}},{key:"getUpdatePosition",value:function(){return this._updatePosition(),JSON.parse(JSON.stringify(this._position))}},{key:"_updatePosition",value:function(){if(0!==this.shapeHolder.position.x||0!==this.shapeHolder.position.y||0!==this.shapeHolder.position.z){var e=this.shapeHolder.position.clone().applyMatrix4(this.matrixWorld),t=new _three.Matrix4;t.getInverse(this.earth.markerLayer.matrixWorld);var r=e.applyMatrix4(t),n=_EarthMath2.default.getLngLatAltFromNoneGroundCartesian(_EarthConstants2.default.EarthResolution,r,_EarthConstants2.default.scale),i=n.lng,o=n.lat,a=n.alt;Object.assign(this._position,{lng:i,lat:o,alt:a});var s=_EarthMath2.default.getLocalSystemOnEarthSurface(_EarthConstants2.default.EarthResolution,this._position.lng,this._position.lat,_EarthConstants2.default.scale),l=_EarthMath2.default.getNoneGroundCartesianFromLngLatAlt(_EarthConstants2.default.EarthResolution,this._position.lng,this._position.lat,this._position.alt,_EarthConstants2.default.scale),u=new _PMatrix2.default;u.makeBasis(s.lng,s.lat,s.alt),u.setPosition(l),this.setMatrix(u),this.shapeHolder.position.x=0,this.shapeHolder.position.y=0,this.shapeHolder.position.z=0}}},{key:"on",value:function(e,t){switch(e){case"click":this.eventHandlers._onClick=t,this._property.eventHandlers._onClick=t.toString();break;case"mouseover":this.eventHandlers._onMouseOver=t,this._property.eventHandlers._onMouseOver=t.toString();break;case"mouseenter":this.eventHandlers._onMouseEnter=t,this._property.eventHandlers._onMouseEnter=t.toString();break;case"mouseleave":this.eventHandlers._onMouseLeave=t,this._property.eventHandlers._onMouseLeave=t.toString();break;case"mousedrag":this.eventHandlers._onMouseDrag=t,this._property.eventHandlers._onMouseDrag=t.toString();break;default:console.log("unknown eventType "+e)}}},{key:"off",value:function(e){switch(e){case"click":this.eventHandlers._onClick=null,this._property.eventHandlers._onClick=null;break;case"mouseover":this.eventHandlers._onMouseOver=null,this._property.eventHandlers._onMouseOver=null;break;case"mouseenter":this.eventHandlers._onMouseEnter=null,this._property.eventHandlers._onMouseEnter=null;break;case"mouseleave":this.eventHandlers._onMouseLeave=null,this._property.eventHandlers._onMouseLeave=null;break;case"mousedrag":this.eventHandlers._onMouseDrag=null,this._property.eventHandlers._onMouseDrag=null;break;default:console.log("unknown eventType "+e)}}},{key:"setContent",value:function(e){return!!function(e){var t=e instanceof _three.Object3D;t||console.warn("Marker: unknown content type",e);return t}(e)&&(this.contentHolder.add(e),!0)}},{key:"unsetContent",value:function(){function e(e){e.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&(e.material.map&&e.material.map.dispose(),e.material.dispose())});for(var t=e.children.length-1;t>=0;t--){var r=e.children[t];e.remove(r)}}e(this.contentHolder),e(this.decoHolder),this._interactShape=null}},{key:"setDecoration",value:function(e){this.decoHolder.add(e)}},{key:"light",value:function(){this.decoHolder.visible=!0}},{key:"dim",value:function(){this.decoHolder.visible=!1}},{key:"setPose",value:function(e,t,r){if(e){Object.assign(this._position,e);var n=_EarthMath2.default.getLocalSystemOnEarthSurface(_EarthConstants2.default.EarthResolution,e.lng,e.lat,_EarthConstants2.default.scale),i=_EarthMath2.default.getNoneGroundCartesianFromLngLatAlt(_EarthConstants2.default.EarthResolution,e.lng,e.lat,e.alt,_EarthConstants2.default.scale),o=new _PMatrix2.default;o.makeBasis(n.lng,n.lat,n.alt),o.setPosition(i),this.setMatrix(o)}if(t){if(t.isEuler)this.shapeHolder.setRotationFromEuler(t);else if(t instanceof _three.Quaternion)this.shapeHolder.setRotationFromQuaternion(t),this._orientation.copy(t);else{var a=new _three.Vector3(t.x,t.y,t.z);a.normalize(),this.shapeHolder.rotateOnAxis(a,t.w)}this.shapeHolder.updateMatrix()}if(r)if("number"==typeof r)this.shapeHolder.scale.copy(new _three.Vector3(r,r,r));else{var s=!1;"number"==typeof r.x&&(this.shapeHolder.scale.setX(r.x),s=!0),"number"==typeof r.y&&(this.shapeHolder.scale.setY(r.y),s=!0),"number"==typeof r.z&&(this.shapeHolder.scale.setZ(r.z),s=!0),s||console.warn("[Marker] scale must be a number or an object containing x, y or z",r,this.shapeHolder.scale.clone())}this.updateMatrixWorld(!0),this.earth._updateGPUPicker.add({force:!0})}},{key:"getMtlParams",value:function(){var e=[];return this.contentHolder.traverse(function(t){"Mesh"===t.type&&e.push(Object.assign({},t.mtlParams))}),e}},{key:"__markerSetInteractable",value:function(e){if(e){var t=function(e,t,r,n){return(e-r)*(e-r)+(t-n)*(t-n)<6},r=this;this.listen("mouseover",function(e){r.eventHandlers._onMouseOver&&r.eventHandlers._onMouseOver(e)}),this.listen("mouseenter",function(e){r.eventHandlers._onMouseEnter&&r.eventHandlers._onMouseEnter(e)}),this.listen("mouseleave",function(e){r.eventHandlers._onMouseLeave&&r.eventHandlers._onMouseLeave(e)});var n=!1,i={x:0,y:0},o=!1,a=!1,s=!1;this.listen("mousedown",function(e){n=!0,i.x=e.clientX,i.y=e.clientY,0===e.button&&(o=!0),o&&r.eventHandlers._onMouseDrag&&(r.earth.freeze(),a=!0)}),this.listen("mousemove",function(e){o&&r.eventHandlers._onMouseDrag&&(s||(s=!t(e.clientX,e.clientY,i.x,i.y)),s&&r.eventHandlers._onMouseDrag(e))}),this.listen("mouseup",function(e){n&&t(e.clientX,e.clientY,i.x,i.y)&&r.eventHandlers._onClick&&r.eventHandlers._onClick(e),n=!1,o=!1,a&&(r.earth.unfreeze(),a=!1),s=!1})}else this._interactable&&(this.stopListen("mouseover"),this.stopListen("mouseenter"),this.stopListen("mouseleave"),this.stopListen("mousedown"),this.stopListen("mousemove"),this.stopListen("mouseup"))}},{key:"cast",value:function(e){if(this.interactShape){var t={x:e.clientX/window.innerWidth*2-1,y:-e.clientY/window.innerHeight*2+1};this.interactShape.geometry&&this.interactShape.geometry.computeFaceNormals(),this.interactShape.visible=!0;var r=(0,_HelperFunctions.raycast)(t,this.earth.earthView.camera,[this.interactShape]);if(this.interactShape.visible=!1,r){var n=r.point,i=new _three.Matrix4;i.getInverse(this.earth.earthToScene());var o=n.clone().applyMatrix4(i),a=_EarthMath2.default.getLngLatAltFromNoneGroundCartesian(_EarthConstants2.default.EarthResolution,o,_EarthConstants2.default.scale),s=a.lng,l=a.lat,u=a.alt,c=r.normal.multiplyScalar(_EarthConstants2.default.scale/_EarthConstants2.default.EARTH_RADIUS),h=n.clone().add(c).applyMatrix4(i);return{contactPoint:{lng:s,lat:l,alt:u},normalDirection:_EarthMath2.default.getLngLatAltFromNoneGroundCartesian(_EarthConstants2.default.EarthResolution,h,_EarthConstants2.default.scale)}}}}},{key:"appendContent",value:function(e){this.contentHolder.add(e)}},{key:"reduceContent",value:function(e){this.contentHolder.remove(e)}},{key:"showControl",value:function(e){"translate"===e||"rotate"===e?(Marker.control.attach(this.shapeHolder),Marker.control.space="local",Marker.control.setMode(e),this.earth.scene.add(Marker.control)):console.error("control mode not supported",e)}},{key:"detachControl",value:function(){Marker.control.detach(this.shapeHolder),this.earth.scene.remove(Marker.control),this._updatePosition()}},{key:"setControlMode",value:function(e){"translate"===e||"rotate"===e?Marker.control.setMode(e):console.error("control mode not supported",e)}},{key:"changeMaterial",value:function(e){var t=this._property.materialDescriptions;this.contentHolder.traverse(function(r){if("Mesh"===r.type&&r.material.name===e.name){r.material=e;for(var n=!1,i=0;i<t.length;++i)t[i].name===e.name&&(t[i]=r.material.description,n=!0);n||t.push(r.material.description)}}),this._property.materialDescriptions=t}},{key:"getMaterials",value:function(){var e=[];return this.contentHolder.traverse(function(t){"Mesh"===t.type&&e.push(t.material)}),e}},{key:"playAnimation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this._property.patrolRoutes[e].route;if(void 0!==r)if(r.length<2)console.error("animation records not enough",r);else{this.startTime=null,this.routeCursor=0,this.playing=!0;var n=this,i=r[n.routeCursor],o=r[n.routeCursor+1],a=s(i,o);n.animate=function(l){if(n.startTime){var u=l.currentTime-n.startTime,c=r[n.routeCursor],h=r[n.routeCursor+1];if(h&&h.timestamp<u)if(n.routeCursor+=1,c=h,void 0===(h=r[n.routeCursor+1])){if(t)return n.startTime=l.currentTime,n.routeCursor=0,void(a=s(i,o));n.resetAnimation(e)}else{h.timestamp-c.timestamp<=0&&console.error("[PatrolService] animation timestamp error"),a=s(c,h)}if(n.playing){var f=function(e,t,r){var n={lng:e.position.lng+r*t.lng,lat:e.position.lat+r*t.lat,alt:e.position.alt+r*t.alt},i=t.prevOrientation.clone();return i.slerp(t.currOrientation,r/t.timeInterval),{position:n,orientation:i}}(c,a,u-c.timestamp);n.setPose(f.position,f.orientation)}}else n.startTime=l.currentTime}}else console.error("[Marker playAnimation] route is undefined");function s(e,t){var r=t.timestamp-e.timestamp;return{lng:(t.position.lng-e.position.lng)/r,lat:(t.position.lat-e.position.lat)/r,alt:(t.position.alt-e.position.alt)/r,prevOrientation:new _three.Quaternion(e.orientation._x,e.orientation._y,e.orientation._z,e.orientation._w),currOrientation:new _three.Quaternion(t.orientation._x,t.orientation._y,t.orientation._z,t.orientation._w),timeInterval:r}}}},{key:"resetAnimation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.playing=!1,this.startTime=null,this.routeCursor=0,this.animate=function(e){};var t=this._property.patrolRoutes[e].route[0];this.setPose(t.position,new _three.Quaternion(t.orientation._x,t.orientation._y,t.orientation._z,t.orientation._w)),document.dispatchEvent(new CustomEvent("reset_animation"))}},{key:"updateMatrixWorld",value:function(e,t){if(!0!==this.matrixWorldNeedsUpdate&&!0!==e||(null===this.parent?this._matrixWorld.copy(this._matrix):this._matrixWorld.multiplyMatrices(this.parent.matrixWorld,this._matrix),this.matrixWorldNeedsUpdate=!1,e=!0),e){var r=this.matrixWorld.elements;this.sceneNode.matrix.set(r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],r[3],r[7],r[11],1)}}},{key:"sceneUpdated",value:function(e){}},{key:"animate",value:function(e){}},{key:"updateVisibility",value:function(e){}},{key:"listen",value:function(e,t){this.earth.interaction.register(this,e,t)||console.warn("Marker.listen failed.")}},{key:"stopListen",value:function(e){this.earth.interaction.unregister(this,e)||console.warn("Marker.listen failed.")}},{key:"shapeToEarth",value:function(){try{return(new _three.Matrix4).getInverse(this.earth.earthToScene(),!0).multiply(this.shapeToScene())}catch(e){return void console.error(e)}}},{key:"shapeToScene",value:function(){return(new _three.Matrix4).copy(this.matrixWorld).multiply(this.shapeHolder.matrix)}},{key:"_XYZ",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001;return function(e){var r=new _three.Object3D;return r.add(t(new _three.Vector3(0,0,0),new _three.Vector3(e,0,0),16711680,!1)),r.add(t(new _three.Vector3(0,0,0),new _three.Vector3(-e,0,0),16711680,!0)),r.add(t(new _three.Vector3(0,0,0),new _three.Vector3(0,e,0),65280,!1)),r.add(t(new _three.Vector3(0,0,0),new _three.Vector3(0,-e,0),65280,!0)),r.add(t(new _three.Vector3(0,0,0),new _three.Vector3(0,0,e),255,!1)),r.add(t(new _three.Vector3(0,0,0),new _three.Vector3(0,0,-e),255,!0)),r.name="XYZ",r}(e);function t(t,r,n,i){var o=new _three.Geometry,a=void 0;return a=i?new _three.LineDashedMaterial({linewidth:1,color:n,dashSize:e/1e3,gapSize:e/300}):new _three.LineBasicMaterial({linewidth:1,color:n}),o.vertices.push(t.clone()),o.vertices.push(r.clone()),o.computeLineDistances(),new _three.LineSegments(o,a)}}},{key:"position",set:function(e){var t=Object.assign(this.position,e);this.setPose(t)},get:function(){return JSON.parse(JSON.stringify(this._position))}},{key:"ID",get:function(){return this.sceneNode.uuid}},{key:"clickable",set:function(e){console.warn("Marker clickable is deprecating. Set to the interactable instead"),this.interactable=e},get:function(){return console.warn("Marker clickable is deprecating. Set to the interactable instead"),this._interactable}},{key:"interactable",set:function(e){this.ready4Interaction&&this.__markerSetInteractable(e),this._interactable=e},get:function(){return this._interactable}},{key:"orientation",set:function(e){var t=e.x,r=e.y,n=e.z,i=e.w,o=new _three.Quaternion(t,r,n,i);return this.setPose(void 0,o,void 0)},get:function(){return this.shapeHolder.quaternion.clone()}},{key:"euler",set:function(e){var t=this.euler,r={x:t.x,y:t.y,z:t.z,order:t.order},n=Object.assign({},r,e);this.orientation=(new _three.Quaternion).setFromEuler(new _three.Euler(n.x,n.y,n.z,n.order))},get:function(){return(new _three.Euler).setFromQuaternion(this.orientation)}},{key:"scale",set:function(e){this.setPose(void 0,void 0,e)},get:function(){return this.shapeHolder.scale.x}},{key:"x",set:function(e){this.setPose(void 0,void 0,{x:e})},get:function(){return this.shapeHolder.scale.x}},{key:"y",set:function(e){this.setPose(void 0,void 0,{y:e})},get:function(){return this.shapeHolder.scale.y}},{key:"z",set:function(e){this.setPose(void 0,void 0,{z:e})},get:function(){return this.shapeHolder.scale.z}},{key:"visible",set:function(e){this.shapeHolder.visible=e},get:function(){return this.shapeHolder.visible}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}},{key:"patrolRoutes",set:function(e){this._property.patrolRoutes=e},get:function(){return JSON.parse(JSON.stringify(this._property.patrolRoutes))}},{key:"interactShape",set:function(e){e.visible=!1,this._interactShape=e,this.shapeHolder.add(this._interactShape),this.__markerSetInteractable(this.interactable),this.ready4Interaction=!0},get:function(){return this._interactShape}}]),Marker}(_HyperNode3.default);Marker.control=null,exports.default=Marker,module.exports=exports.default},__WEBPACK_AMD_DEFINE_ARRAY__=[module,exports,__webpack_require__(0),__webpack_require__(6),__webpack_require__(56),__webpack_require__(58),__webpack_require__(1),__webpack_require__(3),__webpack_require__(10),__webpack_require__(57)],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=factory)?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(e,t,r){var n,i,o,a;a=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lng=t,this.lat=r,this.alt=void 0===n?0:n,this.lng=Math.max(Math.min(180,this.lng),-180),this.lat=Math.max(Math.min(90,this.lat),-90)}return r(e,[{key:"equals",value:function(e){return e.lat===this.lat&&e.lng===this.lng&&e.alt===this.alt}}]),e}();t.default=n,e.exports=t.default},i=[e,t],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={GLFENCE_SIDE_PLANE_RENDER_ORDER:1,GLFENCE_BASE_PLANE_RENDER_ORDER:2,GLFENCE_LINE_RENDER_ORDER:3,POLYLINE_RENDER_ORDER:3,LIGHTBEAM_RENDER_ORDER:3,SPRITE_PIN_RENDER_ORDER:3,TRANSFORM_CONTROL_RENDER_ORDER:10,HEIGHTMAP_RENDER_ORDER:3},e.exports=t.default},i=[e,t],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i={},o=new Set,a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.TextureLoader),n(t,[{key:"load",value:function(e,r,n,a){i[e]?r(i[e]):function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"load",this).call(this,e,function(t){if(r(t),i[e]=t,o.add(e),o.size>20){var n=o.values().next().value;i[n]&&(i[n].dispose(),delete i[n]),o.delete(n)}},n,a)}}]),t}();t.default=a,e.exports=t.default},i=[e,t,r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){e.exports=r(37)},function(e,t,r){var n,i,o,a;a=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.raycast=e.Animation=e.Debounce=void 0;var r,n=(r=new t.Raycaster,function(e,n,i){r.setFromCamera(e,n);var o=r.intersectObjects(i);if(o.length>0){var a=o[0];if(a&&a.object){var s=a.object,l=new t.Vector3(0,0,0).applyMatrix4(s.matrixWorld),u=a.face.normal.clone().applyMatrix4(s.matrixWorld).add(l.negate()).normalize();return{point:a.point,normal:u}}}});e.Debounce=function(e,t){var r=void 0;return function(){clearTimeout(r),r=setTimeout(function(){e&&e()},t)}},e.Animation=function(e,t,r){var n=this;this.states=e;var i=void 0,o=this;return{start:function(){!function e(){t(n.states)?i=setTimeout(e,r):clearTimeout(i)}()},stop:function(){clearTimeout(i)},changeStates:function(e){o.states=Object.assign({},o.states,e)}}},e.raycast=n},i=[t,r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){"use strict";var n=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),r=r.getBlob()}catch(t){r=new Blob([e])}return new Worker(n.createObjectURL(r))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}},function(e,t,r){"use strict";(function(t){var n=r(2),i=r(40),o={"Content-Type":"application/x-www-form-urlencoded"};function a(e,t){!n.isUndefined(e)&&n.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var s,l={adapter:("undefined"!=typeof XMLHttpRequest?s=r(24):void 0!==t&&(s=r(24)),s),transformRequest:[function(e,t){return i(t,"Content-Type"),n.isFormData(e)||n.isArrayBuffer(e)||n.isBuffer(e)||n.isStream(e)||n.isFile(e)||n.isBlob(e)?e:n.isArrayBufferView(e)?e.buffer:n.isURLSearchParams(e)?(a(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):n.isObject(e)?(a(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300}};l.headers={common:{Accept:"application/json, text/plain, */*"}},n.forEach(["delete","get","head"],function(e){l.headers[e]={}}),n.forEach(["post","put","patch"],function(e){l.headers[e]=n.merge(o)}),e.exports=l}).call(t,r(23))},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o,a,s,l,u,c,h,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=w(r),p=w(n),m=w(o),v=w(a),g=w(s),y=w(l),_=w(h);function w(e){return e&&e.__esModule?e:{default:e}}function b(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var x=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var A=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function M(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var S={TEXTURE:0,FLAT:1,WIREFRAME:2,SELECT:3,CROP:4,SHADOWMAP:5,TRANSPARENT:6,PHONGFLAT:7},P=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=e,n=M(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r)),o=n;if(!function(){if(!e||!e.projInfo||!e.projInfo.id)return!1;return o._property.type="AltizureProjectMarker",o._property.id=e.projInfo.id,!0}())return console.error("AltizureProjectMarker invalid input",e),void 0,M(n,void 0);n._isMobile=i.BrowserCapatibility.isMobile(),n.HOST=e.HOST,n._apiInfo=e.projInfo,n._projInfo=function(e){var t=e.modelTransform,r={PID:e.id,origin:a(t.origin),x_dir:a(t.xDir),y_dir:a(t.yDir),z_dir:a(t.zDir),max_bound:a(t.maxBound),min_bound:a(t.minBound),x_tiles:t.xTiles,y_tiles:t.yTiles,z_tiles:t.zTiles,floor_height:t.floorHeight,length_unit_to_meter:t.lengthUnitToMeter,isMobile:o._isMobile,minLevel:0,maxLevel:function(e,t){var r=Math.max(e,t),n=0;for(;r>1;)r/=2,n++;return n}(t.xTiles,t.yTiles),onLoadTrans:t.onLoadTrans,tile_salt:null===e.versionControl?"":e.versionControl},n=x(r.onLoadTrans,r.origin);void 0===r.length_unit_to_meter&&(r.length_unit_to_meter=1);return r.transformation=new i.Transformation,r.transformation.set({onload:n,scale:r.length_unit_to_meter}),r;function a(e){return e instanceof Array&&3===e.length?new c.Vector3(e[0],e[1],e[2]):e&&e.x&&e.y&&e.z?new c.Vector3(e.x,e.y,e.z):void console.error("objToVec3 invalid obj",e)}}(n._apiInfo);var a=r.autoScale;if(!0===a&&(a=50),"number"==typeof a&&a>0){var s=n.projInfo.max_bound,l=n.projInfo.min_bound,u=s.x-l.x,h=s.y-l.y,f=a/(u>h?u:h);n.setPose(void 0,void 0,f),n._property.autoScale=a}var d=function(e){var t=e.min_bound,r=e.max_bound,n=(e.origin,e.onLoadTrans,r.x-t.x),i=r.y-t.y,o=r.z-t.z,a=new m.default(n,i,o,6923221),s=new c.Matrix4;s.makeTranslation((r.x+t.x)/2,(r.y+t.y)/2,(r.z+t.z)/2),a.applyMatrix(s);for(var l=new c.BoxBufferGeometry(n,i,o),u=new Uint16Array(30),h=0;h<8;h++)u[3*h]=l.index.array[3*h+2],u[3*h+1]=l.index.array[3*h+1],u[3*h+2]=l.index.array[3*h];u[24]=l.index.array[32],u[25]=l.index.array[31],u[26]=l.index.array[30],u[27]=l.index.array[35],u[28]=l.index.array[34],u[29]=l.index.array[33],l.index.array=u,l.index.count=30;var f=new c.Matrix4;f.makeTranslation((r.x+t.x)/2,(r.y+t.y)/2,(r.z+t.z)/2),l.applyMatrix(f);var d=new c.Mesh(l),v=new c.Object3D;s.makeTranslation(0,0,-t.z),v.applyMatrix(s);var g=p.default.scale/p.default.EARTH_RADIUS;return s.makeScale(g,g,g),v.applyMatrix(s),a.applyMatrix(v.matrix),a.name="fence",d.applyMatrix(v.matrix),d.name="box",{fence:a,centeredTransfrom:v,box:d}}({min_bound:n.projInfo.min_bound,max_bound:n.projInfo.max_bound,origin:n.projInfo.origin,onLoadTrans:n.projInfo.onLoadTrans}),v=d.fence,g=d.centeredTransfrom,y=d.box;n._showTileBBox=e.showTileBBox,n.projHolder=g,n.projHolder.name="projHolder";var w=(new c.Matrix4).makeBasis(new c.Vector3(1,0,0),new c.Vector3(0,0,1),new c.Vector3(0,-1,0));n._objToDisplay=w.multiply(x(n.projInfo.onLoadTrans,n.projInfo.origin)),n.displayHolder=new c.Object3D,n.displayHolder.name="displayHolder",n.displayHolder.applyMatrix(o._objToDisplay),n.projHolder.add(n.displayHolder),n._tree=null,n.treeNode=new c.Object3D,n.treeNode.name="treeNode",n.displayHolder.add(n.treeNode),n._waterManager=null,n.waterHolder=new c.Object3D;var b=(new c.Matrix4).setPosition(n.projInfo.origin.clone().negate());n.waterHolder.applyMatrix(b),n.projHolder.add(n.waterHolder),n._photoManager=null,n.photoHolder=new c.Object3D,n.displayHolder.add(n.photoHolder),n._currentPhotoCam=null,n._focusVisual=new c.Mesh(new c.SphereBufferGeometry(.5),new c.MeshBasicMaterial({color:16711680,side:c.DoubleSide})),n._focusVisual.name="_focusVisual",n._focusVisual.visible=!1,n.displayHolder.add(n._focusVisual),n.decoHolder.add(v),n.interactShape=y,n.hasDepthMap=!1,n._depthMap=void 0,n._depthMapNeedsUpdate=!0,n._overlayMarkers=[],n._cropMask=new _.default({maskSize:1024});function x(e,t){return function(e){var t=new c.Matrix4;e instanceof Array?3===e.length?t.makeRotationX(Math.PI*e[0]).multiply((new c.Matrix4).makeRotationY(Math.PI*e[1])).multiply((new c.Matrix4).makeRotationZ(Math.PI*e[2])):16===e.length?t.set.apply(t,e):console.error("AltizureMeshEntity createTree: incorrect onLoadTrans",e):"object"===(void 0===e?"undefined":k(e))&&void 0!==e.x&&void 0!==e.y&&void 0!==e.z&&t.makeRotationX(Math.PI*e.x).multiply((new c.Matrix4).makeRotationY(Math.PI*e.y)).multiply((new c.Matrix4).makeRotationZ(Math.PI*e.z));return t}(e).multiply((new c.Matrix4).makeTranslation(-t.x,-t.y,-t.z))}return n._onInitSuccess=null,n._onInitFail=null,n.initialized=i.EventUtil.timedPromise(new Promise(function(e,t){o._onInitSuccess=e,o._onInitFail=t}),27e4),n.import(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,d.default),A(t,[{key:"destruct",value:function(){this.interactable&&(this.interactable=!1),this.deport(),this.unsetContent(),this.deportWater(),this._cropMask&&this._cropMask.destruct(),function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"import",value:function(){var e=this;!function(){var r={PID:e.projInfo.PID,debug:!1,isMobile:e._isMobile,onError:function(e,t){console.warn("AltizureProjectMarker.createTree",e,t)},viewModeType:S,viewMode:4,fullScene:!1,quality:40,display_lod:!1,allow_worker:!0,bbox:e._showTileBBox,MAX_THREADS:8,MAX_CACHE_SIZE:150,MIN_AREA:.1,maxAnisotropy:t.MAXANISOTROPY,dataPath:e.preferredPath,HOST:e.HOST,altizureApi:e.apiService,eventHandlers:{onContentInitialized:e.onContentInitialized.bind(e)}};if(e._tree=new i.AltizureProjectTree(i.MeshSmartTile,e.treeNode,e.dataUrl,e.projInfo,r),!t._forest){var n=e._isMobile,o={FOREST_CAPACITY:(n?110:280)*t.quality/60,MAX_DOWNLOAD_CONCURRENCY:n?4:10,MIN_AREA:n?.1:.01,MAX_LEVEL:n?10:12,allowWorker:!0},a={trees:[],CACHE_CAPACITY:(n?140:350)*t.quality/60};t._forest=new i.Forest(o,a)}t._forest.add(e._tree)}(),this.setContent(this.projHolder)}},{key:"deport",value:function(){var e=!0;return t._forest&&t._forest.remove(this._tree),this._tree&&(e=e&&this._tree.destruct(),this._tree=null),e||console.warn("AltizureProjectMarker deport failed."),e}},{key:"pickDepthMap",value:function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e instanceof Array){var i=this.projInfo.max_bound.z-this.projInfo.min_bound.z,o=(r={max:{lat:(t=e)[0].lat,lng:t[0].lng},min:{lat:t[0].lat,lng:t[0].lng}},t.map(function(e){e.lat>r.max.lat&&(r.max.lat=e.lat),e.lng>r.max.lng&&(r.max.lng=e.lng),e.lat<r.min.lat&&(r.min.lat=e.lat),e.lng<r.min.lng&&(r.min.lng=e.lng)}),[{lat:r.max.lat+1e-4,lng:r.max.lng+1e-4},{lat:r.min.lat-1e-4,lng:r.min.lng-1e-4}]),a=this.position.alt,s=0+a,l=i+a,u=this.earth.markerSnapshot(o,{min:s,max:l},[this.contentHolder],!0),c=u.dimension.width,h=u.dimension.height,f=u.buffer,d=[],p=o[0].lat-o[1].lat,m=o[0].lng-o[1].lng;return e.map(function(e){var t=(e.lat-o[1].lat)/p,r=(e.lng-o[1].lng)/m,n=1===r?parseInt(c*r)-1:parseInt(c*r),i=1===t?parseInt(h*t)-1:parseInt(h*t);if(r>=0&&r<=1&&t>=0&&t<=1){var a=(1-f[i*c+n]/255)*(l-s)+s;d.push(a)}else console.warn("{lng, lat} is out of the boundary of the project marker",e)}),n?[d,o,u]:d}console.warn("[pickDepthMap] Argument is not an instance of Array",e)}},{key:"autoAdjustPolygons",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512;if(!(t.length<1||e.length<1)){for(var n=this.position.alt,i=this.position.alt+this.projInfo.max_bound.z-this.projInfo.min_bound.z,o=this.earth.markerSnapshot(e,{min:n,max:i},[this.contentHolder],!0,r),a={min:t[0].bottom,max:t[0].top},s=1;s<t.length;++s)a.min=a.min>t[s].bottom?t[s].bottom:a.min,a.max=a.max<t[s].top?t[s].top:a.max;a.min-=.1,a.max+=.1;for(var l=this.earth.generateMask(e,a,t,r),u=l.mask,c=l.mapping,h={},f=0;f<o.dimension.width;++f)for(var d=0;d<o.dimension.height;++d){var p=d*o.dimension.width+f,m=4*p,v=256*u.buffer[m]*256+256*u.buffer[m+1]+u.buffer[m+2],g=(1-o.buffer[p]/255)*(i-n)+n;h[v]?(h[v].top=h[v].top<g?g:h[v].top,h[v].bottom=h[v].bottom>g?g:h[v].bottom):h[v]={top:g,bottom:g}}for(var y in h)c[y]&&(c[y].top=h[y].top+.1,c[y].bottom=h[y].bottom-.1)}}},{key:"measureByPolygon",value:function(e,t){var r=this;return new Promise(function(n,i){setTimeout(function(){var i=r.getRegionVolume(e,t);n(i)},1e3)})}},{key:"getRegionVolume",value:function(e,t){if(void 0!==e){var r=this.pickDepthMap(e.boundaryPts,!0),n=x(r,3),i=n[0],o=n[1],a=n[2],s="number"==typeof t?t:Math.min.apply(Math,b(i)),l=this.projInfo.max_bound.z-this.projInfo.min_bound.z,u=this.position.alt,c=0+u,h=l+u,f=e.top>e.bottom?e.top:e.bottom,d=e.top<e.bottom?e.top:e.bottom;f+=.1,d-=.1;for(var p=this.earth.markerSnapshot(o,{min:f,max:d},[e.contentHolder]),m=h,v=c,g=!0,y=0,_=0,w=0,k=0;k<a.buffer.length;++k)if(0!==p.buffer[4*k+3]){var A=(1-a.buffer[k]/255)*(h-c)+c,M=A-s;M>0?y+=M*p.resolution:_-=M*p.resolution,w+=p.resolution,g?(m=A,v=A,g=!1):(m<A&&(m=A),v>A&&(v=A))}for(var S=0,P=a.dimension.width,T=a.dimension.height,O=0;O<P;++O)for(var C=0;C<T;++C){j(C*P+O)&&(S+=E(O,C))}return{cut:y,fill:_,area:w,surface:S,refAltitude:s,highest:m,lowest:v}}function E(e,t){var r=(t-1)*P+e,n=(t+1)*P+e,i=t*P+e-1,o=t*P+e+1,s=t*P+e,l=R(a.buffer[s]),u=0;function c(e,t,r,n){if(L(t)&&L(n)){var i=R(a.buffer[t]),o=R(a.buffer[r]),s=R(a.buffer[n]);u+=I(i,l,o)/4,u+=I(s,o,l)/4}else u+=p.resolution/4}function h(e,t,n){if(L(t)&&L(n)){var i=R(a.buffer[o]),s=R(a.buffer[r]);u+=I(l,i,s)/2}else u+=p.resolution/4}return h(s,i,r),h(s,o,n),c(s,i,(t+1)*P+e-1,n),c(s,o,(t-1)*P+e+1,r),u}function I(e,t,r){var n=a.resolutionwidth*a.resolutionwidth,i=a.resolutionheight*a.resolutionheight,o=Math.sqrt((e-t)*(e-t)+n),s=Math.sqrt((e-r)*(e-r)+i),l=Math.sqrt((t-r)*(t-r)+n+i),u=(o+s+l)/2;return Math.sqrt(u*(u-o)*(u-s)*(u-l))}function R(e){return(1-e/255)*l}function L(e){return e>=0&&e<a.buffer.length}function j(e){return L(e)&&0!==p.buffer[4*e+3]}console.error("polygon marker is required")}},{key:"_generateImages",value:function(e){var t=e.polygonMarkers;if(!(t.length<1)){var r=e.boundary,n=e.resolution,i={min:t[0].bottom,max:t[0].top},o=[];t.map(function(e){o.push(e.contentHolder),i.min=i.min>e.bottom?e.bottom:i.min,i.max=i.max<e.top?e.top:i.max}),i.min-=.1,i.max+=.1;for(var a=this.earth.markerSnapshot(r,i,o,!1,n),s=[],l=0;l<a.buffer.length;l+=4)s.push(a.buffer[l+3]);a=Object.assign(a,{buffer:s});var u={min:0,max:this.projInfo.max_bound.z-this.projInfo.min_bound.z},c=this.earth.markerSnapshot(r,u,[this.contentHolder],!0,n),h={min:0,max:0};return h.min=(1-c.buffer[0]/255)*(u.max-u.min)+u.min,h.max=h.min,c.buffer.map(function(e){var t=(1-e/255)*(u.max-u.min)+u.min;h.min=h.min>t?t:h.min,h.max=h.max<t?t:h.max}),h.min-=.1,h.max+=.1,{srcImg:this.earth.markerSnapshot(r,h,[this.contentHolder],!0,n),srcAltRange:h,dstImg:a,dstAltRange:i}}console.warn("AltizureProjectMarker _generateImages options.polygonMarkers length must not be smaller than 1")}},{key:"_detectOffset",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments[3];return new Promise(function(i,o){var a=new f;a.onmessage=function(e){var t=e.data;t.finish?(i(t.offset),a.terminate()):n&&n(t)},a.onError=function(e){console.log("AltizureProjectMarker _detectOffset worker error",e)};var s=Object.assign({},r);s.projectDepthImage=e,s.maskImage=t,a.postMessage(s)})}},{key:"sceneUpdated",value:function(e){if(console.warn("AltizureProjectMarker sceneUpdated should be managed by forest"),null!==this._tree){if(isNaN(e.camera.far))return;this._tree.updateView(e.camera,e.pvmatrix,e.frustum),this._tree.loadUnloadedTiles()}}},{key:"updateVisibility",value:function(e){if(null!==this._tree){var t=e.frustum;this._tree.updateVisibility(t)}}},{key:"animate",value:function(e){this._waterManager&&this._waterManager.renderWaters()}},{key:"importWater",value:function(){var e={sceneNode:this.waterHolder,scene:this.earth.scene,renderer:this.earth.renderer,camera:this.earth.viewerCamera,PID:this.projInfo.PID,dataPath:this.preferredPath,maskSize:512,info:this.projInfo,maxMaskNum:3,updateMaskFormat:!1,isDebug:!1,edit:!1,HOST:this.HOST,altizureApi:this.apiService};this._waterManager=new v.default(e);var t=this;return this._waterManager.downloadAll().then(function(){return Promise.resolve(t)})}},{key:"deportWater",value:function(){this._waterManager&&this._waterManager.destruct()}},{key:"importPhotos",value:function(e){var t=this,r={url:e&&e.url?e.url:function(){var e=function(){for(var e=t._apiInfo.cloudPath,r=0;r<e.length;r++)if("local"!==e[r].key)return e[r].dataUrl;return}(),r=e+"/camera/0_0_0.json",n=e.replace("data","user_drive")+"/";return{cameraFile:r,photoBase:n}}(),length_unit_to_meter:this._projInfo.length_unit_to_meter,photoHolder:this.photoHolder,objToScene:this.objToScene.bind(this),objToEarth:this.objToEarth.bind(this),createInstance:e.showCameras};return this._photoManager=new g.default(r),this._photoManager.init()}},{key:"deportPhotos",value:function(){return this._photoManager&&(this._photoManager.destruct(),this._photoManager=null),!0}},{key:"_snap",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{dist:200,orient:15,alpha:.1},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,n=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],this);this._focusVisual.visible=!0;var o=this.earth.earthView.height,a=this.earth.earthView.width,s=this.earth.control.pickProjectContactPointInEarth({rawX:a/2,rawY:o/2},"marker");if(!s)return Promise.reject(new Error("No focus."));var l=s.clone(),u=l.clone().applyMatrix4(this.earthToObj());if(this._focusVisual.position.copy(u),!(e=n._photoManager.cameraNear(n.earth.viewerCamera,u,t)))return this._focusVisual.material.color.setHex(16711680),console.warn("no nearby photo"),Promise.reject(new Error("No nearby photo."));this._focusVisual.material.color.setHex(65280);var h=n._photoManager.photoUrl(e.name),f=n.earth.control,d=new c.Vector3,p=new c.Quaternion,m=new c.Vector3;n.objToEarth().multiply(e.camToObj).clone().decompose(d,p,m);var v=(new c.Matrix4).compose(d,p,new c.Vector3(1,1,1)),g=f.flyToMatNorthUp(v,r,l),y=i.LoadUtil.loadTexture({textureUrl:h},6e4).then(function(e){return e.wrapS=c.RepeatWrapping,e.wrapT=c.RepeatWrapping,Promise.resolve(e)}).then(function(t){var r=void 0;return e!==n._currentPhotoCam?(n._currentPhotoCam&&(n.photoHolder.remove(n._currentPhotoCam.photoDisplay),n._currentPhotoCam.disposeDisplay()),n._currentPhotoCam=e,(r=n._currentPhotoCam.photoDisplay).material.map=t,r.material.needsUpdate=!0,n.photoHolder.add(r)):r=n._currentPhotoCam.photoDisplay,r.visible=!1,r.material.opacity=1,Promise.resolve(r)});return Promise.all([g,y]).then(function(t){var r=t[1];return r&&(r.visible=!0),Promise.resolve(e)}).catch(function(e){return console.error(e),e})}},{key:"imgPicker",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{dist:200,orient:15,alpha:.1},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this._focusVisual.visible=!0;var n=this.earth.earthView.height,i=this.earth.earthView.width,o=this.earth.control.pickProjectContactPointInEarth({rawX:i/2,rawY:n/2},"marker");if(!o)return Promise.reject(new Error("No focus."));var a=o.clone().clone().applyMatrix4(this.earthToObj());return this._focusVisual.position.copy(a),(e=this._photoManager.kCameraNear(this.earth.viewerCamera,a,t,r))?(this._focusVisual.material.color.setHex(65280),e):(this._focusVisual.material.color.setHex(16711680),console.warn("no nearby photo"),Promise.reject(new Error("No nearby photo.")))}},{key:"disposeCurrentDisplay",value:function(){this._currentPhotoCam&&(this._currentPhotoCam.photoDisplay.material.opacity=0)}},{key:"_fadeOutDisplay",value:function(e,t){var r=this;t>0?(e.material.opacity=t,t-=.5,setTimeout(function(){r._fadeOutDisplay(e,t)},100)):e.material.opacity=0}},{key:"crop",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this,n=e.map(function(e){return r.geoToProfile(e.lng,e.lat)});return t?this._cropMask.paintPolygon(n,"#f00"):(this._cropMask.clear("#f00"),this._cropMask.paintPolygon(n,"#0f0")),this._updateCropMask(),!0}},{key:"uncrop",value:function(e){var t=this,r=e&&e.length>2?e.map(function(e){return t.geoToProfile(e.lng,e.lat)}):[{u:0,v:0},{u:0,v:1},{u:1,v:1},{u:1,v:0},{u:0,v:0}];return this._cropMask.paintPolygon(r,"#0f0"),this._updateCropMask(),!0}},{key:"loadCropMask",value:function(){var e=this;return(0,u.loadMaskAPI)({api:e.apiService,pid:e.projInfo.PID,type:"crop"}).then(function(t){return e._cropMask.imageData={uint8:t.image.rgba,maskSize:t.maskSize},e._updateCropMask(),Promise.resolve(e)}).catch(function(e){return console.warn("[APM]",e),Promise.reject(e)})}},{key:"_updateCropMask",value:function(){this._tree.node_options.cropConfig.cropTex&&this._tree.node_options.cropConfig.cropTex.dispose(),this._tree.node_options.cropConfig.cropTex=this._cropMask.texture,this._tree.setDisplayMode(this._tree.node_options.viewModeType.TEXTURE),this._tree.setDisplayMode(this._tree.node_options.viewModeType.CROP)}},{key:"objToLayer",value:function(){return(new c.Matrix4).multiply(this.matrix.toThreeMatrix4()).multiply(this.shapeHolder.matrix).multiply(this.contentHolder.matrix).multiply(this.projHolder.matrix).multiply(this.displayHolder.matrix)}},{key:"objToEarth",value:function(){try{return(new c.Matrix4).getInverse(this.earth.earthToScene(),!0).multiply(this.objToScene())}catch(e){return void console.error(e)}}},{key:"earthToObj",value:function(){return this.sceneToObj().multiply(this.earth.earthToScene())}},{key:"objToScene",value:function(){return this.displayHolder.updateMatrixWorld(!0),this.displayHolder.matrixWorld.clone()}},{key:"sceneToObj",value:function(){return(new c.Matrix4).getInverse(this.objToScene(),!0)}},{key:"earthToProject",value:function(){return this.projHolder.updateMatrixWorld(!0),(new c.Matrix4).getInverse(this.projHolder.matrixWorld).multiply(this.earth.earthToScene())}},{key:"geoToProfile",value:function(e,t){var r=y.default.geographicToEarthSurface(p.default.EarthResolution,e,t,p.default.scale),n=this.earthToProject(),i=r.clone().applyMatrix4(n);return this.pointProjToProfile(i)}},{key:"pointProjToProfile",value:function(e){var t=this.projInfo,r=t.min_bound.clone(),n=t.max_bound.clone();return e.sub(r).divide(n.clone().sub(r)),{u:e.x,v:e.y,w:e.z}}},{key:"onContentInitialized",value:function(){this._onInitSuccess&&this._onInitSuccess(this)}},{key:"changeDisplayMode",value:function(e){return this._tree.setDisplayMode(e)}},{key:"matFromCameraInfo",value:function(e){var t=this.objToScene(),r=this.earth.earthToScene(),n=(new c.Matrix4).getInverse(r);if(e instanceof Array){var i=[];return e.map(function(e){i.push(o(e))}),i}return o(e);function o(e){var i=new c.Vector3(e.cameraPosition.x,e.cameraPosition.y,e.cameraPosition.z).applyMatrix4(t),o=new c.Vector3(e.centerPosition.x,e.centerPosition.y,e.centerPosition.z).applyMatrix4(t),a=new c.Vector3(e.cameraPosition.x,e.cameraPosition.y,e.cameraPosition.z).applyMatrix4(t);a=a.add(new c.Vector3(0,0,0).applyMatrix4(r).negate()).normalize();var s=(new c.Matrix4).lookAt(i,o,a).setPosition(i);return n.clone().multiply(s).elements}}},{key:"LngLatAltFromXYZ",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"obj",i=new c.Vector3(e,t,r);if("obj"===n)return i.applyMatrix4(this.objToEarth()),y.default.getLngLatAltFromNoneGroundCartesian(p.default.EarthResolution,i,p.default.scale);console.warn("space type not supported yet")}},{key:"focus",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).time,t=void 0===e?1:e,r=this.presetCameraMatrix;return r?this.earth.camera.flyToMat(r,t):Promise.reject(new Error("focus"))}},{key:"autoScale",set:function(e){if(!0===e&&(e=50),"number"==typeof e&&e>0){var t=this.projInfo.max_bound,r=this.projInfo.min_bound,n=t.x-r.x,i=t.y-r.y,o=e/(n>i?n:i);this.setPose(void 0,void 0,o),this._property.autoScale=e}}},{key:"projInfo",get:function(){return this._projInfo}},{key:"geoCoverage",get:function(){var e=this.projInfo.min_bound,t=this.projInfo.max_bound,r=(t.x-e.x)/2,n=(t.y-e.y)/2,i=(new c.Matrix4).getInverse(this.earth.earthToScene()),o=p.default.scale/p.default.EARTH_RADIUS,a=new c.Vector3(r,n,0).multiplyScalar(o),s=new c.Vector3(-r,-n,0).multiplyScalar(o),l=new c.Vector3(r,-n,0).multiplyScalar(o),u=new c.Vector3(-r,n,0).multiplyScalar(o);a.applyMatrix4(this.decoHolder.matrixWorld).applyMatrix4(i),s.applyMatrix4(this.decoHolder.matrixWorld).applyMatrix4(i),l.applyMatrix4(this.decoHolder.matrixWorld).applyMatrix4(i),u.applyMatrix4(this.decoHolder.matrixWorld).applyMatrix4(i);var h,f,d=y.default.getLngLatAltFromNoneGroundCartesian(p.default.EarthResolution,a,p.default.scale),m=y.default.getLngLatAltFromNoneGroundCartesian(p.default.EarthResolution,s,p.default.scale),v=y.default.getLngLatAltFromNoneGroundCartesian(p.default.EarthResolution,l,p.default.scale),g=y.default.getLngLatAltFromNoneGroundCartesian(p.default.EarthResolution,u,p.default.scale);return h=d.lng,f=d.lat,{maxLong:h,minLong:m.lng,maxLat:f,minLat:m.lat,boundaryPts:[d,g,m,v]}}},{key:"preferredPath",get:function(){for(var e=["oss_sz","oss_usw","local"],t=this._apiInfo.cloudPath,r=0;r<e.length;r++)for(var n=0;n<t.length;n++)if(t[n].key===e[r])return Object.defineProperty(this,"preferredPath",{value:t[n].dataUrl,writable:!1,configurable:!0}),this.preferredPath;console.error("preferredPath error",this._apiInfo,t,e)}},{key:"dataUrl",get:function(){var e=this.preferredPath;return e&&e.length>0&&"/"===e[0]?(e="https://www.altizure.com"+e,Object.defineProperty(this,"dataUrl",{value:e+"/web/",writable:!1,configurable:!0}),this.dataUrl):e+"/web/"}},{key:"apiService",get:function(){return this.earth.apiService}},{key:"water",get:function(){var e=this,t={import:function(){return e.importWater()},set speed(t){var r=e._waterManager;for(var n in r.maskSettings){r.maskSettings[n].speed=t}},get speed(){var t=e._waterManager;for(var r in t.maskSettings){return t.maskSettings[r].speed}return 0},set wave(t){var r=e._waterManager;for(var n in r.maskSettings){r.maskSettings[n].wave=t}},get wave(){var t=e._waterManager;for(var r in t.maskSettings){return t.maskSettings[r].wave}return 0},set color(t){var r=e._waterManager;for(var n in r.maskSettings){r.maskSettings[n].color=t}},get color(){var t=e._waterManager;for(var r in t.maskSettings){return t.maskSettings[r].color}return 0},get level(){return e.waterHolder?e.waterHolder.position.z:0},set level(t){e.waterHolder&&(e.waterHolder.position.z=t)}};return Object.defineProperty(this,"water",{value:t,writable:!1,configurable:!0}),this.water}},{key:"photos",get:function(){if(this._photoManager){var e=this,t={snap:e._snap.bind(this),getByName:function(t){return e._photoManager.cameraByName(t)},photoUrl:function(t){return e._photoManager.photoUrl(t.name)}};return Object.defineProperty(this,"photos",{value:t,writable:!1,configurable:!0}),this.photos}console.warn("photos are not initialized.")}},{key:"annotations",get:function(){var e=this,t=this._apiInfo.annotations.edges.map(function(e){return e.node}),r=this.matFromCameraInfo(t),n=[];return t.map(function(t,i){n.push(Object.assign({},t,{flyMat:r[i],position:e.LngLatAltFromXYZ(t.modelx,t.modely,t.modelz)}))}),n}},{key:"presetCameraMatrix",get:function(){var e=(new c.Matrix4).makeBasis(new c.Vector3(1,0,0),new c.Vector3(0,0,1),new c.Vector3(0,-1,0)),t=(new c.Matrix4).multiply(this.matrix.toThreeMatrix4()).multiply(this.shapeHolder.matrix).multiply(this.contentHolder.matrix).multiply(this.projHolder.matrix).clone().multiply(e),r=this._apiInfo.modelTransform.initialCamPos,n=r.cameraPos,i=r.centerPos;if(n&&i){var o=new(Function.prototype.bind.apply(c.Vector3,[null].concat(b(n)))),a=new(Function.prototype.bind.apply(c.Vector3,[null].concat(b(i)))),s=o.clone().applyMatrix4(t),l=a.clone().applyMatrix4(t),u=y.default.getLngLatAltFromNoneGroundCartesian(p.default.EarthResolution,s,p.default.scale),h=u.lng,f=u.lat,d=y.default.getGeoNormalOnEarthSurface(p.default.EarthResolution,h,f);return(new c.Matrix4).lookAt(s,l,d).setPosition(s).elements}console.warn("initialCamPos does not exist")}}],[{key:"quality",set:function(e){this._quality=e},get:function(){return void 0===this._quality&&(this._quality=60),this._quality}}]),t}();P._forest=null,P.MAXANISOTROPY=1,t.default=P,e.exports=t.default},i=[e,t,r(5),r(1),r(4),r(59),r(69),r(60),r(3),r(65),r(0),r(67),r(68)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SelfHelperFunctions=e.SelfShaderChunks=void 0;var r={deepCopyUniforms:function(e){var r=void 0,n=void 0,i=void 0,o={};for(r in e)for(n in o[r]={},e[r])(i=e[r][n])instanceof t.Color||i instanceof t.Vector2||i instanceof t.Vector3||i instanceof t.Vector4||i instanceof t.Matrix4?o[r][n]=i.clone():i instanceof t.Texture?(o[r][n]=i.clone(),o[r][n].needsUpdate=!0):i instanceof Array?o[r][n]=i.slice():(String,o[r][n]=i);return o},getFloatStringPair:function(e){return"number"==typeof e?{f:e,s:e.toString()}:"string"==typeof e?{f:parseFloat(e),s:e}:null}};e.SelfShaderChunks={DisplacementMapPositionCalculation_vertex:"\nuniform float displacementMapUsed;\nuniform sampler2D displacementMap;\nuniform float displacementScale;\nuniform float displacementBias;\nvec3 displacementMapOffset(vec3 normal, vec2 uv){\n  if(displacementMapUsed>0.5){\n    return normalize(normal) * (texture2D(displacementMap, uv).x * displacementScale + displacementBias);\n  }else{\n    return vec3(0.0);\n  }\n}\n",SimplePostProcessingColorCalculation_fragment:"\nuniform float red, green, blue, alpha;\nuniform float lighting;\nuniform vec2 contract;\nvec4 calculateSimplePostProcessingColor(vec4 color){\n  vec3 tempColor = color.rgb;\n  tempColor += vec3(red, blue, green);\n  for(int i=0;i<3;++i){\n      if(tempColor[i]<0.0)tempColor[i]=0.0;\n      else if(tempColor[i]>1.0)tempColor[i]=1.0;\n    }\n    if(lighting>0.0){\n      tempColor = log(tempColor*(lighting+1.0)+vec3(1.0))/log(vec3(lighting+2.0));\n    }\n    else{\n      tempColor = pow(tempColor,vec3(1.0-lighting));\n    }\n    for(int i=0;i<3;++i){\n      if(tempColor[i]<contract[0])tempColor[i]=0.0;\n      else if(tempColor[i]>contract[1])tempColor[i]=1.0;\n      else{\n        tempColor[i] = (tempColor[i]-contract[0])/(contract[1]-contract[0]);\n      }\n    }\n    return vec4(tempColor, color.a * alpha);\n}\n",MatrixTranspose:"\nfloat transpose(float m) {\n  return m;\n}\n\nmat2 transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0],\n              m[0][1], m[1][1]);\n}\n\nmat3 transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0],\n              m[0][1], m[1][1], m[2][1],\n              m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n              m[0][1], m[1][1], m[2][1], m[3][1],\n              m[0][2], m[1][2], m[2][2], m[3][2],\n              m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n",MatrixInverse:"\nfloat inverse(float m) {\n  return 1.0 / m;\n}\n\nmat2 inverse(mat2 m) {\n  return mat2(m[1][1],-m[0][1],\n             -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n              b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n              b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse(mat4 m) {\n  float\n      a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n      a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n      a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n      a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n      b00 = a00 * a11 - a01 * a10,\n      b01 = a00 * a12 - a02 * a10,\n      b02 = a00 * a13 - a03 * a10,\n      b03 = a01 * a12 - a02 * a11,\n      b04 = a01 * a13 - a03 * a11,\n      b05 = a02 * a13 - a03 * a12,\n      b06 = a20 * a31 - a21 * a30,\n      b07 = a20 * a32 - a22 * a30,\n      b08 = a20 * a33 - a23 * a30,\n      b09 = a21 * a32 - a22 * a31,\n      b10 = a21 * a33 - a23 * a31,\n      b11 = a22 * a33 - a23 * a32,\n\n      det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n      a11 * b11 - a12 * b10 + a13 * b09,\n      a02 * b10 - a01 * b11 - a03 * b09,\n      a31 * b05 - a32 * b04 + a33 * b03,\n      a22 * b04 - a21 * b05 - a23 * b03,\n      a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07,\n      a32 * b02 - a30 * b05 - a33 * b01,\n      a20 * b05 - a22 * b02 + a23 * b01,\n      a10 * b10 - a11 * b08 + a13 * b06,\n      a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00,\n      a21 * b02 - a20 * b04 - a23 * b00,\n      a11 * b07 - a10 * b09 - a12 * b06,\n      a00 * b09 - a01 * b07 + a02 * b06,\n      a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n",getSharpnessMapColor:"\nvec3 getSharpnessMapColor(sampler2D map, vec2 vUv, float mapWidth, float mapHeight){\n  vec3 result = vec3(0.0);\n  result += 5.0 * texture2D(map, vUv).rgb;\n  result += -1.0 * texture2D(map, vec2(vUv.x - 1.0/mapWidth, vUv.y)).rgb;\n  result += -1.0 * texture2D(map, vec2(vUv.x + 1.0/mapWidth, vUv.y)).rgb;\n  result += -1.0 * texture2D(map, vec2(vUv.x, vUv.y - 1.0/mapHeight)).rgb;\n  result += -1.0 * texture2D(map, vec2(vUv.x, vUv.y + 1.0/mapHeight)).rgb;\n  result /= 1.0;\n  return result;\n}\n"},e.SelfHelperFunctions=r},i=[t,r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,a=(o=i)&&o.__esModule?o:{default:o};var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var l={uniforms:{bumpMapUsed:{type:"f",value:0},bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1},bumpMapPath:{value:null},normalMapUsed:{type:"f",value:0},normalMap:{type:"t",value:null},normalScale:{type:"v2",value:[1,1]},normalMapPath:{value:null},displacementMapUsed:{type:"f",value:0},displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:0},displacementBias:{type:"f",value:0},displacementMapPath:{value:null},ka:{type:"v3",value:[.2,.2,.2]},mapKaUsed:{type:"f",value:0},mapKa:{type:"t",value:null},mapKaPath:{value:null},mapKaWidth:{type:"f",value:1},mapKaHeight:{type:"f",value:1},kd:{type:"v3",value:[.1,.1,1]},mapKdUsed:{type:"f",value:0},mapKd:{type:"t",value:null},mapKdPath:{value:null},mapKdWidth:{type:"f",value:1},mapKdHeight:{type:"f",value:1},ks:{type:"v3",value:[1,.1,.1]},mapKsUsed:{type:"f",value:0},mapKs:{type:"t",value:null},mapKsPath:{value:null},mapKsWidth:{type:"f",value:1},mapKsHeight:{type:"f",value:1},ns:{type:"f",value:20},d:{type:"f",value:1},diffuseOn:{type:"f",value:1},specularOn:{type:"f",value:1},ambientPercentage:{type:"f",value:100},diffusePercentage:{type:"f",value:100},specularPercentage:{type:"f",value:100}},vertexShader:"\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n"+n.SelfShaderChunks.DisplacementMapPositionCalculation_vertex+r.ShaderChunk.common+r.ShaderChunk.bsdfs+r.ShaderChunk.lights_pars_begin+"\nvoid main(){\n  vUv = uv;\n  vNormal = normalize(normalMatrix * normal);\n  vViewPosition = -(modelViewMatrix * vec4(position, 1.0)).xyz;\n  vec3 transformedPosition = position + displacementMapOffset(normal, uv);\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(transformedPosition, 1.0);\n}\n",fragmentShader:"\n#define USE_BUMPMAP\n#define USE_NORMALMAP\n\nuniform vec3 ka;\nuniform float mapKaUsed;\nuniform sampler2D mapKa;\nuniform float mapKaWidth;\nuniform float mapKaHeight;\nuniform vec3 kd;\nuniform float mapKdUsed;\nuniform sampler2D mapKd;\nuniform float mapKdWidth;\nuniform float mapKdHeight;\nuniform vec3 ks;\nuniform float mapKsUsed;\nuniform sampler2D mapKs;\nuniform float mapKsWidth;\nuniform float mapKsHeight;\nuniform float ns;\n\nuniform float d;\n\nuniform float bumpMapUsed;\nuniform float normalMapUsed;\n\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n\nuniform float diffuseOn;\nuniform float specularOn;\nuniform float ambientPercentage;\nuniform float diffusePercentage;\nuniform float specularPercentage;\n"+r.ShaderChunk.common+r.ShaderChunk.bsdfs+r.ShaderChunk.lights_pars_begin+r.ShaderChunk.bumpmap_pars_fragment+r.ShaderChunk.normalmap_pars_fragment+"\nvec3 getDiffuse(vec3 lightColor, vec3 direction, vec3 normal, vec3 diffuse){\n  return saturate(dot(direction, normal)) * lightColor * diffuse;\n}\n\nvec3 getSpecular(vec3 lightColor, vec3 direction, vec3 normal, vec3 position, vec3 camera, vec3 specular, float shininess){\n  vec3 viewDir = normalize(camera - position);\n  vec3 reflectedDir = 2.0 * dot(direction, normal) * normal - direction;\n  float specularTerm = max(0.0000001, dot(viewDir, reflectedDir));\n  specularTerm = pow(specularTerm, shininess);\n  return specularTerm * lightColor * specular;\n}\n\nvoid main(){\n  vec3 color = vec3(0.0);\n  vec3 modelPosition = -vViewPosition;\n  vec3 treatedNormal = normalize(vNormal);\n  if(bumpMapUsed>0.5)treatedNormal = perturbNormalArb(modelPosition, treatedNormal, dHdxy_fwd());\n  if(normalMapUsed>0.5)treatedNormal = perturbNormal2Arb( modelPosition, treatedNormal );\n  vec3 ambientColor = ka;\n  vec3 diffuseColor = kd;\n  vec3 specularColor = ks;\n  float shininess = ns;\n  vec3 ambientResultColor = vec3(0.0);\n  vec3 diffuseResultColor = vec3(0.0);\n  vec3 specularResultColor = vec3(0.0);\n  if(mapKaUsed>0.5){\n    ambientColor *= texture2D(mapKa, vUv).rgb;\n  }\n  if(mapKdUsed>0.5){\n    diffuseColor *= texture2D(mapKd, vUv).rgb;\n  }\n  if(mapKsUsed>0.5){\n    specularColor *= texture2D(mapKs, vUv).rgb;\n  }\n\n  ambientResultColor += ambientColor;\n  #if NUM_DIR_LIGHTS > 0\n    for(int i=0;i<NUM_DIR_LIGHTS;++i){\n      if(diffuseOn>0.5){\n        diffuseResultColor += getDiffuse(directionalLights[i].color, directionalLights[i].direction, treatedNormal, diffuseColor);\n      }\n\n      if(specularOn>0.5){\n        specularResultColor += getSpecular(\n          directionalLights[i].color, directionalLights[i].direction, treatedNormal, modelPosition, cameraPosition, specularColor, shininess\n        );\n      }\n    }\n  #endif\n  #if NUM_POINT_LIGHTS > 0\n    for(int i=0;i<NUM_POINT_LIGHTS;++i){\n      vec3 direction = normalize(pointLights[i].position - modelPosition);\n      if(diffuseOn>0.5){\n        diffuseResultColor += getDiffuse(pointLights[i].color, direction, treatedNormal, diffuseColor);\n      }\n\n      if(specularOn>0.5){\n        specularResultColor += getSpecular(\n          pointLights[i].color, direction, treatedNormal, modelPosition, cameraPosition, specularColor, shininess\n        );\n      }\n    }\n  #endif\n  diffuseResultColor += diffuseColor * RECIPROCAL_PI; // indirect diffuse color\n\n  color += ambientResultColor * ambientPercentage / 100.0;\n  color += diffuseResultColor * diffusePercentage / 100.0;\n  color += specularResultColor * specularPercentage / 100.0;\n  gl_FragColor = vec4(color, d);\n}\n"},u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i=JSON.parse(JSON.stringify(l.uniforms));return n.uniforms=r.UniformsUtils.merge([r.UniformsLib.lights,i]),n.vertexShader=l.vertexShader,n.fragmentShader=l.fragmentShader,n.transparent=!0,n.extensions.derivatives=!0,n.lights=!0,n.description={},n.description.type="MTLPhongShaderMaterial",n.loadMTLOptions(e),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.ShaderMaterial),s(t,[{key:"loadMTLOptions",value:function(e){if(void 0!==e&&null!==e&&Object.keys(e).length>0){if(this.name=e.name,this.description.name=e.name,e.ka&&(this.uniforms.ka.value=e.ka,this.description.ka=e.ka),e.kd&&(this.uniforms.kd.value=e.kd,this.description.kd=e.kd),e.ks&&(this.uniforms.ks.value=e.ks,this.description.ks=e.ks),e.ns){var t=n.SelfHelperFunctions.getFloatStringPair(e.ns);t&&(this.uniforms.ns.value=t.f,this.description.ns=t.s)}if(e.d){var r=n.SelfHelperFunctions.getFloatStringPair(e.ns);r&&(this.uniforms.d.value=r.f,this.description.d=r.s)}var i=e.bump,o=e.map_kd;void 0!==o&&null!==o&&(this._loadTexture(o,this.uniforms.mapKd,this.uniforms.mapKdUsed,this.uniforms.mapKdPath,this.uniforms.mapKdWidth,this.uniforms.mapKdHeight),this.description.map_kd=o),void 0!==i&&null!==i&&(this._loadTexture(i,this.uniforms.bumpMap,this.uniforms.bumpMapUsed,this.uniforms.bumpMapPath),this.description.bump=i);var a=e.mapKaPath;if(void 0!==a&&null!==a&&(this._loadTexture(a,this.uniforms.mapKa,this.uniforms.mapKaUsed,this.uniforms.mapKaPath,this.uniforms.mapKaWidth,this.uniforms.mapKaHeight),this.description.mapKaPath=a),e.ambientPercentage){var s=n.SelfHelperFunctions.getFloatStringPair(e.ambientPercentage);s&&(this.uniforms.ambientPercentage.value=s.f,this.description.ambientPercentage=s.s)}if(e.diffuseOn){var l=n.SelfHelperFunctions.getFloatStringPair(e.diffuseOn);l&&(this.uniforms.diffuseOn.value=l.f,this.description.diffuseOn=l.s)}if(e.diffusePercentage){var u=n.SelfHelperFunctions.getFloatStringPair(e.diffusePercentage);u&&(this.uniforms.diffusePercentage.value=u.f,this.description.diffusePercentage=u.s)}var c=e.mapKsPath;if(void 0!==c&&null!==c&&(this._loadTexture(c,this.uniforms.mapKs,this.uniforms.mapKsUsed,this.uniforms.mapKsPath,this.uniforms.mapKsWidth,this.uniforms.mapKsHeight),this.description.mapKsPath=c),e.specularOn){var h=n.SelfHelperFunctions.getFloatStringPair(e.specularOn);h&&(this.uniforms.specularOn.value=h.f,this.description.specularOn=h.s)}if(e.specularPercentage){var f=n.SelfHelperFunctions.getFloatStringPair(e.specularPercentage);f&&(this.uniforms.specularPercentage.value=f.f,this.description.specularPercentage=f.s)}}}},{key:"setAmbientTexture",value:function(e){this._loadTexture(e,this.uniforms.mapKa,this.uniforms.mapKaUsed,this.uniforms.mapKaPath,this.uniforms.mapKaWidth,this.uniforms.mapKaHeight),this.description.mapKaPath=e}},{key:"setAmbientColor",value:function(e){this.uniforms.ka.value=e.slice(0,3),this.description.ka=e.slice(0,3)}},{key:"setAmbientPercentage",value:function(e){var t=n.SelfHelperFunctions.getFloatStringPair(e);t&&(this.uniforms.ambientPercentage.value=t.f,this.description.ambientPercentage=t.s)}},{key:"setDiffuseTexture",value:function(e){this._loadTexture(e,this.uniforms.mapKd,this.uniforms.mapKdUsed,this.uniforms.mapKdPath,this.uniforms.mapKdWidth,this.uniforms.mapKdHeight),this.description.map_kd=e}},{key:"setDiffuseColor",value:function(e){this.uniforms.kd.value=e.slice(0,3),this.description.kd=e.slice(0,3)}},{key:"setDiffuseState",value:function(e){var t=n.SelfHelperFunctions.getFloatStringPair(e);t&&(this.uniforms.diffuseOn.value=t.f,this.description.diffuseOn=t.s)}},{key:"setDiffusePercentage",value:function(e){var t=n.SelfHelperFunctions.getFloatStringPair(e);t&&(this.uniforms.diffusePercentage.value=t.f,this.description.diffusePercentage=t.s)}},{key:"setSpecularTexture",value:function(e){this._loadTexture(e,this.uniforms.mapKs,this.uniforms.mapKsUsed,this.uniforms.mapKsPath,this.uniforms.mapKsWidth,this.uniforms.mapKsHeight),this.description.mapKsPath=e}},{key:"setSpecularColor",value:function(e){this.uniforms.ks.value=e.slice(0,3),this.description.ks=e.slice(0,3)}},{key:"setSpecularState",value:function(e){var t=n.SelfHelperFunctions.getFloatStringPair(e);t&&(this.uniforms.specularOn.value=t.f,this.description.specularOn=t.s)}},{key:"setSpecularShininess",value:function(e){var t=n.SelfHelperFunctions.getFloatStringPair(e);t&&(this.uniforms.ns.value=t.f,this.description.ns=t.s)}},{key:"setSpecularPercentage",value:function(e){var t=n.SelfHelperFunctions.getFloatStringPair(e);t&&(this.uniforms.specularPercentage.value=t.f,this.description.specularPercentage=t.s)}},{key:"getAmbient",value:function(){return{color:this.array2Hex(this.uniforms.ka.value),textureUsed:this.uniforms.mapKaUsed.value,texturePath:this.uniforms.mapKaPath.value,percentage:this.uniforms.ambientPercentage.value}}},{key:"getDiffuse",value:function(){return{state:this.uniforms.diffuseOn.value,color:this.array2Hex(this.uniforms.kd.value),textureUsed:this.uniforms.mapKdUsed.value,texturePath:this.uniforms.mapKdPath.value,percentage:this.uniforms.diffusePercentage.value}}},{key:"getSpecular",value:function(){return{state:this.uniforms.specularOn.value,color:this.array2Hex(this.uniforms.ks.value),textureUsed:this.uniforms.mapKsUsed.value,texturePath:this.uniforms.mapKsPath.value,percentage:this.uniforms.specularPercentage.value,shininess:this.uniforms.ns.value}}},{key:"array2Hex",value:function(e){return"#"+Math.round(255*e[0]).toString(16)+Math.round(255*e[1]).toString(16)+Math.round(255*e[2]).toString(16)}},{key:"_loadTexture",value:function(e,t,n,i,o,s){if(""!==e){var l=new a.default;l.setCrossOrigin("anonymous"),l.withCredentials=!0,l.load(e,function(a){a.wrapS=r.RepeatWrapping,a.wrapT=r.RepeatWrapping,t.value=a,o&&(o.value=parseFloat(a.image.width)),s&&(s.value=parseFloat(a.image.height)),i.value=e,n.value=1},function(e){},function(t){console.warn("an error happened while loading "+e)})}else n.value=0}},{key:"clone",value:function(){return new this.constructor(this.description)}}]),t}();t.default=u,e.exports=t.default},i=[e,t,r(0),r(14),r(8)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=u(r),s=u(i),l=u(o);function u(e){return e&&e.__esModule?e:{default:e}}var c=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var f=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var m=function(e){function t(e){h(this,t);var r=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i=e.pinLength,o=e.color,a=e.depthTest;r.visible=i>0,null!==t.geoCache&&void 0!==t.geoCache||(t.geoCache={});var u=new n.LineBasicMaterial({color:o,depthTest:a}),c=void 0;t.geoCache.lineGeo?c=t.geoCache.lineGeo:((c=new n.Geometry).vertices.push(new n.Vector3(0,0,0),new n.Vector3(0,0,1)),c.verticesNeedUpdate=!0,t.geoCache.lineGeo=c);var f=new n.LineSegments(c,u);r.visible&&f.scale.set(i,i,i),r.pinLine=f,r.pinLine.renderOrder=l.default.SPRITE_PIN_RENDER_ORDER,r.add(r.pinLine);var p=void 0;t.geoCache.pinGeo?p=t.geoCache.pinGeo:(p=new n.SphereBufferGeometry(1,32,32),t.geoCache.pinGeo=p);var m=new n.MeshBasicMaterial({color:o,depthTest:a}),v=new n.Mesh(p,m);v.position.set(0,0,i);var g=1*s.default.scale/s.default.EARTH_RADIUS;return v.scale.set(g,g,g),r.pinHead=v,r.pinHead.renderOrder=l.default.SPRITE_PIN_RENDER_ORDER,r.add(r.pinHead),r}return p(t,n.Object3D),f(t,[{key:"destruct",value:function(){this.pinHead&&(this.pinHead.material&&(this.pinHead.material.map&&this.pinHead.material.map.dispose(),this.pinHead.material.dispose()),this.remove(this.pinHead),this.pinHead=null),this.pinLine&&(this.pinLine.material&&this.pinLine.material.dispose(),this.remove(this.pinLine),this.pinLine=null)}},{key:"pinLength",set:function(e){this.visible=e>0,this.visible&&this.pinHead&&this.pinLine&&this.pinLine.geometry&&(this.pinHead.position.set(0,0,e),this.pinLine.scale.set(e,e,e))}},{key:"color",set:function(e){this.pinHead&&this.pinHead.material&&this.pinLine&&this.pinLine.material&&(this.pinHead.material.color=e,this.pinLine.material.color=e)}},{key:"depthTest",set:function(e){this.pinHead&&this.pinHead.material&&this.pinLine&&this.pinLine.material&&(this.pinLine.material.depthTest=e,this.pinHead.material.depthTest=e)}}]),t}();m.geoCache=null;var v=function(e){function t(e){h(this,t);var r=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r._depthTest=!!e.depthTest&&e.depthTest,r._property.depthTest=r._depthTest,r._pinLength=void 0===e.pinLength||null===e.pinLength?0:e.pinLength,r._property.pinLength=r._pinLength,r._color=e.color?e.color:16753920,r._property.color=r._color,r._isSprite=e.isSprite||void 0===e.isSprite,r._property.isSprite=r._isSprite,r._visible=!e.visible||e.visible,r._property.visible=r._visible,r._scale=e.scale?e.scale:1,r._property.scale=r._scale,r._spriteScaleRatio=s.default.scale/5e5,r._aspectRatio=1,r._property.type="PlaneMarker",r._pivot={x:.5,y:.5},e.pivot&&"number"==typeof e.pivot.x&&"number"==typeof e.pivot.y&&(r._pivot=e.pivot);var i=r._pinLength*s.default.scale/s.default.EARTH_RADIUS,o={pinLength:i,depthTest:!0,color:r._color};r.pin=new m(o),r.sceneNode.add(r.pin);var a=void 0;if(r._isSprite){var u=new n.SpriteMaterial({map:null,color:16777215,depthTest:r._depthTest});(a=new n.Sprite(u)).center.set(r._pivot.x,r._pivot.y)}else{var c=new n.PlaneBufferGeometry(1,1);c.translate(.5-r._pivot.x,.5-r._pivot.y,0);var f=new n.MeshBasicMaterial({map:null,color:16777215,depthTest:r._depthTest,transparent:!0,side:n.DoubleSide});(a=new n.Mesh(c,f)).quaternion.setFromAxisAngle(new n.Vector3(1,0,0),Math.PI/2)}return a.position.set(0,0,i),a.scale.set(r._spriteScaleRatio*r._scale,r._spriteScaleRatio*r._scale,1),r.sprite=a,r.sprite.renderOrder=l.default.SPRITE_PIN_RENDER_ORDER,r.setContent(r.sprite),r.interactShape=r.sprite.clone(),r.fixedSize=e.fixedSize,r}return p(t,a.default),f(t,[{key:"animate",value:function(e){c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"animate",this).call(this,e);var r=e.camera.position;if(this.isSprite&&this.fixedSize>0){var n=1e5*this.sprite.position.clone().applyMatrix4(this.sprite.matrixWorld).sub(r).length()/316*this.fixedSize;this.scale=n}}},{key:"destruct",value:function(){this.interactable&&(this.interactable=!1),this.sprite&&(this.sprite.geometry&&this.sprite.geometry.dispose(),this.sprite.material&&(this.sprite.material.map&&this.sprite.material.map.dispose(),this.sprite.material.dispose())),this.pin&&this.pin.destruct(),this.unsetContent(),c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"setPose",value:function(e,r,n){if(c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setPose",this).call(this,e,r,void 0),this.sprite&&n&&"number"==typeof n){if(this.sprite.scale.set(this._aspectRatio*this._spriteScaleRatio*n,this._spriteScaleRatio*n,1),this.interactShape.scale.set(this._aspectRatio*this._spriteScaleRatio*n,this._spriteScaleRatio*n,1),this.pin&&this.pin.pinHead){var i=s.default.scale/s.default.EARTH_RADIUS*n;this.pin.pinHead.scale.set(i,i,i)}this._scale=n,this._property.scale=n}}},{key:"isSprite",set:function(e){if(this._isSprite!==e){this._isSprite=e;var t=this.sprite,r=void 0;if(this._isSprite){var i=new n.SpriteMaterial({map:t.material.map,color:t.material.color,depthTest:t.material.depthTest});(r=new n.Sprite(i)).center.set(this._pivot.x,this._pivot.y)}else{var o=new n.PlaneBufferGeometry(1,1);o.translate(.5-this._pivot.x,.5-this._pivot.y,0);var a=new n.MeshBasicMaterial({map:t.material.map,color:t.material.color,depthTest:t.material.depthTest,transparent:!0,side:n.DoubleSide});(r=new n.Mesh(o,a)).quaternion.setFromAxisAngle(new n.Vector3(1,0,0),Math.PI/2)}r.position.copy(t.position),r.scale.copy(t.scale),this.contentHolder.remove(this.sprite),this.sprite&&(this.sprite.geometry&&this.sprite.geometry.dispose(),this.sprite.material&&(this.sprite.material.map&&this.sprite.material.map.dispose(),this.sprite.material.dispose())),this.shapeHolder.remove(this._interactShape),this._interactShape&&(this._interactShape.geometry&&this._interactShape.geometry.dispose(),this._interactShape.material&&(this._interactShape.material.map&&this._interactShape.material.map.dispose(),this._interactShape.material.dispose())),this.sprite=r,this.sprite.renderOrder=l.default.SPRITE_PIN_RENDER_ORDER,this.contentHolder.add(this.sprite),this._interactShape=this.sprite.clone()}},get:function(){return this._isSprite}},{key:"fixedSize",set:function(e){this.isSprite?(!0===(e=void 0!==e&&e)&&(e=200),!1!==e&&"number"!=typeof e&&(e=!1),this._fixedSize=e):console.warn("[PlaneMarker] only when isSprite is true, the fixedSize can be in effect",e)},get:function(){return this._fixedSize}},{key:"tagQuaternion",set:function(e){if(!this._isSprite&&this.sprite)if(e.isEuler)this.sprite.setRotationFromEuler(new n.Euler(e.x,e.y,e.z,e.order));else if(e instanceof n.Quaternion)this.sprite.setRotationFromQuaternion(e);else{var t=new n.Vector3(e.x,e.y,e.z);t.normalize(),this.sprite.rotateOnAxis(t,e.w)}}},{key:"pivot",set:function(e){var t=Object.assign({},this._pivot,e),r=t.x,n=t.y;if(this.sprite){if(this.sprite.isSprite)this.sprite.center.set(r,n),this._interactShape.center.set(r,n);else{for(var i=[-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],o=0;o<i.length;o+=3)i[o]+=.5-r,i[o+1]+=.5-n;this.sprite.geometry.attributes.position.setArray(new Float32Array(i)),this.sprite.geometry.attributes.position.needsUpdate=!0,this._interactShape.geometry.attributes.position.setArray(new Float32Array(i)),this._interactShape.geometry.attributes.position.needsUpdate=!0}this._pivot=t}},get:function(){return this._pivot}},{key:"texture",set:function(e){if(this.sprite&&this.sprite.material){this.sprite.material.map&&(this.sprite.material.map.dispose(),this.sprite.material.map=null),this.sprite.material.map=e.texture,this.sprite.material.needsUpdate=!0;var t=e.aspectRatio;this._aspectRatio=t,this.sprite.scale.set(t*this._spriteScaleRatio*this._scale,this._spriteScaleRatio*this._scale,1),this.interactShape.scale.set(t*this._spriteScaleRatio*this._scale,this._spriteScaleRatio*this._scale,1)}}},{key:"depthTest",set:function(e){this.sprite&&this.sprite.material&&(this.sprite.material.depthTest=e,this._depthTest=e,this._property.depthTest=e)},get:function(){return this._depthTest}},{key:"pinLength",set:function(e){if(!(e<0)){var t=e*s.default.scale/s.default.EARTH_RADIUS;this.pin&&this.sprite&&(this.pin.pinLength=t,this.sprite.position.set(0,0,t),this.interactShape.position.copy(this.sprite.position),this._pinLength=e,this._property.pinLength=e)}},get:function(){return this._pinLength}},{key:"color",set:function(e){this.pin&&this.sprite&&this.sprite.material&&(this.pin.color=new n.Color(e),this._color=e,this._property.color=e)},get:function(){return this._color}},{key:"scale",set:function(e){this.setPose(void 0,void 0,e)},get:function(){return this._scale}},{key:"visible",set:function(e){!function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visible",e,this),this._visible=e,this.pin&&(this._pinLength>0?this.pin.visible=e:this.pin.visible=!1)},get:function(){return this._visible}}]),t}();t.default=v,e.exports=t.default},i=[e,t,r(5),r(0),r(1),r(7)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(r),o=a(n);function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n};var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(!function(e){if(!e.text)return!1;return e.textStyle=e.textStyle||{},Object.assign({margin:0,lineHeight:.1,align:"center",fillStyle:"black",font:"normal normal 24px Arial",outlineWidth:2,outlineStyle:"black",resetCursorY:!0,trimText:!0},e.textStyle),!0}(e))return console.warn("TextTagMarker invalid init",e),void 0,l(r,void 0);return r._property.type="TextTagMarker",r._property.text=e.text,r._text=e.text,r._textStyle=e.textStyle,r._createTextTexture(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),s(t,[{key:"destruct",value:function(){(function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"_createTextTexture",value:function(){var e=Object.assign({},this._textStyle,{text:this.text}),r=new o.default(512,64);r.drawTextCooked(e),u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"texture",{texture:r.texture,aspectRatio:8},this)}},{key:"text",get:function(){return this._text},set:function(e){if(e&&e.length>0){var r=Object.assign({},this._textStyle,{text:e}),n=new o.default(512,64);n.drawTextCooked(r),u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"texture",{texture:n.texture,aspectRatio:8},this),this._text=e}}},{key:"textStyle",set:function(e){this._textStyle=Object.assign({},this._textStyle,e);var r=Object.assign({},this._textStyle,{text:this._text}),n=new o.default(512,64);n.drawTextCooked(r),u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"texture",{texture:n.texture,aspectRatio:8},this)}}]),t}();t.default=c,e.exports=t.default},i=[e,t,r(16),r(18)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,n){var i=document.createElement("canvas");i.width=e,i.height=t,this.canvas=i,this.style=n||{},this.style={margin:void 0===this.style.margin?0:this.style.margin};var o=i.getContext("2d");this.context=o;var a=new r.Texture(i);this.texture=a,this.cursorY=0};n.prototype.clear=function(e){return void 0!==e?(this.context.fillStyle=e,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)):this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.texture.needsUpdate=!0,this},n.prototype.drawText=function(e,t,r,n,i){if(void 0!==i&&(this.context.font=i),void 0===t||null===t){var o=this.context.measureText(e);t=(this.canvas.width-o.width)/2}return this.context.fillStyle=n,this.context.strokeStyle="black",this.context.lineJoin="round",this.context.fillText(e,t,r),this.context.lineWidth=1,this.context.strokeText(e,t,r),this.context.fill(),this.context.stroke(),this.texture.needsUpdate=!0,this},n.prototype.drawTextCooked=function(e){var t=this,r=this.context,n=this.canvas,i=(e=e||{}).text,o={margin:void 0!==e.margin?e.margin:0,lineHeight:void 0!==e.lineHeight?e.lineHeight:.1,align:void 0!==e.align?e.align:"center",fillStyle:void 0!==e.fillStyle?e.fillStyle:"rgb(255, 255, 255)",font:void 0!==e.font?e.font:"bold 102.4px Arial",outlineWidth:void 0!==e.outlineWidth?e.outlineWidth:2,outlineStyle:void 0!==e.outlineStyle?e.outlineStyle:"black",resetCursorY:void 0===e.resetCursorY||e.resetCursorY,trimText:void 0===e.trimText||e.trimText},a=o.lineHeight,s=o.margin;o.lineHeight<1&&(a=o.lineHeight*n.height),o.margin<1&&(s=o.margin*n.height),console.assert("string"==typeof i),r.save(),r.fillStyle=o.fillStyle,r.lineJoin="round",r.font=o.font,r.textBaseline="top";var l=s+this.style.margin;o.resetCursorY||(l=this.cursorY+s);do{var u="";u=o.trimText?d(i):f(i),i=i.substr(u.length);var c=r.measureText(u),h=0;"left"===o.align?h=s+this.style.margin:"right"===o.align?h=n.width-s-c.width-this.style.margin:"center"===o.align?h=(n.width-c.width)/2:console.assert(!1),this.context.lineWidth=Math.max(1,o.outlineWidth),this.context.strokeStyle=o.outlineStyle,this.context.strokeText(u,h,l),this.context.fillText(u,h,l),l+=a}while(i.length>0&&!o.trimText);return r.restore(),this.cursorY=l,this.texture.needsUpdate=!0,this;function f(e){for(var i="",o=n.width-2*t.style.margin-2*s;i.length!==e.length;){if(r.measureText(i).width>o)break;i+=e.substr(i.length,1)}return i}function d(e){var i="",o=n.width-2*t.style.margin-2*s;if(r.measureText(e).width<o)return e.substr(0,e.length);var a=e.length-1;i=e.substr(0,a)+" ...";for(var l=r.measureText(i).width;a>0&&l>3*o;)a/=2,i=e.substr(0,a)+" ...",l=r.measureText(i).width;for(;a>0&&l>o;)a-=1,i=e.substr(0,a)+" ...",l=r.measureText(i).width;return i}},n.prototype.drawImage=function(){return this.context.drawImage.apply(this.context,arguments),this.texture.needsUpdate=!0,this},n.prototype.drawRectangle=function(e,t,r,n,i){return i={outlineWidth:(i=i||{}).outlineWidth||2,outlineStyle:i.outlineStyle||"rgb(0, 0, 0)",fillStyle:i.fillStyle||null},this.context.save(),null!==i.fillStyle&&(this.context.fillStyle=i.fillStyle,this.context.fillRect(e,t,r,n)),i.outlineWidth>0&&(this.context.strokeStyle=i.outlineStyle,this.context.lineWidth=i.outlineWidth,this.context.strokeRect(e,t,r,n)),this.context.restore(),this.texture.needsUpdate=!0,this},n.prototype.drawCircle=function(e,t,r,n){return n={outlineWidth:void 0===(n=n||{}).outlineWidth?2:2*n.outlineWidth,outlineStyle:void 0===n.outlineStyle?"rgb(0, 0, 0)":n.outlineStyle,fillStyle:void 0===n.fillStyle?null:n.fillStyle},this.context.save(),this.context.arc(e,t,r,0,2*Math.PI),n.outlineWidth>0&&(this.context.strokeStyle=n.outlineStyle,this.context.lineWidth=n.outlineWidth,this.context.stroke()),null!==n.fillStyle&&(this.context.fillStyle=n.fillStyle,this.context.fill()),this.context.restore(),this.texture.needsUpdate=!0,this},t.default=n,e.exports=t.default},i=[e,t,r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=s(n),a=s(i);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n};var h=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=e.volume;if(!function(){var t=!0;if(!(t=t&&void 0===e.scale))return console.error("PolygonMarker should not be scaled, used lng lat directly."),t;try{n=Object.assign({},{height:100,color:16711680,opacity:.1},n)}catch(e){console.error("PolygonMarker init defaults failed.",n),t=!1}(t=t&&"number"==typeof n.top)||console.error("PolygonMarker top must be a number",n.top);(t=t&&"number"==typeof n.bottom)||console.error("PolygonMarker bottom must be a number",n.top);return t}())return console.error("PolygonMarker construction failed."),void 0,u(a,void 0);var i=!e.depthTest||e.depthTest,a=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a._top=n.top,a._bottom=n.bottom,a._depthTest=i;var s=new o.default(a.extrudeMesh.geometry),l=new r.LineSegments(s,new r.LineBasicMaterial({color:n.color,linewidth:2,depthTest:i}));return a.extrudeLine=l,a.setDecoration(a.extrudeLine),a._color=n.color,a._property.type="PolygonMarker",a._property.volume=n,a._property.name=e.name,a._property.depthTest=a._depthTest,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),l(t,[{key:"destruct",value:function(){this.interactable&&(this.interactable=!1),this.unsetContent(),this.extrudeLine&&(this.extrudeLine.geometry&&this.extrudeLine.geometry.dispose(),this.extrudeLine.material&&this.extrudeLine.material.dispose()),function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"depthTest",set:function(e){this._depthTest=e,this.extrudeMesh&&this.extrudeMesh.material&&(this.extrudeMesh.material.depthTest=this._depthTest),this.extrudeLine&&this.extrudeLine.material&&(this.extrudeLine.material.depthTest=this._depthTest)},get:function(){return this._depthTest}},{key:"color",set:function(e){var t=new r.Color(e);this.extrudeMesh.material.color=t,this.extrudeMesh.material.needsUpdate=!0,this.extrudeLine.material.color=t,this.extrudeLine.material.needsUpdate=!0,this._property.volume.color=e},get:function(){return this.extrudeMesh.material.color}},{key:"opacity",set:function(e){return"number"!=typeof e?(console.warn("wrong opacity type"),!1):(e=Math.min(1,Math.max(0,e)),this.extrudeMesh.material.opacity=e,this.extrudeMesh.material.needsUpdate=!0,this._property.volume.opacity=e,!0)},get:function(){return this.extrudeMesh.material.opacity}},{key:"top",set:function(e){"number"==typeof e?(c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"top",e,this),this.extrudeLine.geometry&&this.extrudeLine.geometry.dispose(),this.extrudeLine.geometry=new o.default(this.extrudeMesh.geometry),this._top=e,this._property.volume.top=this._top):console.warn("PolygonMarker setter top: input can only be a number",e)},get:function(){return this._top}},{key:"bottom",set:function(e){"number"==typeof e?(c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"bottom",e,this),this.extrudeLine.geometry&&this.extrudeLine.geometry.dispose(),this.extrudeLine.geometry=new o.default(this.extrudeMesh.geometry),this._bottom=e,this._property.volume.bottom=this._bottom):console.warn("PolygonMarker setter bottom: input can only be a number",e)},get:function(){return this._bottom}}]),t}();t.default=h,e.exports=t.default},i=[e,t,r(0),r(31),r(20)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=h(r),l=h(n),u=h(i),c=h(o);function h(e){return e&&e.__esModule?e:{default:e}}var f=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var p=function(e){function t(e){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!function(e){var t=!0;void 0!==e.scale&&(console.error("PolygonBaseMarker should not be scaled, use lng lat directly."),t=!1);var r=e.volume.points;r[0].array||(r=[{array:r,hole:!1}],e.volume.points=r);for(var n=0,i=0;i<r.length;++i)r[i].hole||(n+=1);1!==n&&(console.error("PolygonBaseMarker points must have one and only one outer points array that is not hole"),t=!1);for(var o=0;o<r.length;++o){var a=r[o].array;if(a.length<4){console.error("PolygonBaseMarker needs at least 4 points",r,o),t=!1;break}if(!a[0].equals(a[a.length-1])){console.error("PolygonBaseMarker points are not closed. (first and last points should be equal)",r,o),t=!1;break}}var s=e.volume.top;if(Array.isArray(s)){Array.isArray(s[0])||(s=[s],e.volume.top=s);for(var l=0;l<r.length;++l){var u=r[l].array;if(s[l].length!==u.length-1){console.error("PolygonBaseMarker top array must be of length ",u.length-1,s),t=!1;break}}}var c=e.volume.bottom;if(Array.isArray(c)){Array.isArray(c[0])||(c=[c],e.volume.bottom=c);for(var h=0;h<r.length;++h){var f=r[h].array;if(c[h].length!==f.length-1){console.error("PolygonBaseMarker bottom array must be of length ",f.length-1,c),t=!1;break}}}return t}(e))return void 0,d(s,void 0);var r=e.volume,n=r.points,i=void 0===e.depthTest||null===e.depthTest||e.depthTest;r=Object.assign({},{top:1,bottom:0,hasTopCover:!0,hasBottomCover:!0,color:16777215,opacity:.1},r);var o=function(){for(var e=void 0,t=0;t<n.length;++t)if(!n[t].hole){e=n[t];break}for(var o=new l.default(0,0,0),s=0;s<e.array.length;++s)o.lng+=e.array[s].lng,o.lat+=e.array[s].lat;o.lng/=e.array.length,o.lat/=e.array.length;for(var h=u.default.getLocalSystemOnEarthSurface(c.default.EarthResolution,o.lng,o.lat,c.default.scale),f=new a.ShapePath,d=[],p=function(e){for(var t=n[e],r=[],i=0;i<t.array.length;++i){var o=u.default.geographicToEarthSurface(c.default.EarthResolution,t.array[i].lng,t.array[i].lat,c.default.scale),s=o.clone().sub(h.origin),l=1*s.dot(h.lng),p=1*s.dot(h.lat),m=s.dot(h.alt);r.push(new a.Vector3(l,p,m))}var v=new a.Matrix4;v.makeScale(1e7,1e7,1e7),r=r.map(function(e){return e.applyMatrix4(v)});for(var g=0;g<r.length-1;g++)d.push(r[g].x),d.push(r[g].y);var y=a.ShapeUtils.isClockWise(r);(y&&!t.hole||!y&&t.hole)&&r.reverse(),f.moveTo(r[0].x,r[0].y);for(var _=1;_<r.length;_++)f.lineTo(r[_].x,r[_].y)},m=0;m<n.length;++m)p(m);d=new Float32Array(d);for(var v=f.toShapes(!0),g={steps:1,amount:c.default.scale/c.default.EARTH_RADIUS*1e7,bevelEnabled:!1},y=new a.ExtrudeGeometry(v[0],g),_=1;_<v.length;++_){var w=v[_];y.addShape(w,g)}var b={top:{},bottom:{}},x=y.vertices,k=Math.floor(y.vertices.length/2),A=y.vertices.length,M={top:{},bottom:{}};function S(e,t,r){var n=Math.round(e.x*t);n=Math.floor(n/r);var i=Math.round(e.y*t);return i=Math.floor(i/r),n+"_"+i}for(var P=0;P<k;++P){var T=S(x[P],1e4,10);M.bottom[T]=P}for(var O=k;O<A;++O){var C=S(x[O],1e4,10);M.top[C]=O}for(var E=0;E<d.length/2;++E){var I=2*E,R=S({x:d[I],y:d[I+1]},1e4,10);b.top[E]=M.top[R],b.bottom[E]=M.bottom[R]}if(y.applyMatrix((new a.Matrix4).makeScale(1e-7,1e-7,1e-7)),"number"==typeof r.top){for(var L=k;L<A;++L)x[L].z=r.top*c.default.scale/c.default.EARTH_RADIUS;y.verticesNeedUpdate=!0}else if(Array.isArray(r.top)){for(var j=0,z=0;z<r.top.length;++z)for(var B=0;B<r.top[z].length;++B){var D=b.top[j];j+=1,x[D].z=r.top[z][B]*c.default.scale/c.default.EARTH_RADIUS}y.verticesNeedUpdate=!0}if("number"==typeof r.bottom){for(var N=0;N<k;++N)x[N].z=r.bottom*c.default.scale/c.default.EARTH_RADIUS;y.verticesNeedUpdate=!0}else if(Array.isArray(r.bottom)){for(var U=0,F=0;F<r.bottom.length;++F)for(var H=0;H<r.bottom[F].length;++H){var V=b.bottom[U];U+=1,x[V].z=r.bottom[F][H]*c.default.scale/c.default.EARTH_RADIUS}y.verticesNeedUpdate=!0}for(var W=0,G=0;G<n.length;++G)W+=n[G].array.length-1;W*=2;var Y=(y.faces.length-W)/2,K=y.faces.slice(0,Y),X=y.faces.slice(Y,2*Y),Z=y.faces.slice(2*Y),q=y.faceVertexUvs[0].slice(0,Y),Q=y.faceVertexUvs[0].slice(Y,2*Y),J=y.faceVertexUvs[0].slice(2*Y),$={faces:X,uvs:Q},ee={faces:K,uvs:q},te={faces:Z,uvs:J};r.hasTopCover||(y.faces.splice(Y,Y),y.elementsNeedUpdate=!0,y.faceVertexUvs[0].splice(Y,Y),y.uvsNeedUpdate=!0);r.hasBottomCover||(y.faces.splice(0,Y),y.elementsNeedUpdate=!0,y.faceVertexUvs[0].splice(0,Y),y.uvsNeedUpdate=!0);var re=new a.MeshLambertMaterial({color:r.color,transparent:!0,opacity:r.opacity,depthWrite:!0,side:a.DoubleSide,depthTest:i});return{mesh:new a.Mesh(y,re),center:o,topCover:$,bottomCover:ee,otherCover:te,verticesIndexMapping:b,system:h}}();e.position=o.center;var s=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));s._points=r.points;for(var h=0;h<s._points.length;++h)if(!s._points[h].hole){s.boundaryPts=s._points[h].array;break}return s._depthTest=i,s._color=r.color,s._opactiy=r.opacity,s._top=r.top,s._bottom=r.bottom,s._hasTopCover=r.hasTopCover,s._hasBottomCover=r.hasBottomCover,s._verticesIndexMapping=o.verticesIndexMapping,s.system=o.system,s.extrudeMesh=o.mesh,s.setContent(s.extrudeMesh),s.interactShape=s.extrudeMesh.clone(),s.topCover=o.topCover,s.bottomCover=o.bottomCover,s.otherCover=o.otherCover,s._property.depthTest=i,s._property.volume=r,s._property.type="PolygonBaseMarker",s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),f(t,[{key:"destruct",value:function(){this.interactable&&(this.interactable=!1),this.unsetContent(),this.extrudeMesh&&(this.extrudeMesh.geometry&&this.extrudeMesh.geometry.dispose(),this.extrudeMesh.material&&this.extrudeMesh.material.dispose()),function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"color",set:function(e){var t=new a.Color(e);this.extrudeMesh&&this.extrudeMesh.material&&(this.extrudeMesh.material.color=t,this._color=e,this._property.volume.color=e)},get:function(){return this._color}},{key:"depthTest",set:function(e){this.extrudeMesh&&this.extrudeMesh.material&&(this.extrudeMesh.material.depthTest=e,this._depthTest=e,this._property.depthTest=e)},get:function(){return this._depthTest}},{key:"opacity",set:function(e){this.extrudeMesh&&this.extrudeMesh.material&&(this.extrudeMesh.material.opacity=e,this._opactiy=e,this._property.volume.opacity=e)},get:function(){return this._opactiy}},{key:"top",set:function(e){if("number"==typeof e){for(var t=this.extrudeMesh.geometry.vertices,r=Math.floor(t.length/2);r<t.length;++r)t[r].z=e*c.default.scale/c.default.EARTH_RADIUS;this.extrudeMesh.geometry.verticesNeedUpdate=!0,this.interactShape.geometry.dispose(),this.interactShape.geometry=this.extrudeMesh.geometry.clone(),this._top=e,this._property.volume.top=this._top}else if(Array.isArray(e)){Array.isArray(e)&&(Array.isArray(e[0])||(e=[e]));for(var n=this.extrudeMesh.geometry.vertices,i=0,o=0;o<e.length;++o)for(var a=0;a<e[o].length;++a){var s=this._verticesIndexMapping.top[i];i+=1,n[s]&&(n[s].z=e[o][a]*c.default.scale/c.default.EARTH_RADIUS)}this.extrudeMesh.geometry.verticesNeedUpdate=!0,this.interactShape.geometry.dispose(),this.interactShape.geometry=this.extrudeMesh.geometry.clone(),this._top=e,this._property.volume.top=this._top}else console.warn("PolygonBaseMarker setter top invalid value, either be a number or an array")},get:function(){return this._top}},{key:"bottom",set:function(e){if("number"==typeof e){for(var t=this.extrudeMesh.geometry.vertices,r=0;r<Math.floor(t.length/2);++r)t[r].z=e*c.default.scale/c.default.EARTH_RADIUS;this.extrudeMesh.geometry.verticesNeedUpdate=!0,this.interactShape.geometry.dispose(),this.interactShape.geometry=this.extrudeMesh.geometry.clone(),this._bottom=e,this._property.volume.bottom=this._bottom}else if(Array.isArray(e)){Array.isArray(e)&&(Array.isArray(e[0])||(e=[e]));for(var n=this.extrudeMesh.geometry.vertices,i=0,o=0;o<e.length;++o)for(var a=0;a<e[o].length;++a){var s=this._verticesIndexMapping.top[i];i+=1,n[s]&&(n[s].z=e[o][a]*c.default.scale/c.default.EARTH_RADIUS)}this.extrudeMesh.geometry.verticesNeedUpdate=!0,this.interactShape.geometry.dispose(),this.interactShape.geometry=this.extrudeMesh.geometry.clone(),this._bottom=e,this._property.volume.bottom=this._bottom}else console.warn("PolygonBaseMarker setter bottom invalid value, either be a number or an array of length "+(this._points.length-1),e)},get:function(){return this._bottom}},{key:"hasTopCover",set:function(e){if(e!==this._hasTopCover){this._hasTopCover=!this._hasTopCover;var t=[],r=[];this._hasBottomCover&&(t=t.concat(this.bottomCover.faces),r=r.concat(this.bottomCover.uvs)),this._hasTopCover&&(t=t.concat(this.topCover.faces),r=r.concat(this.topCover.uvs)),t=t.concat(this.otherCover.faces),r=r.concat(this.otherCover.uvs),this.extrudeMesh.geometry.faces=t,this.extrudeMesh.geometry.faceVertexUvs[0]=r,this.extrudeMesh.geometry.elementsNeedUpdate=!0,this.extrudeMesh.geometry.uvsNeedUpdate=!0,this.interactShape.geometry.dispose(),this.interactShape.geometry=this.extrudeMesh.geometry.clone()}},get:function(){return this._hasTopCover}},{key:"hasBottomCover",set:function(e){if(e!==this._hasBottomCover){this._hasBottomCover=!this._hasBottomCover;var t=[],r=[];this._hasBottomCover&&(t=t.concat(this.bottomCover.faces),r=r.concat(this.bottomCover.uvs)),this._hasTopCover&&(t=t.concat(this.topCover.faces),r=r.concat(this.topCover.uvs)),t=t.concat(this.otherCover.faces),r=r.concat(this.otherCover.uvs),this.extrudeMesh.geometry.faces=t,this.extrudeMesh.geometry.faceVertexUvs[0]=r,this.extrudeMesh.geometry.elementsNeedUpdate=!0,this.extrudeMesh.geometry.uvsNeedUpdate=!0,this.interactShape.geometry.dispose(),this.interactShape.geometry=this.extrudeMesh.geometry.clone()}},get:function(){return this._hasBottomCover}}]),t}();t.default=p,e.exports=t.default},i=[e,t,r(5),r(6),r(3),r(1),r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=p(n),c=p(i),h=p(o),f=p(a),d=p(s);function p(e){return e&&e.__esModule?e:{default:e}}var m=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),v=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n.api||(n.api={API_HOST:"U2FsdGVkX19enjJDPTJs2Zkb1880sX2VrUVFR1idrIMd2OVTWJ8ikJuhXVLznFJz6FqE75R+Q6rfgSaWW2C6ZA==",API_KEY:""}),this.earthView=new r.EarthBasic(t,null,n),this.snapshoter=(0,d.default)(this.renderer);var i=this;!function(){return i.earthView.layers.marker=new u.default(i.sceneRoot,{dataSeeds:[]}),i.earthView.layers.marker.sceneNode.name="marker layer sceneNode",void i.earthView.layers.marker.updateMatrixWorld(!0)}(),this.materialManager=new f.default}return m(e,[{key:"destruct",value:function(){return this.earthView.destruct()}},{key:"freeze",value:function(){return this.earthView.control.enabled=!1,!0}},{key:"unfreeze",value:function(){return this.earthView.control.enabled=!0,!0}},{key:"addAltizureProjects",value:function(e){return this.earthView.addAltizureProjects(e)}},{key:"pick",value:function(e){var t=0,r=0;return e.changedTouches?(t=e.changedTouches[0].pageX,r=e.changedTouches[0].pageY):(t=e.x,r=e.y),this.earthView.control.pickEarthContactPoint({rawX:t,rawY:r})}},{key:"pickOnProjects",value:function(e){var t={rawX:0,rawY:0};e.changedTouches?(t.rawX=e.changedTouches[0].pageX,t.rawY=e.changedTouches[0].pageY):(t.rawX=e.x,t.rawY=e.y);var r=this.earthView.control.pickProjectContactPoint(t,"marker");return r||(r=this.earthView.control.pickProjectContactPoint(t)),r}},{key:"calculateDistanceBetweenTwoPoints",value:function(e,t){var r={lng:(e.lng+t.lng)/2,lat:(e.lat+t.lat)/2,alt:0},n=c.default.getLocalSystemOnEarthSurface(h.default.EarthResolution,r.lng,r.lat,h.default.scale),i=c.default.getNoneGroundCartesianFromLngLatAlt(h.default.EarthResolution,e.lng,e.lat,e.alt,h.default.scale).clone().sub(n.origin),o=h.default.EARTH_RADIUS/h.default.scale,a=i.dot(n.lng)*o,s=i.dot(n.lat)*o,l=i.dot(n.alt)*o,u=c.default.getNoneGroundCartesianFromLngLatAlt(h.default.EarthResolution,t.lng,t.lat,t.alt,h.default.scale).clone().sub(n.origin),f=a-u.dot(n.lng)*o,d=s-u.dot(n.lat)*o,p=l-u.dot(n.alt)*o;return Math.sqrt(f*f+d*d+p*p)}},{key:"lngLatAlt2XYZ",value:function(e){return c.default.getNoneGroundCartesianFromLngLatAlt(h.default.EarthResolution,e.lng,e.lat,e.alt,h.default.scale).clone().applyMatrix4(this.markerLayer.matrixWorld)}},{key:"markerSnapshot",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:512;(e.length<2||void 0===r.length||r.length<1)&&console.error("[markerSnapshot] arguments not sufficient");var o={max:{lat:e[0].lat,lng:e[0].lng},min:{lat:e[0].lat,lng:e[0].lng}};e.map(function(e){e.lat>o.max.lat&&(o.max.lat=e.lat),e.lng>o.max.lng&&(o.max.lng=e.lng),e.lat<o.min.lat&&(o.min.lat=e.lat),e.lng<o.min.lng&&(o.min.lng=e.lng)});var a={lat:(o.max.lat+o.min.lat)/2,lng:(o.max.lng+o.min.lng)/2,alt:t.min},s=Object.assign({},a,{alt:t.max}),u={lat:o.max.lat,lng:(o.max.lng+o.min.lng)/2,alt:t.min},c={lat:(o.max.lat+o.min.lat)/2,lng:o.max.lng,alt:t.min};a=this.lngLatAlt2XYZ(a),s=this.lngLatAlt2XYZ(s),u=this.lngLatAlt2XYZ(u),c=this.lngLatAlt2XYZ(c);var h=(s=s.clone().add(a.clone().negate())).length(),f=u.clone().add(a.clone().negate()),d=c.clone().add(a.clone().negate()),p=d.length(),m=f.length(),v=new l.OrthographicCamera;v.left=-p,v.right=p,v.top=m,v.bottom=-m;var g=a.clone().add(s.clone().multiplyScalar(2)),y=new l.Matrix4;y.lookAt(g,a,f.clone().normalize()),v.position.copy(g),v.quaternion.setFromRotationMatrix(y),v.near=h,v.far=2*h,v.updateProjectionMatrix();var _=(t.max-t.min)/h,w=m/p,b=w>=1?{width:i,height:Math.round(i/w)}:{width:Math.round(w*i),height:i},x={dimension:{width:b.width,height:b.height},resolution:4*d.length()*f.length()*_*_/(b.width*b.height),resolutionwidth:2*d.length()*_/b.width,resolutionheight:2*f.length()*_/b.height,bbox:o};return x.buffer=n?this.snapshoter.renderDepthSnapshot(v,r,b.width,b.height):this.snapshoter.renderColorSnapshot(v,r,b.width,b.height),x}},{key:"generateMask",value:function(e,t,r){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:512,i=[],o={},a=0;a<r.length;++a){var s=r[a].interactShape.clone();s.material=new l.MeshBasicMaterial({color:a+1,transparent:!1}),s.visible=!0,s.matrix.copy(r[a].interactShape.matrixWorld),s.matrix.decompose(s.position,s.quaternion,s.scale),i.push(s),o[a+1]=r[a]}for(var u=this.markerSnapshot(e,t,i,!1,n),c=0;c<i.length;++c){var h=i[c];h&&h.material&&h.material.dispose()}return{mask:u,mapping:o}}},{key:"earthToScene",value:function(){return this.markerLayer.matrixWorld.clone().toThreeMatrix4()}},{key:"scene",get:function(){return this.earthView.scene}},{key:"enableDolly",set:function(e){this.earthView.control.enabledDolly=e}},{key:"sceneRoot",get:function(){return this.earthView.earthSceneRoot}},{key:"markerLayer",get:function(){return this.earthView.layers.marker}},{key:"viewerCamera",get:function(){return this.earthView.camera}},{key:"domElement",get:function(){return this.earthView.renderer.domElement}},{key:"renderer",get:function(){return this.earthView.renderer}}]),e}();t.default=v,e.exports=t.default},i=[e,t,r(4),r(55),r(3),r(1),r(72),r(28),r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){"use strict";e.exports=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}}},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var l,u=[],c=!1,h=-1;function f(){c&&l&&(c=!1,l.length?u=l.concat(u):h=-1,u.length&&d())}function d(){if(!c){var e=s(f);c=!0;for(var t=u.length;t;){for(l=u,u=[];++h<t;)l&&l[h].run();h=-1,t=u.length}l=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||c||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";(function(t){var n=r(2),i=r(41),o=r(43),a=r(44),s=r(45),l=r(25),u="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||r(46);e.exports=function(e){return new Promise(function(c,h){var f=e.data,d=e.headers;n.isFormData(f)&&delete d["Content-Type"];var p=new XMLHttpRequest,m="onreadystatechange",v=!1;if("test"===t.env.NODE_ENV||"undefined"==typeof window||!window.XDomainRequest||"withCredentials"in p||s(e.url)||(p=new window.XDomainRequest,m="onload",v=!0,p.onprogress=function(){},p.ontimeout=function(){}),e.auth){var g=e.auth.username||"",y=e.auth.password||"";d.Authorization="Basic "+u(g+":"+y)}if(p.open(e.method.toUpperCase(),o(e.url,e.params,e.paramsSerializer),!0),p.timeout=e.timeout,p[m]=function(){if(p&&(4===p.readyState||v)&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))){var t="getAllResponseHeaders"in p?a(p.getAllResponseHeaders()):null,r={data:e.responseType&&"text"!==e.responseType?p.response:p.responseText,status:1223===p.status?204:p.status,statusText:1223===p.status?"No Content":p.statusText,headers:t,config:e,request:p};i(c,h,r),p=null}},p.onerror=function(){h(l("Network Error",e,null,p)),p=null},p.ontimeout=function(){h(l("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",p)),p=null},n.isStandardBrowserEnv()){var _=r(47),w=(e.withCredentials||s(e.url))&&e.xsrfCookieName?_.read(e.xsrfCookieName):void 0;w&&(d[e.xsrfHeaderName]=w)}if("setRequestHeader"in p&&n.forEach(d,function(e,t){void 0===f&&"content-type"===t.toLowerCase()?delete d[t]:p.setRequestHeader(t,e)}),e.withCredentials&&(p.withCredentials=!0),e.responseType)try{p.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&p.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&p.upload&&p.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(e){p&&(p.abort(),h(e),p=null)}),void 0===f&&(f=null),p.send(f)})}}).call(t,r(23))},function(e,t,r){"use strict";var n=r(42);e.exports=function(e,t,r,i,o){var a=new Error(e);return n(a,t,r,i,o)}},function(e,t,r){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,r){"use strict";function n(e){this.message=e}n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,e.exports=n},function(e,t,r){var n,i,o,a;a=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString();this._isSafari=n;var i="\n    varying vec2 vUv;\n    uniform sampler2D tDiffuse;\n    uniform sampler2D tDepth;\n\n    float readDepth (sampler2D depthSampler, vec2 coord) {\n      float fragCoordZ = texture2D(depthSampler, coord).x;\n      return fragCoordZ;\n    }\n    void main() {\n      float depth = readDepth(tDepth, vUv);\n      gl_FragColor.rgb = vec3(depth);\n      gl_FragColor.a = 1.0;\n    }\n    ";n&&(i="\n      varying vec2 vUv;\n      uniform sampler2D tDiffuse;\n      uniform sampler2D tDepth;\n      float shift_right(float v, float amt) {\n        v = floor(v) + 0.5;\n        return floor(v / exp2(amt));\n      }\n      float shift_left(float v, float amt) {\n        return floor(v * exp2(amt) + 0.5);\n      }\n      \n      float mask_last(float v, float bits) {\n        return mod(v, shift_left(1.0, bits));\n      }\n      float extract_bits(float num, float from, float to) {\n        from = floor(from + 0.5);\n        to = floor(to + 0.5);\n        return mask_last(shift_right(num, from), to - from);\n      }\n      vec4 encode_float(float val) {\n        if (val == 0.0)\n          return vec4(0, 0, 0, 0);\n        float sign = val > 0.0 ? 0.0 : 1.0;\n        val = abs(val);\n        float exponent = floor(log2(val));\n        float biased_exponent = exponent + 127.0;\n        float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;\n        \n        float t = biased_exponent / 2.0;\n        float last_bit_of_biased_exponent = fract(t) * 2.0;\n        float remaining_bits_of_biased_exponent = floor(t);\n        \n        float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;\n        float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;\n        float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\n        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n        return vec4(byte4, byte3, byte2, byte1);\n      }\n      float readDepth (sampler2D depthSampler, vec2 coord) {\n        float fragCoordZ = texture2D(depthSampler, coord).x;\n        return fragCoordZ;\n      }\n      void main() {\n        float depth = readDepth(tDepth, vUv);\n        gl_FragColor = encode_float(depth);\n      }\n      "),this.renderer=t,this.normalTarget=new r.WebGLRenderTarget,this.normalTarget.texture.format=r.RGBAFormat,this.normalTarget.texture.minFilter=r.NearestFilter,this.normalTarget.texture.magFilter=r.NearestFilter,this.normalTarget.texture.generateMipmaps=!1,this.depthTarget=new r.WebGLRenderTarget,this.depthTarget.depthTexture=new r.DepthTexture,this.depthTarget.texture.format=r.RGBFormat,this.depthTarget.texture.minFilter=r.NearestFilter,this.depthTarget.texture.magFilter=r.NearestFilter,this.depthTarget.texture.generateMipmaps=!1,this.depthTarget.stencilBuffer=!1,this.depthTarget.depthBuffer=!0,this.depthTarget.depthTexture.type=r.UnsignedShortType,this.pickingTexture=new r.WebGLRenderTarget,this.pickingTexture.texture.type=n?r.UnsignedByteType:r.FloatType,this.pickingTexture.texture.format=r.RGBAFormat,this.pickingTexture.texture.generateMipmaps=!1,this.pickingTexture.depthBuffer=!1,this.scene=new r.Scene,this.postScene=new r.Scene,this.postCamera=new r.OrthographicCamera(-1,1,1,-1,0,1),this.depthShaderMaterial=new r.ShaderMaterial({vertexShader:"\n      varying vec2 vUv;\n      void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n      }\n      ",fragmentShader:i,uniforms:{tDiffuse:{value:this.depthTarget.texture},tDepth:{value:this.depthTarget.depthTexture}}});var o=new r.PlaneBufferGeometry(2,2),a=new r.Mesh(o,this.depthShaderMaterial);this.postScene.add(a)}return i(e,[{key:"renderColorSnapshot",value:function(e,t,r,n){this.normalTarget.setSize(r,n),this.scene.children=t;var i=this.renderer.getClearColor();this.renderer.setClearColor(16777215,0),this.renderer.render(this.scene,e,this.normalTarget),this.renderer.setClearColor(i,0);var o=new Uint8Array(4*r*n);return this.renderer.readRenderTargetPixels(this.normalTarget,0,0,r,n,o),this.scene.children=[],o}},{key:"renderDepthSnapshot",value:function(e,t,r,n){this.pickingTexture.setSize(r,n),this.depthTarget.setSize(r,n),this.scene.children=t;var i=this.renderer.getClearColor();this.renderer.setClearColor(16777215,0),this.renderer.render(this.scene,e,this.depthTarget),this.renderer.render(this.postScene,this.postCamera,this.pickingTexture),this.renderer.setClearColor(i,0);var o=void 0;if(this._isSafari){var a=new Uint8Array(4*r*n);this.renderer.readRenderTargetPixels(this.pickingTexture,0,0,r,n,a),o=new Float32Array(a.buffer);for(var s=0;s<o.length;++s)o[s]=255*o[s]}else{var l=new Float32Array(4*r*n);this.renderer.readRenderTargetPixels(this.pickingTexture,0,0,r,n,l),o=new Float32Array(r*n);for(var u=0;u<o.length;++u)o[u]=255*l[4*u]}return function(e,t,r,n,i){for(var o=0;o<t;++o)for(var a=0;a<r;++a){for(var s=[],l=0;l<n;++l)for(var u=0;u<i;++u){var c=(u+a)*t+l+o;c>=0&&c<e.length&&s.push(e[c])}s.length===n*i&&(s.sort(function(e,t){return e-t}),e[a*t+o]=s[Math.floor(s.length/2)])}}(o,r,n,5,5),this.scene.children=[],o}}]),e}();t.default=function(e){return void 0===n&&(void 0===e?console.error("init offline renderer error: should provide renderer"):n=new o(e)),n},e.exports=t.default},i=[e,t,r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=c(r),l=c(o),u=c(a);function c(e){return e&&e.__esModule?e:{default:e}}var h=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var d=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),o=r;if(!function(){if(!e||!e.shape||!e.objUrl)return console.error("OBJMarker missing arguments",e),!1;o._property.type="OBJMarker",o._property.shape=e.shape,o._property.objUrl=e.objUrl,o._property.mtlUrl=e.mtlUrl,o._property.upDir=e.upDir,o._property.scale=e.scale,e.upDir||(e.upDir={x:0,y:0,z:1});e.scale||(e.scale=1);return!0}())return void 0,f(r,void 0);for(var a,s=[],c=0;c<r._property.materialDescriptions.length;++c){var h=r._property.materialDescriptions[c],d=new(0,r.earth.materialManager.materials[h.type.toLowerCase()])(h);s.push(d)}if(null===t.objCache&&(t.objCache=new l.default),null===t.loading&&(t.loading={}),void 0!==e.shape){var p=e.shape;if("CUSTOMIZE"===p&&void 0!==e.objUrl){var m=e.objUrl,v=e.mtlUrl||"",g={objUrl:m,mtlUrl:v,upDir:(a=e.upDir,new i.Vector3(a.x,a.y,a.z)),scale:e.scale,clickable:e.clickable},y=t.objCache.get(m,null);if(!y||e.isRollOver){var _=function(){var e=new i.MeshLambertMaterial({color:16711680,transparent:!0,opacity:.5}),t=new i.Mesh(new i.ConeGeometry(.2,1.6,20),e);t.rotateX(-Math.PI/2);var r=new i.MeshLambertMaterial({color:16711680,wireframe:!0}),n=new i.Mesh(new i.RingGeometry(.35,.4,32),r);n.translateZ(-.75);var o=new i.Group;o.add(t),o.add(n);var a=new i.Group;a.add(o);var s=new i.Matrix4;s.makeTranslation(0,0,.8),a.applyMatrix(s);var l=u.default.scale/u.default.EARTH_RADIUS*4;return s.makeScale(l,l,l),a.applyMatrix(s),a}(),w=t.loading[m];w?w.push({marker:r,mtls:s}):(t.loading[m]=[],(0,n.addMTLOBJ)(g).then(function(r){t.objCache.set(m,r),t.loading[m].map(function(e){var r=e.marker,n=e.mtls;r.unsetContent();var i=t.objCache.get(m,null);r.setContent(i),n.map(function(e){r.changeMaterial(e)}),r._updateMaterialDescriptions()}),t.loading[m]=null,e.isRollOver&&r.children[0].children.map(function(e){e.material.color=new i.Color(1,0,0),e.material.wireframe=!0}),o.unsetContent(),o.setContent(r),s.map(function(e){o.changeMaterial(e)}),o._updateMaterialDescriptions()}).catch(function(t){e.errHandler&&e.errHandler(t),console.error("addMTLOBJ err",t)})),o.setContent(_),s.map(function(e){o.changeMaterial(e)}),o._updateMaterialDescriptions()}else o.setContent(y),s.map(function(e){o.changeMaterial(e)}),o._updateMaterialDescriptions()}else"CUSTOMIZE"===p&&console.error("OBJ url is requred")}else console.error("OBJ load failed");return r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),h(t,[{key:"destruct",value:function(){this.interactable&&(this.interactable=!1),d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"unsetContent",this).call(this),d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"_updateMaterialDescriptions",value:function(){var e=this;this.contentHolder.traverse(function(t){if("Mesh"===t.type){var r=t.material.description;if(null!==r&&void 0!==r){for(var n=!1,i=0;i<e._property.materialDescriptions.length;++i)e._property.materialDescriptions[i].name===r.name&&(e._property.materialDescriptions[i]=r,n=!0);n||e._property.materialDescriptions.push(r)}}})}},{key:"setBboxColor",value:function(e){var t=this.decoHolder.children[0].material.color.clone();return this.decoHolder.children[0].material.color.copy(e),t}},{key:"setContent",value:function(e){return!!function(e){var t=e instanceof i.Object3D;t||console.warn("Marker: unknown content type",e);return t}(e)&&(this.contentHolder.add(e),e.objSpaceBBox&&(this.decoHolder.add(e.objSpaceBBox),this.interactShape=e.objSpaceBBox.clone(),this.interactShape.geometry=e.objSpaceBBox.geometry.clone()),!0)}},{key:"bboxColor",set:function(e){this.decoHolder.children[0].material.color.copy(new i.Color(e))},get:function(){return this.decoHolder.children[0].material.color}}]),t}();p.objCache=null,p.loading=null,t.default=p,e.exports=t.default},i=[e,t,r(5),r(78),r(0),r(82),r(1)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=s(n),a=s(i);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n};var h=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(!function(e){if(!e||!e.position||!e.earth)return!1;e.scale||(e.scale=1);return!0}(e))return console.warn("TagMarker invalid init input",e),void 0,u(r,void 0);return r._property.type="TagMarker",r._property.imgUrl=e.imgUrl,null!==t.textureCache&&void 0!==t.textureCache||(t.textureCache={}),r._addTag(e.imgUrl),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),l(t,[{key:"destruct",value:function(){(function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this),t.clearAllImgTextureCache(),t.textureCache=null}},{key:"_addTag",value:function(e,n,i){var o=this,s=this;if(t.ImgTextureCacheExist(e)){var l=t.getImgTextureFromCache(e);l.minFilter=l.magFilter=r.LinearFilter,l.needsUpdate=!0,c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"texture",{texture:l,aspectRatio:l.image.width/l.image.height},this),s.imgUrl=e,n&&n()}else{var u=new a.default;u.setCrossOrigin("anonymous"),u.withCredentials=!0,u.load(e,function(i){i.minFilter=i.magFilter=r.LinearFilter,i.needsUpdate=!0,c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"texture",{texture:i,aspectRatio:i.image.width/i.image.height},o),s.imgUrl=e,t.cacheImgTexture(s.imgUrl,i),n&&n()},function(e){},function(n){console.warn("an error happened while loading "+e);var a=[0,0,0,0],l=[255,0,0,255],u=[];u=(u=(u=u.concat(l).concat(a).concat(l)).concat(a).concat(l).concat(a)).concat(l).concat(a).concat(l);var h=new r.DataTexture(Uint8Array.from(u),3,3,r.RGBAFormat,r.UnsignedByteType,r.UVMapping);h.minFilter=h.magFilter=r.LinearFilter,h.needsUpdate=!0,c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"texture",{texture:h,aspectRatio:h.image.width/h.image.height},o);s.imgUrl="TagMarkerTexture404",t.cacheImgTexture("TagMarkerTexture404",h),s._property.imgUrl="TagMarkerTexture404",i&&i()})}}},{key:"texture",set:function(e){this.textureAsync={data:e,onSuccess:void 0,onFail:void 0}},get:function(){return this.imgUrl}},{key:"textureAsync",set:function(e){var n=this,i=e.data,o=e.onSuccess,s=e.onFail,l=this;if(t.ImgTextureCacheExist(i)){var u=t.getImgTextureFromCache(i);c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"texture",{texture:u,aspectRatio:u.image.width/u.image.height},this),l.imgUrl=i,l._property.imgUrl=i,o&&o()}else{var h=new a.default;h.setCrossOrigin("anonymous"),h.withCredentials=!0,h.load(i,function(e){e.minFilter=r.LinearFilter,e.magFilter=r.LinearFilter,e.needsUpdate=!0,c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"texture",{texture:e,aspectRatio:e.image.width/e.image.height},n),l.imgUrl=i,t.cacheImgTexture(i,e),l._property.imgUrl=i,o&&o()},function(e){},function(e){console.warn("an error happened while loading "+i),s&&s()})}},get:function(){return this.imgUrl}}],[{key:"ImgTextureCacheExist",value:function(e){return!!t.textureCache&&(null!==t.textureCache[e]&&void 0!==t.textureCache[e])}},{key:"getImgTextureFromCache",value:function(e){return t.ImgTextureCacheExist(e)?t.textureCache[e]:null}},{key:"cacheImgTexture",value:function(e,r){null!==t.textureCache&&void 0!==t.textureCache||(t.textureCache={}),t.textureCache[e]=r}},{key:"clearAllImgTextureCache",value:function(){for(var e in t.textureCache)t.textureCache[e]&&t.textureCache[e].dispose();t.textureCache={}}}]),t}();h.textureCache=null,t.default=h,e.exports=t.default},i=[e,t,r(0),r(16),r(8)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r){"use strict";function n(e,t){r.BufferGeometry.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var n,i,o=[],a=Math.cos(4/180*Math.PI),s=[0,0],l={},u=["a","b","c"];e.isBufferGeometry?(i=new r.Geometry).fromBufferGeometry(e):i=e.clone(),i.computeFaceNormals();for(var c=i.vertices,h=i.faces,f=0,d=h.length;f<d;f++)for(var p=h[f],m=0;m<3;m++)s[0]=p[u[m]],s[1]=p[u[(m+1)%3]],s.sort(_),void 0===l[n=s.toString()]?l[n]={index1:s[0],index2:s[1],face1:f,face2:void 0}:l[n].face2=f;for(n in l){var v=l[n];if(void 0===v.face2||h[v.face1].normal.dot(h[v.face2].normal)<=a){var g=c[v.index1];o.push(g.x,g.y,g.z),g=c[v.index2],o.push(g.x,g.y,g.z)}}var y=new Float32Array(o);function _(e,t){return e-t}this.addAttribute("position",new r.BufferAttribute(y,3))}Object.defineProperty(t,"__esModule",{value:!0}),n.prototype=Object.create(r.BufferGeometry.prototype),n.prototype.constructor=n,t.default=n,e.exports=t.default},i=[e,t,r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=d(r),u=d(n),c=d(i),h=d(o),f=d(a);function d(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=e.position,n=c.default.getLocalSystemOnEarthSurface(u.default.EarthResolution,r.lng,r.lat,u.default.scale),i=n.origin,o=e.radius,a=o*u.default.scale/u.default.EARTH_RADIUS,s=n.lng.clone().normalize().multiplyScalar(a),l=n.lat.clone().normalize().multiplyScalar(a),f=e.sided,d=[],p=0;p<f;++p){var m=2*Math.PI*p/f,v=l.clone().multiplyScalar(Math.cos(m)).add(s.clone().multiplyScalar(Math.sin(m))),g=i.clone().add(v),y=c.default.getLngLatAltFromNoneGroundCartesian(u.default.EarthResolution,g,u.default.scale),_=new h.default(y.lng,y.lat,y.alt);d.push(_)}d.push(d[0]);var w={top:e.top,bottom:e.bottom,opacity:e.opacity,color:e.color,points:d};e.volume=w;var b=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return b._sided=f,b._radius=o,b._property.type="RegularPolygonMarker",b._property.sided=b._sided,b._property.radius=b._radius,b}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.default),p(t,[{key:"radius",set:function(e){var t=e/this._radius;this._radius=e,this._property.radius=this._radius,this.extrudeMesh.geometry.applyMatrix((new s.Matrix4).makeScale(t,t,1)),this.extrudeLine.geometry.applyMatrix((new s.Matrix4).makeScale(t,t,1));var r=this,n=function(){for(var e=r._radius*u.default.scale/u.default.EARTH_RADIUS,t=r.system,n=t.origin,i=t.lng.clone().normalize().multiplyScalar(e),o=t.lat.clone().normalize().multiplyScalar(e),a=[],s=0;s<r._sided;s++){var l=2*Math.PI*s/r._sided,f=o.clone().multiplyScalar(Math.cos(l)).add(i.clone().multiplyScalar(Math.sin(l))),d=n.clone().add(f),p=c.default.getLngLatAltFromNoneGroundCartesian(u.default.EarthResolution,d,u.default.scale),m=new h.default(p.lng,p.lat,p.alt);a.push(m)}return a.push(new h.default(a[0].lng,a[0].lat,a[0].alt)),a}();this._points[0].array=n,this.boundaryPts=n},get:function(){return this._radius}},{key:"sided",set:function(e){this._sided=e,this._property.sided=this._sided;var t=this,r=function(){for(var e=t._radius*u.default.scale/u.default.EARTH_RADIUS,r=t.system,n=r.origin,i=r.lng.clone().normalize().multiplyScalar(e),o=r.lat.clone().normalize().multiplyScalar(e),a=[],l=[],f=0;f<t._sided;f++){var d=2*Math.PI*f/t._sided,p=o.clone().multiplyScalar(Math.cos(d)).add(i.clone().multiplyScalar(Math.sin(d))),m=1*p.dot(r.lng),v=1*p.dot(r.lat),g=p.dot(r.alt);a.push(new s.Vector3(m,v,g));var y=n.clone().add(p),_=c.default.getLngLatAltFromNoneGroundCartesian(u.default.EarthResolution,y,u.default.scale),w=new h.default(_.lng,_.lat,_.alt);l.push(w)}a.push(a[0].clone()),l.push(new h.default(l[0].lng,l[0].lat,l[0].alt));var b=new s.Matrix4;b.makeScale(1e7,1e7,1e7),a=a.map(function(e){return e.applyMatrix4(b)});var x=new s.Shape;x.moveTo(a[0].x,a[0].y);for(var k=1;k<a.length;k++)x.lineTo(a[k].x,a[k].y);var A={steps:1,amount:u.default.scale/u.default.EARTH_RADIUS*1e7,bevelEnabled:!1},M=new s.ExtrudeGeometry(x,A),S={top:{},bottom:{}},P=M.vertices,T=Math.floor(M.vertices.length/2),O=M.vertices.length,C=Math.pow(10,3),E={top:{},bottom:{}};function I(e){return Math.round(e.x*C)+"_"+Math.round(e.y*C)}for(var R=0;R<T;++R){var L=I(P[R]);E.bottom[L]=R}for(var j=T;j<O;++j){var z=I(P[j]);E.top[z]=j}for(var B=0;B<a.length-1;++B){var D=I(a[B]);S.top[B]=E.top[D],S.bottom[B]=E.bottom[D]}M.applyMatrix((new s.Matrix4).makeScale(1e-7,1e-7,1e-7));for(var N=T;N<O;++N)P[N].z=t._top*u.default.scale/u.default.EARTH_RADIUS;for(var U=0;U<T;++U)P[U].z=t._bottom*u.default.scale/u.default.EARTH_RADIUS;M.verticesNeedUpdate=!0;var F=a.length-3,H=M.faces.slice(0,F),V=M.faces.slice(F,2*F),W=M.faces.slice(2*F),G=M.faceVertexUvs[0].slice(0,F),Y=M.faceVertexUvs[0].slice(F,2*F),K=M.faceVertexUvs[0].slice(2*F),X={faces:V,uvs:Y},Z={faces:H,uvs:G},q={faces:W,uvs:K};t._hasTopCover||(M.faces.splice(F,F),M.elementsNeedUpdate=!0,M.faceVertexUvs[0].splice(F,F),M.uvsNeedUpdate=!0);t._hasBottomCover||(M.faces.splice(0,F),M.elementsNeedUpdate=!0,M.faceVertexUvs[0].splice(0,F),M.uvsNeedUpdate=!0);return{geometry:M,topCover:X,bottomCover:Z,otherCover:q,verticesIndexMapping:S,points:l}}();this._verticesIndexMapping=r.verticesIndexMapping,this.topCover=r.topCover,this.bottomCover=r.bottomCover,this.otherCover=r.otherCover,this._points[0].array=r.points,this.boundaryPts=r.points,this.extrudeMesh.geometry.dispose(),this.extrudeMesh.geometry=r.geometry,this.extrudeLine.geometry.dispose(),this.extrudeLine.geometry=new f.default(r.geometry),this.interactShape.geometry.dispose(),this.interactShape.geometry=r.geometry},get:function(){return this._sided}}]),t}();t.default=m,e.exports=t.default},i=[e,t,r(19),r(1),r(3),r(6),r(31),r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FenceLineHolder=e.default=void 0;var s=h(t),l=h(n),u=h(i),c=h(a);function h(e){return e&&e.__esModule?e:{default:e}}var f=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var p=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var g={FENCE:"fence",ARROW:"arrow"},y={LINEAR:"linear",REPEAT:"repeat"},_={HORIZONTAL:"horizontal",VERTICAL:"vertical",NONE:"none"},w=function(e){function t(e){d(this,t);var n=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));n._lineMaterial=new r.MeshBasicMaterial({color:e.color,depthTest:e.depthTest,side:r.DoubleSide,opacity:e.opacity,transparent:!0,alphaMap:null}),n._lineOptions=[],n._unitAltVector=e.unitAltVector,n._fenceHeight=e.fenceHeight;var i=new r.Geometry;return i.vertices.push(new r.Vector3(0,0,0),new r.Vector3(1,0,0),new r.Vector3(0,1,0),new r.Vector3(1,1,0)),i.faces.push(new r.Face3(0,1,2),new r.Face3(1,2,3)),i.faceVertexUvs[0]=[[new r.Vector2(0,0),new r.Vector2(1,0),new r.Vector2(0,1)],[new r.Vector2(1,0),new r.Vector2(0,1),new r.Vector2(1,1)]],n._lineGeometry=i,n._uvType=y.LINEAR,n}return v(t,r.Object3D),p(t,[{key:"updateLineUvs",value:function(e){if(this._uvType=e,e===y.LINEAR)for(var t=0;t<this.children.length;++t){for(var n=this.children[t],i=[[new r.Vector2(0,0),new r.Vector2(1,0),new r.Vector2(0,1)],[new r.Vector2(1,0),new r.Vector2(0,1),new r.Vector2(1,1)]],o=0;o<2;++o)for(var a=0;a<3;++a)n.geometry.faceVertexUvs[0][o][a].set(i[o][a].x,i[o][a].y);n.geometry.uvsNeedUpdate=!0}else{var s=1,u=this._fenceHeight*l.default.scale/l.default.EARTH_RADIUS;if(this._lineMaterial.alphaMap&&this._lineMaterial.alphaMap.image){var c=this._lineMaterial.alphaMap.image;s=c.width/c.height||1}for(var h=0,f=0;f<this.children.length;++f){var d=this.children[f],p=this._lineOptions[f],m=p.baseLine[0].clone().sub(p.baseLine[1]).length()/u/s*1,v=[[new r.Vector2(h,0),new r.Vector2(h+m,0),new r.Vector2(h,1)],[new r.Vector2(h+m,0),new r.Vector2(h,1),new r.Vector2(h+m,1)]];h+=m;for(var g=0;g<2;++g)for(var _=0;_<3;++_)d.geometry.faceVertexUvs[0][g][_].set(v[g][_].x,v[g][_].y);d.geometry.uvsNeedUpdate=!0}}}},{key:"addNewLine",value:function(e){this._lineOptions.push(e);var t=this._unitAltVector.clone().multiplyScalar(this._fenceHeight),n=e.baseLine.slice();e.baseLine.map(function(e){n.push(e.clone().add(t))});var i=new r.Vector3(0,0,0);n.map(function(e){i.add(e)}),i.multiplyScalar(.25);var o=this._lineGeometry.clone();o.vertices=n.map(function(e){return e.clone().sub(i)}),o.verticesNeedUpdate=!0;var a=new r.Mesh(o,this._lineMaterial);a.position.copy(i),a.renderOrder=u.default.POLYLINE_RENDER_ORDER,this.add(a),this.updateLineUvs(this._uvType)}},{key:"updateLine",value:function(e,t){this._lineOptions[e]=t;var n=this.children[e],i=this._unitAltVector.clone().multiplyScalar(this._fenceHeight),o=t.baseLine.slice();t.baseLine.map(function(e){o.push(e.clone().add(i))});var a=new r.Vector3(0,0,0);o.map(function(e){a.add(e)}),a.multiplyScalar(.25);var s=this._lineGeometry.clone();s.vertices=o.map(function(e){return e.clone().sub(a)}),n.geometry.dispose(),n.geometry=s,n.position.copy(a),this.updateLineUvs(this._uvType)}},{key:"destruct",value:function(){this._lineMaterial.alphaMap.dispose(),this._lineMaterial.dispose(),this._lineOptions=[];for(var e=this.children.length-1;e>=0;e-=1){var t=this.children[e];t.geometry&&t.geometry.dispose(),this.remove(t)}}},{key:"fenceHeight",set:function(e){var t=this;this._fenceHeight=e;for(var n=this._unitAltVector.clone().multiplyScalar(this._fenceHeight),i=function(e){var i=t._lineOptions[e],o=t.children[e],a=i.baseLine.slice();i.baseLine.map(function(e){a.push(e.clone().add(n))});var s=new r.Vector3(0,0,0);a.map(function(e){s.add(e)}),s.multiplyScalar(.25);var l=t._lineGeometry.clone();l.vertices=a.map(function(e){return e.clone().sub(s)}),o.geometry.dispose(),o.geometry=l,o.position.copy(s)},o=0;o<this.children.length;++o)i(o);this.updateLineUvs(this._uvType)}},{key:"opacity",set:function(e){this._lineMaterial.opacity=e}},{key:"color",set:function(e){this._lineMaterial.color=e}},{key:"depthTest",set:function(e){this._lineMaterial.depthTest=e}}]),t}(),b=function(e){function t(e){d(this,t);var n=!0;e.__DO_NOT_CONSTRUCT_LINE_INTERAL_USE&&(n=!1),e.__DO_NOT_CONSTRUCT_LINE_INTERAL_USE=!0;var i=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));i._fenceHeight=e.fenceHeight?e.fenceHeight:5,i._opacity=e.opacity?e.opacity:1,i._property.fenceHeight=i._fenceHeight,i._property.opacity=i._opacity,i._labelScaleFunc=function(e){return Math.abs(e)/5},i._property.labelScaleFunc=i._labelScaleFunc.toString(),i._labelScale=l.default.scale/l.default.EARTH_RADIUS*10*i._labelScaleFunc(i._fenceHeight);for(var a=0;a<i.labelHolder._labelOptions.length;++a){var s=i.labelHolder._labelOptions[a],u={x:s.width/s.height*i._labelScale,y:i._labelScale,z:1};i.labelHolder.drawOnLabel(a,{scale:u})}if(n){i.lineHolder=new w({color:i._color,depthTest:i._depthTest,opacity:i._opacity,unitAltVector:i._unitAltVector,fenceHeight:i._fenceHeight}),i.contentHolder.add(i.lineHolder);for(var c=0;c<i._points.length-1;c+=1){var h=i._constructLineOptions(c,c+1);i.lineHolder.addNewLine(h)}var f=i._constructInteractShapeGeometry(),p=new r.Mesh(f,new r.MeshBasicMaterial({side:r.DoubleSide}));i.interactShape=p,i._speed="number"==typeof e.speed?e.speed:1,i._uvAnimation=new o.Animation({offset:0,speed:i._speed,lastTime:void 0},function(e){if(e.lastTime||(e.lastTime=Date.now()),!i._style)return!0;if(i._style.animation===_.HORIZONTAL||i._style.animation===_.VERTICAL){var t=Date.now(),r=e.speed*(t-e.lastTime)/1e3;e.lastTime=t,e.offset-=r;for(var n=0;n<i.lineHolder.children.length;++n){for(var o=i.lineHolder.children[n].geometry.faceVertexUvs[0],a=0;a<o.length;a+=1)for(var s=0;s<o[a].length;s+=1)i._style.animation===_.HORIZONTAL?o[a][s].x-=r:i._style.animation===_.VERTICAL&&(o[a][s].y-=r),e.offset<=-1&&(i._style.animation===_.HORIZONTAL?o[a][s].x+=1:i._style.animation===_.VERTICAL&&(o[a][s].y+=1));e.offset<=-1&&(e.offset+=1),i.lineHolder.children[n].geometry.uvsNeedUpdate=!0}}return!0},100),i._uvAnimation.start();var v=Object.assign({texture:g.FENCE,mapping:y.LINEAR,color:i._color,opacity:i._opacity,animation:_.HORIZONTAL},e.style);i.style=v}return i._property.type="PolyFenceLineMarker",i}return v(t,s.default),p(t,[{key:"_updateAlphaTexture",value:function(e,t){var n=void 0;if(e===g.FENCE){var i=new Uint8Array([255,255,255,255,212,212,212,212,169,169,169,169,126,126,126,126,83,83,83,83,41,41,41,41,0,0,0,0,0,0,0,0]);(n=new r.DataTexture(i,1,8,r.RGBAFormat,r.UnsignedByteType,r.UVMapping)).minFilter=n.magFilter=r.LinearFilter,n.wrapS=n.wrapT=r.RepeatWrapping,n.needsUpdate=!0,t(n)}else if(e===g.ARROW){for(var o=[],a=0;a<16;++a){for(var s=Math.abs(a-8),l=8-s,u=0;u<8+4*l;++u)o.push(0);for(var h=0;h<16;++h)o.push(255);for(var f=0;f<8+4*s;++f)o.push(0)}(n=new r.DataTexture(Uint8Array.from(o),16,16,r.RGBAFormat,r.UnsignedByteType,r.UVMapping)).minFilter=n.magFilter=r.LinearFilter,n.wrapS=n.wrapT=r.RepeatWrapping,t(n)}else this._textureLoader=this._textureLoader||new c.default,this._textureLoader.load(e,function(e){e.minFilter=e.magFilter=r.LinearFilter,e.wrapS=e.wrapT=r.RepeatWrapping,e.needsUpdate=!0,t(e)})}},{key:"_constructLineOptions",value:function(e,r){var n=Object.assign({},f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_constructLineOptions",this).call(this,e,r)),i=this._pointsxyz[e],o=this._pointsxyz[r];return n.baseLine=[i,o],n}},{key:"_constructInteractShapeGeometry",value:function(){for(var e=f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_constructInteractShapeGeometry",this).call(this),n=this._unitAltVector.clone().multiplyScalar(this._fenceHeight),i=0;i<this._points.length-1;i+=1){var o=this._constructLineOptions(i,i+1),a=new r.Geometry;a.vertices.push(o.baseLine[0],o.baseLine[1],o.baseLine[0].clone().add(n),o.baseLine[1].clone().add(n)),a.faces.push(new r.Face3(0,1,2),new r.Face3(1,2,3)),e.merge(a)}return e}},{key:"_updateInteractShape",value:function(){var e=this._constructInteractShapeGeometry();this.interactShape.geometry.dispose(),this.interactShape.geometry=e}},{key:"addPoint",value:function(e){f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addPoint",this).call(this,e);var r=this._constructLineOptions(this.pointsNumber-2,this.pointsNumber-1);this.lineHolder.addNewLine(r);var n=this.pointsNumber-2,i=this.labelHolder._labelOptions[n],o={x:i.width/i.height*this._labelScale,y:this._labelScale,z:1};this.labelHolder.drawOnLabel(n,{scale:o}),this._updateInteractShape()}},{key:"setPoint",value:function(e,r){if(f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setPoint",this).call(this,e,r),0!==e){var n=this._constructLineOptions(e-1,e);this.lineHolder.updateLine(e-1,n);var i=this.labelHolder._labelOptions[e-1],o={x:i.width/i.height*this._labelScale,y:this._labelScale,z:1};this.labelHolder.drawOnLabel(e-1,{scale:o})}if(e!==this.pointsNumber-1){var a=this._constructLineOptions(e,e+1);this.lineHolder.updateLine(e,a);var s=this.labelHolder._labelOptions[e],l={x:s.width/s.height*this._labelScale,y:this._labelScale,z:1};this.labelHolder.drawOnLabel(e,{scale:l})}this._updateInteractShape()}},{key:"destruct",value:function(){this._uvAnimation&&(this._uvAnimation.stop(),this._uvAnimation=void 0),this.lineHolder.destruct(),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"opacity",set:function(e){this.lineHolder.opacity=e,this._opacity=e,this._property.opacity=e},get:function(){return this._opacity}},{key:"fenceHeight",set:function(e){this._fenceHeight=e,this._property.fenceHeight=e,this.lineHolder.fenceHeight=e,this._labelScale=l.default.scale/l.default.EARTH_RADIUS*10*this._labelScaleFunc(this._fenceHeight);for(var t=0;t<this.labelHolder._labelOptions.length;++t){var r=this.labelHolder._labelOptions[t],n={x:r.width/r.height*this._labelScale,y:this._labelScale,z:1};this.labelHolder.drawOnLabel(t,{scale:n})}this._updateInteractShape()},get:function(){return this._fenceHeight}},{key:"labelScaleFunc",set:function(e){!function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"labelScaleFunc",e,this),this._labelScale=l.default.scale/l.default.EARTH_RADIUS*10*this._labelScaleFunc(this._fenceHeight);for(var r=0;r<this.labelHolder._labelOptions.length;++r){var n=this.labelHolder._labelOptions[r],i={x:n.width/n.height*this._labelScale,y:this._labelScale,z:1};this.labelHolder.drawOnLabel(r,{scale:i})}},get:function(){return this._labelScaleFunc}},{key:"lineWidth",set:function(e){this._lineWidth=e,this._property.lineWidth=e},get:function(){return this._lineWidth}},{key:"color",set:function(e){this._color=e,this._property.color=e,this.lineHolder.color=new r.Color(e)},get:function(){return this._color}},{key:"depthTest",set:function(e){this._depthTest=e,this._property.depthTest=e,this.lineHolder.depthTest=e},get:function(){return this._depthTest}},{key:"style",set:function(e){var t=this;e=e||{};var r=this._style,n=Object.assign({},r,e);e.texture&&!e.mapping&&(n.texture===g.FENCE?n.mapping=y.LINEAR:n.texture===g.ARROW&&(n.mapping=y.REPEAT)),this._style=n,n.mapping!==y.LINEAR&&n.mapping!==y.REPEAT&&(console.warn("invalid mapping: ",n.mapping," mapping set to 'repeat'"),n.mapping=y.REPEAT);var i=n.texture&&(!r||r.texture!==n.texture),o=n.animation&&(!r||r.animation!==n.animation),a=!o&&n.mapping&&(!r||r.mapping!==n.mapping);i&&this._updateAlphaTexture(this._style.texture,function(e){t.lineHolder._lineMaterial.alphaMap&&(t.lineHolder._lineMaterial.alphaMap.dispose(),t.lineHolder._lineMaterial.alphaMap=null),t.lineHolder._lineMaterial.alphaMap=e,t.lineHolder._lineMaterial.alphaMap.needsUpdate=!0,t.lineHolder._lineMaterial.needsUpdate=!0,t.lineHolder.updateLineUvs(t._style.mapping)}),o&&(this.lineHolder.updateLineUvs(this._style.mapping),this._uvAnimation&&this._uvAnimation.changeStates({offset:0}),this._style.animation=e.animation),a&&this.lineHolder.updateLineUvs(this._style.mapping),this.color=this._style.color,this.opacity=this._style.opacity},get:function(){return this._style}},{key:"speed",set:function(e){"number"==typeof e&&(this._speed=e,this._uvAnimation&&this._uvAnimation.changeStates({speed:this._speed}))},get:function(){return this._speed}}]),t}();e.default=b,e.FenceLineHolder=w},i=[t,r(34),r(0),r(1),r(7),r(10),r(8)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BaseLabelHolder=e.default=void 0;var s=f(t),l=f(r),u=f(i),c=f(o),h=f(a);function f(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var p=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var g=function(e){function t(e){d(this,t);var r=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._labelOptions=[],r._textOptions=e.textOptions,r}return v(t,n.Object3D),p(t,[{key:"addNewLabel",value:function(e,t){if(this._labelOptions.push(e),t){var r=new n.Sprite(new n.SpriteMaterial({map:null,color:16777215,depthTest:!1})),i=new u.default(e.width,e.height),o=Object.assign({},this._textOptions,{text:e.text});i=i.drawTextCooked(o),r.material.map=i.texture,r.position.copy(e.positionxyz),r.scale.set(e.scale.x,e.scale.y,e.scale.z),this.add(r)}}},{key:"drawOnLabel",value:function(e,t){var r=this.children[e];if(this._labelOptions[e]=Object.assign({},this._labelOptions[e],t),r){if(t.positionxyz&&r.position.copy(t.positionxyz),t.text&&t.width&&t.height){var n=new u.default(t.width,t.height),i=Object.assign({},this._textOptions,{text:t.text});n=n.drawTextCooked(i),r.material.map.dispose(),r.material.map=n.texture}t.scale&&r.scale.set(t.scale.x,t.scale.y,t.scale.z)}}},{key:"constructAllLabels",value:function(){if(this.children.length<this._labelOptions.length)for(var e=this.children.length;e<this._labelOptions.length;++e){var t=this._labelOptions[e],r=new n.Sprite(new n.SpriteMaterial({map:null,color:16777215,depthTest:!1})),i=new u.default(t.width,t.height),o=Object.assign({},this._textOptions,{text:t.text});i=i.drawTextCooked(o),r.material.map=i.texture,r.position.copy(t.positionxyz),r.scale.set(t.scale.x,t.scale.y,t.scale.z),this.add(r)}}},{key:"destruct",value:function(){for(var e=this.children.length-1;e>=0;e-=1){var t=this.children[e];t.material&&(t.material.map&&t.material.map.dispose(),t.material.dispose()),this.remove(t)}}},{key:"textOptions",set:function(e){this._textOptions=Object.assign({},this._textOptions,e);for(var t=0;t<this.children.length;++t){var r=this.children[t],n=this._labelOptions[t],i=new u.default(n.width,n.height),o=Object.assign({},this._textOptions,{text:n.text});i=i.drawTextCooked(o),r.material.map.dispose(),r.material.map=i.texture,r.position.copy(n.positionxyz),r.scale.set(n.scale.x,n.scale.y,n.scale.z)}}}]),t}(),y=function(e){function t(e){var r;if(d(this,t),!(r=e)||!r.earth&&!r.sandbox||(null!==r.points&&void 0!==r.points&&r.points instanceof Array?r.points.length<2&&(console.warn("[PolyBaseLineMarker] cannot be constructed due to no enough points",r.points),1):(console.warn("[PolyBaseLineMarker] no usable points!",r),1)))return console.warn("[PolyBaseLineMarker] invalid markerOptions!",e),void 0,m(n,void 0);e.position=function(e){for(var t=new l.default(0,0,0),r=0;r<e.length;++r)t.lng+=e[r].lng,t.lat+=e[r].lat;return t.lng/=e.length,t.lat/=e.length,t}(e.points);var n=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n._points=e.points,n._lineWidth=e.lineWidth?e.lineWidth:1,n._color=e.color?e.color:16777215,n._depthTest=void 0===e.depthTest||e.depthTest,n._property.points=n._points,n._property.lineWidth=n._lineWidth,n._property.color=n._color,n._property.depthTest=n._depthTest;e.textOptions=e.textOptions||{},n._labelsVisible=void 0!==e.labelsVisible&&e.labelsVisible,n._textOptions=Object.assign({},{margin:0,lineHeight:.1,align:"center",fillStyle:"red",font:"bold 60px Times New Roman",outlineWidth:2,outlineStyle:"black",resetCursorY:!0,trimText:!0},e.textOptions),n._property.labelsVisible=n._labelsVisible,n._property.textOptions=n._textOptions,n._calculateSystem(),n._pointsxyz=n._points.map(function(e){return n._convertPointToXYZPoint(e)}),e.__DO_NOT_CONSTRUCT_LINE_INTERAL_USE=void 0,n.labelHolder=new g({textOptions:n._textOptions}),n.contentHolder.add(n.labelHolder),n.labelHolder.visible=n._labelsVisible;for(var i=0;i<n._points.length-1;++i){var o=n._constructLabelOptions(i,i+1);n.labelHolder.addNewLabel(o,n._labelsVisible)}n._labelScaleFunc=function(e){return 1},n._property.labelScaleFunc=n._labelScaleFunc.toString();var a=n.position,s={lng:a.lng,lat:a.lat,alt:a.alt+1},u=n._convertPointToXYZPoint(a),c=n._convertPointToXYZPoint(s);return n._unitAltVector=c.clone().sub(u),n._property.type="PolyBaseLineMarker",n}return v(t,s.default),p(t,[{key:"_calculateSystem",value:function(){this.system=c.default.getLocalSystemOnEarthSurface(h.default.EarthResolution,this.position.lng,this.position.lat,h.default.scale)}},{key:"_convertPointToXYZPoint",value:function(e){null!==this.system&&void 0!==this.system||this._calculateSystem();var t=c.default.getNoneGroundCartesianFromLngLatAlt(h.default.EarthResolution,e.lng,e.lat,e.alt,h.default.scale).clone().sub(this.system.origin),r=1*t.dot(this.system.lng),i=1*t.dot(this.system.lat),o=1*t.dot(this.system.alt);return new n.Vector3(r,i,o)}},{key:"_distanceText",value:function(e){return(Math.round(100*e)/100).toString()+" m"}},{key:"_constructLineOptions",value:function(e,t){return{}}},{key:"_constructPointOptions",value:function(e){return{}}},{key:"_constructLabelOptions",value:function(e,t){var r={},n=this._points[e],i=this._points[t],o=this.earth.calculateDistanceBetweenTwoPoints(n,i),a="";o>=.01&&(a=this._distanceText(o)),r.text=a;var s=64*a.length+64,l=Math.log(s)/Math.log(2);l=Math.floor(l)+1,s=Math.pow(2,l);r.width=s,r.height=128;var u=this._pointsxyz[e],c=this._pointsxyz[t];r.positionxyz=u.clone().add(c).multiplyScalar(.5);var f=h.default.scale/h.default.EARTH_RADIUS*10;return r.scale={x:f*s/128,y:f,z:1},r}},{key:"_constructInteractShapeGeometry",value:function(){return new n.Geometry}},{key:"addPoint",value:function(e){this._points.push(e),this._pointsxyz.push(this._convertPointToXYZPoint(e));var t=this._constructLabelOptions(this.pointsNumber-2,this.pointsNumber-1);this.labelHolder.addNewLabel(t,this._labelsVisible)}},{key:"setPoint",value:function(e,t){(e<0||e>=this._points.length)&&console.warn("[PolyCylinderLineMarker] setPoint index out of boundary",e,t),this._points[e]=t,this._pointsxyz[e]=this._convertPointToXYZPoint(t);var r=this;function n(e){var t=r._constructLabelOptions(e,e+1);r.labelHolder.drawOnLabel(e,t)}0!==e&&n(e-1),e!==this.pointsNumber-1&&n(e)}},{key:"destruct",value:function(){this.labelHolder&&this.labelHolder.destruct(),function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"points",get:function(){return this._points}},{key:"pointsNumber",get:function(){return this._points.length}},{key:"color",set:function(e){this._color=e,this._property.color=e},get:function(){return this._color}},{key:"depthTest",set:function(e){this._depthTest=e,this._property.depthTest=e},get:function(){return this._depthTest}},{key:"labelsVisible",set:function(e){this._labelsVisible=e,this._property.labelsVisible=e,this.labelHolder.visible=this._labelsVisible,this._labelsVisible&&this.labelHolder.constructAllLabels()},get:function(){return this._labelsVisible}},{key:"textOptions",set:function(e){this._textOptions=Object.assign({},this._textOptions,e),this._property.textOptions=e,this.labelHolder.textOptions=this._textOptions},get:function(){return this._textOptions}},{key:"labelScaleFunc",set:function(e){"function"==typeof e&&"number"==typeof e(1)&&(this._labelScaleFunc=e,this._property.labelScaleFunc=e.toString())},get:function(){return this._labelScaleFunc}},{key:"length",get:function(){for(var e=0,t=0;t<this._points.length-1;++t)e+=this.earth.calculateDistanceBetweenTwoPoints(this._points[t],this._points[t+1]);return e}}]),t}();e.default=y,e.BaseLabelHolder=g},i=[t,r(5),r(6),r(0),r(18),r(3),r(1)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=u(r),s=u(i),l=u(o);function u(e){return e&&e.__esModule?e:{default:e}}var c=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var f=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var m=function(e){function t(e){h(this,t);var r=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._lineMaterial=new n.MeshBasicMaterial({color:e.color,depthTest:e.depthTest,side:n.DoubleSide,opacity:e.opacity,transparent:!0}),r._unitCylinderLineGeometry=e.unitCylinderLineGeometry,r._scaledLineWidth=e.lineWidth*s.default.scale/s.default.EARTH_RADIUS,r._lineOptions=[],r}return p(t,n.Object3D),f(t,[{key:"addNewLine",value:function(e){this._lineOptions.push(e);var t=this._unitCylinderLineGeometry,r=new n.Mesh(t,this._lineMaterial);r.applyMatrix((new n.Matrix4).makeScale(this._scaledLineWidth,e.distance,this._scaledLineWidth));var i=new n.Matrix4;i.makeBasis(e.system.x,e.system.y,e.system.z),i.setPosition(e.system.origin),r.applyMatrix(i),r.renderOrder=l.default.POLYLINE_RENDER_ORDER,this.add(r)}},{key:"updateLine",value:function(e,t){this._lineOptions[e]=t;var r=this.children[e];r.matrix.identity(),r.applyMatrix((new n.Matrix4).makeScale(this._scaledLineWidth,t.distance,this._scaledLineWidth));var i=new n.Matrix4;i.makeBasis(t.system.x,t.system.y,t.system.z),i.setPosition(t.system.origin),r.applyMatrix(i)}},{key:"destruct",value:function(){for(var e=this.children.length-1;e>=0;e-=1){var t=this.children[e];t.geometry&&t.geometry.dispose()}this._lineMaterial.dispose(),this._lineOptions=[]}},{key:"lineWidth",set:function(e){this._scaledLineWidth=e*s.default.scale/s.default.EARTH_RADIUS;for(var t=0;t<this.children.length;++t){var r=this.children[t],i=this._lineOptions[t];r.matrix.identity(),r.applyMatrix((new n.Matrix4).makeScale(this._scaledLineWidth,i.distance,this._scaledLineWidth));var o=new n.Matrix4;o.makeBasis(i.system.x,i.system.y,i.system.z),o.setPosition(i.system.origin),r.applyMatrix(o)}}},{key:"opacity",set:function(e){this._lineMaterial.opacity=e}},{key:"depthTest",set:function(e){this._lineMaterial.depthTest=e}},{key:"color",set:function(e){this._lineMaterial.color=e}}]),t}(),v=function(e){function t(e){h(this,t);var r=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._pointMaterial=new n.MeshBasicMaterial({color:e.color,depthTest:e.depthTest,side:n.DoubleSide,opacity:e.opacity,transparent:!0}),r._unitSpherePointGeometry=e.unitSpherePointGeometry,r._scaledLineWidth=e.lineWidth*s.default.scale/s.default.EARTH_RADIUS,r._pointOptions=[],r}return p(t,n.Object3D),f(t,[{key:"addNewPoint",value:function(e){this._pointOptions.push(e);var t=this._unitSpherePointGeometry,r=new n.Mesh(t,this._pointMaterial);r.applyMatrix((new n.Matrix4).makeScale(this._scaledLineWidth,this._scaledLineWidth,this._scaledLineWidth)),r.position.copy(e.positionxyz),r.renderOrder=l.default.POLYLINE_RENDER_ORDER,this.add(r)}},{key:"updatePoint",value:function(e,t){this._pointOptions[e]=t,this.children[e].position.copy(t.positionxyz)}},{key:"destruct",value:function(){for(var e=this.children.length-1;e>=0;e-=1){var t=this.children[e];t.geometry&&t.geometry.dispose()}this._pointMaterial.dispose(),this._pointOptions=[]}},{key:"lineWidth",set:function(e){this._scaledLineWidth=e*s.default.scale/s.default.EARTH_RADIUS;for(var t=0;t<this.children.length;++t){var r=this.children[t],i=this._pointOptions[t];r.matrix.identity(),r.applyMatrix((new n.Matrix4).makeScale(this._scaledLineWidth,this._scaledLineWidth,this._scaledLineWidth)),r.position.copy(i.positionxyz)}}},{key:"opacity",set:function(e){this._pointMaterial.opacity=e}},{key:"depthTest",set:function(e){this._pointMaterial.depthTest=e}},{key:"color",set:function(e){this._pointMaterial.color=e}}]),t}(),g=function(e){function t(e){h(this,t);var r=!0;e.__DO_NOT_CONSTRUCT_LINE_INTERAL_USE&&(r=!1),e.__DO_NOT_CONSTRUCT_LINE_INTERAL_USE=!0;var i=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));i._opacity="number"==typeof e.opacity?e.opacity:1,i._property.opacity=i._opacity,i._labelScaleFunc=function(e){return 1/(Math.abs(e)+.005)},i._property.labelScaleFunc=i._labelScaleFunc.toString(),i._labelScale=s.default.scale/s.default.EARTH_RADIUS*10*i._labelScaleFunc(i._lineWidth);for(var o=0;o<i.labelHolder._labelOptions.length;++o){var a=i.labelHolder._labelOptions[o],l={x:a.width/a.height*i._labelScale,y:i._labelScale,z:1};i.labelHolder.drawOnLabel(o,{scale:l})}if(r){i.lineHolder=new m({color:i._color,opacity:i._opacity,depthTest:i._depthTest,lineWidth:i._lineWidth,unitCylinderLineGeometry:t.cache.unitCylinderLineGeometry}),i.pointHolder=new v({color:i._color,opacity:i._opacity,depthTest:i._depthTest,lineWidth:i._lineWidth,unitSpherePointGeometry:t.cache.unitSpherePointGeometry}),i.contentHolder.add(i.lineHolder),i.contentHolder.add(i.pointHolder);for(var u=0;u<i._points.length-1;u+=1){var c=i._constructLineOptions(u,u+1);i.lineHolder.addNewLine(c)}for(var f=0;f<i._points.length;++f){var p=i._constructPointOptions(f);i.pointHolder.addNewPoint(p)}var g=i._constructInteractShapeGeometry(),y=new n.Mesh(g,new n.MeshBasicMaterial({side:n.DoubleSide}));i.interactShape=y}return i._property.type="PolyCylinderLineMarker",i}return p(t,a.default),f(t,[{key:"_constructLineOptions",value:function(e,r){var n=Object.assign({},c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_constructLineOptions",this).call(this,e,r)),i=this._pointsxyz[e],o=this._pointsxyz[r],a=i.clone().add(o).multiplyScalar(.5),s={};return s.y=o.clone().add(i.clone().negate()).normalize(),s.x=this._unitAltVector.clone().normalize(),s.z=s.y.clone().cross(s.x.clone()).normalize(),s.x=s.y.clone().cross(s.z.clone()).normalize(),s.origin=a.clone(),n.system=s,n.distance=o.clone().add(i.clone().negate()).length(),n}},{key:"_constructPointOptions",value:function(e){var r=Object.assign({},c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_constructPointOptions",this).call(this,e)),n=this._pointsxyz[e];return r.positionxyz=n,r}},{key:"_constructInteractShapeGeometry",value:function(){for(var e=c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_constructInteractShapeGeometry",this).call(this),r=this.lineHolder._unitCylinderLineGeometry,i=this.lineHolder._scaledLineWidth,o=0;o<this._points.length-1;o+=1){var a=this.lineHolder._lineOptions[o];if(!(a.distance<=0)){var s=(new n.Matrix4).makeScale(i,a.distance,i),l=new n.Matrix4;l.makeBasis(a.system.x,a.system.y,a.system.z),l.setPosition(a.system.origin),e.merge(r,l.multiply(s))}}for(var u=this.pointHolder._unitSpherePointGeometry,h=0;h<this._points.length;h+=1){var f=this.pointHolder._pointOptions[h],d=(new n.Matrix4).makeScale(i,i,i),p=(new n.Matrix4).setPosition(f.positionxyz);e.merge(u,p.multiply(d))}return e}},{key:"_updateInteractShape",value:function(){var e=this._constructInteractShapeGeometry();this.interactShape.geometry.dispose(),this.interactShape.geometry=e}},{key:"addPoint",value:function(e){c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addPoint",this).call(this,e);var r=this._constructLineOptions(this.pointsNumber-2,this.pointsNumber-1);this.lineHolder.addNewLine(r);var n=this._constructPointOptions(this.pointsNumber-1);this.pointHolder.addNewPoint(n);var i=this.pointsNumber-2,o=this.labelHolder._labelOptions[i],a={x:o.width/o.height*this._labelScale,y:this._labelScale,z:1};this.labelHolder.drawOnLabel(i,{scale:a}),this._updateInteractShape()}},{key:"setPoint",value:function(e,r){c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setPoint",this).call(this,e,r);var n=this;0!==e&&(o(e-1),a(e-1,this._labelScale)),e!==this.pointsNumber-1&&(o(e),a(e,this._labelScale));var i=this._constructPointOptions(e);function o(e){var t=n._constructLineOptions(e,e+1);n.lineHolder.updateLine(e,t)}function a(e,t){var r=n.labelHolder._labelOptions[e],i={x:r.width/r.height*t,y:t,z:1};n.labelHolder.drawOnLabel(e,{scale:i})}this.pointHolder.updatePoint(e,i),this._updateInteractShape()}},{key:"destruct",value:function(){this.lineHolder.destruct(),this.pointHolder.destruct(),c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"lineWidth",set:function(e){this._lineWidth=e,this._property.lineWidth=e,this.lineHolder.lineWidth=this._lineWidth,this.pointHolder.lineWidth=this._lineWidth,this._labelScale=s.default.scale/s.default.EARTH_RADIUS*10*this._labelScaleFunc(this._lineWidth);for(var t=0;t<this.labelHolder._labelOptions.length;++t){var r=this.labelHolder._labelOptions[t],n={x:r.width/r.height*this._labelScale,y:this._labelScale,z:1};this.labelHolder.drawOnLabel(t,{scale:n})}this._updateInteractShape()},get:function(){return this._lineWidth}},{key:"labelScaleFunc",set:function(e){!function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"labelScaleFunc",e,this),this._labelScale=s.default.scale/s.default.EARTH_RADIUS*10*this._labelScaleFunc(this._lineWidth);for(var r=0;r<this.labelHolder._labelOptions.length;++r){var n=this.labelHolder._labelOptions[r],i={x:n.width/n.height*this._labelScale,y:this._labelScale,z:1};this.labelHolder.drawOnLabel(r,{scale:i})}},get:function(){return this._labelScaleFunc}},{key:"opacity",set:function(e){this._opacity=e,this._property.opacity=e,this.lineHolder.opacity=e,this.pointHolder.opacity=e},get:function(){return this._opacity}},{key:"color",set:function(e){this._color=e,this._property.color=e;var t=new n.Color(this._color);this.lineHolder.color=t,this.pointHolder.color=t},get:function(){return this._color}},{key:"depthTest",set:function(e){this._depthTest=e,this._property.depthTest=e,this.lineHolder.depthTest=e,this.pointHolder.depthTest=e},get:function(){return this._depthTest}}]),t}();g.cache={unitCylinderLineGeometry:new n.CylinderGeometry(1,1,1,8),unitSpherePointGeometry:new n.SphereGeometry(1,8,8)},t.default=g,e.exports=t.default},i=[e,t,r(34),r(0),r(1),r(7)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o,a,s,l,u,c,h,f,d,p,m,v,g,y,_,w,b,x,k,A,M,S,P,T,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Color=e.Quaternion=e.OrthographicCamera=e.RGBAFormat=e.NearestFilter=e.WebGLRenderTarget=e.GeometryUtils=e.HeightMapMarker=e.SkylineHeightLimitCalculator=e.offlineRenderer=e.MarkerCluster=e.Sandbox=e.Solution=e.FusionPhotoControl=e.drawGeoJson=e.AltizureProjectMarker=e.ZoneMarker=e.LightBeamMarker=e.CameraMarker=e.PolyFenceLineMarker=e.PolyCylinderLineMarker=e.PolyLineMarker=e.DitchMarker=e.CylinderVolumeMarker=e.RegularPolygonMarker=e.PolygonMarker=e.CanvasTagMarker=e.TextTagMarker=e.TagMarker=e.OBJMarker=e.EarthConstants=e.EarthMath=e.GeoCoord=e.LngLatAlt=e.Marker=e.Earth=void 0;var C=ne(t),E=ne(r),I=ne(n),R=ne(i),L=ne(o),j=ne(a),z=ne(s),B=ne(l),D=ne(u),N=ne(c),U=ne(h),F=ne(f),H=ne(d),V=ne(p),W=ne(m),G=ne(v),Y=ne(g),K=ne(y),X=ne(_),Z=ne(b),q=ne(x),Q=ne(k),J=ne(A),$=ne(M),ee=ne(S),te=ne(P),re=ne(T);function ne(e){return e&&e.__esModule?e:{default:e}}var ie=Z.default,oe=G.default;Object.assign=Object.assign||function(e){for(var t=arguments,r=1;r<t.length;r+=1){var n=t[r];for(var i in Object.keys(n))e[i]=n[i]}return e},e.Earth=C.default,e.Marker=j.default,e.LngLatAlt=E.default,e.GeoCoord=I.default,e.EarthMath=R.default,e.EarthConstants=L.default,e.OBJMarker=z.default,e.TagMarker=B.default,e.TextTagMarker=D.default,e.CanvasTagMarker=N.default,e.PolygonMarker=U.default,e.RegularPolygonMarker=F.default,e.CylinderVolumeMarker=H.default,e.DitchMarker=V.default,e.PolyLineMarker=oe,e.PolyCylinderLineMarker=W.default,e.PolyFenceLineMarker=G.default,e.CameraMarker=Y.default,e.LightBeamMarker=K.default,e.ZoneMarker=X.default,e.AltizureProjectMarker=q.default,e.drawGeoJson=w.drawGeoJson,e.FusionPhotoControl=Q.default,e.Solution=ie,e.Sandbox=Z.default,e.MarkerCluster=J.default,e.offlineRenderer=$.default,e.SkylineHeightLimitCalculator=ee.default,e.HeightMapMarker=te.default,e.GeometryUtils=re.default,e.WebGLRenderTarget=O.WebGLRenderTarget,e.NearestFilter=O.NearestFilter,e.RGBAFormat=O.RGBAFormat,e.OrthographicCamera=O.OrthographicCamera,e.Quaternion=O.Quaternion,e.Color=O.Color},i=[t,r(21),r(6),r(77),r(3),r(1),r(5),r(29),r(30),r(17),r(83),r(19),r(32),r(84),r(85),r(35),r(33),r(86),r(87),r(88),r(89),r(90),r(13),r(95),r(96),r(28),r(101),r(102),r(103),r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){"use strict";var n=r(2),i=r(22),o=r(39),a=r(12);function s(e){var t=new o(e),r=i(o.prototype.request,t);return n.extend(r,o.prototype,t),n.extend(r,t),r}var l=s(a);l.Axios=o,l.create=function(e){return s(n.merge(a,e))},l.Cancel=r(27),l.CancelToken=r(53),l.isCancel=r(26),l.all=function(e){return Promise.all(e)},l.spread=r(54),e.exports=l,e.exports.default=l},function(e,t){function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
e.exports=function(e){return null!=e&&(r(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&r(e.slice(0,0))}(e)||!!e._isBuffer)}},function(e,t,r){"use strict";var n=r(12),i=r(2),o=r(48),a=r(49),s=r(51),l=r(52);function u(e){this.defaults=e,this.interceptors={request:new o,response:new o}}u.prototype.request=function(e){"string"==typeof e&&(e=i.merge({url:arguments[0]},arguments[1])),(e=i.merge(n,this.defaults,{method:"get"},e)).method=e.method.toLowerCase(),e.baseURL&&!s(e.url)&&(e.url=l(e.baseURL,e.url));var t=[a,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)r=r.then(t.shift(),t.shift());return r},i.forEach(["delete","get","head","options"],function(e){u.prototype[e]=function(t,r){return this.request(i.merge(r||{},{method:e,url:t}))}}),i.forEach(["post","put","patch"],function(e){u.prototype[e]=function(t,r,n){return this.request(i.merge(n||{},{method:e,url:t,data:r}))}}),e.exports=u},function(e,t,r){"use strict";var n=r(2);e.exports=function(e,t){n.forEach(e,function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])})}},function(e,t,r){"use strict";var n=r(25);e.exports=function(e,t,r){var i=r.config.validateStatus;r.status&&i&&!i(r.status)?t(n("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)}},function(e,t,r){"use strict";e.exports=function(e,t,r,n,i){return e.config=t,r&&(e.code=r),e.request=n,e.response=i,e}},function(e,t,r){"use strict";var n=r(2);function i(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,r){if(!t)return e;var o;if(r)o=r(t);else if(n.isURLSearchParams(t))o=t.toString();else{var a=[];n.forEach(t,function(e,t){null!==e&&void 0!==e&&(n.isArray(e)&&(t+="[]"),n.isArray(e)||(e=[e]),n.forEach(e,function(e){n.isDate(e)?e=e.toISOString():n.isObject(e)&&(e=JSON.stringify(e)),a.push(i(t)+"="+i(e))}))}),o=a.join("&")}return o&&(e+=(-1===e.indexOf("?")?"?":"&")+o),e}},function(e,t,r){"use strict";var n=r(2);e.exports=function(e){var t,r,i,o={};return e?(n.forEach(e.split("\n"),function(e){i=e.indexOf(":"),t=n.trim(e.substr(0,i)).toLowerCase(),r=n.trim(e.substr(i+1)),t&&(o[t]=o[t]?o[t]+", "+r:r)}),o):o}},function(e,t,r){"use strict";var n=r(2);e.exports=n.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function i(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=i(window.location.href),function(t){var r=n.isString(t)?i(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0}},function(e,t,r){"use strict";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function i(){this.message="String contains an invalid character"}i.prototype=new Error,i.prototype.code=5,i.prototype.name="InvalidCharacterError",e.exports=function(e){for(var t,r,o=String(e),a="",s=0,l=n;o.charAt(0|s)||(l="=",s%1);a+=l.charAt(63&t>>8-s%1*8)){if((r=o.charCodeAt(s+=.75))>255)throw new i;t=t<<8|r}return a}},function(e,t,r){"use strict";var n=r(2);e.exports=n.isStandardBrowserEnv()?{write:function(e,t,r,i,o,a){var s=[];s.push(e+"="+encodeURIComponent(t)),n.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),n.isString(i)&&s.push("path="+i),n.isString(o)&&s.push("domain="+o),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,r){"use strict";var n=r(2);function i(){this.handlers=[]}i.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){n.forEach(this.handlers,function(t){null!==t&&e(t)})},e.exports=i},function(e,t,r){"use strict";var n=r(2),i=r(50),o=r(26),a=r(12);function s(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return s(e),e.headers=e.headers||{},e.data=i(e.data,e.headers,e.transformRequest),e.headers=n.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),n.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||a.adapter)(e).then(function(t){return s(e),t.data=i(t.data,t.headers,e.transformResponse),t},function(t){return o(t)||(s(e),t&&t.response&&(t.response.data=i(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})}},function(e,t,r){"use strict";var n=r(2);e.exports=function(e,t,r){return n.forEach(r,function(r){e=r(e,t)}),e}},function(e,t,r){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,r){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,r){"use strict";var n=r(27);function i(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var r=this;e(function(e){r.reason||(r.reason=new n(e),t(r.reason))})}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var e;return{token:new i(function(t){e=t}),cancel:e}},e.exports=i},function(e,t,r){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=s(n),a=s(i);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var u=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=r,i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o.default,n));return i._property.type="MarkerLayer",i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.HyperLayer),l(t,[{key:"sceneUpdated",value:function(e){this.applyToChildren(function(e,t){e instanceof a.default||e.sceneUpdated(t)},e),a.default._forest&&a.default._forest.sceneUpdated(e)}}]),t}();t.default=u,e.exports=t.default},i=[e,t,r(4),r(5),r(13)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r.EarthBasic.HyperClasses.HyperNode;t.default=n,e.exports=t.default},i=[e,t,r(4)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=(i=n)&&i.__esModule?i:{default:i};var a=function(e){r.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=r.FrontSide,this.transparent=!0,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};(a.prototype=Object.create(r.MeshBasicMaterial.prototype)).constructor=a;var s=function(e){r.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};(s.prototype=Object.create(r.LineBasicMaterial.prototype)).constructor=s;var l=new a({visible:!1,transparent:!1,side:r.DoubleSide}),u=function(){this.init=function(){r.Object3D.call(this),this.handles=new r.Object3D,this.pickers=new r.Object3D,this.planes=new r.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes);var e=new r.PlaneBufferGeometry(50,50,2,2),t=new r.MeshBasicMaterial({visible:!1,side:r.DoubleSide}),n={XY:new r.Mesh(e,t),YZ:new r.Mesh(e,t),XZ:new r.Mesh(e,t),XYZE:new r.Mesh(e,t)};for(var i in this.activePlane=n.XYZE,n.YZ.rotation.set(0,Math.PI/2,0),n.XZ.rotation.set(-Math.PI/2,0,0),n)n[i].name=i,n[i].renderOrder=o.default.TRANSFORM_CONTROL_RENDER_ORDER,this.planes.add(n[i]),this.planes[i]=n[i];var a=function(e,t){for(var r in e)for(i=e[r].length;i--;){var n=e[r][i][0],a=e[r][i][1],s=e[r][i][2];n.name=r,n.renderOrder=o.default.TRANSFORM_CONTROL_RENDER_ORDER,a&&n.position.set(a[0],a[1],a[2]),s&&n.rotation.set(s[0],s[1],s[2]),t.add(n)}};a(this.handleGizmos,this.handles),a(this.pickerGizmos,this.pickers),this.traverse(function(e){if(e instanceof r.Mesh||e instanceof r.Line){e.updateMatrix();var t=e.geometry.clone();t.applyMatrix(e.matrix),e.geometry=t,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1)}})},this.highlight=function(e){this.traverse(function(t){t.material&&t.material.highlight&&(t.name===e?t.material.highlight(!0):t.material.highlight(!1))})}};(u.prototype=Object.create(r.Object3D.prototype)).constructor=u,u.prototype.update=function(e,t){var n=new r.Vector3(0,0,0),i=new r.Vector3(0,1,0),o=new r.Matrix4;this.traverse(function(r){-1!==r.name.search("E")?r.quaternion.setFromRotationMatrix(o.lookAt(t,n,i)):-1===r.name.search("X")&&-1===r.name.search("Y")&&-1===r.name.search("Z")||r.quaternion.setFromEuler(e)})};var c=function(){u.call(this);var e=new r.Geometry,t=new r.Mesh(new r.CylinderGeometry(0,.05,.2,12,1,!1));t.position.y=.5,t.updateMatrix(),e.merge(t.geometry,t.matrix);var n=new r.BufferGeometry;n.addAttribute("position",new r.Float32BufferAttribute([0,0,0,1,0,0],3));var i=new r.BufferGeometry;i.addAttribute("position",new r.Float32BufferAttribute([0,0,0,0,1,0],3));var o=new r.BufferGeometry;o.addAttribute("position",new r.Float32BufferAttribute([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new r.Mesh(e,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new r.Line(n,new s({color:16711680}))]],Y:[[new r.Mesh(e,new a({color:65280})),[0,.5,0]],[new r.Line(i,new s({color:65280}))]],Z:[[new r.Mesh(e,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new r.Line(o,new s({color:255}))]],XYZ:[[new r.Mesh(new r.OctahedronGeometry(.1,0),new a({color:16777215,opacity:.25,visible:!1})),[0,0,0],[0,0,0]]],XY:[[new r.Mesh(new r.PlaneBufferGeometry(.29,.29),new a({color:16776960,opacity:.25,side:r.DoubleSide})),[.15,.15,0]]],YZ:[[new r.Mesh(new r.PlaneBufferGeometry(.29,.29),new a({color:65535,opacity:.25,side:r.DoubleSide})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new r.Mesh(new r.PlaneBufferGeometry(.29,.29),new a({color:16711935,opacity:.25,side:r.DoubleSide})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new r.Mesh(new r.CylinderBufferGeometry(.2,0,1,4,1,!1),l),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new r.Mesh(new r.CylinderBufferGeometry(.2,0,1,4,1,!1),l),[0,.6,0]]],Z:[[new r.Mesh(new r.CylinderBufferGeometry(.2,0,1,4,1,!1),l),[0,0,.6],[Math.PI/2,0,0]]],XY:[[new r.Mesh(new r.PlaneBufferGeometry(.4,.4),l),[.2,.2,0]]],YZ:[[new r.Mesh(new r.PlaneBufferGeometry(.4,.4),l),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new r.Mesh(new r.PlaneBufferGeometry(.4,.4),l),[.2,0,.2],[-Math.PI/2,0,0]]]},this.setActivePlane=function(e,t){var n=new r.Matrix4;t.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))),"X"===e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"===e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"===e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===e&&(this.activePlane=this.planes.XYZE),"XY"===e&&(this.activePlane=this.planes.XY),"YZ"===e&&(this.activePlane=this.planes.YZ),"XZ"===e&&(this.activePlane=this.planes.XZ)},this.init()};(c.prototype=Object.create(u.prototype)).constructor=c;var h=function(){u.call(this);var e=function(e,t,n){var i=new r.BufferGeometry,o=[];n=n||1;for(var a=0;a<=64*n;++a)"x"===t&&o.push(0,Math.cos(a/32*Math.PI)*e,Math.sin(a/32*Math.PI)*e),"y"===t&&o.push(Math.cos(a/32*Math.PI)*e,0,Math.sin(a/32*Math.PI)*e),"z"===t&&o.push(Math.sin(a/32*Math.PI)*e,Math.cos(a/32*Math.PI)*e,0);return i.addAttribute("position",new r.Float32BufferAttribute(o,3)),i};this.handleGizmos={X:[[new r.Line(new e(1,"x",.5),new s({color:16711680}))]],Y:[[new r.Line(new e(1,"y",.5),new s({color:65280}))]],Z:[[new r.Line(new e(1,"z",.5),new s({color:255}))]],E:[[new r.Line(new e(1.25,"z",1),new s({color:13421568}))]],XYZE:[[new r.Line(new e(1,"z",1),new s({color:7895160}))]]},this.pickerGizmos={X:[[new r.Mesh(new r.TorusBufferGeometry(1,.12,4,12,Math.PI),l),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new r.Mesh(new r.TorusBufferGeometry(1,.12,4,12,Math.PI),l),[0,0,0],[Math.PI/2,0,0]]],Z:[[new r.Mesh(new r.TorusBufferGeometry(1,.12,4,12,Math.PI),l),[0,0,0],[0,0,-Math.PI/2]]],E:[[new r.Mesh(new r.TorusBufferGeometry(1.25,.12,2,24),l)]],XYZE:[[new r.Mesh]]},this.setActivePlane=function(e){"E"===e&&(this.activePlane=this.planes.XYZE),"X"===e&&(this.activePlane=this.planes.YZ),"Y"===e&&(this.activePlane=this.planes.XZ),"Z"===e&&(this.activePlane=this.planes.XY)},this.update=function(e,t){u.prototype.update.apply(this,arguments);this.handles,this.pickers;var n=new r.Matrix4,i=new r.Euler(0,0,1),o=new r.Quaternion,a=new r.Vector3(1,0,0),s=new r.Vector3(0,1,0),l=new r.Vector3(0,0,1),c=new r.Quaternion,h=new r.Quaternion,f=new r.Quaternion,d=t.clone();i.copy(this.planes.XY.rotation),o.setFromEuler(i),n.makeRotationFromQuaternion(o).getInverse(n),d.applyMatrix4(n),this.traverse(function(e){o.setFromEuler(i),"X"===e.name&&(c.setFromAxisAngle(a,Math.atan2(-d.y,d.z)),o.multiplyQuaternions(o,c),e.quaternion.copy(o)),"Y"===e.name&&(h.setFromAxisAngle(s,Math.atan2(d.x,d.z)),o.multiplyQuaternions(o,h),e.quaternion.copy(o)),"Z"===e.name&&(f.setFromAxisAngle(l,Math.atan2(d.y,d.x)),o.multiplyQuaternions(o,f),e.quaternion.copy(o))})},this.init()};(h.prototype=Object.create(u.prototype)).constructor=h;var f=function(){u.call(this);var e=new r.Geometry,t=new r.Mesh(new r.BoxGeometry(.125,.125,.125));t.position.y=.5,t.updateMatrix(),e.merge(t.geometry,t.matrix);var n=new r.BufferGeometry;n.addAttribute("position",new r.Float32BufferAttribute([0,0,0,1,0,0],3));var i=new r.BufferGeometry;i.addAttribute("position",new r.Float32BufferAttribute([0,0,0,0,1,0],3));var o=new r.BufferGeometry;o.addAttribute("position",new r.Float32BufferAttribute([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new r.Mesh(e,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new r.Line(n,new s({color:16711680}))]],Y:[[new r.Mesh(e,new a({color:65280})),[0,.5,0]],[new r.Line(i,new s({color:65280}))]],Z:[[new r.Mesh(e,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new r.Line(o,new s({color:255}))]],XYZ:[[new r.Mesh(new r.BoxBufferGeometry(.125,.125,.125),new a({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new r.Mesh(new r.CylinderBufferGeometry(.2,0,1,4,1,!1),l),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new r.Mesh(new r.CylinderBufferGeometry(.2,0,1,4,1,!1),l),[0,.6,0]]],Z:[[new r.Mesh(new r.CylinderBufferGeometry(.2,0,1,4,1,!1),l),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new r.Mesh(new r.BoxBufferGeometry(.4,.4,.4),l)]]},this.setActivePlane=function(e,t){var n=new r.Matrix4;t.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))),"X"===e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"===e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"===e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===e&&(this.activePlane=this.planes.XYZE)},this.init()};(f.prototype=Object.create(u.prototype)).constructor=f;var d=function(e,t){r.Object3D.call(this),t=void 0!==t?t:document,this.object=void 0,this.visible=!1,this.translationSnap=null,this.rotationSnap=null,this.space="world",this.size=1,this.axis=null;var n=this,i="translate",o=!1,a={translate:new c,rotate:new h,scale:new f};for(var s in a){var l=a[s];l.visible=s===i,this.add(l)}var u={type:"change"},d={type:"mouseDown"},p={type:"mouseUp",mode:i},m={type:"objectChange"},v=new r.Raycaster,g=new r.Vector2,y=new r.Vector3,_=new r.Vector3,w=new r.Vector3,b=new r.Vector3,x=1,k=new r.Matrix4,A=new r.Vector3,M=new r.Matrix4,S=new r.Vector3,P=new r.Quaternion,T=new r.Vector3(1,0,0),O=new r.Vector3(0,1,0),C=new r.Vector3(0,0,1),E=new r.Quaternion,I=new r.Quaternion,R=new r.Quaternion,L=new r.Quaternion,j=new r.Quaternion,z=new r.Vector3,B=new r.Vector3,D=new r.Matrix4,N=new r.Matrix4,U=new r.Vector3,F=new r.Vector3,H=new r.Euler,V=new r.Matrix4,W=new r.Vector3,G=new r.Euler;function Y(e){if(void 0!==n.object&&!0!==o&&(void 0===e.button||0===e.button)){var t=q(e.changedTouches?e.changedTouches[0]:e,a[i].pickers.children),r=null;t&&(r=t.object.name,e.preventDefault()),n.axis!==r&&(n.axis=r,n.update(),n.dispatchEvent(u))}}function K(e){if(void 0!==n.object&&!0!==o&&(void 0===e.button||0===e.button)){var t=e.changedTouches?e.changedTouches[0]:e;if(0===t.button||void 0===t.button){var r=q(t,a[i].pickers.children);if(r){e.preventDefault(),e.stopPropagation(),n.dispatchEvent(d),n.axis=r.object.name,n.update(),A.copy(W).sub(F).normalize(),a[i].setActivePlane(n.axis,A);var s=q(t,[a[i].activePlane]);s&&(z.copy(n.object.position),B.copy(n.object.scale),D.extractRotation(n.object.matrix),V.extractRotation(n.object.matrixWorld),N.extractRotation(n.object.parent.matrixWorld),U.setFromMatrixScale(M.getInverse(n.object.parent.matrixWorld)),_.copy(s.point))}}o=!0}}function X(e){if(void 0!==n.object&&null!==n.axis&&!1!==o&&(void 0===e.button||0===e.button)){var t=q(e.changedTouches?e.changedTouches[0]:e,[a[i].activePlane]);!1!==t&&(e.preventDefault(),e.stopPropagation(),y.copy(t.point),"translate"===i?(y.sub(_),y.multiply(U),"local"===n.space&&(y.applyMatrix4(M.getInverse(V)),-1===n.axis.search("X")&&(y.x=0),-1===n.axis.search("Y")&&(y.y=0),-1===n.axis.search("Z")&&(y.z=0),y.applyMatrix4(D),n.object.position.copy(z),n.object.position.add(y)),"world"!==n.space&&-1===n.axis.search("XYZ")||(-1===n.axis.search("X")&&(y.x=0),-1===n.axis.search("Y")&&(y.y=0),-1===n.axis.search("Z")&&(y.z=0),y.applyMatrix4(M.getInverse(N)),n.object.position.copy(z),n.object.position.add(y)),null!==n.translationSnap&&("local"===n.space&&n.object.position.applyMatrix4(M.getInverse(V)),-1!==n.axis.search("X")&&(n.object.position.x=Math.round(n.object.position.x/n.translationSnap)*n.translationSnap),-1!==n.axis.search("Y")&&(n.object.position.y=Math.round(n.object.position.y/n.translationSnap)*n.translationSnap),-1!==n.axis.search("Z")&&(n.object.position.z=Math.round(n.object.position.z/n.translationSnap)*n.translationSnap),"local"===n.space&&n.object.position.applyMatrix4(V))):"scale"===i?(y.sub(_),y.multiply(U),"local"===n.space&&("XYZ"===n.axis?(x=1+y.y/Math.max(B.x,B.y,B.z),n.object.scale.x=B.x*x,n.object.scale.y=B.y*x,n.object.scale.z=B.z*x):(y.applyMatrix4(M.getInverse(V)),"X"===n.axis&&(n.object.scale.x=B.x*(1+y.x/B.x)),"Y"===n.axis&&(n.object.scale.y=B.y*(1+y.y/B.y)),"Z"===n.axis&&(n.object.scale.z=B.z*(1+y.z/B.z))))):"rotate"===i&&(y.sub(F),y.multiply(U),S.copy(_).sub(F),S.multiply(U),"E"===n.axis?(y.applyMatrix4(M.getInverse(k)),S.applyMatrix4(M.getInverse(k)),w.set(Math.atan2(y.z,y.y),Math.atan2(y.x,y.z),Math.atan2(y.y,y.x)),b.set(Math.atan2(S.z,S.y),Math.atan2(S.x,S.z),Math.atan2(S.y,S.x)),P.setFromRotationMatrix(M.getInverse(N)),j.setFromAxisAngle(A,w.z-b.z),E.setFromRotationMatrix(V),P.multiplyQuaternions(P,j),P.multiplyQuaternions(P,E),n.object.quaternion.copy(P)):"XYZE"===n.axis?(j.setFromEuler(y.clone().cross(S).normalize()),P.setFromRotationMatrix(M.getInverse(N)),I.setFromAxisAngle(j,-y.clone().angleTo(S)),E.setFromRotationMatrix(V),P.multiplyQuaternions(P,I),P.multiplyQuaternions(P,E),n.object.quaternion.copy(P)):"local"===n.space?(y.applyMatrix4(M.getInverse(V)),S.applyMatrix4(M.getInverse(V)),w.set(Math.atan2(y.z,y.y),Math.atan2(y.x,y.z),Math.atan2(y.y,y.x)),b.set(Math.atan2(S.z,S.y),Math.atan2(S.x,S.z),Math.atan2(S.y,S.x)),E.setFromRotationMatrix(D),null!==n.rotationSnap?(I.setFromAxisAngle(T,Math.round((w.x-b.x)/n.rotationSnap)*n.rotationSnap),R.setFromAxisAngle(O,Math.round((w.y-b.y)/n.rotationSnap)*n.rotationSnap),L.setFromAxisAngle(C,Math.round((w.z-b.z)/n.rotationSnap)*n.rotationSnap)):(I.setFromAxisAngle(T,w.x-b.x),R.setFromAxisAngle(O,w.y-b.y),L.setFromAxisAngle(C,w.z-b.z)),"X"===n.axis&&E.multiplyQuaternions(E,I),"Y"===n.axis&&E.multiplyQuaternions(E,R),"Z"===n.axis&&E.multiplyQuaternions(E,L),n.object.quaternion.copy(E)):"world"===n.space&&(w.set(Math.atan2(y.z,y.y),Math.atan2(y.x,y.z),Math.atan2(y.y,y.x)),b.set(Math.atan2(S.z,S.y),Math.atan2(S.x,S.z),Math.atan2(S.y,S.x)),P.setFromRotationMatrix(M.getInverse(N)),null!==n.rotationSnap?(I.setFromAxisAngle(T,Math.round((w.x-b.x)/n.rotationSnap)*n.rotationSnap),R.setFromAxisAngle(O,Math.round((w.y-b.y)/n.rotationSnap)*n.rotationSnap),L.setFromAxisAngle(C,Math.round((w.z-b.z)/n.rotationSnap)*n.rotationSnap)):(I.setFromAxisAngle(T,w.x-b.x),R.setFromAxisAngle(O,w.y-b.y),L.setFromAxisAngle(C,w.z-b.z)),E.setFromRotationMatrix(V),"X"===n.axis&&P.multiplyQuaternions(P,I),"Y"===n.axis&&P.multiplyQuaternions(P,R),"Z"===n.axis&&P.multiplyQuaternions(P,L),P.multiplyQuaternions(P,E),n.object.quaternion.copy(P))),n.update(),n.dispatchEvent(u),n.dispatchEvent(m))}}function Z(e){e.preventDefault(),void 0!==e.button&&0!==e.button||(o&&null!==n.axis&&(p.mode=i,n.dispatchEvent(p)),o=!1,"TouchEvent"in window&&e instanceof TouchEvent?(n.axis=null,n.update(),n.dispatchEvent(u)):Y(e))}function q(r,n){var i=t.getBoundingClientRect(),o=(r.clientX-i.left)/i.width,a=(r.clientY-i.top)/i.height;g.set(2*o-1,-2*a+1),v.setFromCamera(g,e);var s=v.intersectObjects(n,!0);return!!s[0]&&s[0]}t.addEventListener("mousedown",K,!1),t.addEventListener("touchstart",K,!1),t.addEventListener("mousemove",Y,!1),t.addEventListener("touchmove",Y,!1),t.addEventListener("mousemove",X,!1),t.addEventListener("touchmove",X,!1),t.addEventListener("mouseup",Z,!1),t.addEventListener("mouseout",Z,!1),t.addEventListener("touchend",Z,!1),t.addEventListener("touchcancel",Z,!1),t.addEventListener("touchleave",Z,!1),this.dispose=function(){t.removeEventListener("mousedown",K),t.removeEventListener("touchstart",K),t.removeEventListener("mousemove",Y),t.removeEventListener("touchmove",Y),t.removeEventListener("mousemove",X),t.removeEventListener("touchmove",X),t.removeEventListener("mouseup",Z),t.removeEventListener("mouseout",Z),t.removeEventListener("touchend",Z),t.removeEventListener("touchcancel",Z),t.removeEventListener("touchleave",Z)},this.attach=function(e){this.object=e,this.visible=!0,this.update()},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.getMode=function(){return i},this.setMode=function(e){for(var t in"scale"===(i=e||i)&&(n.space="local"),a)a[t].visible=t===i;this.update(),n.dispatchEvent(u)},this.setTranslationSnap=function(e){n.translationSnap=e},this.setRotationSnap=function(e){n.rotationSnap=e},this.setSize=function(e){n.size=e,this.update(),n.dispatchEvent(u)},this.setSpace=function(e){n.space=e,this.update(),n.dispatchEvent(u)},this.update=function(){void 0!==n.object&&(n.object.updateMatrixWorld(),F.setFromMatrixPosition(n.object.matrixWorld),H.setFromRotationMatrix(M.extractRotation(n.object.matrixWorld)),e.updateMatrixWorld(),W.setFromMatrixPosition(e.matrixWorld),G.setFromRotationMatrix(M.extractRotation(e.matrixWorld)),x=F.distanceTo(W)/6*n.size,this.position.copy(F),this.scale.set(x,x,x),e instanceof r.PerspectiveCamera?A.copy(W).sub(F).normalize():e instanceof r.OrthographicCamera&&A.copy(W).normalize(),"local"===n.space?a[i].update(H,A):"world"===n.space&&a[i].update(new r.Euler,A),a[i].highlight(n.axis))}};(d.prototype=Object.create(r.Object3D.prototype)).constructor=d,t.default=d,e.exports=t.default},i=[e,t,r(0),r(7)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r.EarthBasic.HyperClasses.PMatrix;t.default=n,e.exports=t.default},i=[e,t,r(4)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=(i=n)&&i.__esModule?i:{default:i};var a=function(e){function t(e,n,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s,l,u,c=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),h=e/2,f=n/2,d=i/2,p=(l=[0,0,0,0,0,0,0,0].concat(s=[255,255,255,255]).concat(s),(u=new r.DataTexture(Uint8Array.from(l),2,2,r.RGBAFormat,r.UnsignedByteType,r.UVMapping)).needsUpdate=!0,u.minFilter=u.magFilter=r.LinearFilter,u),m=new r.MeshBasicMaterial({color:a,transparent:!0,alphaMap:p,side:r.DoubleSide,depthWrite:!1});var v=S([0,-f,-d,0,-f,d,0,f,-d,0,f,d],[1,1,1,0,0,1,0,0],[0,1,2,1,2,3],.6),g=new r.Mesh(v,m);g.position.x-=h,g.renderOrder=o.default.GLFENCE_SIDE_PLANE_RENDER_ORDER;var y=S([0,-f,-d,0,-f,d,0,f,-d,0,f,d],[1,1,1,0,0,1,0,0],[0,1,2,1,2,3],.6),_=new r.Mesh(y,m);_.position.x+=h,_.renderOrder=o.default.GLFENCE_SIDE_PLANE_RENDER_ORDER;var w=S([-h,0,-d,-h,0,d,h,0,-d,h,0,d],[1,1,1,0,0,1,0,0],[0,1,2,1,2,3],.6),b=new r.Mesh(w,m);b.position.y-=f,b.renderOrder=o.default.GLFENCE_SIDE_PLANE_RENDER_ORDER;var x=S([-h,0,-d,-h,0,d,h,0,-d,h,0,d],[1,1,1,0,0,1,0,0],[0,1,2,1,2,3],.6),k=new r.Mesh(x,m);k.position.y+=f,k.renderOrder=o.default.GLFENCE_SIDE_PLANE_RENDER_ORDER;var A=S([-h,-f,0,-h,f,0,h,-f,0,h,f,0],[0,0,0,0,0,0,0,0],[0,1,2,1,2,3],.6),M=new r.Mesh(A,m);function S(e,t,n,i){for(var o=0;o<t.length;++o)o%2==1&&(t[o]=t[o]*i);var a=new r.BufferGeometry;return a.addAttribute("position",new r.Float32BufferAttribute(new Float32Array(e),3)),a.addAttribute("uv",new r.Float32BufferAttribute(new Float32Array(t),2)),a.index=new r.Uint16BufferAttribute(new Uint16Array(n),1),a}M.position.z-=d,M.renderOrder=o.default.GLFENCE_BASE_PLANE_RENDER_ORDER,c.add(g),c.add(_),c.add(b),c.add(k),c.add(M);for(var P=new r.BufferGeometry,T=[-h,-f,-d,-h,-f,d,-h,f,-d,-h,f,d,h,-f,-d,h,-f,d,h,f,-d,h,f,d],O=[m.color.r,m.color.g,m.color.b,.66],C=[m.color.r,m.color.g,m.color.b,0],E=[],I=0;I<4;++I)E=E.concat(O).concat(C);P.addAttribute("position",new r.BufferAttribute(new Float32Array(T),3)),P.addAttribute("vertexcolor",new r.BufferAttribute(new Float32Array(E),4));var R=new r.ShaderMaterial({uniforms:{},vertexShader:"attribute vec4 vertexcolor;varying vec4 vColor;void main(){gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);vColor=vertexcolor;}",fragmentShader:"varying vec4 vColor;void main(){gl_FragColor=vColor;}",blending:r.AdditiveBlending,depthTest:!0,transparent:!0}),L=new r.LineSegments(P,R);return L.renderOrder=o.default.GLFENCE_LINE_RENDER_ORDER,c.add(L),c}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.Object3D),t}();t.default=a,e.exports=t.default},i=[e,t,r(0),r(7)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=u(n),s=u(i),l=u(o);function u(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),h=function(){function e(t){var r=t.url,n=r.cameraFile,i=r.photoBase,o=t.length_unit_to_meter,a=t.photoHolder,s=t.objToScene,l=t.objToEarth,u=t.createInstance,c=void 0!==u&&u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e){if(!n||!i)return!1;i.endsWith("/")||(console.warn("photoBase isnt ending with slash",i),i+="/");return!!o&&!!a&&!!s}()?(this._3d=a,this._lines=null,this.length_unit_to_meter=o,this._cameras={},this._url={cameraFile:n,photoBase:i},this._objToScene=function(){return s()},this._objToEarth=function(){return l()},this._indToName={},this._createInstance=c):console.error("PhotoManager",arguments)}return c(e,[{key:"destruct",value:function(){var e=!0;for(var t in this._lines&&(this._3d.remove(this._lines),this._lines.material.dispose(),this._lines.geometry.dispose(),this._lines=null),this._cameras)e=this._cameras[t].destruct()&&e;return this._kdtree&&this._kdtree.dispose(),e||console.warn("PhotoManager destruct error."),e}},{key:"init",value:function(){var e=this;return this._downloadCameraFile().then(function(t){if(e._lines&&e._3d.remove(e._lines),e._createInstance&&(e._lines=function(t){var n=new r.BufferGeometry,i=new r.LineBasicMaterial({vertexColors:r.VertexColors}),o=void 0,a=void 0,s=void 0;if(t instanceof Array){s=parseFloat(t[0][0])/e.length_unit_to_meter,o=new Float32Array(3*(t.length-1)*22),a=new Float32Array(3*(t.length-1)*22);for(var l=1;l<t.length;l++){for(var u=t[l],c=0;c<3;c++)u[c]=u[c]/e.length_unit_to_meter;g(s,u,o,a,l-1)}}else{s=parseFloat(t.camera_scale)/e.length_unit_to_meter;var h=t.camera_info,f=3*h.length*22;o=new Float32Array(f),a=new Float32Array(f);for(var d=0;d<h.length;d++){for(var p=h[d].display,m=0;m<3;m++)p[m]=p[m]/e.length_unit_to_meter;g(s,p,o,a,d)}}n.addAttribute("position",new r.BufferAttribute(o,3)),n.addAttribute("color",new r.BufferAttribute(a,3));var v=new r.LineSegments(n,i);return v.name="cameras",v;function g(e,t,n,i,o){var a=void 0,s=new r.Vector3(t[0],t[1],t[2]),l=new r.Vector3(t[3],t[4],t[5]),u=new r.Vector3(t[6],t[7],t[8]);u.normalize().multiplyScalar(e),l.normalize().multiplyScalar(u.length()*t[9]);var c=l.clone().cross(u).normalize().multiplyScalar(l.length()*t[10]),h=new Array(4),f=s.clone().add(u);h[0]=f.clone().sub(l).sub(c),h[1]=f.clone().add(l).sub(c),h[2]=f.clone().add(l).add(c),h[3]=f.clone().sub(l).add(c);var d=[h[0],h[1],h[1],h[2],h[2],h[3],h[3],h[0],s,h[0],s,h[1],s,h[2],s,h[3],f,f.clone().sub(c),f,f.clone().sub(l),f,f.clone().sub(u)],p=[];for(a=0;a<22;a++)a<16?p.push({r:.48,g:.45,b:.89}):a<18?p.push({r:1,g:0,b:0}):a<20?p.push({r:0,g:1,b:0}):a<22&&p.push({r:0,g:0,b:1});for(a=0;a<d.length;a++)n[3*(22*o+a)]=d[a].x,n[3*(22*o+a)+1]=d[a].y,n[3*(22*o+a)+2]=d[a].z,i[3*(22*o+a)]=p[a].r,i[3*(22*o+a)+1]=p[a].g,i[3*(22*o+a)+2]=p[a].b}}(t),e._3d.add(e._lines)),!(t instanceof Array)){var n=parseFloat(t.camera_scale)/e.length_unit_to_meter;(function(e){for(var t=e.camera_info,r=[],n=0;n<t.length;n++){var i=t[n];i.raw=i.raw,i.name=i.name,i.image_size=i.image_size,i.display=i.display,i.id=i.id,i.visCam=i.vis_cam,r[n]={name:i.name,width:Number(i.image_size[0]),height:Number(i.image_size[1]),id:i.id,raw:i.raw,display:i.display,visCam:i.visCam}}return r})(t).forEach(function(t){var r=t.name;if(e._cameras[r])console.warn(r+" exists",e._cameras[r]);else{t.edgeLength=n;for(var i=0;i<3;i++)t.display[i]=t.display[i]/e.length_unit_to_meter;e._cameras[r]=new s.default(t),e._indToName[t.id]=r}})}return Promise.resolve()}).catch(function(e){return console.error(e),Promise.resolve()})}},{key:"cameraByName",value:function(e){return this._cameras[e]}},{key:"cameraById",value:function(e){return this.cameraByName(this._indToName[e])}},{key:"_downloadCameraFile",value:function(){return(0,a.default)({method:"get",url:this._url.cameraFile}).then(function(e){return Promise.resolve(e.data)}).catch(function(e){return console.error("_downloadCameraFile",e),Promise.reject(e)})}},{key:"_downloadPhotoThumb",value:function(e){}},{key:"_downloadPhoto",value:function(e){}},{key:"_getClosestCamFromList",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{dist:100,orient:25},o=(arguments[4],void 0);try{o=(new r.Matrix4).getInverse(this._objToScene(),!0)}catch(e){return void console.error(e)}var a=o.multiply(e.matrixWorld.clone()),s=new r.Vector3,l=new r.Quaternion,u=new r.Vector3;a.decompose(s,l,u);var c=new r.Vector3(0,0,-1).applyQuaternion(l).normalize(),h=s,f=99999,d=null;for(var p in n){var m=n[p],v=m.positionInObj.distanceTo(t)/h.distanceTo(t);if(!((v=Math.max(v,1/v))>i.dist)){var g=t.clone().sub(m.positionInObj),y=g.angleTo(c)/Math.PI*180;if(!(y>i.orient)){var _=g.normalize().angleTo(m.lookDirInObj.normalize())/Math.PI*180;if(!(_>.4*m.fov||_>i.orient||_>e.fov/2)){var w=y+2*_;w<f&&(d=p,f=w)}}}}if(null!==d)return n[d]}},{key:"_kClosestCamFromList",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{dist:100,orient:100},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,a=void 0;try{a=(new r.Matrix4).getInverse(this._objToScene(),!0)}catch(e){return void console.error(e)}var s=a.multiply(e.matrixWorld.clone()),u=new r.Vector3,c=new r.Quaternion,h=new r.Vector3;s.decompose(u,c,h);var f=new r.Vector3(0,0,-1).applyQuaternion(c).normalize(),d=u,p=[];for(var m in n){var v=n[m],g=v.positionInObj.distanceTo(t)/d.distanceTo(t);if(!((g=Math.max(g,1/g))>i.dist)){var y=t.clone().sub(v.positionInObj),_=y.angleTo(f)/Math.PI*180;if(!(_>i.orient)){var w=y.normalize().angleTo(v.lookDirInObj.normalize())/Math.PI*180;if(!(w>.4*v.fov||w>i.orient||w>e.fov/2)){var b=_+2*w;p.push({data:m,value:b})}}}}(0,l.default)(p,o);var x=p.slice(0,o).reduce(function(e,t){return t&&t.value<1/0&&e.push(n[t.data]),e},[]);return console.log(x),x}},{key:"cameraNear",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.3;return this._getClosestCamFromList(e,t,this._cameras,r,n)}},{key:"kCameraNear",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return this._kClosestCamFromList(e,t,this._cameras,r,n)}},{key:"cameraNearPhoto",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.3,o=this,a=r.visCam.map(function(e){return o.cameraById(e)});return this._getClosestCamFromList(e,t,a,n,i)}},{key:"photoUrl",value:function(e){return""+this._url.photoBase+e}}]),e}();t.default=h,e.exports=t.default},i=[e,t,r(0),r(9),r(61),r(64)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=s(n),a=s(i);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=function(){function e(t){var n=t.id,i=t.name,s=t.width,l=t.height,u=t.raw,c=t.display,h=t.edgeLength,f=t.visCam;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=n,this.name=i,this.width=s,this.height=l,this.raw=u,this.display=c,this.edgeLength=h,this.visCam=f,this._pose=new o.default,this._objToCam=null,this._camToObj=null,this._cvmat=new a.default(u),this.objToCam=this._cvmat.getModelViewMatrix().clone(),this._instance=null,this._photoDisplay=null,this._displayStatus="none";var d=new r.Vector3,p=new r.Quaternion,m=new r.Vector3;this.camToObj.decompose(d,p,m),this._positionInObj=d,this._lookDirInObj=new r.Vector3(0,0,-1).applyQuaternion(p).normalize()}return l(e,[{key:"destruct",value:function(){return!0}},{key:"disposeDisplay",value:function(){"disposing"!==this._displayStatus&&"none"!==this._displayStatus&&(this._displayStatus="disposing",this._disposing(1))}},{key:"_disposing",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("disposing"===this._displayStatus){var r=this;return e<.1?(this._photoDisplay.visible=!1,t&&this._destructDisplay(),!0):(this._photoDisplay.material.opacity=e,e-=.2,setTimeout(function(){r._disposing(e)},100),!0)}}},{key:"_destructDisplay",value:function(){return this._displayStatus="none",this._photoDisplay.material.map&&this._photoDisplay.material.map.dispose(),this._photoDisplay.material.dispose(),this._photoDisplay.geometry.dispose(),this._photoDisplay=null,!0}},{key:"addCamera",value:function(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=void 0,s=new r.Vector3(t[0],t[1],t[2]),l=new r.Vector3(t[3],t[4],t[5]),u=new r.Vector3(t[6],t[7],t[8]);u.normalize().multiplyScalar(e);var c=Math.tan(this._cvmat.heightAngle()/2);l.normalize().multiplyScalar(u.length()*c);var h=l.clone().cross(u).normalize().multiplyScalar(l.length()*t[10]),f=new Array(4),d=s.clone().add(u);f[0]=d.clone().sub(l).sub(h),f[1]=d.clone().add(l).sub(h),f[2]=d.clone().add(l).add(h),f[3]=d.clone().sub(l).add(h);var p=[f[0],f[1],f[1],f[2],f[2],f[3],f[3],f[0],s,f[0],s,f[1],s,f[2],s,f[3],d,d.clone().sub(h),d,d.clone().sub(l),d,d.clone().sub(u)],m=[];for(a=0;a<22;a++)a<16?m.push({r:.48,g:.45,b:.89}):a<18?m.push({r:1,g:0,b:0}):a<20?m.push({r:0,g:1,b:0}):a<22&&m.push({r:0,g:0,b:1});for(a=0;a<p.length;a++)n[3*(22*o+a)]=p[a].x,n[3*(22*o+a)+1]=p[a].y,n[3*(22*o+a)+2]=p[a].z,i[3*(22*o+a)]=m[a].r,i[3*(22*o+a)+1]=m[a].g,i[3*(22*o+a)+2]=m[a].b}},{key:"objToCam",get:function(){return this._objToCam?this._objToCam.clone():this._objToCam},set:function(e){this._objToCam?this._objToCam.copy(e):this._objToCam=e.clone();try{var t=(new r.Matrix4).getInverse(e,!0);this._camToObj?this._camToObj.copy(t):this._camToObj=t}catch(e){console.error(e)}}},{key:"camToObj",get:function(){return this._camToObj.clone()}},{key:"positionInObj",get:function(){return this._positionInObj.clone()}},{key:"lookDirInObj",get:function(){return this._lookDirInObj.clone()}},{key:"fov",get:function(){return this._cvmat.heightAngle()/Math.PI*180}},{key:"pose",set:function(e){this._pose.value=e},get:function(){return this._pose.value}},{key:"photoDisplay",get:function(){var e=this;if(!this._photoDisplay){var t=this.edgeLength,n=this.display.slice();this._photoDisplay=function(t,n){var i=new r.Vector3(n[0],n[1],n[2]),o=new r.Vector3(n[3],n[4],n[5]),a=new r.Vector3(n[6],n[7],n[8]);a.normalize().multiplyScalar(t);var s=Math.tan(e._cvmat.heightAngle()/2);o.normalize().multiplyScalar(a.length()*s);var l=o.clone().cross(a).normalize().multiplyScalar(o.length()*n[10]),u=new Array(4),c=i.clone().add(a);u[0]=c.clone().sub(o).sub(l),u[1]=c.clone().add(o).sub(l),u[2]=c.clone().add(o).add(l),u[3]=c.clone().sub(o).add(l);var h=2*l.length(),f=2*o.length(),d=new r.PlaneGeometry(h,f,32),p=new r.MeshBasicMaterial({color:16777215,side:r.FrontSide,opacity:1,transparent:!0}),m=new r.Mesh(d,p),v=(new r.Matrix4).makeBasis(l.clone().negate().normalize(),o.clone().normalize(),a.clone().negate().normalize()).setPosition(c);return m.applyMatrix(v),m}(t,n)}return this._displayStatus="ready",this._photoDisplay}},{key:"instance",get:function(){if(!this._instance){var e=new r.BufferGeometry,t=new r.LineBasicMaterial({vertexColors:r.VertexColors}),n=new Float32Array(66),i=new Float32Array(66),o=this.display.slice(),a=this.edgeLength;this.addCamera(a,o,n,i),e.addAttribute("position",new r.BufferAttribute(n,3)),e.addAttribute("color",new r.BufferAttribute(i,3));var s=new r.LineSegments(e,t);s.name="cameras",this._instance=s}return this._instance}}]),e}();t.default=u,e.exports=t.default},i=[e,t,r(0),r(62),r(63)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=r)&&n.__esModule?n:{default:n};var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.lng,n=void 0===r?0:r,i=t.lat,o=void 0===i?0:i,a=t.alt,s=void 0===a?0:a,l=t.north,u=void 0===l?0:l,c=t.tilt,h=void 0===c?0:c,f=t.up,d=void 0===f?0:f;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lng=n,this.lat=o,this.alt=s,this.north=u,this.tilt=h,this.up=d}return o(e,[{key:"clone",value:function(){return new e(this.value)}},{key:"equals",value:function(e){return e.lat===this.lat&&e.lng===this.lng&&e.alt===this.alt&&e.north===this.north&&e.tilt===this.tilt&&e.up===this.up}},{key:"lng",set:function(e){this._lng=Math.max(Math.min(180,e),-180)},get:function(){return this._lng}},{key:"lat",set:function(e){this._lat=Math.max(Math.min(90,e),-90)},get:function(){return this._lat}},{key:"alt",set:function(e){this._alt=Math.max(-1*i.default.EARTH_RADIUS,e)},get:function(){return this._alt}},{key:"north",set:function(e){this._north=e},get:function(){return this._north}},{key:"tilt",set:function(e){this._tilt=e},get:function(){return this._tilt}},{key:"up",set:function(e){this._up=e},get:function(){return this._up}},{key:"value",set:function(e){var t=e.lng,r=e.lat,n=e.alt,i=e.north,o=e.tilt,a=e.up;void 0!==t&&(this._pose.lng=t),void 0!==r&&(this._pose.lat=r),void 0!==n&&(this._pose.alt=n),void 0!==i&&(this._pose.north=i),void 0!==o&&(this._pose.tilt=o),void 0!==a&&(this._pose.up=a)},get:function(){return{lng:this.lng,lat:this.lat,alt:this.alt,north:this.north,tilt:this.tilt,up:this.up}}}]),e}();t.default=a,e.exports=t.default},i=[e,t,r(1)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e){this.raw_=new Array(3),this.u0_=0,this.v0_=0,this.alpha_u_=0,this.alpha_v_=0,this.s_=0,this.center_=null,this.ext_={rotation:null,translation:null},this.M_=null,this.invM_=null,this.p4_=null,this.principle_axis_=null,this.K_=null,this.invK_=null;var t=this,n=!1;function i(){var e=t.raw_,n=new r.Vector3(e[0][0],e[0][1],e[0][2]),i=new r.Vector3(e[1][0],e[1][1],e[1][2]),o=new r.Vector3(e[2][0],e[2][1],e[2][2]),a=new r.Matrix3,s=new r.Vector3,l=1/o.length(),u=l*l;t.u0_=u*n.dot(o),t.v0_=u*i.dot(o),t.alpha_u_=Math.sqrt(u*n.lengthSq()-t.u0_*t.u0_),t.alpha_v_=Math.sqrt(u*i.lengthSq()-t.v0_*t.v0_),a.fromArray(n.clone().sub(o.clone().multiplyScalar(t.u0_)).multiplyScalar(l/t.alpha_u_).toArray().concat(i.clone().sub(o.clone().multiplyScalar(t.v0_)).multiplyScalar(l/t.alpha_v_).toArray()).concat(o.clone().normalize().toArray())).transpose(),s.z=l*e[2][3],s.x=l*(e[0][3]-t.u0_*e[2][3])/t.alpha_u_,s.y=l*(e[1][3]-t.v0_*e[2][3])/t.alpha_v_,t.ext_.rotation=a,t.ext_.translation=s,t.center_=s.clone().negate().applyMatrix3(a.clone().transpose()),t.M_=(new r.Matrix3).set(e[0][0],e[0][1],e[0][2],e[1][0],e[1][1],e[1][2],e[2][0],e[2][1],e[2][2]),t.p4_=new r.Vector3(e[0][3],e[1][3],e[2][3]),t.invM_=(new r.Matrix3).getInverse(t.M_);var c=new r.Vector3(e[2][0],e[2][1],e[2][2]);t.M_.determinant()<0&&c.negate(),t.principle_axis_=c.multiplyScalar(1/c.length())}!function(){if(e&&e.length>=12){for(var o=0;o<3;++o){t.raw_[o]=new Array(4);for(var a=0;a<4;++a)t.raw_[o][a]=e[4*o+a]}(function(){if(i(),t.ext_.rotation.determinant()<0){var e=new Array(3),r=t.alpha_u_,n=t.alpha_v_;e=[[r,0,r],[0,r,n],[0,0,1]];for(var o=new Array(3),a=0;a<3;++a){o[a]=new Array(4);for(var s=0;s<3;++s)o[a][s]=t.ext_.rotation[a][s];o[a][3]=-t.ext_.translation[a]}for(var l=0;l<3;++l)for(var u=0;u<4;++u)t.raw_[l][u]=e[l][0]*o[0][u]+e[l][1]*o[1][u]+e[l][2]*o[2][u];i()}})(),t.K_=(new r.Matrix3).set(t.alpha_u_,0,t.u0_,0,t.alpha_v_,t.v0_,0,0,1),t.M_=t.K_.clone().multiply(t.ext_.rotation),t.p4_=t.ext_.translation.clone().applyMatrix3(t.M_),t.invM_=(new r.Matrix3).getInverse(t.M_),t.invK_=(new r.Matrix3).getInverse(t.K_),t.principle_axis_=new r.Vector3(t.ext_.rotation.elements[2],t.ext_.rotation.elements[5],t.ext_.rotation.elements[8]),t.M_.determinant()<0&&t.principle_axis_.negate(),n&&(console.log("-----------------------"),console.log("In"),console.log("Focal",t.alpha_u_),console.log("Projective Center x:",t.u0_,"y:",t.v0_,"s:",t.s_),console.log("Ext"),console.log("center:",t.center_),console.log("Rotation",t.ext_.rotation),console.log("Translation",t.ext_.translation))}else console.log("input error!")}(),this.getModelViewMatrix=function(){var e,n,i=t.center_;n=(new r.Matrix3).set(1,0,0,0,-1,0,0,0,-1);var o,a,s=function(e){var t,r={X:0,Y:0,Z:0,W:0},n=e.clone().elements,i=(t=e).elements[0]+t.elements[4]+t.elements[8]+1;if(i>1e-6){var o=.5/Math.sqrt(i);r.W=.25/o,r.X=(n[7]-n[5])*o,r.Y=(n[2]-n[6])*o,r.Z=(n[3]-n[1])*o}else if(n[0]>n[4]&&n[0]>n[8]){var a=2*Math.sqrt(1+n[0]-n[4]-n[8]);r.X=.25*a,r.Y=(n[1]+n[3])/a,r.Z=(n[2]+n[6])/a,r.W=(n[5]+n[7])/a}else if(n[4]>n[8]){var s=2*Math.sqrt(1+n[4]-n[0]-n[8]);r.X=(n[1]+n[3])/s,r.Y=.25*s,r.Z=(n[5]+n[7])/s,r.W=(n[2]+n[6])/s}else{var l=2+Math.sqrt(1+n[8]-n[0]-n[4]);r.X=(n[2]+n[6])/l,r.Y=(n[5]+n[7])/l,r.Z=.25*l,r.W=(n[1]-n[3])/l}return r}(e=n.multiply(t.ext_.rotation));return o=s,a=Math.sqrt(o.X*o.X+o.Y*o.Y+o.Z*o.Z+o.W*o.W),o.X/=a,o.Y/=a,o.X/=a,o.W/=a,e=function(e,t){var r=e.clone().elements,n=t.W*t.W,i=t.X*t.X,o=t.Y*t.Y,a=t.Z*t.Z,s=1/(i+o+a+n);r[0]=(i-o-a+n)*s,r[4]=(-i+o-a+n)*s,r[8]=(-i-o+a+n)*s;var l=t.X*t.Y,u=t.Z*t.W;r[3]=2*(l+u)*s,r[1]=2*(l-u)*s,l=t.X*t.Z,u=t.Y*t.W,r[6]=2*(l-u)*s,r[2]=2*(l+u)*s,l=t.Y*t.Z,u=t.X*t.W,r[7]=2*(l+u)*s,r[5]=2*(l-u)*s;for(var c=new Array(3),h=0;h<3;++h){c[h]=new Array(3);for(var f=0;f<3;++f)c[h][f]=r[3*h+f]}return c}(e,s),function(){for(var t=[],n=0;n<3;++n){for(var o=0;o<3;++o)t.push(e[n][o]);t.push(0)}t.push(0),t.push(0),t.push(0),t.push(1);var a=(new r.Matrix4).fromArray(t),s=(new r.Matrix4).fromArray([1,0,0,0,0,1,0,0,0,0,1,0,-i.x,-i.y,-i.z,1]);return a.multiply(s)}()},this.getProjectionMatrix=function(e,n,i,o){var a=i/t.alpha_u_*e,s=o/t.alpha_v_*e,l=a-t.u0_/t.alpha_u_*e,u=l-a,c=t.v0_/t.alpha_v_*e,h=c-s,f=2*e/(l-u),d=(l+u)/(l-u),p=2*e/(c-h),m=(c+h)/(c-h),v=-(n+e)/(n-e),g=n*e*-2/(n-e),y=new r.Matrix4,_=new Array(12);return _[0]=f,_[1]=0,_[2]=d,_[3]=0,_[4]=0,_[5]=p,_[6]=m,_[7]=0,_[8]=0,_[9]=0,_[10]=v,_[11]=g,_[12]=0,_[13]=0,_[14]=-1,_[15]=0,y.set(_[0],_[1],_[2],_[3],_[4],_[5],_[6],_[7],_[8],_[9],_[10],_[11],_[12],_[13],_[14],_[15]),y},this.getProjectionFov=function(e,t,n,i){var o=new r.Matrix4,a=n*Math.tan(.5*e),s=i-n,l=-(i+n)/s,u=i*n*-2/s,c=2*n/(a- -a);c/=t;var h=2*n/(a- -a),f=new Array(16);return f[0]=c,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=h,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=l,f[11]=u,f[12]=0,f[13]=0,f[14]=-1,f[15]=0,o.set(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],f[14],f[15]),o},this.getU=function(){return this.u0_},this.getV=function(){return this.v0_},this.heightAngle=function(){return 2*Math.atan(t.v0_/t.alpha_v_)},this.pointApply=function(e){return(new r.Vector3).set(e[0],e[1],e[2]).applyMatrix3(t.ext_.rotation).add(t.ext_.translation).toArray()}},e.exports=t.default},i=[e,t,r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o;i=[e,t],void 0===(o="function"==typeof(n=function(e,t){"use strict";function r(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function n(e,t,n){for(var i=e[Math.floor((n+t)/2)];t<=n;){for(;e[t].value<i.value;)t++;for(;e[n].value>i.value;)n--;t<=n&&(r(e,t,n),t++,n--)}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t.length,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:t.length-1;if(i<o){var a=n(t,i,o);e(t,r,i,a-1),a<r-1&&e(t,r,a,o)}},e.exports=t.default})?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.loadMaskAPI=void 0;var r,n=(r=t)&&r.__esModule?r:{default:r};e.loadMaskAPI=function(e){var t=e.api,r=e.pid,i=(e.type,e.debug),o=void 0!==i&&i;return t?t.cropMask({pid:r,timeout:3e4}).then(function(e){var t=0;o&&(t=Date.now());var r=n.default.unpackToImage(e.maskInfos[0]),i=e.maskInfos[0].height;return o&&console.log("decode time",Date.now()-t),e=void 0,Promise.resolve({image:r,maskSize:i})}):Promise.reject(new Error("No api"))}},i=[t,r(66)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o;i=[e,t],void 0===(o="function"==typeof(n=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={decodeNumMat:function(e){for(var t=e.width,r=e.height,n=e.data,i=this.decodeNumArray(n),o=0,a=[],s=0;s<t;s++){a[s]=[];for(var l=0;l<r;l++)a[s][l]=i[o],o++}return a},encodeNumMat:function(e){for(var t=e.length,r=e[0].length,n=[],i=0;i<t;i++)for(var o=0;o<r;o++)n.push(e[i][o]);return{width:t,height:r,data:this.encodeNumArray(n)}},_firstChar:48,decodeNumArray:function(e){var t,r=[],n=[];for(t=0;t<e.length;t+=3){var i=e.charAt(t).charCodeAt()-this._firstChar,o=e.charAt(t+1).charCodeAt()-this._firstChar,a=e.charAt(t+2).charCodeAt()-this._firstChar;n.push(63&i>>2),n.push((3&i)<<4|15&o>>4),n.push((15&o)<<2|3&a>>6),n.push(63&a)}for(t=0;t<n.length;t++)63!==n[t]&&r.push(n[t]);return r},encodeNumArray:function(e){for(var t=[],r=0;r<e.length;r+=4){var n=e[r],i=r+1<e.length?e[r+1]:63,o=r+2<e.length?e[r+2]:63,a=r+3<e.length?e[r+3]:63;this.encodeSet(n,i,o,a,t)}return this.stringFromArray(t)},stringFromArray:function(e){for(var t="",r=0;r<e.length;r++)t+=e[r];return t},encodeSet:function(e,t,r,n,i){var o=String.fromCharCode;i.push(o(((63&e)<<2|3&t>>4)+this._firstChar)),i.push(o(((15&t)<<4|15&r>>2)+this._firstChar)),i.push(o(((3&r)<<6|63&n)+this._firstChar))},pack_boolean:function(e){for(var t={width:e.length,height:e[0].length,data:[]},r=0,n=!1,i=0;i<e.length;i++)for(var o=0;o<e[i].length;o++)e[i][o]===n?(r++,0):e[i][o]===!n?(t.data.push(r),r,n=!n,r=1,0):(console.warn("Error: unknown entry ["+i+","+o+"]="+e[i][o]),0),0;return t.data.push(r),r,t},unpack_boolean:function(e){function t(e,t,n,i){for(var a=n,s=e,l=t;a--;)o[s][l]=i,++l===r&&(s++,l=0);return{row:s,col:l}}for(var r=e.width,n=e.height,i=e.data,o=[],a=n;a--;)o[a]=[];var s=!1;a=0;for(var l=0,u=0;u<i.length;u+=16)for(var c=0;c<16;++c){var h=t(a,l,i[c+u],s);a=h.row,l=h.col,s=!s}return o},unpackToImage:function(e){function t(e,t,n,i){for(var a=n,s=e,l=t,u=4*(s*r+l);a--;)o[u]=o[u+1]=o[u+2]=o[u+3]=i,u+=4,++l===r&&(s++,l=0);return{row:s,col:l}}for(var r=e.width,n=e.height,i=e.data,o=new Uint8ClampedArray(r*n*4),a=0,s=!1,l=0,u=0,c=0;c<i.length;c+=16)for(var h=0;h<16;++h){var f=t(l,u,i[h+c],s?255:0);l=f.row,u=f.col,a+=!0===s?1:0,s=!s}return{rgba:o,cntWhite:a}},downsampleImage:function(e,t,r,n){for(var i=Math.floor,o=i(t*n),a=i(r*n),s=new Uint8ClampedArray(o*a*4),l=0,u=0,c=0,h=0;h<a;++h)for(var f=0;f<o;++f)c=4*(h/n*t+f/n),s[u=4*(h*o+f)]=e[c],s[u+1]=e[c+1],s[u+2]=e[c+2],s[u+3]=e[c+3],l+=0===s[u]?0:1;return{rgba:s,cntWhite:l}}},e.exports=t.default})?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(t){var r=t.maskSize,n=void 0===r?4:r,i=t.pid,o=void 0===i?void 0:i;t.apiService;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o&&(n=4),this._maskSize=n,this.canvas=document.createElement("canvas"),this.canvas.width=this.maskSize,this.canvas.height=this.maskSize,this.canvas.id="ProjectBooleanMask";var a=this.canvas.getContext("2d");a.fillStyle="#fff",a.fillRect(0,0,n,n)}return n(e,[{key:"destruct",value:function(){this.canvas=void 0}},{key:"paintPolygon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000",r=this.canvas.getContext("2d"),n=e.length;if(!(n<3)){r.fillStyle=t,r.strokeStyle="#0f0",r.beginPath();var i=this.maskSize,o=e.map(function(e){var t=e.u,r=e.v;return{x:Math.floor(t*i),y:i-Math.floor(r*i)}}),a=o[--n];for(r.moveTo(a.x,a.y);n--;)r.lineTo(o[n].x,o[n].y);return r.closePath(),r.fill(),!0}}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#0f0";return this.paintPolygon([{u:0,v:0},{u:0,v:1},{u:1,v:1},{u:1,v:0},{u:0,v:0}],e)}},{key:"maskSize",get:function(){return this._maskSize},set:function(e){e!==this.maskSize&&(this.canvas.width=e,this.canvas.height=e,this._maskSize=e)}},{key:"imageData",get:function(){return this.canvas.getContext("2d").getImageData(0,0,this.canvas.width,this.canvas.height).data},set:function(e){var t=e.uint8,r=e.maskSize;this.maskSize=r;var n=new ImageData(t,r,r);this.canvas.getContext("2d").putImageData(n,0,0)}},{key:"texture",get:function(){var e=new Uint8Array(this.imageData,1);return new r.DataTexture(e,this.maskSize,this.maskSize,r.RGBAFormat,r.UnsignedByteType)}}]),e}();t.default=i,e.exports=t.default},i=[e,t,r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){e.exports=function(){return r(11)('!function(e){var r={};function i(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=r,i.d=function(e,r,n){i.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},i.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(r,"a",r),r},i.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},i.p="",i(i.s=0)}([function(e,r,i){var n,o,t;o=[],void 0===(t="function"==typeof(n=function(){"use strict";function e(e,r,i,n,o,t){for(var a=Math.floor((n.width-1)/2),f=Math.floor((n.height-1)/2),h=0,s=a*f*4,u=[],d=function(n){for(var a=function(a){var f=0;r.map(function(r){var o={x:r.position.x+i.x+n,y:r.position.y+i.y+a};f+=function(e,r,i){for(var n=0,o=0;o<r.dimension.width;++o)for(var t=0;t<r.dimension.height;++t){var a=t*r.dimension.width+o,f=r.buffer[a];if(f>0){var h=i.x+o,s=i.y+t;if(h>=0&&h<e.dimension.width&&s>=0&&s<e.dimension.height){var u=s*e.dimension.width+h;n+=e.buffer[u]*f}}}return n}(e,r.newMask,o)}),u.push({score:f,offset:{x:i.x+n,y:i.y+a}}),postMessage((h+=1)/s*(t-o)+o)},d=-f;d<=f;++d)a(d)},g=-a;g<=a;++g)d(g);return u.sort(function(e,r){return r.score-e.score}),u[0]}function r(e,r,i){for(var n=0,o=i.low;o<i.high;++o)for(var t=r.low;t<r.high;++t){var a=o*e.dimension.width+t;n+=e.buffer[a]}return n}function i(e,r,i){for(var n={dimension:{width:r.high-r.low,height:i.high-i.low},buffer:[]},o=i.low;o<i.high;++o)for(var t=r.low;t<r.high;++t){var a=o*e.dimension.width+t;n.buffer.push(e.buffer[a])}return{newMask:n,position:{x:r.low,y:i.low}}}onmessage=function(n){var o=n.data,a=o.maskLowThreshold?o.maskLowThreshold:20,h=o.maskHighThreshold?o.maskHighThreshold:200,s=o.widthSegments?o.widthSegments:20,u=o.heightSegments?o.heightSegments:20,d=o.offsetWindowWidth?o.offsetWindowWidth:21,g=o.offsetWindowHeight?o.offsetWindowHeight:21,v=o.wideSearchSaliency?o.wideSearchSaliency:.2,l=o.windowSearchSaliency?o.windowSearchSaliency:.9;postMessage(1);var c=o.projectDepthImage,w=o.maskImage;f(c,1),postMessage(3),f(w,1),postMessage(6);var m=t(w,a,h);postMessage(18);var p=0;m.buffer.map(function(e){e>0&&(p+=1)});var b=t(c,0,0,p);postMessage(30);var y=function(n,o,t,a,f,h,s){for(var u=Math.floor(o.dimension.width/t),d=Math.floor(o.dimension.height/a),g=0,v=[],l=0;l<t;++l)for(var c={low:l*u,high:(l+1)*u},w=0;w<a;++w){var m={low:w*d,high:(w+1)*d},p=r(o,c,m);v.push({saliency:p,widthrange:c,heightrange:m}),g+=p}v.sort(function(e,r){return r.saliency-e.saliency}),postMessage(40);for(var b=0,y=[],M=[],x=0;x<v.length;++x){var k=v[x];if((b+=k.saliency)<=g*f){var S=i(o,k.widthrange,k.heightrange);y.push(S),M.push(S)}else{if(!(b<=g*h))break;var W=i(o,k.widthrange,k.heightrange);M.push(W)}}postMessage(50);var j=e(n,y,{x:0,y:0},{width:Math.floor(u*(t/2))+1,height:Math.floor(d*(a/2))+1},50,90);return postMessage(90),e(n,M,j.offset,s,90,99).offset}(b,m,s,u,v,l,{width:d,height:g});postMessage(100);var M={lng:-y.x/b.dimension.width*(c.bbox.max.lng-c.bbox.min.lng),lat:y.y/b.dimension.height*(c.bbox.max.lat-c.bbox.min.lat)};postMessage({finish:!0,offset:M})};var n={width:3,height:3,kernel:[[-1,0,1],[-2,0,2],[-1,0,1]]},o={width:3,height:3,kernel:[[1,2,1],[0,0,0],[-1,-2,-1]]};function t(e){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments[3],f=e.dimension.width,h=e.dimension.height,s=a(e,{width:3,height:3,kernel:[[1/9,1/9,1/9],[1/9,1/9,1/9],[1/9,1/9,1/9]]}),u=a(s,n),d=a(s,o),g=new Array(f*h),v=new Array(f*h),l=0;l<v.length;++l){var c=u.buffer[l],w=d.buffer[l];g[l]=Math.sqrt(c*c+w*w);for(var m=Math.atan2(w,c)/Math.PI*180;m<0;)m+=180;m>22.5&&m<=67.5?m=45:m>67.5&&m<=112.5?m=90:m>112.5&&m<=157.5?m=135:(m<=22.5&&m>=0||m>157.5&&m<=180)&&(m=0),v[l]=m}for(var p=g.slice(),b=0;b<f;++b)for(var y=0;y<h;++y){var M=y*f+b,x=v[M],k=g[M];90===x?k>=g[y*f+(b+1)%f]&&k>=g[y*f+(b-1)%f]?p[M]=g[M]:p[M]=0:45===x?k>=g[(y+1)%h*f+(b+1)%f]&&k>=g[(y-1)%h*f+(b-1)%f]?p[M]=g[M]:p[M]=0:135===x?k>=g[(y+1)%h*f+(b-1)%f]&&k>=g[(y-1)%h*f+(b+1)%f]?p[M]=g[M]:p[M]=0:k>=g[(y+1)%h*f+b]&&k>=g[(y-1)%h*f+b]?p[M]=g[M]:p[M]=0}if(0===r&&0===i&&void 0!==t){var S=p[0],W=p[0];p.map(function(e){S=S>e?e:S,W=W<e?e:W});for(var j=[],O=0;O<254;++O)j.push(0);for(var A=0;A<p.length;++A){p[A]=(p[A]-S)/(W-S)*255;for(var H=0;H<254&&p[A]>H+1;++H)j[H]+=1}for(var T=0;T<254;++T){var I=253-T;if(i=I+1,j[I]>t)break}r=.5*i}for(var P=new Array(f*h),L=0;L<f;++L)for(var _=0;_<h;++_){var q=_*f+L,D=p[q];P[q]=D>i?2:D<r?0:1}for(var z=P.slice(),B=0;B<f;++B)for(var C=0;C<h;++C){var E=C*f+B,F=0;2===P[C%h*f+(B+1)%f]&&(F+=1),2===P[C%h*f+(B-1)%f]&&(F+=1),2===P[(C+1)%h*f+(B+1)%f]&&(F+=1),2===P[(C+1)%h*f+B%f]&&(F+=1),2===P[(C+1)%h*f+(B-1)%f]&&(F+=1),2===P[(C-1)%h*f+(B+1)%f]&&(F+=1),2===P[(C-1)%h*f+B%f]&&(F+=1),2===P[(C-1)%h*f+(B-1)%f]&&(F+=1),z[E]=F>0?2:0}var G=Object.assign({},e,{buffer:z});return function(e){var r=e.buffer[0],i=e.buffer[0];e.buffer.map(function(e){r=r>e?e:r,i=i<e?e:i});for(var n=0;n<e.buffer.length;++n)e.buffer[n]=(e.buffer[n]-r)/(i-r)*255}(G),G}function a(e,r){for(var i=e.dimension.width,n=e.dimension.height,o=new Array(i*n),t=r.kernel,a=Math.floor((r.width-1)/2),f=Math.floor((r.height-1)/2),h=0;h<i;++h)for(var s=0;s<n;++s){for(var u=0,d=-a;d<a+1;++d)for(var g=-f;g<f+1;++g){var v=(s+g)*i+h+d;v>=0&&v<e.buffer.length&&(u+=e.buffer[v]*t[d+a][g+f])}o[s*i+h]=u}return Object.assign({},e,{buffer:o})}function f(e,r){for(var i=0;i<e.dimension.height/2;++i)for(var n=0;n<e.dimension.width*r;++n){var o=i*e.dimension.width*r+n,t=(e.dimension.height-1-i)*e.dimension.width*r+n,a=e.buffer[o];e.buffer[o]=e.buffer[t],e.buffer[t]=a}}})?n.apply(r,o):n)||(e.exports=t)}]);',r.p+"OffsetDetectionWorker.js")}},function(e,t,r){var n,i,o,a;a=function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=(i=r)&&i.__esModule?i:{default:i};var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e.usage="water",e.MaskType=o.default;var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.sceneNode=e.sceneNode,r.normalTex=null,r.downloadSucess=!1,r.isDebug=!1,r.scene=e.scene,r.renderer=e.renderer,r.camera=e.camera,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.MaskManager),a(t,[{key:"destruct",value:function(){this.directionalLight_water&&this.directionalLight_water.dispose(),n.MaskManager.prototype.destruct.call(this)}},{key:"downloadAll",value:function(){var e=this;return e.isDebug&&console.log("1. download normal tex ..."),new Promise(function(t,r){e.service.getNormalTex(function(r){r&&(e.normalTex=r,e.isDebug&&(console.log("normal tex loaded",e.normalTex),console.log("2. download water settings ...")),e._downloadSettings(o.default,function(){t()}))})})}},{key:"_defaultMaskOpts",value:function(e){var t=n.MaskManager.prototype._defaultMaskOpts.call(this);return t.sceneNode=this.sceneNode,t.scene=this.scene,t.renderer=this.renderer,t.camera=this.camera,t.show=!0,t.directionalLight_water=this.directionalLight_water,t.normalTex=this.normalTex,t.createDefault=!1,t.maskId=e,t}},{key:"renderWaters",value:function(){for(var e in this.maskSettings){this.maskSettings[e].render()}}},{key:"removeWater",value:function(e){this.maskSettings[e]&&(this.maskSettings[e].remove(),delete this.maskSettings[e],this.isDebug&&console.log("after delete #",Object.keys(this.maskSettings)),this.nameCnt=0,this.isModified=!0)}}]),t}();t.default=s,e.exports=t.default},i=[e,t,r(70),r(4)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,a=(o=i)&&o.__esModule?o:{default:o};var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.isShown=e.show,r.sceneNode=e.sceneNode,r.scene=e.scene,r.renderer=e.renderer,r.camera=e.camera,r.createDefault=e.createDefault,r.normalTex=e.normalTex,r.dynamic_water=null,r.aMeshMirror=null,r.isDebug=!1,r._speed=1,r._lastUpdateTime=null,r.water_properties={},r._setOrthoProperties(),r.default_properties={level:.5*(r.water_properties.max_level+r.water_properties.min_level),alpha:.9,color:2138762,wave:.2*r.water_properties.max_wave},r.manager.default_properties=r.default_properties,r.setPropoerties(),r._initLighting(),r.card_item=null,r.card_header=null,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.MaskSetting),s(t,[{key:"_setOrthoProperties",value:function(){this.water_properties.width=this.orthoInfo.max_bound.x-this.orthoInfo.min_bound.x,this.water_properties.height=this.orthoInfo.max_bound.z-this.orthoInfo.min_bound.z,this.water_properties.max_level=this.orthoInfo.max_bound.y,this.water_properties.min_level=this.orthoInfo.min_bound.y,this.water_properties.position=this.info.origin.clone().add(this.info.min_bound.clone().add(this.info.max_bound).multiplyScalar(.5)),this.water_properties.max_wave=Math.max(this.water_properties.width,this.water_properties.height)/100,this.water_properties.min_wave=0,this.water_properties.max_area=this.water_properties.width*this.water_properties.height}},{key:"setPropoerties",value:function(e){e?(this.water_properties.level=e.level,this.water_properties.color=e.color,this.water_properties.alpha=e.alpha,this.water_properties.wave=e.wave):(this.water_properties.level=this.default_properties.level,this.water_properties.color=this.default_properties.color,this.water_properties.alpha=this.default_properties.alpha,this.water_properties.wave=this.default_properties.wave)}},{key:"_initLighting",value:function(){if(this.directionalLight_water)console.warn("directionalLight_water already initialized");else{this.directionalLight_water=new r.DirectionalLight(16777045,1);var e=Math.max(this.water_properties.width,this.water_properties.height);this.directionalLight_water.position.set(-.2*e,.5*e,.2*e),this.directionalLight_water.position.add(this.water_properties.position)}}},{key:"initMask",value:function(e,t){var r=this;r.init(e,function(){r.setPropoerties(e.property),r.createWaterTex(r.curMaskRGB),r.isDebug&&console.log("donwload water property",r.water_properties),t&&t()},function(){r.createDefault&&r.resetMask(t)})}},{key:"createWaterTex",value:function(e){var t=this.maskToTexture(e);this._createWaterMesh(this.normalTex,t)}},{key:"updateWaterTex",value:function(e){var t=this.maskToTexture(e);this.dynamic_water.setMask(t),this.aMeshMirror.material=this.dynamic_water.material,this.show()}},{key:"resetMask",value:function(e){var t=this;this.reset(function(r){t.dynamic_water?t.updateWaterTex(r):t.createWaterTex(r),e&&e(t)},"black")}},{key:"_createWaterMesh",value:function(e,t){var n=e;n.wrapS=n.wrapT=r.RepeatWrapping;var i={textureWidth:this.mask_size,textureHeight:this.mask_size,waterNormals:n,alpha:this.water_properties.alpha,sunDirection:new r.Vector3(-1,1,2).normalize(),sunColor:16777215,waterColor:this.water_properties.color,betaVersion:0,side:r.FrontSide,distortionScale:0,noiseScale:this.water_properties.wave,eye:this.camera.matrixWorld,cropMask:t,time:10};this.isDebug&&console.log("creater water properties",i),this.dynamic_water=new a.default(this.renderer,this.camera,this.scene,i),this.aMeshMirror=new r.Mesh(new r.PlaneBufferGeometry(this.water_properties.width,this.water_properties.height,10,10),this.dynamic_water.material),this.aMeshMirror.add(this.dynamic_water);var o=this.info.origin.clone().add(this.info.min_bound.clone().add(this.info.max_bound).multiplyScalar(.5)),s=this.info.origin.z+this.water_properties.level;o.setZ(s),this.aMeshMirror.position.copy(o),this.sceneNode.add(this.aMeshMirror),this.aMeshMirror.visible=this.isShown,this.dynamic_water.updateMatrixWorld(),this.directionalLight_water.target=this.dynamic_water,this.render()}},{key:"render",value:function(){if(this.dynamic_water&&this.renderer){var e=(new Date).getTime(),t=0;t=this._lastUpdateTime?e-this._lastUpdateTime:1,this.dynamic_water.material.uniforms.time.value+=this.speed*t/2e3,this.dynamic_water.material.needsUpdate=!0,this.dynamic_water.render(),this._lastUpdateTime=e}}},{key:"show",value:function(){null!=this.aMeshMirror&&(this.aMeshMirror.visible=!0)}},{key:"hide",value:function(){null!=this.aMeshMirror&&(this.aMeshMirror.visible=!1)}},{key:"apply",value:function(e){var t=this,r=this.polygons;this.applyPolygon(r,function(){t.updateWaterTex(t.curMaskRGB)})}},{key:"updateMaskInfo",value:function(){n.MaskSetting.prototype.updateMaskInfo.call(this),this.maskInfo.property={level:this.water_properties.level,alpha:this.water_properties.alpha,color:this.water_properties.color,wave:this.water_properties.wave}}},{key:"active",value:function(){this.card_item&&(this.isDebug&&console.log("active ",this.maskId),this.card_item.addClass("water-active"))}},{key:"deactive",value:function(){this.card_item&&(this.isDebug&&console.log("deactive ",this.maskId),this.card_item.removeClass("water-active"))}},{key:"remove",value:function(){n.MaskSetting.prototype.remove.call(this),this.card_item&&this.card_item.remove(),this.sceneNode.remove(this.aMeshMirror)}},{key:"getWater",value:function(){return this.dynamic_water}},{key:"levelRange",get:function(){return this.water_properties.max_level-this.water_properties.min_level}},{key:"level",set:function(e){this.water_properties.level=e,this.aMeshMirror&&this.aMeshMirror.position.setY(this.water_properties.level)},get:function(){return this.water_properties.level}},{key:"minLevel",get:function(){return this.water_properties.min_level}},{key:"maxLevel",get:function(){return this.water_properties.max_level}},{key:"alpha",set:function(e){this.water_properties.alpha=e,this.dynamic_water&&(this.dynamic_water.material.uniforms.alpha.value=this.water_properties.alpha)},get:function(){return this.water_properties.alpha}},{key:"color",set:function(e){this.isDebug&&console.log("set color",e),this.water_properties.color=e,this.dynamic_water&&(this.dynamic_water.material.uniforms.waterColor.value=new r.Color(e))},get:function(){return this.water_properties.color}},{key:"wave",set:function(e){this.water_properties.wave=e,this.dynamic_water&&(this.dynamic_water.material.uniforms.noiseScale.value=this.water_properties.wave)},get:function(){return this.water_properties.wave}},{key:"wavePercent",set:function(e){this.water_properties.wave=e*(this.water_properties.max_wave-this.water_properties.min_wave)+this.water_properties.min_wave,this.dynamic_water&&(this.dynamic_water.material.uniforms.noiseScale.value=this.water_properties.wave),this.isDebug&&console.log("set wave ",this.water_properties.wave)},get:function(){return(this.water_properties.wave-this.water_properties.min_wave)/(this.water_properties.max_wave-this.water_properties.min_wave)}},{key:"speed",set:function(e){(e<=0||e>1e4)&&console.warn("Invalid water speed",e),this._speed=e},get:function(){return this._speed}},{key:"center",get:function(){console.warn("WaterSetting::center not defined.")}}]),t}();t.default=l,e.exports=t.default},i=[e,t,r(0),r(4),r(71)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={uniforms:r.UniformsUtils.merge([r.UniformsLib.fog,{normalSampler:{type:"t",value:null},mirrorSampler:{type:"t",value:null},alpha:{type:"f",value:1},time:{type:"f",value:0},distortionScale:{type:"f",value:20},noiseScale:{type:"f",value:1},textureMatrix:{type:"m4",value:new r.Matrix4},sunColor:{type:"c",value:new r.Color(8355711)},sunDirection:{type:"v3",value:new r.Vector3(.70707,.70707,0)},eye:{type:"v3",value:new r.Vector3(0,0,0)},waterColor:{type:"c",value:new r.Color(5592405)},cropMask:{type:"t",value:null},useMask:{type:"b",value:!1}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec3 worldPosition;","varying vec3 modelPosition;","varying vec3 surfaceX;","varying vec3 surfaceY;","varying vec3 surfaceZ;","varying vec2 vUv;","void main()","{","  mirrorCoord = modelMatrix * vec4(position, 1.0);","  worldPosition = mirrorCoord.xyz;","  modelPosition = vec3(uv * 512.0, 0);","  surfaceX = vec3( modelMatrix[0][0], modelMatrix[0][1], modelMatrix[0][2]);","  surfaceY = vec3( modelMatrix[1][0], modelMatrix[1][1], modelMatrix[1][2]);","  surfaceZ = vec3( modelMatrix[2][0], modelMatrix[2][1], modelMatrix[2][2]);","  vUv = uv;","  mirrorCoord = textureMatrix * mirrorCoord;","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float distortionScale;","uniform float noiseScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec3 worldPosition;","varying vec3 modelPosition;","varying vec3 surfaceX;","varying vec3 surfaceY;","varying vec3 surfaceZ;","varying vec2 vUv;","uniform sampler2D cropMask;","uniform bool useMask;","void sunLight(const vec3 surfaceNormal, const vec3 eyeDirection, in float shiny, in float spec, in float diffuse, inout vec3 diffuseColor, inout vec3 specularColor)","{","  vec3 reflection = normalize(reflect(-sunDirection, surfaceNormal));","  float direction = max(0.0, dot(eyeDirection, reflection));","  specularColor += pow(direction, shiny) * sunColor * spec;","  diffuseColor += max(dot(sunDirection, surfaceNormal), 0.0) * sunColor * diffuse;","}","vec3 getNoise(in vec2 uv)","{","  vec2 uv0 = uv / (103.0 * noiseScale) + vec2(time / 17.0, time / 29.0);","  vec2 uv1 = uv / (107.0 * noiseScale) - vec2(time / -19.0, time / 31.0);","  vec2 uv2 = uv / (vec2(8907.0, 9803.0) * noiseScale) + vec2(time / 101.0, time /   97.0);","  vec2 uv3 = uv / (vec2(1091.0, 1027.0) * noiseScale) - vec2(time / 109.0, time / -113.0);","  vec4 noise = texture2D(normalSampler, uv0) +","    texture2D(normalSampler, uv1) +","    texture2D(normalSampler, uv2) +","    texture2D(normalSampler, uv3);","  return noise.xyz * 0.5 - 1.0;","}",r.ShaderChunk.common,r.ShaderChunk.fog_pars_fragment,"void main()","{","  vec3 worldToEye = eye - worldPosition;","  vec3 eyeDirection = normalize(worldToEye);","  if (useMask) {","    vec2 os_uv = vec2(vUv.x, 1.0 - vUv.y);","    float mask_val = texture2D(cropMask, os_uv).y;","    if(mask_val < 0.05) {","      discard;","    }","  }","  vec3 noise = getNoise(modelPosition.xy * 1.0);","  vec3 distordCoord = noise.x * surfaceX + noise.y * surfaceY;","  vec3 distordNormal = normalize(distordCoord + surfaceZ);","  if(dot(eyeDirection, surfaceZ) < 0.0)","    distordNormal = distordNormal * -1.0;","  vec3 diffuseLight = vec3(0.0);","  vec3 specularLight = vec3(0.0);","  sunLight(distordNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight);","  float distance = length(worldToEye);","  vec2 distortion = distordCoord.xy * distortionScale * sqrt(distance) * 0.07;"," vec3 mirrorDistord = mirrorCoord.xyz + vec3(distortion.x, distortion.y, distortionScale * sqrt(distance));"," vec3 reflectionSample = texture2DProj(mirrorSampler, mirrorDistord).xyz;","  float theta = max(dot(eyeDirection, distordNormal), 0.0);","  float reflectance = 0.3 + (1.0 - 0.3) * pow((1.0 - theta), 3.0);","  vec3 scatter = max(0.0, dot(distordNormal, eyeDirection)) * waterColor;","  vec3 albedo = mix(sunColor * diffuseLight * 0.3 + scatter, (vec3(0.1) + reflectionSample * 0.9 + reflectionSample * specularLight), reflectance);"," vec3 outgoingLight = albedo;",r.ShaderChunk.fog_fragment," gl_FragColor = vec4( outgoingLight, alpha );","}"].join("\n")},i=function(e,t,i,o){function a(e,t){return void 0!==e?e:t}r.Object3D.call(this),this.name="water_"+this.id,o=o||{},this.matrixNeedsUpdate=!0;var s=a(o.textureWidth,512),l=a(o.textureHeight,512);this.clipBias=a(o.clipBias,-1e-4),this.alpha=a(o.alpha,1),this.time=a(o.time,0),this.normalSampler=a(o.waterNormals,null),this.sunDirection=a(o.sunDirection,new r.Vector3(.70707,.70707,0)),this.sunColor=new r.Color(a(o.sunColor,16777215)),this.waterColor=new r.Color(a(o.waterColor,8355711)),this.eye=a(o.eye,new r.Vector3(0,0,0)),this.distortionScale=a(o.distortionScale,20),this.noiseScale=a(o.noiseScale,1),this.side=a(o.side,r.FrontSide),this.fog=a(o.fog,!1),this.renderer=e,this.scene=i,this.mirrorPlane=new r.Plane,this.normal=new r.Vector3(0,0,1),this.cameraWorldPosition=new r.Vector3,this.rotationMatrix=new r.Matrix4,this.lookAtPosition=new r.Vector3(0,0,-1),this.clipPlane=new r.Vector4,this.cropMask=a(o.cropMask,null),this.useMask=null!==this.cropMask,t instanceof r.PerspectiveCamera?this.camera=t:(this.camera=new r.PerspectiveCamera,console.warn(this.name+": camera is not a Perspective Camera!")),this.textureMatrix=new r.Matrix4,this.mirrorCamera=this.camera.clone(),this.texture=new r.WebGLRenderTarget(s,l),this.tempTexture=new r.WebGLRenderTarget(s,l);var u=n,c=r.UniformsUtils.clone(u.uniforms);this.material=new r.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:c,transparent:!0,side:this.side,fog:this.fog}),this.mesh=new r.Object3D,this.material.uniforms.mirrorSampler.value=this.texture.texture,this.material.uniforms.textureMatrix.value=this.textureMatrix,this.material.uniforms.alpha.value=this.alpha,this.material.uniforms.time.value=this.time,this.material.uniforms.normalSampler.value=this.normalSampler,this.material.uniforms.sunColor.value=this.sunColor,this.material.uniforms.waterColor.value=this.waterColor,this.material.uniforms.sunDirection.value=this.sunDirection,this.material.uniforms.distortionScale.value=this.distortionScale,this.material.uniforms.noiseScale.value=this.noiseScale,this.material.uniforms.eye.value=this.eye,this.material.uniforms.cropMask.value=this.cropMask,this.material.uniforms.useMask.value=this.useMask,r.Math.isPowerOfTwo(s)&&r.Math.isPowerOfTwo(l)||(this.texture.generateMipmaps=!1,this.tempTexture.generateMipmaps=!1)};(i.prototype=Object.create(r.Object3D.prototype)).setMask=function(e){this.material.uniforms.cropMask.value=e,this.material.uniforms.useMask.value=null!==e},i.prototype.updateTextureMatrix=function(){function e(e){return e?e<0?-1:1:0}void 0!==this.parent&&(this.mesh=this.parent),this.updateMatrixWorld(),this.camera.updateMatrixWorld(),this.cameraWorldPosition.setFromMatrixPosition(this.camera.matrixWorld);var t=(new r.Vector3).setFromMatrixPosition(this.matrixWorld);this.rotationMatrix.extractRotation(this.matrixWorld),this.normal=new r.Vector3(0,0,1).applyEuler((new r.Euler).setFromRotationMatrix(this.rotationMatrix));var n=this.cameraWorldPosition.clone().sub(t);if(this.normal.dot(n)<0){var i=new r.Vector3(0,0,1).applyEuler((new r.Euler).setFromRotationMatrix(this.rotationMatrix));this.normal.reflect(i)}var o=t.clone().sub(this.cameraWorldPosition);o.reflect(this.normal).negate(),o.add(t),this.rotationMatrix.extractRotation(this.camera.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition);var a=t.clone().sub(this.lookAtPosition);a.reflect(this.normal).negate(),a.add(t),this.up.set(0,-1,0),this.up.applyMatrix4(this.rotationMatrix),this.up.reflect(this.normal).negate(),this.mirrorCamera.near=1e-12,this.mirrorCamera.far=100,this.mirrorCamera.position.copy(o),this.mirrorCamera.up=this.up,this.mirrorCamera.lookAt(a),this.mirrorCamera.aspect=this.camera.aspect,this.mirrorCamera.updateProjectionMatrix(),this.mirrorCamera.updateMatrixWorld(),this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix),this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse),this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,t),this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse),this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);var s=new r.Vector4,l=this.mirrorCamera.projectionMatrix;s.x=(e(this.clipPlane.x)+l.elements[8])/l.elements[0],s.y=(e(this.clipPlane.y)+l.elements[9])/l.elements[5],s.z=-1,s.w=(1+l.elements[10])/l.elements[14];var u=new r.Vector4;u=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(s)),l.elements[2]=u.x,l.elements[6]=u.y,l.elements[10]=u.z+1-this.clipBias,l.elements[14]=u.w;var c=new r.Vector3;c.setFromMatrixPosition(this.camera.matrixWorld),this.eye=c,this.material.uniforms.eye.value=this.eye},i.prototype.render=function(e){if(this.matrixNeedsUpdate&&this.updateTextureMatrix(),this.matrixNeedsUpdate=!0,void 0!==this.scene&&this.scene instanceof r.Scene){this.material.visible=!1;var t=void 0!==e&&e?this.tempTexture:this.texture;this.renderer.render(this.scene,this.mirrorCamera,t,!0),this.material.visible=!0,this.material.uniforms.mirrorSampler.value=t.texture}},i.prototype.getMirrorCamera=function(e){var t=void 0!==e&&e?this.tempTexture:this.texture;this.renderer.render(this.scene,this.mirrorCamera,t,!0);var r=this.renderer.getContext(),n=t.width,i=t.height,o=new Uint8Array(n*i*4);return r.readPixels(0,0,n,i,r.RGBA,r.UNSIGNED_BYTE,o),{mirrorCamera:this.mirrorCamera,renderTexture:t,imgArray:o}},i.prototype.addMirrorHelper=function(){this.camHelper=new r.CameraHelper(this.mirrorCamera),this.scene.add(this.camHelper)},t.default=i,e.exports=t.default},i=[e,t,r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=f(r),l=f(n),u=f(i),c=f(o),h=f(a);function f(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.materials={mtlmatcapshadermaterial:s.default,mtlphongshadermaterial:l.default,mtlpbrshadermaterial:u.default,suggestivecontoursshadermaterial:c.default},this.setObjectMaterial=this.setObjectMaterial.bind(this)}return d(e,[{key:"setObjectMaterial",value:function(e,t,r){var n=this.materials[t.toLowerCase()],i=[];if(r instanceof Array){if(r.map(function(t){var r=new n(t);e.changeMaterial(r),i.push(r)}),"suggestivecontoursshadermaterial"===t.toLowerCase()){var o=e.shapeHolder.children[0].children[0].children[0].children[0].geometry,a=new h.default;a.calculateForGeometry(o),e.shapeHolder.children[0].children[0].children[0].children[0].geometry=a.getBufferGeometry()}return i}console.error("[materialmanager] options error",r)}}]),e}();t.default=p,e.exports=t.default},i=[e,t,r(73),r(15),r(74),r(75),r(76)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,a=(o=i)&&o.__esModule?o:{default:o};var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var l={uniforms:{bumpMapUsed:{type:"f",value:0},bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1},bumpMapPath:{value:null},normalMapUsed:{type:"f",value:0},normalMap:{type:"t",value:null},normalScale:{type:"v2",value:[1,1]},normalMapPath:{value:null},displacementMapUsed:{type:"f",value:0},displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:0},displacementBias:{type:"f",value:0},displacementMapPath:{value:null},ka:{type:"v3",value:[.2,.2,.2]},mapKaUsed:{type:"f",value:0},mapKa:{type:"t",value:null},mapKaPath:{value:null},mapKaWidth:{type:"f",value:1},mapKaHeight:{type:"f",value:1},kd:{type:"v3",value:[.1,.1,1]},mapKdUsed:{type:"f",value:0},mapKd:{type:"t",value:null},mapKdPath:{value:null},mapKdWidth:{type:"f",value:1},mapKdHeight:{type:"f",value:1},ks:{type:"v3",value:[1,.1,.1]},mapKsUsed:{type:"f",value:0},mapKs:{type:"t",value:null},mapKsPath:{value:null},mapKsWidth:{type:"f",value:1},mapKsHeight:{type:"f",value:1},ns:{type:"f",value:20},d:{type:"f",value:1},MatcapTextureUsed:{type:"f",value:0},MatcapTexture:{type:"t",value:null},MatcapTexturePath:{value:null},fraction:{type:"v3",value:[1,1,1]}},vertexShader:"\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n"+n.SelfShaderChunks.DisplacementMapPositionCalculation_vertex+"\nvoid main()\n{\n  // passing texture to fragment shader\n  vUv = uv;\n  vNormal = normalize(normalMatrix * normal);\n  vViewPosition = -(modelViewMatrix * vec4(position, 1.0)).xyz;\n\n  vec3 transformedPosition = position + displacementMapOffset(normal, uv);\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(transformedPosition,1.0);\n}\n",fragmentShader:"\n#define USE_BUMPMAP\n#define USE_NORMALMAP\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n\nuniform sampler2D MatcapTexture;\nuniform float MatcapTextureUsed;\n\nuniform float bumpMapUsed;\nuniform float normalMapUsed;\n\nuniform vec3 fraction;\n"+r.ShaderChunk.bumpmap_pars_fragment+r.ShaderChunk.normalmap_pars_fragment+"\nvoid main() {\n  vec3 modelPosition = -vViewPosition;\n  vec3 treatedNormal = normalize(vNormal);\n  if(bumpMapUsed>0.5)treatedNormal = perturbNormalArb(modelPosition, treatedNormal, dHdxy_fwd());\n  if(normalMapUsed>0.5)treatedNormal = perturbNormal2Arb( modelPosition, treatedNormal );\n  vec3 r = reflect(treatedNormal, normalize(modelPosition));\n  float m = 2.0 * sqrt(pow(r.x,2.0)+pow(r.y,2.0)+pow(r.z+1.5,2.0));\n  vec2 matcapuv = r.xy / m + 0.5;  \n\n  vec3 base = fraction;\n  if(MatcapTextureUsed > 0.5){\n    base *= texture2D(MatcapTexture, matcapuv).rgb;\n  }\n\n  gl_FragColor = vec4(base,1.0);\n}\n"},u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.uniforms=JSON.parse(JSON.stringify(l.uniforms)),r.vertexShader=l.vertexShader,r.fragmentShader=l.fragmentShader,r.transparent=!0,r.extensions.derivatives=!0,r.description={},r.description.type="MTLMatcapShaderMaterial",r.loadMTLOptions(e),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.ShaderMaterial),s(t,[{key:"loadMTLOptions",value:function(e){if(null!==e&&void 0!==e&&Object.keys(e).length>0){this.name=e.name,this.description.name=e.name;var t=e.bump;void 0!==t&&null!==t&&(this._loadTexture(t,this.uniforms.bumpMap,this.uniforms.bumpMapUsed,this.uniforms.bumpMapPath),this.description.bump=t);var r=e.MatcapTexturePath;void 0!==r&&null!==r&&(this._loadTexture(r,this.uniforms.MatcapTexture,this.uniforms.MatcapTextureUsed,this.uniforms.MatcapTexturePath),this.description.MatcapTexturePath=r),e.fraction&&(this.uniforms.fraction.value=e.fraction,this.description.fraction=e.fraction)}}},{key:"loadMatcapTexture",value:function(e){this._loadTexture(e,this.uniforms.MatcapTexture,this.uniforms.MatcapTextureUsed,this.uniforms.MatcapTexturePath),this.description.MatcapTexturePath=e}},{key:"_loadTexture",value:function(e,t,r,n){if(""!==e){var i=new a.default;i.setCrossOrigin(""),i.withCredentials=!0,i.load(e,function(i){t.value=i,n.value=e,r.value=1},function(e){},function(t){console.warn("an error happened while loading "+e)})}else r.value=0}},{key:"getMatcapTexturePath",value:function(){return{value:this.uniforms.MatcapTexturePath.value}}},{key:"setMatcapTextureFraction",value:function(e){this.uniforms.fraction.value=e,this.description.fraction=e}},{key:"getFraction",value:function(){return{value:this.array2Hex(this.uniforms.fraction.value)}}},{key:"array2Hex",value:function(e){return"#"+Math.round(255*e[0]).toString(16)+Math.round(255*e[1]).toString(16)+Math.round(255*e[2]).toString(16)}},{key:"clone",value:function(){return new this.constructor(this.description)}}]),t}();t.default=u,e.exports=t.default},i=[e,t,r(0),r(14),r(8)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,a=(o=i)&&o.__esModule?o:{default:o};var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var l={uniforms:{bumpMapUsed:{type:"f",value:0},bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1},bumpMapPath:{value:null},normalMapUsed:{type:"f",value:0},normalMap:{type:"t",value:null},normalScale:{type:"v2",value:[1,1]},normalMapPath:{value:null},displacementMapUsed:{type:"f",value:0},displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:0},displacementBias:{type:"f",value:0},displacementMapPath:{value:null},ka:{type:"v3",value:[.2,.2,.2]},mapKaUsed:{type:"f",value:0},mapKa:{type:"t",value:null},mapKaPath:{value:null},mapKaWidth:{type:"f",value:1},mapKaHeight:{type:"f",value:1},kd:{type:"v3",value:[.1,.1,1]},mapKdUsed:{type:"f",value:0},mapKd:{type:"t",value:null},mapKdPath:{value:null},mapKdWidth:{type:"f",value:1},mapKdHeight:{type:"f",value:1},ks:{type:"v3",value:[1,.1,.1]},mapKsUsed:{type:"f",value:0},mapKs:{type:"t",value:null},mapKsPath:{value:null},mapKsWidth:{type:"f",value:1},mapKsHeight:{type:"f",value:1},ns:{type:"f",value:20},d:{type:"f",value:1},perceptualRoughness:{type:"f",value:1},metallic:{type:"f",value:0},f0:{type:"v3",value:[.04,.04,.04]},baseColorPercentage:{type:"f",value:100}},vertexShader:"\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n"+n.SelfShaderChunks.DisplacementMapPositionCalculation_vertex+r.ShaderChunk.common+r.ShaderChunk.bsdfs+r.ShaderChunk.lights_pars_begin+"\nvoid main(){\n  vUv = uv;\n  vNormal = normalize(normalMatrix * normal);\n  vViewPosition = -(modelViewMatrix * vec4(position, 1.0)).xyz;\n  vec3 transformedPosition = position + displacementMapOffset(normal, uv);\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(transformedPosition, 1.0);\n}\n",fragmentShader:"\n#define USE_BUMPMAP\n#define USE_NORMALMAP\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n\nuniform float perceptualRoughness;\nuniform float metallic;\nuniform vec3 f0;\nuniform float baseColorPercentage;\n\nuniform float bumpMapUsed;\nuniform float normalMapUsed;\n\nuniform vec3 ka;\nuniform float mapKaUsed;\nuniform sampler2D mapKa;\nuniform vec3 kd;\nuniform float mapKdUsed;\nuniform sampler2D mapKd;\nuniform vec3 ks;\nuniform float mapKsUsed;\nuniform sampler2D mapKs;\nuniform float ns;\nuniform float d;\n"+r.ShaderChunk.common+r.ShaderChunk.bsdfs+r.ShaderChunk.lights_pars_begin+r.ShaderChunk.bumpmap_pars_fragment+r.ShaderChunk.normalmap_pars_fragment+"\n#define minRoughness 0.04\n\nvec3 F_Schlick2(vec3 specularColor, float VdotH)\n{\n  float maxColor = max(max(specularColor.r, specularColor.g), specularColor.b);\n  vec3 r90 = vec3(1.0) * maxColor;\n  return specularColor + (r90 - specularColor) * pow(1.0 - VdotH, 5.0);\n}\n\n// Simplified implementation of fresnel from “An Inexpensive BRDF Model for Physically based Rendering” by Christophe Schlick\nvec3 F_Schlick3(float metalness, float VdotH)\n{\n  return metalness + (vec3(1.0) - metalness) * pow(1.0 - VdotH, 5.0);\n}\n\n// The following equations model the geometric occlusion term of the spec equation  (aka G())\n// Implementation from “A Reflectance Model for Computer Graphics” by Robert Cook and Kenneth Torrance,\nfloat geometricOcclusionCookTorrance(float NdotV, float NdotH, float VdotH, float NdotL)\n{\n  return min(min(2.0 * NdotV * NdotH / VdotH, 2.0 * NdotL * NdotH / VdotH), 1.0);\n}\n\n// implementation of microfacet occlusion from “An Inexpensive BRDF Model for Physically based Rendering” by Christophe Schlick\nfloat geometricOcclusionSchlick(float roughness, float LdotH, float NdotH)\n{\n  float k = roughness * 0.79788; // 0.79788 = sqrt(2.0/3.1415);\n  // alternately, k can be defined with\n  // float k = (roughness + 1) * (roughness + 1) / 8;\n\n  float l = LdotH / (LdotH * (1.0 - k) + k);\n  float n = NdotH / (NdotH * (1.0 - k) + k);\n  return l * n;\n}\n\n// the following Smith implementations are from “Geometrical Shadowing of a Random Rough Surface” by Bruce G. Smith\nfloat geometricOcclusionSmith(float roughness2, float NdotL, float NdotV)\n{\n  float NdotL2 = NdotL * NdotL;\n  float NdotV2 = NdotV * NdotV;\n  float v = ( -1.0 + sqrt ( roughness2 * (1.0 - NdotL2 ) / NdotL2 + 1.)) * 0.5;\n  float l = ( -1.0 + sqrt ( roughness2 * (1.0 - NdotV2 ) / NdotV2 + 1.)) * 0.5;\n  return (1.0 / max((1.0 + v + l ), 0.000001));\n}\n\nfloat SmithG1_var2(float NdotV, float r)\n{\n  float tanSquared = (1.0 - NdotV * NdotV) / max((NdotV * NdotV), 0.00001);\n  return 2.0 / (1.0 + sqrt(1.0 + r * r * tanSquared));\n}\n\nfloat SmithG1(float NdotV, float r)\n{\n  return 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));\n}\n\nfloat geometricOcclusionSmithGGX(float roughness2, float NdotL, float NdotV)\n{\n  return SmithG1_var2(NdotL, roughness2) * SmithG1_var2(NdotV, roughness2);\n}\n\n// The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())\n// implementation from “Average Irregularity Representation of a Roughened Surface for Ray Reflection” by T. S. Trowbridge, and K. P. Reitz\nfloat GGX(float roughness2, float NdotH)\n{\n  float roughness4 = roughness2 * roughness2;\n  float f = (NdotH * roughness4 - NdotH) * NdotH + 1.0;\n  return roughness4 * RECIPROCAL_PI / (f * f);\n}\n\nvec3 getDiffuse(vec3 N, vec3 L, vec3 lightColor, vec3 diffuseColor){\n  float NdotL = saturate(dot(N, L));\n  return NdotL * lightColor * diffuseColor;\n}\n\nvec3 getSpecular(vec3 N, vec3 L, vec3 V, vec3 H, vec3 lightColor, vec3 specularColor, float roughness){\n  float roughness2 = pow(roughness, 2.0);\n  float NdotL = saturate(dot(N, L));\n  float NdotV = saturate(dot(N, V));\n  float NdotH = saturate(dot(N, H));\n  float LdotH = saturate(dot(L, H));\n  float VdotH = saturate(dot(V, H));\n  // vec3 F = F_Schlick( specularColor, LdotH );\n  vec3 F = F_Schlick2(specularColor, VdotH);\n  // vec3 F = F_Schlick3(metalness, VdotH);\n  // float G = G_GGX_SmithCorrelated( roughness2, NdotL, NdotV );\n  float G = geometricOcclusionSmithGGX(roughness2, NdotL, NdotV);\n  // float G = geometricOcclusionSmith(roughness2, NdotL, NdotV);\n  // float G = geometricOcclusionSchlick(roughness, LdotH, NdotH);\n  // float G = geometricOcclusionCookTorrance(NdotV, NdotH, VdotH, NdotL);\n  // float D = D_GGX( roughness2, NdotH );\n  float D = GGX(roughness2, NdotH);\n  return NdotL * lightColor * F * G * D;\n}\n\nvoid main(){\n  vec3 modelPosition = -vViewPosition;\n  vec3 N = normalize(vNormal);\n  if(bumpMapUsed>0.5)N=perturbNormalArb(modelPosition, N, dHdxy_fwd());\n  if(normalMapUsed>0.5)N = perturbNormal2Arb( modelPosition, N );\n  vec3 V = normalize(cameraPosition - modelPosition);\n\n  vec3 diffuseResultColor = vec3(0.0);\n  vec3 specularResultColor = vec3(0.0);\n  vec3 diffuseColor = kd;\n  if(mapKdUsed>0.5)diffuseColor *= texture2D(mapKd, vUv).rgb;\n  diffuseColor *= baseColorPercentage / 100.0;\n  float roughness = clamp(perceptualRoughness, minRoughness, 1.0);\n  float metal = clamp(metallic, 0.0, 1.0);\n  vec3 backGroundColor = mix(diffuseColor, vec3(0.04, 0.04, 0.04), 0.6);\n  vec3 specularColor = mix(f0, diffuseColor, metal);\n  diffuseColor = mix(diffuseColor, backGroundColor, metal);\n\n  #if NUM_POINT_LIGHTS > 0\n    for(int i=0;i<NUM_POINT_LIGHTS;++i){\n      vec3 L = normalize(pointLights[i].position - modelPosition);\n      vec3 H = normalize(V+L);\n      diffuseResultColor += getDiffuse(N, L, pointLights[i].color, diffuseColor);\n      specularResultColor += getSpecular(N, L, V, H, pointLights[i].color, specularColor, roughness);\n    }\n  #endif\n  #if NUM_DIR_LIGHTS > 0\n    for(int i=0;i<NUM_DIR_LIGHTS;++i){\n      vec3 L = normalize(directionalLights[i].direction);\n      vec3 H = normalize(V+L);\n      diffuseResultColor += getDiffuse(N, L, directionalLights[i].color, diffuseColor);\n      specularResultColor += getSpecular(N, L, V, H, directionalLights[i].color, specularColor, roughness);\n    }\n  #endif\n  diffuseResultColor += diffuseColor * RECIPROCAL_PI; // indirect diffuse color\n\n  vec3 color = vec3(0.0);\n  color += diffuseResultColor;\n  color += specularResultColor;\n\n  gl_FragColor = vec4(color, d);\n}\n"},u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i=JSON.parse(JSON.stringify(l.uniforms));return n.uniforms=r.UniformsUtils.merge([r.UniformsLib.lights,i]),n.vertexShader=l.vertexShader,n.fragmentShader=l.fragmentShader,n.transparent=!0,n.extensions.derivatives=!0,n.lights=!0,n.description={},n.description.type="MTLPBRShaderMaterial",n.loadMTLOptions(e),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.ShaderMaterial),s(t,[{key:"loadMTLOptions",value:function(e){if(void 0!==e&&null!==e&&Object.keys(e).length>0){if(this.name=e.name,this.description.name=e.name,e.ka&&(this.uniforms.ka.value=e.ka,this.description.ka=e.ka),e.kd&&(this.uniforms.kd.value=e.kd,this.description.kd=e.kd),e.ks&&(this.uniforms.ks.value=e.ks,this.description.ks=e.ks),e.ns){var t=n.SelfHelperFunctions.getFloatStringPair(e.ns);t&&(this.uniforms.ns.value=t.f,this.description.ns=t.s)}if(e.d){var r=n.SelfHelperFunctions.getFloatStringPair(e.ns);r&&(this.uniforms.d.value=r.f,this.description.d=r.s)}var i=e.bump,o=e.map_kd;if(void 0!==o&&null!==o&&(this._loadTexture(o,this.uniforms.mapKd,this.uniforms.mapKdUsed,this.uniforms.mapKdPath,this.uniforms.mapKdWidth,this.uniforms.mapKdHeight),this.description.map_kd=o),void 0!==i&&null!==i&&(this._loadTexture(i,this.uniforms.bumpMap,this.uniforms.bumpMapUsed,this.uniforms.bumpMapPath),this.description.bump=i),e.metallic){var a=n.SelfHelperFunctions.getFloatStringPair(e.metallic);a&&(this.uniforms.metallic.value=a.f,this.description.metallic=a.s)}if(e.perceptualRoughness){var s=n.SelfHelperFunctions.getFloatStringPair(e.perceptualRoughness);s&&(this.uniforms.perceptualRoughness.value=s.f,this.description.perceptualRoughness=s.s)}if(e.f0&&(this.uniforms.f0.value=e.f0,this.description.f0=e.f0),e.baseColorPercentage){var l=n.SelfHelperFunctions.getFloatStringPair(e.baseColorPercentage);l&&(this.uniforms.baseColorPercentage.value=l.f,this.description.baseColorPercentage=l.s)}}}},{key:"_loadTexture",value:function(e,t,r,n,i,o){if(""!==e){var s=new a.default;s.setCrossOrigin("anonymous"),s.withCredentials=!0,s.load(e,function(a){t.value=a,i&&(i.value=parseFloat(a.image.width)),o&&(o.value=parseFloat(a.image.height)),n.value=e,r.value=1},function(e){},function(t){console.warn("an error happened while loading "+e)})}else r.value=0}},{key:"setMetallic",value:function(e){var t=n.SelfHelperFunctions.getFloatStringPair(e);t&&(this.uniforms.metallic.value=t.f,this.description.metallic=t.s)}},{key:"setRoughness",value:function(e){var t=n.SelfHelperFunctions.getFloatStringPair(e);t&&(this.uniforms.perceptualRoughness.value=t.f,this.description.perceptualRoughness=t.s)}},{key:"setSpecularF0",value:function(e){this.uniforms.f0.value=e,this.description.f0=e}},{key:"setBaseColor",value:function(e){this.uniforms.kd.value=e.slice(0,3),this.description.kd=e.slice(0,3)}},{key:"setBaseColorTexture",value:function(e){this._loadTexture(e,this.uniforms.mapKd,this.uniforms.mapKdUsed,this.uniforms.mapKdPath,this.uniforms.mapKdWidth,this.uniforms.mapKdHeight),this.description.map_kd=e}},{key:"setBaseColorPercentage",value:function(e){var t=n.SelfHelperFunctions.getFloatStringPair(e);t&&(this.uniforms.baseColorPercentage.value=t.f,this.description.baseColorPercentage=t.s)}},{key:"getMetallic",value:function(){return{value:this.uniforms.metallic.value}}},{key:"getRoughness",value:function(){return{value:this.uniforms.perceptualRoughness.value}}},{key:"getSpecularF0",value:function(){return{value:this.uniforms.f0.value}}},{key:"getBaseColor",value:function(){return{color:this.array2Hex(this.uniforms.kd.value),textureUsed:this.uniforms.mapKdUsed.value,texturePath:this.uniforms.mapKdPath.value,percentage:this.uniforms.baseColorPercentage.value}}},{key:"array2Hex",value:function(e){return"#"+Math.round(255*e[0]).toString(16)+Math.round(255*e[1]).toString(16)+Math.round(255*e[2]).toString(16)}},{key:"clone",value:function(){return new this.constructor(this.description)}}]),t}();t.default=u,e.exports=t.default},i=[e,t,r(0),r(14),r(8)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={uniforms:{fz:{type:"f",value:5},c_limit:{type:"f",value:1},sc_limit:{type:"f",value:1},dwkr_limit:{type:"f",value:2e-4},limit:{type:"f",value:1}},vertexShader:"\n// Object Space Suggestive Contours vertex shader\n// Jeroen Baert - www.forceflow.be\n\nattribute vec3 pdir1;\nattribute vec3 pdir2;\nattribute float curv1;\nattribute float curv2;\nattribute vec4 dcurv;\n\n// OUT: variables for fragment shader\nvarying float ndotv;\nvarying float kr;\nvarying float dwkr2;\n\nvarying float contoursZeroCrossingParas;\n\nuniform float fz;\n\nvoid main()\n{\n  // attributes parameters should be precalculated and put in attributes of BufferGeometry\n  // without transformation, it will be view-independent and relatively clean\n  // vec3 modelPosition = position;\n  // vec3 unitNormal = normalize(normal);\n  // vec3 modelpdir1 = normalize(pdir1);\n  // vec3 modelpdir2 = normalize(pdir2);\n\n  // after transformation, it will be relative dirty and view-dependent\n  vec3 modelPosition = (modelViewMatrix * vec4(position, 1.0)).xyz;\n  vec3 unitNormal = normalize(normalMatrix * normal);\n  vec3 modelpdir1 = normalize(normalMatrix * pdir1);\n  vec3 modelpdir2 = normalize(normalMatrix * pdir2);\n\n  // compute vector to camera\n  vec3 view = normalize(cameraPosition - modelPosition);\n\n  // compute ndotv (and normalize view)\n  ndotv = dot(unitNormal,view);\n\n  contoursZeroCrossingParas = 1.0;\n\n  // optimalisation: if this vector points away from cam, don't even bother computing the rest.\n  // the data will not be used in computing pixel color\n  if(!(ndotv < 0.0))\n  {\n    // compute kr\n    vec3 w = normalize(view - unitNormal * dot(view, unitNormal));\n    float u = dot(w, normalize(modelpdir1));\n    float v = dot(w, normalize(modelpdir2));\n    float u2 = u*u;\n    float v2 = v*v;\n    float t_kr = (curv1*u2) + (curv2*v2);\n    // and dwkr\n    float uv = u*v;\n    float dwII = (u2*u*dcurv.x) + (3.0*u*uv*dcurv.y) + (3.0*uv*v*dcurv.z) + (v*v2*dcurv.w);\n    // extra term due to second derivative\n    float t_dwkr = dwII + 2.0 * curv1 * curv2 * ndotv/sqrt((1.0 - pow(ndotv, 2.0)));\n\n    // use feature size\n    kr = fz*(t_kr); // absolute value to use it in limits\n    float dwkr = fz*fz*t_dwkr; // two times fz because derivative\n    dwkr2 = (dwkr-dwkr*pow(ndotv, 2.0)) / length(w);\n\n    if(kr>0.0){\n      contoursZeroCrossingParas = 1.0;\n    }else if(kr<0.0){\n      contoursZeroCrossingParas = -1.0;\n    }else{\n      contoursZeroCrossingParas = 0.0;\n    }\n  }\n\n  // position transformation\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n} \n",fragmentShader:"\n// Object Space Suggestive Contours vertex shader\n// Jeroen Baert - www.forceflow.be\n\n// IN: computed values from vertex shader\nvarying float ndotv;\nvarying float kr;\nvarying float dwkr2;\n\nvarying float contoursZeroCrossingParas;\n\n// IN: uniform values\nuniform float dwkr_limit;\nuniform float limit;\nuniform float c_limit;\nuniform float sc_limit;\n\nvoid main()\n{\n  // base color\n  vec4 color = vec4(1.0); \n  \n  if(ndotv<0.0){\n    gl_FragColor = color;\n  }else{\n    if(contoursZeroCrossingParas<1.0 && contoursZeroCrossingParas>-1.0){\n      // compute limits\n      float contour_limit = c_limit*(pow(ndotv, 2.0)/(kr));\n      float sucontour_limit = sc_limit*((kr)/dwkr2);\n      contour_limit = abs(contour_limit);\n      sucontour_limit = abs(sucontour_limit);\n\n      // contours\n      if(contour_limit<limit)\n      {\n        color.xyz = min(color.xyz, vec3(contour_limit, contour_limit, contour_limit));\n      }\n      // suggestive contours\n      if((sucontour_limit<limit) && dwkr2>dwkr_limit)\n      {\n        color.xyz = min(color.xyz, vec3(sucontour_limit, sucontour_limit, sucontour_limit));\n      }\n    }\n\n    gl_FragColor = color;\n  }\n} \n"},i=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.uniforms=JSON.parse(JSON.stringify(n.uniforms)),r.vertexShader=n.vertexShader,r.fragmentShader=n.fragmentShader,r.extensions.derivatives=!0,r.transparent=!0,e.name&&(r.name=e.name),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.ShaderMaterial),t}();t.default=i,e.exports=t.default},i=[e,t,r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.positions=null,this.faces=null,this.verticesNumber=0,this.facesNumber=0,this.pointareas=null,this.cornerareas=null,this.pdir1=null,this.pdir2=null,this.curv1=null,this.curv2=null,this.dcurv=null,this.bufferGeometry=null,this.calculated=!1}return i(e,[{key:"calculateForGeometry",value:function(e){var t=(new Date).getTime();console.log("Calculation Start..."),this.initForGeometry(e),this.compute(),this.bufferGeometry=(new r.BufferGeometry).fromGeometry(e),this.addToBufferGeometry(this.bufferGeometry),t=(new Date).getTime()-t,console.log("Calculation Done, total time (in milliseconds): ",t),this.calculated=!0}},{key:"doCurvaturesSmoothing",value:function(){if(this.calculated){for(var e=new Array(this.verticesNumber),t=new Array(this.verticesNumber),r=new Array(this.verticesNumber),n=new Array(this.verticesNumber),i=0;i<this.verticesNumber;++i)r[i]=1,n[i]=1,e[i]=this.curv1[i],t[i]=this.curv2[i];for(var o=0;o<this.facesNumber;++o){var a=this.faces[o];e[a.a]+=this.curv1[a.b]+this.curv1[a.c],e[a.b]+=this.curv1[a.a]+this.curv1[a.c],e[a.c]+=this.curv1[a.a]+this.curv1[a.b],t[a.a]+=this.curv2[a.b]+this.curv2[a.c],t[a.b]+=this.curv2[a.a]+this.curv2[a.c],t[a.c]+=this.curv2[a.a]+this.curv2[a.b],r[a.a]+=2,r[a.b]+=2,r[a.c]+=2,n[a.a]+=2,n[a.b]+=2,n[a.c]+=2}for(var s=0;s<this.verticesNumber;++s)e[s]/=r[s],t[s]/=n[s];this.curv1=e,this.curv2=t}}},{key:"getBufferGeometry",value:function(){return this.bufferGeometry}},{key:"initForGeometry",value:function(e){this.clearCalculator(),e.computeVertexNormals(!0),this.positions=e.vertices,this.faces=e.faces,this.verticesNumber=this.positions.length,this.facesNumber=this.faces.length,this.pointareas=new Array(this.verticesNumber);for(var t=0;t<this.verticesNumber;++t)this.pointareas[t]=0;this.cornerareas=new Array(this.facesNumber);for(var n=0;n<this.facesNumber;++n)this.cornerareas[n]=[0,0,0];this.pdir1=new Array(this.verticesNumber);for(var i=0;i<this.verticesNumber;++i)this.pdir1[i]=new r.Vector3;this.pdir2=new Array(this.verticesNumber);for(var o=0;o<this.verticesNumber;++o)this.pdir2[o]=new r.Vector3;this.curv1=new Array(this.verticesNumber);for(var a=0;a<this.verticesNumber;++a)this.curv1[a]=0;this.curv2=new Array(this.verticesNumber);for(var s=0;s<this.verticesNumber;++s)this.curv2[s]=0;this.dcurv=new Array(this.verticesNumber);for(var l=0;l<this.verticesNumber;++l)this.dcurv[l]=[0,0,0,0]}},{key:"compute",value:function(){this.needPointareas(),this.needCurvatures(),this.needDcurv()}},{key:"addToBufferGeometry",value:function(e){for(var t=3*this.facesNumber,n=new Float32Array(3*t),i=new Float32Array(3*t),o=new Float32Array(t),a=new Float32Array(t),s=new Float32Array(4*t),l=0;l<this.facesNumber;++l)for(var u=this.faces[l],c=0;c<3;++c){var h=u.a;0===c?h=u.a:1===c?h=u.b:2===c&&(h=u.c),n[3*l*3+3*c]=this.pdir1[h].x,n[3*l*3+3*c+1]=this.pdir1[h].y,n[3*l*3+3*c+2]=this.pdir1[h].z,i[3*l*3+3*c]=this.pdir2[h].x,i[3*l*3+3*c+1]=this.pdir2[h].y,i[3*l*3+3*c+2]=this.pdir2[h].z,o[3*l+c]=this.curv1[h],a[3*l+c]=this.curv2[h],s[3*l*4+4*c]=this.dcurv[h][0],s[3*l*4+4*c+1]=this.dcurv[h][1],s[3*l*4+4*c+2]=this.dcurv[h][2],s[3*l*4+4*c+3]=this.dcurv[h][3]}e.addAttribute("pdir1",new r.BufferAttribute(n,3)),e.addAttribute("pdir2",new r.BufferAttribute(i,3)),e.addAttribute("curv1",new r.BufferAttribute(o,1)),e.addAttribute("curv2",new r.BufferAttribute(a,1)),e.addAttribute("dcurv",new r.BufferAttribute(s,4))}},{key:"clearCalculator",value:function(){this.positions=null,this.faces=null,this.verticesNumber=0,this.facesNumber=0,this.pointareas=null,this.cornerareas=null,this.pdir1=null,this.pdir2=null,this.curv1=null,this.curv2=null,this.dcurv=null}},{key:"ldltdc",value:function(e,t){for(var r=n(e,2),i=r[0],o=r[1],a=new Array(t-1),s=0;s<t-1;s++)a[s]=0;for(var l=0;l<t;l++){for(var u=0;u<l;u++)a[u]=i[l][u]*o[u];for(var c=l;c<t;c++){for(var h=i[l][c],f=0;f<l;f++)h-=a[f]*i[c][f];if(l===c){if(h<=0)return[!1,i,o];o[l]=1/h}else i[c][l]=h}}return[!0,i,o]}},{key:"ldltsl",value:function(e,t,r,n,i){for(var o=0;o<i;o++){for(var a=r[o],s=0;s<o;s++)a-=e[o][s]*n[s];n[o]=a*t[o]}for(var l=i-1;l>=0;l--){for(var u=0,c=l+1;c<i;c++)u+=e[c][l]*n[c];n[l]-=u*t[l]}return n}},{key:"rotCoordSys",value:function(e){var t=n(e,5),r=t[0],i=t[1],o=t[2],a=t[3],s=t[4];a=r.clone(),s=i.clone();var l=r.clone().cross(i),u=l.clone().dot(o);if(u<=-1)return s=s.clone().multiplyScalar(-1),[r,i,o,a=a.clone().multiplyScalar(-1),s];var c=o.clone().sub(l.clone().multiplyScalar(u)),h=l.clone().add(o.clone()).multiplyScalar(1/(1+u));return[r,i,o,a=a.clone().sub(h.clone().multiplyScalar(a.clone().dot(c))),s=s.clone().sub(h.clone().multiplyScalar(s.clone().dot(c)))]}},{key:"projCurv",value:function(e,t,i,o,a){var s=n(e,2),l=s[0],u=s[1],c=n(a,5),h=c[0],f=c[1],d=(c[2],c[3],c[4],new r.Vector3),p=new r.Vector3,m=this.rotCoordSys([h,f,l.clone().cross(u),d,p]);h=m[0],f=m[1],d=m[3],p=m[4];var v=d.clone().dot(l),g=d.clone().dot(u),y=p.clone().dot(l),_=p.clone().dot(u);return[l,u,h,f,t*v*v+i*(2*v*g)+o*g*g,t*v*y+i*(v*_+y*g)+o*g*_,t*y*y+i*(2*y*_)+o*_*_]}},{key:"projDcurv",value:function(e,t,r){var i,o,a=n(e,2),s=a[0],l=a[1],u=n(r,3),c=u[0],h=u[1],f=u[2],d=this.rotCoordSys([c,h,s.clone().cross(l),i,o]);c=d[0],h=d[1],i=d[3],o=d[4];var p=i.clone().dot(s),m=i.clone().dot(l),v=o.clone().dot(s),g=o.clone().dot(l);return f[0]=t[0]*p*p*p+3*t[1]*p*p*m+3*t[2]*p*m*m+t[3]*m*m*m,f[1]=t[0]*p*p*v+t[1]*(p*p*g+2*v*p*m)+t[2]*(v*m*m+2*p*m*g)+t[3]*m*m*g,f[2]=t[0]*p*v*v+t[1]*(v*v*m+2*p*v*g)+t[2]*(p*g*g+2*v*g*m)+t[3]*m*g*g,f[3]=t[0]*v*v*v+3*t[1]*v*v*g+3*t[2]*v*g*g+t[3]*g*g*g,[s,l,c,h,f]}},{key:"diagonalizeCurv",value:function(e,t,r,i,o){var a,s,l=n(e,2),u=l[0],c=l[1],h=n(o,5),f=h[0],d=h[1],p=(h[2],h[3]),m=h[4],v=this.rotCoordSys([u,c,f,a,s]),g=n(v,5);u=g[0],c=g[1],f=g[2],a=g[3],s=g[4];var y=1,_=0,w=0;if(0!==r){var b=.5*(i-t)/r;_=(w=b<0?1/(b-Math.sqrt(1+b*b)):1/(b+Math.sqrt(1+b*b)))*(y=1/Math.sqrt(1+w*w))}if(p=t-w*r,m=i+w*r,Math.abs(p)>=Math.abs(m))d=a.clone().multiplyScalar(y).sub(s.clone().multiplyScalar(_));else{var x=p;p=m,m=x,d=a.clone().multiplyScalar(_).add(s.clone().multiplyScalar(y))}return[u,c,f,d,f.clone().cross(d),p,m]}},{key:"needCurvatures",value:function(){console.log("Computing curvatures...");for(var e=new Array(this.verticesNumber),t=0;t<this.verticesNumber;++t)e[t]=0;for(var r=0;r<this.facesNumber;++r){var n=this.faces[r];this.pdir1[n.a]=this.positions[n.b].clone().sub(this.positions[n.a]),this.pdir1[n.b]=this.positions[n.c].clone().sub(this.positions[n.b]),this.pdir1[n.c]=this.positions[n.a].clone().sub(this.positions[n.c])}for(var i=0;i<this.facesNumber;++i){var o=this.faces[i],a=o.vertexNormals[0],s=o.vertexNormals[1],l=o.vertexNormals[2];this.pdir1[o.a]=this.pdir1[o.a].clone().cross(a),this.pdir1[o.a].normalize(),this.pdir2[o.a]=a.clone().cross(this.pdir1[o.a]),this.pdir1[o.b]=this.pdir1[o.b].clone().cross(s),this.pdir1[o.b].normalize(),this.pdir2[o.b]=s.clone().cross(this.pdir1[o.b]),this.pdir1[o.c]=this.pdir1[o.c].clone().cross(l),this.pdir1[o.c].normalize(),this.pdir2[o.c]=l.clone().cross(this.pdir1[o.c])}for(var u=0;u<this.facesNumber;++u){var c=this.faces[u],h=[this.positions[c.c].clone().sub(this.positions[c.b]),this.positions[c.a].clone().sub(this.positions[c.c]),this.positions[c.b].clone().sub(this.positions[c.a])],f=h[0];f.normalize();var d=h[0].clone().cross(h[1]).clone().cross(f);d.normalize();for(var p=[0,0,0],m=[[0,0,0],[0,0,0],[0,0,0]],v=0;v<3;++v){var g=h[v].clone().dot(f),y=h[v].clone().dot(d);m[0][0]+=g*g,m[0][1]+=g*y,m[2][2]+=y*y;var _=v>0?v-1:v+2,w=v<2?v+1:v-2,b=c.vertexNormals[_].clone().sub(c.vertexNormals[w]),x=b.clone().dot(f),k=b.clone().dot(d);p[0]+=x*g,p[1]+=x*y+k*g,p[2]+=k*y}m[1][1]=m[0][0]+m[2][2],m[1][2]=m[0][1];var A,M=[0,0,0],S=this.ldltdc([m,M],3);if(A=S[0],m=S[1],M=S[2],A){var P=[p[0],p[1],p[2]];p=this.ldltsl(m,M,P,p,3);for(var T=0;T<3;++T){var O=c.a;0===T?O=c.a:1===T?O=c.b:2===T&&(O=c.c);var C=0,E=0,I=0,R=this.pdir1[O].clone(),L=this.pdir2[O].clone(),j=this.projCurv([f,d],p[0],p[1],p[2],[R,L,C,E,I]);f=j[0],d=j[1],R=j[2],L=j[3],C=j[4],E=j[5],I=j[6],this.pdir1[O]=R,this.pdir2[O]=L;var z=this.cornerareas[u][T]/this.pointareas[O];this.curv1[O]+=z*C,e[O]+=z*E,this.curv2[O]+=z*I}}else console.log("Fail to ldltdc!")}for(var B=0;B<this.facesNumber;++B)for(var D=this.faces[B],N=0;N<3;++N){var U=D.vertexNormals[N],F=D.a;0===N?F=D.a:1===N?F=D.b:2===N&&(F=D.c);var H=this.diagonalizeCurv([this.pdir1[F],this.pdir2[F]],this.curv1[F],e[F],this.curv2[F],[U,this.pdir1[F],this.pdir2[F],this.curv1[F],this.curv2[F]]);this.pdir1[F]=H[0],this.pdir2[F]=H[1],U=H[2],this.pdir1[F]=H[3],this.pdir2[F]=H[4],this.curv1[F]=H[5],this.curv2[F]=H[6]}console.log("Done...")}},{key:"needDcurv",value:function(){console.log("Computing dcurv...");for(var e=0;e<this.facesNumber;++e){var t=this.faces[e],r=[this.positions[t.c].clone().sub(this.positions[t.b]),this.positions[t.a].clone().sub(this.positions[t.c]),this.positions[t.b].clone().sub(this.positions[t.a])],n=r[0];n.normalize();var i=r[0].clone().cross(r[1]).clone().cross(n);i.normalize();for(var o=[[0,0,0],[0,0,0],[0,0,0]],a=0;a<3;++a){var s=t.a;0===a?s=t.a:1===a?s=t.b:2===a&&(s=t.c);var l=this.projCurv([this.pdir1[s],this.pdir2[s]],this.curv1[s],0,this.curv2[s],[n,i,o[a][0],o[a][1],o[a][2]]);this.pdir1[s]=l[0],this.pdir2[s]=l[1],n=l[2],i=l[3],o[a][0]=l[4],o[a][1]=l[5],o[a][2]=l[6]}for(var u=[0,0,0,0],c=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],h=0;h<3;++h){for(var f=h>0?h-1:h+2,d=h<2?h+1:h-2,p=[0,0,0],m=0;m<3;++m)p[m]=o[f][m]-o[d][m];var v=r[h].clone().dot(n),g=r[h].clone().dot(i),y=v*v,_=g*g,w=v*g;c[0][0]+=y,c[0][1]+=w,c[3][3]+=_,u[0]+=v*p[0],u[1]+=g*p[0]+2*v*p[1],u[2]+=2*g*p[1]+v*p[2],u[3]+=g*p[2]}c[1][1]=2*c[0][0]+c[3][3],c[1][2]=2*c[0][1],c[2][2]=c[0][0]+2*c[3][3],c[2][3]=c[0][1];var b,x=[0,0,0,0],k=this.ldltdc([c,x],4);if(b=k[0],c=k[1],x=k[2],b)for(var A=[u[0],u[1],u[2],u[3]],M=[(u=this.ldltsl(c,x,A,u,4))[0],u[1],u[2],u[3]],S=0;S<3;++S){var P=t.a;0===S?P=t.a:1===S?P=t.b:2===S&&(P=t.c);var T=[0,0,0,0],O=this.projDcurv([n,i],M,[this.pdir1[P],this.pdir2[P],T]);n=O[0],i=O[1],this.pdir1[P]=O[2],this.pdir2[P]=O[3],T=O[4];for(var C=this.cornerareas[e][S]/this.pointareas[P],E=0;E<4;++E)this.dcurv[P][E]+=C*T[E]}else console.log("Fail to ldltdc!")}console.log("Done...")}},{key:"needPointareas",value:function(){console.log("Computing pointareas...");for(var e=0;e<this.facesNumber;++e){var t=this.faces[e],r=[this.positions[t.c].clone().sub(this.positions[t.b]),this.positions[t.a].clone().sub(this.positions[t.c]),this.positions[t.b].clone().sub(this.positions[t.a])],n=.5*r[0].clone().cross(r[1]).length(),i=[r[0].clone().lengthSq(),r[1].clone().lengthSq(),r[2].clone().lengthSq()],o=[i[0]*(i[1]+i[2]-i[0]),i[1]*(i[2]+i[0]-i[1]),i[2]*(i[0]+i[1]-i[2])];if(o[0]<=0)this.cornerareas[e][1]=-.25*i[2]*n/r[0].clone().dot(r[2]),this.cornerareas[e][2]=-.25*i[1]*n/r[0].clone().dot(r[1]),this.cornerareas[e][0]=n-this.cornerareas[e][1]-this.cornerareas[e][2];else if(o[1]<=0)this.cornerareas[e][2]=-.25*i[0]*n/r[1].clone().dot(r[0]),this.cornerareas[e][0]=-.25*i[2]*n/r[1].clone().dot(r[2]),this.cornerareas[e][1]=n-this.cornerareas[e][0]-this.cornerareas[e][2];else if(o[2]<=0)this.cornerareas[e][0]=-.25*i[1]*n/r[2].clone().dot(r[1]),this.cornerareas[e][1]=-.25*i[0]*n/r[2].clone().dot(r[0]),this.cornerareas[e][2]=n-this.cornerareas[e][0]-this.cornerareas[e][1];else for(var a=.5*n/(o[0]+o[1]+o[2]),s=0;s<3;++s)this.cornerareas[e][s]=a*(o[(s+1)%3]+o[(s+2)%3]);this.pointareas[t.a]+=this.cornerareas[e][0],this.pointareas[t.b]+=this.cornerareas[e][1],this.pointareas[t.c]+=this.cornerareas[e][2]}console.log("Done...")}}]),e}();t.default=o,e.exports=t.default},i=[e,t,r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r.EarthBasic.GeoCoord;t.default=n,e.exports=t.default},i=[e,t,r(4)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.addMTLOBJ=function(e){if(!function(){if("string"!=typeof e.objUrl||e.objUrl.length<=0)return r&&console.warn("[addMTLOBJ] Invalid obj url",e.objUrl),!1;var n={mtlUrl:"",upDir:new t.Vector3(0,0,1),center:!0,scale:1};try{e=Object.assign({},n,e)}catch(t){return r&&console.warn("[addMTLOBJ] read loadOptions failed",e),!1}void 0===e.upDir||void 0===e.upDir.x||void 0===e.upDir.y||void 0===e.upDir.z?e.upDir=new t.Vector3(0,0,1):e.upDir.normalize();return!0}())return Promise.reject(new Error("Invalid loadOptions"));var r=!1;return new Promise(function(n,a){var s=new o.default;s.setCrossOrigin("anonymous");var l=e.mtlUrl;s.load(e.objUrl,l,function(r){void 0!==r&&null!==r||a(new Error("empty"));for(var o=new t.Group,s=0;s<r.children.length;s++){var l=r.children[s],u=l.geometry.attributes.position?l.geometry.attributes.position.count:0;u>0?(o.add(l),s--):(l.geometry.dispose(),l.material.map&&l.material.map.dispose(),l.material.dispose())}r=o;var c=new t.Matrix4,h=new t.BoxHelper(r,16776960);h.geometry.computeBoundingBox();var f=new t.BoxGeometry(h.geometry.boundingBox.max.x-h.geometry.boundingBox.min.x,h.geometry.boundingBox.max.y-h.geometry.boundingBox.min.y,h.geometry.boundingBox.max.z-h.geometry.boundingBox.min.z),d=new t.Vector3;h.geometry.boundingBox.getCenter(d),c.makeTranslation(d.x,d.y,d.z),f.applyMatrix(c);var p=new t.MeshBasicMaterial({color:16776960,wireframe:!0}),m=new t.Mesh(f,p),v=new t.Group;v.add(r),e.center&&(c.makeTranslation(-d.x,-d.y,-d.z),v.applyMatrix(c));var g=new t.Vector3(0,0,1),y=e.upDir.clone().normalize();if(!y.equals(g)){var _=y.cross(g),w=y.angleTo(g);c.makeRotationAxis(_,w),v.applyMatrix(c)}y=e.upDir.normalize();var b=void 0;b=y.x>=y.y?y.x>=y.z?"x":"z":y.y>=y.z?"y":"z";var x=(h.geometry.boundingBox.max[b]-h.geometry.boundingBox.min[b])/2;c.makeTranslation(0,0,x),v.applyMatrix(c);var k=new t.Vector3;h.geometry.boundingBox.getSize(k);var A=Math.max(k.x,k.z,k.y),M=4/A,S=i.default.scale/i.default.EARTH_RADIUS*M;c.makeScale(S,S,S),v.applyMatrix(c),m.applyMatrix(v.matrix),v.objSpaceBBox=m,n(v)},function(e){r&&console.log(e);if(e.lengthComputable){var t=e.loaded/e.total*100;r&&console.log(Math.round(t,2)+"% downloaded")}},function(e){a(e)})})};var i=a(r),o=a(n);function a(e){return e&&e.__esModule?e:{default:e}}},i=[t,r(0),r(1),r(79)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=c(n),l=c(i),u=c(o);function c(e){return e&&e.__esModule?e:{default:e}}var h=function(e){this.manager=void 0!==e?e:r.DefaultLoadingManager,this.pendingMesh=[]};h.prototype={constructor:h,load:function(e,t,n,i,o){var c=this,h=new s.default(this.manager);h.setBaseUrl(t.substr(0,t.lastIndexOf("/")+1)),h.setCrossOrigin(this.crossOrigin),h.load(t,function(t){var i=t;i.preload(),(0,u.default)({method:"get",url:e}).then(function(e){var t=0,o=new a;o.onmessage=function(e){if(e.data.isFinish){var a=new r.Group;c.pendingMesh.map(function(e){a.add(e)}),n(a),c.pendingMesh=[],o.terminate()}else{var s=e.data.mesh,u=function(e){var t=new r.BufferGeometry;t.addAttribute("position",new r.BufferAttribute(e.geometry.position,e.geometry.positionItemSize)),e.geometry.uv.length>0&&t.addAttribute("uv",new r.BufferAttribute(e.geometry.uv,e.geometry.uvItemSize));e.geometry.normal.length>0&&t.addAttribute("normal",new r.BufferAttribute(e.geometry.normal,e.geometry.normalItemSize));return t}(s),h=s.meshName,f=s.materialName,d="material"+t;t+=1,f=f||d;var p=i.create(f);(p=p||new l.default({name:f})).name=f;var m=new r.Mesh(u,p);h&&(m.name=h);var v={name:f,ka:p.uniforms.ka.value,kd:p.uniforms.kd.value,ks:p.uniforms.ks.value,map_kd:p.uniforms.mapKdPath.value,ns:p.uniforms.ns.value,bump:p.uniforms.bumpMapPath.value,d:p.uniforms.d.value};m.mtlParams=v,c.pendingMesh.push(m)}},o.onerror=function(e){console.warn("Worker runtime error",e.message)};var s={data:e.data};o.postMessage(s)}).catch(function(e){console.error("OBJMTLLoader",e),n()})},i,o)},setCrossOrigin:function(e){this.crossOrigin=e}},t.default=h,e.exports=t.default},i=[e,t,r(0),r(80),r(15),r(9),r(81)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=s(n),a=s(i);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(e){this.manager=void 0!==e?e:r.DefaultLoadingManager};l.prototype={constructor:l,load:function(e,t,r,n){var i=this;(0,a.default)({method:"get",url:e}).then(function(e){t(i.parse(e.data))}).catch(function(e){t(i.parse(""))})},setBaseUrl:function(e){this.baseUrl=e},setCrossOrigin:function(e){this.crossOrigin=e},setMaterialOptions:function(e){this.materialOptions=e},parse:function(e){for(var t=e.split("\n"),r={},n=/\s+/,i={},o=0;o<t.length;o++){var a=t[o];if(0!==(a=a.trim()).length&&"#"!==a.charAt(0)){var s=a.indexOf(" "),u=s>=0?a.substring(0,s):a;u=u.toLowerCase();var c=s>=0?a.substring(s+1):"";if(c=c.trim(),"newmtl"===u)r={name:c},i[c]=r;else if(r)if("ka"===u||"kd"===u||"ks"===u){var h=c.split(n,3);r[u]=[parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])]}else r[u]=c}}var f=new l.MaterialCreator(this.baseUrl,this.materialOptions);return f.setCrossOrigin(this.crossOrigin),f.setManager(this.manager),f.setMaterials(i),f}},(l.MaterialCreator=function(e,t){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:r.DoubleSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:r.RepeatWrapping}).prototype={constructor:l.MaterialCreator,setCrossOrigin:function(e){this.crossOrigin=e},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var r in e){var n=e[r],i={};for(var o in t[r]=i,n){var a=!0,s=n[o],l=o.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[1]&&(a=!1);break;case"d":this.options&&this.options.invertTransparency&&(s=1-s)}a&&(i[l]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this.materialsInfo[e],n={name:e,side:this.side},i={name:e,side:this.side};for(var a in t){var s=t[a];switch(a.toLowerCase()){case"kd":n.color=(new r.Color).fromArray(s),i.kd=s.slice(0,3);break;case"ka":s,i.ka=s.slice(0,3);break;case"ks":n.specular=(new r.Color).fromArray(s),i.ks=s.slice(0,3);break;case"map_kd":n.map=this.loadTexture(this.baseUrl+s),n.map.wrapS=r.RepeatWrapping,n.map.wrapT=r.RepeatWrapping,i.map_kd=this.baseUrl+s;break;case"ns":n.shininess=parseFloat(s),i.ns=parseFloat(s);break;case"d":s<1&&(n.transparent=!0,n.opacity=s,i.d=s);break;case"map_bump":case"bump":if(n.bumpMap)break;void 0!==s&&""!==s&&(n.bumpMap=this.loadTexture(this.baseUrl+s),n.bumpMap.wrapS=this.wrap,n.bumpMap.wrapT=this.wrap,i.bump=this.baseUrl+s)}}return this.materials[e]=new o.default(i),this.materials[e]},loadTexture:function(e,t,n,i,o){var a,s=r.Loader.Handlers.get(e),u=void 0!==this.manager?this.manager:r.DefaultLoadingManager;return null!==s?a=s.load(e,n):(a=new r.Texture,(s=new r.ImageLoader(u)).setCrossOrigin(this.crossOrigin),s.load(e,function(e){a.image=l.ensurePowerOfTwo_(e),a.needsUpdate=!0,n&&n(a)},i,o)),void 0!==t&&(a.mapping=t),a}},l.ensurePowerOfTwo_=function(e){if(!r.Math.isPowerOfTwo(e.width)||!r.Math.isPowerOfTwo(e.height)){var t=document.createElement("canvas");return t.width=l.nextHighestPowerOfTwo_(e.width),t.height=l.nextHighestPowerOfTwo_(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t}return e},l.nextHighestPowerOfTwo_=function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},t.default=l,e.exports=t.default},i=[e,t,r(0),r(15),r(9)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){e.exports=function(){return r(11)('!function(t){var n={};function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=6)}([function(t,n,e){"use strict";var i=e(1),o=function(t,n){this.name="PointError",this.points=n=n||[],this.message=t||"Invalid Points!";for(var e=0;e<n.length;e++)this.message+=" "+i.toString(n[e])};(o.prototype=new Error).constructor=o,t.exports=o},function(t,n,e){"use strict";function i(t){return"("+t.x+";"+t.y+")"}t.exports={toString:function(t){var n=t.toString();return"[object Object]"===n?i(t):n},toStringBase:i,compare:function(t,n){return t.y===n.y?t.x-n.x:t.y-n.y},equals:function(t,n){return t.x===n.x&&t.y===n.y}}},function(t,n,e){"use strict";var i=function(t,n,e){this.points_=[t,n,e],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},o=e(1).toString;i.prototype.toString=function(){return"["+o(this.points_[0])+o(this.points_[1])+o(this.points_[2])+"]"},i.prototype.getPoint=function(t){return this.points_[t]},i.prototype.GetPoint=i.prototype.getPoint,i.prototype.getPoints=function(){return this.points_},i.prototype.getNeighbor=function(t){return this.neighbors_[t]},i.prototype.containsPoint=function(t){var n=this.points_;return t===n[0]||t===n[1]||t===n[2]},i.prototype.containsEdge=function(t){return this.containsPoint(t.p)&&this.containsPoint(t.q)},i.prototype.containsPoints=function(t,n){return this.containsPoint(t)&&this.containsPoint(n)},i.prototype.isInterior=function(){return this.interior_},i.prototype.setInterior=function(t){return this.interior_=t,this},i.prototype.markNeighborPointers=function(t,n,e){var i=this.points_;if(t===i[2]&&n===i[1]||t===i[1]&&n===i[2])this.neighbors_[0]=e;else if(t===i[0]&&n===i[2]||t===i[2]&&n===i[0])this.neighbors_[1]=e;else{if(!(t===i[0]&&n===i[1]||t===i[1]&&n===i[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=e}},i.prototype.markNeighbor=function(t){var n=this.points_;t.containsPoints(n[1],n[2])?(this.neighbors_[0]=t,t.markNeighborPointers(n[1],n[2],this)):t.containsPoints(n[0],n[2])?(this.neighbors_[1]=t,t.markNeighborPointers(n[0],n[2],this)):t.containsPoints(n[0],n[1])&&(this.neighbors_[2]=t,t.markNeighborPointers(n[0],n[1],this))},i.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},i.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},i.prototype.pointCW=function(t){var n=this.points_;return t===n[0]?n[2]:t===n[1]?n[0]:t===n[2]?n[1]:null},i.prototype.pointCCW=function(t){var n=this.points_;return t===n[0]?n[1]:t===n[1]?n[2]:t===n[2]?n[0]:null},i.prototype.neighborCW=function(t){return t===this.points_[0]?this.neighbors_[1]:t===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},i.prototype.neighborCCW=function(t){return t===this.points_[0]?this.neighbors_[2]:t===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},i.prototype.getConstrainedEdgeCW=function(t){return t===this.points_[0]?this.constrained_edge[1]:t===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},i.prototype.getConstrainedEdgeCCW=function(t){return t===this.points_[0]?this.constrained_edge[2]:t===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},i.prototype.getConstrainedEdgeAcross=function(t){return t===this.points_[0]?this.constrained_edge[0]:t===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},i.prototype.setConstrainedEdgeCW=function(t,n){t===this.points_[0]?this.constrained_edge[1]=n:t===this.points_[1]?this.constrained_edge[2]=n:this.constrained_edge[0]=n},i.prototype.setConstrainedEdgeCCW=function(t,n){t===this.points_[0]?this.constrained_edge[2]=n:t===this.points_[1]?this.constrained_edge[0]=n:this.constrained_edge[1]=n},i.prototype.getDelaunayEdgeCW=function(t){return t===this.points_[0]?this.delaunay_edge[1]:t===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},i.prototype.getDelaunayEdgeCCW=function(t){return t===this.points_[0]?this.delaunay_edge[2]:t===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},i.prototype.setDelaunayEdgeCW=function(t,n){t===this.points_[0]?this.delaunay_edge[1]=n:t===this.points_[1]?this.delaunay_edge[2]=n:this.delaunay_edge[0]=n},i.prototype.setDelaunayEdgeCCW=function(t,n){t===this.points_[0]?this.delaunay_edge[2]=n:t===this.points_[1]?this.delaunay_edge[0]=n:this.delaunay_edge[1]=n},i.prototype.neighborAcross=function(t){return t===this.points_[0]?this.neighbors_[0]:t===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},i.prototype.oppositePoint=function(t,n){var e=t.pointCW(n);return this.pointCW(e)},i.prototype.legalize=function(t,n){var e=this.points_;if(t===e[0])e[1]=e[0],e[0]=e[2],e[2]=n;else if(t===e[1])e[2]=e[1],e[1]=e[0],e[0]=n;else{if(t!==e[2])throw new Error("poly2tri Invalid Triangle.legalize() call");e[0]=e[2],e[2]=e[1],e[1]=n}},i.prototype.index=function(t){var n=this.points_;if(t===n[0])return 0;if(t===n[1])return 1;if(t===n[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},i.prototype.edgeIndex=function(t,n){var e=this.points_;if(t===e[0]){if(n===e[1])return 2;if(n===e[2])return 1}else if(t===e[1]){if(n===e[2])return 0;if(n===e[0])return 2}else if(t===e[2]){if(n===e[0])return 1;if(n===e[1])return 0}return-1},i.prototype.markConstrainedEdgeByIndex=function(t){this.constrained_edge[t]=!0},i.prototype.markConstrainedEdgeByEdge=function(t){this.markConstrainedEdgeByPoints(t.p,t.q)},i.prototype.markConstrainedEdgeByPoints=function(t,n){var e=this.points_;n===e[0]&&t===e[1]||n===e[1]&&t===e[0]?this.constrained_edge[2]=!0:n===e[0]&&t===e[2]||n===e[2]&&t===e[0]?this.constrained_edge[1]=!0:(n===e[1]&&t===e[2]||n===e[2]&&t===e[1])&&(this.constrained_edge[0]=!0)},t.exports=i},function(t,n,e){"use strict";var i=e(1),o=function(t,n){this.x=+t||0,this.y=+n||0,this._p2t_edge_list=null};o.prototype.toString=function(){return i.toStringBase(this)},o.prototype.toJSON=function(){return{x:this.x,y:this.y}},o.prototype.clone=function(){return new o(this.x,this.y)},o.prototype.set_zero=function(){return this.x=0,this.y=0,this},o.prototype.set=function(t,n){return this.x=+t||0,this.y=+n||0,this},o.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},o.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},o.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},o.prototype.mul=function(t){return this.x*=t,this.y*=t,this},o.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},o.prototype.normalize=function(){var t=this.length();return this.x/=t,this.y/=t,t},o.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},o.negate=function(t){return new o(-t.x,-t.y)},o.add=function(t,n){return new o(t.x+n.x,t.y+n.y)},o.sub=function(t,n){return new o(t.x-n.x,t.y-n.y)},o.mul=function(t,n){return new o(t*n.x,t*n.y)},o.cross=function(t,n){return"number"==typeof t?"number"==typeof n?t*n:new o(-t*n.y,t*n.x):"number"==typeof n?new o(n*t.y,-n*t.x):t.x*n.y-t.y*n.x},o.toString=i.toString,o.compare=i.compare,o.cmp=i.compare,o.equals=i.equals,o.dot=function(t,n){return t.x*n.x+t.y*n.y},t.exports=o},function(t,n,e){"use strict";var i=e(12),o=e(0),r=e(2),s=e(5).Node,a=e(13),p=a.EPSILON,h=a.Orientation,u=a.orient2d,d=a.inScanArea,l=a.isAngleObtuse;function c(t,n){var e=t.locateNode(n),o=function(t,n,e){var i=new r(n,e.point,e.next.point);i.markNeighbor(e.triangle),t.addToMap(i);var o=new s(n);o.next=e.next,o.prev=e,e.next.prev=o,e.next=o,_(t,i)||t.mapTriangleToNodes(i);return o}(t,n,e);return n.x<=e.point.x+p&&x(t,e),function(t,n){var e=n.next;for(;e.next&&!l(e.point,e.next.point,e.prev.point);)x(t,e),e=e.next;e=n.prev;for(;e.prev&&!l(e.point,e.next.point,e.prev.point);)x(t,e),e=e.prev;n.next&&n.next.next&&function(t){var n=t.point.x-t.next.next.point.x,e=t.point.y-t.next.next.point.y;return i(e>=0,"unordered y"),n>=0||Math.abs(n)<e}(n)&&function(t,n){u(n.point,n.next.point,n.next.next.point)===h.CCW?t.basin.left_node=n.next.next:t.basin.left_node=n.next;t.basin.bottom_node=t.basin.left_node;for(;t.basin.bottom_node.next&&t.basin.bottom_node.point.y>=t.basin.bottom_node.next.point.y;)t.basin.bottom_node=t.basin.bottom_node.next;if(t.basin.bottom_node===t.basin.left_node)return;t.basin.right_node=t.basin.bottom_node;for(;t.basin.right_node.next&&t.basin.right_node.point.y<t.basin.right_node.next.point.y;)t.basin.right_node=t.basin.right_node.next;if(t.basin.right_node===t.basin.bottom_node)return;t.basin.width=t.basin.right_node.point.x-t.basin.left_node.point.x,t.basin.left_highest=t.basin.left_node.point.y>t.basin.right_node.point.y,function t(n,e){if(function(t,n){var e;e=t.basin.left_highest?t.basin.left_node.point.y-n.point.y:t.basin.right_node.point.y-n.point.y;if(t.basin.width>e)return!0;return!1}(n,e))return;x(n,e);if(e.prev===n.basin.left_node&&e.next===n.basin.right_node)return;if(e.prev===n.basin.left_node){if(u(e.point,e.next.point,e.next.next.point)===h.CW)return;e=e.next}else if(e.next===n.basin.right_node){if(u(e.point,e.prev.point,e.prev.prev.point)===h.CCW)return;e=e.prev}else e=e.prev.point.y<e.next.point.y?e.prev:e.next;t(n,e)}(t,t.basin.bottom_node)}(t,n)}(t,o),o}function f(t,n,e){t.edge_event.constrained_edge=n,t.edge_event.right=n.p.x>n.q.x,y(e.triangle,n.p,n.q)||(!function(t,n,e){t.edge_event.right?function(t,n,e){for(;e.next.point.x<n.p.x;)u(n.q,e.next.point,n.p)===h.CCW?b(t,n,e):e=e.next}(t,n,e):function(t,n,e){for(;e.prev.point.x>n.p.x;)u(n.q,e.prev.point,n.p)===h.CW?w(t,n,e):e=e.prev}(t,n,e)}(t,n,e),g(t,n.p,n.q,e.triangle,n.q))}function g(t,n,e,i,r){if(!y(i,n,e)){var s=i.pointCCW(r),a=u(e,s,n);if(a===h.COLLINEAR)throw new o("poly2tri EdgeEvent: Collinear not supported!",[e,s,n]);var p=i.pointCW(r),d=u(e,p,n);if(d===h.COLLINEAR)throw new o("poly2tri EdgeEvent: Collinear not supported!",[e,p,n]);a===d?g(t,n,e,i=a===h.CW?i.neighborCCW(r):i.neighborCW(r),r):E(t,n,e,i,r)}}function y(t,n,e){var i=t.edgeIndex(n,e);if(-1!==i){t.markConstrainedEdgeByIndex(i);var o=t.getNeighbor(i);return o&&o.markConstrainedEdgeByPoints(n,e),!0}return!1}function x(t,n){var e=new r(n.prev.point,n.point,n.next.point);e.markNeighbor(n.prev.triangle),e.markNeighbor(n.triangle),t.addToMap(e),n.prev.next=n.next,n.next.prev=n.prev,_(t,e)||t.mapTriangleToNodes(e)}function _(t,n){for(var e=0;e<3;++e)if(!n.delaunay_edge[e]){var i=n.getNeighbor(e);if(i){var o=n.getPoint(e),r=i.oppositePoint(n,o),s=i.index(r);if(i.constrained_edge[s]||i.delaunay_edge[s]){n.constrained_edge[e]=i.constrained_edge[s];continue}if(v(o,n.pointCCW(o),n.pointCW(o),r)){n.delaunay_edge[e]=!0,i.delaunay_edge[s]=!0,C(n,o,i,r);var a=!_(t,n);return a&&t.mapTriangleToNodes(n),(a=!_(t,i))&&t.mapTriangleToNodes(i),n.delaunay_edge[e]=!1,i.delaunay_edge[s]=!1,!0}}}return!1}function v(t,n,e,i){var o=t.x-i.x,r=t.y-i.y,s=n.x-i.x,a=n.y-i.y,p=o*a-s*r;if(p<=0)return!1;var h=e.x-i.x,u=e.y-i.y,d=h*r-o*u;return!(d<=0)&&(o*o+r*r)*(s*u-h*a)+(s*s+a*a)*d+(h*h+u*u)*p>0}function C(t,n,e,i){var o,r,s,a,p,h,u,d,l,c,f,g;o=t.neighborCCW(n),r=t.neighborCW(n),s=e.neighborCCW(i),a=e.neighborCW(i),p=t.getConstrainedEdgeCCW(n),h=t.getConstrainedEdgeCW(n),u=e.getConstrainedEdgeCCW(i),d=e.getConstrainedEdgeCW(i),l=t.getDelaunayEdgeCCW(n),c=t.getDelaunayEdgeCW(n),f=e.getDelaunayEdgeCCW(i),g=e.getDelaunayEdgeCW(i),t.legalize(n,i),e.legalize(i,n),e.setDelaunayEdgeCCW(n,l),t.setDelaunayEdgeCW(n,c),t.setDelaunayEdgeCCW(i,f),e.setDelaunayEdgeCW(i,g),e.setConstrainedEdgeCCW(n,p),t.setConstrainedEdgeCW(n,h),t.setConstrainedEdgeCCW(i,u),e.setConstrainedEdgeCW(i,d),t.clearNeighbors(),e.clearNeighbors(),o&&e.markNeighbor(o),r&&t.markNeighbor(r),s&&t.markNeighbor(s),a&&e.markNeighbor(a),t.markNeighbor(e)}function b(t,n,e){e.point.x<n.p.x&&(u(e.point,e.next.point,e.next.next.point)===h.CCW?m(t,n,e):(!function t(n,e,i){u(i.next.point,i.next.next.point,i.next.next.next.point)===h.CCW?m(n,e,i.next):u(e.q,i.next.next.point,e.p)===h.CCW&&t(n,e,i.next)}(t,n,e),b(t,n,e)))}function m(t,n,e){x(t,e.next),e.next.point!==n.p&&u(n.q,e.next.point,n.p)===h.CCW&&u(e.point,e.next.point,e.next.next.point)===h.CCW&&m(t,n,e)}function w(t,n,e){e.point.x>n.p.x&&(u(e.point,e.prev.point,e.prev.prev.point)===h.CW?W(t,n,e):(!function t(n,e,i){u(i.prev.point,i.prev.prev.point,i.prev.prev.prev.point)===h.CW?W(n,e,i.prev):u(e.q,i.prev.prev.point,e.p)===h.CW&&t(n,e,i.prev)}(t,n,e),w(t,n,e)))}function W(t,n,e){x(t,e.prev),e.prev.point!==n.p&&u(n.q,e.prev.point,n.p)===h.CW&&u(e.point,e.prev.point,e.prev.prev.point)===h.CW&&W(t,n,e)}function E(t,n,e,r,s){var a=r.neighborAcross(s);i(a,"FLIP failed due to missing triangle!");var p=a.oppositePoint(r,s);if(r.getConstrainedEdgeAcross(s)){var l=r.index(s);throw new o("poly2tri Intersecting Constraints",[s,p,r.getPoint((l+1)%3),r.getPoint((l+2)%3)])}d(s,r.pointCCW(s),r.pointCW(s),p)?(C(r,s,a,p),t.mapTriangleToNodes(r),t.mapTriangleToNodes(a),s===e&&p===n?e===t.edge_event.constrained_edge.q&&n===t.edge_event.constrained_edge.p&&(r.markConstrainedEdgeByPoints(n,e),a.markConstrainedEdgeByPoints(n,e),_(t,r),_(t,a)):E(t,n,e,r=function(t,n,e,i,o,r){var s;if(n===h.CCW)return s=i.edgeIndex(o,r),i.delaunay_edge[s]=!0,_(t,i),i.clearDelaunayEdges(),e;return s=e.edgeIndex(o,r),e.delaunay_edge[s]=!0,_(t,e),e.clearDelaunayEdges(),i}(t,u(e,p,n),r,a,s,p),s)):(!function t(n,e,o,r,s,a){var p=s.neighborAcross(a);i(p,"FLIP failed due to missing triangle");var h=p.oppositePoint(s,a);if(d(o,r.pointCCW(o),r.pointCW(o),h))E(n,o,h,p,h);else{var u=N(e,o,p,h);t(n,e,o,r,p,u)}}(t,n,e,r,a,N(n,e,a,p)),g(t,n,e,r,s))}function N(t,n,e,i){var r=u(n,i,t);if(r===h.CW)return e.pointCCW(i);if(r===h.CCW)return e.pointCW(i);throw new o("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[n,i,t])}n.triangulate=function(t){t.initTriangulation(),t.createAdvancingFront(),function(t){var n,e=t.pointCount();for(n=1;n<e;++n)for(var i=t.getPoint(n),o=c(t,i),r=i._p2t_edge_list,s=0;r&&s<r.length;++s)f(t,r[s],o)}(t),function(t){for(var n=t.front().head().next.triangle,e=t.front().head().next.point;!n.getConstrainedEdgeCW(e);)n=n.neighborCCW(e);t.meshClean(n)}(t)}},function(t,n,e){"use strict";var i=function(t,n){this.head_=t,this.tail_=n,this.search_node_=t};i.prototype.head=function(){return this.head_},i.prototype.setHead=function(t){this.head_=t},i.prototype.tail=function(){return this.tail_},i.prototype.setTail=function(t){this.tail_=t},i.prototype.search=function(){return this.search_node_},i.prototype.setSearch=function(t){this.search_node_=t},i.prototype.findSearchNode=function(){return this.search_node_},i.prototype.locateNode=function(t){var n=this.search_node_;if(t<n.value){for(;n=n.prev;)if(t>=n.value)return this.search_node_=n,n}else for(;n=n.next;)if(t<n.value)return this.search_node_=n.prev,n.prev;return null},i.prototype.locatePoint=function(t){var n=t.x,e=this.findSearchNode(n),i=e.point.x;if(n===i){if(t!==e.point)if(t===e.prev.point)e=e.prev;else{if(t!==e.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");e=e.next}}else if(n<i)for(;(e=e.prev)&&t!==e.point;);else for(;(e=e.next)&&t!==e.point;);return e&&(this.search_node_=e),e},t.exports=i,t.exports.Node=function(t,n){this.point=t,this.triangle=n||null,this.next=null,this.prev=null,this.value=t.x}},function(t,n,e){var i,o,r,s;s=function(t,n){"use strict";var e=function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e]);return n.default=t,n}(n);onmessage=function(n){!function(n,i){function o(n,e,i){return new t.Vector3(n,e,i)}function r(n,e,i,o){return new t.Face3(n,e,i,o)}var s=0;function a(t,n){if(u.length>0){h.vertices=u;for(var e=[],o=[],r=[],s=0;s<h.faces.length;++s){var a=h.faces[s];e.push(h.vertices[a.a].x),e.push(h.vertices[a.a].y),e.push(h.vertices[a.a].z),e.push(h.vertices[a.b].x),e.push(h.vertices[a.b].y),e.push(h.vertices[a.b].z),e.push(h.vertices[a.c].x),e.push(h.vertices[a.c].y),e.push(h.vertices[a.c].z),3===a.vertexNormals.length?(r.push(a.vertexNormals[0].x),r.push(a.vertexNormals[0].y),r.push(a.vertexNormals[0].z),r.push(a.vertexNormals[1].x),r.push(a.vertexNormals[1].y),r.push(a.vertexNormals[1].z),r.push(a.vertexNormals[2].x),r.push(a.vertexNormals[2].y),r.push(a.vertexNormals[2].z)):(r.push(a.normal.x),r.push(a.normal.y),r.push(a.normal.z),r.push(a.normal.x),r.push(a.normal.y),r.push(a.normal.z),r.push(a.normal.x),r.push(a.normal.y),r.push(a.normal.z))}for(var d=0;d<h.faceVertexUvs[0].length;++d){var l=h.faceVertexUvs[0][d];o.push(l[0].x),o.push(l[0].y),o.push(l[1].x),o.push(l[1].y),o.push(l[2].x),o.push(l[2].y)}p.geometry={normal:new Float32Array(r),uv:new Float32Array(o),position:new Float32Array(e),normalItemSize:3,positionItemSize:3,uvItemSize:2},i(p),h={faces:[],faceVertexUvs:[[]],vertices:[]}}void 0!==t&&(p.meshName=t),void 0!==n&&(p.materialName=n)}var p={},h={faces:[],faceVertexUvs:[[]],vertices:[]},u=[],d=[],l=[];function c(t,n,e,i){void 0===i?h.faces.push(r(parseInt(t)-(s+1),parseInt(n)-(s+1),parseInt(e)-(s+1))):h.faces.push(r(parseInt(t)-(s+1),parseInt(n)-(s+1),parseInt(e)-(s+1),[d[parseInt(i[0])-1].clone(),d[parseInt(i[1])-1].clone(),d[parseInt(i[2])-1].clone()]))}function f(t,n,e){h.faceVertexUvs[0].push([l[parseInt(t)-1].clone(),l[parseInt(n)-1].clone(),l[parseInt(e)-1].clone()])}function g(t,n,e){void 0===t[3]?(c(t[0],t[1],t[2],e),void 0!==n&&n.length>0&&f(n[0],n[1],n[2])):(void 0!==e&&e.length>0?(c(t[0],t[1],t[3],[e[0],e[1],e[3]]),c(t[1],t[2],t[3],[e[1],e[2],e[3]])):(c(t[0],t[1],t[3]),c(t[1],t[2],t[3])),void 0!==n&&n.length>0&&(f(n[0],n[1],n[3]),f(n[1],n[2],n[3])))}for(var y=/v( +[\\d|\\.|\\+|\\-|e]+)( +[\\d|\\.|\\+|\\-|e]+)( +[\\d|\\.|\\+|\\-|e]+)/,x=/vn( +[\\d|\\.|\\+|\\-|e]+)( +[\\d|\\.|\\+|\\-|e]+)( +[\\d|\\.|\\+|\\-|e]+)/,_=/vt( +[\\d|\\.|\\+|\\-|e]+)( +[\\d|\\.|\\+|\\-|e]+)/,v=/f( +\\d+)( +\\d+)( +\\d+)( +\\d+)?/,C=/f( +(\\d+)\\/(\\d+))( +(\\d+)\\/(\\d+))( +(\\d+)\\/(\\d+))( +(\\d+)\\/(\\d+))?/,b=/f( +(\\d+)\\/(\\d+)\\/(\\d+))( +(\\d+)\\/(\\d+)\\/(\\d+))( +(\\d+)\\/(\\d+)\\/(\\d+))( +(\\d+)\\/(\\d+)\\/(\\d+))?/,m=/f( +(\\d+)\\/\\/(\\d+))( +(\\d+)\\/\\/(\\d+))( +(\\d+)\\/\\/(\\d+))( +(\\d+)\\/\\/(\\d+))?/,w=/f( +(\\d+)\\/(\\d+)\\/(\\d+)){5,}?/,W=n.split("\\n"),E=null,N=0;N<W.length;N++){var P,I=W[N];if(0!==(I=I.trim()).length&&"#"!==I.charAt(0))if(null!==(P=y.exec(I))){if(null===E){var z=P[1].split(".")[1]?P[1].split(".")[1].length:0;z>7&&(z=7),E=Math.pow(10,z)}u.push(o(parseFloat(P[1]),parseFloat(P[2]),parseFloat(P[3])))}else if(null!==(P=x.exec(I)))d.push(o(parseFloat(P[1]),parseFloat(P[2]),parseFloat(P[3])));else if(null!==(P=_.exec(I)))l.push((J=parseFloat(P[1]),K=parseFloat(P[2]),new t.Vector2(J,K)));else if(null!==(P=v.exec(I)))g([P[1],P[2],P[3],P[4]]);else if(null!==(P=C.exec(I)))g([P[2],P[5],P[8],P[11]],[P[3],P[6],P[9],P[12]]);else if(null!==(P=w.exec(I))){for(var T=I.split(" "),S=/(\\d+)\\/(\\d+)\\/(\\d+)/,A=[],q=[],k=[],F=[],O=null,V=null,D=null,L=null,B=1;B<T.length;B++){var M=void 0;if(null!==(M=S.exec(T[B]))){q.push(parseInt(M[1])),k.push(parseInt(M[2])),F.push(parseInt(M[3]));var j=u[parseInt(M[1])-1].clone();if(null===D&&(D=d[parseInt(M[3])-1]),null===L)L=j.clone(),A.push({x:0,y:0,id:0});else if(null===O){var U=j.clone().add(L.clone().negate());(O=U.clone()).normalize(),(V=O.clone().cross(D.clone())).normalize(),A.push({x:U.length()*E,y:0,id:1}),0===O.lengthSq()&&console.error("model contains duplicate points")}else{var H=j.clone().add(L.clone().negate());A.push({x:H.dot(O)*E,y:H.dot(V)*E,id:B-1})}}}try{var R=new e.SweepContext(A);R.triangulate();var G=R.getTriangles();G.map(function(t){var n=t.getPoints().map(function(t){return t.id});c(q[n[0]],q[n[1]],q[n[2]],[F[n[0]],F[n[1]],F[n[2]]]),f(k[n[0]],k[n[1]],k[n[2]])})}catch(t){console.error("error",t)}}else null!==(P=b.exec(I))?g([P[2],P[6],P[10],P[14]],[P[3],P[7],P[11],P[15]],[P[4],P[8],P[12],P[16]]):null!==(P=m.exec(I))?g([P[2],P[5],P[8],P[11]],[],[P[3],P[6],P[9],P[12]]):/^o /.test(I)?(a(),s+=u.length,u=[]):/^g /.test(I)?a(I.substring(2).trim(),void 0):/^usemtl /.test(I)?a(void 0,I.substring(7).trim()):/^mtllib /.test(I)||/^s /.test(I)||console.warn("OBJMTLLoader: Unhandled line "+I)}var J,K;a(void 0,void 0),i("finish")}(n.data.data,function(t){var n=!1,e=null;"finish"===t?n=!0:e=t,postMessage({mesh:e,isFinish:n})})},onerror=function(t){throw console.error("BundleLoader error",t),t}},o=[e(7),e(8)],void 0===(r="function"==typeof(i=s)?i.apply(n,o):i)||(t.exports=r)},function(t,n,e){var i,o,r,s;s=function(t){"use strict";function n(t,n){this.x=t||0,this.y=n||0}function e(t,n,e){this.x=t||0,this.y=n||0,this.z=e||0}function i(t,n,e){return{r:t,g:n,b:e}}Object.defineProperty(t,"__esModule",{value:!0}),Object.assign(n.prototype,{constructor:n,isVector2:!0,clone:function(){return new this.constructor(this.x,this.y)}}),Object.assign(e.prototype,{constructor:e,isVector3:!0,clone:function(){return new this.constructor(this.x,this.y,this.z)},add:function(t,n){return void 0!==n?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,n)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addVectors:function(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this.z=t.z+n.z,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},normalize:function(){return this.divideScalar(this.length()||1)},divideScalar:function(t){return this.multiplyScalar(1/t)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(t,n){if(void 0!==n)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,n);var e=this.x,i=this.y,o=this.z;return this.x=i*t.z-o*t.y,this.y=o*t.x-e*t.z,this.z=e*t.y-i*t.x,this},crossVectors:function(t,n){var e=t.x,i=t.y,o=t.z,r=n.x,s=n.y,a=n.z;return this.x=i*a-o*s,this.y=o*r-e*a,this.z=e*s-i*r,this}}),Object.assign(i.prototype,{isColor:!0}),t.Vector2=n,t.Vector3=e,t.Face3=function(t,n,o,r,s,a){this.a=t,this.b=n,this.c=o,this.normal=r&&r.isVector3?r:new e,this.vertexNormals=Array.isArray(r)?r:[],this.color=s&&s.isColor?s:new i(1,1,1),this.vertexColors=Array.isArray(s)?s:[],this.materialIndex=void 0!==a?a:0},t.Color=i},o=[n],void 0===(r="function"==typeof(i=s)?i.apply(n,o):i)||(t.exports=r)},function(t,n,e){"use strict";(function(t){var i=t.poly2tri;n.noConflict=function(){return t.poly2tri=i,n},n.VERSION=e(10).version,n.PointError=e(0),n.Point=e(3),n.Triangle=e(2),n.SweepContext=e(11);var o=e(4);n.triangulate=o.triangulate,n.sweep={Triangulate:o.triangulate}}).call(n,e(9))},function(t,n){var e;e=function(){return this}();try{e=e||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(e=window)}t.exports=e},function(t,n){t.exports={version:"1.5.0"}},function(t,n,e){"use strict";var i=e(0),o=e(3),r=e(2),s=e(4),a=e(5),p=a.Node,h=function(t,n){if(this.p=t,this.q=n,t.y>n.y)this.q=t,this.p=n;else if(t.y===n.y)if(t.x>n.x)this.q=t,this.p=n;else if(t.x===n.x)throw new i("poly2tri Invalid Edge constructor: repeated points!",[t]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},u=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};u.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var d=function(t,n){n=n||{},this.triangles_=[],this.map_=[],this.points_=n.cloneArrays?t.slice(0):t,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new u,this.edge_event=new function(){this.constrained_edge=null,this.right=!1},this.initEdges(this.points_)};d.prototype.addHole=function(t){this.initEdges(t);var n,e=t.length;for(n=0;n<e;n++)this.points_.push(t[n]);return this},d.prototype.AddHole=d.prototype.addHole,d.prototype.addHoles=function(t){var n,e=t.length;for(n=0;n<e;n++)this.initEdges(t[n]);return this.points_=this.points_.concat.apply(this.points_,t),this},d.prototype.addPoint=function(t){return this.points_.push(t),this},d.prototype.AddPoint=d.prototype.addPoint,d.prototype.addPoints=function(t){return this.points_=this.points_.concat(t),this},d.prototype.triangulate=function(){return s.triangulate(this),this},d.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},d.prototype.getTriangles=function(){return this.triangles_},d.prototype.GetTriangles=d.prototype.getTriangles,d.prototype.front=function(){return this.front_},d.prototype.pointCount=function(){return this.points_.length},d.prototype.head=function(){return this.head_},d.prototype.setHead=function(t){this.head_=t},d.prototype.tail=function(){return this.tail_},d.prototype.setTail=function(t){this.tail_=t},d.prototype.getMap=function(){return this.map_},d.prototype.initTriangulation=function(){var t,n=this.points_[0].x,e=this.points_[0].x,i=this.points_[0].y,r=this.points_[0].y,s=this.points_.length;for(t=1;t<s;t++){var a=this.points_[t];a.x>n&&(n=a.x),a.x<e&&(e=a.x),a.y>i&&(i=a.y),a.y<r&&(r=a.y)}this.pmin_=new o(e,r),this.pmax_=new o(n,i);var p=.3*(n-e),h=.3*(i-r);this.head_=new o(n+p,r-h),this.tail_=new o(e-p,r-h),this.points_.sort(o.compare)},d.prototype.initEdges=function(t){var n,e=t.length;for(n=0;n<e;++n)this.edge_list.push(new h(t[n],t[(n+1)%e]))},d.prototype.getPoint=function(t){return this.points_[t]},d.prototype.addToMap=function(t){this.map_.push(t)},d.prototype.locateNode=function(t){return this.front_.locateNode(t.x)},d.prototype.createAdvancingFront=function(){var t,n,e,i=new r(this.points_[0],this.tail_,this.head_);this.map_.push(i),t=new p(i.getPoint(1),i),n=new p(i.getPoint(0),i),e=new p(i.getPoint(2)),this.front_=new a(t,e),t.next=n,n.next=e,n.prev=t,e.prev=n},d.prototype.removeNode=function(t){},d.prototype.mapTriangleToNodes=function(t){for(var n=0;n<3;++n)if(!t.getNeighbor(n)){var e=this.front_.locatePoint(t.pointCW(t.getPoint(n)));e&&(e.triangle=t)}},d.prototype.removeFromMap=function(t){var n,e=this.map_,i=e.length;for(n=0;n<i;n++)if(e[n]===t){e.splice(n,1);break}},d.prototype.meshClean=function(t){for(var n,e,i=[t];n=i.pop();)if(!n.isInterior())for(n.setInterior(!0),this.triangles_.push(n),e=0;e<3;e++)n.constrained_edge[e]||i.push(n.getNeighbor(e))},t.exports=d},function(t,n,e){"use strict";t.exports=function(t,n){if(!t)throw new Error(n||"Assert Failed")}},function(t,n,e){"use strict";var i=1e-12;n.EPSILON=i;var o={CW:1,CCW:-1,COLLINEAR:0};n.Orientation=o,n.orient2d=function(t,n,e){var r=(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x);return r>-i&&r<i?o.COLLINEAR:r>0?o.CCW:o.CW},n.inScanArea=function(t,n,e,o){return!((t.x-n.x)*(o.y-n.y)-(o.x-n.x)*(t.y-n.y)>=-i||(t.x-e.x)*(o.y-e.y)-(o.x-e.x)*(t.y-e.y)<=i)},n.isAngleObtuse=function(t,n,e){var i=n.x-t.x,o=n.y-t.y;return i*(e.x-t.x)+o*(e.y-t.y)<0}}]);',r.p+"OBJParser.js")}},function(e,t,r){var n,i,o,a;a=function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){r(this,e)}return n(e,[{key:"get",value:function(e,t){var r=this._doGet(e);return void 0===r||null===r?t:r}},{key:"set",value:function(e,t){if(void 0===e||null===e)throw new Error("Invalid argument");this._doSet(e,t)}}]),e}(),o=function(e){function t(){r(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cache={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),n(t,[{key:"_doGet",value:function(e){var t=this.cache[e];if(t){var r=t.clone();return r.objSpaceBBox=t.objSpaceBBox.clone(),this.deepCloneMaterial(t.objSpaceBBox,r.objSpaceBBox),this.deepCloneMaterial(t,r),r}}},{key:"_doSet",value:function(e,t){var r=t.clone();r.objSpaceBBox=t.objSpaceBBox.clone(),this.deepCloneMaterial(t,r),this.cache[e]=r}},{key:"deepCloneMaterial",value:function(e,t){if("Group"===e.type)for(var r=0;r<e.children.length;r+=1)this.deepCloneMaterial(e.children[r],t.children[r]);else"Mesh"===e.type?e.material instanceof Array?t.material=e.material.map(function(e){return e.clone()}):(t.material=e.material.clone(),e.mtlParams&&(t.mtlParams=JSON.parse(JSON.stringify(e.mtlParams)))):console.warn("deepCloneMaterial",e)}}]),t}();t.default=o,e.exports=t.default},i=[e,t],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=(i=r)&&i.__esModule?i:{default:i};var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var s=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n},l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._size={width:64,height:64},e.size&&(e.size.width>0&&(r._size.width=e.size.width),e.size.height>0&&(r._size.width=e.size.height)),r._canvas=document.createElement("canvas"),r._canvas.width=r._size.width,r._canvas.height=r._size.height,r._context=r._canvas.getContext("2d"),r._context.fillStyle="black",r._context.fillRect(0,0,r._canvas.width,r._canvas.height),r._texture=new n.Texture(r._canvas),r._texture.needsUpdate=!0,s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"texture",{texture:r._texture,aspectRatio:r._canvas.width/r._canvas.height},r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),a(t,[{key:"destruct",value:function(){this._texture.dispose(),function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"takeEffects",value:function(){this._texture.needsUpdate=!0}},{key:"context",get:function(){return this._context}},{key:"size",set:function(e){e.width>0&&(this._size.width=e.width),e.height>0&&(this._size.height=e.height),this._canvas.width=this._size.width,this._canvas.height=this._size.height,s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"texture",{texture:this._texture,aspectRatio:this._canvas.width/this._canvas.height},this)},get:function(){return{width:this._size.width,height:this._size.height}}}]),t}();t.default=l,e.exports=t.default},i=[e,t,r(16),r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=r)&&n.__esModule?n:{default:n};var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e.sided=void 0===e.sided?91:e.sided;var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._property.type="CylinderVolumeMarker",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),o(t,[{key:"sided",set:function(e){e<91?console.warn("CylinderVolumeMarker sided cannot be smaller than 91: ",e):function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"sided",e,this)},get:function(){return this._sided}}]),t}();t.default=a,e.exports=t.default},i=[e,t,r(32)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=(i=r)&&i.__esModule?i:{default:i};var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=e.volume;if(r.hasTopCover=!1,r.hasBottomCover=!0,r.bottom=void 0===r.bottom||null===r.bottom?0:r.bottom,!function(e){if("number"!=typeof r.bottom)return console.log("DitchMarker bottom must be a number",e),!1;return!0}(e))return void 0,s(i,void 0);for(var i=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),o=["#502a12","#1c1505","#1c1505","#1c1505","#64553a","#403027","#403027","#1c1505"].map(function(e){return new n.Color(e)}),a=[],l=0;l<o.length;++l)a.push(255*o[l].r),a.push(255*o[l].g),a.push(255*o[l].b),a.push(255);var u=i._generateDataTexture(a);i.extrudeMesh.material.map=u,i.extrudeMesh.material.map.needsUpdate=!0;for(var c=i.bottomCover.uvs,h=0;h<c.length;++h)c[h]=[new n.Vector2(1,1),new n.Vector2(1,1),new n.Vector2(0,1)];for(var f=i.otherCover.uvs,d=0;d<f.length;d+=2)f[d]=[new n.Vector2(0,1),new n.Vector2(1,1),new n.Vector2(0,0)],f[d+1]=[new n.Vector2(1,1),new n.Vector2(1,0),new n.Vector2(0,0)];return i.extrudeMesh.geometry.faceVertexUvs[0]=[].concat(c).concat(f),i.extrudeMesh.geometry.uvsNeedUpdate=!0,i.extrudeMesh.material.opacity=1,i.extrudeMesh.material.transparent=!1,i.extrudeMesh.material.depthWrite=!0,i.extrudeMesh.material.side=n.BackSide,i.interactShape.material.side=n.BackSide,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),a(t,[{key:"_generateDataTexture",value:function(e){var t=new n.DataTexture(Uint8Array.from(e),1,Math.floor(e.length/4),n.RGBAFormat,n.UnsignedByteType,n.UVMapping);return t.minFilter=t.magFilter=n.LinearFilter,t.needsUpdate=!0,t}},{key:"destruct",value:function(){this.interactable&&(this.interactable=!1),this.extrudeMesh&&this.extrudeMesh.material&&this.extrudeMesh.material.map&&this.extrudeMesh.material.map.dispose(),function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"texture",set:function(e){if(Array.isArray(e)){for(var t=e.map(function(e){return new n.Color(e)}),r=[],i=0;i<t.length;++i)r.push(255*t[i].r),r.push(255*t[i].g),r.push(255*t[i].b),r.push(255);var o=this._generateDataTexture(r);this.extrudeMesh.material.map=o,this.extrudeMesh.material.map.needsUpdate=!0}else console.warn("DitchMarker texture the input must be an array",e)}},{key:"bottom",set:function(e){"number"==typeof e?function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"bottom",e,this):console.warn("DitchMarker setter bottom: input must be a number",e)},get:function(){return this._bottom}},{key:"hasTopCover",set:function(e){console.warn("DitchMarker cannot set hasTopCover: must be false",e)},get:function(){return!1}},{key:"hasBottomCover",set:function(e){console.warn("DitchMarker cannot set hasBottomCover: must be true",e)},get:function(){return!0}},{key:"opacity",set:function(e){console.warn("DitchMarker cannot set opacity")},get:function(){return 1}}]),t}();t.default=l,e.exports=t.default},i=[e,t,r(20),r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=u(r),s=u(n),l=u(i);function u(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var h=function(e){function t(e){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e.camToEarth){var r=d(e.camToEarth),n=r.position,i=r.orientation;e.position=n,e.orientation=i}var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.setPose(),a._showNear=void 0===e.showNear||e.showNear,a._showFar=void 0!==e.showFar&&e.showFar,a._color=void 0===e.color?new o.Color(16711680):new o.Color(e.color);var u={fov:45,near:1e-5,far:.01,aspect:1,visColor:a._color.getHex(),visIntensity:1,visPenumbra:.05,visDecay:1},c=Object.assign({},u,e);a._fov=c.fov,a.zoom=1,a._near=c.near,a._far=c.far,a._aspect=c.aspect,a.view=null,a.visColor=c.visColor,a.visIntensity=c.visIntensity,a.visPenumbra=c.visPenumbra,a.visDecay=c.visDecay,a._projectionMatrix=new o.Matrix4;var h=a,f=function(){var e=new o.ShaderMaterial({uniforms:{color:{value:new o.Color(16777215)},opacity:{value:1}},vertexShader:"attribute vec3 vertexcolor;varying vec3 vVertexcolor;attribute float alpha;varying float vAlpha;attribute float power;varying float vPower;void main(){gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);vVertexcolor=vertexcolor;vAlpha=alpha;vPower=power;}",fragmentShader:"varying vec3 vVertexcolor;varying float vAlpha;varying float vPower;uniform vec3 color;uniform float opacity;void main(){float colorAlpha=pow(vAlpha,vPower);gl_FragColor=vec4(color,opacity)*vec4(vVertexcolor,colorAlpha);}",blending:o.AdditiveBlending,depthTest:!0,transparent:!0}),t={vertices:[],colors:[],alphas:[],powers:[],pointMap:{}},r={vertices:[],colors:[],alphas:[],powers:[],pointMap:{}},n={vertices:[],colors:[],alphas:[],powers:[],pointMap:{}},i=new o.Color(16755200),a=h._color,s=new o.Color(43775),l=new o.Color(16777215),u=new o.Color(3355443);function c(e,t,r,n,i,o,a,s){f(e,t,n,i,a),f(e,r,n,o,s)}function f(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;e.vertices.push(0,0,0),e.colors.push(r.r,r.g,r.b),e.alphas.push(n),e.powers.push(i),void 0===e.pointMap[t]&&(e.pointMap[t]=[]),e.pointMap[t].push(e.vertices.length/3-1)}c(r,"n1","n2",i),c(r,"n2","n4",i),c(r,"n4","n3",i),c(r,"n3","n1",i),c(r,"cn1","cn2",u),c(r,"cn3","cn4",u),c(n,"f1","f2",i),c(n,"f2","f4",i),c(n,"f4","f3",i),c(n,"f3","f1",i),c(n,"cf1","cf2",u),c(n,"cf3","cf4",u),c(t,"p","n1",a),c(t,"p","n2",a),c(t,"p","n3",a),c(t,"p","n4",a),c(t,"n1","f1",i,1,0),c(t,"n2","f2",i,1,0),c(t,"n3","f3",i,1,0),c(t,"n4","f4",i,1,0),c(t,"u1","u2",s),c(t,"u2","u3",s),c(t,"u3","u1",s),c(n,"c","t",l),c(t,"p","c",u);var d=new o.BufferGeometry;d.addAttribute("position",new o.Float32BufferAttribute(t.vertices,3)),d.addAttribute("vertexcolor",new o.Float32BufferAttribute(t.colors,3)),d.addAttribute("alpha",new o.Float32BufferAttribute(t.alphas,1)),d.addAttribute("power",new o.Float32BufferAttribute(t.powers,1));var p=new o.BufferGeometry;p.addAttribute("position",new o.Float32BufferAttribute(r.vertices,3)),p.addAttribute("vertexcolor",new o.Float32BufferAttribute(r.colors,3)),p.addAttribute("alpha",new o.Float32BufferAttribute(r.alphas,1)),p.addAttribute("power",new o.Float32BufferAttribute(r.powers,1));var m=new o.BufferGeometry;m.addAttribute("position",new o.Float32BufferAttribute(r.vertices,3)),m.addAttribute("vertexcolor",new o.Float32BufferAttribute(r.colors,3)),m.addAttribute("alpha",new o.Float32BufferAttribute(r.alphas,1)),m.addAttribute("power",new o.Float32BufferAttribute(r.powers,1));var v=new o.LineSegments(d,e);v.name="camera frame";var g=new o.LineSegments(p,e),y=new o.LineSegments(m,e);h._otherPointMap=t.pointMap,h._nearPointMap=r.pointMap,h._farPointMap=n.pointMap;var _=(w=[255,255,255,255],b=[].concat([0,0,0,0]).concat([0,0,0,0]).concat(w).concat(w),x=new o.DataTexture(Uint8Array.from(b),2,2,o.RGBAFormat,o.UnsignedByteType,o.UVMapping),x.needsUpdate=!0,x.minFilter=x.magFilter=o.LinearFilter,x);var w,b,x;var k=new o.MeshBasicMaterial({color:a,transparent:!0,opacity:.5,side:o.DoubleSide,alphaMap:_}),A=new o.Geometry;A.vertices.push(new o.Vector3(0,0,0),new o.Vector3(0,0,0),new o.Vector3(0,0,0),new o.Vector3(0,0,0),new o.Vector3(0,0,0)),A.faces.push(new o.Face3(0,1,2),new o.Face3(0,2,4),new o.Face3(0,4,3),new o.Face3(0,3,1)),A.faceVertexUvs[0]=[[new o.Vector2(.5,1),new o.Vector2(0,0),new o.Vector2(1,0)],[new o.Vector2(.5,1),new o.Vector2(0,0),new o.Vector2(1,0)],[new o.Vector2(.5,1),new o.Vector2(0,0),new o.Vector2(1,0)],[new o.Vector2(.5,1),new o.Vector2(0,0),new o.Vector2(1,0)]];var M=new o.Mesh(A,k);return{otherLines:v,nearLines:g,farLines:y,nearCone:M}}();function d(e){var t=new o.Matrix4;t.elements=e;var r=new o.Vector3,n=new o.Quaternion,i=new o.Vector3;t.clone().decompose(r,n,i);var a=s.default.getLngLatAltFromNoneGroundCartesian(l.default.EarthResolution,r,l.default.scale),u=a.lng,c=a.lat,h=a.alt,f=s.default.getLocalSystemOnEarthSurface(l.default.EarthResolution,u,c,l.default.scale),d=new o.Matrix4;d.makeBasis(f.lng,f.lat,f.alt),d.setPosition(r);var p=t.clone();return(new o.Matrix4).getInverse(d).clone().multiply(p).clone().decompose(r,n,i),{position:{lng:u,lat:c,alt:h},orientation:n.normalize(),scale:new o.Vector3(1,1,1)}}return a._otherLines=f.otherLines,a._nearLines=f.nearLines,a._farLines=f.farLines,a.contentHolder.add(a._otherLines),a.contentHolder.add(a._nearLines),a.contentHolder.add(a._farLines),a._matrixToMarkerPose=d,a._nearCone=f.nearCone,a.decoHolder.add(a._nearCone),a.interactShape=new o.Mesh(a._nearCone.geometry,new o.MeshBasicMaterial({side:o.DoubleSide})),a.updateProjectionMatrix(),a.updateShape(),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),c(t,[{key:"updateShape",value:function(){var e=new o.Camera;e.projectionMatrix.copy(this._projectionMatrix);var t=this._otherLines.geometry,r=this._otherPointMap,n=this._nearLines.geometry,i=this._nearPointMap,a=this._farLines.geometry,s=this._farPointMap,l=new o.Vector3;function u(e,o,l,u){c(t,r,e,o,l,u),c(n,i,e,o,l,u),c(a,s,e,o,l,u)}function c(t,r,n,i,o,a){l.set(i,o,a).unproject(e);var s=r[n];if(void 0!==s)for(var u=t.getAttribute("position"),c=0,h=s.length;c<h;c++)u.setXYZ(s[c],l.x,l.y,l.z)}function h(e,t,r){var n=t[r];if(void 0!==n){var i=e.getAttribute("position");return new o.Vector3(i.getX(n[0]),i.getY(n[0]),i.getZ(n[0]))}return null}u("c",0,0,-1),u("t",0,0,1),u("n1",-1,-1,-1),u("n2",1,-1,-1),u("n3",-1,1,-1),u("n4",1,1,-1),u("f1",-1,-1,1),u("f2",1,-1,1),u("f3",-1,1,1),u("f4",1,1,1),u("u1",.7,1.1,-1),u("u2",-.7,1.1,-1),u("u3",0,2,-1),u("cf1",-1,0,1),u("cf2",1,0,1),u("cf3",0,-1,1),u("cf4",0,1,1),u("cn1",-1,0,-1),u("cn2",1,0,-1),u("cn3",0,-1,-1),u("cn4",0,1,-1),t.getAttribute("position").needsUpdate=!0,n.getAttribute("position").needsUpdate=!0,a.getAttribute("position").needsUpdate=!0,this._nearLines.visible=this._showNear,this._farLines.visible=this._showFar;var f=this._nearCone.geometry;f.vertices[0].copy(h(t,r,"p")),f.vertices[1].copy(h(t,r,"n1")),f.vertices[2].copy(h(t,r,"n2")),f.vertices[3].copy(h(t,r,"n3")),f.vertices[4].copy(h(t,r,"n4")),f.verticesNeedUpdate=!0}},{key:"updateProjectionMatrix",value:function(){var e=this.near,t=e*Math.tan(Math.PI/180*.5*this.fov)/this.zoom,r=2*t,n=this.aspect*r,i=-.5*n,o=this.view,a=this.far;if(this._showFar||(a=2*e),null!==this.view&&this.view.enabled){var s=o.fullWidth,l=o.fullHeight;i+=o.offsetX*n/s,t-=o.offsetY*r/l,n*=o.width/s,r*=o.height/l}this._projectionMatrix.makePerspective(i,i+n,t,t-r,e,a)}},{key:"setPose",value:function(e,r,n){(function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setPose",this).call(this,e,r,n),this._camToEarth=this.shapeToEarth().elements,this._updateSpotLight()}},{key:"bindSpotLight",value:function(e){this._spotLight=e,this._updateSpotLight()}},{key:"unbindSpotLight",value:function(){this._spotLight=void 0}},{key:"lookAt",value:function(e){var t=s.default.getNoneGroundCartesianFromLngLatAlt(l.default.EarthResolution,e.lng,e.lat,e.alt,l.default.scale),r=this.camToEarth,n=new o.Vector3(r[12],r[13],r[14]),i=s.default.getLocalSystemOnEarthSurface(l.default.EarthResolution,e.lng,e.lat,l.default.scale).alt,a=(new o.Matrix4).setPosition(n).lookAt(n,t,i);this.camToEarth=a.elements;var u=t.clone().sub(n).length()*l.default.EARTH_RADIUS;this.farInMeter=u,this.near=this.far/3}},{key:"_updateSpotLight",value:function(){if(!this._spotLight)return!1;var e=new o.Matrix4;e.elements=this.camToEarth;var t=(new o.Vector3).setFromMatrixPosition(e),r=new o.Vector3(0,0,-1).applyMatrix4(e);return this._spotLight.setPose({position:t,target:r}),this._spotLight.color.setHex(this.visColor),this._spotLight.intensity=this.visIntensity,this._spotLight.penumbra=this.visPenumbra,this._spotLight.distance=this.far,this._spotLight.angle=Math.max(10,this.fov-10)/180*Math.PI,this._spotLight.decay=this.visDecay,!0}},{key:"camToEarth",set:function(e){this._camToEarth=e;var t=this._matrixToMarkerPose(e),r=t.position,n=t.orientation;this.setPose(r,n)},get:function(){return this._camToEarth}},{key:"fov",set:function(e){this._fov=e,this.updateProjectionMatrix(),this.updateShape(),this._updateSpotLight()},get:function(){return this._fov}},{key:"aspect",set:function(e){this._aspect=e,this.updateProjectionMatrix(),this.updateShape()},get:function(){return this._aspect}},{key:"near",set:function(e){this._near=e,this.updateProjectionMatrix(),this.updateShape()},get:function(){return this._near}},{key:"far",set:function(e){this._far=e,this.updateProjectionMatrix(),this.updateShape(),this._updateSpotLight()},get:function(){return this._far}},{key:"farInMeter",set:function(e){var t=e/l.default.EARTH_RADIUS*l.default.scale;this.far=t},get:function(){return this.far/l.default.scale*l.default.EARTH_RADIUS}},{key:"showNear",set:function(e){this._showNear=e,this._nearLines.visible=e},get:function(){return this._showNear}},{key:"showFar",set:function(e){this._showFar=e,this._farLines.visible=e,this.updateProjectionMatrix(),this.updateShape()},get:function(){return this._showFar}},{key:"color",set:function(e){var t=new o.Color(e);this._color=t,this._nearCone.material.color=t;for(var r=this._otherLines.geometry.getAttribute("vertexcolor"),n=0;n<8;++n)r.setXYZ(n,t.r,t.g,t.b);r.needsUpdate=!0},get:function(){return this._color}},{key:"visColor",set:function(e){this.__visColor=e,this._updateSpotLight()},get:function(){return this.__visColor?this.__visColor:this.color.getHex()}},{key:"visIntensity",set:function(e){this.__visIntensity=e,this._updateSpotLight()},get:function(){return void 0!==this.__visIntensity?this.__visIntensity:3}},{key:"visPenumbra",set:function(e){this.__visPenumbra=e,this._updateSpotLight()},get:function(){return void 0!==this.__visPenumbra?this.__visPenumbra:.05}},{key:"visDecay",set:function(e){this.__visDecay=e,this._updateSpotLight()},get:function(){return void 0!==this.__visDecay?this.__visDecay:1}}]),t}();t.default=h,e.exports=t.default},i=[e,t,r(5),r(3),r(1),r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=u(n),s=u(i),l=u(o);function u(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var h=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e.showXYZ=!1;var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(void 0===t.textureCache){var i=new Image;i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABfGlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGAqSSwoyGFhYGDIzSspCnJ3UoiIjFJgv8PAzcDDIMRgxSCemFxc4BgQ4MOAE3y7xsAIoi/rgsxK8/x506a1fP4WNq+ZclYlOrj1gQF3SmpxMgMDIweQnZxSnJwLZOcA2TrJBUUlQPYMIFu3vKQAxD4BZIsUAR0IZN8BsdMh7A8gdhKYzcQCVhMS5AxkSwDZAkkQtgaInQ5hW4DYyRmJKUC2B8guiBvAgNPDRcHcwFLXkYC7SQa5OaUwO0ChxZOaFxoMcgcQyzB4MLgwKDCYMxgwWDLoMjiWpFaUgBQ65xdUFmWmZ5QoOAJDNlXBOT+3oLQktUhHwTMvWU9HwcjA0ACkDhRnEKM/B4FNZxQ7jxDLX8jAYKnMwMDcgxBLmsbAsH0PA4PEKYSYyjwGBn5rBoZt5woSixLhDmf8xkKIX5xmbARh8zgxMLDe+///sxoDA/skBoa/E////73o//+/i4H2A+PsQA4AJHdp4IxrEg8AAAIGaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj4xNDQwPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjI1NjA8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4K4sTvTgAADIZJREFUeAHlmtFy4zCuRGM7mf//4NhZHIiHblGyJ1Nbe18up2SAIAigmxQlO3P5+Pj4qev/bfv8DfLPz1+5/SbU/7nP9/f325yXGj3dAf8K+na7vU30vxi83+//FPaMjAMBfwP+Cugr+z9V+I/Orwh4ZTd8ErEj4BX4M3BnNhNcr1fVj8uFFP9d+/l5btLH4/Ey2BnwMxsBJOGvBKxA177VCPoMcNpSd+4qE3Dq+ml7RcYKeu0T50DA2eon2NQt5Ay0AJX6Zj91x5WCo5969tOufkZGAk/dXJAwd8BKQAJOnckAF8SZ1GYi+mlLXR+lgOijZ3+1OZZyJSKBp06slwQk4NQTOAES2DsdX5rAlZt1/5lgHEnb33Tm4JNEJPDUIeDtA/4V+Hdg340J6DcECEQJKOYhJcE+Pur6sViSAI4Ejr/tQECC1ilXnkR54fNqnLHVFxsN+9oEpl2w2s/6gCSWPsxFx5YkGHMlo8+AvP8lQJng0GkJKm2ppw+681oZMdSVKwjsCVodO8D1V1/Hne9OcBcoGT/sAIxnLUEITsBIbWeSeGm3v+YRkECQzMu+OjnRAYcuSGLmvDXH2t8R4Kor3wFbx7KPTqN47faxqbcSHxROE6S6K0xfPcGjkydJwNfmGLhYfSXjOwKcsMosOkEJDknLPn556YOfdvRsCRy7YPHPMcEDRB8kOSQBH+dljlV/S0AWuoLL/qqTBBuXurGKlmJgI6EH44Oi+WpW53wDZr6AkAkywaXdOUr83rUDAbn9mWjhqRMcO3LVteGvDujLdb8jzgpzlad87Lc28SSE+AJPHRux3QGMoTs3tz9jBwIw0s6Aa0NOcKFrU+pvP+MytrYJnJ1QDTACIgb62rAxRtPXvNiSCPprOyXAgAZCCkLdMRhFR+pzvdTOuD13h3MYR6cpsyCKpSEFw5zZZyfVfC980TnYkPoiacZAJwZ2bNkmAW79HERfkxkcycX4DvywS0z6WSTS2K3UxyvwFJxAPvb1N3hrggh0QVq7sc2FpD78JwE56ERtWTh6AlZPufo4X8Lo05ToFonkEriABEXfFWfe2hxznuOZSxtyRwAgbEzwwoZOUK7U6Sf47KfuHKUxzScBAJUApaCYi7425yLJSdPGHK60Ua9xdgS0V3w42QAMoZNEqX5GQtviPNC3447H4Uw3Hn/4CBwyqvzOZcHTvxQBI1PXp/MMAhg/awcCKCBbAk0A6F4JHt2Lccecq7Q4cwkCCXD8kI/rY2555iQRxKblXOsVsNI8xrV/IIABi0PatBHA63Z9nvyC5otV2+spoI25KxHGM36CaOAFHrDkwhfd3bDO6ZensQuMwxybuZArIQcC0hndAtIuAbzcCBJb60XK7XPsAggKIua83v5sbUtkFUsHRP2TAPwT+P1S93/9zP9z27Y8+WiAuv48b521VsbT1pPGx4GAHHSShSux86x3VZGs/OetVl/ww5Y+zO+5Q6LbXLnc/vrerxtwfVMyjxw/9db4uGy3jrGUmSfnor8lYHW2oCaiVpb+DmDZIILxJoTboYq7sitqTAIlIguzWFcfeSmSH4/tJcdamNOgP7YvQsRv0ogfu0D/v8mXBJAoryy63/QK5A589AUvGfh5SYKxLXAloLd+bXmeevja+B2PWE3CIqmLXYA/eTYSnziMkXISQFCbxSkFb/G+5jIHG4ceOrdAgm/b2AXo+hsvga0EzFwVH9C7xiOT84JtX08J4uYuYG7335DAHEieBJBgLUwCGFN39fVtUG79ISEBu2SoM6f9SxqP2LQkgMKMnyRtnts7flHdIG8/A3zFZA71ZewzHT8Iou0IMAEyExukixpfa9EFoxS4gCUg7foa05xJALG3W2Dbvvog8SMeklgAUXbMqq/rHLewcxOPNuSBgNWRYF4WbR/ZYDn9q5i8KPLr66uLbZ+xK3IuBRATMDTAuHXxM581JUn49S3wYk7mgUybsewfCHAgk6vn9jcB4HzW92Mwtv66A+g7D0kj9koA4MyJpAm+Jff+AH57bPdyxs3bYI3TweJjR4DJVol/B4rtb8J5AAIuzoAEr+4Oca5xVwLOtn8SAPjPn+0MeNy3Z78xs05xrnjsM74jICd0oHEfEZy+SZAC922QZ71AU3obYPstAeaxBupaCXjULiDe93V7LEIEL0w5F90YSjEqDwTgSEuJbrCZIF6DN2DbeYCeBKw648Ywz7oDzNWF1McKfst3r9tgO3fYERBh3Kw3cZjPuMgDAenE5HmNr6UmoQjGNkDPA3AFTN9dgC99Y5hrJWDmHIuxEsAtQqx7rTrSlyPskleVP2sfcYi7tiaAIGctC2GrG9zDkHnb9Xz1BSA2gQue/hyrpwbnBY0ck4AC9H2vv9mXbS0Wn773Kw5A0SWCfA1+vAN0neO8Oosl1q7TjtLETkzpykkGfc+CjYiNEMEqz0hgLo34k4BbHWj37c3PvPgIHtBcmYv8Z3U5P6X5kLbdLYAzzUmpkwS7yZAU4iHYbI5VFnjKP19/Pj6/9geh8ScBBW7Gr9WkMbYSwGq7+uaf86LOMxzm7OD1sSNAo04GyOdqJtqtxLgdEjT6XP0C71jPq5UzjwTc65sf8clLe/xsr6srAd7zmT/rOqvbmB04Pk4J0NlA2+8X41CpzkxWq6SexagDGH2SMHZI3zb1uwGNHBJw+d7f+9i5iOOKGxtpbs8k+hXhuYOLx4lh5Oqk8bEjIJ3xoa9E7wQchgO42y+LQnelkYCf12e9GtdOIA5+xpaAttejzR3HuCRAwHrwmXeeSRyCcVhn/Z2sPlaMOwJWJ50FT4F91Qlu8pQJvMEXYFf/C/3P15zHOI3YEsDWBig2muB5508CmHt6G1Rds8ZxKyUG43bw8TEJYGI2ndcA+GHLRJKATb3l+HmsiRkHYOsFwDjEEqi5qOPnqx57dQb0qU+cbx+529Y3T9ZhXcZREg89G/MgdRLg4OpI32Ld+lt/Y9tCkICzz4rTd/uj55Ngxqj4j77X45vgyROAeBRsntwBM1aBQvcW2ux74Cu+AwEQgVNe0zZeLjpJ6RSz6cvKQ4anfv5KFDZehMzhDuB93gJZfez9jv9Zj72vAh+7YM19zXt/1DnrDjzYsh0IsACcusA4VS1Y0MgsxD6rhZ3LZ/88C+pQdI7xJgH18xaHGK3B13sB83k7ZA5xWfl3+Y055ai/g9YH9mwHAhjUqWX5IzPpqjfQ2uLe3/w07vbvrf+nXoLydhivwsTlmgTwKlxfamjakJDH9v/+rP/YmHmKlLWW7Gf9xOw+SrRTAhjXGbleeRYA3hVtIuLXIYp13DOhfzitVaVQ4wqWHzhp3R8/enTMiOOPLsw39gTNY/CkXmJiP2uTACems7aUJKtoB+Yppovy5B9EuPXZyk3COAfwN64EsMo2bLwZ+uwXOLtL8BN41ZR1GTflGS5skwATK5lsy0DoHDibPD4SLc5Cuz9+NvevRuwM7MaVAPrq/NSVX3Scy7y89nUcd2tiUE/5lgALbFmHiVvfpA0u7kO3pDJX33tXG+A48IjVoHnZqRW39crXyY+NOfnYc7et+Wdd3Aonh7exUx4IIEi22cdc10wSKyFgt2ne+wJfJXOIxeWqX+5bbvpu/T78xl+DjGueJMJd0fWOWsHR/QC09ncE5CD6q8tkB7m8ikpMSkHceBKQo3ZB/7xdoG399lcE5bxdriVPjr2qecVmrh0BGtMZWwYlWfbRswB1gG5/FN0D2UDxyIwdcOXP208CEji6P7gaO+VZLWkTkziyj34ggMm2DIROYu6tLGArcDuY0NmerjIg0b24l/slqZ8Uxx3QOSrPegsQp2MTazxdrCHzZ31r7YlJHXkgACOTV2nAGpw7oBMOYuaJHduT4rxm4TXO9n+1AwDPEwD/79v2BrgDOeKbr0mLXZn1neFoYPFxSkCM78jYSNjfEhLju32vTJ3CrpAFMm7R/l+BHitf3/tv9T8/Ho/hN4DO+Ry6I27bahx5vJ715SImptRfEtCBOfarHZOM22Gsfu4E9H5m8+z3+T92AiS4E7gtjOt/bCCXf+9z57Q0Vt0KB2LH6luDMZVdPzdu1XrWDgTkxJ58yvIW0GLOZJMwzoBt5cftoK1IMZePQfJ5C/QBWsD7POEMCPBn+Yx1JgXumH3kgQAHcWYDtNRY0iCrpCi3+GGM7c9VgHbF88IyH4Pb11/j9G1yss0dR6557Ee5W/0nOPR5SYAOSAP/Vu5AVqGz30Q83+WN93Op/8X1s53+bPn77fk3vjl3xHHOb2XiONP/A3B8kO2nBFoEAAAAAElFTkSuQmCC",t.textureCache=new r.Texture,t.textureCache.image=i,i.onload=function(){t.textureCache.needsUpdate=!0}}return n._radius=e.radius||5,n._height=e.height||50,n._material=new r.MeshBasicMaterial({alphaMap:t.textureCache,transparent:!0,depthWrite:!1,color:e.color||16777215,side:r.DoubleSide}),n.contentHolder.add(n._createBeam(n._radius,n._height)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),c(t,[{key:"destruct",value:function(){this._disposeBeam(),function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"_disposeBeam",value:function(){this.contentHolder.traverse(function(e){"Mesh"===e.type&&(e.geometry.dispose(),e.material.map&&e.material.map.dispose(),e.material.dispose())}),this.contentHolder.remove.apply(this.contentHolder,this.contentHolder.children)}},{key:"_createBeam",value:function(e,t){var n=new r.Object3D,i=new r.PlaneGeometry(2*e,t).rotateX(Math.PI/2).translate(0,0,t/2),o=new r.Mesh(i,this._material),a=new r.Mesh(i.clone().rotateZ(2*Math.PI/3),this._material),u=new r.Mesh(i.clone().rotateZ(2*-Math.PI/3),this._material);o.renderOrder=l.default.LIGHTBEAM_RENDER_ORDER,a.renderOrder=l.default.LIGHTBEAM_RENDER_ORDER,u.renderOrder=l.default.LIGHTBEAM_RENDER_ORDER;var c=s.default.scale/s.default.EARTH_RADIUS;return o.applyMatrix((new r.Matrix4).makeScale(c,c,c)),a.applyMatrix((new r.Matrix4).makeScale(c,c,c)),u.applyMatrix((new r.Matrix4).makeScale(c,c,c)),n.add(o),n.add(a),n.add(u),n}},{key:"radius",set:function(e){!isNaN(e)&&e>0&&e!==this._radius&&(this._disposeBeam(),this.contentHolder.add(this._createBeam(e,this._height)),this._radius=e)},get:function(){return this._radius}},{key:"height",set:function(e){!isNaN(e)&&e>0&&e!==this._height&&(this._disposeBeam(),this.contentHolder.add(this._createBeam(this._radius,e)),this._height=e)},get:function(){return this._height}},{key:"color",set:function(e){this._material.color.set(e)},get:function(){return this._material.color}}]),t}();h.textureCache=void 0,t.default=h,e.exports=t.default},i=[e,t,r(0),r(5),r(1),r(7)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=p(r),c=p(i),h=p(o),f=p(a),d=p(l);function p(e){return e&&e.__esModule?e:{default:e}}var m=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function v(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var g=function e(t,r,n,i){var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,i)}else if("value"in o&&o.writable)o.value=n;else{var s=o.set;void 0!==s&&s.call(i,n)}return n};var y=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=e.volume;if(r.hasTopCover=!1,r.hasBottomCover=!1,r.bottom=void 0===r.bottom||null===r.bottom?.1:r.bottom,!function(e){if("number"!=typeof r.top||"number"!=typeof r.bottom)return console.warn("[ZoneMarker] the top and bottom must be a number"),!1;var n=!1;for(var i in t.TAG_ORIENTATION){var o=t.TAG_ORIENTATION[i];if(o===e.tagOrientation){n=!0;break}}n||(e.tagOrientation=t.TAG_ORIENTATION.HORIZONTAL);if(!(e.textOptions&&e.textOptions.text||e.imgUrl&&""!==e.imgUrl))return console.warn("ZoneMarker a valid textOption with non-empty text or a non-empty imgUrl must be provided",e),!1;return!0}(e))return void 0,v(i,void 0);var i=v(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));i._property.type="ZoneMarker",i._tagOrientation=e.tagOrientation,i._property.tagOrientation=i._tagOrientation,i._tagScale="number"==typeof e.tagScale?e.tagScale:1,i._property.tagScale=i._tagScale,i._color=e.volume.color?e.volume.color:16777215,i._property.color=i._color,i._opactiy="number"==typeof e.volume.opacity?e.volume.opacity:1,i._property.opacity=i._opactiy,i._imgUrl=e.imgUrl,i._property.imgUrl=i._imgUrl,i._textOptions=e.textOptions,i._property.textOptions=i._textOptions,i.extrudeMesh.material.depthWrite=!1,i.extrudeMesh.material.depthTest=!0,i.extrudeMesh.material.alphaMap=t.alphaMap,i.extrudeMesh.material.needsUpdate=!0;for(var o=i.otherCover.faces,a=i.otherCover.uvs,l=i.extrudeMesh.geometry.vertices,u=t.alphaMap.image.width/t.alphaMap.image.height,c=0,h=0;h<a.length;h+=2){var f=o[h].a,d=o[h].b,p=o[h].c,m=l[f].clone().sub(l[d]).length()/l[f].clone().sub(l[p]).length()*1/u;a[h]=[new n.Vector2(c,1),new n.Vector2(c+m,1),new n.Vector2(c,0)],a[h+1]=[new n.Vector2(c+m,1),new n.Vector2(c+m,0),new n.Vector2(c,0)],c+=m}i.extrudeMesh.geometry.faceVertexUvs[0]=[].concat(a),i.extrudeMesh.geometry.uvsNeedUpdate=!0;for(var g=i._points[0].array,y=0;y<i._points.length;++y)if(!i._points[y].hole){g=i._points[y].array;break}var _=i._lnglatalt2localxyz(i.position),w=i._lnglatalt2localxyz({lng:i.position.lng,lat:i.position.lat,alt:i.position.alt+1});i._unitAltVec3=w.clone().sub(_),i._tagAspectRatio=1,i._boundaryPtsvec3=g.map(function(e){var t={lng:e.lng,lat:e.lat,alt:i._bottom};return i._lnglatalt2localxyz(t)}),i._tagAlignIndex=0;var b,x,k,A,M=i._getAlignTagParams(i._boundaryPtsvec3[0],i._boundaryPtsvec3[1],i._tagOrientation,i._bottom),S=(b=M.positionArray,x=[0,0,1,0,0,1,1,1],k=[0,1,2,2,1,3],(A=new n.BufferGeometry).addAttribute("position",new n.Float32BufferAttribute(new Float32Array(b),3)),A.addAttribute("uv",new n.Float32BufferAttribute(new Float32Array(x),2)),A.index=new n.Uint16BufferAttribute(new Uint16Array(k),1),A),P=new n.MeshBasicMaterial({transparent:!0,map:null,depthWrite:!1,depthTest:!0,color:i._color,opacity:i._opactiy,side:n.DoubleSide}),T=new n.Mesh(S,P);T.position.copy(M.position),T.scale.set(i._tagScale,i._tagScale,i._tagScale),i.tag=T,i.contentHolder.add(i.tag),i._textOptions&&i._textOptions.text?i.textOptions=i._textOptions:i.imgUrl=i._imgUrl;for(var O=[],C=0;C<g.length-1;++C){var E=180*new n.Vector2(g[C+1].lng-g[C].lng,g[C+1].lat-g[C].lat).angle()/Math.PI;O.push(E)}return i._angles=O,i._tagAnimation=new s.Animation({tagOrientation:i._tagOrientation,opacityInscrease:!0},function(e){var r=e.tagOrientation;if(r===t.TAG_ORIENTATION.VERTICAL){if(i.tag.material.opacity+=.1,i.tag.material.opacity<i._opactiy)return!0}else if(r===t.TAG_ORIENTATION.HORIZONTAL){var n=e.opacityInscrease;if(i.tag.material.opacity+=n?.1:-.1,i.tag.material.opacity>=i._opactiy&&(e.opacityInscrease=!1),i.tag.material.opacity>0)return!0}var o=i._tagAlignIndex;return i._alignTag(i._boundaryPtsvec3[o],i._boundaryPtsvec3[o+1],i._tagOrientation,i._bottom),i.tag.material.opacity=i._opactiy,!1},100),i._uvAnimation=new s.Animation({offsetv:0,speed:.1},function(e){var t=e.speed;e.offsetv-=t;for(var r=i.extrudeMesh.geometry.faceVertexUvs[0],n=0;n<r.length;n+=1)for(var o=0;o<r[n].length;o+=1)r[n][o].x-=t,e.offsetv<=-1&&(r[n][o].x+=1);return e.offsetv<=-1&&(e.offsetv+=1),i.extrudeMesh.geometry.faceVertexUvs[0]=r,i.extrudeMesh.geometry.uvsNeedUpdate=!0,!0},100),i._uvAnimation.start(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),m(t,[{key:"_lnglatalt2localxyz",value:function(e){void 0===this.system&&(this.system=c.default.getLocalSystemOnEarthSurface(h.default.EarthResolution,this.position.lng,this.position.lat,h.default.scale));var t=c.default.getNoneGroundCartesianFromLngLatAlt(h.default.EarthResolution,e.lng,e.lat,e.alt,h.default.scale).clone().sub(this.system.origin),r=1*t.dot(this.system.lng),i=1*t.dot(this.system.lat),o=t.dot(this.system.alt);return new n.Vector3(r,i,o)}},{key:"_getAlignTagParams",value:function(e,r,n,i){var o=this._unitAltVec3.clone(),a=e.clone(),s=r.clone(),l=a.clone().add(s).multiplyScalar(.5);a.sub(l),s.sub(l);var u=s.clone().sub(a),c=u.length(),f=void 0,d=void 0,p=void 0,m=void 0;if(n===t.TAG_ORIENTATION.HORIZONTAL){var v=u.clone().cross(o.clone().normalize()).normalize().multiplyScalar(c/this._tagAspectRatio);f=a.clone().add(v),d=s.clone().add(v),p=a.clone(),m=s.clone()}else{var g=o.clone().normalize().multiplyScalar(c/this._tagAspectRatio);f=a.clone(),d=s.clone(),p=f.clone().add(g),m=d.clone().add(g)}return l.z=i*h.default.scale/h.default.EARTH_RADIUS,{positionArray:[f.x,f.y,f.z,d.x,d.y,d.z,p.x,p.y,p.z,m.x,m.y,m.z],position:l}}},{key:"_alignTag",value:function(e,t,r,n){var i=this._getAlignTagParams(e,t,r,n);this.tag.geometry.attributes.position.setArray(new Float32Array(i.positionArray)),this.tag.geometry.attributes.position.needsUpdate=!0,this.tag.position.copy(i.position)}},{key:"destruct",value:function(){this._uvAnimation.stop(),this._tagAnimation.stop(),this.contentHolder.remove(this.tag),this.tag&&(this.tag.geometry&&this.tag.geometry.dispose(),this.tag.material&&(this.tag.material.map&&this.tag.material.map.dispose(),this.tag.material.dispose())),function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"onCameraChange",value:function(e){for(var r=e.north,n=[],i=0;i<this._angles.length;++i){var o=this._angles[i],a=Math.abs(o-r);a=a<360-a?a:360-a,n.push({angle:o,index:i,diff:a})}n.sort(function(e,t){return e.diff-t.diff});var s=n[0].index;s!==this._tagAlignIndex&&(this._tagAnimation.stop(),this._tagAlignIndex=s,this._alignTag(this._boundaryPtsvec3[s],this._boundaryPtsvec3[s+1],t.TAG_ORIENTATION.VERTICAL,this._bottom),this.tag.material.opacity=0,this._tagAnimation.changeStates({tagOrientation:this._tagOrientation,opacityInscrease:!0}),this._tagAnimation.start())}},{key:"hasTopCover",set:function(e){console.warn("ZoneMarker cannot set hasTopCover: must be false",e)},get:function(){return!1}},{key:"hasBottomCover",set:function(e){console.warn("ZoneMarker cannot set hasBottomCover: must be false",e)},get:function(){return!1}},{key:"top",set:function(e){"number"==typeof e?g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"top",e,this):console.warn("ZoneMarker top must be a number")},get:function(){return this._top}},{key:"bottom",set:function(e){if("number"==typeof e){g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"bottom",e,this);var r=this._tagAlignIndex;this._alignTag(this._boundaryPtsvec3[r],this._boundaryPtsvec3[r+1],this._tagOrientation,this._bottom)}else console.warn("ZoneMarker top must be a number")},get:function(){return this._bottom}},{key:"tagOrientation",set:function(e){var r=!1;for(var n in t.TAG_ORIENTATION){if(e===t.TAG_ORIENTATION[n]){r=!0;break}}if(r){this._tagOrientation=e;var i=this._tagAlignIndex;this._alignTag(this._boundaryPtsvec3[i],this._boundaryPtsvec3[i+1],this._tagOrientation,this._bottom)}else console.warn("ZoneMarker set tagOrientation not valid",e)},get:function(){return this._tagOrientation}},{key:"tagScale",set:function(e){this._tagScale=e,this._property.tagScale=e,this.tag.scale.set(this._tagScale,this._tagScale,this._tagScale)},get:function(){return this._tagScale}},{key:"color",set:function(e){g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"color",e,this),this.tag.material.color.set(e)},get:function(){return this._color}},{key:"opacity",set:function(e){g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"opacity",e,this),this.tag.material.opacity=e},get:function(){return this._opactiy}},{key:"tagTexture",set:function(e){this.tag.material.map&&(this.tag.material.map.dispose(),this.tag.material.map=null),this.tag.material.map=e.texture,this.tag.material.needsUpdate=!0,this._tagAspectRatio=e.aspectRatio;var t=this._tagAlignIndex;this._alignTag(this._boundaryPtsvec3[t],this._boundaryPtsvec3[t+1],this._tagOrientation,this._bottom)}},{key:"imgUrl",set:function(e){var t=this;this._textureLoader||(this._textureLoader=new d.default),this._textureLoader.load(e,function(r){var n=r.image?r.image.width/r.image.height:1;n="number"==typeof n?n:1,t.tagTexture={texture:r,aspectRatio:n},t._imgUrl=e,t._property.imgUrl=t._imgUrl})},get:function(){return this._imgUrl}},{key:"textOptions",set:function(e){var t=64*e.text.length+64,r=Math.log(t)/Math.log(2);r=Math.floor(r)+1,t=Math.pow(2,r);var n=new f.default(t,128);n=n.drawTextCooked(e),this.tagTexture={texture:n.texture,aspectRatio:t/128},this._textOptions=e,this._property.textOptions=this._textOptions},get:function(){return this._textOptions}}]),t}();y.TAG_ORIENTATION={VERTICAL:0,HORIZONTAL:1};for(var _=[],w=0;w<128;++w){for(var b=Math.abs(w-64),x=64-b,k=0;k<64+4*x;++k)_.push(0);for(var A=0;A<128;++A)_.push(255);for(var M=0;M<64+4*b;++M)_.push(0)}var S=new n.DataTexture(Uint8Array.from(_),128,128,n.RGBAFormat,n.UnsignedByteType,n.UVMapping);S.minFilter=S.magFilter=n.LinearFilter,S.wrapS=S.wrapT=n.RepeatWrapping,S.needsUpdate=!0,y.alphaMap=S,t.default=y,e.exports=t.default},i=[e,t,r(20),r(0),r(3),r(1),r(18),r(10),r(8)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.drawGeoJson=function(e,t){for(var r=[],n=function(e){var t=[];if("Feature"===e.type){var r=void 0;r=Object.keys(e.properties.tags).indexOf("height")>-1?parseFloat(e.properties.tags.height):20,t.push({geometry:e.geometry,height:r})}else if("FeatureCollection"===e.type)for(var n=0;n<e.features.length;n++){var i=void 0;i=Object.keys(e.features[n].properties.tags).indexOf("height")>-1?parseFloat(e.features[n].properties.tags.height):20,t.push({geometry:e.features[n].geometry,height:i})}else{if("GeometryCollection"!==e.type)throw new Error("The geoJSON is not valid.");for(var o=0;o<e.geometries.length;o++)t.push({geometry:e.geometries[o],height:20})}return t}(e),i=0;i<n.length;i++)if("Polygon"===n[i].geometry.type)for(var o=0;o<n[i].geometry.coordinates.length;o++){for(var a=n[i].geometry.coordinates[o],s=n[i].height,l=[],u=0;u<a.length;u++)l.push(new altizure.LngLatAlt(a[u][0],a[u][1],10));var c={points:l,height:s,color:15827200,opacity:.2};r.push(c)}else if("MultiPolygon"===n[i].geometry.type)for(var h=0;h<n[i].geometry.coordinates.length;h++)for(var f=0;f<n[i].geometry.coordinates[h].length;f++){for(var d=n[i].geometry.coordinates[h][f],p=n[i].height,m=[],v=0;v<d.length;v++)m.push(new altizure.LngLatAlt(d[v][0],d[v][1],10));var g={points:m,height:p,color:15827200,opacity:.2};r.push(g)}return r}},i=[t],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o,a,s,l,u,c,h,f,d,p,m,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=O(r),y=O(i),_=O(o),w=O(a),b=O(s),x=O(l),k=O(u),A=O(c),M=O(h),S=O(f),P=O(d),T=O(p);function O(e){return e&&e.__esModule?e:{default:e}}var C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var I=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function R(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var L=function(e){function t(e,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!function(e,t){if(!document.getElementById(e))return console.error("div "+e+" is missing."),!1;if(!t||!t.altizureApi||!t.altizureApi.key)return console.error("Altizure sdk key is not found."),!1;t.altizureApi.region||(t.altizureApi.region="CN");t.altizureApi.apiUrl||("CN"===t.altizureApi.region?t.altizureApi.apiUrl="http://172.18.22.83:18082/graphql":t.altizureApi.apiUrl="http://172.18.22.83:18082/graphql");t.api||(t.api={API_HOST:"CN"===t.altizureApi.region?"U2FsdGVkX19enjJDPTJs2Zkb1880sX2VrUVFR1idrIMd2OVTWJ8ikJuhXVLznFJz6FqE75R+Q6rfgSaWW2C6ZA==":"U2FsdGVkX19enjJDPTJs2Zkb1880sX2VrUVFR1idrIMd2OVTWJ8ikJuhXVLznFJz6FqE75R+Q6rfgSaWW2C6ZA==",API_KEY:""});return!0}(e,r))return void 0,R(o,void 0);var i=function(e){if(e.eventHandlers&&e.eventHandlers.onContentInitialized){var t=e.eventHandlers.onContentInitialized;e.eventHandlers.onContentInitialized=function(){t(),s()}}else e.eventHandlers||(e.eventHandlers={}),e.eventHandlers.onContentInitialized||(e.eventHandlers.onContentInitialized=function(){s()});return e}(r),o=R(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),a=o;function s(){r.composer?a._import(r.composer):r.metaInfo&&(a._metaInfo=new P.default(r.metaInfo),a._import(JSON.parse(a.metaInfo.scene)))}return o.HOST=r.HOST,o._apiService=new n.AltizureApi({apiUrl:r.altizureApi.apiUrl,key:r.altizureApi.key,altitoken:r.altizureApi.altitoken}),o._mouseInteraction=null,o._updateGPUPicker=null,o._updateZoneMarkers=null,o._metaInfo=null,o._bonCameraChange=o._onCameraChange.bind(o),o.GL={_maxAnisotropy:o.renderer.capabilities.getMaxAnisotropy()},r.renderItems&&r.renderItems.quality&&(o.quality=r.renderItems.quality),function(){(function(){a._mouseInteraction=new S.default({camera:a.viewerCamera,domElement:a.domElement,scene:a.markerLayer.sceneNode,renderer:a.renderer,snapshoter:a.snapshoter});var e={promiseFn:function(e){var t=e.force;return a.interaction.gpuPicker.update(t),Promise.resolve()},timer:500,timeout:2e3,debug:!1};a._updateGPUPicker=new n.RefreshQueue(e),a._updateZoneMarkers=new v.Debounce(function(){for(var e=a.camera.pose,t=0;t<a.markerLayer.children.length;++t){var r=a.markerLayer.children[t];"ZoneMarker"===r._property.type&&r.onCameraChange(e)}},500),a.on("cameraChange",a._bonCameraChange)})(),y.default.MAXANISOTROPY=a.GL._maxAnisotropy,a.earthView.animate=a.animate.bind(a)}(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,g.default),I(t,[{key:"destruct",value:function(){this.apiService.destruct(),this.off("cameraChange",this._bonCameraChange),function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"add",value:function(e,t){var r=this,n={pose:{position:t.pose&&t.pose.position?t.pose.position:t.position,orientation:t.pose&&t.pose.orientation?t.pose.orientation:t.orientation,scale:t.pose&&t.pose.scale?t.pose.scale:t.scale}};if("AltizureProjectMarker"===e)return function(e){return o(e)}(t);if("PublicAltizureProjectMarker"===e)return o(t);if("AltizureProjectInfo"===e)return function(e){return a(e.info,e.data)}(t);if("TagMarker"===e)return function(e){var t=Object.assign(e,n,{earth:r}),i=new w.default(t);return Promise.resolve(i)}(t);if("PolygonMarker"===e)return function(e){for(var t=e.volume,i=0;i<t.points.length;++i)t.points[i]=new b.default(t.points[i].lng,t.points[i].lat,t.points[i].alt);var o=Object.assign(e,n,{volume:t,earth:r}),a=new x.default(o);return Promise.resolve(a)}(t);if("OBJMarker"===e)return function(e){var t=Object.assign(e,n,{earth:r}),i=new _.default(t);return Promise.resolve(i)}(t);if("TextTagMarker"===e)return function(e){var t=Object.assign(e,n,{earth:r}),i=new k.default(t);return Promise.resolve(i)}(t);if("PolyFenceLineMarker"===e)return function(e){var t=Object.assign(e,n,{earth:r}),i=new M.default(t);return Promise.resolve(i)}(t);if("PolyCylinderLineMarker"===e)return function(e){var t=Object.assign(e,n,{earth:r}),i=new A.default(t);return Promise.resolve(i)}(t);var i="[Sandbox.add] unknown type "+e;return console.warn(i),Promise.reject(new Error(i));function o(e){return r.apiService.project({pid:e.pid}).then(function(t){return a(t,e)}).catch(function(e){return console.warn("[Sandbox.add] AltizureProjectMarker failed",e),Promise.reject(e)})}function a(e,t){if(!e)return Promise.reject(new Error("Invalid info."));e.views=1e3,n.pose.position||(n.pose.position={lng:e.geoInfo.centerLong,lat:e.geoInfo.centerLat,alt:.01});var i=Object.assign(t,n,{earth:r,projInfo:e,materialDescriptions:t.materialDescriptions,patrolRoutes:t.patrolRoutes,HOST:r.HOST,eventHandlers:t.eventHandlers,showTileBBox:t.showTileBBox}),o=new y.default(i);return Promise.resolve(o)}}},{key:"positionsAltitude",value:function(e,t){if(e instanceof Array&&(void 0===t||t instanceof Array)){void 0===t&&(t=[],this.markerLayer.children.map(function(e){e instanceof y.default&&t.push(e)}));var r=[],n=[],i=[],o=[];t.map(function(e){var t=e._apiInfo.geoInfo,a=t.maxLat,s=t.maxLong,l=t.minLat,u=[{lng:t.minLong,lat:l},{lng:s,lat:a}],c=e.pickDepthMap(u,!0),h=E(c,3),f=h[1],d=h[2];r.push(d),n.push(f),i.push(e.projInfo.max_bound.z-e.projInfo.min_bound.z),o.push(e.position.alt)});var a=[];return e.map(function(e){var t=0;n.map(function(n,a){if(e.lng>n[1].lng&&e.lng<n[0].lng&&e.lat>n[1].lat&&e.lat<n[0].lat){var s,l,u,c;s=n,l=r[a],u=i[a],c=o[a];var h=function(e,t,r,n,i){if(void 0===t)return 0;var o=t[0].lat-t[1].lat,a=t[0].lng-t[1].lng,s=r.dimension.width,l=r.dimension.height,u=r.buffer,c=0+i,h=n+i,f=(e.lat-t[1].lat)/o,d=(e.lng-t[1].lng)/a,p=1===d?parseInt(s*d)-1:parseInt(s*d),m=1===f?parseInt(l*f)-1:parseInt(l*f);if(d>=0&&d<=1&&f>=0&&f<=1){var v=m*s+p,g=(1-u[v]/255)*(h-c)+c;return g}return 0}(e,s,l,u,c);h>t&&(t=h)}}),a.push(t)}),a}console.error("Bad arguments",e,t)}},{key:"exportToServer",value:function(e){return console.log("exportToServer",e),this.save(e)}},{key:"importFromServer",value:function(e){return console.log("importFromServer",e),this.load(e)}},{key:"_import",value:function(e){var t=[],r=[],n=[],i=[],o=[],a=[],s=[],l=[],u=this,c=!1,h=function(e){c?console.log("Initialized",e):(c=!0,console.log("first",e),u.camera.lookAt(e,0,45))};!function e(u){var c=u.property.type;var h={pose:u.property.pose,patrolRoutes:u.property.patrolRoutes,materialDescriptions:u.property.materialDescriptions,eventHandlers:u.property.eventHandlers,name:u.property.name,visible:u.property.visible,interactable:u.property.interactable,clickable:u.property.clickable};"AltizureProjectMarker"===c?t.push(Object.assign({},h,{pid:u.property.id})):"OBJMarker"===c?r.push(Object.assign({},h,{objUrl:u.property.objUrl,mtlUrl:u.property.mtlUrl,shape:u.property.shape,upDir:u.property.upDir})):"TagMarker"===c?n.push(Object.assign({},h,{name:u.property.name,scale:u.property.scale,imgUrl:u.property.imgUrl})):"PolygonMarker"===c?i.push(Object.assign({},h,{volume:u.property.volume,name:u.property.name})):"TextTagMarker"===c?s.push(Object.assign({},h,{text:u.property.text,textStyle:u.property.textStyle})):"PolyFenceLineMarker"===c?o.push(Object.assign({},h,{points:u.property.points,lineWidth:u.property.lineWidth,color:u.property.color,fenceHeight:u.property.fenceHeight,depthTest:u.property.depthTest,opacity:u.property.opacity,textOptions:u.property.textOptions,labelsVisible:u.property.labelsVisible})):"PolyCylinderLineMarker"===c?a.push(Object.assign({},h,{points:u.property.points,lineWidth:u.property.lineWidth,color:u.property.color,depthTest:u.property.depthTest,textOptions:u.property.textOptions,labelsVisible:u.property.labelsVisible})):l.push(u.property);if(u.children&&u.children instanceof Array)for(var f=0;f<u.children.length;f++)e(u.children[f])}(e);var f=[];return d("AltizureProjectMarker",t,f),d("OBJMarker",r,f),d("TagMarker",n,f),d("PolygonMarker",i,f),d("PolyFenceLineMarker",o,f),d("PolyCylinderLineMarker",a,f),d("TextTagMarker",s,f),Promise.all(f);function d(e,t,r){for(var n=function(n){var i=u.add(e,t[n]).then(function(e){h(e)}).catch(function(e){return console.log(t[n],e),Promise.resolve()});r.push(i)},i=0;i<t.length;++i)n(i)}}},{key:"polygonsFromGeoJson",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.warn("Please check altizure-plugin-geojson: https://unpkg.com/altizure-plugin-geojson")}},{key:"queryGeoJsonForAltizureProjectMarker",value:function(e){console.warn("Please check altizure-plugin-geojson: https://unpkg.com/altizure-plugin-geojson")}},{key:"animate",value:function(){}},{key:"updateVisibility",value:function(){this.earthView.updateVisibility()}},{key:"on",value:function(e,t){switch(e){case"cameraChange":this.earthView.control.addEventListener("onCameraChange",t);break;default:console.log("unknown eventType "+e)}}},{key:"off",value:function(e,t){switch(e){case"cameraChange":this.earthView.control.removeEventListener("onCameraChange",t);break;default:console.log("unknown eventType "+e)}}},{key:"login",value:function(e){if(!function(){if(!e)return!1;if(!e.altitoken)return!1}())return console.error("Invalid login info",e),!1;this._apiService.key=e.kep,this._apiService.altitoken=e.altitoken}},{key:"dbCreate",value:function(e){void 0===e&&(e=(new Date).toString());var t=this;return this.apiService.createProjectSolution({name:e}).then(function(e){return t._metaInfo=new P.default(e),Promise.resolve(t.metaInfo)})}},{key:"dbUpdate",value:function(){var e=this;return this.apiService.updateProjectSolution({id:this.metaInfo.id,options:{data:{name:this.metaInfo.name,scene:JSON.stringify(this.JSON)},preserveScene:!0}}).then(function(t){return e.metaInfo.update(t),Promise.resolve(e.metaInfo)})}},{key:"dbRemove",value:function(){var e=this;return this.apiService.removeProjectSolution({id:this.metaInfo.id}).then(function(t){e._metaInfo=null})}},{key:"dbRead",value:function(e){return this.apiService.solution({sid:e})}},{key:"save",value:function(e){console.log("save",this.metaInfo);var t=this;return this.metaInfo?(console.log("dbUpdate"),this.dbUpdate().then(function(e){return console.log(e),e})):(console.log("dbCreate"),this.dbCreate(e).then(function(e){return console.log(e),t.save()}))}},{key:"load",value:function(e){var t=this;return this.dbRead(e).then(function(e){return console.log("res",e),t._metaInfo=new P.default(e),console.log("scene",t.metaInfo),t._import(JSON.parse(t.metaInfo.scene))})}},{key:"_changeAltizureDisplayMode",value:function(e,t){if(5===t){var r=this.spotLight;r.enabled=!0;var n=this.control.POS.position;r.setPose({position:n})}else{this.spotLight.enabled=!1}return this.viewerCamera.remove(this.lights.point),7===t&&this.viewerCamera.add(this.lights.point),1===t&&this.viewerCamera.add(this.lights.point),e.changeDisplayMode(t)}},{key:"render",value:function(e,t){var r={TEXTURE:0,FLAT:1,WIREFRAME:2,SELECT:3,CROP:4,VISIBILITY:5,TRANSPARENT:6,PHONG:7}[t.toUpperCase()];if(void 0!==r)return this._changeAltizureDisplayMode(e,r);console.warn("Unknown render mode",t)}},{key:"_onCameraChange",value:function(){this._updateGPUPicker.add({force:!0}),this._updateZoneMarkers()}},{key:"_refreshOffset",value:function(){this.control.updateOffset()}},{key:"metaInfo",get:function(){return this._metaInfo}},{key:"apiService",get:function(){return this._apiService}},{key:"camera",get:function(){var e=this,t=e.earthView.control,r={get pose(){return t.pose},set pose(e){t.pose=e},set range(e){var r=e.tilt,n=e.alt;return void 0!==r&&t.tiltRange(r),void 0!==n&&t.altRange(n),!0},flyTo:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2500;return t.flyToPose(e,r)},stop:function(){return t.stopFlying()},lookAt:function(r,i,o,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e3,l={};"object"===(void 0===i?"undefined":C(i))?(l=i,s="number"==typeof o?o:s):(l.north=i,l.tilt=o,l.alt=a);var u=function(t,r){var i=r.north,o=r.tilt,a=r.alt,s=new m.Vector3(-Math.cos((i-90)*Math.PI/180)*Math.tan(o*Math.PI/180),-Math.sin((i-90)*Math.PI/180)*Math.tan(o*Math.PI/180),-1).normalize(),l=function(e){var t=e.position;"number"==typeof e.pinLength&&(t.alt+=e.pinLength);return t}(t),u=n.EarthMath.getLocalSystemOnEarthSurface(T.default.EarthResolution,l.lng,l.lat,T.default.scale),c=-l.alt/s.z*s.x,h=-l.alt/s.z*s.y,f=T.default.scale/T.default.EARTH_RADIUS,d=u.origin.clone(),p=u.lng.clone().multiplyScalar(f*c),v=u.lat.clone().multiplyScalar(f*h);d=d.add(p).add(v);var g=n.EarthMath.getLngLatAltFromNoneGroundCartesian(T.default.EarthResolution,d,T.default.scale),y=g.lng,_=g.lat,w=void 0,b=void 0,x=void 0;if(void 0===a||null===a){w=new m.Vector3(-Math.cos((i-90)*Math.PI/180)*Math.cos(o*Math.PI/180),-Math.sin((i-90)*Math.PI/180)*Math.cos(o*Math.PI/180),Math.sin(o*Math.PI/180)).normalize(),b=e.earthView.camera.fov,x=e.earthView.camera.aspect;var k=t._interactBox();if(0!==k.length){var A=function(e,t,r,n,i){var o=e.map(function(e){return function(e,t,r,n,i){var o=e.clone().dot(t),a=t.clone().multiplyScalar(o),s=e.clone().sub(a),l=r.clone().multiplyScalar(s.clone().dot(r)),u=s.clone().sub(l),c=l.length()/Math.tan(n/2*Math.PI/180),h=u.length()/(Math.tan(n/2*Math.PI/180)*i);return Math.max(c,h)+(o>0?-a.length():a.length())}(e,t,r,n,i)});return Math.max.apply(Math,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(o))}(k,s,w,b,x),M=l.alt/Math.cos(o*Math.PI/180)+A;a=M}else console.warn("[Sandbox] camera.lookAt alt improvement not supported for ",t)}return{lng:y,lat:_,alt:a,north:i,tilt:o}}(r,l);return t.flyToPose(u,s)},matToPose:function(e){console.error("matToPose is under repair.")},get mat(){return t.camToEarth.elements},flyToMat:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;if(isNaN(r)||r<=0||r>9999999)return Promise.reject(new Error(r+"is not a valid number."));var n=(new m.Matrix4).fromArray(e);return t.flyToMat(n,r)},flyToCamToEarth:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;if(isNaN(r)||r<=0||r>9999999)return Promise.reject(new Error(r+"is not a valid number."));var n=(new m.Matrix4).fromArray(e);return t.flyToMat(n,r)}};return Object.defineProperty(this,"camera",{value:r,writable:!1,configurable:!0}),this.camera}},{key:"lights",get:function(){return{ambient:this.earthView.lights.ambient,point:this.earthView.lights.point}}},{key:"JSON",get:function(){return this.markerLayer.JSON}},{key:"interaction",get:function(){return this._mouseInteraction}},{key:"control",get:function(){return this.earthView.control}},{key:"Math",get:function(){return n.EarthMath}},{key:"Constants",get:function(){return T.default}},{key:"width",get:function(){return this.earthView.width}},{key:"height",get:function(){return this.earthView.height}},{key:"window",get:function(){var e=this,t={toLngLatAlt:function(t){var r=t.x,n=t.y,i=e.pickOnProjects({x:r,y:n});return i||(i=e.pick({x:r,y:n})),i},fromLngLatAlt:function(t){var r=t.lng,i=t.lat,o=t.alt,a=n.EarthMath.getNoneGroundCartesianFromLngLatAlt(T.default.EarthResolution,r,i,o,T.default.scale);if(a){var s=a.applyMatrix4(e.markerLayer.matrixWorld).project(e.viewerCamera),l=e.earthView.control.mapToWindow(s.x,s.y);return{x:l.x,y:l.y}}},screenshot:function(t){var r=e.renderer.getSize(),n=Object.assign({},r);t&&"number"==typeof t.width&&(n.width=t.width),t&&"number"==typeof t.height&&(n.height=t.height);var i=e.renderer.getContext();if(i){var o=new m.WebGLRenderTarget(n.width,n.height,{minFilter:m.NearestFilter,magFilter:m.NearestFilter,format:m.RGBAFormat}),a=new Uint8Array(n.width*n.height*4);e.renderer.setSize(n.width,n.height),e.earthView.camera.aspect=n.width/n.height,e.earthView.camera.updateProjectionMatrix(),e.renderer.render(e.earthView.scene,e.earthView.camera,o,!0),i.readPixels(0,0,n.width,n.height,i.RGBA,i.UNSIGNED_BYTE,a),e.renderer.setSize(r.width,r.height),e.earthView.camera.aspect=r.width/r.height,e.earthView.camera.updateProjectionMatrix();for(var s=0;s<n.width;++s)for(var l=0;l<n.height/2;++l)for(var u=4*(n.width*l+s),c=4*(n.width*(n.height-1-l)+s),h=0;h<4;++h){var f=a[u+h];a[u+h]=a[c+h],a[c+h]=f}return{data:a,width:n.width,height:n.height}}console.warn("[Sandbox] window screenshot no context")}};return Object.defineProperty(this,"window",{value:t,writable:!1,configurable:!0}),this.window}},{key:"visibilityCamera",set:function(e){e?(this.__currentCameraMarker!==e&&(this.__currentCameraMarker&&this.__currentCameraMarker.unbindSpotLight(),this.__currentCameraMarker=e),e.bindSpotLight(this.spotLight)):(this.__currentCameraMarker.unbindSpotLight(),this.__currentCameraMarker=void 0)},get:function(){return this.__currentCameraMarker}},{key:"spotLight",get:function(){return this.earthView.spotLights[0]}},{key:"quality",set:function(e){isNaN(e)||(e=Math.max(1,Math.min(666666,e)),y.default.quality=e)},get:function(){return y.default.quality}}]),t}();t.default=L,e.exports=t.default},i=[e,t,r(21),r(4),r(13),r(29),r(30),r(6),r(19),r(17),r(35),r(33),r(91),r(94),r(1),r(0),r(10)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(r),o=a(n);function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(){var e=!0;try{t=Object.assign({},{capacity:100},t)}catch(t){console.error("MouseInteraction",t),e=!1}return e=e&&t.camera&&t.domElement&&t.scene&&t.renderer}()){this.capacity=t.capacity,this.camera=t.camera,this.listening=function(){for(var t={},r=e.MouseEventList,n=0;n<r.length;n++)t[r[n]]={};return t}(),this.domElement=t.domElement;var r,n=this;this.mouseOffset={left:(r=n.domElement.getBoundingClientRect()).left,top:r.top},this.domElement.addEventListener("mousedown",i),this.domElement.addEventListener("mouseup",a),this.domElement.addEventListener("mousemove",s),this.domElement.addEventListener("touchstart",l),this.domElement.addEventListener("touchend",u),this.removeListeners=function(){n.domElement.removeEventListener("mousedown",i),n.domElement.removeEventListener("mouseup",a),n.domElement.removeEventListener("mousemove",s),n.domElement.removeEventListener("touchstart",l),n.domElement.removeEventListener("touchend",u)},this.gpuPicker=new o.default({renderer:t.renderer,debug:!1,camera:t.camera,snapshoter:t.snapshoter}),this.hoveredMarkerID=void 0}else console.error("MouseInteraction invalid options.",t);function i(e){c(e,"mousedown")}function a(e){c(e,"mouseup")}function s(e){c(e,"mousemove")}function l(e){e.clientX=e.touches[0].pageX,e.clientY=e.touches[0].pageY,c(e,"mousedown")}function u(e){e.clientX=e.changedTouches[0].pageX,e.clientY=e.changedTouches[0].pageY,c(e,"mouseup")}function c(e,t){var r={x:e.clientX-n.mouseOffset.left,y:e.clientY-n.mouseOffset.top},i=n.gpuPicker.pick(r);if(i){if("mousemove"===t){if(n.hoveredMarkerID)if(n.hoveredMarkerID===i.ID){var o=n.listening.mouseover[n.hoveredMarkerID],a=o?o.handler:void 0;a&&a(e)}else{var s=n.listening.mouseleave[n.hoveredMarkerID],l=s?s.handler:void 0;l&&l(e),(l=(s=n.listening.mouseenter[i.ID])?s.handler:void 0)&&l(e)}else{var u=n.listening.mouseenter[i.ID],c=u?u.handler:void 0;c&&c(e)}n.hoveredMarkerID=i.ID}var h=n.listening[t][i.ID],f=h?h.handler:void 0;f&&f(e),n.lastPickedMarkerID=i.ID}else{if(n.hoveredMarkerID){var d=n.listening.mouseleave[n.hoveredMarkerID],p=d?d.handler:void 0;p&&p(e)}if(n.hoveredMarkerID=void 0,("mousemove"===t||"mouseup"===t)&&n.lastPickedMarkerID){var m=n.listening[t][n.lastPickedMarkerID],v=m?m.handler:void 0;v&&v(e),"mouseup"===t&&(n.lastPickedMarkerID=void 0)}}}}return s(e,[{key:"destruct",value:function(){this.removeListeners()}},{key:"register",value:function(e,t,r){return this._checkResponsibility(t)?void 0!==this.listening[t][e.ID]?(console.warn("[MouseInteraction.register] "+t+" is already registered for "+e.name+". Each event can only have one handler."),!1):(this.gpuPicker.addInteractableObject(e.interactShape,e),this.listening[t][e.ID]={handler:r},!0):(console.warn(t+" is not MouseInteraction responsibility."),!1)}},{key:"unregister",value:function(e,t){return this._checkResponsibility(t)?void 0!==this.listening[t][e.ID]?(this.gpuPicker.removeInteractableObject(e.interactShape),delete this.listening[t][e.ID]):(console.warn("[MouseInteraction.unregister] "+t+" was not registered for "+e.name),!1):(console.warn(t+" is not MouseInteraction responsibility."),!1)}},{key:"_checkResponsibility",value:function(t){var r=e.MouseEventList;return i.default.include(r,t)}}],[{key:"MouseEventList",get:function(){return["mousedown","mouseup","mousemove","mouseover","mouseleave","mouseenter","mousewheel"]}}]),e}();t.default=l,e.exports=t.default},i=[e,t,r(92),r(93)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={include:Array.prototype.indexOf?function(e,t){return-1!==e.indexOf(t)}:function(e,t){for(var r=-1,n=e.length;++r<n;)if(e[r]===t)return!0;return!1},getIndex:Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1}};t.default=r,e.exports=t.default},i=[e,t],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.snapshoter=t.snapshoter,this.debug=void 0!==t.debug&&t.debug,this.renderer=t.renderer,this.camera=t.camera,this.mapping={},this.inverseMapping=[],this.baseID=1,this.pixelBuffer=void 0,this.pixelBufferDimension=void 0,this.needUpdate=!0}return n(e,[{key:"update",value:function(e){if(e||this.needUpdate){var t=[];for(var r in this.mapping)!0===this.mapping[r].added&&(this.mapping[r].pickingMesh.visible=!0,t.push(this.mapping[r].pickingMesh));var n=this.renderer.getSize();this.pixelBuffer=this.snapshoter.renderColorSnapshot(this.camera,t,n.width,n.height),this.pixelBufferDimension=n,t.map(function(e){e.visible=!1}),this.needUpdate=!1,this.debug&&console.log("[GPUPicker] rendering updated")}}},{key:"addInteractableObject",value:function(t,n){if(this.debug&&console.log("[GPUPicker] add interactable object",t),t instanceof r.Mesh||t instanceof r.Sprite){var i=void 0,o=this.mapping[t.uuid];if(o)o.added=!0;else{i=(o=this.mapping[t.uuid]={}).colorID=this.baseID++;var a=new r.Color,s=t;if(t instanceof r.Sprite){a.setHex(i);var l=[255*a.r,255*a.g,255*a.b,255],u=new r.DataTexture(Uint8Array.from(l),1,1,r.RGBAFormat,r.UnsignedByteType,r.UVMapping);u.minFilter=u.magFilter=r.LinearFilter,u.needsUpdate=!0;var c=new r.SpriteMaterial({map:u,color:16777215,depthTest:!1});s.material=c,this.debug&&console.log("[gpupicker] material map",c,u)}else{var h=e.pickingMaterial.clone();h.uniforms.color.value=a.setHex(i),h.side=t.material?t.material.side:r.FrontSide,s.material=h}o.pickingMesh=s,o.added=!0,this.inverseMapping.push(n)}this.needUpdate=!0}else console.error("[GPUPicker] object is not a Mesh",t)}},{key:"removeInteractableObject",value:function(e){if(this.debug&&console.log("[GPUPicker] remove interactable object",e),e instanceof r.Mesh||e instanceof r.Sprite){var t=this.mapping[e.uuid];t?(t.added=!1,this.needUpdate=!0,this.debug&&console.log("[GPUPicker] object removed from picking scene")):console.warn("[GPUPicker] object has not been added to the picker",e)}else console.error("[GPUPicker] object is not a Mesh",e)}},{key:"pick",value:function(e){e.x=Math.round(e.x),e.y=Math.round(e.y),this.update();var t=4*(e.x+(this.pixelBufferDimension.height-e.y)*this.pixelBufferDimension.width),r=256*this.pixelBuffer[t]*256+256*this.pixelBuffer[t+1]+this.pixelBuffer[t+2],n=this.inverseMapping[r-1];if(this.debug&&855309!==r&&console.log("[GPUPicker] pick id:",r,n),n)return n}}]),e}();i.pickingMaterial=new r.ShaderMaterial({uniforms:{color:{value:new r.Color}},vertexShader:"\n  void main(){\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }\n  ",fragmentShader:"\n  uniform vec3 color;\n  void main(){\n    gl_FragColor = vec4(color, 1.0);\n  }\n  "}),t.default=i,e.exports=t.default},i=[e,t,r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t.id,this.name=t.name,this.scene=t.scene,this.owner=t.owner,this.visibility=t.visibility,this.description=t.description,this.views=t.views,this.stars=t.stars,this.createDate=t.createDate,this.modifiedDate=t.modifiedDate,this.spaceUsage=t.spaceUsage,this.allowComment=t.allowComment,this.allowLocation=t.allowLocation,this.showAltiLogo=t.showAltiLogo,this.tags=t.tags,this.onEarth=t.onEarth,this.history=t.history,this.solutionType=t.solutionType}return r(e,[{key:"destruct",value:function(){this.id=void 0,this.name=void 0,this.scene=void 0,this.owner=void 0}},{key:"update",value:function(e){if(!function(){if(!(e&&e instanceof Object))return!1;if(!e.id||!e.name)return!1;return!0}())return!1}}]),e}();t.default=n,e.exports=t.default},i=[e,t],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(){function e(t){var r=t.sandbox;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sandbox=r,this.prevX=0,this.prevY=0,this._enablePan=!1,this.camera.setViewOffset(this.fullWidth,this.fullHeight,0,0,this.fullWidth,this.fullHeight)}return r(e,[{key:"pan",value:function(e,t){if(this._enablePan){var r=this.prevX?e-this.prevX:0,n=this.prevY?t-this.prevY:0;if(0!==r||0!==n){var i=this.view.offsetX-r,o=this.view.offsetY-n,a=this.fullWidth,s=this.fullHeight;this.camera.setViewOffset(a,s,i,o,this.view.width,this.view.height),this.sandbox.control.triggerChangeEvent()}this.prevX=e,this.prevY=t;var l=Math.abs(this.view.offsetX+this.view.width/2-this.view.fullWidth/2),u=Math.abs(this.view.offsetY+this.view.height/2-this.view.fullHeight/2),c=this.camera.fov,h=l/this.view.fullWidth*c,f=u/this.view.fullHeight*c;return Math.max(h,f)}}},{key:"zoom",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1.1,t=this.view.width/2+this.view.offsetX,r=this.view.height/2+this.view.offsetY,n=this.view.width*e,i=this.view.height*e,o=this.fullWidth,a=this.fullHeight;n=Math.max(o/2,Math.min(n,2*o)),i=Math.max(a/2,Math.min(i,2*a));var s=Math.floor(t-n/2),l=Math.floor(r-i/2);this.camera.setViewOffset(o,a,s,l,n,i)}},{key:"restore",value:function(){var e=this.fullWidth,t=this.fullHeight;this.camera.setViewOffset(e,t,0,0,e,t)}},{key:"camera",get:function(){return this.sandbox.viewerCamera}},{key:"view",get:function(){return this.camera.view}},{key:"fullWidth",get:function(){return this.sandbox.width}},{key:"fullHeight",get:function(){return this.sandbox.height}},{key:"enablePan",set:function(e){this._enablePan=e,this.prevX=0,this.prevY=0}}]),e}();t.default=n,e.exports=t.default},i=[e,t],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=u(n),s=u(i),l=u(o);function u(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),h=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.debug=void 0!==t.debug&&t.debug,this.config=void 0!==t.config?t.config:{method:"default"},void 0!==t.sandbox||void 0!==t.earth){this.sandbox=t.sandbox||t.earth,this.markers=[],this.markersMapping={},this.needUpdate=!1,this.initialized=!1,this.clusters=void 0,this.clustersTag=[],this.clustersTagReserve=void 0!==t.clustersTagReserve?t.clustersTagReserve:25,this.clustersTagCount=0;for(var r=0;r<this.clustersTagReserve;++r)this.clustersTag.push(this._createClusterTags())}else console.error("sandbox (earth) is required")}return c(e,[{key:"_createClusterTags",value:function(){var e=new s.default({text:"cluster",textStyle:{fillStyle:"rgb(255, 255, 0)",font:"normal 500 50px Arial",outlineWidth:10,outlineStyle:"rgb(255, 0, 0)"},position:new l.default(0,0,0),sandbox:this.sandbox,scale:7});return e.visible=!1,e}},{key:"add",value:function(e){var t=!1;this.markers.map(function(r){r.ID===e&&(t=!0)}),t||(this.markers.push(e),this.markersMapping[e.ID]=e,this.needUpdate=!0)}},{key:"remove",value:function(e){var t=this;this.markers.map(function(r,n){r.ID===e.ID&&(t.markers.splice(n,1),delete t.markersMapping[e.ID],t.needUpdate=!0)})}},{key:"clustering",value:function(){var e=this,t=this.sandbox.camera.pose,n=t.lng,i=t.lat,o=t.alt,s=Math.min(Math.max(62585623e-13*o,.01),80),l=Math.floor(33.78608-2.6936*Math.log(o)),u=[n-s,i-s,n+s,i+s];return e.debug&&console.log(l,o),new Promise(function(t,n){function i(r){e.clusters=r,t(r)}"default"===e.config.method?(e.debug&&console.log("default clustering algo"),e.initialized?e.needUpdate?(0,r.update)(e.markers).then(function(t){"updated"===t&&(e.debug&&console.log("cluster updated"),e.needUpdate=!1,(0,r.query)(u,l).then(i))}):(e.debug&&console.log("cluster no need to update"),(0,r.query)(u,l).then(i)):(0,r.initialize)({radius:30,maxZoom:22},e.markers).then(function(t){"ready"===t&&(e.initialized=!0,e.needUpdate=!1,e.debug&&console.log("cluster initialized"),(0,r.query)(u,l).then(i))})):"dbscan"===e.config.method&&(e.debug&&console.log("dbscan clustering algo"),(0,a.default)(e.markers,e.sandbox,e.config).then(i))})}},{key:"enable",value:function(e){var t=this,r=e.adjustHeight,n=void 0!==r&&r,i=void 0;if(this.debug&&(i=new Date),void 0!==this.clusters){this.markers.map(function(e){e.visible=!1}),this.clustersTag.map(function(e){e.visible=!1}),this.clustersTagCount=0;var o=[],a=[];if(this.clusters.map(function(e){if("Feature"===e.type){var r=void 0;t.clustersTagCount<t.clustersTagReserve?r=t.clustersTag[t.clustersTagCount]:(r=t._createClusterTags(),t.clustersTagReserve++,t.clustersTag.push(r)),r.visible=!0,r.text=e.properties.point_count.toString(),r.pinLength=.045*t.sandbox.camera.pose.alt;var n=new(Function.prototype.bind.apply(l.default,[null].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(e.geometry.coordinates))));r.position=n,o.push(n),r.scale=.0018*t.sandbox.camera.pose.alt,t.clustersTagCount++}else void 0!==e.marker_id&&(t.markersMapping[e.marker_id].visible=!0)}),n){this.debug&&(console.log("before altitude adjustment",new Date-i),i=new Date),a=this.sandbox.positionsAltitude(o);for(var s=0;s<this.clustersTagCount;++s){var u=this.clustersTag[s].position;this.clustersTag[s].position=Object.assign({},u,{alt:a[s]})}this.debug&&console.log("altitude adjustment time",new Date-i)}}}},{key:"disable",value:function(){this.clustersTag.map(function(e){e.visible=!1}),this.markers.map(function(e){e.visible=!0})}}]),e}();t.default=h,e.exports=t.default},i=[e,t,r(97),r(99),r(17),r(6)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.initialize=function(e,t){return new Promise(function(n,i){r.onmessage=function(e){n(e.data)},r.onerror=function(e){i(new Error("MarkerCluster worker runtime error",e.message))};var o=[];t.map(function(e){o.push({position:e.position,marker_id:e.ID})}),r.postMessage({action:"init",options:e,points:o})})},e.update=function(e){return new Promise(function(t,n){r.onmessage=function(e){t(e.data)},r.onerror=function(e){n(new Error("MarkerCluster worker runtime error",e.message))};var i=[];e.map(function(e){i.push({position:e.position,marker_id:e.ID})}),r.postMessage({action:"update",points:i})})},e.query=function(e,t){return new Promise(function(n,i){r.onmessage=function(e){n(e.data)},r.onerror=function(e){i(new Error("MarkerCluster worker runtime error",e.message))},r.postMessage({action:"query",bbox:e,zoom:t})})};var r=new t},i=[t,r(98)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){e.exports=function(){return r(11)('!function(t){var o={};function n(e){if(o[e])return o[e].exports;var i=o[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=o,n.d=function(t,o,e){n.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:e})},n.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(o,"a",o),o},n.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)},n.p="",n(n.s=0)}([function(t,o,n){var e,i,r,s;s=function(t){"use strict";var o,n,e,i=(o=t)&&o.__esModule?o:{default:o};var r=!1;onmessage=function(t){"init"===t.data.action?(e=t.data.options,n=(0,i.default)(e).load(t.data.points),r=!0,postMessage("ready")):"query"===t.data.action&&r?postMessage(n.getClusters(t.data.bbox,t.data.zoom)):"update"===t.data.action&&r&&(n=(0,i.default)(e).load(t.data.points),postMessage("updated"))}},i=[n(1)],void 0===(r="function"==typeof(e=s)?e.apply(o,i):e)||(t.exports=r)},function(t,o,n){var e,i,r,s;s=function(t,o,n){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(t){return new r(t)};var e,i=(e=n)&&e.__esModule?e:{default:e};function r(t){this.options=c(Object.create(this.options),t),this.trees=new Array(this.options.maxZoom+1)}function s(t,o,n,e,i,r){return{x:t,y:o,z:n,zoom:1/0,id:e,parentId:-1,numPoints:i,properties:r}}function a(t){return{type:"Feature",properties:u(t),geometry:{type:"Point",coordinates:[(e=t.x,360*(e-.5)),(o=t.y,n=(180-360*o)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90),t.z]}};var o,n,e}function u(t){var o=t.numPoints,n=o>=1e4?Math.round(o/1e3)+"k":o>=1e3?Math.round(o/100)/10+"k":o;return c(c({},t.properties),{cluster:!0,cluster_id:t.id,point_count:o,point_count_abbreviated:n})}function p(t){return t/360+.5}function h(t){var o=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+o)/(1-o))/Math.PI;return n<0?0:n>1?1:n}function c(t,o){for(var n in o)t[n]=o[n];return t}function f(t){return t.x}function l(t){return t.y}r.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,initial:function(){return{}},map:function(t){return t}},load:function(t){var o=this.options.log;o&&console.time("total time");var n="prepare "+t.length+" points";o&&console.time(n),this.points=t;for(var e,r,s,a=[],u=0;u<t.length;u++)a.push((e=t[u],r=u,void 0,{x:p((s=e.position).lng),y:h(s.lat),z:s.alt,zoom:1/0,id:r,parentId:-1}));this.trees[this.options.maxZoom+1]=(0,i.default)(a,f,l,this.options.nodeSize,Float32Array),o&&console.timeEnd(n);for(var c=this.options.maxZoom;c>=this.options.minZoom;c--){var d=+Date.now();a=this._cluster(a,c),this.trees[c]=(0,i.default)(a,f,l,this.options.nodeSize,Float32Array),o&&console.log("z%d: %d clusters in %dms",c,a.length,+Date.now()-d)}return o&&console.timeEnd("total time"),this},getClusters:function(t,o){if(t[0]>t[2]){var n=this.getClusters([t[0],t[1],180,t[3]],o),e=this.getClusters([-180,t[1],t[2],t[3]],o);return n.concat(e)}for(var i=this.trees[this._limitZoom(o)],r=i.range(p(t[0]),h(t[3]),p(t[2]),h(t[1])),s=[],u=0;u<r.length;u++){var c=i.points[r[u]];s.push(c.numPoints?a(c):this.points[c.id])}return s},getChildren:function(t){var o=t>>5,n=t%32,e="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(e);var r=i.points[o];if(!r)throw new Error(e);for(var s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),u=i.within(r.x,r.y,s),p=[],h=0;h<u.length;h++){var c=i.points[u[h]];c.parentId===t&&p.push(c.numPoints?a(c):this.points[c.id])}if(0===p.length)throw new Error(e);return p},getLeaves:function(t,o,n){o=o||10,n=n||0;var e=[];return this._appendLeaves(e,t,o,n,0),e},getTile:function(t,o,n){var e=this.trees[this._limitZoom(t)],i=Math.pow(2,t),r=this.options.extent,s=this.options.radius/r,a=(n-s)/i,u=(n+1+s)/i,p={features:[]};return this._addTileFeatures(e.range((o-s)/i,a,(o+1+s)/i,u),e.points,o,n,i,p),0===o&&this._addTileFeatures(e.range(1-s/i,a,1,u),e.points,i,n,i,p),o===i-1&&this._addTileFeatures(e.range(0,a,s/i,u),e.points,-1,n,i,p),p.features.length?p:null},getClusterExpansionZoom:function(t){for(var o=t%32-1;o<this.options.maxZoom;){var n=this.getChildren(t);if(o++,1!==n.length)break;t=n[0].properties.cluster_id}return o},_appendLeaves:function(t,o,n,e,i){for(var r=this.getChildren(o),s=0;s<r.length;s++){var a=r[s].properties;if(a&&a.cluster?i+a.point_count<=e?i+=a.point_count:i=this._appendLeaves(t,a.cluster_id,n,e,i):i<e?i++:t.push(r[s]),t.length===n)break}return i},_addTileFeatures:function(t,o,n,e,i,r){for(var s=0;s<t.length;s++){var a=o[t[s]];r.features.push({type:1,geometry:[[Math.round(this.options.extent*(a.x*i-n)),Math.round(this.options.extent*(a.y*i-e))]],tags:a.numPoints?u(a):this.points[a.id].properties})}},_limitZoom:function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},_cluster:function(t,o){for(var n=[],e=this.options.radius/(this.options.extent*Math.pow(2,o)),i=0;i<t.length;i++){var r=t[i];if(!(r.zoom<=o)){r.zoom=o;var a=this.trees[o+1],u=a.within(r.x,r.y,e),p=r.numPoints||1,h=r.x*p,c=r.y*p,f=r.z*p,l=null;this.options.reduce&&(l=this.options.initial(),this._accumulate(l,r));for(var d=(i<<5)+(o+1),v=0;v<u.length;v++){var m=a.points[u[v]];if(!(m.zoom<=o)){m.zoom=o;var g=m.numPoints||1;h+=m.x*g,c+=m.y*g,f+=m.z*g,p+=g,m.parentId=d,this.options.reduce&&this._accumulate(l,m)}}1===p?n.push(r):(r.parentId=d,n.push(s(h/p,c/p,f/p,d,p,l)))}}return n},_accumulate:function(t,o){var n=o.numPoints?o.properties:this.options.map(this.points[o.id].properties);this.options.reduce(t,n)}},t.exports=o.default},i=[t,o,n(2)],void 0===(r="function"==typeof(e=s)?e.apply(o,i):e)||(t.exports=r)},function(t,o,n){"use strict";var e=n(3),i=n(4),r=n(5);function s(t,o,n,i,r){o=o||a,n=n||u,r=r||Array,this.nodeSize=i||64,this.points=t,this.ids=new r(t.length),this.coords=new r(2*t.length);for(var s=0;s<t.length;s++)this.ids[s]=s,this.coords[2*s]=o(t[s]),this.coords[2*s+1]=n(t[s]);e(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function a(t){return t[0]}function u(t){return t[1]}t.exports=function(t,o,n,e,i){return new s(t,o,n,e,i)},s.prototype={range:function(t,o,n,e){return i(this.ids,this.coords,t,o,n,e,this.nodeSize)},within:function(t,o,n){return r(this.ids,this.coords,t,o,n,this.nodeSize)}}},function(t,o,n){"use strict";function e(t,o,n,e){i(t,n,e),i(o,2*n,2*e),i(o,2*n+1,2*e+1)}function i(t,o,n){var e=t[o];t[o]=t[n],t[n]=e}t.exports=function t(o,n,i,r,s,a){if(s-r<=i)return;var u=Math.floor((r+s)/2);!function t(o,n,i,r,s,a){for(;s>r;){if(s-r>600){var u=s-r+1,p=i-r+1,h=Math.log(u),c=.5*Math.exp(2*h/3),f=.5*Math.sqrt(h*c*(u-c)/u)*(p-u/2<0?-1:1),l=Math.max(r,Math.floor(i-p*c/u+f)),d=Math.min(s,Math.floor(i+(u-p)*c/u+f));t(o,n,i,l,d,a)}var v=n[2*i+a],m=r,g=s;for(e(o,n,r,i),n[2*s+a]>v&&e(o,n,r,s);m<g;){for(e(o,n,m,g),m++,g--;n[2*m+a]<v;)m++;for(;n[2*g+a]>v;)g--}n[2*r+a]===v?e(o,n,r,g):e(o,n,++g,s),g<=i&&(r=g+1),i<=g&&(s=g-1)}}(o,n,u,r,s,a%2);t(o,n,i,r,u-1,a+1);t(o,n,i,u+1,s,a+1)}},function(t,o,n){"use strict";t.exports=function(t,o,n,e,i,r,s){var a,u,p=[0,t.length-1,0],h=[];for(;p.length;){var c=p.pop(),f=p.pop(),l=p.pop();if(f-l<=s)for(var d=l;d<=f;d++)a=o[2*d],u=o[2*d+1],a>=n&&a<=i&&u>=e&&u<=r&&h.push(t[d]);else{var v=Math.floor((l+f)/2);a=o[2*v],u=o[2*v+1],a>=n&&a<=i&&u>=e&&u<=r&&h.push(t[v]);var m=(c+1)%2;(0===c?n<=a:e<=u)&&(p.push(l),p.push(v-1),p.push(m)),(0===c?i>=a:r>=u)&&(p.push(v+1),p.push(f),p.push(m))}}return h}},function(t,o,n){"use strict";function e(t,o,n,e){var i=t-n,r=o-e;return i*i+r*r}t.exports=function(t,o,n,i,r,s){var a=[0,t.length-1,0],u=[],p=r*r;for(;a.length;){var h=a.pop(),c=a.pop(),f=a.pop();if(c-f<=s)for(var l=f;l<=c;l++)e(o[2*l],o[2*l+1],n,i)<=p&&u.push(t[l]);else{var d=Math.floor((f+c)/2),v=o[2*d],m=o[2*d+1];e(v,m,n,i)<=p&&u.push(t[d]);var g=(h+1)%2;(0===h?n-r<=v:i-r<=m)&&(a.push(f),a.push(d-1),a.push(g)),(0===h?n+r>=v:i+r>=m)&&(a.push(d+1),a.push(c),a.push(g))}}return u}}]);',r.p+"SuperCluster_worker.js")}},function(e,t,r){var n,i,o,a;a=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(e.length>0){var i=t.window,o=[];e.map(function(e){var t=i.fromLngLatAlt(e.position),r=t.x,n=t.y;r>0&&n>0&&r<window.innerWidth&&n<window.innerHeight&&o.push({marker_id:e.ID,x:r,y:n})});var a=r.minDistance||10,s=r.minNumber||10;return new Promise(function(e,t){n.onmessage=function(t){var r=[];t.data.result.map(function(e){if(e.point_count>1){var t=i.toLngLatAlt({x:e.x,y:e.y});t=[t.lng,t.lat,t.alt],r.push({type:"Feature",geometry:{type:"Point",coordinates:t},properties:{cluster:!0,cluster_id:e.cluster_id,point_count:e.point_count}})}else r.push({marker_id:e.marker_id})}),e(r)},n.onerror=function(e){t(new Error("MarkerCluster worker runtime error",e.message))};var r={data:o,minDistance:a,minNumber:s};n.postMessage(r)})}console.error("not enough markers added to the marker cluster")};var n=new r;e.exports=t.default},i=[e,t,r(100)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){e.exports=function(){return r(11)('!function(r){var n={};function t(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return r[e].call(a.exports,a,a.exports,t),a.l=!0,a.exports}t.m=r,t.c=n,t.d=function(r,n,e){t.o(r,n)||Object.defineProperty(r,n,{configurable:!1,enumerable:!0,get:e})},t.n=function(r){var n=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(n,"a",n),n},t.o=function(r,n){return Object.prototype.hasOwnProperty.call(r,n)},t.p="",t(t.s=0)}([function(r,n,t){var e,a,o;a=[],void 0===(o="function"==typeof(e=function(){"use strict";function r(r){if(Array.isArray(r)){for(var n=0,t=Array(r.length);n<r.length;n++)t[n]=r[n];return t}return Array.from(r)}onmessage=function(n){var t=function(n,t,e){var a=0;n.map(function(r){r.label=-1});for(var o=t,u=e,i={},l=0;l<n.length;++l){var f=n[l];if(-1===f.label){var c=v(n,y,f,o);if(c.length<u)f.label=0;else{a+=1,f.label=a,i[a]=[],i[a].push(f);for(var p=0;p<c.length;++p){var s=c[p];if(s.marker_id!==f.marker_id){if(0===s.label&&(s.label=a,i[a].push(s)),-1!==s.label)continue;s.label=a,i[a].push(s);var h=v(n,y,s,o);h.length>=u&&c.push.apply(c,r(h))}}}}}return i=function(r){var n=[],t=function(t){var e=r[t],a=e.length,o={x:0,y:0,point_count:a};e.map(function(r){o.x+=r.x,o.y+=r.y}),o.x/=a,o.y/=a,o.cluster_id=t,n.push(o)};for(var e in r)t(e);return n}(i),n.map(function(r){0===r.label&&i.push({marker_id:r.marker_id,point_count:1})}),i;function v(r,n,t,e){var a=[];return r.map(function(r){n(t,r)<=e&&a.push(r)}),a}function y(r,n){return Math.sqrt(Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2))}}(n.data.data,n.data.minDistance,n.data.minNumber);postMessage({result:t})}})?e.apply(n,a):e)||(r.exports=o)}]);',r.p+"DBSCAN_worker.js")}},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=s(r),a=s(n);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sandbox=t.sandbox,this.polygon=t.polygon,this.viewPoint=t.viewPoint,this.blockMarkers=t.blockMarkers,this.skylineLength=t.skylineLength>0?t.skylineLength:512,this.polygonSampleResolution=t.polygonSampleResolution>0?t.polygonSampleResolution:50,this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.fov=t.fov>0?t.fov:45,this.heightResolution=t.heightResolution>0?t.heightResolution:1,this._perspectiveCamera=new i.PerspectiveCamera,this._skylineInLLA=[]}return l(e,[{key:"_getPerspectiveCameraParameters",value:function(){var e=this.viewPoint,t=Object.assign({},e);t.alt+=1;var r={lng:0,lat:0,alt:e.alt};r.lng=this.polygon.position.lng,r.lat=this.polygon.position.lat,this.targetPoint=r;var n=this.sandbox.lngLatAlt2XYZ(e),o=this.sandbox.lngLatAlt2XYZ(t),s=this.sandbox.lngLatAlt2XYZ(r),l=o.clone().sub(n).normalize(),u=new i.Matrix4;u.lookAt(n,s,l);var c=new i.Vector2(1e5*(r.lng-e.lng),1e5*(r.lat-e.lat)),h=this.polygon.boundaryPts.map(function(t){return new i.Vector2(1e5*(t.lng-e.lng),1e5*(t.lat-e.lat))}),f=void 0,d=void 0,p=void 0,m=void 0;if(this.nearDistance>0&&this.nearDistance<this.farDistance)f=this.nearDistance*a.default.scale/a.default.EARTH_RADIUS,d=this.farDistance*a.default.scale/a.default.EARTH_RADIUS,p=this.nearDistance,m=this.farDistance;else{f=this.sandbox.earthView.camera.near;var v=function(e){if(0===e.length)return-1;for(var t=e[0],r=0,n=0;n<e.length;++n)e[n]>t&&(t=e[n],r=n);return r}(h.map(function(e){return e.dot(c)/c.length()})),g=Object.assign({},this.polygon.boundaryPts[v]);g.alt=e.alt;var y=this.sandbox.calculateDistanceBetweenTwoPoints(e,g);d=1.01*y*a.default.scale/a.default.EARTH_RADIUS,p=f*a.default.EARTH_RADIUS/a.default.scale,m=y}var _=h.map(function(e){return e.dot(c)/(e.length()*c.length())}),w=_[function(e){if(0===e.length)return-1;for(var t=e[0],r=0,n=0;n<e.length;++n)e[n]<t&&(t=e[n],r=n);return r}(_)],b=Math.abs(Math.sqrt(1-w*w)/w),x=this.fov,k=x/2*Math.PI/180,A=b/Math.tan(k);return{position:n.clone(),quaternion:(new i.Quaternion).setFromRotationMatrix(u),fov:x,near:f,far:d,aspect:A,nearDistance:p,farDistance:m}}},{key:"_getDepthMap",value:function(e,t,r,n){var i={dimension:{width:r,height:n}};return i.buffer=this.sandbox.snapshoter.renderDepthSnapshot(e,t,r,n),i}},{key:"_findSkylineInLLA",value:function(e){for(var t=this,r=e.dimension.width,n=e.dimension.height,s=[],l=0;l<r;++l)for(var u=0;u<n;++u){var c=u*r+l,h=e.buffer[c];if(u===n-1){s.push([l,u,h]);break}if(h<255){s.push([l,u,h]);break}}var f=new i.Matrix4;f.getInverse(this.sandbox.earthToScene());var d=new i.Vector3;return{skyline:s.map(function(e){var i=e[0]/(r-1)*2-1,s=-(e[1]/(n-1)*2-1),l=e[2]/255*2-1;d.set(i,s,l).unproject(t._perspectiveCamera),d.applyMatrix4(f);var u=o.default.getLngLatAltFromNoneGroundCartesian(a.default.EarthResolution,d,a.default.scale);return{lng:u.lng,lat:u.lat,alt:u.alt}}),near:[[-1,0,-1],[1,0,-1]].map(function(e){d.set(e[0],e[1],e[2]).unproject(t._perspectiveCamera),d.applyMatrix4(f);var r=o.default.getLngLatAltFromNoneGroundCartesian(a.default.EarthResolution,d,a.default.scale);return{lng:r.lng,lat:r.lat,alt:r.alt}}),far:[[-1,0,1],[1,0,1]].map(function(e){d.set(e[0],e[1],e[2]).unproject(t._perspectiveCamera),d.applyMatrix4(f);var r=o.default.getLngLatAltFromNoneGroundCartesian(a.default.EarthResolution,d,a.default.scale);return{lng:r.lng,lat:r.lat,alt:r.alt}})}}},{key:"computeSkyline",value:function(){var e=this,t=this._getPerspectiveCameraParameters();this._perspectiveCamera.copy(this.sandbox.earthView.camera),this._perspectiveCamera.position.copy(t.position),this._perspectiveCamera.quaternion.copy(t.quaternion),this._perspectiveCamera.near=t.near,this._perspectiveCamera.far=t.far,this._perspectiveCamera.fov=t.fov,this._perspectiveCamera.aspect=t.aspect,this._perspectiveCamera.updateProjectionMatrix(),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance;var r=this.skylineLength,n=t.fov*Math.PI/180,o=t.farDistance*Math.tan(n/2)/this.heightResolution;o=Math.round(o);var a=this.blockMarkers.map(function(e){return e.contentHolder}),s=this._getDepthMap(this._perspectiveCamera,a,r,o);!function(e,t){for(var r=0;r<e.dimension.height/2;++r)for(var n=0;n<e.dimension.width*t;++n){var i=r*e.dimension.width*t+n,o=(e.dimension.height-1-r)*e.dimension.width*t+n,a=e.buffer[i];e.buffer[i]=e.buffer[o],e.buffer[o]=a}}(s,1);var l=this._findSkylineInLLA(s);this._skylineInLLA=l.skyline,this._nearPtsInLLA=l.near,this._farPtsInLLA=l.far;this._skylineInLLADiffvec2=this._skylineInLLA.map(function(t){var r=new i.Vector2;return r.x=1e4*t.lng-1e4*e.viewPoint.lng,r.y=1e4*t.lat-1e4*e.viewPoint.lat,r})}},{key:"getHeightLimitHere",value:function(e){if(!(this._skylineInLLA.length<1)){var t=this.viewPoint,r=this._skylineInLLA,n=this._skylineInLLADiffvec2,o=new i.Vector2;o.x=1e4*e.lng-1e4*t.lng,o.y=1e4*e.lat-1e4*t.lat;var a=n.map(function(e,t){return{angleDiff:e.dot(o)/(e.length()*o.length())*1e4,index:t}}),s=a[0];a.map(function(e){s.angleDiff<=e.angleDiff&&(s=e)});var l=s.index,u=void 0;u=0===l?l+1:l===a.length-1?l-1:a[l-1].angleDiff>a[l+1].angleDiff?l-1:l+1;var c=n[l].x,h=n[l].y,f=n[u].x,d=n[u].y,p=o.x,m=o.y,v=(p*d-m*f)/(m*(c-f)-p*(h-d)),g=v*c+(1-v)*f,y=v*h+(1-v)*d,_=r[l],w=r[u],b=v*(_.alt-t.alt)+(1-v)*(w.alt-t.alt),x=(p/g+m/y)/2;if(!(x<=1))return x*b+t.alt}}},{key:"computeHeightLimitMap",value:function(){if(!(this._skylineInLLA.length<1)){var e=this.polygon.boundaryPts,t={max:{lat:e[0].lat,lng:e[0].lng},min:{lat:e[0].lat,lng:e[0].lng}};e.map(function(e){e.lat>t.max.lat&&(t.max.lat=e.lat),e.lng>t.max.lng&&(t.max.lng=e.lng),e.lat<t.min.lat&&(t.min.lat=e.lat),e.lng<t.min.lng&&(t.min.lng=e.lng)});for(var r=this.sandbox.markerSnapshot([t.max,t.min],{max:this.polygon.top+.1,min:this.polygon.bottom-.1},[this.polygon.contentHolder],!1,this.polygonSampleResolution),n={bbox:t,dimension:Object.assign({},r.dimension),buffer:new Array(r.dimension.width*r.dimension.height)},i=0;i<r.dimension.width;++i)for(var o=0;o<r.dimension.height;++o){var a=4*(o*r.dimension.width+i)+3;if(0!==r.buffer[a]){var s={lng:(t.max.lng-t.min.lng)*(i/(r.dimension.width-1))+t.min.lng,lat:(t.max.lat-t.min.lat)*(o/(r.dimension.height-1))+t.min.lat},l=this.getHeightLimitHere(s);void 0!==l&&(s.alt=l,n.buffer[o*r.dimension.width+i]=s)}}return n}}},{key:"skyline",get:function(){return this._skylineInLLA.slice()}},{key:"near",get:function(){return this._nearPtsInLLA.slice()}},{key:"far",get:function(){return this._farPtsInLLA.slice()}}]),e}();t.default=u,e.exports=t.default},i=[e,t,r(3),r(1),r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=h(r),l=h(n),u=h(i),c=h(o);function h(e){return e&&e.__esModule?e:{default:e}}var f=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=e.heightMap,n={lng:0,lat:0,alt:0},i=0;i<r.buffer.length;++i){var o=r.buffer[i];if(o){n.lng=o.lng,n.lat=o.lat;break}}e.position=n;var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));s._heightMap=r,s._lineWidth=e.lineWidth>0?e.lineWidth:2,s._scaledLineWidth=s._lineWidth*l.default.scale/l.default.EARTH_RADIUS,s._calculateSystem(),s._unitAltVector=s._convertPointToXYZPoint({lng:s.position.lng,lat:s.position.lat,alt:s.position.alt+1}).sub(s._convertPointToXYZPoint(s.position)),s._pointsxyz={};for(var u=0;u<r.buffer.length;++u){var h=r.buffer[u];h&&(s._pointsxyz[u]=s._convertPointToXYZPoint(h))}var f=s._buildUpGeometryData(r),d=new a.Geometry;f.vertices.map(function(e){var t=void 0;t=e?s._convertPointToXYZPoint(e):e,d.vertices.push(t)}),f.faces.map(function(e){d.faces.push(new a.Face3(e[0],e[1],e[2]))}),s.up=new a.Mesh(d,new a.MeshBasicMaterial({transparent:!1,color:16711680,opacity:1,side:a.DoubleSide,wireframe:!0})),s.up.renderOrder=c.default.HEIGHTMAP_RENDER_ORDER,s.contentHolder.add(s.up);var p=s._buildSideLineOptions(r),m=s._buildLineGeometry(p);return s.side=new a.Mesh(m,new a.MeshBasicMaterial({transparent:!1,color:16711935,opacity:1})),s.side.renderOrder=c.default.HEIGHTMAP_RENDER_ORDER,s.contentHolder.add(s.side),s.interactShape=s.up.clone(),s._property.type="HeightMapMarker",s._property.heightMap=s._heightMap,s._property.lineWidth=s._lineWidth,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),f(t,[{key:"_calculateSystem",value:function(){this.system=u.default.getLocalSystemOnEarthSurface(l.default.EarthResolution,this.position.lng,this.position.lat,l.default.scale)}},{key:"_convertPointToXYZPoint",value:function(e){null!==this.system&&void 0!==this.system||this._calculateSystem();var t=u.default.getNoneGroundCartesianFromLngLatAlt(l.default.EarthResolution,e.lng,e.lat,e.alt,l.default.scale).clone().sub(this.system.origin),r=1*t.dot(this.system.lng),n=1*t.dot(this.system.lat),i=1*t.dot(this.system.alt);return new a.Vector3(r,n,i)}},{key:"_constructLineOptions",value:function(e,t){var r={},n=e.clone().add(t).multiplyScalar(.5),i={};return i.y=t.clone().add(e.clone().negate()).normalize(),i.x=this._unitAltVector.clone().normalize(),i.z=i.y.clone().cross(i.x.clone()).normalize(),i.x=i.y.clone().cross(i.z.clone()).normalize(),i.origin=n.clone(),r.system=i,r.distance=t.clone().add(e.clone().negate()).length(),r}},{key:"_buildUpLineOptions",value:function(e){for(var t=[],r=0;r<e.dimension.width;++r)for(var n=0;n<e.dimension.height-1;++n){var i=n*e.dimension.width+r,o=e.buffer[i],a=(n+1)*e.dimension.width+r,s=e.buffer[a];void 0!==o&&void 0!==s&&t.push(this._constructLineOptions(this._pointsxyz[i],this._pointsxyz[a]))}for(var l=0;l<e.dimension.height;++l)for(var u=0;u<e.dimension.width-1;++u){var c=l*e.dimension.width+u,h=e.buffer[c],f=l*e.dimension.width+u+1,d=e.buffer[f];void 0!==h&&void 0!==d&&t.push(this._constructLineOptions(this._pointsxyz[c],this._pointsxyz[f]))}return t}},{key:"_buildUpGeometryData",value:function(e){for(var t=e.dimension.width,r=e.dimension.height,n=e.buffer,i=[],o={},a=0,s=0;s<n.length;++s)n[s]&&(o[s]=a,a+=1,i.push(n[s]));for(var l=[],u=0;u<t-1;++u)for(var c=0;c<r-1;++c){var h=c*t+u,f=h+1,d=h+t,p=d+1;n[h]&&n[f]&&n[d]&&n[p]&&(l.push([o[h],o[f],o[d]]),l.push([o[d],o[f],o[p]]))}return{vertices:i,faces:l}}},{key:"_buildSideLineOptions",value:function(e){for(var t=[],r=0;r<e.dimension.width;++r)for(var n=0;n<e.dimension.height;++n){var i=n*e.dimension.width+r,o=e.buffer[i];if(void 0!==o)if(0===r||r===e.dimension.width||0===n||n===e.dimension.height)t.push(this._constructLineOptions(this._pointsxyz[i],this._convertPointToXYZPoint({lng:o.lng,lat:o.lat,alt:0})));else for(var a=-1;a<2;++a)for(var s=-1;s<2;++s){void 0===e.buffer[(n+s)*e.dimension.width+(r+a)]&&(t.push(this._constructLineOptions(this._pointsxyz[i],this._convertPointToXYZPoint({lng:o.lng,lat:o.lat,alt:0}))),a=3,s=3)}}return t}},{key:"_buildLineGeometry",value:function(e){for(var t=new a.Geometry,r=new a.CylinderGeometry(1,1,1,8),n=this._scaledLineWidth,i=0;i<e.length;i++){var o=e[i];if(!(o.distance<=0)){var s=(new a.Matrix4).makeScale(n,o.distance,n),l=new a.Matrix4;l.makeBasis(o.system.x,o.system.y,o.system.z),l.setPosition(o.system.origin),t.merge(r,l.multiply(s))}}t.applyMatrix((new a.Matrix4).makeScale(1e7,1e7,1e7));var u=(new a.BufferGeometry).fromGeometry(t);return u.applyMatrix((new a.Matrix4).makeScale(1e-7,1e-7,1e-7)),u}},{key:"destruct",value:function(){this.up&&(this.up.geometry&&this.up.geometry.dispose(),this.up.material&&this.up.material.dispose()),this.side&&(this.side.geometry&&this.side.geometry.dispose(),this.side.material&&this.side.material.dispose()),function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}}]),t}();t.default=d,e.exports=t.default},i=[e,t,r(5),r(1),r(3),r(7),r(0)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a;a=function(e,t,r,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.areaByLngLatAlts=e.checkPtsInPoly=e.default=void 0;a(t),a(r);var o=a(i);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){t[0].equals(t[t.length-1])&&(t=t.slice()).pop();var r=e.map(function(e){return a(e)}),i=t.map(function(e){return a(e)}),o=function(e){var t=function(e){var t=new n.Vector3;e.map(function(e){t.add(e)}),t.multiplyScalar(1/e.length);var r=0,i=0,o=0,a=0,s=0,l=0;e.map(function(e){var n=e.clone().sub(t);r+=n.x*n.x,i+=n.x*n.y,o+=n.x*n.z,a+=n.y*n.y,s+=n.y*n.z,l+=n.z*n.z}),r/=e.length,i/=e.length,o/=e.length,a/=e.length,s/=e.length,l/=e.length;var u=new n.Vector3(0,0,0),c=void 0,h=void 0,f=a*l-s*s;c=new n.Vector3(f,o*s-i*l,i*s-o*a),h=f*f,u.dot(c)<0&&(h=-h);u.add(c.multiplyScalar(h));var d=r*l-o*o;c=new n.Vector3(o*s-i*l,d,i*o-s*r),h=d*d,u.dot(c)<0&&(h=-h);u.add(c.multiplyScalar(h));var p=r*a-i*i;c=new n.Vector3(i*s-o*a,i*o-s*r,p),h=p*p,u.dot(c)<0&&(h=-h);return u.add(c.multiplyScalar(h)),{normal:u.normalize(),centroid:t}}(e),r=t.centroid,i=t.normal,o=void 0;o=0===i.x&&0===i.y?new n.Vector3(1,0,0):new n.Vector3(-i.y,i.x,0).normalize();var a=o.clone().cross(i).normalize(),s=(new n.Matrix4).set(o.x,o.y,o.z,0,a.x,a.y,a.z,0,i.x,i.y,i.z,0,0,0,0,1),l=r.dot(i)/i.lengthSq(),u=r.clone().sub(r.clone().multiplyScalar(l));return{project:function(e){var t=e.clone().sub(u).applyMatrix4(s),r={lng:1e5*t.x,lat:1e5*t.y,alt:t.z,equals:function(e){return r.lng===e.lng&&r.lat===e.lat&&r.alt===e.alt}};return r}}}(i);return function(e,t){t[0].equals(t[t.length-1])&&(t=t.slice()).pop();for(var r=[],n=0;n<e.length;++n){var i=e[n];r[n]=!!i&&o(i,t)}return r;function o(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=0,i=0;i<t.length;++i){var o=t[i],a=t[(i+1)%t.length],s=(e.lat-a.lat)/(o.lat-a.lat);if(s<1-r&&s>r)s*o.lng+(1-s)*a.lng>=e.lng&&(n+=1);else if(s>=1-r&&s<=1+r&&a.lng>=e.lng){var l=t[(i+2)%t.length];(o.lat>e.lat&&l.lat<e.lat||o.lat<e.lat&&l.lat>e.lat)&&(n+=1)}}return n%2==1}}(r.map(function(e){var t=o.project(e);return t.alt>=0&&t}),i.map(function(e){var t=o.project(e);return t.alt>=0&&t}));function a(e){var t=l(e.lng),r=l(e.lat),i=Math.cos(r),o=Math.cos(t)*i,a=Math.sin(t)*i,s=Math.sin(r);return new n.Vector3(o,a,s).normalize();function l(e){return e*Math.PI/180}}}function l(e){var t=e.length;if(t<3)return 0;for(var r,n,i=0,o=e[t-1],a=Math.tan(Math.PI/2-h(o.lat)),s=h(o.lng),l=0;l<t;++l){var u=Math.tan((Math.PI/2-h(e[l].lat))/2),c=h(e[l].lng);i+=(void 0,void 0,r=c-s,n=u*a,2*Math.atan2(n*Math.sin(r),1+n*Math.cos(r))),a=u,s=c}return 40589755678081*i;function h(e){return e/180*Math.PI}}var u=180/Math.PI,c=Math.PI/4,h={y2lat:function(e){return 90*(Math.atan(Math.exp(e/u))/c-1)},x2lon:function(e){return e},lat2y:function(e){return Math.log(Math.tan((e/90+1)*c))*u},lon2x:function(e){return e}};function f(e){var t=e.map(function(e){return{y:h.lat2y(e.lat),x:h.lon2x(e.lng)}});return function(){for(var e=null,i=2;i<t.length;i++){var o=n(t[i-2],t[i-1],t[i]),a=Math.sign(o);null==e&&(e=a);var s=r(e,a);if(0==s)return!1;e=a}var l=n(t[t.length-2],t[0],t[1]);return r(e,Math.sign(l))}();function r(e,t){return e===t}function n(e,t,r){var n=t.x-e.x,i=t.y-e.y,o=r.x-t.x;return n*(r.y-t.y)-i*o}}var d={checkPtsInPoly:s,areaByLngLatAlts:l,overlapRegion:function(e,t){if(!1!==f(t)){var r=function(e,t){var r=void 0,n=void 0,i=void 0,o=void 0,a=e.reverse(),s=t.reverse();for(var l in r=s[s.length-1],s){n=s[l];var u=a;for(var c in a=[],i=u[u.length-1],u)h(o=u[c])?(h(i)||a.push(f()),a.push(o)):h(i)&&a.push(f()),i=o;r=n}return a.length>0?(a.push(a[0]),a.reverse()):(console.warn("no overlapping area"),a);function h(e){return(n[0]-r[0])*(e[1]-r[1])>(n[1]-r[1])*(e[0]-r[0])}function f(){var e=[r[0]-n[0],r[1]-n[1]],t=[i[0]-o[0],i[1]-o[1]],a=r[0]*n[1]-r[1]*n[0],s=i[0]*o[1]-i[1]*o[0],l=1/(e[0]*t[1]-e[1]*t[0]);return[(a*t[0]-s*e[0])*l,(a*t[1]-s*e[1])*l]}}(e.slice(0,e.length-1).map(function(e){return[h.lat2y(e.lat),h.lon2x(e.lng)]}),t.slice(0,t.length-1).map(function(e){return[h.lat2y(e.lat),h.lon2x(e.lng)]}));return r.length>0?r.map(function(e){return new o.default(h.x2lon(e[1]),h.y2lat(e[0]),0)}):0}console.warn("second polygon should be a convex polygon")},isPolygonConvex:f};e.default=d,e.checkPtsInPoly=s,e.areaByLngLatAlts=l},i=[t,r(3),r(1),r(0),r(6)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o)}])});
!function(t,s){"object"==typeof exports&&"object"==typeof module?module.exports=s(require("altizure"),require("three")):"function"==typeof define&&define.amd?define([,],s):"object"==typeof exports?exports.GeoSystem=s(require("altizure"),require("three")):(t.altizure=t.altizure||{},t.altizure.GeoSystem=s(t.altizure,t.THREE))}(window,function(t,s){return function(t){var s={};function i(a){if(s[a])return s[a].exports;var h=s[a]={i:a,l:!1,exports:{}};return t[a].call(h.exports,h,h.exports,i),h.l=!0,h.exports}return i.m=t,i.c=s,i.d=function(t,s,a){i.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var h in t)i.d(a,h,function(s){return t[s]}.bind(null,h));return a},i.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i.p="",i(i.s=4)}([function(t){t.exports={a:"2.4.4"}},function(t,s,i){"use strict";i.r(s);var a=1,h=2,e=4,n=5,r=484813681109536e-20,o=Math.PI/2,l=.16666666666666666,c=.04722222222222222,u=.022156084656084655,M=1e-10,f=.017453292519943295,m=57.29577951308232,p=Math.PI/4,d=2*Math.PI,_=3.14159265359,y={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},v={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},x=/[\s_\-\/\(\)]/g;function g(t,s){if(t[s])return t[s];for(var i,a=Object.keys(t),h=s.toLowerCase().replace(x,""),e=-1;++e<a.length;)if((i=a[e]).toLowerCase().replace(x,"")===h)return t[i]}var b=function(t){var s,i,a,h={},e=t.split("+").map(function(t){return t.trim()}).filter(function(t){return t}).reduce(function(t,s){var i=s.split("=");return i.push(!0),t[i[0].toLowerCase()]=i[1],t},{}),n={proj:"projName",datum:"datumCode",rf:function(t){h.rf=parseFloat(t)},lat_0:function(t){h.lat0=t*f},lat_1:function(t){h.lat1=t*f},lat_2:function(t){h.lat2=t*f},lat_ts:function(t){h.lat_ts=t*f},lon_0:function(t){h.long0=t*f},lon_1:function(t){h.long1=t*f},lon_2:function(t){h.long2=t*f},alpha:function(t){h.alpha=parseFloat(t)*f},lonc:function(t){h.longc=t*f},x_0:function(t){h.x0=parseFloat(t)},y_0:function(t){h.y0=parseFloat(t)},k_0:function(t){h.k0=parseFloat(t)},k:function(t){h.k0=parseFloat(t)},a:function(t){h.a=parseFloat(t)},b:function(t){h.b=parseFloat(t)},r_a:function(){h.R_A=!0},zone:function(t){h.zone=parseInt(t,10)},south:function(){h.utmSouth=!0},towgs84:function(t){h.datum_params=t.split(",").map(function(t){return parseFloat(t)})},to_meter:function(t){h.to_meter=parseFloat(t)},units:function(t){h.units=t;var s=g(v,t);s&&(h.to_meter=s.to_meter)},from_greenwich:function(t){h.from_greenwich=t*f},pm:function(t){var s=g(y,t);h.from_greenwich=(s||parseFloat(t))*f},nadgrids:function(t){"@null"===t?h.datumCode="none":h.nadgrids=t},axis:function(t){3===t.length&&-1!=="ewnsud".indexOf(t.substr(0,1))&&-1!=="ewnsud".indexOf(t.substr(1,1))&&-1!=="ewnsud".indexOf(t.substr(2,1))&&(h.axis=t)}};for(s in e)i=e[s],s in n?"function"==typeof(a=n[s])?a(i):h[a]=i:h[s]=i;return"string"==typeof h.datumCode&&"WGS84"!==h.datumCode&&(h.datumCode=h.datumCode.toLowerCase()),h},E=function(t){return new I(t).output()},w=1,A=/\s/,P=/[A-Za-z]/,C=/[A-Za-z84]/,S=/[,\]]/,R=/[\d\.E\-\+]/;function I(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=w}function O(t,s,i){Array.isArray(s)&&(i.unshift(s),s=null);var a=s?{}:t,h=i.reduce(function(t,s){return N(s,t),t},a);s&&(t[s]=h)}function N(t,s){if(Array.isArray(t)){var i,a=t.shift();if("PARAMETER"===a&&(a=t.shift()),1===t.length)return Array.isArray(t[0])?(s[a]={},void N(t[0],s[a])):void(s[a]=t[0]);if(t.length)if("TOWGS84"!==a)switch(Array.isArray(a)||(s[a]={}),a){case"UNIT":case"PRIMEM":case"VERT_DATUM":return s[a]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&N(t[2],s[a]));case"SPHEROID":case"ELLIPSOID":return s[a]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&N(t[3],s[a]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void O(s,a,t);default:for(i=-1;++i<t.length;)if(!Array.isArray(t[i]))return N(t,s[a]);return O(s,a,t)}else s[a]=t;else s[a]=!0}else s[t]=!0}I.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;A.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case w:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},I.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if(S.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},I.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=w)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=w,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},I.prototype.number=function(t){if(!R.test(t)){if(S.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},I.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=5},I.prototype.keyword=function(t){if(C.test(t))this.word+=t;else{if("["===t){var s=[];return s.push(this.word),this.level++,null===this.root?this.root=s:this.currentObject.push(s),this.stack.push(this.currentObject),this.currentObject=s,void(this.state=w)}if(!S.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},I.prototype.neutral=function(t){if(P.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if(R.test(t))return this.word=t,void(this.state=3);if(!S.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},I.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var k=.017453292519943295;function T(t){return t*k}var G=function(t){var s=E(t),i=s.shift(),a=s.shift();s.unshift(["name",a]),s.unshift(["type",i]);var h={};return N(s,h),function(t){"GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var s=t.GEOGCS;function i(s){return s*(t.to_meter||1)}"GEOGCS"===t.type&&(s=t),s&&(s.DATUM?t.datumCode=s.DATUM.name.toLowerCase():t.datumCode=s.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"===t.datumCode&&("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),s.DATUM&&s.DATUM.SPHEROID&&(t.ellps=s.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=s.DATUM.SPHEROID.a,t.rf=parseFloat(s.DATUM.SPHEROID.rf,10)),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903")),t.b&&!isFinite(t.b)&&(t.b=t.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",T],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",T],["x0","false_easting",i],["y0","false_northing",i],["long0","central_meridian",T],["lat0","latitude_of_origin",T],["lat0","standard_parallel_1",T],["lat1","standard_parallel_1",T],["lat2","standard_parallel_2",T],["azimuth","Azimuth"],["alpha","azimuth",T],["srsCode","name"]].forEach(function(s){return function(t,s){var i=s[0],a=s[1];!(i in t)&&a in t&&(t[i]=t[a],3===s.length&&(t[i]=s[2](t[i])))}(t,s)}),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=T(t.lat1>0?90:-90),t.lat_ts=t.lat1)}(h),h};function q(t){var s=this;if(2===arguments.length){var i=arguments[1];"string"==typeof i?"+"===i.charAt(0)?q[t]=b(arguments[1]):q[t]=G(arguments[1]):q[t]=i}else if(1===arguments.length){if(Array.isArray(t))return t.map(function(t){Array.isArray(t)?q.apply(s,t):q(t)});if("string"==typeof t){if(t in q)return q[t]}else"EPSG"in t?q["EPSG:"+t.EPSG]=t:"ESRI"in t?q["ESRI:"+t.ESRI]=t:"IAU2000"in t?q["IAU2000:"+t.IAU2000]=t:console.log(t);return}}!function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}(q);var j=q;var L=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];var z=function(t){return function(t){return"string"==typeof t}(t)?function(t){return t in j}(t)?j[t]:function(t){return L.some(function(s){return t.indexOf(s)>-1})}(t)?G(t):function(t){return"+"===t[0]}(t)?b(t):void 0:t},U=function(t,s){var i,a;if(t=t||{},!s)return t;for(a in s)void 0!==(i=s[a])&&(t[a]=i);return t},D=function(t,s,i){var a=t*s;return i/Math.sqrt(1-a*a)},B=function(t){return t<0?-1:1},H=function(t){return Math.abs(t)<=_?t:t-B(t)*d},F=function(t,s,i){var a=t*i,h=.5*t;return a=Math.pow((1-a)/(1+a),h),Math.tan(.5*(o-s))/a},Q=function(t,s){for(var i,a,h=.5*t,e=o-2*Math.atan(s),n=0;n<=15;n++)if(i=t*Math.sin(e),e+=a=o-2*Math.atan(s*Math.pow((1-i)/(1+i),h))-e,Math.abs(a)<=1e-10)return e;return-9999};function W(t){return t}var Y=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=D(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var s,i,a=t.x,h=t.y;if(h*m>90&&h*m<-90&&a*m>180&&a*m<-180)return null;if(Math.abs(Math.abs(h)-o)<=M)return null;if(this.sphere)s=this.x0+this.a*this.k0*H(a-this.long0),i=this.y0+this.a*this.k0*Math.log(Math.tan(p+.5*h));else{var e=Math.sin(h),n=F(this.e,h,e);s=this.x0+this.a*this.k0*H(a-this.long0),i=this.y0-this.a*this.k0*Math.log(n)}return t.x=s,t.y=i,t},inverse:function(t){var s,i,a=t.x-this.x0,h=t.y-this.y0;if(this.sphere)i=o-2*Math.atan(Math.exp(-h/(this.a*this.k0)));else{var e=Math.exp(-h/(this.a*this.k0));if(-9999===(i=Q(this.e,e)))return null}return s=H(this.long0+a/(this.a*this.k0)),t.x=s,t.y=i,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:W,inverse:W,names:["longlat","identity"]}],J={},X=[];function K(t,s){var i=X.length;return t.names?(X[i]=t,t.names.forEach(function(t){J[t.toLowerCase()]=i}),this):(console.log(s),!0)}var V={start:function(){Y.forEach(K)},add:K,get:function(t){if(!t)return!1;var s=t.toLowerCase();return void 0!==J[s]&&X[J[s]]?X[J[s]]:void 0}},Z={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},$=Z.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Z.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var tt={};tt.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},tt.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},tt.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},tt.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},tt.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},tt.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},tt.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},tt.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},tt.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},tt.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},tt.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},tt.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},tt.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},tt.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},tt.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},tt.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},tt.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};var st=function(t,s,i,o,l,c){var u={};return u.datum_type=void 0===t||"none"===t?n:e,s&&(u.datum_params=s.map(parseFloat),0===u.datum_params[0]&&0===u.datum_params[1]&&0===u.datum_params[2]||(u.datum_type=a),u.datum_params.length>3&&(0===u.datum_params[3]&&0===u.datum_params[4]&&0===u.datum_params[5]&&0===u.datum_params[6]||(u.datum_type=h,u.datum_params[3]*=r,u.datum_params[4]*=r,u.datum_params[5]*=r,u.datum_params[6]=u.datum_params[6]/1e6+1))),u.a=i,u.b=o,u.es=l,u.ep2=c,u};function it(t,s){if(!(this instanceof it))return new it(t);s=s||function(t){if(t)throw t};var i=z(t);if("object"==typeof i){var a=it.projections.get(i.projName);if(a){if(i.datumCode&&"none"!==i.datumCode){var h=g(tt,i.datumCode);h&&(i.datum_params=h.towgs84?h.towgs84.split(","):null,i.ellps=h.ellipse,i.datumName=h.datumName?h.datumName:i.datumCode)}i.k0=i.k0||1,i.axis=i.axis||"enu",i.ellps=i.ellps||"wgs84";var e=function(t,s,i,a,h){if(!t){var e=g(Z,a);e||(e=$),t=e.a,s=e.b,i=e.rf}return i&&!s&&(s=(1-1/i)*t),(0===i||Math.abs(t-s)<M)&&(h=!0,s=t),{a:t,b:s,rf:i,sphere:h}}(i.a,i.b,i.rf,i.ellps,i.sphere),n=function(t,s,i,a){var h=t*t,e=s*s,n=(h-e)/h,r=0;return a?(h=(t*=1-n*(l+n*(c+n*u)))*t,n=0):r=Math.sqrt(n),{es:n,e:r,ep2:(h-e)/e}}(e.a,e.b,e.rf,i.R_A),r=i.datum||st(i.datumCode,i.datum_params,e.a,e.b,n.es,n.ep2);U(this,i),U(this,a),this.a=e.a,this.b=e.b,this.rf=e.rf,this.sphere=e.sphere,this.es=n.es,this.e=n.e,this.ep2=n.ep2,this.datum=r,this.init(),s(null,this)}else s(t)}else s(t)}it.projections=V,it.projections.start();var at=it;function ht(t){return t===a||t===h}var et=function(t,s,i){return function(t,s){return t.datum_type===s.datum_type&&!(t.a!==s.a||Math.abs(t.es-s.es)>5e-11)&&(t.datum_type===a?t.datum_params[0]===s.datum_params[0]&&t.datum_params[1]===s.datum_params[1]&&t.datum_params[2]===s.datum_params[2]:t.datum_type!==h||t.datum_params[0]===s.datum_params[0]&&t.datum_params[1]===s.datum_params[1]&&t.datum_params[2]===s.datum_params[2]&&t.datum_params[3]===s.datum_params[3]&&t.datum_params[4]===s.datum_params[4]&&t.datum_params[5]===s.datum_params[5]&&t.datum_params[6]===s.datum_params[6])}(t,s)?i:t.datum_type===n||s.datum_type===n?i:t.es!==s.es||t.a!==s.a||ht(t.datum_type)||ht(s.datum_type)?(i=function(t,s,i){var a,h,e,n,r=t.x,l=t.y,c=t.z?t.z:0;if(l<-o&&l>-1.001*o)l=-o;else if(l>o&&l<1.001*o)l=o;else if(l<-o||l>o)return null;return r>Math.PI&&(r-=2*Math.PI),h=Math.sin(l),n=Math.cos(l),e=h*h,{x:((a=i/Math.sqrt(1-s*e))+c)*n*Math.cos(r),y:(a+c)*n*Math.sin(r),z:(a*(1-s)+c)*h}}(i,t.es,t.a),ht(t.datum_type)&&(i=function(t,s,i){if(s===a)return{x:t.x+i[0],y:t.y+i[1],z:t.z+i[2]};if(s===h){var e=i[0],n=i[1],r=i[2],o=i[3],l=i[4],c=i[5],u=i[6];return{x:u*(t.x-c*t.y+l*t.z)+e,y:u*(c*t.x+t.y-o*t.z)+n,z:u*(-l*t.x+o*t.y+t.z)+r}}}(i,t.datum_type,t.datum_params)),ht(s.datum_type)&&(i=function(t,s,i){if(s===a)return{x:t.x-i[0],y:t.y-i[1],z:t.z-i[2]};if(s===h){var e=i[0],n=i[1],r=i[2],o=i[3],l=i[4],c=i[5],u=i[6],M=(t.x-e)/u,f=(t.y-n)/u,m=(t.z-r)/u;return{x:M+c*f-l*m,y:-c*M+f+o*m,z:l*M-o*f+m}}}(i,s.datum_type,s.datum_params)),function(t,s,i,a){var h,e,n,r,o,l,c,u,M,f,m,p,d,_,y,v=t.x,x=t.y,g=t.z?t.z:0;if(h=Math.sqrt(v*v+x*x),e=Math.sqrt(v*v+x*x+g*g),h/i<1e-12){if(_=0,e/i<1e-12)return y=-a,{x:t.x,y:t.y,z:t.z}}else _=Math.atan2(x,v);n=g/e,u=(r=h/e)*(1-s)*(o=1/Math.sqrt(1-s*(2-s)*r*r)),M=n*o,d=0;do{d++,l=s*(c=i/Math.sqrt(1-s*M*M))/(c+(y=h*u+g*M-c*(1-s*M*M))),p=(m=n*(o=1/Math.sqrt(1-l*(2-l)*r*r)))*u-(f=r*(1-l)*o)*M,u=f,M=m}while(p*p>1e-24&&d<30);return{x:_,y:Math.atan(m/Math.abs(f)),z:y}}(i,s.es,s.a,s.b)):i},nt=function(t,s,i){var a,h,e,n=i.x,r=i.y,o=i.z||0,l={};for(e=0;e<3;e++)if(!s||2!==e||void 0!==i.z)switch(0===e?(a=n,h="x"):1===e?(a=r,h="y"):(a=o,h="z"),t.axis[e]){case"e":l[h]=a;break;case"w":l[h]=-a;break;case"n":l[h]=a;break;case"s":l[h]=-a;break;case"u":void 0!==i[h]&&(l.z=a);break;case"d":void 0!==i[h]&&(l.z=-a);break;default:return null}return l},rt=function(t){var s={x:t[0],y:t[1]};return t.length>2&&(s.z=t[2]),t.length>3&&(s.m=t[3]),s},ot=function(t){lt(t.x),lt(t.y)};function lt(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function ct(t,s,i){var e;return Array.isArray(i)&&(i=rt(i)),ot(i),t.datum&&s.datum&&function(t,s){return(t.datum.datum_type===a||t.datum.datum_type===h)&&"WGS84"!==s.datumCode||(s.datum.datum_type===a||s.datum.datum_type===h)&&"WGS84"!==t.datumCode}(t,s)&&(i=ct(t,e=new at("WGS84"),i),t=e),"enu"!==t.axis&&(i=nt(t,!1,i)),"longlat"===t.projName?i={x:i.x*f,y:i.y*f}:(t.to_meter&&(i={x:i.x*t.to_meter,y:i.y*t.to_meter}),i=t.inverse(i)),t.from_greenwich&&(i.x+=t.from_greenwich),i=et(t.datum,s.datum,i),s.from_greenwich&&(i={x:i.x-s.from_greenwich,y:i.y}),"longlat"===s.projName?i={x:i.x*m,y:i.y*m}:(i=s.forward(i),s.to_meter&&(i={x:i.x/s.to_meter,y:i.y/s.to_meter})),"enu"!==s.axis?nt(s,!0,i):i}var ut=at("WGS84");function Mt(t,s,i){var a,h,e;return Array.isArray(i)?(a=ct(t,s,i),3===i.length?[a.x,a.y,a.z]:[a.x,a.y]):(h=ct(t,s,i),2===(e=Object.keys(i)).length?h:(e.forEach(function(t){"x"!==t&&"y"!==t&&(h[t]=i[t])}),h))}function ft(t){return t instanceof at?t:t.oProj?t.oProj:at(t)}var mt=function(t,s,i){t=ft(t);var a,h=!1;return void 0===s?(s=t,t=ut,h=!0):(void 0!==s.x||Array.isArray(s))&&(i=s,s=t,t=ut,h=!0),s=ft(s),i?Mt(t,s,i):(a={forward:function(i){return Mt(t,s,i)},inverse:function(i){return Mt(s,t,i)}},h&&(a.oProj=s),a)},pt=6,dt="AJSAJS",_t="AFAFAF",yt=65,vt=73,xt=79,gt=86,bt=90,Et={forward:wt,inverse:function(t){var s=St(It(t.toUpperCase()));if(s.lat&&s.lon)return[s.lon,s.lat,s.lon,s.lat];return[s.left,s.bottom,s.right,s.top]},toPoint:At};function wt(t,s){return s=s||5,function(t,s){var i="00000"+t.easting,a="00000"+t.northing;return t.zoneNumber+t.zoneLetter+function(t,s,i){var a=Rt(i),h=Math.floor(t/1e5),e=Math.floor(s/1e5)%20;return function(t,s,i){var a=i-1,h=dt.charCodeAt(a),e=_t.charCodeAt(a),n=h+t-1,r=e+s,o=!1;n>bt&&(n=n-bt+yt-1,o=!0);(n===vt||h<vt&&n>vt||(n>vt||h<vt)&&o)&&n++;(n===xt||h<xt&&n>xt||(n>xt||h<xt)&&o)&&++n===vt&&n++;n>bt&&(n=n-bt+yt-1);r>gt?(r=r-gt+yt-1,o=!0):o=!1;(r===vt||e<vt&&r>vt||(r>vt||e<vt)&&o)&&r++;(r===xt||e<xt&&r>xt||(r>xt||e<xt)&&o)&&++r===vt&&r++;r>gt&&(r=r-gt+yt-1);return String.fromCharCode(n)+String.fromCharCode(r)}(h,e,a)}(t.easting,t.northing,t.zoneNumber)+i.substr(i.length-5,s)+a.substr(a.length-5,s)}(function(t){var s,i,a,h,e,n,r,o=t.lat,l=t.lon,c=6378137,u=Pt(o),M=Pt(l);r=Math.floor((l+180)/6)+1,180===l&&(r=60);o>=56&&o<64&&l>=3&&l<12&&(r=32);o>=72&&o<84&&(l>=0&&l<9?r=31:l>=9&&l<21?r=33:l>=21&&l<33?r=35:l>=33&&l<42&&(r=37));n=Pt(6*(r-1)-180+3),.006739496752268451,s=c/Math.sqrt(1-.00669438*Math.sin(u)*Math.sin(u)),i=Math.tan(u)*Math.tan(u),a=.006739496752268451*Math.cos(u)*Math.cos(u),h=Math.cos(u)*(M-n),e=c*(.9983242984503243*u-.002514607064228144*Math.sin(2*u)+2639046602129982e-21*Math.sin(4*u)-3.418046101696858e-9*Math.sin(6*u));var f=.9996*s*(h+(1-i+a)*h*h*h/6+(5-18*i+i*i+72*a-.39089081163157013)*h*h*h*h*h/120)+5e5,m=.9996*(e+s*Math.tan(u)*(h*h/2+(5-i+9*a+4*a*a)*h*h*h*h/24+(61-58*i+i*i+600*a-2.2240339282485886)*h*h*h*h*h*h/720));o<0&&(m+=1e7);return{northing:Math.round(m),easting:Math.round(f),zoneNumber:r,zoneLetter:function(t){var s="Z";84>=t&&t>=72?s="X":72>t&&t>=64?s="W":64>t&&t>=56?s="V":56>t&&t>=48?s="U":48>t&&t>=40?s="T":40>t&&t>=32?s="S":32>t&&t>=24?s="R":24>t&&t>=16?s="Q":16>t&&t>=8?s="P":8>t&&t>=0?s="N":0>t&&t>=-8?s="M":-8>t&&t>=-16?s="L":-16>t&&t>=-24?s="K":-24>t&&t>=-32?s="J":-32>t&&t>=-40?s="H":-40>t&&t>=-48?s="G":-48>t&&t>=-56?s="F":-56>t&&t>=-64?s="E":-64>t&&t>=-72?s="D":-72>t&&t>=-80&&(s="C");return s}(o)}}({lat:t[1],lon:t[0]}),s)}function At(t){var s=St(It(t.toUpperCase()));return s.lat&&s.lon?[s.lon,s.lat]:[(s.left+s.right)/2,(s.top+s.bottom)/2]}function Pt(t){return t*(Math.PI/180)}function Ct(t){return t/Math.PI*180}function St(t){var s=t.northing,i=t.easting,a=t.zoneLetter,h=t.zoneNumber;if(h<0||h>60)return null;var e,n,r,o,l,c,u,M,f=6378137,m=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),p=i-5e5,d=s;a<"N"&&(d-=1e7),c=6*(h-1)-180+3,M=(u=d/.9996/6367449.145945056)+(3*m/2-27*m*m*m/32)*Math.sin(2*u)+(21*m*m/16-55*m*m*m*m/32)*Math.sin(4*u)+151*m*m*m/96*Math.sin(6*u),e=f/Math.sqrt(1-.00669438*Math.sin(M)*Math.sin(M)),n=Math.tan(M)*Math.tan(M),r=.006739496752268451*Math.cos(M)*Math.cos(M),o=.99330562*f/Math.pow(1-.00669438*Math.sin(M)*Math.sin(M),1.5),l=p/(.9996*e);var _=M-e*Math.tan(M)/o*(l*l/2-(5+3*n+10*r-4*r*r-.06065547077041606)*l*l*l*l/24+(61+90*n+298*r+45*n*n-1.6983531815716497-3*r*r)*l*l*l*l*l*l/720);_=Ct(_);var y,v=(l-(1+2*n+r)*l*l*l/6+(5-2*r+28*n-3*r*r+.05391597401814761+24*n*n)*l*l*l*l*l/120)/Math.cos(M);if(v=c+Ct(v),t.accuracy){var x=St({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});y={top:x.lat,right:x.lon,bottom:_,left:v}}else y={lat:_,lon:v};return y}function Rt(t){var s=t%pt;return 0===s&&(s=pt),s}function It(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var s,i=t.length,a=null,h="",e=0;!/[A-Z]/.test(s=t.charAt(e));){if(e>=2)throw"MGRSPoint bad conversion from: "+t;h+=s,e++}var n=parseInt(h,10);if(0===e||e+3>i)throw"MGRSPoint bad conversion from: "+t;var r=t.charAt(e++);if(r<="A"||"B"===r||"Y"===r||r>="Z"||"I"===r||"O"===r)throw"MGRSPoint zone letter "+r+" not handled: "+t;a=t.substring(e,e+=2);for(var o=Rt(n),l=function(t,s){var i=dt.charCodeAt(s-1),a=1e5,h=!1;for(;i!==t.charCodeAt(0);){if(++i===vt&&i++,i===xt&&i++,i>bt){if(h)throw"Bad character: "+t;i=yt,h=!0}a+=1e5}return a}(a.charAt(0),o),c=function(t,s){if(t>"V")throw"MGRSPoint given invalid Northing "+t;var i=_t.charCodeAt(s-1),a=0,h=!1;for(;i!==t.charCodeAt(0);){if(++i===vt&&i++,i===xt&&i++,i>gt){if(h)throw"Bad character: "+t;i=yt,h=!0}a+=1e5}return a}(a.charAt(1),o);c<Ot(r);)c+=2e6;var u=i-e;if(u%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var M,f,m,p=u/2,d=0,_=0;return p>0&&(M=1e5/Math.pow(10,p),f=t.substring(e,e+p),d=parseFloat(f)*M,m=t.substring(e+p),_=parseFloat(m)*M),{easting:d+l,northing:_+c,zoneLetter:r,zoneNumber:n,accuracy:M}}function Ot(t){var s;switch(t){case"C":s=11e5;break;case"D":s=2e6;break;case"E":s=28e5;break;case"F":s=37e5;break;case"G":s=46e5;break;case"H":s=55e5;break;case"J":s=64e5;break;case"K":s=73e5;break;case"L":s=82e5;break;case"M":s=91e5;break;case"N":s=0;break;case"P":s=8e5;break;case"Q":s=17e5;break;case"R":s=26e5;break;case"S":s=35e5;break;case"T":s=44e5;break;case"U":s=53e5;break;case"V":s=62e5;break;case"W":s=7e6;break;case"X":s=79e5;break;default:s=-1}if(s>=0)return s;throw"Invalid zone letter: "+t}function Nt(t,s,i){if(!(this instanceof Nt))return new Nt(t,s,i);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===s){var a=t.split(",");this.x=parseFloat(a[0],10),this.y=parseFloat(a[1],10),this.z=parseFloat(a[2],10)||0}else this.x=t,this.y=s,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Nt.fromMGRS=function(t){return new Nt(At(t))},Nt.prototype.toMGRS=function(t){return wt([this.x,this.y],t)};var kt=Nt,Tt=i(0),Gt=.01068115234375,qt=function(t){var s=[];s[0]=1-t*(.25+t*(.046875+t*(.01953125+t*Gt))),s[1]=t*(.75-t*(.046875+t*(.01953125+t*Gt)));var i=t*t;return s[2]=i*(.46875-t*(.013020833333333334+.007120768229166667*t)),i*=t,s[3]=i*(.3645833333333333-.005696614583333333*t),s[4]=i*t*.3076171875,s},jt=function(t,s,i,a){return i*=s,s*=s,a[0]*t-i*(a[1]+s*(a[2]+s*(a[3]+s*a[4])))},Lt=function(t,s,i){for(var a=1/(1-s),h=t,e=20;e;--e){var n=Math.sin(h),r=1-s*n*n;if(h-=r=(jt(h,n,Math.cos(h),i)-t)*(r*Math.sqrt(r))*a,Math.abs(r)<M)return h}return h};var zt={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=qt(this.es),this.ml0=jt(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var s,i,a,h=t.x,e=t.y,n=H(h-this.long0),r=Math.sin(e),o=Math.cos(e);if(this.es){var l=o*n,c=Math.pow(l,2),u=this.ep2*Math.pow(o,2),f=Math.pow(u,2),m=Math.abs(o)>M?Math.tan(e):0,p=Math.pow(m,2),d=Math.pow(p,2);s=1-this.es*Math.pow(r,2),l/=Math.sqrt(s);var _=jt(e,r,o,this.en);i=this.a*(this.k0*l*(1+c/6*(1-p+u+c/20*(5-18*p+d+14*u-58*p*u+c/42*(61+179*d-d*p-479*p)))))+this.x0,a=this.a*(this.k0*(_-this.ml0+r*n*l/2*(1+c/12*(5-p+9*u+4*f+c/30*(61+d-58*p+270*u-330*p*u+c/56*(1385+543*d-d*p-3111*p))))))+this.y0}else{var y=o*Math.sin(n);if(Math.abs(Math.abs(y)-1)<M)return 93;if(i=.5*this.a*this.k0*Math.log((1+y)/(1-y))+this.x0,a=o*Math.cos(n)/Math.sqrt(1-Math.pow(y,2)),(y=Math.abs(a))>=1){if(y-1>M)return 93;a=0}else a=Math.acos(a);e<0&&(a=-a),a=this.a*this.k0*(a-this.lat0)+this.y0}return t.x=i,t.y=a,t},inverse:function(t){var s,i,a,h,e=(t.x-this.x0)*(1/this.a),n=(t.y-this.y0)*(1/this.a);if(this.es)if(s=this.ml0+n/this.k0,i=Lt(s,this.es,this.en),Math.abs(i)<o){var r=Math.sin(i),l=Math.cos(i),c=Math.abs(l)>M?Math.tan(i):0,u=this.ep2*Math.pow(l,2),f=Math.pow(u,2),m=Math.pow(c,2),p=Math.pow(m,2);s=1-this.es*Math.pow(r,2);var d=e*Math.sqrt(s)/this.k0,_=Math.pow(d,2);a=i-(s*=c)*_/(1-this.es)*.5*(1-_/12*(5+3*m-9*u*m+u-4*f-_/30*(61+90*m-252*u*m+45*p+46*u-_/56*(1385+3633*m+4095*p+1574*p*m)))),h=H(this.long0+d*(1-_/6*(1+2*m+u-_/20*(5+28*m+24*p+8*u*m+6*u-_/42*(61+662*m+1320*p+720*p*m))))/l)}else a=o*B(n),h=0;else{var y=Math.exp(e/this.k0),v=.5*(y-1/y),x=this.lat0+n/this.k0,g=Math.cos(x);s=Math.sqrt((1-Math.pow(g,2))/(1+Math.pow(v,2))),a=Math.asin(s),n<0&&(a=-a),h=0===v&&0===g?0:H(Math.atan2(v,g)+this.long0)}return t.x=h,t.y=a,t},names:["Transverse_Mercator","Transverse Mercator","tmerc"]},Ut=function(t){var s=Math.exp(t);return s=(s-1/s)/2},Dt=function(t,s){t=Math.abs(t),s=Math.abs(s);var i=Math.max(t,s),a=Math.min(t,s)/(i||1);return i*Math.sqrt(1+Math.pow(a,2))},Bt=function(t){var s=Math.abs(t);return s=function(t){var s=1+t,i=s-1;return 0===i?t:t*Math.log(s)/i}(s*(1+s/(Dt(1,s)+1))),t<0?-s:s},Ht=function(t,s){for(var i,a=2*Math.cos(2*s),h=t.length-1,e=t[h],n=0;--h>=0;)i=a*e-n+t[h],n=e,e=i;return s+i*Math.sin(2*s)},Ft=function(t,s){for(var i,a=2*Math.cos(s),h=t.length-1,e=t[h],n=0;--h>=0;)i=a*e-n+t[h],n=e,e=i;return Math.sin(s)*i},Qt=function(t,s,i){for(var a,h,e=Math.sin(s),n=Math.cos(s),r=Ut(i),o=function(t){var s=Math.exp(t);return s=(s+1/s)/2}(i),l=2*n*o,c=-2*e*r,u=t.length-1,M=t[u],f=0,m=0,p=0;--u>=0;)a=m,h=f,M=l*(m=M)-a-c*(f=p)+t[u],p=c*m-h+l*f;return[(l=e*o)*M-(c=n*r)*p,l*p+c*M]};var Wt={init:function(){if(void 0===this.es||this.es<=0)throw new Error("incorrect elliptical usage");this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),s=t/(2-t),i=s;this.cgb[0]=s*(2+s*(-2/3+s*(s*(116/45+s*(26/45+s*(-2854/675)))-2))),this.cbg[0]=s*(s*(2/3+s*(4/3+s*(-82/45+s*(32/45+s*(4642/4725)))))-2),i*=s,this.cgb[1]=i*(7/3+s*(s*(-227/45+s*(2704/315+s*(2323/945)))-1.6)),this.cbg[1]=i*(5/3+s*(-16/15+s*(-13/9+s*(904/315+s*(-1522/945))))),i*=s,this.cgb[2]=i*(56/15+s*(-136/35+s*(-1262/105+s*(73814/2835)))),this.cbg[2]=i*(-26/15+s*(34/21+s*(1.6+s*(-12686/2835)))),i*=s,this.cgb[3]=i*(4279/630+s*(-332/35+s*(-399572/14175))),this.cbg[3]=i*(1237/630+s*(s*(-24832/14175)-2.4)),i*=s,this.cgb[4]=i*(4174/315+s*(-144838/6237)),this.cbg[4]=i*(-734/315+s*(109598/31185)),i*=s,this.cgb[5]=i*(601676/22275),this.cbg[5]=i*(444337/155925),i=Math.pow(s,2),this.Qn=this.k0/(1+s)*(1+i*(.25+i*(1/64+i/256))),this.utg[0]=s*(s*(2/3+s*(-37/96+s*(1/360+s*(81/512+s*(-96199/604800)))))-.5),this.gtu[0]=s*(.5+s*(-2/3+s*(5/16+s*(41/180+s*(-127/288+s*(7891/37800)))))),this.utg[1]=i*(-1/48+s*(-1/15+s*(437/1440+s*(-46/105+s*(1118711/3870720))))),this.gtu[1]=i*(13/48+s*(s*(557/1440+s*(281/630+s*(-1983433/1935360)))-.6)),i*=s,this.utg[2]=i*(-17/480+s*(37/840+s*(209/4480+s*(-5569/90720)))),this.gtu[2]=i*(61/240+s*(-103/140+s*(15061/26880+s*(167603/181440)))),i*=s,this.utg[3]=i*(-4397/161280+s*(11/504+s*(830251/7257600))),this.gtu[3]=i*(49561/161280+s*(-179/168+s*(6601661/7257600))),i*=s,this.utg[4]=i*(-4583/161280+s*(108847/3991680)),this.gtu[4]=i*(34729/80640+s*(-3418889/1995840)),i*=s,this.utg[5]=-.03233083094085698*i,this.gtu[5]=.6650675310896665*i;var a=Ht(this.cbg,this.lat0);this.Zb=-this.Qn*(a+Ft(this.gtu,2*a))},forward:function(t){var s=H(t.x-this.long0),i=t.y;i=Ht(this.cbg,i);var a=Math.sin(i),h=Math.cos(i),e=Math.sin(s),n=Math.cos(s);i=Math.atan2(a,n*h),s=Math.atan2(e*h,Dt(a,h*n)),s=Bt(Math.tan(s));var r,o,l=Qt(this.gtu,2*i,2*s);return i+=l[0],s+=l[1],Math.abs(s)<=2.623395162778?(r=this.a*(this.Qn*s)+this.x0,o=this.a*(this.Qn*i+this.Zb)+this.y0):(r=1/0,o=1/0),t.x=r,t.y=o,t},inverse:function(t){var s,i,a=(t.x-this.x0)*(1/this.a),h=(t.y-this.y0)*(1/this.a);if(h=(h-this.Zb)/this.Qn,a/=this.Qn,Math.abs(a)<=2.623395162778){var e=Qt(this.utg,2*h,2*a);h+=e[0],a+=e[1],a=Math.atan(Ut(a));var n=Math.sin(h),r=Math.cos(h),o=Math.sin(a),l=Math.cos(a);h=Math.atan2(n*l,Dt(o,l*r)),a=Math.atan2(o,l*r),s=H(a+this.long0),i=Ht(this.cgb,h)}else s=1/0,i=1/0;return t.x=s,t.y=i,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc"]},Yt=function(t,s){if(void 0===t){if((t=Math.floor(30*(H(s)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t};var Jt={init:function(){var t=Yt(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*f,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Wt.init.apply(this),this.forward=Wt.forward,this.inverse=Wt.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"},Xt=function(t,s){return Math.pow((1-t)/(1+t),s)},Kt=20;var Vt={init:function(){var t=Math.sin(this.lat0),s=Math.cos(this.lat0);s*=s,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*s*s/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+p)/(Math.pow(Math.tan(.5*this.lat0+p),this.C)*Xt(this.e*t,this.ratexp))},forward:function(t){var s=t.x,i=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+p),this.C)*Xt(this.e*Math.sin(i),this.ratexp))-o,t.x=this.C*s,t},inverse:function(t){for(var s=t.x/this.C,i=t.y,a=Math.pow(Math.tan(.5*i+p)/this.K,1/this.C),h=Kt;h>0&&(i=2*Math.atan(a*Xt(this.e*Math.sin(t.y),-.5*this.e))-o,!(Math.abs(i-t.y)<1e-14));--h)t.y=i;return h?(t.x=s,t.y=i,t):null},names:["gauss"]};var Zt={init:function(){Vt.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var s,i,a,h;return t.x=H(t.x-this.long0),Vt.forward.apply(this,[t]),s=Math.sin(t.y),i=Math.cos(t.y),a=Math.cos(t.x),h=this.k0*this.R2/(1+this.sinc0*s+this.cosc0*i*a),t.x=h*i*Math.sin(t.x),t.y=h*(this.cosc0*s-this.sinc0*i*a),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var s,i,a,h,e;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,e=Math.sqrt(t.x*t.x+t.y*t.y)){var n=2*Math.atan2(e,this.R2);s=Math.sin(n),i=Math.cos(n),h=Math.asin(i*this.sinc0+t.y*s*this.cosc0/e),a=Math.atan2(t.x*s,e*this.cosc0*i-t.y*this.sinc0*s)}else h=this.phic0,a=0;return t.x=a,t.y=h,Vt.inverse.apply(this,[t]),t.x=H(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative"]};var $t={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=M&&(this.k0=.5*(1+B(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=M&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=M&&(this.k0=.5*this.cons*D(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/F(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=D(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-o,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var s,i,a,h,e,n,r=t.x,l=t.y,c=Math.sin(l),u=Math.cos(l),f=H(r-this.long0);return Math.abs(Math.abs(r-this.long0)-Math.PI)<=M&&Math.abs(l+this.lat0)<=M?(t.x=NaN,t.y=NaN,t):this.sphere?(s=2*this.k0/(1+this.sinlat0*c+this.coslat0*u*Math.cos(f)),t.x=this.a*s*u*Math.sin(f)+this.x0,t.y=this.a*s*(this.coslat0*c-this.sinlat0*u*Math.cos(f))+this.y0,t):(i=2*Math.atan(this.ssfn_(l,c,this.e))-o,h=Math.cos(i),a=Math.sin(i),Math.abs(this.coslat0)<=M?(e=F(this.e,l*this.con,this.con*c),n=2*this.a*this.k0*e/this.cons,t.x=this.x0+n*Math.sin(r-this.long0),t.y=this.y0-this.con*n*Math.cos(r-this.long0),t):(Math.abs(this.sinlat0)<M?(s=2*this.a*this.k0/(1+h*Math.cos(f)),t.y=s*a):(s=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*a+this.cosX0*h*Math.cos(f))),t.y=s*(this.cosX0*a-this.sinX0*h*Math.cos(f))+this.y0),t.x=s*h*Math.sin(f)+this.x0,t))},inverse:function(t){var s,i,a,h,e;t.x-=this.x0,t.y-=this.y0;var n=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var r=2*Math.atan(n/(.5*this.a*this.k0));return s=this.long0,i=this.lat0,n<=M?(t.x=s,t.y=i,t):(i=Math.asin(Math.cos(r)*this.sinlat0+t.y*Math.sin(r)*this.coslat0/n),s=Math.abs(this.coslat0)<M?this.lat0>0?H(this.long0+Math.atan2(t.x,-1*t.y)):H(this.long0+Math.atan2(t.x,t.y)):H(this.long0+Math.atan2(t.x*Math.sin(r),n*this.coslat0*Math.cos(r)-t.y*this.sinlat0*Math.sin(r))),t.x=s,t.y=i,t)}if(Math.abs(this.coslat0)<=M){if(n<=M)return i=this.lat0,s=this.long0,t.x=s,t.y=i,t;t.x*=this.con,t.y*=this.con,a=n*this.cons/(2*this.a*this.k0),i=this.con*Q(this.e,a),s=this.con*H(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else h=2*Math.atan(n*this.cosX0/(2*this.a*this.k0*this.ms1)),s=this.long0,n<=M?e=this.X0:(e=Math.asin(Math.cos(h)*this.sinX0+t.y*Math.sin(h)*this.cosX0/n),s=H(this.long0+Math.atan2(t.x*Math.sin(h),n*this.cosX0*Math.cos(h)-t.y*this.sinX0*Math.sin(h)))),i=-1*Q(this.e,Math.tan(.5*(o+e)));return t.x=s,t.y=i,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(t,s,i){return s*=i,Math.tan(.5*(o+t))*Math.pow((1-s)/(1+s),.5*i)}};var ts={init:function(){var t=this.lat0;this.lambda0=this.long0;var s=Math.sin(t),i=this.a,a=1/this.rf,h=2*a-Math.pow(a,2),e=this.e=Math.sqrt(h);this.R=this.k0*i*Math.sqrt(1-h)/(1-h*Math.pow(s,2)),this.alpha=Math.sqrt(1+h/(1-h)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(s/this.alpha);var n=Math.log(Math.tan(Math.PI/4+this.b0/2)),r=Math.log(Math.tan(Math.PI/4+t/2)),o=Math.log((1+e*s)/(1-e*s));this.K=n-this.alpha*r+this.alpha*e/2*o},forward:function(t){var s=Math.log(Math.tan(Math.PI/4-t.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),a=-this.alpha*(s+i)+this.K,h=2*(Math.atan(Math.exp(a))-Math.PI/4),e=this.alpha*(t.x-this.lambda0),n=Math.atan(Math.sin(e)/(Math.sin(this.b0)*Math.tan(h)+Math.cos(this.b0)*Math.cos(e))),r=Math.asin(Math.cos(this.b0)*Math.sin(h)-Math.sin(this.b0)*Math.cos(h)*Math.cos(e));return t.y=this.R/2*Math.log((1+Math.sin(r))/(1-Math.sin(r)))+this.y0,t.x=this.R*n+this.x0,t},inverse:function(t){for(var s=t.x-this.x0,i=t.y-this.y0,a=s/this.R,h=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),e=Math.asin(Math.cos(this.b0)*Math.sin(h)+Math.sin(this.b0)*Math.cos(h)*Math.cos(a)),n=Math.atan(Math.sin(a)/(Math.cos(this.b0)*Math.cos(a)-Math.sin(this.b0)*Math.tan(h))),r=this.lambda0+n/this.alpha,o=0,l=e,c=-1e3,u=0;Math.abs(l-c)>1e-7;){if(++u>20)return;o=1/this.alpha*(Math.log(Math.tan(Math.PI/4+e/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(l))/2)),c=l,l=2*Math.atan(Math.exp(o))-Math.PI/2}return t.x=r,t.y=l,t},names:["somerc"]};var ss={init:function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var t=Math.sin(this.lat0),s=Math.cos(this.lat0),i=this.e*t;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(s,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-i*i);var a,h,e=F(this.e,this.lat0,t),n=this.bl/s*Math.sqrt((1-this.es)/(1-i*i));if(n*n<1&&(n=1),isNaN(this.longc)){var r=F(this.e,this.lat1,Math.sin(this.lat1)),o=F(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(n+Math.sqrt(n*n-1))*Math.pow(e,this.bl):this.el=(n-Math.sqrt(n*n-1))*Math.pow(e,this.bl);var l=Math.pow(r,this.bl),c=Math.pow(o,this.bl);h=.5*((a=this.el/l)-1/a);var u=(this.el*this.el-c*l)/(this.el*this.el+c*l),M=(c-l)/(c+l),f=H(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(u*Math.tan(.5*this.bl*f)/M)/this.bl,this.long0=H(this.long0);var m=H(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*m)/h),this.alpha=Math.asin(n*Math.sin(this.gamma0))}else a=this.lat0>=0?n+Math.sqrt(n*n-1):n-Math.sqrt(n*n-1),this.el=a*Math.pow(e,this.bl),h=.5*(a-1/a),this.gamma0=Math.asin(Math.sin(this.alpha)/n),this.long0=this.longc-Math.asin(h*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(n*n-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(n*n-1),Math.cos(this.alpha))},forward:function(t){var s,i,a,h=t.x,e=t.y,n=H(h-this.long0);if(Math.abs(Math.abs(e)-o)<=M)a=e>0?-1:1,i=this.al/this.bl*Math.log(Math.tan(p+a*this.gamma0*.5)),s=-1*a*o*this.al/this.bl;else{var r=F(this.e,e,Math.sin(e)),l=this.el/Math.pow(r,this.bl),c=.5*(l-1/l),u=.5*(l+1/l),f=Math.sin(this.bl*n),m=(c*Math.sin(this.gamma0)-f*Math.cos(this.gamma0))/u;i=Math.abs(Math.abs(m)-1)<=M?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-m)/(1+m))/this.bl,s=Math.abs(Math.cos(this.bl*n))<=M?this.al*this.bl*n:this.al*Math.atan2(c*Math.cos(this.gamma0)+f*Math.sin(this.gamma0),Math.cos(this.bl*n))/this.bl}return this.no_rot?(t.x=this.x0+s,t.y=this.y0+i):(s-=this.uc,t.x=this.x0+i*Math.cos(this.alpha)+s*Math.sin(this.alpha),t.y=this.y0+s*Math.cos(this.alpha)-i*Math.sin(this.alpha)),t},inverse:function(t){var s,i;this.no_rot?(i=t.y-this.y0,s=t.x-this.x0):(i=(t.x-this.x0)*Math.cos(this.alpha)-(t.y-this.y0)*Math.sin(this.alpha),s=(t.y-this.y0)*Math.cos(this.alpha)+(t.x-this.x0)*Math.sin(this.alpha),s+=this.uc);var a=Math.exp(-1*this.bl*i/this.al),h=.5*(a-1/a),e=.5*(a+1/a),n=Math.sin(this.bl*s/this.al),r=(n*Math.cos(this.gamma0)+h*Math.sin(this.gamma0))/e,l=Math.pow(this.el/Math.sqrt((1+r)/(1-r)),1/this.bl);return Math.abs(r-1)<M?(t.x=this.long0,t.y=o):Math.abs(r+1)<M?(t.x=this.long0,t.y=-1*o):(t.y=Q(this.e,l),t.x=H(this.long0-Math.atan2(h*Math.cos(this.gamma0)-n*Math.sin(this.gamma0),Math.cos(this.bl*s/this.al))/this.bl)),t},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]};var is={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<M)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var s=Math.sin(this.lat1),i=Math.cos(this.lat1),a=D(this.e,s,i),h=F(this.e,this.lat1,s),e=Math.sin(this.lat2),n=Math.cos(this.lat2),r=D(this.e,e,n),o=F(this.e,this.lat2,e),l=F(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>M?this.ns=Math.log(a/r)/Math.log(h/o):this.ns=s,isNaN(this.ns)&&(this.ns=s),this.f0=a/(this.ns*Math.pow(h,this.ns)),this.rh=this.a*this.f0*Math.pow(l,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var s=t.x,i=t.y;Math.abs(2*Math.abs(i)-Math.PI)<=M&&(i=B(i)*(o-2*M));var a,h,e=Math.abs(Math.abs(i)-o);if(e>M)a=F(this.e,i,Math.sin(i)),h=this.a*this.f0*Math.pow(a,this.ns);else{if((e=i*this.ns)<=0)return null;h=0}var n=this.ns*H(s-this.long0);return t.x=this.k0*(h*Math.sin(n))+this.x0,t.y=this.k0*(this.rh-h*Math.cos(n))+this.y0,t},inverse:function(t){var s,i,a,h,e,n=(t.x-this.x0)/this.k0,r=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(s=Math.sqrt(n*n+r*r),i=1):(s=-Math.sqrt(n*n+r*r),i=-1);var l=0;if(0!==s&&(l=Math.atan2(i*n,i*r)),0!==s||this.ns>0){if(i=1/this.ns,a=Math.pow(s/(this.a*this.f0),i),-9999===(h=Q(this.e,a)))return null}else h=-o;return e=H(l/this.ns+this.long0),t.x=e,t.y=h,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]};var as={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var s,i,a,h,e,n,r,o=t.x,l=t.y,c=H(o-this.long0);return s=Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(l/2+this.s45),this.alfa)/s)-this.s45),a=-c*this.alfa,h=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(a)),e=Math.asin(Math.cos(i)*Math.sin(a)/Math.cos(h)),n=this.n*e,r=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(h/2+this.s45),this.n),t.y=r*Math.cos(n)/1,t.x=r*Math.sin(n)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var s,i,a,h,e,n,r,o=t.x;t.x=t.y,t.y=o,this.czech||(t.y*=-1,t.x*=-1),e=Math.sqrt(t.x*t.x+t.y*t.y),h=Math.atan2(t.y,t.x)/Math.sin(this.s0),a=2*(Math.atan(Math.pow(this.ro0/e,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),s=Math.asin(Math.cos(this.ad)*Math.sin(a)-Math.sin(this.ad)*Math.cos(a)*Math.cos(h)),i=Math.asin(Math.cos(a)*Math.sin(h)/Math.cos(s)),t.x=this.long0-i/this.alfa,n=s,r=0;var l=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(s/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(n))/(1-this.e*Math.sin(n)),this.e/2))-this.s45),Math.abs(n-t.y)<1e-10&&(r=1),n=t.y,l+=1}while(0===r&&l<15);return l>=15?null:t},names:["Krovak","krovak"]},hs=function(t,s,i,a,h){return t*h-s*Math.sin(2*h)+i*Math.sin(4*h)-a*Math.sin(6*h)},es=function(t){return 1-.25*t*(1+t/16*(3+1.25*t))},ns=function(t){return.375*t*(1+.25*t*(1+.46875*t))},rs=function(t){return.05859375*t*t*(1+.75*t)},os=function(t){return t*t*t*(35/3072)},ls=function(t,s,i){var a=s*i;return t/Math.sqrt(1-a*a)},cs=function(t){return Math.abs(t)<o?t:t-B(t)*Math.PI},us=function(t,s,i,a,h){var e,n;e=t/s;for(var r=0;r<15;r++)if(e+=n=(t-(s*e-i*Math.sin(2*e)+a*Math.sin(4*e)-h*Math.sin(6*e)))/(s-2*i*Math.cos(2*e)+4*a*Math.cos(4*e)-6*h*Math.cos(6*e)),Math.abs(n)<=1e-10)return e;return NaN};var Ms={init:function(){this.sphere||(this.e0=es(this.es),this.e1=ns(this.es),this.e2=rs(this.es),this.e3=os(this.es),this.ml0=this.a*hs(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var s,i,a=t.x,h=t.y;if(a=H(a-this.long0),this.sphere)s=this.a*Math.asin(Math.cos(h)*Math.sin(a)),i=this.a*(Math.atan2(Math.tan(h),Math.cos(a))-this.lat0);else{var e=Math.sin(h),n=Math.cos(h),r=ls(this.a,this.e,e),o=Math.tan(h)*Math.tan(h),l=a*Math.cos(h),c=l*l,u=this.es*n*n/(1-this.es);s=r*l*(1-c*o*(1/6-(8-o+8*u)*c/120)),i=this.a*hs(this.e0,this.e1,this.e2,this.e3,h)-this.ml0+r*e/n*c*(.5+(5-o+6*u)*c/24)}return t.x=s+this.x0,t.y=i+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var s,i,a=t.x/this.a,h=t.y/this.a;if(this.sphere){var e=h+this.lat0;s=Math.asin(Math.sin(e)*Math.cos(a)),i=Math.atan2(Math.tan(a),Math.cos(e))}else{var n=this.ml0/this.a+h,r=us(n,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(r)-o)<=M)return t.x=this.long0,t.y=o,h<0&&(t.y*=-1),t;var l=ls(this.a,this.e,Math.sin(r)),c=l*l*l/this.a/this.a*(1-this.es),u=Math.pow(Math.tan(r),2),f=a*this.a/l,m=f*f;s=r-l*Math.tan(r)/c*f*f*(.5-(1+3*u)*f*f/24),i=f*(1-m*(u/3+(1+3*u)*u*m/15))/Math.cos(r)}return t.x=H(i+this.long0),t.y=cs(s),t},names:["Cassini","Cassini_Soldner","cass"]},fs=function(t,s){var i;return t>1e-7?(1-t*t)*(s/(1-(i=t*s)*i)-.5/t*Math.log((1-i)/(1+i))):2*s};var ms=.3333333333333333,ps=.17222222222222222,ds=.10257936507936508,_s=.06388888888888888,ys=.0664021164021164,vs=.016415012942191543;var xs={init:function(){var t,s=Math.abs(this.lat0);if(Math.abs(s-o)<M?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(s)<M?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=fs(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var s,i=[];return i[0]=t*ms,s=t*t,i[0]+=s*ps,i[1]=s*_s,s*=t,i[0]+=s*ds,i[1]+=s*ys,i[2]=s*vs,i}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=fs(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var s,i,a,h,e,n,r,l,c,u,f=t.x,m=t.y;if(f=H(f-this.long0),this.sphere){if(e=Math.sin(m),u=Math.cos(m),a=Math.cos(f),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((i=this.mode===this.EQUIT?1+u*a:1+this.sinph0*e+this.cosph0*u*a)<=M)return null;s=(i=Math.sqrt(2/i))*u*Math.sin(f),i*=this.mode===this.EQUIT?e:this.cosph0*e-this.sinph0*u*a}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(a=-a),Math.abs(m+this.phi0)<M)return null;i=p-.5*m,s=(i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)))*Math.sin(f),i*=a}}else{switch(r=0,l=0,c=0,a=Math.cos(f),h=Math.sin(f),e=Math.sin(m),n=fs(this.e,e),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(r=n/this.qp,l=Math.sqrt(1-r*r)),this.mode){case this.OBLIQ:c=1+this.sinb1*r+this.cosb1*l*a;break;case this.EQUIT:c=1+l*a;break;case this.N_POLE:c=o+m,n=this.qp-n;break;case this.S_POLE:c=m-o,n=this.qp+n}if(Math.abs(c)<M)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:c=Math.sqrt(2/c),i=this.mode===this.OBLIQ?this.ymf*c*(this.cosb1*r-this.sinb1*l*a):(c=Math.sqrt(2/(1+l*a)))*r*this.ymf,s=this.xmf*c*l*h;break;case this.N_POLE:case this.S_POLE:n>=0?(s=(c=Math.sqrt(n))*h,i=a*(this.mode===this.S_POLE?c:-c)):s=i=0}}return t.x=this.a*s+this.x0,t.y=this.a*i+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var s,i,a,h,e,n,r,l=t.x/this.a,c=t.y/this.a;if(this.sphere){var u,f=0,m=0;if((i=.5*(u=Math.sqrt(l*l+c*c)))>1)return null;switch(i=2*Math.asin(i),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(m=Math.sin(i),f=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(u)<=M?0:Math.asin(c*m/u),l*=m,c=f*u;break;case this.OBLIQ:i=Math.abs(u)<=M?this.phi0:Math.asin(f*this.sinph0+c*m*this.cosph0/u),l*=m*this.cosph0,c=(f-Math.sin(i)*this.sinph0)*u;break;case this.N_POLE:c=-c,i=o-i;break;case this.S_POLE:i-=o}s=0!==c||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(l,c):0}else{if(r=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(l/=this.dd,c*=this.dd,(n=Math.sqrt(l*l+c*c))<M)return t.x=0,t.y=this.phi0,t;h=2*Math.asin(.5*n/this.rq),a=Math.cos(h),l*=h=Math.sin(h),this.mode===this.OBLIQ?(r=a*this.sinb1+c*h*this.cosb1/n,e=this.qp*r,c=n*this.cosb1*a-c*this.sinb1*h):(r=c*h/n,e=this.qp*r,c=n*a)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(c=-c),!(e=l*l+c*c))return t.x=0,t.y=this.phi0,t;r=1-e/this.qp,this.mode===this.S_POLE&&(r=-r)}s=Math.atan2(l,c),i=function(t,s){var i=t+t;return t+s[0]*Math.sin(i)+s[1]*Math.sin(i+i)+s[2]*Math.sin(i+i+i)}(Math.asin(r),this.apa)}return t.x=H(this.long0+s),t.y=i,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4},gs=function(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)};var bs={init:function(){Math.abs(this.lat1+this.lat2)<M||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=D(this.e3,this.sin_po,this.cos_po),this.qs1=fs(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=D(this.e3,this.sin_po,this.cos_po),this.qs2=fs(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=fs(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>M?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var s=t.x,i=t.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var a=fs(this.e3,this.sin_phi,this.cos_phi),h=this.a*Math.sqrt(this.c-this.ns0*a)/this.ns0,e=this.ns0*H(s-this.long0),n=h*Math.sin(e)+this.x0,r=this.rh-h*Math.cos(e)+this.y0;return t.x=n,t.y=r,t},inverse:function(t){var s,i,a,h,e,n;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(s=Math.sqrt(t.x*t.x+t.y*t.y),a=1):(s=-Math.sqrt(t.x*t.x+t.y*t.y),a=-1),h=0,0!==s&&(h=Math.atan2(a*t.x,a*t.y)),a=s*this.ns0/this.a,this.sphere?n=Math.asin((this.c-a*a)/(2*this.ns0)):(i=(this.c-a*a)/this.ns0,n=this.phi1z(this.e3,i)),e=H(h/this.ns0+this.long0),t.x=e,t.y=n,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,s){var i,a,h,e,n,r=gs(.5*s);if(t<M)return r;for(var o=t*t,l=1;l<=25;l++)if(i=Math.sin(r),a=Math.cos(r),r+=n=.5*(e=1-(h=t*i)*h)*e/a*(s/(1-o)-i/e+.5/t*Math.log((1-h)/(1+h))),Math.abs(n)<=1e-7)return r;return null}};var Es={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var s,i,a,h,e,n,r,o=t.x,l=t.y;return a=H(o-this.long0),s=Math.sin(l),i=Math.cos(l),h=Math.cos(a),(e=this.sin_p14*s+this.cos_p14*i*h)>0||Math.abs(e)<=M?(n=this.x0+1*this.a*i*Math.sin(a)/e,r=this.y0+1*this.a*(this.cos_p14*s-this.sin_p14*i*h)/e):(n=this.x0+this.infinity_dist*i*Math.sin(a),r=this.y0+this.infinity_dist*(this.cos_p14*s-this.sin_p14*i*h)),t.x=n,t.y=r,t},inverse:function(t){var s,i,a,h,e,n;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(s=Math.sqrt(t.x*t.x+t.y*t.y))?(h=Math.atan2(s,this.rc),i=Math.sin(h),a=Math.cos(h),n=gs(a*this.sin_p14+t.y*i*this.cos_p14/s),e=Math.atan2(t.x*i,s*this.cos_p14*a-t.y*this.sin_p14*i),e=H(this.long0+e)):(n=this.phic0,e=0),t.x=e,t.y=n,t},names:["gnom"]},ws=function(t,s){var i=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(s)-i)<1e-6)return s<0?-1*o:o;for(var a,h,e,n,r=Math.asin(.5*s),l=0;l<30;l++)if(h=Math.sin(r),e=Math.cos(r),n=t*h,r+=a=Math.pow(1-n*n,2)/(2*e)*(s/(1-t*t)-h/(1-n*n)+.5/t*Math.log((1-n)/(1+n))),Math.abs(a)<=1e-10)return r;return NaN};var As={init:function(){this.sphere||(this.k0=D(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var s,i,a=t.x,h=t.y,e=H(a-this.long0);if(this.sphere)s=this.x0+this.a*e*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(h)/Math.cos(this.lat_ts);else{var n=fs(this.e,Math.sin(h));s=this.x0+this.a*this.k0*e,i=this.y0+this.a*n*.5/this.k0}return t.x=s,t.y=i,t},inverse:function(t){var s,i;return t.x-=this.x0,t.y-=this.y0,this.sphere?(s=H(this.long0+t.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(i=ws(this.e,2*t.y*this.k0/this.a),s=H(this.long0+t.x/(this.a*this.k0))),t.x=s,t.y=i,t},names:["cea"]};var Ps={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var s=t.x,i=t.y,a=H(s-this.long0),h=cs(i-this.lat0);return t.x=this.x0+this.a*a*this.rc,t.y=this.y0+this.a*h,t},inverse:function(t){var s=t.x,i=t.y;return t.x=H(this.long0+(s-this.x0)/(this.a*this.rc)),t.y=cs(this.lat0+(i-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},Cs=20;var Ss={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=es(this.es),this.e1=ns(this.es),this.e2=rs(this.es),this.e3=os(this.es),this.ml0=this.a*hs(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var s,i,a,h=t.x,e=t.y,n=H(h-this.long0);if(a=n*Math.sin(e),this.sphere)Math.abs(e)<=M?(s=this.a*n,i=-1*this.a*this.lat0):(s=this.a*Math.sin(a)/Math.tan(e),i=this.a*(cs(e-this.lat0)+(1-Math.cos(a))/Math.tan(e)));else if(Math.abs(e)<=M)s=this.a*n,i=-1*this.ml0;else{var r=ls(this.a,this.e,Math.sin(e))/Math.tan(e);s=r*Math.sin(a),i=this.a*hs(this.e0,this.e1,this.e2,this.e3,e)-this.ml0+r*(1-Math.cos(a))}return t.x=s+this.x0,t.y=i+this.y0,t},inverse:function(t){var s,i,a,h,e,n,r,o,l;if(a=t.x-this.x0,h=t.y-this.y0,this.sphere)if(Math.abs(h+this.a*this.lat0)<=M)s=H(a/this.a+this.long0),i=0;else{var c;for(n=this.lat0+h/this.a,r=a*a/this.a/this.a+n*n,o=n,e=Cs;e;--e)if(o+=l=-1*(n*(o*(c=Math.tan(o))+1)-o-.5*(o*o+r)*c)/((o-n)/c-1),Math.abs(l)<=M){i=o;break}s=H(this.long0+Math.asin(a*Math.tan(o)/this.a)/Math.sin(i))}else if(Math.abs(h+this.ml0)<=M)i=0,s=H(this.long0+a/this.a);else{var u,f,m,p,d;for(n=(this.ml0+h)/this.a,r=a*a/this.a/this.a+n*n,o=n,e=Cs;e;--e)if(d=this.e*Math.sin(o),u=Math.sqrt(1-d*d)*Math.tan(o),f=this.a*hs(this.e0,this.e1,this.e2,this.e3,o),m=this.e0-2*this.e1*Math.cos(2*o)+4*this.e2*Math.cos(4*o)-6*this.e3*Math.cos(6*o),o-=l=(n*(u*(p=f/this.a)+1)-p-.5*u*(p*p+r))/(this.es*Math.sin(2*o)*(p*p+r-2*n*p)/(4*u)+(n-p)*(u*m-2/Math.sin(2*o))-m),Math.abs(l)<=M){i=o;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),s=H(this.long0+Math.asin(a*u/this.a)/Math.sin(i))}return t.x=s,t.y=i,t},names:["Polyconic","poly"]};var Rs={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){var s,i=t.x,a=t.y-this.lat0,h=i-this.long0,e=a/r*1e-5,n=h,o=1,l=0;for(s=1;s<=10;s++)o*=e,l+=this.A[s]*o;var c,u=l,M=n,f=1,m=0,p=0,d=0;for(s=1;s<=6;s++)c=m*u+f*M,f=f*u-m*M,m=c,p=p+this.B_re[s]*f-this.B_im[s]*m,d=d+this.B_im[s]*f+this.B_re[s]*m;return t.x=d*this.a+this.x0,t.y=p*this.a+this.y0,t},inverse:function(t){var s,i,a=t.x,h=t.y,e=a-this.x0,n=(h-this.y0)/this.a,o=e/this.a,l=1,c=0,u=0,M=0;for(s=1;s<=6;s++)i=c*n+l*o,l=l*n-c*o,c=i,u=u+this.C_re[s]*l-this.C_im[s]*c,M=M+this.C_im[s]*l+this.C_re[s]*c;for(var f=0;f<this.iterations;f++){var m,p=u,d=M,_=n,y=o;for(s=2;s<=6;s++)m=d*u+p*M,p=p*u-d*M,d=m,_+=(s-1)*(this.B_re[s]*p-this.B_im[s]*d),y+=(s-1)*(this.B_im[s]*p+this.B_re[s]*d);p=1,d=0;var v=this.B_re[1],x=this.B_im[1];for(s=2;s<=6;s++)m=d*u+p*M,p=p*u-d*M,d=m,v+=s*(this.B_re[s]*p-this.B_im[s]*d),x+=s*(this.B_im[s]*p+this.B_re[s]*d);var g=v*v+x*x;u=(_*v+y*x)/g,M=(y*v-_*x)/g}var b=u,E=M,w=1,A=0;for(s=1;s<=9;s++)w*=b,A+=this.D[s]*w;var P=this.lat0+A*r*1e5,C=this.long0+E;return t.x=C,t.y=P,t},names:["New_Zealand_Map_Grid","nzmg"]};var Is={init:function(){},forward:function(t){var s=t.x,i=t.y,a=H(s-this.long0),h=this.x0+this.a*a,e=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return t.x=h,t.y=e,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var s=H(this.long0+t.x/this.a),i=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=s,t.y=i,t},names:["Miller_Cylindrical","mill"]},Os=20;var Ns={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=qt(this.es)},forward:function(t){var s,i,a=t.x,h=t.y;if(a=H(a-this.long0),this.sphere){if(this.m)for(var e=this.n*Math.sin(h),n=Os;n;--n){var r=(this.m*h+Math.sin(h)-e)/(this.m+Math.cos(h));if(h-=r,Math.abs(r)<M)break}else h=1!==this.n?Math.asin(this.n*Math.sin(h)):h;s=this.a*this.C_x*a*(this.m+Math.cos(h)),i=this.a*this.C_y*h}else{var o=Math.sin(h),l=Math.cos(h);i=this.a*jt(h,o,l,this.en),s=this.a*a*l/Math.sqrt(1-this.es*o*o)}return t.x=s,t.y=i,t},inverse:function(t){var s,i,a,h;return t.x-=this.x0,a=t.x/this.a,t.y-=this.y0,s=t.y/this.a,this.sphere?(s/=this.C_y,a/=this.C_x*(this.m+Math.cos(s)),this.m?s=gs((this.m*s+Math.sin(s))/this.n):1!==this.n&&(s=gs(Math.sin(s)/this.n)),a=H(a+this.long0),s=cs(s)):(s=Lt(t.y/this.a,this.es,this.en),(h=Math.abs(s))<o?(h=Math.sin(s),i=this.long0+t.x*Math.sqrt(1-this.es*h*h)/(this.a*Math.cos(s)),a=H(i)):h-M<o&&(a=this.long0)),t.x=a,t.y=s,t},names:["Sinusoidal","sinu"]};var ks={init:function(){},forward:function(t){for(var s=t.x,i=t.y,a=H(s-this.long0),h=i,e=Math.PI*Math.sin(i);;){var n=-(h+Math.sin(h)-e)/(1+Math.cos(h));if(h+=n,Math.abs(n)<M)break}h/=2,Math.PI/2-Math.abs(i)<M&&(a=0);var r=.900316316158*this.a*a*Math.cos(h)+this.x0,o=1.4142135623731*this.a*Math.sin(h)+this.y0;return t.x=r,t.y=o,t},inverse:function(t){var s,i;t.x-=this.x0,t.y-=this.y0,i=t.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),s=Math.asin(i);var a=H(this.long0+t.x/(.900316316158*this.a*Math.cos(s)));a<-Math.PI&&(a=-Math.PI),a>Math.PI&&(a=Math.PI),i=(2*s+Math.sin(2*s))/Math.PI,Math.abs(i)>1&&(i=1);var h=Math.asin(i);return t.x=a,t.y=h,t},names:["Mollweide","moll"]};var Ts={init:function(){Math.abs(this.lat1+this.lat2)<M||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=es(this.es),this.e1=ns(this.es),this.e2=rs(this.es),this.e3=os(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=D(this.e,this.sinphi,this.cosphi),this.ml1=hs(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<M?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=D(this.e,this.sinphi,this.cosphi),this.ml2=hs(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=hs(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var s,i=t.x,a=t.y;if(this.sphere)s=this.a*(this.g-a);else{var h=hs(this.e0,this.e1,this.e2,this.e3,a);s=this.a*(this.g-h)}var e=this.ns*H(i-this.long0),n=this.x0+s*Math.sin(e),r=this.y0+this.rh-s*Math.cos(e);return t.x=n,t.y=r,t},inverse:function(t){var s,i,a,h;t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns>=0?(i=Math.sqrt(t.x*t.x+t.y*t.y),s=1):(i=-Math.sqrt(t.x*t.x+t.y*t.y),s=-1);var e=0;if(0!==i&&(e=Math.atan2(s*t.x,s*t.y)),this.sphere)return h=H(this.long0+e/this.ns),a=cs(this.g-i/this.a),t.x=h,t.y=a,t;var n=this.g-i/this.a;return a=us(n,this.e0,this.e1,this.e2,this.e3),h=H(this.long0+e/this.ns),t.x=h,t.y=a,t},names:["Equidistant_Conic","eqdc"]};var Gs={init:function(){this.R=this.a},forward:function(t){var s,i,a=t.x,h=t.y,e=H(a-this.long0);Math.abs(h)<=M&&(s=this.x0+this.R*e,i=this.y0);var n=gs(2*Math.abs(h/Math.PI));(Math.abs(e)<=M||Math.abs(Math.abs(h)-o)<=M)&&(s=this.x0,i=h>=0?this.y0+Math.PI*this.R*Math.tan(.5*n):this.y0+Math.PI*this.R*-Math.tan(.5*n));var r=.5*Math.abs(Math.PI/e-e/Math.PI),l=r*r,c=Math.sin(n),u=Math.cos(n),f=u/(c+u-1),m=f*f,p=f*(2/c-1),d=p*p,_=Math.PI*this.R*(r*(f-d)+Math.sqrt(l*(f-d)*(f-d)-(d+l)*(m-d)))/(d+l);e<0&&(_=-_),s=this.x0+_;var y=l+f;return _=Math.PI*this.R*(p*y-r*Math.sqrt((d+l)*(l+1)-y*y))/(d+l),i=h>=0?this.y0+_:this.y0-_,t.x=s,t.y=i,t},inverse:function(t){var s,i,a,h,e,n,r,o,l,c,u,f;return t.x-=this.x0,t.y-=this.y0,u=Math.PI*this.R,e=(a=t.x/u)*a+(h=t.y/u)*h,u=3*(h*h/(o=-2*(n=-Math.abs(h)*(1+e))+1+2*h*h+e*e)+(2*(r=n-2*h*h+a*a)*r*r/o/o/o-9*n*r/o/o)/27)/(l=(n-r*r/3/o)/o)/(c=2*Math.sqrt(-l/3)),Math.abs(u)>1&&(u=u>=0?1:-1),f=Math.acos(u)/3,i=t.y>=0?(-c*Math.cos(f+Math.PI/3)-r/3/o)*Math.PI:-(-c*Math.cos(f+Math.PI/3)-r/3/o)*Math.PI,s=Math.abs(a)<M?this.long0:H(this.long0+Math.PI*(e-1+Math.sqrt(1+2*(a*a-h*h)+e*e))/2/a),t.x=s,t.y=i,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]};var qs={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var s,i,a,h,e,n,r,l,c,u,f,m,p,d,_,y,v,x,g,b,E,w,A=t.x,P=t.y,C=Math.sin(t.y),S=Math.cos(t.y),R=H(A-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=M?(t.x=this.x0+this.a*(o-P)*Math.sin(R),t.y=this.y0-this.a*(o-P)*Math.cos(R),t):Math.abs(this.sin_p12+1)<=M?(t.x=this.x0+this.a*(o+P)*Math.sin(R),t.y=this.y0+this.a*(o+P)*Math.cos(R),t):(x=this.sin_p12*C+this.cos_p12*S*Math.cos(R),v=(y=Math.acos(x))/Math.sin(y),t.x=this.x0+this.a*v*S*Math.sin(R),t.y=this.y0+this.a*v*(this.cos_p12*C-this.sin_p12*S*Math.cos(R)),t):(s=es(this.es),i=ns(this.es),a=rs(this.es),h=os(this.es),Math.abs(this.sin_p12-1)<=M?(e=this.a*hs(s,i,a,h,o),n=this.a*hs(s,i,a,h,P),t.x=this.x0+(e-n)*Math.sin(R),t.y=this.y0-(e-n)*Math.cos(R),t):Math.abs(this.sin_p12+1)<=M?(e=this.a*hs(s,i,a,h,o),n=this.a*hs(s,i,a,h,P),t.x=this.x0+(e+n)*Math.sin(R),t.y=this.y0+(e+n)*Math.cos(R),t):(r=C/S,l=ls(this.a,this.e,this.sin_p12),c=ls(this.a,this.e,C),u=Math.atan((1-this.es)*r+this.es*l*this.sin_p12/(c*S)),g=0===(f=Math.atan2(Math.sin(R),this.cos_p12*Math.tan(u)-this.sin_p12*Math.cos(R)))?Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.abs(Math.abs(f)-Math.PI)<=M?-Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.asin(Math.sin(R)*Math.cos(u)/Math.sin(f)),m=this.e*this.sin_p12/Math.sqrt(1-this.es),y=l*g*(1-(b=g*g)*(_=(p=this.e*this.cos_p12*Math.cos(f)/Math.sqrt(1-this.es))*p)*(1-_)/6+(E=b*g)/8*(d=m*p)*(1-2*_)+(w=E*g)/120*(_*(4-7*_)-3*m*m*(1-7*_))-w*g/48*d),t.x=this.x0+y*Math.sin(f),t.y=this.y0+y*Math.cos(f),t))},inverse:function(t){var s,i,a,h,e,n,r,l,c,u,f,m,p,d,_,y,v,x,g,b,E,w;if(t.x-=this.x0,t.y-=this.y0,this.sphere){if((s=Math.sqrt(t.x*t.x+t.y*t.y))>2*o*this.a)return;return i=s/this.a,a=Math.sin(i),h=Math.cos(i),e=this.long0,Math.abs(s)<=M?n=this.lat0:(n=gs(h*this.sin_p12+t.y*a*this.cos_p12/s),r=Math.abs(this.lat0)-o,e=Math.abs(r)<=M?this.lat0>=0?H(this.long0+Math.atan2(t.x,-t.y)):H(this.long0-Math.atan2(-t.x,t.y)):H(this.long0+Math.atan2(t.x*a,s*this.cos_p12*h-t.y*this.sin_p12*a))),t.x=e,t.y=n,t}return l=es(this.es),c=ns(this.es),u=rs(this.es),f=os(this.es),Math.abs(this.sin_p12-1)<=M?(m=this.a*hs(l,c,u,f,o),s=Math.sqrt(t.x*t.x+t.y*t.y),n=us((m-s)/this.a,l,c,u,f),e=H(this.long0+Math.atan2(t.x,-1*t.y)),t.x=e,t.y=n,t):Math.abs(this.sin_p12+1)<=M?(m=this.a*hs(l,c,u,f,o),s=Math.sqrt(t.x*t.x+t.y*t.y),n=us((s-m)/this.a,l,c,u,f),e=H(this.long0+Math.atan2(t.x,t.y)),t.x=e,t.y=n,t):(s=Math.sqrt(t.x*t.x+t.y*t.y),_=Math.atan2(t.x,t.y),p=ls(this.a,this.e,this.sin_p12),y=Math.cos(_),x=-(v=this.e*this.cos_p12*y)*v/(1-this.es),g=3*this.es*(1-x)*this.sin_p12*this.cos_p12*y/(1-this.es),w=1-x*(E=(b=s/p)-x*(1+x)*Math.pow(b,3)/6-g*(1+3*x)*Math.pow(b,4)/24)*E/2-b*E*E*E/6,d=Math.asin(this.sin_p12*Math.cos(E)+this.cos_p12*Math.sin(E)*y),e=H(this.long0+Math.asin(Math.sin(_)*Math.sin(E)/Math.cos(d))),n=Math.atan((1-this.es*w*this.sin_p12/Math.sin(d))*Math.tan(d)/(1-this.es)),t.x=e,t.y=n,t)},names:["Azimuthal_Equidistant","aeqd"]};var js={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var s,i,a,h,e,n,r,o=t.x,l=t.y;return a=H(o-this.long0),s=Math.sin(l),i=Math.cos(l),h=Math.cos(a),((e=this.sin_p14*s+this.cos_p14*i*h)>0||Math.abs(e)<=M)&&(n=1*this.a*i*Math.sin(a),r=this.y0+1*this.a*(this.cos_p14*s-this.sin_p14*i*h)),t.x=n,t.y=r,t},inverse:function(t){var s,i,a,h,e,n,r;return t.x-=this.x0,t.y-=this.y0,s=Math.sqrt(t.x*t.x+t.y*t.y),i=gs(s/this.a),a=Math.sin(i),h=Math.cos(i),n=this.long0,Math.abs(s)<=M?(r=this.lat0,t.x=n,t.y=r,t):(r=gs(h*this.sin_p14+t.y*a*this.cos_p14/s),e=Math.abs(this.lat0)-o,Math.abs(e)<=M?(n=this.lat0>=0?H(this.long0+Math.atan2(t.x,-t.y)):H(this.long0-Math.atan2(-t.x,t.y)),t.x=n,t.y=r,t):(n=H(this.long0+Math.atan2(t.x*a,s*this.cos_p14*h-t.y*this.sin_p14*a)),t.x=n,t.y=r,t))},names:["ortho"]},Ls={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},zs={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function Us(t,s,i,a){var h;return t<M?(a.value=zs.AREA_0,h=0):(h=Math.atan2(s,i),Math.abs(h)<=p?a.value=zs.AREA_0:h>p&&h<=o+p?(a.value=zs.AREA_1,h-=o):h>o+p||h<=-(o+p)?(a.value=zs.AREA_2,h=h>=0?h-_:h+_):(a.value=zs.AREA_3,h+=o)),h}function Ds(t,s){var i=t+s;return i<-_?i+=d:i>+_&&(i-=d),i}var Bs={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=o-p/2?this.face=Ls.TOP:this.lat0<=-(o-p/2)?this.face=Ls.BOTTOM:Math.abs(this.long0)<=p?this.face=Ls.FRONT:Math.abs(this.long0)<=o+p?this.face=this.long0>0?Ls.RIGHT:Ls.LEFT:this.face=Ls.BACK,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var s,i,a,h,e,n,r={x:0,y:0},l={value:0};if(t.x-=this.long0,s=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,i=t.x,this.face===Ls.TOP)h=o-s,i>=p&&i<=o+p?(l.value=zs.AREA_0,a=i-o):i>o+p||i<=-(o+p)?(l.value=zs.AREA_1,a=i>0?i-_:i+_):i>-(o+p)&&i<=-p?(l.value=zs.AREA_2,a=i+o):(l.value=zs.AREA_3,a=i);else if(this.face===Ls.BOTTOM)h=o+s,i>=p&&i<=o+p?(l.value=zs.AREA_0,a=-i+o):i<p&&i>=-p?(l.value=zs.AREA_1,a=-i):i<-p&&i>=-(o+p)?(l.value=zs.AREA_2,a=-i-o):(l.value=zs.AREA_3,a=i>0?-i+_:-i-_);else{var c,u,M,f,m,d;this.face===Ls.RIGHT?i=Ds(i,+o):this.face===Ls.BACK?i=Ds(i,+_):this.face===Ls.LEFT&&(i=Ds(i,-o)),f=Math.sin(s),m=Math.cos(s),d=Math.sin(i),c=m*Math.cos(i),u=m*d,M=f,this.face===Ls.FRONT?a=Us(h=Math.acos(c),M,u,l):this.face===Ls.RIGHT?a=Us(h=Math.acos(u),M,-c,l):this.face===Ls.BACK?a=Us(h=Math.acos(-c),M,-u,l):this.face===Ls.LEFT?a=Us(h=Math.acos(-u),M,c,l):(h=a=0,l.value=zs.AREA_0)}return n=Math.atan(12/_*(a+Math.acos(Math.sin(a)*Math.cos(p))-o)),e=Math.sqrt((1-Math.cos(h))/(Math.cos(n)*Math.cos(n))/(1-Math.cos(Math.atan(1/Math.cos(a))))),l.value===zs.AREA_1?n+=o:l.value===zs.AREA_2?n+=_:l.value===zs.AREA_3&&(n+=1.5*_),r.x=e*Math.cos(n),r.y=e*Math.sin(n),r.x=r.x*this.a+this.x0,r.y=r.y*this.a+this.y0,t.x=r.x,t.y=r.y,t},inverse:function(t){var s,i,a,h,e,n,r,l,c,u,M,f,m={lam:0,phi:0},p={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,i=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),s=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?p.value=zs.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(p.value=zs.AREA_1,s-=o):t.x<0&&-t.x>=Math.abs(t.y)?(p.value=zs.AREA_2,s=s<0?s+_:s-_):(p.value=zs.AREA_3,s+=o),c=_/12*Math.tan(s),e=Math.sin(c)/(Math.cos(c)-1/Math.sqrt(2)),n=Math.atan(e),(r=1-(a=Math.cos(s))*a*(h=Math.tan(i))*h*(1-Math.cos(Math.atan(1/Math.cos(n)))))<-1?r=-1:r>1&&(r=1),this.face===Ls.TOP)l=Math.acos(r),m.phi=o-l,p.value===zs.AREA_0?m.lam=n+o:p.value===zs.AREA_1?m.lam=n<0?n+_:n-_:p.value===zs.AREA_2?m.lam=n-o:m.lam=n;else if(this.face===Ls.BOTTOM)l=Math.acos(r),m.phi=l-o,p.value===zs.AREA_0?m.lam=-n+o:p.value===zs.AREA_1?m.lam=-n:p.value===zs.AREA_2?m.lam=-n-o:m.lam=n<0?-n-_:-n+_;else{var d,y,v;c=(d=r)*d,y=(c+=(v=c>=1?0:Math.sqrt(1-c)*Math.sin(n))*v)>=1?0:Math.sqrt(1-c),p.value===zs.AREA_1?(c=y,y=-v,v=c):p.value===zs.AREA_2?(y=-y,v=-v):p.value===zs.AREA_3&&(c=y,y=v,v=-c),this.face===Ls.RIGHT?(c=d,d=-y,y=c):this.face===Ls.BACK?(d=-d,y=-y):this.face===Ls.LEFT&&(c=d,d=y,y=-c),m.phi=Math.acos(-v)-o,m.lam=Math.atan2(y,d),this.face===Ls.RIGHT?m.lam=Ds(m.lam,-o):this.face===Ls.BACK?m.lam=Ds(m.lam,-_):this.face===Ls.LEFT&&(m.lam=Ds(m.lam,+o))}return 0!==this.es&&(u=m.phi<0?1:0,M=Math.tan(m.phi),f=this.b/Math.sqrt(M*M+this.one_minus_f_squared),m.phi=Math.atan(Math.sqrt(this.a*this.a-f*f)/(this.one_minus_f*f)),u&&(m.phi=-m.phi)),m.lam+=this.long0,t.x=m.lam,t.y=m.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]};mt.defaultDatum="WGS84",mt.Proj=at,mt.WGS84=new mt.Proj("WGS84"),mt.Point=kt,mt.toPoint=rt,mt.defs=j,mt.transform=ct,mt.mgrs=Et,mt.version=Tt.a,function(t){t.Proj.projections.add(zt),t.Proj.projections.add(Wt),t.Proj.projections.add(Jt),t.Proj.projections.add(Zt),t.Proj.projections.add($t),t.Proj.projections.add(ts),t.Proj.projections.add(ss),t.Proj.projections.add(is),t.Proj.projections.add(as),t.Proj.projections.add(Ms),t.Proj.projections.add(xs),t.Proj.projections.add(bs),t.Proj.projections.add(Es),t.Proj.projections.add(As),t.Proj.projections.add(Ps),t.Proj.projections.add(Ss),t.Proj.projections.add(Rs),t.Proj.projections.add(Is),t.Proj.projections.add(Ns),t.Proj.projections.add(ks),t.Proj.projections.add(Ts),t.Proj.projections.add(Gs),t.Proj.projections.add(qs),t.Proj.projections.add(js),t.Proj.projections.add(Bs)}(mt);s.default=mt},function(s,i){s.exports=t},function(t,i){t.exports=s},function(t,s,i){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=function(){return function(t,s){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,s){var i=[],a=!0,h=!1,e=void 0;try{for(var n,r=t[Symbol.iterator]();!(a=(n=r.next()).done)&&(i.push(n.value),!s||i.length!==s);a=!0);}catch(t){h=!0,e=t}finally{try{!a&&r.return&&r.return()}finally{if(h)throw e}}return i}(t,s);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(){function t(t,s){for(var i=0;i<s.length;i++){var a=s[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(s,i,a){return i&&t(s.prototype,i),a&&t(s,a),s}}(),e=function(t){return t&&t.__esModule?t:{default:t}}(i(1)),n=i(3),r=i(2);var o=function(){function t(s){!function(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}(this,t),this._sandbox=s.sandbox,this._base=s.base,this._baseCenter=s.baseCenter,this.fromProjection="4326",this.toProjection=s.EPSG,console.log("gs",this)}return h(t,[{key:"align",value:function(t){var s=t.marker,i=t.markerCenter,a=void 0===i?{x:0,y:0,z:0}:i,h=this.base.objToLayer();(new n.Matrix4).getInverse(h);var e=(new n.Matrix4).makeTranslation(a.x-this.baseCenter.x,a.y-this.baseCenter.y,a.z-this.baseCenter.z),o=h.clone().multiply(e);var l=s.shapeHolder.matrix.clone().multiply(s.contentHolder.matrix).multiply(s.projHolder.matrix).multiply(s.displayHolder.matrix);var c=(new n.Matrix4).getInverse(l);var u=o.clone().multiply(c);var M=new n.Vector3,f=new n.Quaternion,m=new n.Vector3;u.clone().decompose(M,f,m);var p=r.EarthMath.getLngLatAltFromNoneGroundCartesian(r.EarthConstants.EarthResolution,M,r.EarthConstants.scale),d=p.lng,_=p.lat,y=p.alt;var v=r.EarthMath.getLocalSystemOnEarthSurface(r.EarthConstants.EarthResolution,d,_,r.EarthConstants.scale),x=M.clone(),g=new n.Matrix4;g.makeBasis(v.lng,v.lat,v.alt),g.setPosition(x),s.setMatrix(g),s._position.lng=d,s._position.lat=_,s._position.alt=y;var b=u.clone().multiply((new n.Matrix4).getInverse(g));b.clone().decompose(M,f,m),s.setPose(void 0,f,void 0)}},{key:"convert",value:function(t){var s=t.lng,i=t.lat,h=t.alt,e=void 0===h?0:h,o=this._project([s,i]),l=a(o,2),c=l[0],u=l[1],M=c-this.baseCenter.x,f=u-this.baseCenter.y,m=e,p=this.base.objToEarth(),d=new n.Vector3(M,f,m).applyMatrix4(p),_=r.EarthMath.getLngLatAltFromNoneGroundCartesian(r.EarthConstants.EarthResolution,d,r.EarthConstants.scale);return{lng:_.lng,lat:_.lat,alt:_.alt}}},{key:"invert",value:function(t){var s=r.EarthMath.getNoneGroundCartesianFromLngLatAlt(r.EarthConstants.EarthResolution,t.lng,t.lat,t.alt,r.EarthConstants.scale);return this.invertEarthPt(s)}},{key:"invertEarthPt",value:function(t){var s=this.base.earthToObj(),i=t.applyMatrix4(s),h=[i.x+this.baseCenter.x,i.y+this.baseCenter.y],e=this._unproject(h),n=a(e,2);return{lng:n[0],lat:n[1],alt:i.z}}},{key:"pickOnProjects",value:function(t){var s=this.sandbox.pickOnProjects(t);return s?this.invert(s):void 0}},{key:"_project",value:function(s){var i=a(s,2),h=i[0],n=i[1];return(0,e.default)(t.EPSG(this.fromProjection),t.EPSG(this.toProjection),[h,n])}},{key:"_unproject",value:function(s){var i=a(s,2),h=i[0],n=i[1];return(0,e.default)(t.EPSG(this.toProjection),t.EPSG(this.fromProjection),[h,n])}},{key:"_PQS",value:function(t){var s=new n.Vector3,i=new n.Quaternion,a=new n.Vector3;t.clone().decompose(s,i,a),console.log("dec",t,s,i,a)}},{key:"fromProjection",set:function(t){this._fromProjection=t},get:function(){return this._fromProjection}},{key:"toProjection",set:function(t){this._toProjection=t},get:function(){return this._toProjection}},{key:"sandbox",get:function(){return this._sandbox}},{key:"baseCenter",get:function(){return this._baseCenter}},{key:"base",get:function(){return this._base}}],[{key:"EPSG",value:function(t){return"4326"===t?'GEOGCS["WGS 84", DATUM["WGS_1984", SPHEROID["WGS 84",6378137,298.257223563, AUTHORITY["EPSG","7030"]], AUTHORITY["EPSG","6326"]], PRIMEM["Greenwich",0, AUTHORITY["EPSG","8901"]], UNIT["degree",0.0174532925199433, AUTHORITY["EPSG","9122"]], AUTHORITY["EPSG","4326"]]':"4547"===t?'PROJCS["CGCS2000 / 3-degree Gauss-Kruger CM 114E", GEOGCS["China Geodetic Coordinate System 2000", DATUM["China_2000", SPHEROID["CGCS2000",6378137,298.257222101, AUTHORITY["EPSG","1024"]], AUTHORITY["EPSG","1043"]], PRIMEM["Greenwich",0, AUTHORITY["EPSG","8901"]], UNIT["degree",0.0174532925199433, AUTHORITY["EPSG","9122"]], AUTHORITY["EPSG","4490"]], PROJECTION["Transverse_Mercator"], PARAMETER["latitude_of_origin",0], PARAMETER["central_meridian",114], PARAMETER["scale_factor",1], PARAMETER["false_easting",500000], PARAMETER["false_northing",0], UNIT["metre",1, AUTHORITY["EPSG","9001"]], AUTHORITY["EPSG","4547"]]':"32650"===t?'PROJCS["WGS 84 / UTM zone 50N", GEOGCS["WGS 84", DATUM["WGS_1984", SPHEROID["WGS 84",6378137,298.257223563, AUTHORITY["EPSG","7030"]], AUTHORITY["EPSG","6326"]], PRIMEM["Greenwich",0, AUTHORITY["EPSG","8901"]], UNIT["degree",0.0174532925199433, AUTHORITY["EPSG","9122"]], AUTHORITY["EPSG","4326"]], PROJECTION["Transverse_Mercator"], PARAMETER["latitude_of_origin",0], PARAMETER["central_meridian",117], PARAMETER["scale_factor",0.9996], PARAMETER["false_easting",500000], PARAMETER["false_northing",0], UNIT["metre",1, AUTHORITY["EPSG","9001"]], AXIS["Easting",EAST], AXIS["Northing",NORTH], AUTHORITY["EPSG","32650"]]':void 0}}]),t}();s.default=o}]).default});